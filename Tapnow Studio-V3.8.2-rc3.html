<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tapnow Studio</title>
  <script type="module" crossorigin>var t2=Object.defineProperty;var xb=e=>{throw TypeError(e)};var n2=(e,t,r)=>t in e?t2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var fr=(e,t,r)=>n2(e,typeof t!="symbol"?t+"":t,r),r2=(e,t,r)=>t.has(e)||xb("Cannot "+r);var bb=(e,t,r)=>t.has(e)?xb("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r);var mp=(e,t,r)=>(r2(e,t,"access private method"),r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function r(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(a){if(a.ep)return;a.ep=!0;const c=r(a);fetch(a.href,c)}})();var No=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var gv={exports:{}},Rf={},xv={exports:{}},$n={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xu=Symbol.for("react.element"),s2=Symbol.for("react.portal"),i2=Symbol.for("react.fragment"),o2=Symbol.for("react.strict_mode"),a2=Symbol.for("react.profiler"),l2=Symbol.for("react.provider"),c2=Symbol.for("react.context"),d2=Symbol.for("react.forward_ref"),u2=Symbol.for("react.suspense"),p2=Symbol.for("react.memo"),f2=Symbol.for("react.lazy"),yb=Symbol.iterator;function h2(e){return e===null||typeof e!="object"?null:(e=yb&&e[yb]||e["@@iterator"],typeof e=="function"?e:null)}var bv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},yv=Object.assign,vv={};function Ec(e,t,r){this.props=e,this.context=t,this.refs=vv,this.updater=r||bv}Ec.prototype.isReactComponent={};Ec.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Ec.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function wv(){}wv.prototype=Ec.prototype;function Fm(e,t,r){this.props=e,this.context=t,this.refs=vv,this.updater=r||bv}var Bm=Fm.prototype=new wv;Bm.constructor=Fm;yv(Bm,Ec.prototype);Bm.isPureReactComponent=!0;var vb=Array.isArray,zv=Object.prototype.hasOwnProperty,Hm={current:null},kv={key:!0,ref:!0,__self:!0,__source:!0};function jv(e,t,r){var i,a={},c=null,d=null;if(t!=null)for(i in t.ref!==void 0&&(d=t.ref),t.key!==void 0&&(c=""+t.key),t)zv.call(t,i)&&!kv.hasOwnProperty(i)&&(a[i]=t[i]);var f=arguments.length-2;if(f===1)a.children=r;else if(1<f){for(var g=Array(f),z=0;z<f;z++)g[z]=arguments[z+2];a.children=g}if(e&&e.defaultProps)for(i in f=e.defaultProps,f)a[i]===void 0&&(a[i]=f[i]);return{$$typeof:xu,type:e,key:c,ref:d,props:a,_owner:Hm.current}}function m2(e,t){return{$$typeof:xu,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Wm(e){return typeof e=="object"&&e!==null&&e.$$typeof===xu}function g2(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var wb=/\/+/g;function G0(e,t){return typeof e=="object"&&e!==null&&e.key!=null?g2(""+e.key):t.toString(36)}function Yp(e,t,r,i,a){var c=typeof e;(c==="undefined"||c==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(c){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case xu:case s2:d=!0}}if(d)return d=e,a=a(d),e=i===""?"."+G0(d,0):i,vb(a)?(r="",e!=null&&(r=e.replace(wb,"$&/")+"/"),Yp(a,t,r,"",function(z){return z})):a!=null&&(Wm(a)&&(a=m2(a,r+(!a.key||d&&d.key===a.key?"":(""+a.key).replace(wb,"$&/")+"/")+e)),t.push(a)),1;if(d=0,i=i===""?".":i+":",vb(e))for(var f=0;f<e.length;f++){c=e[f];var g=i+G0(c,f);d+=Yp(c,t,r,g,a)}else if(g=h2(e),typeof g=="function")for(e=g.call(e),f=0;!(c=e.next()).done;)c=c.value,g=i+G0(c,f++),d+=Yp(c,t,r,g,a);else if(c==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return d}function gp(e,t,r){if(e==null)return e;var i=[],a=0;return Yp(e,i,"","",function(c){return t.call(r,c,a++)}),i}function x2(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ms={current:null},Jp={transition:null},b2={ReactCurrentDispatcher:Ms,ReactCurrentBatchConfig:Jp,ReactCurrentOwner:Hm};function Nv(){throw Error("act(...) is not supported in production builds of React.")}$n.Children={map:gp,forEach:function(e,t,r){gp(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return gp(e,function(){t++}),t},toArray:function(e){return gp(e,function(t){return t})||[]},only:function(e){if(!Wm(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};$n.Component=Ec;$n.Fragment=i2;$n.Profiler=a2;$n.PureComponent=Fm;$n.StrictMode=o2;$n.Suspense=u2;$n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=b2;$n.act=Nv;$n.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=yv({},e.props),a=e.key,c=e.ref,d=e._owner;if(t!=null){if(t.ref!==void 0&&(c=t.ref,d=Hm.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var f=e.type.defaultProps;for(g in t)zv.call(t,g)&&!kv.hasOwnProperty(g)&&(i[g]=t[g]===void 0&&f!==void 0?f[g]:t[g])}var g=arguments.length-2;if(g===1)i.children=r;else if(1<g){f=Array(g);for(var z=0;z<g;z++)f[z]=arguments[z+2];i.children=f}return{$$typeof:xu,type:e.type,key:a,ref:c,props:i,_owner:d}};$n.createContext=function(e){return e={$$typeof:c2,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:l2,_context:e},e.Consumer=e};$n.createElement=jv;$n.createFactory=function(e){var t=jv.bind(null,e);return t.type=e,t};$n.createRef=function(){return{current:null}};$n.forwardRef=function(e){return{$$typeof:d2,render:e}};$n.isValidElement=Wm;$n.lazy=function(e){return{$$typeof:f2,_payload:{_status:-1,_result:e},_init:x2}};$n.memo=function(e,t){return{$$typeof:p2,type:e,compare:t===void 0?null:t}};$n.startTransition=function(e){var t=Jp.transition;Jp.transition={};try{e()}finally{Jp.transition=t}};$n.unstable_act=Nv;$n.useCallback=function(e,t){return Ms.current.useCallback(e,t)};$n.useContext=function(e){return Ms.current.useContext(e)};$n.useDebugValue=function(){};$n.useDeferredValue=function(e){return Ms.current.useDeferredValue(e)};$n.useEffect=function(e,t){return Ms.current.useEffect(e,t)};$n.useId=function(){return Ms.current.useId()};$n.useImperativeHandle=function(e,t,r){return Ms.current.useImperativeHandle(e,t,r)};$n.useInsertionEffect=function(e,t){return Ms.current.useInsertionEffect(e,t)};$n.useLayoutEffect=function(e,t){return Ms.current.useLayoutEffect(e,t)};$n.useMemo=function(e,t){return Ms.current.useMemo(e,t)};$n.useReducer=function(e,t,r){return Ms.current.useReducer(e,t,r)};$n.useRef=function(e){return Ms.current.useRef(e)};$n.useState=function(e){return Ms.current.useState(e)};$n.useSyncExternalStore=function(e,t,r){return Ms.current.useSyncExternalStore(e,t,r)};$n.useTransition=function(){return Ms.current.useTransition()};$n.version="18.3.1";xv.exports=$n;var M=xv.exports;const Df=mv(M);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var y2=M,v2=Symbol.for("react.element"),w2=Symbol.for("react.fragment"),z2=Object.prototype.hasOwnProperty,k2=y2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,j2={key:!0,ref:!0,__self:!0,__source:!0};function _v(e,t,r){var i,a={},c=null,d=null;r!==void 0&&(c=""+r),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(d=t.ref);for(i in t)z2.call(t,i)&&!j2.hasOwnProperty(i)&&(a[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)a[i]===void 0&&(a[i]=t[i]);return{$$typeof:v2,type:e,key:c,ref:d,props:a,_owner:k2.current}}Rf.Fragment=w2;Rf.jsx=_v;Rf.jsxs=_v;gv.exports=Rf;var s=gv.exports,Dh={},Sv={exports:{}},pi={},Cv={exports:{}},Ev={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(ke,he){var Oe=ke.length;ke.push(he);e:for(;0<Oe;){var ae=Oe-1>>>1,fe=ke[ae];if(0<a(fe,he))ke[ae]=he,ke[Oe]=fe,Oe=ae;else break e}}function r(ke){return ke.length===0?null:ke[0]}function i(ke){if(ke.length===0)return null;var he=ke[0],Oe=ke.pop();if(Oe!==he){ke[0]=Oe;e:for(var ae=0,fe=ke.length,ut=fe>>>1;ae<ut;){var ot=2*(ae+1)-1,Ue=ke[ot],Xe=ot+1,en=ke[Xe];if(0>a(Ue,Oe))Xe<fe&&0>a(en,Ue)?(ke[ae]=en,ke[Xe]=Oe,ae=Xe):(ke[ae]=Ue,ke[ot]=Oe,ae=ot);else if(Xe<fe&&0>a(en,Oe))ke[ae]=en,ke[Xe]=Oe,ae=Xe;else break e}}return he}function a(ke,he){var Oe=ke.sortIndex-he.sortIndex;return Oe!==0?Oe:ke.id-he.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var d=Date,f=d.now();e.unstable_now=function(){return d.now()-f}}var g=[],z=[],$=1,T=null,I=3,N=!1,P=!1,_=!1,F=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(ke){for(var he=r(z);he!==null;){if(he.callback===null)i(z);else if(he.startTime<=ke)i(z),he.sortIndex=he.expirationTime,t(g,he);else break;he=r(z)}}function V(ke){if(_=!1,A(ke),!P)if(r(g)!==null)P=!0,Lt(G);else{var he=r(z);he!==null&&ye(V,he.startTime-ke)}}function G(ke,he){P=!1,_&&(_=!1,k(pe),pe=-1),N=!0;var Oe=I;try{for(A(he),T=r(g);T!==null&&(!(T.expirationTime>he)||ke&&!qe());){var ae=T.callback;if(typeof ae=="function"){T.callback=null,I=T.priorityLevel;var fe=ae(T.expirationTime<=he);he=e.unstable_now(),typeof fe=="function"?T.callback=fe:T===r(g)&&i(g),A(he)}else i(g);T=r(g)}if(T!==null)var ut=!0;else{var ot=r(z);ot!==null&&ye(V,ot.startTime-he),ut=!1}return ut}finally{T=null,I=Oe,N=!1}}var le=!1,re=null,pe=-1,be=5,Ie=-1;function qe(){return!(e.unstable_now()-Ie<be)}function Q(){if(re!==null){var ke=e.unstable_now();Ie=ke;var he=!0;try{he=re(!0,ke)}finally{he?_e():(le=!1,re=null)}}else le=!1}var _e;if(typeof S=="function")_e=function(){S(Q)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,Te=D.port2;D.port1.onmessage=Q,_e=function(){Te.postMessage(null)}}else _e=function(){F(Q,0)};function Lt(ke){re=ke,le||(le=!0,_e())}function ye(ke,he){pe=F(function(){ke(e.unstable_now())},he)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ke){ke.callback=null},e.unstable_continueExecution=function(){P||N||(P=!0,Lt(G))},e.unstable_forceFrameRate=function(ke){0>ke||125<ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):be=0<ke?Math.floor(1e3/ke):5},e.unstable_getCurrentPriorityLevel=function(){return I},e.unstable_getFirstCallbackNode=function(){return r(g)},e.unstable_next=function(ke){switch(I){case 1:case 2:case 3:var he=3;break;default:he=I}var Oe=I;I=he;try{return ke()}finally{I=Oe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ke,he){switch(ke){case 1:case 2:case 3:case 4:case 5:break;default:ke=3}var Oe=I;I=ke;try{return he()}finally{I=Oe}},e.unstable_scheduleCallback=function(ke,he,Oe){var ae=e.unstable_now();switch(typeof Oe=="object"&&Oe!==null?(Oe=Oe.delay,Oe=typeof Oe=="number"&&0<Oe?ae+Oe:ae):Oe=ae,ke){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=Oe+fe,ke={id:$++,callback:he,priorityLevel:ke,startTime:Oe,expirationTime:fe,sortIndex:-1},Oe>ae?(ke.sortIndex=Oe,t(z,ke),r(g)===null&&ke===r(z)&&(_?(k(pe),pe=-1):_=!0,ye(V,Oe-ae))):(ke.sortIndex=fe,t(g,ke),P||N||(P=!0,Lt(G))),ke},e.unstable_shouldYield=qe,e.unstable_wrapCallback=function(ke){var he=I;return function(){var Oe=I;I=he;try{return ke.apply(this,arguments)}finally{I=Oe}}}})(Ev);Cv.exports=Ev;var N2=Cv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _2=M,ui=N2;function Ye(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Iv=new Set,eu={};function bl(e,t){wc(e,t),wc(e+"Capture",t)}function wc(e,t){for(eu[e]=t,e=0;e<t.length;e++)Iv.add(t[e])}var Eo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Lh=Object.prototype.hasOwnProperty,S2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,zb={},kb={};function C2(e){return Lh.call(kb,e)?!0:Lh.call(zb,e)?!1:S2.test(e)?kb[e]=!0:(zb[e]=!0,!1)}function E2(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function I2(e,t,r,i){if(t===null||typeof t>"u"||E2(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ts(e,t,r,i,a,c,d){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=c,this.removeEmptyString=d}var ps={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ps[e]=new Ts(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ps[t]=new Ts(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ps[e]=new Ts(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ps[e]=new Ts(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ps[e]=new Ts(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ps[e]=new Ts(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ps[e]=new Ts(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ps[e]=new Ts(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ps[e]=new Ts(e,5,!1,e.toLowerCase(),null,!1,!1)});var Vm=/[\-:]([a-z])/g;function Km(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Vm,Km);ps[t]=new Ts(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Vm,Km);ps[t]=new Ts(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Vm,Km);ps[t]=new Ts(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ps[e]=new Ts(e,1,!1,e.toLowerCase(),null,!1,!1)});ps.xlinkHref=new Ts("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ps[e]=new Ts(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ym(e,t,r,i){var a=ps.hasOwnProperty(t)?ps[t]:null;(a!==null?a.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(I2(t,r,a,i)&&(r=null),i||a===null?C2(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,i=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var To=_2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xp=Symbol.for("react.element"),rc=Symbol.for("react.portal"),sc=Symbol.for("react.fragment"),Jm=Symbol.for("react.strict_mode"),Oh=Symbol.for("react.profiler"),$v=Symbol.for("react.provider"),Mv=Symbol.for("react.context"),Gm=Symbol.for("react.forward_ref"),Uh=Symbol.for("react.suspense"),Fh=Symbol.for("react.suspense_list"),Xm=Symbol.for("react.memo"),pa=Symbol.for("react.lazy"),Tv=Symbol.for("react.offscreen"),jb=Symbol.iterator;function gd(e){return e===null||typeof e!="object"?null:(e=jb&&e[jb]||e["@@iterator"],typeof e=="function"?e:null)}var Ir=Object.assign,X0;function Ad(e){if(X0===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);X0=t&&t[1]||""}return`
`+X0+e}var Z0=!1;function q0(e,t){if(!e||Z0)return"";Z0=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(z){var i=z}Reflect.construct(e,[],t)}else{try{t.call()}catch(z){i=z}e.call(t.prototype)}else{try{throw Error()}catch(z){i=z}e()}}catch(z){if(z&&i&&typeof z.stack=="string"){for(var a=z.stack.split(`
`),c=i.stack.split(`
`),d=a.length-1,f=c.length-1;1<=d&&0<=f&&a[d]!==c[f];)f--;for(;1<=d&&0<=f;d--,f--)if(a[d]!==c[f]){if(d!==1||f!==1)do if(d--,f--,0>f||a[d]!==c[f]){var g=`
`+a[d].replace(" at new "," at ");return e.displayName&&g.includes("<anonymous>")&&(g=g.replace("<anonymous>",e.displayName)),g}while(1<=d&&0<=f);break}}}finally{Z0=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?Ad(e):""}function $2(e){switch(e.tag){case 5:return Ad(e.type);case 16:return Ad("Lazy");case 13:return Ad("Suspense");case 19:return Ad("SuspenseList");case 0:case 2:case 15:return e=q0(e.type,!1),e;case 11:return e=q0(e.type.render,!1),e;case 1:return e=q0(e.type,!0),e;default:return""}}function Bh(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case sc:return"Fragment";case rc:return"Portal";case Oh:return"Profiler";case Jm:return"StrictMode";case Uh:return"Suspense";case Fh:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Mv:return(e.displayName||"Context")+".Consumer";case $v:return(e._context.displayName||"Context")+".Provider";case Gm:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Xm:return t=e.displayName||null,t!==null?t:Bh(e.type)||"Memo";case pa:t=e._payload,e=e._init;try{return Bh(e(t))}catch{}}return null}function M2(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Bh(t);case 8:return t===Jm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function _a(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Pv(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function T2(e){var t=Pv(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,c=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(d){i=""+d,c.call(this,d)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(d){i=""+d},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function bp(e){e._valueTracker||(e._valueTracker=T2(e))}function Av(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=Pv(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function af(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Hh(e,t){var r=t.checked;return Ir({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function Nb(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=_a(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Rv(e,t){t=t.checked,t!=null&&Ym(e,"checked",t,!1)}function Wh(e,t){Rv(e,t);var r=_a(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Vh(e,t.type,r):t.hasOwnProperty("defaultValue")&&Vh(e,t.type,_a(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function _b(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function Vh(e,t,r){(t!=="number"||af(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Rd=Array.isArray;function mc(e,t,r,i){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&i&&(e[r].defaultSelected=!0)}else{for(r=""+_a(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,i&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Kh(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Ye(91));return Ir({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Sb(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Ye(92));if(Rd(r)){if(1<r.length)throw Error(Ye(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:_a(r)}}function Dv(e,t){var r=_a(t.value),i=_a(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function Cb(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Lv(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yh(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Lv(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var yp,Ov=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(yp=yp||document.createElement("div"),yp.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=yp.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function tu(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Fd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},P2=["Webkit","ms","Moz","O"];Object.keys(Fd).forEach(function(e){P2.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Fd[t]=Fd[e]})});function Uv(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Fd.hasOwnProperty(e)&&Fd[e]?(""+t).trim():t+"px"}function Fv(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,a=Uv(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,a):e[r]=a}}var A2=Ir({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jh(e,t){if(t){if(A2[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Ye(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Ye(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Ye(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Ye(62))}}function Gh(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xh=null;function Zm(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Zh=null,gc=null,xc=null;function Eb(e){if(e=vu(e)){if(typeof Zh!="function")throw Error(Ye(280));var t=e.stateNode;t&&(t=Bf(t),Zh(e.stateNode,e.type,t))}}function Bv(e){gc?xc?xc.push(e):xc=[e]:gc=e}function Hv(){if(gc){var e=gc,t=xc;if(xc=gc=null,Eb(e),t)for(e=0;e<t.length;e++)Eb(t[e])}}function Wv(e,t){return e(t)}function Vv(){}var Q0=!1;function Kv(e,t,r){if(Q0)return e(t,r);Q0=!0;try{return Wv(e,t,r)}finally{Q0=!1,(gc!==null||xc!==null)&&(Vv(),Hv())}}function nu(e,t){var r=e.stateNode;if(r===null)return null;var i=Bf(r);if(i===null)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Ye(231,t,typeof r));return r}var qh=!1;if(Eo)try{var xd={};Object.defineProperty(xd,"passive",{get:function(){qh=!0}}),window.addEventListener("test",xd,xd),window.removeEventListener("test",xd,xd)}catch{qh=!1}function R2(e,t,r,i,a,c,d,f,g){var z=Array.prototype.slice.call(arguments,3);try{t.apply(r,z)}catch($){this.onError($)}}var Bd=!1,lf=null,cf=!1,Qh=null,D2={onError:function(e){Bd=!0,lf=e}};function L2(e,t,r,i,a,c,d,f,g){Bd=!1,lf=null,R2.apply(D2,arguments)}function O2(e,t,r,i,a,c,d,f,g){if(L2.apply(this,arguments),Bd){if(Bd){var z=lf;Bd=!1,lf=null}else throw Error(Ye(198));cf||(cf=!0,Qh=z)}}function yl(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Yv(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Ib(e){if(yl(e)!==e)throw Error(Ye(188))}function U2(e){var t=e.alternate;if(!t){if(t=yl(e),t===null)throw Error(Ye(188));return t!==e?null:e}for(var r=e,i=t;;){var a=r.return;if(a===null)break;var c=a.alternate;if(c===null){if(i=a.return,i!==null){r=i;continue}break}if(a.child===c.child){for(c=a.child;c;){if(c===r)return Ib(a),e;if(c===i)return Ib(a),t;c=c.sibling}throw Error(Ye(188))}if(r.return!==i.return)r=a,i=c;else{for(var d=!1,f=a.child;f;){if(f===r){d=!0,r=a,i=c;break}if(f===i){d=!0,i=a,r=c;break}f=f.sibling}if(!d){for(f=c.child;f;){if(f===r){d=!0,r=c,i=a;break}if(f===i){d=!0,i=c,r=a;break}f=f.sibling}if(!d)throw Error(Ye(189))}}if(r.alternate!==i)throw Error(Ye(190))}if(r.tag!==3)throw Error(Ye(188));return r.stateNode.current===r?e:t}function Jv(e){return e=U2(e),e!==null?Gv(e):null}function Gv(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Gv(e);if(t!==null)return t;e=e.sibling}return null}var Xv=ui.unstable_scheduleCallback,$b=ui.unstable_cancelCallback,F2=ui.unstable_shouldYield,B2=ui.unstable_requestPaint,Or=ui.unstable_now,H2=ui.unstable_getCurrentPriorityLevel,qm=ui.unstable_ImmediatePriority,Zv=ui.unstable_UserBlockingPriority,df=ui.unstable_NormalPriority,W2=ui.unstable_LowPriority,qv=ui.unstable_IdlePriority,Lf=null,oo=null;function V2(e){if(oo&&typeof oo.onCommitFiberRoot=="function")try{oo.onCommitFiberRoot(Lf,e,void 0,(e.current.flags&128)===128)}catch{}}var Bi=Math.clz32?Math.clz32:J2,K2=Math.log,Y2=Math.LN2;function J2(e){return e>>>=0,e===0?32:31-(K2(e)/Y2|0)|0}var vp=64,wp=4194304;function Dd(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uf(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,a=e.suspendedLanes,c=e.pingedLanes,d=r&268435455;if(d!==0){var f=d&~a;f!==0?i=Dd(f):(c&=d,c!==0&&(i=Dd(c)))}else d=r&~a,d!==0?i=Dd(d):c!==0&&(i=Dd(c));if(i===0)return 0;if(t!==0&&t!==i&&!(t&a)&&(a=i&-i,c=t&-t,a>=c||a===16&&(c&4194240)!==0))return t;if(i&4&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-Bi(t),a=1<<r,i|=e[r],t&=~a;return i}function G2(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function X2(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,c=e.pendingLanes;0<c;){var d=31-Bi(c),f=1<<d,g=a[d];g===-1?(!(f&r)||f&i)&&(a[d]=G2(f,t)):g<=t&&(e.expiredLanes|=f),c&=~f}}function em(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Qv(){var e=vp;return vp<<=1,!(vp&4194240)&&(vp=64),e}function eh(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function bu(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Bi(t),e[t]=r}function Z2(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-Bi(r),c=1<<a;t[a]=0,i[a]=-1,e[a]=-1,r&=~c}}function Qm(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-Bi(r),a=1<<i;a&t|e[i]&t&&(e[i]|=t),r&=~a}}var Xn=0;function e1(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var t1,eg,n1,r1,s1,tm=!1,zp=[],ba=null,ya=null,va=null,ru=new Map,su=new Map,ha=[],q2="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mb(e,t){switch(e){case"focusin":case"focusout":ba=null;break;case"dragenter":case"dragleave":ya=null;break;case"mouseover":case"mouseout":va=null;break;case"pointerover":case"pointerout":ru.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":su.delete(t.pointerId)}}function bd(e,t,r,i,a,c){return e===null||e.nativeEvent!==c?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:c,targetContainers:[a]},t!==null&&(t=vu(t),t!==null&&eg(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function Q2(e,t,r,i,a){switch(t){case"focusin":return ba=bd(ba,e,t,r,i,a),!0;case"dragenter":return ya=bd(ya,e,t,r,i,a),!0;case"mouseover":return va=bd(va,e,t,r,i,a),!0;case"pointerover":var c=a.pointerId;return ru.set(c,bd(ru.get(c)||null,e,t,r,i,a)),!0;case"gotpointercapture":return c=a.pointerId,su.set(c,bd(su.get(c)||null,e,t,r,i,a)),!0}return!1}function i1(e){var t=il(e.target);if(t!==null){var r=yl(t);if(r!==null){if(t=r.tag,t===13){if(t=Yv(r),t!==null){e.blockedOn=t,s1(e.priority,function(){n1(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Gp(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=nm(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);Xh=i,r.target.dispatchEvent(i),Xh=null}else return t=vu(r),t!==null&&eg(t),e.blockedOn=r,!1;t.shift()}return!0}function Tb(e,t,r){Gp(e)&&r.delete(t)}function ej(){tm=!1,ba!==null&&Gp(ba)&&(ba=null),ya!==null&&Gp(ya)&&(ya=null),va!==null&&Gp(va)&&(va=null),ru.forEach(Tb),su.forEach(Tb)}function yd(e,t){e.blockedOn===t&&(e.blockedOn=null,tm||(tm=!0,ui.unstable_scheduleCallback(ui.unstable_NormalPriority,ej)))}function iu(e){function t(a){return yd(a,e)}if(0<zp.length){yd(zp[0],e);for(var r=1;r<zp.length;r++){var i=zp[r];i.blockedOn===e&&(i.blockedOn=null)}}for(ba!==null&&yd(ba,e),ya!==null&&yd(ya,e),va!==null&&yd(va,e),ru.forEach(t),su.forEach(t),r=0;r<ha.length;r++)i=ha[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<ha.length&&(r=ha[0],r.blockedOn===null);)i1(r),r.blockedOn===null&&ha.shift()}var bc=To.ReactCurrentBatchConfig,pf=!0;function tj(e,t,r,i){var a=Xn,c=bc.transition;bc.transition=null;try{Xn=1,tg(e,t,r,i)}finally{Xn=a,bc.transition=c}}function nj(e,t,r,i){var a=Xn,c=bc.transition;bc.transition=null;try{Xn=4,tg(e,t,r,i)}finally{Xn=a,bc.transition=c}}function tg(e,t,r,i){if(pf){var a=nm(e,t,r,i);if(a===null)dh(e,t,i,ff,r),Mb(e,i);else if(Q2(a,e,t,r,i))i.stopPropagation();else if(Mb(e,i),t&4&&-1<q2.indexOf(e)){for(;a!==null;){var c=vu(a);if(c!==null&&t1(c),c=nm(e,t,r,i),c===null&&dh(e,t,i,ff,r),c===a)break;a=c}a!==null&&i.stopPropagation()}else dh(e,t,i,null,r)}}var ff=null;function nm(e,t,r,i){if(ff=null,e=Zm(i),e=il(e),e!==null)if(t=yl(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Yv(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return ff=e,null}function o1(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(H2()){case qm:return 1;case Zv:return 4;case df:case W2:return 16;case qv:return 536870912;default:return 16}default:return 16}}var ga=null,ng=null,Xp=null;function a1(){if(Xp)return Xp;var e,t=ng,r=t.length,i,a="value"in ga?ga.value:ga.textContent,c=a.length;for(e=0;e<r&&t[e]===a[e];e++);var d=r-e;for(i=1;i<=d&&t[r-i]===a[c-i];i++);return Xp=a.slice(e,1<i?1-i:void 0)}function Zp(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function kp(){return!0}function Pb(){return!1}function fi(e){function t(r,i,a,c,d){this._reactName=r,this._targetInst=a,this.type=i,this.nativeEvent=c,this.target=d,this.currentTarget=null;for(var f in e)e.hasOwnProperty(f)&&(r=e[f],this[f]=r?r(c):c[f]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?kp:Pb,this.isPropagationStopped=Pb,this}return Ir(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=kp)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=kp)},persist:function(){},isPersistent:kp}),t}var Ic={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rg=fi(Ic),yu=Ir({},Ic,{view:0,detail:0}),rj=fi(yu),th,nh,vd,Of=Ir({},yu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sg,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==vd&&(vd&&e.type==="mousemove"?(th=e.screenX-vd.screenX,nh=e.screenY-vd.screenY):nh=th=0,vd=e),th)},movementY:function(e){return"movementY"in e?e.movementY:nh}}),Ab=fi(Of),sj=Ir({},Of,{dataTransfer:0}),ij=fi(sj),oj=Ir({},yu,{relatedTarget:0}),rh=fi(oj),aj=Ir({},Ic,{animationName:0,elapsedTime:0,pseudoElement:0}),lj=fi(aj),cj=Ir({},Ic,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),dj=fi(cj),uj=Ir({},Ic,{data:0}),Rb=fi(uj),pj={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fj={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},hj={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mj(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=hj[e])?!!t[e]:!1}function sg(){return mj}var gj=Ir({},yu,{key:function(e){if(e.key){var t=pj[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Zp(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?fj[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sg,charCode:function(e){return e.type==="keypress"?Zp(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Zp(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),xj=fi(gj),bj=Ir({},Of,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Db=fi(bj),yj=Ir({},yu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sg}),vj=fi(yj),wj=Ir({},Ic,{propertyName:0,elapsedTime:0,pseudoElement:0}),zj=fi(wj),kj=Ir({},Of,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),jj=fi(kj),Nj=[9,13,27,32],ig=Eo&&"CompositionEvent"in window,Hd=null;Eo&&"documentMode"in document&&(Hd=document.documentMode);var _j=Eo&&"TextEvent"in window&&!Hd,l1=Eo&&(!ig||Hd&&8<Hd&&11>=Hd),Lb=" ",Ob=!1;function c1(e,t){switch(e){case"keyup":return Nj.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function d1(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ic=!1;function Sj(e,t){switch(e){case"compositionend":return d1(t);case"keypress":return t.which!==32?null:(Ob=!0,Lb);case"textInput":return e=t.data,e===Lb&&Ob?null:e;default:return null}}function Cj(e,t){if(ic)return e==="compositionend"||!ig&&c1(e,t)?(e=a1(),Xp=ng=ga=null,ic=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return l1&&t.locale!=="ko"?null:t.data;default:return null}}var Ej={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ub(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Ej[e.type]:t==="textarea"}function u1(e,t,r,i){Bv(i),t=hf(t,"onChange"),0<t.length&&(r=new rg("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var Wd=null,ou=null;function Ij(e){z1(e,0)}function Uf(e){var t=lc(e);if(Av(t))return e}function $j(e,t){if(e==="change")return t}var p1=!1;if(Eo){var sh;if(Eo){var ih="oninput"in document;if(!ih){var Fb=document.createElement("div");Fb.setAttribute("oninput","return;"),ih=typeof Fb.oninput=="function"}sh=ih}else sh=!1;p1=sh&&(!document.documentMode||9<document.documentMode)}function Bb(){Wd&&(Wd.detachEvent("onpropertychange",f1),ou=Wd=null)}function f1(e){if(e.propertyName==="value"&&Uf(ou)){var t=[];u1(t,ou,e,Zm(e)),Kv(Ij,t)}}function Mj(e,t,r){e==="focusin"?(Bb(),Wd=t,ou=r,Wd.attachEvent("onpropertychange",f1)):e==="focusout"&&Bb()}function Tj(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return Uf(ou)}function Pj(e,t){if(e==="click")return Uf(t)}function Aj(e,t){if(e==="input"||e==="change")return Uf(t)}function Rj(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Wi=typeof Object.is=="function"?Object.is:Rj;function au(e,t){if(Wi(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var a=r[i];if(!Lh.call(t,a)||!Wi(e[a],t[a]))return!1}return!0}function Hb(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Wb(e,t){var r=Hb(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Hb(r)}}function h1(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?h1(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function m1(){for(var e=window,t=af();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=af(e.document)}return t}function og(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function Dj(e){var t=m1(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&h1(r.ownerDocument.documentElement,r)){if(i!==null&&og(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=r.textContent.length,c=Math.min(i.start,a);i=i.end===void 0?c:Math.min(i.end,a),!e.extend&&c>i&&(a=i,i=c,c=a),a=Wb(r,c);var d=Wb(r,i);a&&d&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==d.node||e.focusOffset!==d.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),c>i?(e.addRange(t),e.extend(d.node,d.offset)):(t.setEnd(d.node,d.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Lj=Eo&&"documentMode"in document&&11>=document.documentMode,oc=null,rm=null,Vd=null,sm=!1;function Vb(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;sm||oc==null||oc!==af(i)||(i=oc,"selectionStart"in i&&og(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),Vd&&au(Vd,i)||(Vd=i,i=hf(rm,"onSelect"),0<i.length&&(t=new rg("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=oc)))}function jp(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var ac={animationend:jp("Animation","AnimationEnd"),animationiteration:jp("Animation","AnimationIteration"),animationstart:jp("Animation","AnimationStart"),transitionend:jp("Transition","TransitionEnd")},oh={},g1={};Eo&&(g1=document.createElement("div").style,"AnimationEvent"in window||(delete ac.animationend.animation,delete ac.animationiteration.animation,delete ac.animationstart.animation),"TransitionEvent"in window||delete ac.transitionend.transition);function Ff(e){if(oh[e])return oh[e];if(!ac[e])return e;var t=ac[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in g1)return oh[e]=t[r];return e}var x1=Ff("animationend"),b1=Ff("animationiteration"),y1=Ff("animationstart"),v1=Ff("transitionend"),w1=new Map,Kb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ca(e,t){w1.set(e,t),bl(t,[e])}for(var ah=0;ah<Kb.length;ah++){var lh=Kb[ah],Oj=lh.toLowerCase(),Uj=lh[0].toUpperCase()+lh.slice(1);Ca(Oj,"on"+Uj)}Ca(x1,"onAnimationEnd");Ca(b1,"onAnimationIteration");Ca(y1,"onAnimationStart");Ca("dblclick","onDoubleClick");Ca("focusin","onFocus");Ca("focusout","onBlur");Ca(v1,"onTransitionEnd");wc("onMouseEnter",["mouseout","mouseover"]);wc("onMouseLeave",["mouseout","mouseover"]);wc("onPointerEnter",["pointerout","pointerover"]);wc("onPointerLeave",["pointerout","pointerover"]);bl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));bl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));bl("onBeforeInput",["compositionend","keypress","textInput","paste"]);bl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));bl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));bl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ld="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Fj=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ld));function Yb(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,O2(i,t,void 0,e),e.currentTarget=null}function z1(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],a=i.event;i=i.listeners;e:{var c=void 0;if(t)for(var d=i.length-1;0<=d;d--){var f=i[d],g=f.instance,z=f.currentTarget;if(f=f.listener,g!==c&&a.isPropagationStopped())break e;Yb(a,f,z),c=g}else for(d=0;d<i.length;d++){if(f=i[d],g=f.instance,z=f.currentTarget,f=f.listener,g!==c&&a.isPropagationStopped())break e;Yb(a,f,z),c=g}}}if(cf)throw e=Qh,cf=!1,Qh=null,e}function hr(e,t){var r=t[cm];r===void 0&&(r=t[cm]=new Set);var i=e+"__bubble";r.has(i)||(k1(t,e,2,!1),r.add(i))}function ch(e,t,r){var i=0;t&&(i|=4),k1(r,e,i,t)}var Np="_reactListening"+Math.random().toString(36).slice(2);function lu(e){if(!e[Np]){e[Np]=!0,Iv.forEach(function(r){r!=="selectionchange"&&(Fj.has(r)||ch(r,!1,e),ch(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Np]||(t[Np]=!0,ch("selectionchange",!1,t))}}function k1(e,t,r,i){switch(o1(t)){case 1:var a=tj;break;case 4:a=nj;break;default:a=tg}r=a.bind(null,t,r,e),a=void 0,!qh||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),i?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function dh(e,t,r,i,a){var c=i;if(!(t&1)&&!(t&2)&&i!==null)e:for(;;){if(i===null)return;var d=i.tag;if(d===3||d===4){var f=i.stateNode.containerInfo;if(f===a||f.nodeType===8&&f.parentNode===a)break;if(d===4)for(d=i.return;d!==null;){var g=d.tag;if((g===3||g===4)&&(g=d.stateNode.containerInfo,g===a||g.nodeType===8&&g.parentNode===a))return;d=d.return}for(;f!==null;){if(d=il(f),d===null)return;if(g=d.tag,g===5||g===6){i=c=d;continue e}f=f.parentNode}}i=i.return}Kv(function(){var z=c,$=Zm(r),T=[];e:{var I=w1.get(e);if(I!==void 0){var N=rg,P=e;switch(e){case"keypress":if(Zp(r)===0)break e;case"keydown":case"keyup":N=xj;break;case"focusin":P="focus",N=rh;break;case"focusout":P="blur",N=rh;break;case"beforeblur":case"afterblur":N=rh;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":N=Ab;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":N=ij;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":N=vj;break;case x1:case b1:case y1:N=lj;break;case v1:N=zj;break;case"scroll":N=rj;break;case"wheel":N=jj;break;case"copy":case"cut":case"paste":N=dj;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":N=Db}var _=(t&4)!==0,F=!_&&e==="scroll",k=_?I!==null?I+"Capture":null:I;_=[];for(var S=z,A;S!==null;){A=S;var V=A.stateNode;if(A.tag===5&&V!==null&&(A=V,k!==null&&(V=nu(S,k),V!=null&&_.push(cu(S,V,A)))),F)break;S=S.return}0<_.length&&(I=new N(I,P,null,r,$),T.push({event:I,listeners:_}))}}if(!(t&7)){e:{if(I=e==="mouseover"||e==="pointerover",N=e==="mouseout"||e==="pointerout",I&&r!==Xh&&(P=r.relatedTarget||r.fromElement)&&(il(P)||P[Io]))break e;if((N||I)&&(I=$.window===$?$:(I=$.ownerDocument)?I.defaultView||I.parentWindow:window,N?(P=r.relatedTarget||r.toElement,N=z,P=P?il(P):null,P!==null&&(F=yl(P),P!==F||P.tag!==5&&P.tag!==6)&&(P=null)):(N=null,P=z),N!==P)){if(_=Ab,V="onMouseLeave",k="onMouseEnter",S="mouse",(e==="pointerout"||e==="pointerover")&&(_=Db,V="onPointerLeave",k="onPointerEnter",S="pointer"),F=N==null?I:lc(N),A=P==null?I:lc(P),I=new _(V,S+"leave",N,r,$),I.target=F,I.relatedTarget=A,V=null,il($)===z&&(_=new _(k,S+"enter",P,r,$),_.target=A,_.relatedTarget=F,V=_),F=V,N&&P)t:{for(_=N,k=P,S=0,A=_;A;A=Xl(A))S++;for(A=0,V=k;V;V=Xl(V))A++;for(;0<S-A;)_=Xl(_),S--;for(;0<A-S;)k=Xl(k),A--;for(;S--;){if(_===k||k!==null&&_===k.alternate)break t;_=Xl(_),k=Xl(k)}_=null}else _=null;N!==null&&Jb(T,I,N,_,!1),P!==null&&F!==null&&Jb(T,F,P,_,!0)}}e:{if(I=z?lc(z):window,N=I.nodeName&&I.nodeName.toLowerCase(),N==="select"||N==="input"&&I.type==="file")var G=$j;else if(Ub(I))if(p1)G=Aj;else{G=Tj;var le=Mj}else(N=I.nodeName)&&N.toLowerCase()==="input"&&(I.type==="checkbox"||I.type==="radio")&&(G=Pj);if(G&&(G=G(e,z))){u1(T,G,r,$);break e}le&&le(e,I,z),e==="focusout"&&(le=I._wrapperState)&&le.controlled&&I.type==="number"&&Vh(I,"number",I.value)}switch(le=z?lc(z):window,e){case"focusin":(Ub(le)||le.contentEditable==="true")&&(oc=le,rm=z,Vd=null);break;case"focusout":Vd=rm=oc=null;break;case"mousedown":sm=!0;break;case"contextmenu":case"mouseup":case"dragend":sm=!1,Vb(T,r,$);break;case"selectionchange":if(Lj)break;case"keydown":case"keyup":Vb(T,r,$)}var re;if(ig)e:{switch(e){case"compositionstart":var pe="onCompositionStart";break e;case"compositionend":pe="onCompositionEnd";break e;case"compositionupdate":pe="onCompositionUpdate";break e}pe=void 0}else ic?c1(e,r)&&(pe="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(pe="onCompositionStart");pe&&(l1&&r.locale!=="ko"&&(ic||pe!=="onCompositionStart"?pe==="onCompositionEnd"&&ic&&(re=a1()):(ga=$,ng="value"in ga?ga.value:ga.textContent,ic=!0)),le=hf(z,pe),0<le.length&&(pe=new Rb(pe,e,null,r,$),T.push({event:pe,listeners:le}),re?pe.data=re:(re=d1(r),re!==null&&(pe.data=re)))),(re=_j?Sj(e,r):Cj(e,r))&&(z=hf(z,"onBeforeInput"),0<z.length&&($=new Rb("onBeforeInput","beforeinput",null,r,$),T.push({event:$,listeners:z}),$.data=re))}z1(T,t)})}function cu(e,t,r){return{instance:e,listener:t,currentTarget:r}}function hf(e,t){for(var r=t+"Capture",i=[];e!==null;){var a=e,c=a.stateNode;a.tag===5&&c!==null&&(a=c,c=nu(e,r),c!=null&&i.unshift(cu(e,c,a)),c=nu(e,t),c!=null&&i.push(cu(e,c,a))),e=e.return}return i}function Xl(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Jb(e,t,r,i,a){for(var c=t._reactName,d=[];r!==null&&r!==i;){var f=r,g=f.alternate,z=f.stateNode;if(g!==null&&g===i)break;f.tag===5&&z!==null&&(f=z,a?(g=nu(r,c),g!=null&&d.unshift(cu(r,g,f))):a||(g=nu(r,c),g!=null&&d.push(cu(r,g,f)))),r=r.return}d.length!==0&&e.push({event:t,listeners:d})}var Bj=/\r\n?/g,Hj=/\u0000|\uFFFD/g;function Gb(e){return(typeof e=="string"?e:""+e).replace(Bj,`
`).replace(Hj,"")}function _p(e,t,r){if(t=Gb(t),Gb(e)!==t&&r)throw Error(Ye(425))}function mf(){}var im=null,om=null;function am(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var lm=typeof setTimeout=="function"?setTimeout:void 0,Wj=typeof clearTimeout=="function"?clearTimeout:void 0,Xb=typeof Promise=="function"?Promise:void 0,Vj=typeof queueMicrotask=="function"?queueMicrotask:typeof Xb<"u"?function(e){return Xb.resolve(null).then(e).catch(Kj)}:lm;function Kj(e){setTimeout(function(){throw e})}function uh(e,t){var r=t,i=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(i===0){e.removeChild(a),iu(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=a}while(r);iu(t)}function wa(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Zb(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var $c=Math.random().toString(36).slice(2),ro="__reactFiber$"+$c,du="__reactProps$"+$c,Io="__reactContainer$"+$c,cm="__reactEvents$"+$c,Yj="__reactListeners$"+$c,Jj="__reactHandles$"+$c;function il(e){var t=e[ro];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Io]||r[ro]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Zb(e);e!==null;){if(r=e[ro])return r;e=Zb(e)}return t}e=r,r=e.parentNode}return null}function vu(e){return e=e[ro]||e[Io],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function lc(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Ye(33))}function Bf(e){return e[du]||null}var dm=[],cc=-1;function Ea(e){return{current:e}}function gr(e){0>cc||(e.current=dm[cc],dm[cc]=null,cc--)}function ur(e,t){cc++,dm[cc]=e.current,e.current=t}var Sa={},ys=Ea(Sa),Ys=Ea(!1),ul=Sa;function zc(e,t){var r=e.type.contextTypes;if(!r)return Sa;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var a={},c;for(c in r)a[c]=t[c];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Js(e){return e=e.childContextTypes,e!=null}function gf(){gr(Ys),gr(ys)}function qb(e,t,r){if(ys.current!==Sa)throw Error(Ye(168));ur(ys,t),ur(Ys,r)}function j1(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var a in i)if(!(a in t))throw Error(Ye(108,M2(e)||"Unknown",a));return Ir({},r,i)}function xf(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Sa,ul=ys.current,ur(ys,e),ur(Ys,Ys.current),!0}function Qb(e,t,r){var i=e.stateNode;if(!i)throw Error(Ye(169));r?(e=j1(e,t,ul),i.__reactInternalMemoizedMergedChildContext=e,gr(Ys),gr(ys),ur(ys,e)):gr(Ys),ur(Ys,r)}var jo=null,Hf=!1,ph=!1;function N1(e){jo===null?jo=[e]:jo.push(e)}function Gj(e){Hf=!0,N1(e)}function Ia(){if(!ph&&jo!==null){ph=!0;var e=0,t=Xn;try{var r=jo;for(Xn=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}jo=null,Hf=!1}catch(a){throw jo!==null&&(jo=jo.slice(e+1)),Xv(qm,Ia),a}finally{Xn=t,ph=!1}}return null}var dc=[],uc=0,bf=null,yf=0,vi=[],wi=0,pl=null,_o=1,So="";function tl(e,t){dc[uc++]=yf,dc[uc++]=bf,bf=e,yf=t}function _1(e,t,r){vi[wi++]=_o,vi[wi++]=So,vi[wi++]=pl,pl=e;var i=_o;e=So;var a=32-Bi(i)-1;i&=~(1<<a),r+=1;var c=32-Bi(t)+a;if(30<c){var d=a-a%5;c=(i&(1<<d)-1).toString(32),i>>=d,a-=d,_o=1<<32-Bi(t)+a|r<<a|i,So=c+e}else _o=1<<c|r<<a|i,So=e}function ag(e){e.return!==null&&(tl(e,1),_1(e,1,0))}function lg(e){for(;e===bf;)bf=dc[--uc],dc[uc]=null,yf=dc[--uc],dc[uc]=null;for(;e===pl;)pl=vi[--wi],vi[wi]=null,So=vi[--wi],vi[wi]=null,_o=vi[--wi],vi[wi]=null}var di=null,ci=null,wr=!1,Fi=null;function S1(e,t){var r=zi(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function ey(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,di=e,ci=wa(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,di=e,ci=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=pl!==null?{id:_o,overflow:So}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=zi(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,di=e,ci=null,!0):!1;default:return!1}}function um(e){return(e.mode&1)!==0&&(e.flags&128)===0}function pm(e){if(wr){var t=ci;if(t){var r=t;if(!ey(e,t)){if(um(e))throw Error(Ye(418));t=wa(r.nextSibling);var i=di;t&&ey(e,t)?S1(i,r):(e.flags=e.flags&-4097|2,wr=!1,di=e)}}else{if(um(e))throw Error(Ye(418));e.flags=e.flags&-4097|2,wr=!1,di=e}}}function ty(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;di=e}function Sp(e){if(e!==di)return!1;if(!wr)return ty(e),wr=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!am(e.type,e.memoizedProps)),t&&(t=ci)){if(um(e))throw C1(),Error(Ye(418));for(;t;)S1(e,t),t=wa(t.nextSibling)}if(ty(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Ye(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){ci=wa(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}ci=null}}else ci=di?wa(e.stateNode.nextSibling):null;return!0}function C1(){for(var e=ci;e;)e=wa(e.nextSibling)}function kc(){ci=di=null,wr=!1}function cg(e){Fi===null?Fi=[e]:Fi.push(e)}var Xj=To.ReactCurrentBatchConfig;function wd(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Ye(309));var i=r.stateNode}if(!i)throw Error(Ye(147,e));var a=i,c=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===c?t.ref:(t=function(d){var f=a.refs;d===null?delete f[c]:f[c]=d},t._stringRef=c,t)}if(typeof e!="string")throw Error(Ye(284));if(!r._owner)throw Error(Ye(290,e))}return e}function Cp(e,t){throw e=Object.prototype.toString.call(t),Error(Ye(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ny(e){var t=e._init;return t(e._payload)}function E1(e){function t(k,S){if(e){var A=k.deletions;A===null?(k.deletions=[S],k.flags|=16):A.push(S)}}function r(k,S){if(!e)return null;for(;S!==null;)t(k,S),S=S.sibling;return null}function i(k,S){for(k=new Map;S!==null;)S.key!==null?k.set(S.key,S):k.set(S.index,S),S=S.sibling;return k}function a(k,S){return k=Na(k,S),k.index=0,k.sibling=null,k}function c(k,S,A){return k.index=A,e?(A=k.alternate,A!==null?(A=A.index,A<S?(k.flags|=2,S):A):(k.flags|=2,S)):(k.flags|=1048576,S)}function d(k){return e&&k.alternate===null&&(k.flags|=2),k}function f(k,S,A,V){return S===null||S.tag!==6?(S=yh(A,k.mode,V),S.return=k,S):(S=a(S,A),S.return=k,S)}function g(k,S,A,V){var G=A.type;return G===sc?$(k,S,A.props.children,V,A.key):S!==null&&(S.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===pa&&ny(G)===S.type)?(V=a(S,A.props),V.ref=wd(k,S,A),V.return=k,V):(V=sf(A.type,A.key,A.props,null,k.mode,V),V.ref=wd(k,S,A),V.return=k,V)}function z(k,S,A,V){return S===null||S.tag!==4||S.stateNode.containerInfo!==A.containerInfo||S.stateNode.implementation!==A.implementation?(S=vh(A,k.mode,V),S.return=k,S):(S=a(S,A.children||[]),S.return=k,S)}function $(k,S,A,V,G){return S===null||S.tag!==7?(S=dl(A,k.mode,V,G),S.return=k,S):(S=a(S,A),S.return=k,S)}function T(k,S,A){if(typeof S=="string"&&S!==""||typeof S=="number")return S=yh(""+S,k.mode,A),S.return=k,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case xp:return A=sf(S.type,S.key,S.props,null,k.mode,A),A.ref=wd(k,null,S),A.return=k,A;case rc:return S=vh(S,k.mode,A),S.return=k,S;case pa:var V=S._init;return T(k,V(S._payload),A)}if(Rd(S)||gd(S))return S=dl(S,k.mode,A,null),S.return=k,S;Cp(k,S)}return null}function I(k,S,A,V){var G=S!==null?S.key:null;if(typeof A=="string"&&A!==""||typeof A=="number")return G!==null?null:f(k,S,""+A,V);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case xp:return A.key===G?g(k,S,A,V):null;case rc:return A.key===G?z(k,S,A,V):null;case pa:return G=A._init,I(k,S,G(A._payload),V)}if(Rd(A)||gd(A))return G!==null?null:$(k,S,A,V,null);Cp(k,A)}return null}function N(k,S,A,V,G){if(typeof V=="string"&&V!==""||typeof V=="number")return k=k.get(A)||null,f(S,k,""+V,G);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case xp:return k=k.get(V.key===null?A:V.key)||null,g(S,k,V,G);case rc:return k=k.get(V.key===null?A:V.key)||null,z(S,k,V,G);case pa:var le=V._init;return N(k,S,A,le(V._payload),G)}if(Rd(V)||gd(V))return k=k.get(A)||null,$(S,k,V,G,null);Cp(S,V)}return null}function P(k,S,A,V){for(var G=null,le=null,re=S,pe=S=0,be=null;re!==null&&pe<A.length;pe++){re.index>pe?(be=re,re=null):be=re.sibling;var Ie=I(k,re,A[pe],V);if(Ie===null){re===null&&(re=be);break}e&&re&&Ie.alternate===null&&t(k,re),S=c(Ie,S,pe),le===null?G=Ie:le.sibling=Ie,le=Ie,re=be}if(pe===A.length)return r(k,re),wr&&tl(k,pe),G;if(re===null){for(;pe<A.length;pe++)re=T(k,A[pe],V),re!==null&&(S=c(re,S,pe),le===null?G=re:le.sibling=re,le=re);return wr&&tl(k,pe),G}for(re=i(k,re);pe<A.length;pe++)be=N(re,k,pe,A[pe],V),be!==null&&(e&&be.alternate!==null&&re.delete(be.key===null?pe:be.key),S=c(be,S,pe),le===null?G=be:le.sibling=be,le=be);return e&&re.forEach(function(qe){return t(k,qe)}),wr&&tl(k,pe),G}function _(k,S,A,V){var G=gd(A);if(typeof G!="function")throw Error(Ye(150));if(A=G.call(A),A==null)throw Error(Ye(151));for(var le=G=null,re=S,pe=S=0,be=null,Ie=A.next();re!==null&&!Ie.done;pe++,Ie=A.next()){re.index>pe?(be=re,re=null):be=re.sibling;var qe=I(k,re,Ie.value,V);if(qe===null){re===null&&(re=be);break}e&&re&&qe.alternate===null&&t(k,re),S=c(qe,S,pe),le===null?G=qe:le.sibling=qe,le=qe,re=be}if(Ie.done)return r(k,re),wr&&tl(k,pe),G;if(re===null){for(;!Ie.done;pe++,Ie=A.next())Ie=T(k,Ie.value,V),Ie!==null&&(S=c(Ie,S,pe),le===null?G=Ie:le.sibling=Ie,le=Ie);return wr&&tl(k,pe),G}for(re=i(k,re);!Ie.done;pe++,Ie=A.next())Ie=N(re,k,pe,Ie.value,V),Ie!==null&&(e&&Ie.alternate!==null&&re.delete(Ie.key===null?pe:Ie.key),S=c(Ie,S,pe),le===null?G=Ie:le.sibling=Ie,le=Ie);return e&&re.forEach(function(Q){return t(k,Q)}),wr&&tl(k,pe),G}function F(k,S,A,V){if(typeof A=="object"&&A!==null&&A.type===sc&&A.key===null&&(A=A.props.children),typeof A=="object"&&A!==null){switch(A.$$typeof){case xp:e:{for(var G=A.key,le=S;le!==null;){if(le.key===G){if(G=A.type,G===sc){if(le.tag===7){r(k,le.sibling),S=a(le,A.props.children),S.return=k,k=S;break e}}else if(le.elementType===G||typeof G=="object"&&G!==null&&G.$$typeof===pa&&ny(G)===le.type){r(k,le.sibling),S=a(le,A.props),S.ref=wd(k,le,A),S.return=k,k=S;break e}r(k,le);break}else t(k,le);le=le.sibling}A.type===sc?(S=dl(A.props.children,k.mode,V,A.key),S.return=k,k=S):(V=sf(A.type,A.key,A.props,null,k.mode,V),V.ref=wd(k,S,A),V.return=k,k=V)}return d(k);case rc:e:{for(le=A.key;S!==null;){if(S.key===le)if(S.tag===4&&S.stateNode.containerInfo===A.containerInfo&&S.stateNode.implementation===A.implementation){r(k,S.sibling),S=a(S,A.children||[]),S.return=k,k=S;break e}else{r(k,S);break}else t(k,S);S=S.sibling}S=vh(A,k.mode,V),S.return=k,k=S}return d(k);case pa:return le=A._init,F(k,S,le(A._payload),V)}if(Rd(A))return P(k,S,A,V);if(gd(A))return _(k,S,A,V);Cp(k,A)}return typeof A=="string"&&A!==""||typeof A=="number"?(A=""+A,S!==null&&S.tag===6?(r(k,S.sibling),S=a(S,A),S.return=k,k=S):(r(k,S),S=yh(A,k.mode,V),S.return=k,k=S),d(k)):r(k,S)}return F}var jc=E1(!0),I1=E1(!1),vf=Ea(null),wf=null,pc=null,dg=null;function ug(){dg=pc=wf=null}function pg(e){var t=vf.current;gr(vf),e._currentValue=t}function fm(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function yc(e,t){wf=e,dg=pc=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ks=!0),e.firstContext=null)}function ji(e){var t=e._currentValue;if(dg!==e)if(e={context:e,memoizedValue:t,next:null},pc===null){if(wf===null)throw Error(Ye(308));pc=e,wf.dependencies={lanes:0,firstContext:e}}else pc=pc.next=e;return t}var ol=null;function fg(e){ol===null?ol=[e]:ol.push(e)}function $1(e,t,r,i){var a=t.interleaved;return a===null?(r.next=r,fg(t)):(r.next=a.next,a.next=r),t.interleaved=r,$o(e,i)}function $o(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var fa=!1;function hg(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function M1(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Co(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function za(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,Dn&2){var a=i.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),i.pending=t,$o(e,r)}return a=i.interleaved,a===null?(t.next=t,fg(i)):(t.next=a.next,a.next=t),i.interleaved=t,$o(e,r)}function qp(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,Qm(e,r)}}function ry(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var a=null,c=null;if(r=r.firstBaseUpdate,r!==null){do{var d={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};c===null?a=c=d:c=c.next=d,r=r.next}while(r!==null);c===null?a=c=t:c=c.next=t}else a=c=t;r={baseState:i.baseState,firstBaseUpdate:a,lastBaseUpdate:c,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function zf(e,t,r,i){var a=e.updateQueue;fa=!1;var c=a.firstBaseUpdate,d=a.lastBaseUpdate,f=a.shared.pending;if(f!==null){a.shared.pending=null;var g=f,z=g.next;g.next=null,d===null?c=z:d.next=z,d=g;var $=e.alternate;$!==null&&($=$.updateQueue,f=$.lastBaseUpdate,f!==d&&(f===null?$.firstBaseUpdate=z:f.next=z,$.lastBaseUpdate=g))}if(c!==null){var T=a.baseState;d=0,$=z=g=null,f=c;do{var I=f.lane,N=f.eventTime;if((i&I)===I){$!==null&&($=$.next={eventTime:N,lane:0,tag:f.tag,payload:f.payload,callback:f.callback,next:null});e:{var P=e,_=f;switch(I=t,N=r,_.tag){case 1:if(P=_.payload,typeof P=="function"){T=P.call(N,T,I);break e}T=P;break e;case 3:P.flags=P.flags&-65537|128;case 0:if(P=_.payload,I=typeof P=="function"?P.call(N,T,I):P,I==null)break e;T=Ir({},T,I);break e;case 2:fa=!0}}f.callback!==null&&f.lane!==0&&(e.flags|=64,I=a.effects,I===null?a.effects=[f]:I.push(f))}else N={eventTime:N,lane:I,tag:f.tag,payload:f.payload,callback:f.callback,next:null},$===null?(z=$=N,g=T):$=$.next=N,d|=I;if(f=f.next,f===null){if(f=a.shared.pending,f===null)break;I=f,f=I.next,I.next=null,a.lastBaseUpdate=I,a.shared.pending=null}}while(!0);if($===null&&(g=T),a.baseState=g,a.firstBaseUpdate=z,a.lastBaseUpdate=$,t=a.shared.interleaved,t!==null){a=t;do d|=a.lane,a=a.next;while(a!==t)}else c===null&&(a.shared.lanes=0);hl|=d,e.lanes=d,e.memoizedState=T}}function sy(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],a=i.callback;if(a!==null){if(i.callback=null,i=r,typeof a!="function")throw Error(Ye(191,a));a.call(i)}}}var wu={},ao=Ea(wu),uu=Ea(wu),pu=Ea(wu);function al(e){if(e===wu)throw Error(Ye(174));return e}function mg(e,t){switch(ur(pu,t),ur(uu,e),ur(ao,wu),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Yh(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Yh(t,e)}gr(ao),ur(ao,t)}function Nc(){gr(ao),gr(uu),gr(pu)}function T1(e){al(pu.current);var t=al(ao.current),r=Yh(t,e.type);t!==r&&(ur(uu,e),ur(ao,r))}function gg(e){uu.current===e&&(gr(ao),gr(uu))}var Cr=Ea(0);function kf(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var fh=[];function xg(){for(var e=0;e<fh.length;e++)fh[e]._workInProgressVersionPrimary=null;fh.length=0}var Qp=To.ReactCurrentDispatcher,hh=To.ReactCurrentBatchConfig,fl=0,Er=null,Yr=null,is=null,jf=!1,Kd=!1,fu=0,Zj=0;function gs(){throw Error(Ye(321))}function bg(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Wi(e[r],t[r]))return!1;return!0}function yg(e,t,r,i,a,c){if(fl=c,Er=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Qp.current=e===null||e.memoizedState===null?tN:nN,e=r(i,a),Kd){c=0;do{if(Kd=!1,fu=0,25<=c)throw Error(Ye(301));c+=1,is=Yr=null,t.updateQueue=null,Qp.current=rN,e=r(i,a)}while(Kd)}if(Qp.current=Nf,t=Yr!==null&&Yr.next!==null,fl=0,is=Yr=Er=null,jf=!1,t)throw Error(Ye(300));return e}function vg(){var e=fu!==0;return fu=0,e}function no(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return is===null?Er.memoizedState=is=e:is=is.next=e,is}function Ni(){if(Yr===null){var e=Er.alternate;e=e!==null?e.memoizedState:null}else e=Yr.next;var t=is===null?Er.memoizedState:is.next;if(t!==null)is=t,Yr=e;else{if(e===null)throw Error(Ye(310));Yr=e,e={memoizedState:Yr.memoizedState,baseState:Yr.baseState,baseQueue:Yr.baseQueue,queue:Yr.queue,next:null},is===null?Er.memoizedState=is=e:is=is.next=e}return is}function hu(e,t){return typeof t=="function"?t(e):t}function mh(e){var t=Ni(),r=t.queue;if(r===null)throw Error(Ye(311));r.lastRenderedReducer=e;var i=Yr,a=i.baseQueue,c=r.pending;if(c!==null){if(a!==null){var d=a.next;a.next=c.next,c.next=d}i.baseQueue=a=c,r.pending=null}if(a!==null){c=a.next,i=i.baseState;var f=d=null,g=null,z=c;do{var $=z.lane;if((fl&$)===$)g!==null&&(g=g.next={lane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),i=z.hasEagerState?z.eagerState:e(i,z.action);else{var T={lane:$,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null};g===null?(f=g=T,d=i):g=g.next=T,Er.lanes|=$,hl|=$}z=z.next}while(z!==null&&z!==c);g===null?d=i:g.next=f,Wi(i,t.memoizedState)||(Ks=!0),t.memoizedState=i,t.baseState=d,t.baseQueue=g,r.lastRenderedState=i}if(e=r.interleaved,e!==null){a=e;do c=a.lane,Er.lanes|=c,hl|=c,a=a.next;while(a!==e)}else a===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function gh(e){var t=Ni(),r=t.queue;if(r===null)throw Error(Ye(311));r.lastRenderedReducer=e;var i=r.dispatch,a=r.pending,c=t.memoizedState;if(a!==null){r.pending=null;var d=a=a.next;do c=e(c,d.action),d=d.next;while(d!==a);Wi(c,t.memoizedState)||(Ks=!0),t.memoizedState=c,t.baseQueue===null&&(t.baseState=c),r.lastRenderedState=c}return[c,i]}function P1(){}function A1(e,t){var r=Er,i=Ni(),a=t(),c=!Wi(i.memoizedState,a);if(c&&(i.memoizedState=a,Ks=!0),i=i.queue,wg(L1.bind(null,r,i,e),[e]),i.getSnapshot!==t||c||is!==null&&is.memoizedState.tag&1){if(r.flags|=2048,mu(9,D1.bind(null,r,i,a,t),void 0,null),os===null)throw Error(Ye(349));fl&30||R1(r,t,a)}return a}function R1(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=Er.updateQueue,t===null?(t={lastEffect:null,stores:null},Er.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function D1(e,t,r,i){t.value=r,t.getSnapshot=i,O1(t)&&U1(e)}function L1(e,t,r){return r(function(){O1(t)&&U1(e)})}function O1(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Wi(e,r)}catch{return!0}}function U1(e){var t=$o(e,1);t!==null&&Hi(t,e,1,-1)}function iy(e){var t=no();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:hu,lastRenderedState:e},t.queue=e,e=e.dispatch=eN.bind(null,Er,e),[t.memoizedState,e]}function mu(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=Er.updateQueue,t===null?(t={lastEffect:null,stores:null},Er.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function F1(){return Ni().memoizedState}function ef(e,t,r,i){var a=no();Er.flags|=e,a.memoizedState=mu(1|t,r,void 0,i===void 0?null:i)}function Wf(e,t,r,i){var a=Ni();i=i===void 0?null:i;var c=void 0;if(Yr!==null){var d=Yr.memoizedState;if(c=d.destroy,i!==null&&bg(i,d.deps)){a.memoizedState=mu(t,r,c,i);return}}Er.flags|=e,a.memoizedState=mu(1|t,r,c,i)}function oy(e,t){return ef(8390656,8,e,t)}function wg(e,t){return Wf(2048,8,e,t)}function B1(e,t){return Wf(4,2,e,t)}function H1(e,t){return Wf(4,4,e,t)}function W1(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function V1(e,t,r){return r=r!=null?r.concat([e]):null,Wf(4,4,W1.bind(null,t,e),r)}function zg(){}function K1(e,t){var r=Ni();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&bg(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function Y1(e,t){var r=Ni();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&bg(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function J1(e,t,r){return fl&21?(Wi(r,t)||(r=Qv(),Er.lanes|=r,hl|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ks=!0),e.memoizedState=r)}function qj(e,t){var r=Xn;Xn=r!==0&&4>r?r:4,e(!0);var i=hh.transition;hh.transition={};try{e(!1),t()}finally{Xn=r,hh.transition=i}}function G1(){return Ni().memoizedState}function Qj(e,t,r){var i=ja(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},X1(e))Z1(t,r);else if(r=$1(e,t,r,i),r!==null){var a=Es();Hi(r,e,i,a),q1(r,t,i)}}function eN(e,t,r){var i=ja(e),a={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(X1(e))Z1(t,a);else{var c=e.alternate;if(e.lanes===0&&(c===null||c.lanes===0)&&(c=t.lastRenderedReducer,c!==null))try{var d=t.lastRenderedState,f=c(d,r);if(a.hasEagerState=!0,a.eagerState=f,Wi(f,d)){var g=t.interleaved;g===null?(a.next=a,fg(t)):(a.next=g.next,g.next=a),t.interleaved=a;return}}catch{}finally{}r=$1(e,t,a,i),r!==null&&(a=Es(),Hi(r,e,i,a),q1(r,t,i))}}function X1(e){var t=e.alternate;return e===Er||t!==null&&t===Er}function Z1(e,t){Kd=jf=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function q1(e,t,r){if(r&4194240){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,Qm(e,r)}}var Nf={readContext:ji,useCallback:gs,useContext:gs,useEffect:gs,useImperativeHandle:gs,useInsertionEffect:gs,useLayoutEffect:gs,useMemo:gs,useReducer:gs,useRef:gs,useState:gs,useDebugValue:gs,useDeferredValue:gs,useTransition:gs,useMutableSource:gs,useSyncExternalStore:gs,useId:gs,unstable_isNewReconciler:!1},tN={readContext:ji,useCallback:function(e,t){return no().memoizedState=[e,t===void 0?null:t],e},useContext:ji,useEffect:oy,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,ef(4194308,4,W1.bind(null,t,e),r)},useLayoutEffect:function(e,t){return ef(4194308,4,e,t)},useInsertionEffect:function(e,t){return ef(4,2,e,t)},useMemo:function(e,t){var r=no();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=no();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=Qj.bind(null,Er,e),[i.memoizedState,e]},useRef:function(e){var t=no();return e={current:e},t.memoizedState=e},useState:iy,useDebugValue:zg,useDeferredValue:function(e){return no().memoizedState=e},useTransition:function(){var e=iy(!1),t=e[0];return e=qj.bind(null,e[1]),no().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=Er,a=no();if(wr){if(r===void 0)throw Error(Ye(407));r=r()}else{if(r=t(),os===null)throw Error(Ye(349));fl&30||R1(i,t,r)}a.memoizedState=r;var c={value:r,getSnapshot:t};return a.queue=c,oy(L1.bind(null,i,c,e),[e]),i.flags|=2048,mu(9,D1.bind(null,i,c,r,t),void 0,null),r},useId:function(){var e=no(),t=os.identifierPrefix;if(wr){var r=So,i=_o;r=(i&~(1<<32-Bi(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=fu++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=Zj++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},nN={readContext:ji,useCallback:K1,useContext:ji,useEffect:wg,useImperativeHandle:V1,useInsertionEffect:B1,useLayoutEffect:H1,useMemo:Y1,useReducer:mh,useRef:F1,useState:function(){return mh(hu)},useDebugValue:zg,useDeferredValue:function(e){var t=Ni();return J1(t,Yr.memoizedState,e)},useTransition:function(){var e=mh(hu)[0],t=Ni().memoizedState;return[e,t]},useMutableSource:P1,useSyncExternalStore:A1,useId:G1,unstable_isNewReconciler:!1},rN={readContext:ji,useCallback:K1,useContext:ji,useEffect:wg,useImperativeHandle:V1,useInsertionEffect:B1,useLayoutEffect:H1,useMemo:Y1,useReducer:gh,useRef:F1,useState:function(){return gh(hu)},useDebugValue:zg,useDeferredValue:function(e){var t=Ni();return Yr===null?t.memoizedState=e:J1(t,Yr.memoizedState,e)},useTransition:function(){var e=gh(hu)[0],t=Ni().memoizedState;return[e,t]},useMutableSource:P1,useSyncExternalStore:A1,useId:G1,unstable_isNewReconciler:!1};function Li(e,t){if(e&&e.defaultProps){t=Ir({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function hm(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:Ir({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Vf={isMounted:function(e){return(e=e._reactInternals)?yl(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=Es(),a=ja(e),c=Co(i,a);c.payload=t,r!=null&&(c.callback=r),t=za(e,c,a),t!==null&&(Hi(t,e,a,i),qp(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=Es(),a=ja(e),c=Co(i,a);c.tag=1,c.payload=t,r!=null&&(c.callback=r),t=za(e,c,a),t!==null&&(Hi(t,e,a,i),qp(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Es(),i=ja(e),a=Co(r,i);a.tag=2,t!=null&&(a.callback=t),t=za(e,a,i),t!==null&&(Hi(t,e,i,r),qp(t,e,i))}};function ay(e,t,r,i,a,c,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,c,d):t.prototype&&t.prototype.isPureReactComponent?!au(r,i)||!au(a,c):!0}function Q1(e,t,r){var i=!1,a=Sa,c=t.contextType;return typeof c=="object"&&c!==null?c=ji(c):(a=Js(t)?ul:ys.current,i=t.contextTypes,c=(i=i!=null)?zc(e,a):Sa),t=new t(r,c),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Vf,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=c),t}function ly(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&Vf.enqueueReplaceState(t,t.state,null)}function mm(e,t,r,i){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs={},hg(e);var c=t.contextType;typeof c=="object"&&c!==null?a.context=ji(c):(c=Js(t)?ul:ys.current,a.context=zc(e,c)),a.state=e.memoizedState,c=t.getDerivedStateFromProps,typeof c=="function"&&(hm(e,t,c,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Vf.enqueueReplaceState(a,a.state,null),zf(e,r,a,i),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function _c(e,t){try{var r="",i=t;do r+=$2(i),i=i.return;while(i);var a=r}catch(c){a=`
Error generating stack: `+c.message+`
`+c.stack}return{value:e,source:t,stack:a,digest:null}}function xh(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function gm(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var sN=typeof WeakMap=="function"?WeakMap:Map;function ew(e,t,r){r=Co(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){Sf||(Sf=!0,_m=i),gm(e,t)},r}function tw(e,t,r){r=Co(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var a=t.value;r.payload=function(){return i(a)},r.callback=function(){gm(e,t)}}var c=e.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(r.callback=function(){gm(e,t),typeof i!="function"&&(ka===null?ka=new Set([this]):ka.add(this));var d=t.stack;this.componentDidCatch(t.value,{componentStack:d!==null?d:""})}),r}function cy(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new sN;var a=new Set;i.set(t,a)}else a=i.get(t),a===void 0&&(a=new Set,i.set(t,a));a.has(r)||(a.add(r),e=bN.bind(null,e,t,r),t.then(e,e))}function dy(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function uy(e,t,r,i,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Co(-1,1),t.tag=2,za(r,t,1))),r.lanes|=1),e)}var iN=To.ReactCurrentOwner,Ks=!1;function Cs(e,t,r,i){t.child=e===null?I1(t,null,r,i):jc(t,e.child,r,i)}function py(e,t,r,i,a){r=r.render;var c=t.ref;return yc(t,a),i=yg(e,t,r,i,c,a),r=vg(),e!==null&&!Ks?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Mo(e,t,a)):(wr&&r&&ag(t),t.flags|=1,Cs(e,t,i,a),t.child)}function fy(e,t,r,i,a){if(e===null){var c=r.type;return typeof c=="function"&&!Ig(c)&&c.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=c,nw(e,t,c,i,a)):(e=sf(r.type,null,i,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(c=e.child,!(e.lanes&a)){var d=c.memoizedProps;if(r=r.compare,r=r!==null?r:au,r(d,i)&&e.ref===t.ref)return Mo(e,t,a)}return t.flags|=1,e=Na(c,i),e.ref=t.ref,e.return=t,t.child=e}function nw(e,t,r,i,a){if(e!==null){var c=e.memoizedProps;if(au(c,i)&&e.ref===t.ref)if(Ks=!1,t.pendingProps=i=c,(e.lanes&a)!==0)e.flags&131072&&(Ks=!0);else return t.lanes=e.lanes,Mo(e,t,a)}return xm(e,t,r,i,a)}function rw(e,t,r){var i=t.pendingProps,a=i.children,c=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},ur(hc,ai),ai|=r;else{if(!(r&1073741824))return e=c!==null?c.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,ur(hc,ai),ai|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=c!==null?c.baseLanes:r,ur(hc,ai),ai|=i}else c!==null?(i=c.baseLanes|r,t.memoizedState=null):i=r,ur(hc,ai),ai|=i;return Cs(e,t,a,r),t.child}function sw(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function xm(e,t,r,i,a){var c=Js(r)?ul:ys.current;return c=zc(t,c),yc(t,a),r=yg(e,t,r,i,c,a),i=vg(),e!==null&&!Ks?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Mo(e,t,a)):(wr&&i&&ag(t),t.flags|=1,Cs(e,t,r,a),t.child)}function hy(e,t,r,i,a){if(Js(r)){var c=!0;xf(t)}else c=!1;if(yc(t,a),t.stateNode===null)tf(e,t),Q1(t,r,i),mm(t,r,i,a),i=!0;else if(e===null){var d=t.stateNode,f=t.memoizedProps;d.props=f;var g=d.context,z=r.contextType;typeof z=="object"&&z!==null?z=ji(z):(z=Js(r)?ul:ys.current,z=zc(t,z));var $=r.getDerivedStateFromProps,T=typeof $=="function"||typeof d.getSnapshotBeforeUpdate=="function";T||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(f!==i||g!==z)&&ly(t,d,i,z),fa=!1;var I=t.memoizedState;d.state=I,zf(t,i,d,a),g=t.memoizedState,f!==i||I!==g||Ys.current||fa?(typeof $=="function"&&(hm(t,r,$,i),g=t.memoizedState),(f=fa||ay(t,r,f,i,I,g,z))?(T||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=g),d.props=i,d.state=g,d.context=z,i=f):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{d=t.stateNode,M1(e,t),f=t.memoizedProps,z=t.type===t.elementType?f:Li(t.type,f),d.props=z,T=t.pendingProps,I=d.context,g=r.contextType,typeof g=="object"&&g!==null?g=ji(g):(g=Js(r)?ul:ys.current,g=zc(t,g));var N=r.getDerivedStateFromProps;($=typeof N=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(f!==T||I!==g)&&ly(t,d,i,g),fa=!1,I=t.memoizedState,d.state=I,zf(t,i,d,a);var P=t.memoizedState;f!==T||I!==P||Ys.current||fa?(typeof N=="function"&&(hm(t,r,N,i),P=t.memoizedState),(z=fa||ay(t,r,z,i,I,P,g)||!1)?($||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(i,P,g),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(i,P,g)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||f===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=P),d.props=i,d.state=P,d.context=g,i=z):(typeof d.componentDidUpdate!="function"||f===e.memoizedProps&&I===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||f===e.memoizedProps&&I===e.memoizedState||(t.flags|=1024),i=!1)}return bm(e,t,r,i,c,a)}function bm(e,t,r,i,a,c){sw(e,t);var d=(t.flags&128)!==0;if(!i&&!d)return a&&Qb(t,r,!1),Mo(e,t,c);i=t.stateNode,iN.current=t;var f=d&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&d?(t.child=jc(t,e.child,null,c),t.child=jc(t,null,f,c)):Cs(e,t,f,c),t.memoizedState=i.state,a&&Qb(t,r,!0),t.child}function iw(e){var t=e.stateNode;t.pendingContext?qb(e,t.pendingContext,t.pendingContext!==t.context):t.context&&qb(e,t.context,!1),mg(e,t.containerInfo)}function my(e,t,r,i,a){return kc(),cg(a),t.flags|=256,Cs(e,t,r,i),t.child}var ym={dehydrated:null,treeContext:null,retryLane:0};function vm(e){return{baseLanes:e,cachePool:null,transitions:null}}function ow(e,t,r){var i=t.pendingProps,a=Cr.current,c=!1,d=(t.flags&128)!==0,f;if((f=d)||(f=e!==null&&e.memoizedState===null?!1:(a&2)!==0),f?(c=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),ur(Cr,a&1),e===null)return pm(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(d=i.children,e=i.fallback,c?(i=t.mode,c=t.child,d={mode:"hidden",children:d},!(i&1)&&c!==null?(c.childLanes=0,c.pendingProps=d):c=Jf(d,i,0,null),e=dl(e,i,r,null),c.return=t,e.return=t,c.sibling=e,t.child=c,t.child.memoizedState=vm(r),t.memoizedState=ym,e):kg(t,d));if(a=e.memoizedState,a!==null&&(f=a.dehydrated,f!==null))return oN(e,t,d,i,f,a,r);if(c){c=i.fallback,d=t.mode,a=e.child,f=a.sibling;var g={mode:"hidden",children:i.children};return!(d&1)&&t.child!==a?(i=t.child,i.childLanes=0,i.pendingProps=g,t.deletions=null):(i=Na(a,g),i.subtreeFlags=a.subtreeFlags&14680064),f!==null?c=Na(f,c):(c=dl(c,d,r,null),c.flags|=2),c.return=t,i.return=t,i.sibling=c,t.child=i,i=c,c=t.child,d=e.child.memoizedState,d=d===null?vm(r):{baseLanes:d.baseLanes|r,cachePool:null,transitions:d.transitions},c.memoizedState=d,c.childLanes=e.childLanes&~r,t.memoizedState=ym,i}return c=e.child,e=c.sibling,i=Na(c,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function kg(e,t){return t=Jf({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ep(e,t,r,i){return i!==null&&cg(i),jc(t,e.child,null,r),e=kg(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function oN(e,t,r,i,a,c,d){if(r)return t.flags&256?(t.flags&=-257,i=xh(Error(Ye(422))),Ep(e,t,d,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(c=i.fallback,a=t.mode,i=Jf({mode:"visible",children:i.children},a,0,null),c=dl(c,a,d,null),c.flags|=2,i.return=t,c.return=t,i.sibling=c,t.child=i,t.mode&1&&jc(t,e.child,null,d),t.child.memoizedState=vm(d),t.memoizedState=ym,c);if(!(t.mode&1))return Ep(e,t,d,null);if(a.data==="$!"){if(i=a.nextSibling&&a.nextSibling.dataset,i)var f=i.dgst;return i=f,c=Error(Ye(419)),i=xh(c,i,void 0),Ep(e,t,d,i)}if(f=(d&e.childLanes)!==0,Ks||f){if(i=os,i!==null){switch(d&-d){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(i.suspendedLanes|d)?0:a,a!==0&&a!==c.retryLane&&(c.retryLane=a,$o(e,a),Hi(i,e,a,-1))}return Eg(),i=xh(Error(Ye(421))),Ep(e,t,d,i)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=yN.bind(null,e),a._reactRetry=t,null):(e=c.treeContext,ci=wa(a.nextSibling),di=t,wr=!0,Fi=null,e!==null&&(vi[wi++]=_o,vi[wi++]=So,vi[wi++]=pl,_o=e.id,So=e.overflow,pl=t),t=kg(t,i.children),t.flags|=4096,t)}function gy(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),fm(e.return,t,r)}function bh(e,t,r,i,a){var c=e.memoizedState;c===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:a}:(c.isBackwards=t,c.rendering=null,c.renderingStartTime=0,c.last=i,c.tail=r,c.tailMode=a)}function aw(e,t,r){var i=t.pendingProps,a=i.revealOrder,c=i.tail;if(Cs(e,t,i.children,r),i=Cr.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&gy(e,r,t);else if(e.tag===19)gy(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(ur(Cr,i),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&kf(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),bh(t,!1,a,r,c);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&kf(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}bh(t,!0,r,null,c);break;case"together":bh(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function tf(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Mo(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),hl|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Ye(153));if(t.child!==null){for(e=t.child,r=Na(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Na(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function aN(e,t,r){switch(t.tag){case 3:iw(t),kc();break;case 5:T1(t);break;case 1:Js(t.type)&&xf(t);break;case 4:mg(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,a=t.memoizedProps.value;ur(vf,i._currentValue),i._currentValue=a;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(ur(Cr,Cr.current&1),t.flags|=128,null):r&t.child.childLanes?ow(e,t,r):(ur(Cr,Cr.current&1),e=Mo(e,t,r),e!==null?e.sibling:null);ur(Cr,Cr.current&1);break;case 19:if(i=(r&t.childLanes)!==0,e.flags&128){if(i)return aw(e,t,r);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),ur(Cr,Cr.current),i)break;return null;case 22:case 23:return t.lanes=0,rw(e,t,r)}return Mo(e,t,r)}var lw,wm,cw,dw;lw=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};wm=function(){};cw=function(e,t,r,i){var a=e.memoizedProps;if(a!==i){e=t.stateNode,al(ao.current);var c=null;switch(r){case"input":a=Hh(e,a),i=Hh(e,i),c=[];break;case"select":a=Ir({},a,{value:void 0}),i=Ir({},i,{value:void 0}),c=[];break;case"textarea":a=Kh(e,a),i=Kh(e,i),c=[];break;default:typeof a.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=mf)}Jh(r,i);var d;r=null;for(z in a)if(!i.hasOwnProperty(z)&&a.hasOwnProperty(z)&&a[z]!=null)if(z==="style"){var f=a[z];for(d in f)f.hasOwnProperty(d)&&(r||(r={}),r[d]="")}else z!=="dangerouslySetInnerHTML"&&z!=="children"&&z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(eu.hasOwnProperty(z)?c||(c=[]):(c=c||[]).push(z,null));for(z in i){var g=i[z];if(f=a!=null?a[z]:void 0,i.hasOwnProperty(z)&&g!==f&&(g!=null||f!=null))if(z==="style")if(f){for(d in f)!f.hasOwnProperty(d)||g&&g.hasOwnProperty(d)||(r||(r={}),r[d]="");for(d in g)g.hasOwnProperty(d)&&f[d]!==g[d]&&(r||(r={}),r[d]=g[d])}else r||(c||(c=[]),c.push(z,r)),r=g;else z==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,f=f?f.__html:void 0,g!=null&&f!==g&&(c=c||[]).push(z,g)):z==="children"?typeof g!="string"&&typeof g!="number"||(c=c||[]).push(z,""+g):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&(eu.hasOwnProperty(z)?(g!=null&&z==="onScroll"&&hr("scroll",e),c||f===g||(c=[])):(c=c||[]).push(z,g))}r&&(c=c||[]).push("style",r);var z=c;(t.updateQueue=z)&&(t.flags|=4)}};dw=function(e,t,r,i){r!==i&&(t.flags|=4)};function zd(e,t){if(!wr)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function xs(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var a=e.child;a!==null;)r|=a.lanes|a.childLanes,i|=a.subtreeFlags&14680064,i|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)r|=a.lanes|a.childLanes,i|=a.subtreeFlags,i|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function lN(e,t,r){var i=t.pendingProps;switch(lg(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return xs(t),null;case 1:return Js(t.type)&&gf(),xs(t),null;case 3:return i=t.stateNode,Nc(),gr(Ys),gr(ys),xg(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(Sp(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Fi!==null&&(Em(Fi),Fi=null))),wm(e,t),xs(t),null;case 5:gg(t);var a=al(pu.current);if(r=t.type,e!==null&&t.stateNode!=null)cw(e,t,r,i,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(Ye(166));return xs(t),null}if(e=al(ao.current),Sp(t)){i=t.stateNode,r=t.type;var c=t.memoizedProps;switch(i[ro]=t,i[du]=c,e=(t.mode&1)!==0,r){case"dialog":hr("cancel",i),hr("close",i);break;case"iframe":case"object":case"embed":hr("load",i);break;case"video":case"audio":for(a=0;a<Ld.length;a++)hr(Ld[a],i);break;case"source":hr("error",i);break;case"img":case"image":case"link":hr("error",i),hr("load",i);break;case"details":hr("toggle",i);break;case"input":Nb(i,c),hr("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!c.multiple},hr("invalid",i);break;case"textarea":Sb(i,c),hr("invalid",i)}Jh(r,c),a=null;for(var d in c)if(c.hasOwnProperty(d)){var f=c[d];d==="children"?typeof f=="string"?i.textContent!==f&&(c.suppressHydrationWarning!==!0&&_p(i.textContent,f,e),a=["children",f]):typeof f=="number"&&i.textContent!==""+f&&(c.suppressHydrationWarning!==!0&&_p(i.textContent,f,e),a=["children",""+f]):eu.hasOwnProperty(d)&&f!=null&&d==="onScroll"&&hr("scroll",i)}switch(r){case"input":bp(i),_b(i,c,!0);break;case"textarea":bp(i),Cb(i);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(i.onclick=mf)}i=a,t.updateQueue=i,i!==null&&(t.flags|=4)}else{d=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Lv(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=d.createElement(r,{is:i.is}):(e=d.createElement(r),r==="select"&&(d=e,i.multiple?d.multiple=!0:i.size&&(d.size=i.size))):e=d.createElementNS(e,r),e[ro]=t,e[du]=i,lw(e,t,!1,!1),t.stateNode=e;e:{switch(d=Gh(r,i),r){case"dialog":hr("cancel",e),hr("close",e),a=i;break;case"iframe":case"object":case"embed":hr("load",e),a=i;break;case"video":case"audio":for(a=0;a<Ld.length;a++)hr(Ld[a],e);a=i;break;case"source":hr("error",e),a=i;break;case"img":case"image":case"link":hr("error",e),hr("load",e),a=i;break;case"details":hr("toggle",e),a=i;break;case"input":Nb(e,i),a=Hh(e,i),hr("invalid",e);break;case"option":a=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},a=Ir({},i,{value:void 0}),hr("invalid",e);break;case"textarea":Sb(e,i),a=Kh(e,i),hr("invalid",e);break;default:a=i}Jh(r,a),f=a;for(c in f)if(f.hasOwnProperty(c)){var g=f[c];c==="style"?Fv(e,g):c==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,g!=null&&Ov(e,g)):c==="children"?typeof g=="string"?(r!=="textarea"||g!=="")&&tu(e,g):typeof g=="number"&&tu(e,""+g):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(eu.hasOwnProperty(c)?g!=null&&c==="onScroll"&&hr("scroll",e):g!=null&&Ym(e,c,g,d))}switch(r){case"input":bp(e),_b(e,i,!1);break;case"textarea":bp(e),Cb(e);break;case"option":i.value!=null&&e.setAttribute("value",""+_a(i.value));break;case"select":e.multiple=!!i.multiple,c=i.value,c!=null?mc(e,!!i.multiple,c,!1):i.defaultValue!=null&&mc(e,!!i.multiple,i.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=mf)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return xs(t),null;case 6:if(e&&t.stateNode!=null)dw(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(Ye(166));if(r=al(pu.current),al(ao.current),Sp(t)){if(i=t.stateNode,r=t.memoizedProps,i[ro]=t,(c=i.nodeValue!==r)&&(e=di,e!==null))switch(e.tag){case 3:_p(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&_p(i.nodeValue,r,(e.mode&1)!==0)}c&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[ro]=t,t.stateNode=i}return xs(t),null;case 13:if(gr(Cr),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(wr&&ci!==null&&t.mode&1&&!(t.flags&128))C1(),kc(),t.flags|=98560,c=!1;else if(c=Sp(t),i!==null&&i.dehydrated!==null){if(e===null){if(!c)throw Error(Ye(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(Ye(317));c[ro]=t}else kc(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;xs(t),c=!1}else Fi!==null&&(Em(Fi),Fi=null),c=!0;if(!c)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||Cr.current&1?Jr===0&&(Jr=3):Eg())),t.updateQueue!==null&&(t.flags|=4),xs(t),null);case 4:return Nc(),wm(e,t),e===null&&lu(t.stateNode.containerInfo),xs(t),null;case 10:return pg(t.type._context),xs(t),null;case 17:return Js(t.type)&&gf(),xs(t),null;case 19:if(gr(Cr),c=t.memoizedState,c===null)return xs(t),null;if(i=(t.flags&128)!==0,d=c.rendering,d===null)if(i)zd(c,!1);else{if(Jr!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(d=kf(e),d!==null){for(t.flags|=128,zd(c,!1),i=d.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)c=r,e=i,c.flags&=14680066,d=c.alternate,d===null?(c.childLanes=0,c.lanes=e,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=d.childLanes,c.lanes=d.lanes,c.child=d.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=d.memoizedProps,c.memoizedState=d.memoizedState,c.updateQueue=d.updateQueue,c.type=d.type,e=d.dependencies,c.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return ur(Cr,Cr.current&1|2),t.child}e=e.sibling}c.tail!==null&&Or()>Sc&&(t.flags|=128,i=!0,zd(c,!1),t.lanes=4194304)}else{if(!i)if(e=kf(d),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),zd(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!wr)return xs(t),null}else 2*Or()-c.renderingStartTime>Sc&&r!==1073741824&&(t.flags|=128,i=!0,zd(c,!1),t.lanes=4194304);c.isBackwards?(d.sibling=t.child,t.child=d):(r=c.last,r!==null?r.sibling=d:t.child=d,c.last=d)}return c.tail!==null?(t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=Or(),t.sibling=null,r=Cr.current,ur(Cr,i?r&1|2:r&1),t):(xs(t),null);case 22:case 23:return Cg(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?ai&1073741824&&(xs(t),t.subtreeFlags&6&&(t.flags|=8192)):xs(t),null;case 24:return null;case 25:return null}throw Error(Ye(156,t.tag))}function cN(e,t){switch(lg(t),t.tag){case 1:return Js(t.type)&&gf(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Nc(),gr(Ys),gr(ys),xg(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return gg(t),null;case 13:if(gr(Cr),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Ye(340));kc()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return gr(Cr),null;case 4:return Nc(),null;case 10:return pg(t.type._context),null;case 22:case 23:return Cg(),null;case 24:return null;default:return null}}var Ip=!1,bs=!1,dN=typeof WeakSet=="function"?WeakSet:Set,Tt=null;function fc(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){Ar(e,t,i)}else r.current=null}function zm(e,t,r){try{r()}catch(i){Ar(e,t,i)}}var xy=!1;function uN(e,t){if(im=pf,e=m1(),og(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var a=i.anchorOffset,c=i.focusNode;i=i.focusOffset;try{r.nodeType,c.nodeType}catch{r=null;break e}var d=0,f=-1,g=-1,z=0,$=0,T=e,I=null;t:for(;;){for(var N;T!==r||a!==0&&T.nodeType!==3||(f=d+a),T!==c||i!==0&&T.nodeType!==3||(g=d+i),T.nodeType===3&&(d+=T.nodeValue.length),(N=T.firstChild)!==null;)I=T,T=N;for(;;){if(T===e)break t;if(I===r&&++z===a&&(f=d),I===c&&++$===i&&(g=d),(N=T.nextSibling)!==null)break;T=I,I=T.parentNode}T=N}r=f===-1||g===-1?null:{start:f,end:g}}else r=null}r=r||{start:0,end:0}}else r=null;for(om={focusedElem:e,selectionRange:r},pf=!1,Tt=t;Tt!==null;)if(t=Tt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Tt=e;else for(;Tt!==null;){t=Tt;try{var P=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(P!==null){var _=P.memoizedProps,F=P.memoizedState,k=t.stateNode,S=k.getSnapshotBeforeUpdate(t.elementType===t.type?_:Li(t.type,_),F);k.__reactInternalSnapshotBeforeUpdate=S}break;case 3:var A=t.stateNode.containerInfo;A.nodeType===1?A.textContent="":A.nodeType===9&&A.documentElement&&A.removeChild(A.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ye(163))}}catch(V){Ar(t,t.return,V)}if(e=t.sibling,e!==null){e.return=t.return,Tt=e;break}Tt=t.return}return P=xy,xy=!1,P}function Yd(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var a=i=i.next;do{if((a.tag&e)===e){var c=a.destroy;a.destroy=void 0,c!==void 0&&zm(t,r,c)}a=a.next}while(a!==i)}}function Kf(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function km(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function uw(e){var t=e.alternate;t!==null&&(e.alternate=null,uw(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[ro],delete t[du],delete t[cm],delete t[Yj],delete t[Jj])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function pw(e){return e.tag===5||e.tag===3||e.tag===4}function by(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||pw(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function jm(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=mf));else if(i!==4&&(e=e.child,e!==null))for(jm(e,t,r),e=e.sibling;e!==null;)jm(e,t,r),e=e.sibling}function Nm(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for(Nm(e,t,r),e=e.sibling;e!==null;)Nm(e,t,r),e=e.sibling}var ds=null,Oi=!1;function da(e,t,r){for(r=r.child;r!==null;)fw(e,t,r),r=r.sibling}function fw(e,t,r){if(oo&&typeof oo.onCommitFiberUnmount=="function")try{oo.onCommitFiberUnmount(Lf,r)}catch{}switch(r.tag){case 5:bs||fc(r,t);case 6:var i=ds,a=Oi;ds=null,da(e,t,r),ds=i,Oi=a,ds!==null&&(Oi?(e=ds,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):ds.removeChild(r.stateNode));break;case 18:ds!==null&&(Oi?(e=ds,r=r.stateNode,e.nodeType===8?uh(e.parentNode,r):e.nodeType===1&&uh(e,r),iu(e)):uh(ds,r.stateNode));break;case 4:i=ds,a=Oi,ds=r.stateNode.containerInfo,Oi=!0,da(e,t,r),ds=i,Oi=a;break;case 0:case 11:case 14:case 15:if(!bs&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){a=i=i.next;do{var c=a,d=c.destroy;c=c.tag,d!==void 0&&(c&2||c&4)&&zm(r,t,d),a=a.next}while(a!==i)}da(e,t,r);break;case 1:if(!bs&&(fc(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(f){Ar(r,t,f)}da(e,t,r);break;case 21:da(e,t,r);break;case 22:r.mode&1?(bs=(i=bs)||r.memoizedState!==null,da(e,t,r),bs=i):da(e,t,r);break;default:da(e,t,r)}}function yy(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new dN),t.forEach(function(i){var a=vN.bind(null,e,i);r.has(i)||(r.add(i),i.then(a,a))})}}function Ai(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var a=r[i];try{var c=e,d=t,f=d;e:for(;f!==null;){switch(f.tag){case 5:ds=f.stateNode,Oi=!1;break e;case 3:ds=f.stateNode.containerInfo,Oi=!0;break e;case 4:ds=f.stateNode.containerInfo,Oi=!0;break e}f=f.return}if(ds===null)throw Error(Ye(160));fw(c,d,a),ds=null,Oi=!1;var g=a.alternate;g!==null&&(g.return=null),a.return=null}catch(z){Ar(a,t,z)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)hw(t,e),t=t.sibling}function hw(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Ai(t,e),eo(e),i&4){try{Yd(3,e,e.return),Kf(3,e)}catch(_){Ar(e,e.return,_)}try{Yd(5,e,e.return)}catch(_){Ar(e,e.return,_)}}break;case 1:Ai(t,e),eo(e),i&512&&r!==null&&fc(r,r.return);break;case 5:if(Ai(t,e),eo(e),i&512&&r!==null&&fc(r,r.return),e.flags&32){var a=e.stateNode;try{tu(a,"")}catch(_){Ar(e,e.return,_)}}if(i&4&&(a=e.stateNode,a!=null)){var c=e.memoizedProps,d=r!==null?r.memoizedProps:c,f=e.type,g=e.updateQueue;if(e.updateQueue=null,g!==null)try{f==="input"&&c.type==="radio"&&c.name!=null&&Rv(a,c),Gh(f,d);var z=Gh(f,c);for(d=0;d<g.length;d+=2){var $=g[d],T=g[d+1];$==="style"?Fv(a,T):$==="dangerouslySetInnerHTML"?Ov(a,T):$==="children"?tu(a,T):Ym(a,$,T,z)}switch(f){case"input":Wh(a,c);break;case"textarea":Dv(a,c);break;case"select":var I=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!c.multiple;var N=c.value;N!=null?mc(a,!!c.multiple,N,!1):I!==!!c.multiple&&(c.defaultValue!=null?mc(a,!!c.multiple,c.defaultValue,!0):mc(a,!!c.multiple,c.multiple?[]:"",!1))}a[du]=c}catch(_){Ar(e,e.return,_)}}break;case 6:if(Ai(t,e),eo(e),i&4){if(e.stateNode===null)throw Error(Ye(162));a=e.stateNode,c=e.memoizedProps;try{a.nodeValue=c}catch(_){Ar(e,e.return,_)}}break;case 3:if(Ai(t,e),eo(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{iu(t.containerInfo)}catch(_){Ar(e,e.return,_)}break;case 4:Ai(t,e),eo(e);break;case 13:Ai(t,e),eo(e),a=e.child,a.flags&8192&&(c=a.memoizedState!==null,a.stateNode.isHidden=c,!c||a.alternate!==null&&a.alternate.memoizedState!==null||(_g=Or())),i&4&&yy(e);break;case 22:if($=r!==null&&r.memoizedState!==null,e.mode&1?(bs=(z=bs)||$,Ai(t,e),bs=z):Ai(t,e),eo(e),i&8192){if(z=e.memoizedState!==null,(e.stateNode.isHidden=z)&&!$&&e.mode&1)for(Tt=e,$=e.child;$!==null;){for(T=Tt=$;Tt!==null;){switch(I=Tt,N=I.child,I.tag){case 0:case 11:case 14:case 15:Yd(4,I,I.return);break;case 1:fc(I,I.return);var P=I.stateNode;if(typeof P.componentWillUnmount=="function"){i=I,r=I.return;try{t=i,P.props=t.memoizedProps,P.state=t.memoizedState,P.componentWillUnmount()}catch(_){Ar(i,r,_)}}break;case 5:fc(I,I.return);break;case 22:if(I.memoizedState!==null){wy(T);continue}}N!==null?(N.return=I,Tt=N):wy(T)}$=$.sibling}e:for($=null,T=e;;){if(T.tag===5){if($===null){$=T;try{a=T.stateNode,z?(c=a.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(f=T.stateNode,g=T.memoizedProps.style,d=g!=null&&g.hasOwnProperty("display")?g.display:null,f.style.display=Uv("display",d))}catch(_){Ar(e,e.return,_)}}}else if(T.tag===6){if($===null)try{T.stateNode.nodeValue=z?"":T.memoizedProps}catch(_){Ar(e,e.return,_)}}else if((T.tag!==22&&T.tag!==23||T.memoizedState===null||T===e)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===e)break e;for(;T.sibling===null;){if(T.return===null||T.return===e)break e;$===T&&($=null),T=T.return}$===T&&($=null),T.sibling.return=T.return,T=T.sibling}}break;case 19:Ai(t,e),eo(e),i&4&&yy(e);break;case 21:break;default:Ai(t,e),eo(e)}}function eo(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(pw(r)){var i=r;break e}r=r.return}throw Error(Ye(160))}switch(i.tag){case 5:var a=i.stateNode;i.flags&32&&(tu(a,""),i.flags&=-33);var c=by(e);Nm(e,c,a);break;case 3:case 4:var d=i.stateNode.containerInfo,f=by(e);jm(e,f,d);break;default:throw Error(Ye(161))}}catch(g){Ar(e,e.return,g)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function pN(e,t,r){Tt=e,mw(e)}function mw(e,t,r){for(var i=(e.mode&1)!==0;Tt!==null;){var a=Tt,c=a.child;if(a.tag===22&&i){var d=a.memoizedState!==null||Ip;if(!d){var f=a.alternate,g=f!==null&&f.memoizedState!==null||bs;f=Ip;var z=bs;if(Ip=d,(bs=g)&&!z)for(Tt=a;Tt!==null;)d=Tt,g=d.child,d.tag===22&&d.memoizedState!==null?zy(a):g!==null?(g.return=d,Tt=g):zy(a);for(;c!==null;)Tt=c,mw(c),c=c.sibling;Tt=a,Ip=f,bs=z}vy(e)}else a.subtreeFlags&8772&&c!==null?(c.return=a,Tt=c):vy(e)}}function vy(e){for(;Tt!==null;){var t=Tt;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:bs||Kf(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!bs)if(r===null)i.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:Li(t.type,r.memoizedProps);i.componentDidUpdate(a,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var c=t.updateQueue;c!==null&&sy(t,c,i);break;case 3:var d=t.updateQueue;if(d!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}sy(t,d,r)}break;case 5:var f=t.stateNode;if(r===null&&t.flags&4){r=f;var g=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":g.autoFocus&&r.focus();break;case"img":g.src&&(r.src=g.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var z=t.alternate;if(z!==null){var $=z.memoizedState;if($!==null){var T=$.dehydrated;T!==null&&iu(T)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ye(163))}bs||t.flags&512&&km(t)}catch(I){Ar(t,t.return,I)}}if(t===e){Tt=null;break}if(r=t.sibling,r!==null){r.return=t.return,Tt=r;break}Tt=t.return}}function wy(e){for(;Tt!==null;){var t=Tt;if(t===e){Tt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Tt=r;break}Tt=t.return}}function zy(e){for(;Tt!==null;){var t=Tt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Kf(4,t)}catch(g){Ar(t,r,g)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var a=t.return;try{i.componentDidMount()}catch(g){Ar(t,a,g)}}var c=t.return;try{km(t)}catch(g){Ar(t,c,g)}break;case 5:var d=t.return;try{km(t)}catch(g){Ar(t,d,g)}}}catch(g){Ar(t,t.return,g)}if(t===e){Tt=null;break}var f=t.sibling;if(f!==null){f.return=t.return,Tt=f;break}Tt=t.return}}var fN=Math.ceil,_f=To.ReactCurrentDispatcher,jg=To.ReactCurrentOwner,ki=To.ReactCurrentBatchConfig,Dn=0,os=null,Br=null,us=0,ai=0,hc=Ea(0),Jr=0,gu=null,hl=0,Yf=0,Ng=0,Jd=null,Vs=null,_g=0,Sc=1/0,ko=null,Sf=!1,_m=null,ka=null,$p=!1,xa=null,Cf=0,Gd=0,Sm=null,nf=-1,rf=0;function Es(){return Dn&6?Or():nf!==-1?nf:nf=Or()}function ja(e){return e.mode&1?Dn&2&&us!==0?us&-us:Xj.transition!==null?(rf===0&&(rf=Qv()),rf):(e=Xn,e!==0||(e=window.event,e=e===void 0?16:o1(e.type)),e):1}function Hi(e,t,r,i){if(50<Gd)throw Gd=0,Sm=null,Error(Ye(185));bu(e,r,i),(!(Dn&2)||e!==os)&&(e===os&&(!(Dn&2)&&(Yf|=r),Jr===4&&ma(e,us)),Gs(e,i),r===1&&Dn===0&&!(t.mode&1)&&(Sc=Or()+500,Hf&&Ia()))}function Gs(e,t){var r=e.callbackNode;X2(e,t);var i=uf(e,e===os?us:0);if(i===0)r!==null&&$b(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&$b(r),t===1)e.tag===0?Gj(ky.bind(null,e)):N1(ky.bind(null,e)),Vj(function(){!(Dn&6)&&Ia()}),r=null;else{switch(e1(i)){case 1:r=qm;break;case 4:r=Zv;break;case 16:r=df;break;case 536870912:r=qv;break;default:r=df}r=kw(r,gw.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function gw(e,t){if(nf=-1,rf=0,Dn&6)throw Error(Ye(327));var r=e.callbackNode;if(vc()&&e.callbackNode!==r)return null;var i=uf(e,e===os?us:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=Ef(e,i);else{t=i;var a=Dn;Dn|=2;var c=bw();(os!==e||us!==t)&&(ko=null,Sc=Or()+500,cl(e,t));do try{gN();break}catch(f){xw(e,f)}while(!0);ug(),_f.current=c,Dn=a,Br!==null?t=0:(os=null,us=0,t=Jr)}if(t!==0){if(t===2&&(a=em(e),a!==0&&(i=a,t=Cm(e,a))),t===1)throw r=gu,cl(e,0),ma(e,i),Gs(e,Or()),r;if(t===6)ma(e,i);else{if(a=e.current.alternate,!(i&30)&&!hN(a)&&(t=Ef(e,i),t===2&&(c=em(e),c!==0&&(i=c,t=Cm(e,c))),t===1))throw r=gu,cl(e,0),ma(e,i),Gs(e,Or()),r;switch(e.finishedWork=a,e.finishedLanes=i,t){case 0:case 1:throw Error(Ye(345));case 2:nl(e,Vs,ko);break;case 3:if(ma(e,i),(i&130023424)===i&&(t=_g+500-Or(),10<t)){if(uf(e,0)!==0)break;if(a=e.suspendedLanes,(a&i)!==i){Es(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=lm(nl.bind(null,e,Vs,ko),t);break}nl(e,Vs,ko);break;case 4:if(ma(e,i),(i&4194240)===i)break;for(t=e.eventTimes,a=-1;0<i;){var d=31-Bi(i);c=1<<d,d=t[d],d>a&&(a=d),i&=~c}if(i=a,i=Or()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*fN(i/1960))-i,10<i){e.timeoutHandle=lm(nl.bind(null,e,Vs,ko),i);break}nl(e,Vs,ko);break;case 5:nl(e,Vs,ko);break;default:throw Error(Ye(329))}}}return Gs(e,Or()),e.callbackNode===r?gw.bind(null,e):null}function Cm(e,t){var r=Jd;return e.current.memoizedState.isDehydrated&&(cl(e,t).flags|=256),e=Ef(e,t),e!==2&&(t=Vs,Vs=r,t!==null&&Em(t)),e}function Em(e){Vs===null?Vs=e:Vs.push.apply(Vs,e)}function hN(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var a=r[i],c=a.getSnapshot;a=a.value;try{if(!Wi(c(),a))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function ma(e,t){for(t&=~Ng,t&=~Yf,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Bi(t),i=1<<r;e[r]=-1,t&=~i}}function ky(e){if(Dn&6)throw Error(Ye(327));vc();var t=uf(e,0);if(!(t&1))return Gs(e,Or()),null;var r=Ef(e,t);if(e.tag!==0&&r===2){var i=em(e);i!==0&&(t=i,r=Cm(e,i))}if(r===1)throw r=gu,cl(e,0),ma(e,t),Gs(e,Or()),r;if(r===6)throw Error(Ye(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,nl(e,Vs,ko),Gs(e,Or()),null}function Sg(e,t){var r=Dn;Dn|=1;try{return e(t)}finally{Dn=r,Dn===0&&(Sc=Or()+500,Hf&&Ia())}}function ml(e){xa!==null&&xa.tag===0&&!(Dn&6)&&vc();var t=Dn;Dn|=1;var r=ki.transition,i=Xn;try{if(ki.transition=null,Xn=1,e)return e()}finally{Xn=i,ki.transition=r,Dn=t,!(Dn&6)&&Ia()}}function Cg(){ai=hc.current,gr(hc)}function cl(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,Wj(r)),Br!==null)for(r=Br.return;r!==null;){var i=r;switch(lg(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&gf();break;case 3:Nc(),gr(Ys),gr(ys),xg();break;case 5:gg(i);break;case 4:Nc();break;case 13:gr(Cr);break;case 19:gr(Cr);break;case 10:pg(i.type._context);break;case 22:case 23:Cg()}r=r.return}if(os=e,Br=e=Na(e.current,null),us=ai=t,Jr=0,gu=null,Ng=Yf=hl=0,Vs=Jd=null,ol!==null){for(t=0;t<ol.length;t++)if(r=ol[t],i=r.interleaved,i!==null){r.interleaved=null;var a=i.next,c=r.pending;if(c!==null){var d=c.next;c.next=a,i.next=d}r.pending=i}ol=null}return e}function xw(e,t){do{var r=Br;try{if(ug(),Qp.current=Nf,jf){for(var i=Er.memoizedState;i!==null;){var a=i.queue;a!==null&&(a.pending=null),i=i.next}jf=!1}if(fl=0,is=Yr=Er=null,Kd=!1,fu=0,jg.current=null,r===null||r.return===null){Jr=1,gu=t,Br=null;break}e:{var c=e,d=r.return,f=r,g=t;if(t=us,f.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){var z=g,$=f,T=$.tag;if(!($.mode&1)&&(T===0||T===11||T===15)){var I=$.alternate;I?($.updateQueue=I.updateQueue,$.memoizedState=I.memoizedState,$.lanes=I.lanes):($.updateQueue=null,$.memoizedState=null)}var N=dy(d);if(N!==null){N.flags&=-257,uy(N,d,f,c,t),N.mode&1&&cy(c,z,t),t=N,g=z;var P=t.updateQueue;if(P===null){var _=new Set;_.add(g),t.updateQueue=_}else P.add(g);break e}else{if(!(t&1)){cy(c,z,t),Eg();break e}g=Error(Ye(426))}}else if(wr&&f.mode&1){var F=dy(d);if(F!==null){!(F.flags&65536)&&(F.flags|=256),uy(F,d,f,c,t),cg(_c(g,f));break e}}c=g=_c(g,f),Jr!==4&&(Jr=2),Jd===null?Jd=[c]:Jd.push(c),c=d;do{switch(c.tag){case 3:c.flags|=65536,t&=-t,c.lanes|=t;var k=ew(c,g,t);ry(c,k);break e;case 1:f=g;var S=c.type,A=c.stateNode;if(!(c.flags&128)&&(typeof S.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(ka===null||!ka.has(A)))){c.flags|=65536,t&=-t,c.lanes|=t;var V=tw(c,f,t);ry(c,V);break e}}c=c.return}while(c!==null)}vw(r)}catch(G){t=G,Br===r&&r!==null&&(Br=r=r.return);continue}break}while(!0)}function bw(){var e=_f.current;return _f.current=Nf,e===null?Nf:e}function Eg(){(Jr===0||Jr===3||Jr===2)&&(Jr=4),os===null||!(hl&268435455)&&!(Yf&268435455)||ma(os,us)}function Ef(e,t){var r=Dn;Dn|=2;var i=bw();(os!==e||us!==t)&&(ko=null,cl(e,t));do try{mN();break}catch(a){xw(e,a)}while(!0);if(ug(),Dn=r,_f.current=i,Br!==null)throw Error(Ye(261));return os=null,us=0,Jr}function mN(){for(;Br!==null;)yw(Br)}function gN(){for(;Br!==null&&!F2();)yw(Br)}function yw(e){var t=zw(e.alternate,e,ai);e.memoizedProps=e.pendingProps,t===null?vw(e):Br=t,jg.current=null}function vw(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=cN(r,t),r!==null){r.flags&=32767,Br=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Jr=6,Br=null;return}}else if(r=lN(r,t,ai),r!==null){Br=r;return}if(t=t.sibling,t!==null){Br=t;return}Br=t=e}while(t!==null);Jr===0&&(Jr=5)}function nl(e,t,r){var i=Xn,a=ki.transition;try{ki.transition=null,Xn=1,xN(e,t,r,i)}finally{ki.transition=a,Xn=i}return null}function xN(e,t,r,i){do vc();while(xa!==null);if(Dn&6)throw Error(Ye(327));r=e.finishedWork;var a=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Ye(177));e.callbackNode=null,e.callbackPriority=0;var c=r.lanes|r.childLanes;if(Z2(e,c),e===os&&(Br=os=null,us=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||$p||($p=!0,kw(df,function(){return vc(),null})),c=(r.flags&15990)!==0,r.subtreeFlags&15990||c){c=ki.transition,ki.transition=null;var d=Xn;Xn=1;var f=Dn;Dn|=4,jg.current=null,uN(e,r),hw(r,e),Dj(om),pf=!!im,om=im=null,e.current=r,pN(r),B2(),Dn=f,Xn=d,ki.transition=c}else e.current=r;if($p&&($p=!1,xa=e,Cf=a),c=e.pendingLanes,c===0&&(ka=null),V2(r.stateNode),Gs(e,Or()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],i(a.value,{componentStack:a.stack,digest:a.digest});if(Sf)throw Sf=!1,e=_m,_m=null,e;return Cf&1&&e.tag!==0&&vc(),c=e.pendingLanes,c&1?e===Sm?Gd++:(Gd=0,Sm=e):Gd=0,Ia(),null}function vc(){if(xa!==null){var e=e1(Cf),t=ki.transition,r=Xn;try{if(ki.transition=null,Xn=16>e?16:e,xa===null)var i=!1;else{if(e=xa,xa=null,Cf=0,Dn&6)throw Error(Ye(331));var a=Dn;for(Dn|=4,Tt=e.current;Tt!==null;){var c=Tt,d=c.child;if(Tt.flags&16){var f=c.deletions;if(f!==null){for(var g=0;g<f.length;g++){var z=f[g];for(Tt=z;Tt!==null;){var $=Tt;switch($.tag){case 0:case 11:case 15:Yd(8,$,c)}var T=$.child;if(T!==null)T.return=$,Tt=T;else for(;Tt!==null;){$=Tt;var I=$.sibling,N=$.return;if(uw($),$===z){Tt=null;break}if(I!==null){I.return=N,Tt=I;break}Tt=N}}}var P=c.alternate;if(P!==null){var _=P.child;if(_!==null){P.child=null;do{var F=_.sibling;_.sibling=null,_=F}while(_!==null)}}Tt=c}}if(c.subtreeFlags&2064&&d!==null)d.return=c,Tt=d;else e:for(;Tt!==null;){if(c=Tt,c.flags&2048)switch(c.tag){case 0:case 11:case 15:Yd(9,c,c.return)}var k=c.sibling;if(k!==null){k.return=c.return,Tt=k;break e}Tt=c.return}}var S=e.current;for(Tt=S;Tt!==null;){d=Tt;var A=d.child;if(d.subtreeFlags&2064&&A!==null)A.return=d,Tt=A;else e:for(d=S;Tt!==null;){if(f=Tt,f.flags&2048)try{switch(f.tag){case 0:case 11:case 15:Kf(9,f)}}catch(G){Ar(f,f.return,G)}if(f===d){Tt=null;break e}var V=f.sibling;if(V!==null){V.return=f.return,Tt=V;break e}Tt=f.return}}if(Dn=a,Ia(),oo&&typeof oo.onPostCommitFiberRoot=="function")try{oo.onPostCommitFiberRoot(Lf,e)}catch{}i=!0}return i}finally{Xn=r,ki.transition=t}}return!1}function jy(e,t,r){t=_c(r,t),t=ew(e,t,1),e=za(e,t,1),t=Es(),e!==null&&(bu(e,1,t),Gs(e,t))}function Ar(e,t,r){if(e.tag===3)jy(e,e,r);else for(;t!==null;){if(t.tag===3){jy(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(ka===null||!ka.has(i))){e=_c(r,e),e=tw(t,e,1),t=za(t,e,1),e=Es(),t!==null&&(bu(t,1,e),Gs(t,e));break}}t=t.return}}function bN(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=Es(),e.pingedLanes|=e.suspendedLanes&r,os===e&&(us&r)===r&&(Jr===4||Jr===3&&(us&130023424)===us&&500>Or()-_g?cl(e,0):Ng|=r),Gs(e,t)}function ww(e,t){t===0&&(e.mode&1?(t=wp,wp<<=1,!(wp&130023424)&&(wp=4194304)):t=1);var r=Es();e=$o(e,t),e!==null&&(bu(e,t,r),Gs(e,r))}function yN(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),ww(e,r)}function vN(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,a=e.memoizedState;a!==null&&(r=a.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(Ye(314))}i!==null&&i.delete(t),ww(e,r)}var zw;zw=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ys.current)Ks=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Ks=!1,aN(e,t,r);Ks=!!(e.flags&131072)}else Ks=!1,wr&&t.flags&1048576&&_1(t,yf,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;tf(e,t),e=t.pendingProps;var a=zc(t,ys.current);yc(t,r),a=yg(null,t,i,e,a,r);var c=vg();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Js(i)?(c=!0,xf(t)):c=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,hg(t),a.updater=Vf,t.stateNode=a,a._reactInternals=t,mm(t,i,e,r),t=bm(null,t,i,!0,c,r)):(t.tag=0,wr&&c&&ag(t),Cs(null,t,a,r),t=t.child),t;case 16:i=t.elementType;e:{switch(tf(e,t),e=t.pendingProps,a=i._init,i=a(i._payload),t.type=i,a=t.tag=zN(i),e=Li(i,e),a){case 0:t=xm(null,t,i,e,r);break e;case 1:t=hy(null,t,i,e,r);break e;case 11:t=py(null,t,i,e,r);break e;case 14:t=fy(null,t,i,Li(i.type,e),r);break e}throw Error(Ye(306,i,""))}return t;case 0:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:Li(i,a),xm(e,t,i,a,r);case 1:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:Li(i,a),hy(e,t,i,a,r);case 3:e:{if(iw(t),e===null)throw Error(Ye(387));i=t.pendingProps,c=t.memoizedState,a=c.element,M1(e,t),zf(t,i,null,r);var d=t.memoizedState;if(i=d.element,c.isDehydrated)if(c={element:i,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},t.updateQueue.baseState=c,t.memoizedState=c,t.flags&256){a=_c(Error(Ye(423)),t),t=my(e,t,i,r,a);break e}else if(i!==a){a=_c(Error(Ye(424)),t),t=my(e,t,i,r,a);break e}else for(ci=wa(t.stateNode.containerInfo.firstChild),di=t,wr=!0,Fi=null,r=I1(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(kc(),i===a){t=Mo(e,t,r);break e}Cs(e,t,i,r)}t=t.child}return t;case 5:return T1(t),e===null&&pm(t),i=t.type,a=t.pendingProps,c=e!==null?e.memoizedProps:null,d=a.children,am(i,a)?d=null:c!==null&&am(i,c)&&(t.flags|=32),sw(e,t),Cs(e,t,d,r),t.child;case 6:return e===null&&pm(t),null;case 13:return ow(e,t,r);case 4:return mg(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=jc(t,null,i,r):Cs(e,t,i,r),t.child;case 11:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:Li(i,a),py(e,t,i,a,r);case 7:return Cs(e,t,t.pendingProps,r),t.child;case 8:return Cs(e,t,t.pendingProps.children,r),t.child;case 12:return Cs(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,a=t.pendingProps,c=t.memoizedProps,d=a.value,ur(vf,i._currentValue),i._currentValue=d,c!==null)if(Wi(c.value,d)){if(c.children===a.children&&!Ys.current){t=Mo(e,t,r);break e}}else for(c=t.child,c!==null&&(c.return=t);c!==null;){var f=c.dependencies;if(f!==null){d=c.child;for(var g=f.firstContext;g!==null;){if(g.context===i){if(c.tag===1){g=Co(-1,r&-r),g.tag=2;var z=c.updateQueue;if(z!==null){z=z.shared;var $=z.pending;$===null?g.next=g:(g.next=$.next,$.next=g),z.pending=g}}c.lanes|=r,g=c.alternate,g!==null&&(g.lanes|=r),fm(c.return,r,t),f.lanes|=r;break}g=g.next}}else if(c.tag===10)d=c.type===t.type?null:c.child;else if(c.tag===18){if(d=c.return,d===null)throw Error(Ye(341));d.lanes|=r,f=d.alternate,f!==null&&(f.lanes|=r),fm(d,r,t),d=c.sibling}else d=c.child;if(d!==null)d.return=c;else for(d=c;d!==null;){if(d===t){d=null;break}if(c=d.sibling,c!==null){c.return=d.return,d=c;break}d=d.return}c=d}Cs(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,i=t.pendingProps.children,yc(t,r),a=ji(a),i=i(a),t.flags|=1,Cs(e,t,i,r),t.child;case 14:return i=t.type,a=Li(i,t.pendingProps),a=Li(i.type,a),fy(e,t,i,a,r);case 15:return nw(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,a=t.pendingProps,a=t.elementType===i?a:Li(i,a),tf(e,t),t.tag=1,Js(i)?(e=!0,xf(t)):e=!1,yc(t,r),Q1(t,i,a),mm(t,i,a,r),bm(null,t,i,!0,e,r);case 19:return aw(e,t,r);case 22:return rw(e,t,r)}throw Error(Ye(156,t.tag))};function kw(e,t){return Xv(e,t)}function wN(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zi(e,t,r,i){return new wN(e,t,r,i)}function Ig(e){return e=e.prototype,!(!e||!e.isReactComponent)}function zN(e){if(typeof e=="function")return Ig(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Gm)return 11;if(e===Xm)return 14}return 2}function Na(e,t){var r=e.alternate;return r===null?(r=zi(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function sf(e,t,r,i,a,c){var d=2;if(i=e,typeof e=="function")Ig(e)&&(d=1);else if(typeof e=="string")d=5;else e:switch(e){case sc:return dl(r.children,a,c,t);case Jm:d=8,a|=8;break;case Oh:return e=zi(12,r,t,a|2),e.elementType=Oh,e.lanes=c,e;case Uh:return e=zi(13,r,t,a),e.elementType=Uh,e.lanes=c,e;case Fh:return e=zi(19,r,t,a),e.elementType=Fh,e.lanes=c,e;case Tv:return Jf(r,a,c,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case $v:d=10;break e;case Mv:d=9;break e;case Gm:d=11;break e;case Xm:d=14;break e;case pa:d=16,i=null;break e}throw Error(Ye(130,e==null?e:typeof e,""))}return t=zi(d,r,t,a),t.elementType=e,t.type=i,t.lanes=c,t}function dl(e,t,r,i){return e=zi(7,e,i,t),e.lanes=r,e}function Jf(e,t,r,i){return e=zi(22,e,i,t),e.elementType=Tv,e.lanes=r,e.stateNode={isHidden:!1},e}function yh(e,t,r){return e=zi(6,e,null,t),e.lanes=r,e}function vh(e,t,r){return t=zi(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function kN(e,t,r,i,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eh(0),this.expirationTimes=eh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eh(0),this.identifierPrefix=i,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function $g(e,t,r,i,a,c,d,f,g){return e=new kN(e,t,r,f,g),t===1?(t=1,c===!0&&(t|=8)):t=0,c=zi(3,null,null,t),e.current=c,c.stateNode=e,c.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},hg(c),e}function jN(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:rc,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function jw(e){if(!e)return Sa;e=e._reactInternals;e:{if(yl(e)!==e||e.tag!==1)throw Error(Ye(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Js(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Ye(171))}if(e.tag===1){var r=e.type;if(Js(r))return j1(e,r,t)}return t}function Nw(e,t,r,i,a,c,d,f,g){return e=$g(r,i,!0,e,a,c,d,f,g),e.context=jw(null),r=e.current,i=Es(),a=ja(r),c=Co(i,a),c.callback=t??null,za(r,c,a),e.current.lanes=a,bu(e,a,i),Gs(e,i),e}function Gf(e,t,r,i){var a=t.current,c=Es(),d=ja(a);return r=jw(r),t.context===null?t.context=r:t.pendingContext=r,t=Co(c,d),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=za(a,t,d),e!==null&&(Hi(e,a,d,c),qp(e,a,d)),d}function If(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Ny(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Mg(e,t){Ny(e,t),(e=e.alternate)&&Ny(e,t)}function NN(){return null}var _w=typeof reportError=="function"?reportError:function(e){console.error(e)};function Tg(e){this._internalRoot=e}Xf.prototype.render=Tg.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Ye(409));Gf(e,t,null,null)};Xf.prototype.unmount=Tg.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;ml(function(){Gf(null,e,null,null)}),t[Io]=null}};function Xf(e){this._internalRoot=e}Xf.prototype.unstable_scheduleHydration=function(e){if(e){var t=r1();e={blockedOn:null,target:e,priority:t};for(var r=0;r<ha.length&&t!==0&&t<ha[r].priority;r++);ha.splice(r,0,e),r===0&&i1(e)}};function Pg(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Zf(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function _y(){}function _N(e,t,r,i,a){if(a){if(typeof i=="function"){var c=i;i=function(){var z=If(d);c.call(z)}}var d=Nw(t,i,e,0,null,!1,!1,"",_y);return e._reactRootContainer=d,e[Io]=d.current,lu(e.nodeType===8?e.parentNode:e),ml(),d}for(;a=e.lastChild;)e.removeChild(a);if(typeof i=="function"){var f=i;i=function(){var z=If(g);f.call(z)}}var g=$g(e,0,!1,null,null,!1,!1,"",_y);return e._reactRootContainer=g,e[Io]=g.current,lu(e.nodeType===8?e.parentNode:e),ml(function(){Gf(t,g,r,i)}),g}function qf(e,t,r,i,a){var c=r._reactRootContainer;if(c){var d=c;if(typeof a=="function"){var f=a;a=function(){var g=If(d);f.call(g)}}Gf(t,d,e,a)}else d=_N(r,t,e,a,i);return If(d)}t1=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Dd(t.pendingLanes);r!==0&&(Qm(t,r|1),Gs(t,Or()),!(Dn&6)&&(Sc=Or()+500,Ia()))}break;case 13:ml(function(){var i=$o(e,1);if(i!==null){var a=Es();Hi(i,e,1,a)}}),Mg(e,1)}};eg=function(e){if(e.tag===13){var t=$o(e,134217728);if(t!==null){var r=Es();Hi(t,e,134217728,r)}Mg(e,134217728)}};n1=function(e){if(e.tag===13){var t=ja(e),r=$o(e,t);if(r!==null){var i=Es();Hi(r,e,t,i)}Mg(e,t)}};r1=function(){return Xn};s1=function(e,t){var r=Xn;try{return Xn=e,t()}finally{Xn=r}};Zh=function(e,t,r){switch(t){case"input":if(Wh(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var a=Bf(i);if(!a)throw Error(Ye(90));Av(i),Wh(i,a)}}}break;case"textarea":Dv(e,r);break;case"select":t=r.value,t!=null&&mc(e,!!r.multiple,t,!1)}};Wv=Sg;Vv=ml;var SN={usingClientEntryPoint:!1,Events:[vu,lc,Bf,Bv,Hv,Sg]},kd={findFiberByHostInstance:il,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},CN={bundleType:kd.bundleType,version:kd.version,rendererPackageName:kd.rendererPackageName,rendererConfig:kd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:To.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Jv(e),e===null?null:e.stateNode},findFiberByHostInstance:kd.findFiberByHostInstance||NN,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mp.isDisabled&&Mp.supportsFiber)try{Lf=Mp.inject(CN),oo=Mp}catch{}}pi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SN;pi.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Pg(t))throw Error(Ye(200));return jN(e,t,null,r)};pi.createRoot=function(e,t){if(!Pg(e))throw Error(Ye(299));var r=!1,i="",a=_w;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=$g(e,1,!1,null,null,r,!1,i,a),e[Io]=t.current,lu(e.nodeType===8?e.parentNode:e),new Tg(t)};pi.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Ye(188)):(e=Object.keys(e).join(","),Error(Ye(268,e)));return e=Jv(t),e=e===null?null:e.stateNode,e};pi.flushSync=function(e){return ml(e)};pi.hydrate=function(e,t,r){if(!Zf(t))throw Error(Ye(200));return qf(null,e,t,!0,r)};pi.hydrateRoot=function(e,t,r){if(!Pg(e))throw Error(Ye(405));var i=r!=null&&r.hydratedSources||null,a=!1,c="",d=_w;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(c=r.identifierPrefix),r.onRecoverableError!==void 0&&(d=r.onRecoverableError)),t=Nw(t,null,e,1,r??null,a,!1,c,d),e[Io]=t.current,lu(e),i)for(e=0;e<i.length;e++)r=i[e],a=r._getVersion,a=a(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new Xf(t)};pi.render=function(e,t,r){if(!Zf(t))throw Error(Ye(200));return qf(null,e,t,!1,r)};pi.unmountComponentAtNode=function(e){if(!Zf(e))throw Error(Ye(40));return e._reactRootContainer?(ml(function(){qf(null,null,e,!1,function(){e._reactRootContainer=null,e[Io]=null})}),!0):!1};pi.unstable_batchedUpdates=Sg;pi.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!Zf(r))throw Error(Ye(200));if(e==null||e._reactInternals===void 0)throw Error(Ye(38));return qf(e,t,r,!1,i)};pi.version="18.3.1-next-f1338f8080-20240426";function Sw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Sw)}catch(e){console.error(e)}}Sw(),Sv.exports=pi;var $f=Sv.exports,Sy=$f;Dh.createRoot=Sy.createRoot,Dh.hydrateRoot=Sy.hydrateRoot;function Ag(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let vl=Ag();function Cw(e){vl=e}const Ew=/[&<>"']/,EN=new RegExp(Ew.source,"g"),Iw=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,IN=new RegExp(Iw.source,"g"),$N={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Cy=e=>$N[e];function li(e,t){if(t){if(Ew.test(e))return e.replace(EN,Cy)}else if(Iw.test(e))return e.replace(IN,Cy);return e}const MN=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function TN(e){return e.replace(MN,(t,r)=>(r=r.toLowerCase(),r==="colon"?":":r.charAt(0)==="#"?r.charAt(1)==="x"?String.fromCharCode(parseInt(r.substring(2),16)):String.fromCharCode(+r.substring(1)):""))}const PN=/(^|[^\[])\^/g;function sr(e,t){let r=typeof e=="string"?e:e.source;t=t||"";const i={replace:(a,c)=>{let d=typeof c=="string"?c:c.source;return d=d.replace(PN,"$1"),r=r.replace(a,d),i},getRegex:()=>new RegExp(r,t)};return i}function Ey(e){try{e=encodeURI(e).replace(/%25/g,"%")}catch{return null}return e}const Xd={exec:()=>null};function Iy(e,t){const r=e.replace(/\|/g,(c,d,f)=>{let g=!1,z=d;for(;--z>=0&&f[z]==="\\";)g=!g;return g?"|":" |"}),i=r.split(/ \|/);let a=0;if(i[0].trim()||i.shift(),i.length>0&&!i[i.length-1].trim()&&i.pop(),t)if(i.length>t)i.splice(t);else for(;i.length<t;)i.push("");for(;a<i.length;a++)i[a]=i[a].trim().replace(/\\\|/g,"|");return i}function Tp(e,t,r){const i=e.length;if(i===0)return"";let a=0;for(;a<i&&e.charAt(i-a-1)===t;)a++;return e.slice(0,i-a)}function AN(e,t){if(e.indexOf(t[1])===-1)return-1;let r=0;for(let i=0;i<e.length;i++)if(e[i]==="\\")i++;else if(e[i]===t[0])r++;else if(e[i]===t[1]&&(r--,r<0))return i;return-1}function $y(e,t,r,i){const a=t.href,c=t.title?li(t.title):null,d=e[1].replace(/\\([\[\]])/g,"$1");if(e[0].charAt(0)!=="!"){i.state.inLink=!0;const f={type:"link",raw:r,href:a,title:c,text:d,tokens:i.inlineTokens(d)};return i.state.inLink=!1,f}return{type:"image",raw:r,href:a,title:c,text:li(d)}}function RN(e,t){const r=e.match(/^(\s+)(?:```)/);if(r===null)return t;const i=r[1];return t.split(`
`).map(a=>{const c=a.match(/^\s+/);if(c===null)return a;const[d]=c;return d.length>=i.length?a.slice(i.length):a}).join(`
`)}class Mf{constructor(t){fr(this,"options");fr(this,"rules");fr(this,"lexer");this.options=t||vl}space(t){const r=this.rules.block.newline.exec(t);if(r&&r[0].length>0)return{type:"space",raw:r[0]}}code(t){const r=this.rules.block.code.exec(t);if(r){const i=r[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:r[0],codeBlockStyle:"indented",text:this.options.pedantic?i:Tp(i,`
`)}}}fences(t){const r=this.rules.block.fences.exec(t);if(r){const i=r[0],a=RN(i,r[3]||"");return{type:"code",raw:i,lang:r[2]?r[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):r[2],text:a}}}heading(t){const r=this.rules.block.heading.exec(t);if(r){let i=r[2].trim();if(/#$/.test(i)){const a=Tp(i,"#");(this.options.pedantic||!a||/ $/.test(a))&&(i=a.trim())}return{type:"heading",raw:r[0],depth:r[1].length,text:i,tokens:this.lexer.inline(i)}}}hr(t){const r=this.rules.block.hr.exec(t);if(r)return{type:"hr",raw:r[0]}}blockquote(t){const r=this.rules.block.blockquote.exec(t);if(r){let i=r[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);i=Tp(i.replace(/^ *>[ \t]?/gm,""),`
`);const a=this.lexer.state.top;this.lexer.state.top=!0;const c=this.lexer.blockTokens(i);return this.lexer.state.top=a,{type:"blockquote",raw:r[0],tokens:c,text:i}}}list(t){let r=this.rules.block.list.exec(t);if(r){let i=r[1].trim();const a=i.length>1,c={type:"list",raw:"",ordered:a,start:a?+i.slice(0,-1):"",loose:!1,items:[]};i=a?`\\d{1,9}\\${i.slice(-1)}`:`\\${i}`,this.options.pedantic&&(i=a?i:"[*+-]");const d=new RegExp(`^( {0,3}${i})((?:[	 ][^\\n]*)?(?:\\n|$))`);let f="",g="",z=!1;for(;t;){let $=!1;if(!(r=d.exec(t))||this.rules.block.hr.test(t))break;f=r[0],t=t.substring(f.length);let T=r[2].split(`
`,1)[0].replace(/^\t+/,k=>" ".repeat(3*k.length)),I=t.split(`
`,1)[0],N=0;this.options.pedantic?(N=2,g=T.trimStart()):(N=r[2].search(/[^ ]/),N=N>4?1:N,g=T.slice(N),N+=r[1].length);let P=!1;if(!T&&/^ *$/.test(I)&&(f+=I+`
`,t=t.substring(I.length+1),$=!0),!$){const k=new RegExp(`^ {0,${Math.min(3,N-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),S=new RegExp(`^ {0,${Math.min(3,N-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),A=new RegExp(`^ {0,${Math.min(3,N-1)}}(?:\`\`\`|~~~)`),V=new RegExp(`^ {0,${Math.min(3,N-1)}}#`);for(;t;){const G=t.split(`
`,1)[0];if(I=G,this.options.pedantic&&(I=I.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),A.test(I)||V.test(I)||k.test(I)||S.test(t))break;if(I.search(/[^ ]/)>=N||!I.trim())g+=`
`+I.slice(N);else{if(P||T.search(/[^ ]/)>=4||A.test(T)||V.test(T)||S.test(T))break;g+=`
`+I}!P&&!I.trim()&&(P=!0),f+=G+`
`,t=t.substring(G.length+1),T=I.slice(N)}}c.loose||(z?c.loose=!0:/\n *\n *$/.test(f)&&(z=!0));let _=null,F;this.options.gfm&&(_=/^\[[ xX]\] /.exec(g),_&&(F=_[0]!=="[ ] ",g=g.replace(/^\[[ xX]\] +/,""))),c.items.push({type:"list_item",raw:f,task:!!_,checked:F,loose:!1,text:g,tokens:[]}),c.raw+=f}c.items[c.items.length-1].raw=f.trimEnd(),c.items[c.items.length-1].text=g.trimEnd(),c.raw=c.raw.trimEnd();for(let $=0;$<c.items.length;$++)if(this.lexer.state.top=!1,c.items[$].tokens=this.lexer.blockTokens(c.items[$].text,[]),!c.loose){const T=c.items[$].tokens.filter(N=>N.type==="space"),I=T.length>0&&T.some(N=>/\n.*\n/.test(N.raw));c.loose=I}if(c.loose)for(let $=0;$<c.items.length;$++)c.items[$].loose=!0;return c}}html(t){const r=this.rules.block.html.exec(t);if(r)return{type:"html",block:!0,raw:r[0],pre:r[1]==="pre"||r[1]==="script"||r[1]==="style",text:r[0]}}def(t){const r=this.rules.block.def.exec(t);if(r){const i=r[1].toLowerCase().replace(/\s+/g," "),a=r[2]?r[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",c=r[3]?r[3].substring(1,r[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):r[3];return{type:"def",tag:i,raw:r[0],href:a,title:c}}}table(t){const r=this.rules.block.table.exec(t);if(!r||!/[:|]/.test(r[2]))return;const i=Iy(r[1]),a=r[2].replace(/^\||\| *$/g,"").split("|"),c=r[3]&&r[3].trim()?r[3].replace(/\n[ \t]*$/,"").split(`
`):[],d={type:"table",raw:r[0],header:[],align:[],rows:[]};if(i.length===a.length){for(const f of a)/^ *-+: *$/.test(f)?d.align.push("right"):/^ *:-+: *$/.test(f)?d.align.push("center"):/^ *:-+ *$/.test(f)?d.align.push("left"):d.align.push(null);for(const f of i)d.header.push({text:f,tokens:this.lexer.inline(f)});for(const f of c)d.rows.push(Iy(f,d.header.length).map(g=>({text:g,tokens:this.lexer.inline(g)})));return d}}lheading(t){const r=this.rules.block.lheading.exec(t);if(r)return{type:"heading",raw:r[0],depth:r[2].charAt(0)==="="?1:2,text:r[1],tokens:this.lexer.inline(r[1])}}paragraph(t){const r=this.rules.block.paragraph.exec(t);if(r){const i=r[1].charAt(r[1].length-1)===`
`?r[1].slice(0,-1):r[1];return{type:"paragraph",raw:r[0],text:i,tokens:this.lexer.inline(i)}}}text(t){const r=this.rules.block.text.exec(t);if(r)return{type:"text",raw:r[0],text:r[0],tokens:this.lexer.inline(r[0])}}escape(t){const r=this.rules.inline.escape.exec(t);if(r)return{type:"escape",raw:r[0],text:li(r[1])}}tag(t){const r=this.rules.inline.tag.exec(t);if(r)return!this.lexer.state.inLink&&/^<a /i.test(r[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(r[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(r[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(r[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:r[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:r[0]}}link(t){const r=this.rules.inline.link.exec(t);if(r){const i=r[2].trim();if(!this.options.pedantic&&/^</.test(i)){if(!/>$/.test(i))return;const d=Tp(i.slice(0,-1),"\\");if((i.length-d.length)%2===0)return}else{const d=AN(r[2],"()");if(d>-1){const g=(r[0].indexOf("!")===0?5:4)+r[1].length+d;r[2]=r[2].substring(0,d),r[0]=r[0].substring(0,g).trim(),r[3]=""}}let a=r[2],c="";if(this.options.pedantic){const d=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(a);d&&(a=d[1],c=d[3])}else c=r[3]?r[3].slice(1,-1):"";return a=a.trim(),/^</.test(a)&&(this.options.pedantic&&!/>$/.test(i)?a=a.slice(1):a=a.slice(1,-1)),$y(r,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:c&&c.replace(this.rules.inline.anyPunctuation,"$1")},r[0],this.lexer)}}reflink(t,r){let i;if((i=this.rules.inline.reflink.exec(t))||(i=this.rules.inline.nolink.exec(t))){const a=(i[2]||i[1]).replace(/\s+/g," "),c=r[a.toLowerCase()];if(!c){const d=i[0].charAt(0);return{type:"text",raw:d,text:d}}return $y(i,c,i[0],this.lexer)}}emStrong(t,r,i=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!a||a[3]&&i.match(/[\p{L}\p{N}]/u))return;if(!(a[1]||a[2]||"")||!i||this.rules.inline.punctuation.exec(i)){const d=[...a[0]].length-1;let f,g,z=d,$=0;const T=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(T.lastIndex=0,r=r.slice(-1*t.length+d);(a=T.exec(r))!=null;){if(f=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!f)continue;if(g=[...f].length,a[3]||a[4]){z+=g;continue}else if((a[5]||a[6])&&d%3&&!((d+g)%3)){$+=g;continue}if(z-=g,z>0)continue;g=Math.min(g,g+z+$);const I=[...a[0]][0].length,N=t.slice(0,d+a.index+I+g);if(Math.min(d,g)%2){const _=N.slice(1,-1);return{type:"em",raw:N,text:_,tokens:this.lexer.inlineTokens(_)}}const P=N.slice(2,-2);return{type:"strong",raw:N,text:P,tokens:this.lexer.inlineTokens(P)}}}}codespan(t){const r=this.rules.inline.code.exec(t);if(r){let i=r[2].replace(/\n/g," ");const a=/[^ ]/.test(i),c=/^ /.test(i)&&/ $/.test(i);return a&&c&&(i=i.substring(1,i.length-1)),i=li(i,!0),{type:"codespan",raw:r[0],text:i}}}br(t){const r=this.rules.inline.br.exec(t);if(r)return{type:"br",raw:r[0]}}del(t){const r=this.rules.inline.del.exec(t);if(r)return{type:"del",raw:r[0],text:r[2],tokens:this.lexer.inlineTokens(r[2])}}autolink(t){const r=this.rules.inline.autolink.exec(t);if(r){let i,a;return r[2]==="@"?(i=li(r[1]),a="mailto:"+i):(i=li(r[1]),a=i),{type:"link",raw:r[0],text:i,href:a,tokens:[{type:"text",raw:i,text:i}]}}}url(t){var i;let r;if(r=this.rules.inline.url.exec(t)){let a,c;if(r[2]==="@")a=li(r[0]),c="mailto:"+a;else{let d;do d=r[0],r[0]=((i=this.rules.inline._backpedal.exec(r[0]))==null?void 0:i[0])??"";while(d!==r[0]);a=li(r[0]),r[1]==="www."?c="http://"+r[0]:c=r[0]}return{type:"link",raw:r[0],text:a,href:c,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){const r=this.rules.inline.text.exec(t);if(r){let i;return this.lexer.state.inRawBlock?i=r[0]:i=li(r[0]),{type:"text",raw:r[0],text:i}}}}const DN=/^(?: *(?:\n|$))+/,LN=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,ON=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,zu=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,UN=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,$w=/(?:[*+-]|\d{1,9}[.)])/,Mw=sr(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,$w).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Rg=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,FN=/^[^\n]+/,Dg=/(?!\s*\])(?:\\.|[^\[\]\\])+/,BN=sr(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",Dg).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),HN=sr(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,$w).getRegex(),Qf="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Lg=/\x3C!--(?:-?>|[\s\S]*?(?:-->|$))/,WN=sr("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",Lg).replace("tag",Qf).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Tw=sr(Rg).replace("hr",zu).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Qf).getRegex(),VN=sr(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Tw).getRegex(),Og={blockquote:VN,code:LN,def:BN,fences:ON,heading:UN,hr:zu,html:WN,lheading:Mw,list:HN,newline:DN,paragraph:Tw,table:Xd,text:FN},My=sr("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",zu).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Qf).getRegex(),KN={...Og,table:My,paragraph:sr(Rg).replace("hr",zu).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",My).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Qf).getRegex()},YN={...Og,html:sr(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Lg).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Xd,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:sr(Rg).replace("hr",zu).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Mw).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Pw=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,JN=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Aw=/^( {2,}|\\)\n(?!\s*$)/,GN=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,ku="\\p{P}\\p{S}",XN=sr(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,ku).getRegex(),ZN=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,qN=sr(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,ku).getRegex(),QN=sr("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,ku).getRegex(),e5=sr("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,ku).getRegex(),t5=sr(/\\([punct])/,"gu").replace(/punct/g,ku).getRegex(),n5=sr(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),r5=sr(Lg).replace("(?:-->|$)","-->").getRegex(),s5=sr("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",r5).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Tf=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,i5=sr(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",Tf).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Rw=sr(/^!?\[(label)\]\[(ref)\]/).replace("label",Tf).replace("ref",Dg).getRegex(),Dw=sr(/^!?\[(ref)\](?:\[\])?/).replace("ref",Dg).getRegex(),o5=sr("reflink|nolink(?!\\()","g").replace("reflink",Rw).replace("nolink",Dw).getRegex(),Ug={_backpedal:Xd,anyPunctuation:t5,autolink:n5,blockSkip:ZN,br:Aw,code:JN,del:Xd,emStrongLDelim:qN,emStrongRDelimAst:QN,emStrongRDelimUnd:e5,escape:Pw,link:i5,nolink:Dw,punctuation:XN,reflink:Rw,reflinkSearch:o5,tag:s5,text:GN,url:Xd},a5={...Ug,link:sr(/^!?\[(label)\]\((.*?)\)/).replace("label",Tf).getRegex(),reflink:sr(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Tf).getRegex()},Im={...Ug,escape:sr(Pw).replace("])","~|])").getRegex(),url:sr(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},l5={...Im,br:sr(Aw).replace("{2,}","*").getRegex(),text:sr(Im.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Pp={normal:Og,gfm:KN,pedantic:YN},jd={normal:Ug,gfm:Im,breaks:l5,pedantic:a5};class so{constructor(t){fr(this,"tokens");fr(this,"options");fr(this,"state");fr(this,"tokenizer");fr(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||vl,this.options.tokenizer=this.options.tokenizer||new Mf,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const r={block:Pp.normal,inline:jd.normal};this.options.pedantic?(r.block=Pp.pedantic,r.inline=jd.pedantic):this.options.gfm&&(r.block=Pp.gfm,this.options.breaks?r.inline=jd.breaks:r.inline=jd.gfm),this.tokenizer.rules=r}static get rules(){return{block:Pp,inline:jd}}static lex(t,r){return new so(r).lex(t)}static lexInline(t,r){return new so(r).inlineTokens(t)}lex(t){t=t.replace(/\r\n|\r/g,`
`),this.blockTokens(t,this.tokens);for(let r=0;r<this.inlineQueue.length;r++){const i=this.inlineQueue[r];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,r=[]){this.options.pedantic?t=t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t=t.replace(/^( *)(\t+)/gm,(f,g,z)=>g+"    ".repeat(z.length));let i,a,c,d;for(;t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(f=>(i=f.call({lexer:this},t,r))?(t=t.substring(i.raw.length),r.push(i),!0):!1))){if(i=this.tokenizer.space(t)){t=t.substring(i.raw.length),i.raw.length===1&&r.length>0?r[r.length-1].raw+=`
`:r.push(i);continue}if(i=this.tokenizer.code(t)){t=t.substring(i.raw.length),a=r[r.length-1],a&&(a.type==="paragraph"||a.type==="text")?(a.raw+=`
`+i.raw,a.text+=`
`+i.text,this.inlineQueue[this.inlineQueue.length-1].src=a.text):r.push(i);continue}if(i=this.tokenizer.fences(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.heading(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.hr(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.blockquote(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.list(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.html(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.def(t)){t=t.substring(i.raw.length),a=r[r.length-1],a&&(a.type==="paragraph"||a.type==="text")?(a.raw+=`
`+i.raw,a.text+=`
`+i.raw,this.inlineQueue[this.inlineQueue.length-1].src=a.text):this.tokens.links[i.tag]||(this.tokens.links[i.tag]={href:i.href,title:i.title});continue}if(i=this.tokenizer.table(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.lheading(t)){t=t.substring(i.raw.length),r.push(i);continue}if(c=t,this.options.extensions&&this.options.extensions.startBlock){let f=1/0;const g=t.slice(1);let z;this.options.extensions.startBlock.forEach($=>{z=$.call({lexer:this},g),typeof z=="number"&&z>=0&&(f=Math.min(f,z))}),f<1/0&&f>=0&&(c=t.substring(0,f+1))}if(this.state.top&&(i=this.tokenizer.paragraph(c))){a=r[r.length-1],d&&a.type==="paragraph"?(a.raw+=`
`+i.raw,a.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):r.push(i),d=c.length!==t.length,t=t.substring(i.raw.length);continue}if(i=this.tokenizer.text(t)){t=t.substring(i.raw.length),a=r[r.length-1],a&&a.type==="text"?(a.raw+=`
`+i.raw,a.text+=`
`+i.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):r.push(i);continue}if(t){const f="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return this.state.top=!0,r}inline(t,r=[]){return this.inlineQueue.push({src:t,tokens:r}),r}inlineTokens(t,r=[]){let i,a,c,d=t,f,g,z;if(this.tokens.links){const $=Object.keys(this.tokens.links);if($.length>0)for(;(f=this.tokenizer.rules.inline.reflinkSearch.exec(d))!=null;)$.includes(f[0].slice(f[0].lastIndexOf("[")+1,-1))&&(d=d.slice(0,f.index)+"["+"a".repeat(f[0].length-2)+"]"+d.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(f=this.tokenizer.rules.inline.blockSkip.exec(d))!=null;)d=d.slice(0,f.index)+"["+"a".repeat(f[0].length-2)+"]"+d.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(f=this.tokenizer.rules.inline.anyPunctuation.exec(d))!=null;)d=d.slice(0,f.index)+"++"+d.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;t;)if(g||(z=""),g=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some($=>(i=$.call({lexer:this},t,r))?(t=t.substring(i.raw.length),r.push(i),!0):!1))){if(i=this.tokenizer.escape(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.tag(t)){t=t.substring(i.raw.length),a=r[r.length-1],a&&i.type==="text"&&a.type==="text"?(a.raw+=i.raw,a.text+=i.text):r.push(i);continue}if(i=this.tokenizer.link(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(i.raw.length),a=r[r.length-1],a&&i.type==="text"&&a.type==="text"?(a.raw+=i.raw,a.text+=i.text):r.push(i);continue}if(i=this.tokenizer.emStrong(t,d,z)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.codespan(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.br(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.del(t)){t=t.substring(i.raw.length),r.push(i);continue}if(i=this.tokenizer.autolink(t)){t=t.substring(i.raw.length),r.push(i);continue}if(!this.state.inLink&&(i=this.tokenizer.url(t))){t=t.substring(i.raw.length),r.push(i);continue}if(c=t,this.options.extensions&&this.options.extensions.startInline){let $=1/0;const T=t.slice(1);let I;this.options.extensions.startInline.forEach(N=>{I=N.call({lexer:this},T),typeof I=="number"&&I>=0&&($=Math.min($,I))}),$<1/0&&$>=0&&(c=t.substring(0,$+1))}if(i=this.tokenizer.inlineText(c)){t=t.substring(i.raw.length),i.raw.slice(-1)!=="_"&&(z=i.raw.slice(-1)),g=!0,a=r[r.length-1],a&&a.type==="text"?(a.raw+=i.raw,a.text+=i.text):r.push(i);continue}if(t){const $="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error($);break}else throw new Error($)}}return r}}class Pf{constructor(t){fr(this,"options");this.options=t||vl}code(t,r,i){var c;const a=(c=(r||"").match(/^\S*/))==null?void 0:c[0];return t=t.replace(/\n$/,"")+`
`,a?'<pre><code class="language-'+li(a)+'">'+(i?t:li(t,!0))+`</code></pre>
`:"<pre><code>"+(i?t:li(t,!0))+`</code></pre>
`}blockquote(t){return`<blockquote>
${t}</blockquote>
`}html(t,r){return t}heading(t,r,i){return`<h${r}>${t}</h${r}>
`}hr(){return`<hr>
`}list(t,r,i){const a=r?"ol":"ul",c=r&&i!==1?' start="'+i+'"':"";return"<"+a+c+`>
`+t+"</"+a+`>
`}listitem(t,r,i){return`<li>${t}</li>
`}checkbox(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(t){return`<p>${t}</p>
`}table(t,r){return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+r+`</table>
`}tablerow(t){return`<tr>
${t}</tr>
`}tablecell(t,r){const i=r.header?"th":"td";return(r.align?`<${i} align="${r.align}">`:`<${i}>`)+t+`</${i}>
`}strong(t){return`<strong>${t}</strong>`}em(t){return`<em>${t}</em>`}codespan(t){return`<code>${t}</code>`}br(){return"<br>"}del(t){return`<del>${t}</del>`}link(t,r,i){const a=Ey(t);if(a===null)return i;t=a;let c='<a href="'+t+'"';return r&&(c+=' title="'+r+'"'),c+=">"+i+"</a>",c}image(t,r,i){const a=Ey(t);if(a===null)return i;t=a;let c=`<img src="${t}" alt="${i}"`;return r&&(c+=` title="${r}"`),c+=">",c}text(t){return t}}class Fg{strong(t){return t}em(t){return t}codespan(t){return t}del(t){return t}html(t){return t}text(t){return t}link(t,r,i){return""+i}image(t,r,i){return""+i}br(){return""}}class io{constructor(t){fr(this,"options");fr(this,"renderer");fr(this,"textRenderer");this.options=t||vl,this.options.renderer=this.options.renderer||new Pf,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Fg}static parse(t,r){return new io(r).parse(t)}static parseInline(t,r){return new io(r).parseInline(t)}parse(t,r=!0){let i="";for(let a=0;a<t.length;a++){const c=t[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[c.type]){const d=c,f=this.options.extensions.renderers[d.type].call({parser:this},d);if(f!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type)){i+=f||"";continue}}switch(c.type){case"space":continue;case"hr":{i+=this.renderer.hr();continue}case"heading":{const d=c;i+=this.renderer.heading(this.parseInline(d.tokens),d.depth,TN(this.parseInline(d.tokens,this.textRenderer)));continue}case"code":{const d=c;i+=this.renderer.code(d.text,d.lang,!!d.escaped);continue}case"table":{const d=c;let f="",g="";for(let $=0;$<d.header.length;$++)g+=this.renderer.tablecell(this.parseInline(d.header[$].tokens),{header:!0,align:d.align[$]});f+=this.renderer.tablerow(g);let z="";for(let $=0;$<d.rows.length;$++){const T=d.rows[$];g="";for(let I=0;I<T.length;I++)g+=this.renderer.tablecell(this.parseInline(T[I].tokens),{header:!1,align:d.align[I]});z+=this.renderer.tablerow(g)}i+=this.renderer.table(f,z);continue}case"blockquote":{const d=c,f=this.parse(d.tokens);i+=this.renderer.blockquote(f);continue}case"list":{const d=c,f=d.ordered,g=d.start,z=d.loose;let $="";for(let T=0;T<d.items.length;T++){const I=d.items[T],N=I.checked,P=I.task;let _="";if(I.task){const F=this.renderer.checkbox(!!N);z?I.tokens.length>0&&I.tokens[0].type==="paragraph"?(I.tokens[0].text=F+" "+I.tokens[0].text,I.tokens[0].tokens&&I.tokens[0].tokens.length>0&&I.tokens[0].tokens[0].type==="text"&&(I.tokens[0].tokens[0].text=F+" "+I.tokens[0].tokens[0].text)):I.tokens.unshift({type:"text",text:F+" "}):_+=F+" "}_+=this.parse(I.tokens,z),$+=this.renderer.listitem(_,P,!!N)}i+=this.renderer.list($,f,g);continue}case"html":{const d=c;i+=this.renderer.html(d.text,d.block);continue}case"paragraph":{const d=c;i+=this.renderer.paragraph(this.parseInline(d.tokens));continue}case"text":{let d=c,f=d.tokens?this.parseInline(d.tokens):d.text;for(;a+1<t.length&&t[a+1].type==="text";)d=t[++a],f+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);i+=r?this.renderer.paragraph(f):f;continue}default:{const d='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return i}parseInline(t,r){r=r||this.renderer;let i="";for(let a=0;a<t.length;a++){const c=t[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[c.type]){const d=this.options.extensions.renderers[c.type].call({parser:this},c);if(d!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(c.type)){i+=d||"";continue}}switch(c.type){case"escape":{const d=c;i+=r.text(d.text);break}case"html":{const d=c;i+=r.html(d.text);break}case"link":{const d=c;i+=r.link(d.href,d.title,this.parseInline(d.tokens,r));break}case"image":{const d=c;i+=r.image(d.href,d.title,d.text);break}case"strong":{const d=c;i+=r.strong(this.parseInline(d.tokens,r));break}case"em":{const d=c;i+=r.em(this.parseInline(d.tokens,r));break}case"codespan":{const d=c;i+=r.codespan(d.text);break}case"br":{i+=r.br();break}case"del":{const d=c;i+=r.del(this.parseInline(d.tokens,r));break}case"text":{const d=c;i+=r.text(d.text);break}default:{const d='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return i}}class Zd{constructor(t){fr(this,"options");this.options=t||vl}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}}fr(Zd,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var xl,$m,Lw;class c5{constructor(...t){bb(this,xl);fr(this,"defaults",Ag());fr(this,"options",this.setOptions);fr(this,"parse",mp(this,xl,$m).call(this,so.lex,io.parse));fr(this,"parseInline",mp(this,xl,$m).call(this,so.lexInline,io.parseInline));fr(this,"Parser",io);fr(this,"Renderer",Pf);fr(this,"TextRenderer",Fg);fr(this,"Lexer",so);fr(this,"Tokenizer",Mf);fr(this,"Hooks",Zd);this.use(...t)}walkTokens(t,r){var a,c;let i=[];for(const d of t)switch(i=i.concat(r.call(this,d)),d.type){case"table":{const f=d;for(const g of f.header)i=i.concat(this.walkTokens(g.tokens,r));for(const g of f.rows)for(const z of g)i=i.concat(this.walkTokens(z.tokens,r));break}case"list":{const f=d;i=i.concat(this.walkTokens(f.items,r));break}default:{const f=d;(c=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&c[f.type]?this.defaults.extensions.childTokens[f.type].forEach(g=>{const z=f[g].flat(1/0);i=i.concat(this.walkTokens(z,r))}):f.tokens&&(i=i.concat(this.walkTokens(f.tokens,r)))}}return i}use(...t){const r=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(i=>{const a={...i};if(a.async=this.defaults.async||a.async||!1,i.extensions&&(i.extensions.forEach(c=>{if(!c.name)throw new Error("extension name required");if("renderer"in c){const d=r.renderers[c.name];d?r.renderers[c.name]=function(...f){let g=c.renderer.apply(this,f);return g===!1&&(g=d.apply(this,f)),g}:r.renderers[c.name]=c.renderer}if("tokenizer"in c){if(!c.level||c.level!=="block"&&c.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const d=r[c.level];d?d.unshift(c.tokenizer):r[c.level]=[c.tokenizer],c.start&&(c.level==="block"?r.startBlock?r.startBlock.push(c.start):r.startBlock=[c.start]:c.level==="inline"&&(r.startInline?r.startInline.push(c.start):r.startInline=[c.start]))}"childTokens"in c&&c.childTokens&&(r.childTokens[c.name]=c.childTokens)}),a.extensions=r),i.renderer){const c=this.defaults.renderer||new Pf(this.defaults);for(const d in i.renderer){if(!(d in c))throw new Error(`renderer '${d}' does not exist`);if(d==="options")continue;const f=d,g=i.renderer[f],z=c[f];c[f]=(...$)=>{let T=g.apply(c,$);return T===!1&&(T=z.apply(c,$)),T||""}}a.renderer=c}if(i.tokenizer){const c=this.defaults.tokenizer||new Mf(this.defaults);for(const d in i.tokenizer){if(!(d in c))throw new Error(`tokenizer '${d}' does not exist`);if(["options","rules","lexer"].includes(d))continue;const f=d,g=i.tokenizer[f],z=c[f];c[f]=(...$)=>{let T=g.apply(c,$);return T===!1&&(T=z.apply(c,$)),T}}a.tokenizer=c}if(i.hooks){const c=this.defaults.hooks||new Zd;for(const d in i.hooks){if(!(d in c))throw new Error(`hook '${d}' does not exist`);if(d==="options")continue;const f=d,g=i.hooks[f],z=c[f];Zd.passThroughHooks.has(d)?c[f]=$=>{if(this.defaults.async)return Promise.resolve(g.call(c,$)).then(I=>z.call(c,I));const T=g.call(c,$);return z.call(c,T)}:c[f]=(...$)=>{let T=g.apply(c,$);return T===!1&&(T=z.apply(c,$)),T}}a.hooks=c}if(i.walkTokens){const c=this.defaults.walkTokens,d=i.walkTokens;a.walkTokens=function(f){let g=[];return g.push(d.call(this,f)),c&&(g=g.concat(c.call(this,f))),g}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,r){return so.lex(t,r??this.defaults)}parser(t,r){return io.parse(t,r??this.defaults)}}xl=new WeakSet,$m=function(t,r){return(i,a)=>{const c={...a},d={...this.defaults,...c};this.defaults.async===!0&&c.async===!1&&(d.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),d.async=!0);const f=mp(this,xl,Lw).call(this,!!d.silent,!!d.async);if(typeof i>"u"||i===null)return f(new Error("marked(): input parameter is undefined or null"));if(typeof i!="string")return f(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(i)+", string expected"));if(d.hooks&&(d.hooks.options=d),d.async)return Promise.resolve(d.hooks?d.hooks.preprocess(i):i).then(g=>t(g,d)).then(g=>d.hooks?d.hooks.processAllTokens(g):g).then(g=>d.walkTokens?Promise.all(this.walkTokens(g,d.walkTokens)).then(()=>g):g).then(g=>r(g,d)).then(g=>d.hooks?d.hooks.postprocess(g):g).catch(f);try{d.hooks&&(i=d.hooks.preprocess(i));let g=t(i,d);d.hooks&&(g=d.hooks.processAllTokens(g)),d.walkTokens&&this.walkTokens(g,d.walkTokens);let z=r(g,d);return d.hooks&&(z=d.hooks.postprocess(z)),z}catch(g){return f(g)}}},Lw=function(t,r){return i=>{if(i.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const a="<p>An error occurred:</p><pre>"+li(i.message+"",!0)+"</pre>";return r?Promise.resolve(a):a}if(r)return Promise.reject(i);throw i}};const gl=new c5;function Gn(e,t){return gl.parse(e,t)}Gn.options=Gn.setOptions=function(e){return gl.setOptions(e),Gn.defaults=gl.defaults,Cw(Gn.defaults),Gn};Gn.getDefaults=Ag;Gn.defaults=vl;Gn.use=function(...e){return gl.use(...e),Gn.defaults=gl.defaults,Cw(Gn.defaults),Gn};Gn.walkTokens=function(e,t){return gl.walkTokens(e,t)};Gn.parseInline=gl.parseInline;Gn.Parser=io;Gn.parser=io.parse;Gn.Renderer=Pf;Gn.TextRenderer=Fg;Gn.Lexer=so;Gn.lexer=so.lex;Gn.Tokenizer=Mf;Gn.Hooks=Zd;Gn.parse=Gn;Gn.options;Gn.setOptions;Gn.use;Gn.walkTokens;Gn.parseInline;io.parse;so.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:Ow,setPrototypeOf:Ty,isFrozen:d5,getPrototypeOf:u5,getOwnPropertyDescriptor:p5}=Object;let{freeze:Is,seal:_i,create:Mm}=Object,{apply:Tm,construct:Pm}=typeof Reflect<"u"&&Reflect;Is||(Is=function(t){return t});_i||(_i=function(t){return t});Tm||(Tm=function(t,r){for(var i=arguments.length,a=new Array(i>2?i-2:0),c=2;c<i;c++)a[c-2]=arguments[c];return t.apply(r,a)});Pm||(Pm=function(t){for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return new t(...i)});const Ap=$s(Array.prototype.forEach),f5=$s(Array.prototype.lastIndexOf),Py=$s(Array.prototype.pop),Nd=$s(Array.prototype.push),h5=$s(Array.prototype.splice),of=$s(String.prototype.toLowerCase),wh=$s(String.prototype.toString),zh=$s(String.prototype.match),_d=$s(String.prototype.replace),m5=$s(String.prototype.indexOf),g5=$s(String.prototype.trim),Di=$s(Object.prototype.hasOwnProperty),Ss=$s(RegExp.prototype.test),Sd=x5(TypeError);function $s(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];return Tm(e,t,i)}}function x5(e){return function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return Pm(e,r)}}function En(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:of;Ty&&Ty(e,null);let i=t.length;for(;i--;){let a=t[i];if(typeof a=="string"){const c=r(a);c!==a&&(d5(t)||(t[i]=c),a=c)}e[a]=!0}return e}function b5(e){for(let t=0;t<e.length;t++)Di(e,t)||(e[t]=null);return e}function to(e){const t=Mm(null);for(const[r,i]of Ow(e))Di(e,r)&&(Array.isArray(i)?t[r]=b5(i):i&&typeof i=="object"&&i.constructor===Object?t[r]=to(i):t[r]=i);return t}function Cd(e,t){for(;e!==null;){const i=p5(e,t);if(i){if(i.get)return $s(i.get);if(typeof i.value=="function")return $s(i.value)}e=u5(e)}function r(){return null}return r}const Ay=Is(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),kh=Is(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),jh=Is(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),y5=Is(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Nh=Is(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),v5=Is(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ry=Is(["#text"]),Dy=Is(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),_h=Is(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ly=Is(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Rp=Is(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),w5=_i(/\{\{[\w\W]*|[\w\W]*\}\}/gm),z5=_i(/<%[\w\W]*|[\w\W]*%>/gm),k5=_i(/\$\{[\w\W]*/gm),j5=_i(/^data-[\-\w.\u00B7-\uFFFF]+$/),N5=_i(/^aria-[\-\w]+$/),Uw=_i(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),_5=_i(/^(?:\w+script|data):/i),S5=_i(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Fw=_i(/^html$/i),C5=_i(/^[a-z][.\w]*(-[.\w]+)+$/i);var Oy=Object.freeze({__proto__:null,ARIA_ATTR:N5,ATTR_WHITESPACE:S5,CUSTOM_ELEMENT:C5,DATA_ATTR:j5,DOCTYPE_NAME:Fw,ERB_EXPR:z5,IS_ALLOWED_URI:Uw,IS_SCRIPT_OR_DATA:_5,MUSTACHE_EXPR:w5,TMPLIT_EXPR:k5});const Ed={element:1,text:3,progressingInstruction:7,comment:8,document:9},E5=function(){return typeof window>"u"?null:window},I5=function(t,r){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let i=null;const a="data-tt-policy-suffix";r&&r.hasAttribute(a)&&(i=r.getAttribute(a));const c="dompurify"+(i?"#"+i:"");try{return t.createPolicy(c,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+c+" could not be created."),null}},Uy=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Bw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:E5();const t=Qe=>Bw(Qe);if(t.version="3.3.1",t.removed=[],!e||!e.document||e.document.nodeType!==Ed.document||!e.Element)return t.isSupported=!1,t;let{document:r}=e;const i=r,a=i.currentScript,{DocumentFragment:c,HTMLTemplateElement:d,Node:f,Element:g,NodeFilter:z,NamedNodeMap:$=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:T,DOMParser:I,trustedTypes:N}=e,P=g.prototype,_=Cd(P,"cloneNode"),F=Cd(P,"remove"),k=Cd(P,"nextSibling"),S=Cd(P,"childNodes"),A=Cd(P,"parentNode");if(typeof d=="function"){const Qe=r.createElement("template");Qe.content&&Qe.content.ownerDocument&&(r=Qe.content.ownerDocument)}let V,G="";const{implementation:le,createNodeIterator:re,createDocumentFragment:pe,getElementsByTagName:be}=r,{importNode:Ie}=i;let qe=Uy();t.isSupported=typeof Ow=="function"&&typeof A=="function"&&le&&le.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Q,ERB_EXPR:_e,TMPLIT_EXPR:D,DATA_ATTR:Te,ARIA_ATTR:Lt,IS_SCRIPT_OR_DATA:ye,ATTR_WHITESPACE:ke,CUSTOM_ELEMENT:he}=Oy;let{IS_ALLOWED_URI:Oe}=Oy,ae=null;const fe=En({},[...Ay,...kh,...jh,...Nh,...Ry]);let ut=null;const ot=En({},[...Dy,..._h,...Ly,...Rp]);let Ue=Object.seal(Mm(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Xe=null,en=null;const Ot=Object.seal(Mm(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let gn=!0,lr=!0,Zn=!1,Xt=!0,zr=!1,E=!0,Ce=!1,xe=!1,X=!1,K=!1,de=!1,Re=!1,je=!0,ve=!1;const Pe="user-content-";let ft=!0,We=!1,Pt={},fn=null;const vn=En({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let $r=null;const hi=En({},["audio","video","img","source","image","track"]);let Mr=null;const Si=En({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Fn="http://www.w3.org/1998/Math/MathML",Ci="http://www.w3.org/2000/svg",vs="http://www.w3.org/1999/xhtml";let Rr=vs,Po=!1,$a=null;const Mc=En({},[Fn,Ci,vs],wh);let Ao=En({},["mi","mo","mn","ms","mtext"]),Vi=En({},["annotation-xml"]);const lo=En({},["title","style","font","a","script"]);let kr=null;const Tc=["application/xhtml+xml","text/html"],e0="text/html";let jr=null,co=null;const wl=r.createElement("form"),Ro=function(se){return se instanceof RegExp||se instanceof Function},Nr=function(){let se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(co&&co===se)){if((!se||typeof se!="object")&&(se={}),se=to(se),kr=Tc.indexOf(se.PARSER_MEDIA_TYPE)===-1?e0:se.PARSER_MEDIA_TYPE,jr=kr==="application/xhtml+xml"?wh:of,ae=Di(se,"ALLOWED_TAGS")?En({},se.ALLOWED_TAGS,jr):fe,ut=Di(se,"ALLOWED_ATTR")?En({},se.ALLOWED_ATTR,jr):ot,$a=Di(se,"ALLOWED_NAMESPACES")?En({},se.ALLOWED_NAMESPACES,wh):Mc,Mr=Di(se,"ADD_URI_SAFE_ATTR")?En(to(Si),se.ADD_URI_SAFE_ATTR,jr):Si,$r=Di(se,"ADD_DATA_URI_TAGS")?En(to(hi),se.ADD_DATA_URI_TAGS,jr):hi,fn=Di(se,"FORBID_CONTENTS")?En({},se.FORBID_CONTENTS,jr):vn,Xe=Di(se,"FORBID_TAGS")?En({},se.FORBID_TAGS,jr):to({}),en=Di(se,"FORBID_ATTR")?En({},se.FORBID_ATTR,jr):to({}),Pt=Di(se,"USE_PROFILES")?se.USE_PROFILES:!1,gn=se.ALLOW_ARIA_ATTR!==!1,lr=se.ALLOW_DATA_ATTR!==!1,Zn=se.ALLOW_UNKNOWN_PROTOCOLS||!1,Xt=se.ALLOW_SELF_CLOSE_IN_ATTR!==!1,zr=se.SAFE_FOR_TEMPLATES||!1,E=se.SAFE_FOR_XML!==!1,Ce=se.WHOLE_DOCUMENT||!1,K=se.RETURN_DOM||!1,de=se.RETURN_DOM_FRAGMENT||!1,Re=se.RETURN_TRUSTED_TYPE||!1,X=se.FORCE_BODY||!1,je=se.SANITIZE_DOM!==!1,ve=se.SANITIZE_NAMED_PROPS||!1,ft=se.KEEP_CONTENT!==!1,We=se.IN_PLACE||!1,Oe=se.ALLOWED_URI_REGEXP||Uw,Rr=se.NAMESPACE||vs,Ao=se.MATHML_TEXT_INTEGRATION_POINTS||Ao,Vi=se.HTML_INTEGRATION_POINTS||Vi,Ue=se.CUSTOM_ELEMENT_HANDLING||{},se.CUSTOM_ELEMENT_HANDLING&&Ro(se.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Ue.tagNameCheck=se.CUSTOM_ELEMENT_HANDLING.tagNameCheck),se.CUSTOM_ELEMENT_HANDLING&&Ro(se.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Ue.attributeNameCheck=se.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),se.CUSTOM_ELEMENT_HANDLING&&typeof se.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(Ue.allowCustomizedBuiltInElements=se.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),zr&&(lr=!1),de&&(K=!0),Pt&&(ae=En({},Ry),ut=[],Pt.html===!0&&(En(ae,Ay),En(ut,Dy)),Pt.svg===!0&&(En(ae,kh),En(ut,_h),En(ut,Rp)),Pt.svgFilters===!0&&(En(ae,jh),En(ut,_h),En(ut,Rp)),Pt.mathMl===!0&&(En(ae,Nh),En(ut,Ly),En(ut,Rp))),se.ADD_TAGS&&(typeof se.ADD_TAGS=="function"?Ot.tagCheck=se.ADD_TAGS:(ae===fe&&(ae=to(ae)),En(ae,se.ADD_TAGS,jr))),se.ADD_ATTR&&(typeof se.ADD_ATTR=="function"?Ot.attributeCheck=se.ADD_ATTR:(ut===ot&&(ut=to(ut)),En(ut,se.ADD_ATTR,jr))),se.ADD_URI_SAFE_ATTR&&En(Mr,se.ADD_URI_SAFE_ATTR,jr),se.FORBID_CONTENTS&&(fn===vn&&(fn=to(fn)),En(fn,se.FORBID_CONTENTS,jr)),se.ADD_FORBID_CONTENTS&&(fn===vn&&(fn=to(fn)),En(fn,se.ADD_FORBID_CONTENTS,jr)),ft&&(ae["#text"]=!0),Ce&&En(ae,["html","head","body"]),ae.table&&(En(ae,["tbody"]),delete Xe.tbody),se.TRUSTED_TYPES_POLICY){if(typeof se.TRUSTED_TYPES_POLICY.createHTML!="function")throw Sd('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof se.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Sd('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');V=se.TRUSTED_TYPES_POLICY,G=V.createHTML("")}else V===void 0&&(V=I5(N,a)),V!==null&&typeof G=="string"&&(G=V.createHTML(""));Is&&Is(se),co=se}},Pc=En({},[...kh,...jh,...y5]),Xs=En({},[...Nh,...v5]),t0=function(se){let Ve=A(se);(!Ve||!Ve.tagName)&&(Ve={namespaceURI:Rr,tagName:"template"});const _t=of(se.tagName),qn=of(Ve.tagName);return $a[se.namespaceURI]?se.namespaceURI===Ci?Ve.namespaceURI===vs?_t==="svg":Ve.namespaceURI===Fn?_t==="svg"&&(qn==="annotation-xml"||Ao[qn]):!!Pc[_t]:se.namespaceURI===Fn?Ve.namespaceURI===vs?_t==="math":Ve.namespaceURI===Ci?_t==="math"&&Vi[qn]:!!Xs[_t]:se.namespaceURI===vs?Ve.namespaceURI===Ci&&!Vi[qn]||Ve.namespaceURI===Fn&&!Ao[qn]?!1:!Xs[_t]&&(lo[_t]||!Pc[_t]):!!(kr==="application/xhtml+xml"&&$a[se.namespaceURI]):!1},kn=function(se){Nd(t.removed,{element:se});try{A(se).removeChild(se)}catch{F(se)}},uo=function(se,Ve){try{Nd(t.removed,{attribute:Ve.getAttributeNode(se),from:Ve})}catch{Nd(t.removed,{attribute:null,from:Ve})}if(Ve.removeAttribute(se),se==="is")if(K||de)try{kn(Ve)}catch{}else try{Ve.setAttribute(se,"")}catch{}},fs=function(se){let Ve=null,_t=null;if(X)se="<remove></remove>"+se;else{const _r=zh(se,/^[\r\n\t ]+/);_t=_r&&_r[0]}kr==="application/xhtml+xml"&&Rr===vs&&(se='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+se+"</body></html>");const qn=V?V.createHTML(se):se;if(Rr===vs)try{Ve=new I().parseFromString(qn,kr)}catch{}if(!Ve||!Ve.documentElement){Ve=le.createDocument(Rr,"template",null);try{Ve.documentElement.innerHTML=Po?G:qn}catch{}}const Qn=Ve.body||Ve.documentElement;return se&&_t&&Qn.insertBefore(r.createTextNode(_t),Qn.childNodes[0]||null),Rr===vs?be.call(Ve,Ce?"html":"body")[0]:Ce?Ve.documentElement:Qn},zl=function(se){return re.call(se.ownerDocument||se,se,z.SHOW_ELEMENT|z.SHOW_COMMENT|z.SHOW_TEXT|z.SHOW_PROCESSING_INSTRUCTION|z.SHOW_CDATA_SECTION,null)},as=function(se){return se instanceof T&&(typeof se.nodeName!="string"||typeof se.textContent!="string"||typeof se.removeChild!="function"||!(se.attributes instanceof $)||typeof se.removeAttribute!="function"||typeof se.setAttribute!="function"||typeof se.namespaceURI!="string"||typeof se.insertBefore!="function"||typeof se.hasChildNodes!="function")},Ac=function(se){return typeof f=="function"&&se instanceof f};function mi(Qe,se,Ve){Ap(Qe,_t=>{_t.call(t,se,Ve,co)})}const ju=function(se){let Ve=null;if(mi(qe.beforeSanitizeElements,se,null),as(se))return kn(se),!0;const _t=jr(se.nodeName);if(mi(qe.uponSanitizeElement,se,{tagName:_t,allowedTags:ae}),E&&se.hasChildNodes()&&!Ac(se.firstElementChild)&&Ss(/<[/\w!]/g,se.innerHTML)&&Ss(/<[/\w!]/g,se.textContent)||se.nodeType===Ed.progressingInstruction||E&&se.nodeType===Ed.comment&&Ss(/<[/\w]/g,se.data))return kn(se),!0;if(!(Ot.tagCheck instanceof Function&&Ot.tagCheck(_t))&&(!ae[_t]||Xe[_t])){if(!Xe[_t]&&Do(_t)&&(Ue.tagNameCheck instanceof RegExp&&Ss(Ue.tagNameCheck,_t)||Ue.tagNameCheck instanceof Function&&Ue.tagNameCheck(_t)))return!1;if(ft&&!fn[_t]){const qn=A(se)||se.parentNode,Qn=S(se)||se.childNodes;if(Qn&&qn){const _r=Qn.length;for(let Gr=_r-1;Gr>=0;--Gr){const Zs=_(Qn[Gr],!0);Zs.__removalCount=(se.__removalCount||0)+1,qn.insertBefore(Zs,k(se))}}}return kn(se),!0}return se instanceof g&&!t0(se)||(_t==="noscript"||_t==="noembed"||_t==="noframes")&&Ss(/<\/no(script|embed|frames)/i,se.innerHTML)?(kn(se),!0):(zr&&se.nodeType===Ed.text&&(Ve=se.textContent,Ap([Q,_e,D],qn=>{Ve=_d(Ve,qn," ")}),se.textContent!==Ve&&(Nd(t.removed,{element:se.cloneNode()}),se.textContent=Ve)),mi(qe.afterSanitizeElements,se,null),!1)},Nu=function(se,Ve,_t){if(je&&(Ve==="id"||Ve==="name")&&(_t in r||_t in wl))return!1;if(!(lr&&!en[Ve]&&Ss(Te,Ve))){if(!(gn&&Ss(Lt,Ve))){if(!(Ot.attributeCheck instanceof Function&&Ot.attributeCheck(Ve,se))){if(!ut[Ve]||en[Ve]){if(!(Do(se)&&(Ue.tagNameCheck instanceof RegExp&&Ss(Ue.tagNameCheck,se)||Ue.tagNameCheck instanceof Function&&Ue.tagNameCheck(se))&&(Ue.attributeNameCheck instanceof RegExp&&Ss(Ue.attributeNameCheck,Ve)||Ue.attributeNameCheck instanceof Function&&Ue.attributeNameCheck(Ve,se))||Ve==="is"&&Ue.allowCustomizedBuiltInElements&&(Ue.tagNameCheck instanceof RegExp&&Ss(Ue.tagNameCheck,_t)||Ue.tagNameCheck instanceof Function&&Ue.tagNameCheck(_t))))return!1}else if(!Mr[Ve]){if(!Ss(Oe,_d(_t,ke,""))){if(!((Ve==="src"||Ve==="xlink:href"||Ve==="href")&&se!=="script"&&m5(_t,"data:")===0&&$r[se])){if(!(Zn&&!Ss(ye,_d(_t,ke,"")))){if(_t)return!1}}}}}}}return!0},Do=function(se){return se!=="annotation-xml"&&zh(se,he)},Ei=function(se){mi(qe.beforeSanitizeAttributes,se,null);const{attributes:Ve}=se;if(!Ve||as(se))return;const _t={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ut,forceKeepAttr:void 0};let qn=Ve.length;for(;qn--;){const Qn=Ve[qn],{name:_r,namespaceURI:Gr,value:Zs}=Qn,Ki=jr(_r),kt=Zs;let gt=_r==="value"?kt:g5(kt);if(_t.attrName=Ki,_t.attrValue=gt,_t.keepAttr=!0,_t.forceKeepAttr=void 0,mi(qe.uponSanitizeAttribute,se,_t),gt=_t.attrValue,ve&&(Ki==="id"||Ki==="name")&&(uo(_r,se),gt=Pe+gt),E&&Ss(/((--!?|])>)|<\/(style|title|textarea)/i,gt)){uo(_r,se);continue}if(Ki==="attributename"&&zh(gt,"href")){uo(_r,se);continue}if(_t.forceKeepAttr)continue;if(!_t.keepAttr){uo(_r,se);continue}if(!Xt&&Ss(/\/>/i,gt)){uo(_r,se);continue}zr&&Ap([Q,_e,D],Lo=>{gt=_d(gt,Lo," ")});const Ma=jr(se.nodeName);if(!Nu(Ma,Ki,gt)){uo(_r,se);continue}if(V&&typeof N=="object"&&typeof N.getAttributeType=="function"&&!Gr)switch(N.getAttributeType(Ma,Ki)){case"TrustedHTML":{gt=V.createHTML(gt);break}case"TrustedScriptURL":{gt=V.createScriptURL(gt);break}}if(gt!==kt)try{Gr?se.setAttributeNS(Gr,_r,gt):se.setAttribute(_r,gt),as(se)?kn(se):Py(t.removed)}catch{uo(_r,se)}}mi(qe.afterSanitizeAttributes,se,null)},ir=function Qe(se){let Ve=null;const _t=zl(se);for(mi(qe.beforeSanitizeShadowDOM,se,null);Ve=_t.nextNode();)mi(qe.uponSanitizeShadowNode,Ve,null),ju(Ve),Ei(Ve),Ve.content instanceof c&&Qe(Ve.content);mi(qe.afterSanitizeShadowDOM,se,null)};return t.sanitize=function(Qe){let se=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ve=null,_t=null,qn=null,Qn=null;if(Po=!Qe,Po&&(Qe="\x3C!-->"),typeof Qe!="string"&&!Ac(Qe))if(typeof Qe.toString=="function"){if(Qe=Qe.toString(),typeof Qe!="string")throw Sd("dirty is not a string, aborting")}else throw Sd("toString is not a function");if(!t.isSupported)return Qe;if(xe||Nr(se),t.removed=[],typeof Qe=="string"&&(We=!1),We){if(Qe.nodeName){const Zs=jr(Qe.nodeName);if(!ae[Zs]||Xe[Zs])throw Sd("root node is forbidden and cannot be sanitized in-place")}}else if(Qe instanceof f)Ve=fs("\x3C!---->"),_t=Ve.ownerDocument.importNode(Qe,!0),_t.nodeType===Ed.element&&_t.nodeName==="BODY"||_t.nodeName==="HTML"?Ve=_t:Ve.appendChild(_t);else{if(!K&&!zr&&!Ce&&Qe.indexOf("<")===-1)return V&&Re?V.createHTML(Qe):Qe;if(Ve=fs(Qe),!Ve)return K?null:Re?G:""}Ve&&X&&kn(Ve.firstChild);const _r=zl(We?Qe:Ve);for(;qn=_r.nextNode();)ju(qn),Ei(qn),qn.content instanceof c&&ir(qn.content);if(We)return Qe;if(K){if(de)for(Qn=pe.call(Ve.ownerDocument);Ve.firstChild;)Qn.appendChild(Ve.firstChild);else Qn=Ve;return(ut.shadowroot||ut.shadowrootmode)&&(Qn=Ie.call(i,Qn,!0)),Qn}let Gr=Ce?Ve.outerHTML:Ve.innerHTML;return Ce&&ae["!doctype"]&&Ve.ownerDocument&&Ve.ownerDocument.doctype&&Ve.ownerDocument.doctype.name&&Ss(Fw,Ve.ownerDocument.doctype.name)&&(Gr="<!DOCTYPE "+Ve.ownerDocument.doctype.name+`>
`+Gr),zr&&Ap([Q,_e,D],Zs=>{Gr=_d(Gr,Zs," ")}),V&&Re?V.createHTML(Gr):Gr},t.setConfig=function(){let Qe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Nr(Qe),xe=!0},t.clearConfig=function(){co=null,xe=!1},t.isValidAttribute=function(Qe,se,Ve){co||Nr({});const _t=jr(Qe),qn=jr(se);return Nu(_t,qn,Ve)},t.addHook=function(Qe,se){typeof se=="function"&&Nd(qe[Qe],se)},t.removeHook=function(Qe,se){if(se!==void 0){const Ve=f5(qe[Qe],se);return Ve===-1?void 0:h5(qe[Qe],Ve,1)[0]}return Py(qe[Qe])},t.removeHooks=function(Qe){qe[Qe]=[]},t.removeAllHooks=function(){qe=Uy()},t}var $5=Bw();/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var M5={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T5=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Ct=(e,t)=>{const r=M.forwardRef(({color:i="currentColor",size:a=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:f="",children:g,...z},$)=>M.createElement("svg",{ref:$,...M5,width:a,height:a,stroke:i,strokeWidth:d?Number(c)*24/Number(a):c,className:["lucide",`lucide-${T5(e)}`,f].join(" "),...z},[...t.map(([T,I])=>M.createElement(T,I)),...Array.isArray(g)?g:[g]]));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sh=Ct("ArrowRightSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P5=Ct("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fy=Ct("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A5=Ct("Brush",[["path",{d:"m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08",key:"1styjt"}],["path",{d:"M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z",key:"z0l1mu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const By=Ct("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Od=Ct("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R5=Ct("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=Ct("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=Ct("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D5=Ct("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sl=Ct("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ch=Ct("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hy=Ct("ChevronsUp",[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L5=Ct("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wy=Ct("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vy=Ct("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eh=Ct("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zl=Ct("CopyPlus",[["line",{x1:"15",x2:"15",y1:"12",y2:"18",key:"1p7wdc"}],["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qa=Ct("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hw=Ct("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ky=Ct("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yy=Ct("FileAudio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O5=Ct("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U5=Ct("FileSearch",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"1vg67v"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oi=Ct("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F5=Ct("FileVideo",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m10 11 5 3-5 3v-6Z",key:"7ntvm4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ua=Ct("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B5=Ct("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jy=Ct("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gy=Ct("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ql=Ct("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ih=Ct("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dp=Ct("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Id=Ct("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=Ct("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ri=Ct("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ql=Ct("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H5=Ct("Mic2",[["path",{d:"m12 8-9.04 9.06a2.82 2.82 0 1 0 3.98 3.98L16 12",key:"zoua8r"}],["circle",{cx:"17",cy:"7",r:"5",key:"1fomce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W5=Ct("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V5=Ct("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K5=Ct("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y5=Ct("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xy=Ct("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J5=Ct("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $h=Ct("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zy=Ct("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vo=Ct("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qd=Ct("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G5=Ct("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X5=Ct("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qy=Ct("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mh=Ct("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qy=Ct("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z5=Ct("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $d=Ct("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Am=Ct("Split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ev=Ct("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tv=Ct("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Ct("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q5=Ct("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q5=Ct("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e_=Ct("UploadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Th=Ct("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lp=Ct("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Op=Ct("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nv=Ct("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=Ct("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Up=Ct("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function Fp(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ww={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(r){e.exports=r()})(function(){return function r(i,a,c){function d(z,$){if(!a[z]){if(!i[z]){var T=typeof Fp=="function"&&Fp;if(!$&&T)return T(z,!0);if(f)return f(z,!0);var I=new Error("Cannot find module '"+z+"'");throw I.code="MODULE_NOT_FOUND",I}var N=a[z]={exports:{}};i[z][0].call(N.exports,function(P){var _=i[z][1][P];return d(_||P)},N,N.exports,r,i,a,c)}return a[z].exports}for(var f=typeof Fp=="function"&&Fp,g=0;g<c.length;g++)d(c[g]);return d}({1:[function(r,i,a){var c=r("./utils"),d=r("./support"),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(g){for(var z,$,T,I,N,P,_,F=[],k=0,S=g.length,A=S,V=c.getTypeOf(g)!=="string";k<g.length;)A=S-k,T=V?(z=g[k++],$=k<S?g[k++]:0,k<S?g[k++]:0):(z=g.charCodeAt(k++),$=k<S?g.charCodeAt(k++):0,k<S?g.charCodeAt(k++):0),I=z>>2,N=(3&z)<<4|$>>4,P=1<A?(15&$)<<2|T>>6:64,_=2<A?63&T:64,F.push(f.charAt(I)+f.charAt(N)+f.charAt(P)+f.charAt(_));return F.join("")},a.decode=function(g){var z,$,T,I,N,P,_=0,F=0,k="data:";if(g.substr(0,k.length)===k)throw new Error("Invalid base64 input, it looks like a data url.");var S,A=3*(g=g.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(g.charAt(g.length-1)===f.charAt(64)&&A--,g.charAt(g.length-2)===f.charAt(64)&&A--,A%1!=0)throw new Error("Invalid base64 input, bad content length.");for(S=d.uint8array?new Uint8Array(0|A):new Array(0|A);_<g.length;)z=f.indexOf(g.charAt(_++))<<2|(I=f.indexOf(g.charAt(_++)))>>4,$=(15&I)<<4|(N=f.indexOf(g.charAt(_++)))>>2,T=(3&N)<<6|(P=f.indexOf(g.charAt(_++))),S[F++]=z,N!==64&&(S[F++]=$),P!==64&&(S[F++]=T);return S}},{"./support":30,"./utils":32}],2:[function(r,i,a){var c=r("./external"),d=r("./stream/DataWorker"),f=r("./stream/Crc32Probe"),g=r("./stream/DataLengthProbe");function z($,T,I,N,P){this.compressedSize=$,this.uncompressedSize=T,this.crc32=I,this.compression=N,this.compressedContent=P}z.prototype={getContentWorker:function(){var $=new d(c.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),T=this;return $.on("end",function(){if(this.streamInfo.data_length!==T.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),$},getCompressedWorker:function(){return new d(c.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},z.createWorkerFrom=function($,T,I){return $.pipe(new f).pipe(new g("uncompressedSize")).pipe(T.compressWorker(I)).pipe(new g("compressedSize")).withStreamInfo("compression",T)},i.exports=z},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(r,i,a){var c=r("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new c("STORE compression")},uncompressWorker:function(){return new c("STORE decompression")}},a.DEFLATE=r("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(r,i,a){var c=r("./utils"),d=function(){for(var f,g=[],z=0;z<256;z++){f=z;for(var $=0;$<8;$++)f=1&f?3988292384^f>>>1:f>>>1;g[z]=f}return g}();i.exports=function(f,g){return f!==void 0&&f.length?c.getTypeOf(f)!=="string"?function(z,$,T,I){var N=d,P=I+T;z^=-1;for(var _=I;_<P;_++)z=z>>>8^N[255&(z^$[_])];return-1^z}(0|g,f,f.length,0):function(z,$,T,I){var N=d,P=I+T;z^=-1;for(var _=I;_<P;_++)z=z>>>8^N[255&(z^$.charCodeAt(_))];return-1^z}(0|g,f,f.length,0):0}},{"./utils":32}],5:[function(r,i,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(r,i,a){var c=null;c=typeof Promise<"u"?Promise:r("lie"),i.exports={Promise:c}},{lie:37}],7:[function(r,i,a){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",d=r("pako"),f=r("./utils"),g=r("./stream/GenericWorker"),z=c?"uint8array":"array";function $(T,I){g.call(this,"FlateWorker/"+T),this._pako=null,this._pakoAction=T,this._pakoOptions=I,this.meta={}}a.magic="\b\0",f.inherits($,g),$.prototype.processChunk=function(T){this.meta=T.meta,this._pako===null&&this._createPako(),this._pako.push(f.transformTo(z,T.data),!1)},$.prototype.flush=function(){g.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},$.prototype.cleanUp=function(){g.prototype.cleanUp.call(this),this._pako=null},$.prototype._createPako=function(){this._pako=new d[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var T=this;this._pako.onData=function(I){T.push({data:I,meta:T.meta})}},a.compressWorker=function(T){return new $("Deflate",T)},a.uncompressWorker=function(){return new $("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(r,i,a){function c(N,P){var _,F="";for(_=0;_<P;_++)F+=String.fromCharCode(255&N),N>>>=8;return F}function d(N,P,_,F,k,S){var A,V,G=N.file,le=N.compression,re=S!==z.utf8encode,pe=f.transformTo("string",S(G.name)),be=f.transformTo("string",z.utf8encode(G.name)),Ie=G.comment,qe=f.transformTo("string",S(Ie)),Q=f.transformTo("string",z.utf8encode(Ie)),_e=be.length!==G.name.length,D=Q.length!==Ie.length,Te="",Lt="",ye="",ke=G.dir,he=G.date,Oe={crc32:0,compressedSize:0,uncompressedSize:0};P&&!_||(Oe.crc32=N.crc32,Oe.compressedSize=N.compressedSize,Oe.uncompressedSize=N.uncompressedSize);var ae=0;P&&(ae|=8),re||!_e&&!D||(ae|=2048);var fe=0,ut=0;ke&&(fe|=16),k==="UNIX"?(ut=798,fe|=function(Ue,Xe){var en=Ue;return Ue||(en=Xe?16893:33204),(65535&en)<<16}(G.unixPermissions,ke)):(ut=20,fe|=function(Ue){return 63&(Ue||0)}(G.dosPermissions)),A=he.getUTCHours(),A<<=6,A|=he.getUTCMinutes(),A<<=5,A|=he.getUTCSeconds()/2,V=he.getUTCFullYear()-1980,V<<=4,V|=he.getUTCMonth()+1,V<<=5,V|=he.getUTCDate(),_e&&(Lt=c(1,1)+c($(pe),4)+be,Te+="up"+c(Lt.length,2)+Lt),D&&(ye=c(1,1)+c($(qe),4)+Q,Te+="uc"+c(ye.length,2)+ye);var ot="";return ot+=`
\0`,ot+=c(ae,2),ot+=le.magic,ot+=c(A,2),ot+=c(V,2),ot+=c(Oe.crc32,4),ot+=c(Oe.compressedSize,4),ot+=c(Oe.uncompressedSize,4),ot+=c(pe.length,2),ot+=c(Te.length,2),{fileRecord:T.LOCAL_FILE_HEADER+ot+pe+Te,dirRecord:T.CENTRAL_FILE_HEADER+c(ut,2)+ot+c(qe.length,2)+"\0\0\0\0"+c(fe,4)+c(F,4)+pe+Te+qe}}var f=r("../utils"),g=r("../stream/GenericWorker"),z=r("../utf8"),$=r("../crc32"),T=r("../signature");function I(N,P,_,F){g.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=P,this.zipPlatform=_,this.encodeFileName=F,this.streamFiles=N,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}f.inherits(I,g),I.prototype.push=function(N){var P=N.meta.percent||0,_=this.entriesCount,F=this._sources.length;this.accumulate?this.contentBuffer.push(N):(this.bytesWritten+=N.data.length,g.prototype.push.call(this,{data:N.data,meta:{currentFile:this.currentFile,percent:_?(P+100*(_-F-1))/_:100}}))},I.prototype.openedSource=function(N){this.currentSourceOffset=this.bytesWritten,this.currentFile=N.file.name;var P=this.streamFiles&&!N.file.dir;if(P){var _=d(N,P,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:_.fileRecord,meta:{percent:0}})}else this.accumulate=!0},I.prototype.closedSource=function(N){this.accumulate=!1;var P=this.streamFiles&&!N.file.dir,_=d(N,P,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(_.dirRecord),P)this.push({data:function(F){return T.DATA_DESCRIPTOR+c(F.crc32,4)+c(F.compressedSize,4)+c(F.uncompressedSize,4)}(N),meta:{percent:100}});else for(this.push({data:_.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},I.prototype.flush=function(){for(var N=this.bytesWritten,P=0;P<this.dirRecords.length;P++)this.push({data:this.dirRecords[P],meta:{percent:100}});var _=this.bytesWritten-N,F=function(k,S,A,V,G){var le=f.transformTo("string",G(V));return T.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(k,2)+c(k,2)+c(S,4)+c(A,4)+c(le.length,2)+le}(this.dirRecords.length,_,N,this.zipComment,this.encodeFileName);this.push({data:F,meta:{percent:100}})},I.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},I.prototype.registerPrevious=function(N){this._sources.push(N);var P=this;return N.on("data",function(_){P.processChunk(_)}),N.on("end",function(){P.closedSource(P.previous.streamInfo),P._sources.length?P.prepareNextSource():P.end()}),N.on("error",function(_){P.error(_)}),this},I.prototype.resume=function(){return!!g.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},I.prototype.error=function(N){var P=this._sources;if(!g.prototype.error.call(this,N))return!1;for(var _=0;_<P.length;_++)try{P[_].error(N)}catch{}return!0},I.prototype.lock=function(){g.prototype.lock.call(this);for(var N=this._sources,P=0;P<N.length;P++)N[P].lock()},i.exports=I},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(r,i,a){var c=r("../compressions"),d=r("./ZipFileWorker");a.generateWorker=function(f,g,z){var $=new d(g.streamFiles,z,g.platform,g.encodeFileName),T=0;try{f.forEach(function(I,N){T++;var P=function(S,A){var V=S||A,G=c[V];if(!G)throw new Error(V+" is not a valid compression method !");return G}(N.options.compression,g.compression),_=N.options.compressionOptions||g.compressionOptions||{},F=N.dir,k=N.date;N._compressWorker(P,_).withStreamInfo("file",{name:I,dir:F,date:k,comment:N.comment||"",unixPermissions:N.unixPermissions,dosPermissions:N.dosPermissions}).pipe($)}),$.entriesCount=T}catch(I){$.error(I)}return $}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(r,i,a){function c(){if(!(this instanceof c))return new c;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var d=new c;for(var f in this)typeof this[f]!="function"&&(d[f]=this[f]);return d}}(c.prototype=r("./object")).loadAsync=r("./load"),c.support=r("./support"),c.defaults=r("./defaults"),c.version="3.10.1",c.loadAsync=function(d,f){return new c().loadAsync(d,f)},c.external=r("./external"),i.exports=c},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(r,i,a){var c=r("./utils"),d=r("./external"),f=r("./utf8"),g=r("./zipEntries"),z=r("./stream/Crc32Probe"),$=r("./nodejsUtils");function T(I){return new d.Promise(function(N,P){var _=I.decompressed.getContentWorker().pipe(new z);_.on("error",function(F){P(F)}).on("end",function(){_.streamInfo.crc32!==I.decompressed.crc32?P(new Error("Corrupted zip : CRC32 mismatch")):N()}).resume()})}i.exports=function(I,N){var P=this;return N=c.extend(N||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:f.utf8decode}),$.isNode&&$.isStream(I)?d.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):c.prepareContent("the loaded zip file",I,!0,N.optimizedBinaryString,N.base64).then(function(_){var F=new g(N);return F.load(_),F}).then(function(_){var F=[d.Promise.resolve(_)],k=_.files;if(N.checkCRC32)for(var S=0;S<k.length;S++)F.push(T(k[S]));return d.Promise.all(F)}).then(function(_){for(var F=_.shift(),k=F.files,S=0;S<k.length;S++){var A=k[S],V=A.fileNameStr,G=c.resolve(A.fileNameStr);P.file(G,A.decompressed,{binary:!0,optimizedBinaryString:!0,date:A.date,dir:A.dir,comment:A.fileCommentStr.length?A.fileCommentStr:null,unixPermissions:A.unixPermissions,dosPermissions:A.dosPermissions,createFolders:N.createFolders}),A.dir||(P.file(G).unsafeOriginalName=V)}return F.zipComment.length&&(P.comment=F.zipComment),P})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(r,i,a){var c=r("../utils"),d=r("../stream/GenericWorker");function f(g,z){d.call(this,"Nodejs stream input adapter for "+g),this._upstreamEnded=!1,this._bindStream(z)}c.inherits(f,d),f.prototype._bindStream=function(g){var z=this;(this._stream=g).pause(),g.on("data",function($){z.push({data:$,meta:{percent:0}})}).on("error",function($){z.isPaused?this.generatedError=$:z.error($)}).on("end",function(){z.isPaused?z._upstreamEnded=!0:z.end()})},f.prototype.pause=function(){return!!d.prototype.pause.call(this)&&(this._stream.pause(),!0)},f.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},i.exports=f},{"../stream/GenericWorker":28,"../utils":32}],13:[function(r,i,a){var c=r("readable-stream").Readable;function d(f,g,z){c.call(this,g),this._helper=f;var $=this;f.on("data",function(T,I){$.push(T)||$._helper.pause(),z&&z(I)}).on("error",function(T){$.emit("error",T)}).on("end",function(){$.push(null)})}r("../utils").inherits(d,c),d.prototype._read=function(){this._helper.resume()},i.exports=d},{"../utils":32,"readable-stream":16}],14:[function(r,i,a){i.exports={isNode:typeof Buffer<"u",newBufferFrom:function(c,d){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(c,d);if(typeof c=="number")throw new Error('The "data" argument must not be a number');return new Buffer(c,d)},allocBuffer:function(c){if(Buffer.alloc)return Buffer.alloc(c);var d=new Buffer(c);return d.fill(0),d},isBuffer:function(c){return Buffer.isBuffer(c)},isStream:function(c){return c&&typeof c.on=="function"&&typeof c.pause=="function"&&typeof c.resume=="function"}}},{}],15:[function(r,i,a){function c(G,le,re){var pe,be=f.getTypeOf(le),Ie=f.extend(re||{},$);Ie.date=Ie.date||new Date,Ie.compression!==null&&(Ie.compression=Ie.compression.toUpperCase()),typeof Ie.unixPermissions=="string"&&(Ie.unixPermissions=parseInt(Ie.unixPermissions,8)),Ie.unixPermissions&&16384&Ie.unixPermissions&&(Ie.dir=!0),Ie.dosPermissions&&16&Ie.dosPermissions&&(Ie.dir=!0),Ie.dir&&(G=k(G)),Ie.createFolders&&(pe=F(G))&&S.call(this,pe,!0);var qe=be==="string"&&Ie.binary===!1&&Ie.base64===!1;re&&re.binary!==void 0||(Ie.binary=!qe),(le instanceof T&&le.uncompressedSize===0||Ie.dir||!le||le.length===0)&&(Ie.base64=!1,Ie.binary=!0,le="",Ie.compression="STORE",be="string");var Q=null;Q=le instanceof T||le instanceof g?le:P.isNode&&P.isStream(le)?new _(G,le):f.prepareContent(G,le,Ie.binary,Ie.optimizedBinaryString,Ie.base64);var _e=new I(G,Q,Ie);this.files[G]=_e}var d=r("./utf8"),f=r("./utils"),g=r("./stream/GenericWorker"),z=r("./stream/StreamHelper"),$=r("./defaults"),T=r("./compressedObject"),I=r("./zipObject"),N=r("./generate"),P=r("./nodejsUtils"),_=r("./nodejs/NodejsStreamInputAdapter"),F=function(G){G.slice(-1)==="/"&&(G=G.substring(0,G.length-1));var le=G.lastIndexOf("/");return 0<le?G.substring(0,le):""},k=function(G){return G.slice(-1)!=="/"&&(G+="/"),G},S=function(G,le){return le=le!==void 0?le:$.createFolders,G=k(G),this.files[G]||c.call(this,G,null,{dir:!0,createFolders:le}),this.files[G]};function A(G){return Object.prototype.toString.call(G)==="[object RegExp]"}var V={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(G){var le,re,pe;for(le in this.files)pe=this.files[le],(re=le.slice(this.root.length,le.length))&&le.slice(0,this.root.length)===this.root&&G(re,pe)},filter:function(G){var le=[];return this.forEach(function(re,pe){G(re,pe)&&le.push(pe)}),le},file:function(G,le,re){if(arguments.length!==1)return G=this.root+G,c.call(this,G,le,re),this;if(A(G)){var pe=G;return this.filter(function(Ie,qe){return!qe.dir&&pe.test(Ie)})}var be=this.files[this.root+G];return be&&!be.dir?be:null},folder:function(G){if(!G)return this;if(A(G))return this.filter(function(be,Ie){return Ie.dir&&G.test(be)});var le=this.root+G,re=S.call(this,le),pe=this.clone();return pe.root=re.name,pe},remove:function(G){G=this.root+G;var le=this.files[G];if(le||(G.slice(-1)!=="/"&&(G+="/"),le=this.files[G]),le&&!le.dir)delete this.files[G];else for(var re=this.filter(function(be,Ie){return Ie.name.slice(0,G.length)===G}),pe=0;pe<re.length;pe++)delete this.files[re[pe].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(G){var le,re={};try{if((re=f.extend(G||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:d.utf8encode})).type=re.type.toLowerCase(),re.compression=re.compression.toUpperCase(),re.type==="binarystring"&&(re.type="string"),!re.type)throw new Error("No output type specified.");f.checkSupport(re.type),re.platform!=="darwin"&&re.platform!=="freebsd"&&re.platform!=="linux"&&re.platform!=="sunos"||(re.platform="UNIX"),re.platform==="win32"&&(re.platform="DOS");var pe=re.comment||this.comment||"";le=N.generateWorker(this,re,pe)}catch(be){(le=new g("error")).error(be)}return new z(le,re.type||"string",re.mimeType)},generateAsync:function(G,le){return this.generateInternalStream(G).accumulate(le)},generateNodeStream:function(G,le){return(G=G||{}).type||(G.type="nodebuffer"),this.generateInternalStream(G).toNodejsStream(le)}};i.exports=V},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(r,i,a){i.exports=r("stream")},{stream:void 0}],17:[function(r,i,a){var c=r("./DataReader");function d(f){c.call(this,f);for(var g=0;g<this.data.length;g++)f[g]=255&f[g]}r("../utils").inherits(d,c),d.prototype.byteAt=function(f){return this.data[this.zero+f]},d.prototype.lastIndexOfSignature=function(f){for(var g=f.charCodeAt(0),z=f.charCodeAt(1),$=f.charCodeAt(2),T=f.charCodeAt(3),I=this.length-4;0<=I;--I)if(this.data[I]===g&&this.data[I+1]===z&&this.data[I+2]===$&&this.data[I+3]===T)return I-this.zero;return-1},d.prototype.readAndCheckSignature=function(f){var g=f.charCodeAt(0),z=f.charCodeAt(1),$=f.charCodeAt(2),T=f.charCodeAt(3),I=this.readData(4);return g===I[0]&&z===I[1]&&$===I[2]&&T===I[3]},d.prototype.readData=function(f){if(this.checkOffset(f),f===0)return[];var g=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,g},i.exports=d},{"../utils":32,"./DataReader":18}],18:[function(r,i,a){var c=r("../utils");function d(f){this.data=f,this.length=f.length,this.index=0,this.zero=0}d.prototype={checkOffset:function(f){this.checkIndex(this.index+f)},checkIndex:function(f){if(this.length<this.zero+f||f<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+f+"). Corrupted zip ?")},setIndex:function(f){this.checkIndex(f),this.index=f},skip:function(f){this.setIndex(this.index+f)},byteAt:function(){},readInt:function(f){var g,z=0;for(this.checkOffset(f),g=this.index+f-1;g>=this.index;g--)z=(z<<8)+this.byteAt(g);return this.index+=f,z},readString:function(f){return c.transformTo("string",this.readData(f))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var f=this.readInt(4);return new Date(Date.UTC(1980+(f>>25&127),(f>>21&15)-1,f>>16&31,f>>11&31,f>>5&63,(31&f)<<1))}},i.exports=d},{"../utils":32}],19:[function(r,i,a){var c=r("./Uint8ArrayReader");function d(f){c.call(this,f)}r("../utils").inherits(d,c),d.prototype.readData=function(f){this.checkOffset(f);var g=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,g},i.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(r,i,a){var c=r("./DataReader");function d(f){c.call(this,f)}r("../utils").inherits(d,c),d.prototype.byteAt=function(f){return this.data.charCodeAt(this.zero+f)},d.prototype.lastIndexOfSignature=function(f){return this.data.lastIndexOf(f)-this.zero},d.prototype.readAndCheckSignature=function(f){return f===this.readData(4)},d.prototype.readData=function(f){this.checkOffset(f);var g=this.data.slice(this.zero+this.index,this.zero+this.index+f);return this.index+=f,g},i.exports=d},{"../utils":32,"./DataReader":18}],21:[function(r,i,a){var c=r("./ArrayReader");function d(f){c.call(this,f)}r("../utils").inherits(d,c),d.prototype.readData=function(f){if(this.checkOffset(f),f===0)return new Uint8Array(0);var g=this.data.subarray(this.zero+this.index,this.zero+this.index+f);return this.index+=f,g},i.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(r,i,a){var c=r("../utils"),d=r("../support"),f=r("./ArrayReader"),g=r("./StringReader"),z=r("./NodeBufferReader"),$=r("./Uint8ArrayReader");i.exports=function(T){var I=c.getTypeOf(T);return c.checkSupport(I),I!=="string"||d.uint8array?I==="nodebuffer"?new z(T):d.uint8array?new $(c.transformTo("uint8array",T)):new f(c.transformTo("array",T)):new g(T)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(r,i,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(r,i,a){var c=r("./GenericWorker"),d=r("../utils");function f(g){c.call(this,"ConvertWorker to "+g),this.destType=g}d.inherits(f,c),f.prototype.processChunk=function(g){this.push({data:d.transformTo(this.destType,g.data),meta:g.meta})},i.exports=f},{"../utils":32,"./GenericWorker":28}],25:[function(r,i,a){var c=r("./GenericWorker"),d=r("../crc32");function f(){c.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r("../utils").inherits(f,c),f.prototype.processChunk=function(g){this.streamInfo.crc32=d(g.data,this.streamInfo.crc32||0),this.push(g)},i.exports=f},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(r,i,a){var c=r("../utils"),d=r("./GenericWorker");function f(g){d.call(this,"DataLengthProbe for "+g),this.propName=g,this.withStreamInfo(g,0)}c.inherits(f,d),f.prototype.processChunk=function(g){if(g){var z=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=z+g.data.length}d.prototype.processChunk.call(this,g)},i.exports=f},{"../utils":32,"./GenericWorker":28}],27:[function(r,i,a){var c=r("../utils"),d=r("./GenericWorker");function f(g){d.call(this,"DataWorker");var z=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,g.then(function($){z.dataIsReady=!0,z.data=$,z.max=$&&$.length||0,z.type=c.getTypeOf($),z.isPaused||z._tickAndRepeat()},function($){z.error($)})}c.inherits(f,d),f.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this.data=null},f.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,c.delay(this._tickAndRepeat,[],this)),!0)},f.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(c.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},f.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var g=null,z=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":g=this.data.substring(this.index,z);break;case"uint8array":g=this.data.subarray(this.index,z);break;case"array":case"nodebuffer":g=this.data.slice(this.index,z)}return this.index=z,this.push({data:g,meta:{percent:this.max?this.index/this.max*100:0}})},i.exports=f},{"../utils":32,"./GenericWorker":28}],28:[function(r,i,a){function c(d){this.name=d||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}c.prototype={push:function(d){this.emit("data",d)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(d){this.emit("error",d)}return!0},error:function(d){return!this.isFinished&&(this.isPaused?this.generatedError=d:(this.isFinished=!0,this.emit("error",d),this.previous&&this.previous.error(d),this.cleanUp()),!0)},on:function(d,f){return this._listeners[d].push(f),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(d,f){if(this._listeners[d])for(var g=0;g<this._listeners[d].length;g++)this._listeners[d][g].call(this,f)},pipe:function(d){return d.registerPrevious(this)},registerPrevious:function(d){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=d.streamInfo,this.mergeStreamInfo(),this.previous=d;var f=this;return d.on("data",function(g){f.processChunk(g)}),d.on("end",function(){f.end()}),d.on("error",function(g){f.error(g)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var d=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),d=!0),this.previous&&this.previous.resume(),!d},flush:function(){},processChunk:function(d){this.push(d)},withStreamInfo:function(d,f){return this.extraStreamInfo[d]=f,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var d in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,d)&&(this.streamInfo[d]=this.extraStreamInfo[d])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var d="Worker "+this.name;return this.previous?this.previous+" -> "+d:d}},i.exports=c},{}],29:[function(r,i,a){var c=r("../utils"),d=r("./ConvertWorker"),f=r("./GenericWorker"),g=r("../base64"),z=r("../support"),$=r("../external"),T=null;if(z.nodestream)try{T=r("../nodejs/NodejsStreamOutputAdapter")}catch{}function I(P,_){return new $.Promise(function(F,k){var S=[],A=P._internalType,V=P._outputType,G=P._mimeType;P.on("data",function(le,re){S.push(le),_&&_(re)}).on("error",function(le){S=[],k(le)}).on("end",function(){try{var le=function(re,pe,be){switch(re){case"blob":return c.newBlob(c.transformTo("arraybuffer",pe),be);case"base64":return g.encode(pe);default:return c.transformTo(re,pe)}}(V,function(re,pe){var be,Ie=0,qe=null,Q=0;for(be=0;be<pe.length;be++)Q+=pe[be].length;switch(re){case"string":return pe.join("");case"array":return Array.prototype.concat.apply([],pe);case"uint8array":for(qe=new Uint8Array(Q),be=0;be<pe.length;be++)qe.set(pe[be],Ie),Ie+=pe[be].length;return qe;case"nodebuffer":return Buffer.concat(pe);default:throw new Error("concat : unsupported type '"+re+"'")}}(A,S),G);F(le)}catch(re){k(re)}S=[]}).resume()})}function N(P,_,F){var k=_;switch(_){case"blob":case"arraybuffer":k="uint8array";break;case"base64":k="string"}try{this._internalType=k,this._outputType=_,this._mimeType=F,c.checkSupport(k),this._worker=P.pipe(new d(k)),P.lock()}catch(S){this._worker=new f("error"),this._worker.error(S)}}N.prototype={accumulate:function(P){return I(this,P)},on:function(P,_){var F=this;return P==="data"?this._worker.on(P,function(k){_.call(F,k.data,k.meta)}):this._worker.on(P,function(){c.delay(_,arguments,F)}),this},resume:function(){return c.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(P){if(c.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new T(this,{objectMode:this._outputType!=="nodebuffer"},P)}},i.exports=N},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(r,i,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var c=new ArrayBuffer(0);try{a.blob=new Blob([c],{type:"application/zip"}).size===0}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);d.append(c),a.blob=d.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!r("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(r,i,a){for(var c=r("./utils"),d=r("./support"),f=r("./nodejsUtils"),g=r("./stream/GenericWorker"),z=new Array(256),$=0;$<256;$++)z[$]=252<=$?6:248<=$?5:240<=$?4:224<=$?3:192<=$?2:1;z[254]=z[254]=1;function T(){g.call(this,"utf-8 decode"),this.leftOver=null}function I(){g.call(this,"utf-8 encode")}a.utf8encode=function(N){return d.nodebuffer?f.newBufferFrom(N,"utf-8"):function(P){var _,F,k,S,A,V=P.length,G=0;for(S=0;S<V;S++)(64512&(F=P.charCodeAt(S)))==55296&&S+1<V&&(64512&(k=P.charCodeAt(S+1)))==56320&&(F=65536+(F-55296<<10)+(k-56320),S++),G+=F<128?1:F<2048?2:F<65536?3:4;for(_=d.uint8array?new Uint8Array(G):new Array(G),S=A=0;A<G;S++)(64512&(F=P.charCodeAt(S)))==55296&&S+1<V&&(64512&(k=P.charCodeAt(S+1)))==56320&&(F=65536+(F-55296<<10)+(k-56320),S++),F<128?_[A++]=F:(F<2048?_[A++]=192|F>>>6:(F<65536?_[A++]=224|F>>>12:(_[A++]=240|F>>>18,_[A++]=128|F>>>12&63),_[A++]=128|F>>>6&63),_[A++]=128|63&F);return _}(N)},a.utf8decode=function(N){return d.nodebuffer?c.transformTo("nodebuffer",N).toString("utf-8"):function(P){var _,F,k,S,A=P.length,V=new Array(2*A);for(_=F=0;_<A;)if((k=P[_++])<128)V[F++]=k;else if(4<(S=z[k]))V[F++]=65533,_+=S-1;else{for(k&=S===2?31:S===3?15:7;1<S&&_<A;)k=k<<6|63&P[_++],S--;1<S?V[F++]=65533:k<65536?V[F++]=k:(k-=65536,V[F++]=55296|k>>10&1023,V[F++]=56320|1023&k)}return V.length!==F&&(V.subarray?V=V.subarray(0,F):V.length=F),c.applyFromCharCode(V)}(N=c.transformTo(d.uint8array?"uint8array":"array",N))},c.inherits(T,g),T.prototype.processChunk=function(N){var P=c.transformTo(d.uint8array?"uint8array":"array",N.data);if(this.leftOver&&this.leftOver.length){if(d.uint8array){var _=P;(P=new Uint8Array(_.length+this.leftOver.length)).set(this.leftOver,0),P.set(_,this.leftOver.length)}else P=this.leftOver.concat(P);this.leftOver=null}var F=function(S,A){var V;for((A=A||S.length)>S.length&&(A=S.length),V=A-1;0<=V&&(192&S[V])==128;)V--;return V<0||V===0?A:V+z[S[V]]>A?V:A}(P),k=P;F!==P.length&&(d.uint8array?(k=P.subarray(0,F),this.leftOver=P.subarray(F,P.length)):(k=P.slice(0,F),this.leftOver=P.slice(F,P.length))),this.push({data:a.utf8decode(k),meta:N.meta})},T.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=T,c.inherits(I,g),I.prototype.processChunk=function(N){this.push({data:a.utf8encode(N.data),meta:N.meta})},a.Utf8EncodeWorker=I},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(r,i,a){var c=r("./support"),d=r("./base64"),f=r("./nodejsUtils"),g=r("./external");function z(_){return _}function $(_,F){for(var k=0;k<_.length;++k)F[k]=255&_.charCodeAt(k);return F}r("setimmediate"),a.newBlob=function(_,F){a.checkSupport("blob");try{return new Blob([_],{type:F})}catch{try{var k=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return k.append(_),k.getBlob(F)}catch{throw new Error("Bug : can't construct the Blob.")}}};var T={stringifyByChunk:function(_,F,k){var S=[],A=0,V=_.length;if(V<=k)return String.fromCharCode.apply(null,_);for(;A<V;)F==="array"||F==="nodebuffer"?S.push(String.fromCharCode.apply(null,_.slice(A,Math.min(A+k,V)))):S.push(String.fromCharCode.apply(null,_.subarray(A,Math.min(A+k,V)))),A+=k;return S.join("")},stringifyByChar:function(_){for(var F="",k=0;k<_.length;k++)F+=String.fromCharCode(_[k]);return F},applyCanBeUsed:{uint8array:function(){try{return c.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return c.nodebuffer&&String.fromCharCode.apply(null,f.allocBuffer(1)).length===1}catch{return!1}}()}};function I(_){var F=65536,k=a.getTypeOf(_),S=!0;if(k==="uint8array"?S=T.applyCanBeUsed.uint8array:k==="nodebuffer"&&(S=T.applyCanBeUsed.nodebuffer),S)for(;1<F;)try{return T.stringifyByChunk(_,k,F)}catch{F=Math.floor(F/2)}return T.stringifyByChar(_)}function N(_,F){for(var k=0;k<_.length;k++)F[k]=_[k];return F}a.applyFromCharCode=I;var P={};P.string={string:z,array:function(_){return $(_,new Array(_.length))},arraybuffer:function(_){return P.string.uint8array(_).buffer},uint8array:function(_){return $(_,new Uint8Array(_.length))},nodebuffer:function(_){return $(_,f.allocBuffer(_.length))}},P.array={string:I,array:z,arraybuffer:function(_){return new Uint8Array(_).buffer},uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return f.newBufferFrom(_)}},P.arraybuffer={string:function(_){return I(new Uint8Array(_))},array:function(_){return N(new Uint8Array(_),new Array(_.byteLength))},arraybuffer:z,uint8array:function(_){return new Uint8Array(_)},nodebuffer:function(_){return f.newBufferFrom(new Uint8Array(_))}},P.uint8array={string:I,array:function(_){return N(_,new Array(_.length))},arraybuffer:function(_){return _.buffer},uint8array:z,nodebuffer:function(_){return f.newBufferFrom(_)}},P.nodebuffer={string:I,array:function(_){return N(_,new Array(_.length))},arraybuffer:function(_){return P.nodebuffer.uint8array(_).buffer},uint8array:function(_){return N(_,new Uint8Array(_.length))},nodebuffer:z},a.transformTo=function(_,F){if(F=F||"",!_)return F;a.checkSupport(_);var k=a.getTypeOf(F);return P[k][_](F)},a.resolve=function(_){for(var F=_.split("/"),k=[],S=0;S<F.length;S++){var A=F[S];A==="."||A===""&&S!==0&&S!==F.length-1||(A===".."?k.pop():k.push(A))}return k.join("/")},a.getTypeOf=function(_){return typeof _=="string"?"string":Object.prototype.toString.call(_)==="[object Array]"?"array":c.nodebuffer&&f.isBuffer(_)?"nodebuffer":c.uint8array&&_ instanceof Uint8Array?"uint8array":c.arraybuffer&&_ instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(_){if(!c[_.toLowerCase()])throw new Error(_+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(_){var F,k,S="";for(k=0;k<(_||"").length;k++)S+="\\x"+((F=_.charCodeAt(k))<16?"0":"")+F.toString(16).toUpperCase();return S},a.delay=function(_,F,k){setImmediate(function(){_.apply(k||null,F||[])})},a.inherits=function(_,F){function k(){}k.prototype=F.prototype,_.prototype=new k},a.extend=function(){var _,F,k={};for(_=0;_<arguments.length;_++)for(F in arguments[_])Object.prototype.hasOwnProperty.call(arguments[_],F)&&k[F]===void 0&&(k[F]=arguments[_][F]);return k},a.prepareContent=function(_,F,k,S,A){return g.Promise.resolve(F).then(function(V){return c.blob&&(V instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(V))!==-1)&&typeof FileReader<"u"?new g.Promise(function(G,le){var re=new FileReader;re.onload=function(pe){G(pe.target.result)},re.onerror=function(pe){le(pe.target.error)},re.readAsArrayBuffer(V)}):V}).then(function(V){var G=a.getTypeOf(V);return G?(G==="arraybuffer"?V=a.transformTo("uint8array",V):G==="string"&&(A?V=d.decode(V):k&&S!==!0&&(V=function(le){return $(le,c.uint8array?new Uint8Array(le.length):new Array(le.length))}(V))),V):g.Promise.reject(new Error("Can't read the data of '"+_+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(r,i,a){var c=r("./reader/readerFor"),d=r("./utils"),f=r("./signature"),g=r("./zipEntry"),z=r("./support");function $(T){this.files=[],this.loadOptions=T}$.prototype={checkSignature:function(T){if(!this.reader.readAndCheckSignature(T)){this.reader.index-=4;var I=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+d.pretty(I)+", expected "+d.pretty(T)+")")}},isSignature:function(T,I){var N=this.reader.index;this.reader.setIndex(T);var P=this.reader.readString(4)===I;return this.reader.setIndex(N),P},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var T=this.reader.readData(this.zipCommentLength),I=z.uint8array?"uint8array":"array",N=d.transformTo(I,T);this.zipComment=this.loadOptions.decodeFileName(N)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var T,I,N,P=this.zip64EndOfCentralSize-44;0<P;)T=this.reader.readInt(2),I=this.reader.readInt(4),N=this.reader.readData(I),this.zip64ExtensibleData[T]={id:T,length:I,value:N}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var T,I;for(T=0;T<this.files.length;T++)I=this.files[T],this.reader.setIndex(I.localHeaderOffset),this.checkSignature(f.LOCAL_FILE_HEADER),I.readLocalPart(this.reader),I.handleUTF8(),I.processAttributes()},readCentralDir:function(){var T;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(f.CENTRAL_FILE_HEADER);)(T=new g({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(T);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var T=this.reader.lastIndexOfSignature(f.CENTRAL_DIRECTORY_END);if(T<0)throw this.isSignature(0,f.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(T);var I=T;if(this.checkSignature(f.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===d.MAX_VALUE_16BITS||this.diskWithCentralDirStart===d.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===d.MAX_VALUE_16BITS||this.centralDirRecords===d.MAX_VALUE_16BITS||this.centralDirSize===d.MAX_VALUE_32BITS||this.centralDirOffset===d.MAX_VALUE_32BITS){if(this.zip64=!0,(T=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(T),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,f.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(f.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var N=this.centralDirOffset+this.centralDirSize;this.zip64&&(N+=20,N+=12+this.zip64EndOfCentralSize);var P=I-N;if(0<P)this.isSignature(I,f.CENTRAL_FILE_HEADER)||(this.reader.zero=P);else if(P<0)throw new Error("Corrupted zip: missing "+Math.abs(P)+" bytes.")},prepareReader:function(T){this.reader=c(T)},load:function(T){this.prepareReader(T),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},i.exports=$},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(r,i,a){var c=r("./reader/readerFor"),d=r("./utils"),f=r("./compressedObject"),g=r("./crc32"),z=r("./utf8"),$=r("./compressions"),T=r("./support");function I(N,P){this.options=N,this.loadOptions=P}I.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(N){var P,_;if(N.skip(22),this.fileNameLength=N.readInt(2),_=N.readInt(2),this.fileName=N.readData(this.fileNameLength),N.skip(_),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((P=function(F){for(var k in $)if(Object.prototype.hasOwnProperty.call($,k)&&$[k].magic===F)return $[k];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+d.pretty(this.compressionMethod)+" unknown (inner file : "+d.transformTo("string",this.fileName)+")");this.decompressed=new f(this.compressedSize,this.uncompressedSize,this.crc32,P,N.readData(this.compressedSize))},readCentralPart:function(N){this.versionMadeBy=N.readInt(2),N.skip(2),this.bitFlag=N.readInt(2),this.compressionMethod=N.readString(2),this.date=N.readDate(),this.crc32=N.readInt(4),this.compressedSize=N.readInt(4),this.uncompressedSize=N.readInt(4);var P=N.readInt(2);if(this.extraFieldsLength=N.readInt(2),this.fileCommentLength=N.readInt(2),this.diskNumberStart=N.readInt(2),this.internalFileAttributes=N.readInt(2),this.externalFileAttributes=N.readInt(4),this.localHeaderOffset=N.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");N.skip(P),this.readExtraFields(N),this.parseZIP64ExtraField(N),this.fileComment=N.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var N=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),N==0&&(this.dosPermissions=63&this.externalFileAttributes),N==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var N=c(this.extraFields[1].value);this.uncompressedSize===d.MAX_VALUE_32BITS&&(this.uncompressedSize=N.readInt(8)),this.compressedSize===d.MAX_VALUE_32BITS&&(this.compressedSize=N.readInt(8)),this.localHeaderOffset===d.MAX_VALUE_32BITS&&(this.localHeaderOffset=N.readInt(8)),this.diskNumberStart===d.MAX_VALUE_32BITS&&(this.diskNumberStart=N.readInt(4))}},readExtraFields:function(N){var P,_,F,k=N.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});N.index+4<k;)P=N.readInt(2),_=N.readInt(2),F=N.readData(_),this.extraFields[P]={id:P,length:_,value:F};N.setIndex(k)},handleUTF8:function(){var N=T.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=z.utf8decode(this.fileName),this.fileCommentStr=z.utf8decode(this.fileComment);else{var P=this.findExtraFieldUnicodePath();if(P!==null)this.fileNameStr=P;else{var _=d.transformTo(N,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(_)}var F=this.findExtraFieldUnicodeComment();if(F!==null)this.fileCommentStr=F;else{var k=d.transformTo(N,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(k)}}},findExtraFieldUnicodePath:function(){var N=this.extraFields[28789];if(N){var P=c(N.value);return P.readInt(1)!==1||g(this.fileName)!==P.readInt(4)?null:z.utf8decode(P.readData(N.length-5))}return null},findExtraFieldUnicodeComment:function(){var N=this.extraFields[25461];if(N){var P=c(N.value);return P.readInt(1)!==1||g(this.fileComment)!==P.readInt(4)?null:z.utf8decode(P.readData(N.length-5))}return null}},i.exports=I},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(r,i,a){function c(P,_,F){this.name=P,this.dir=F.dir,this.date=F.date,this.comment=F.comment,this.unixPermissions=F.unixPermissions,this.dosPermissions=F.dosPermissions,this._data=_,this._dataBinary=F.binary,this.options={compression:F.compression,compressionOptions:F.compressionOptions}}var d=r("./stream/StreamHelper"),f=r("./stream/DataWorker"),g=r("./utf8"),z=r("./compressedObject"),$=r("./stream/GenericWorker");c.prototype={internalStream:function(P){var _=null,F="string";try{if(!P)throw new Error("No output type specified.");var k=(F=P.toLowerCase())==="string"||F==="text";F!=="binarystring"&&F!=="text"||(F="string"),_=this._decompressWorker();var S=!this._dataBinary;S&&!k&&(_=_.pipe(new g.Utf8EncodeWorker)),!S&&k&&(_=_.pipe(new g.Utf8DecodeWorker))}catch(A){(_=new $("error")).error(A)}return new d(_,F,"")},async:function(P,_){return this.internalStream(P).accumulate(_)},nodeStream:function(P,_){return this.internalStream(P||"nodebuffer").toNodejsStream(_)},_compressWorker:function(P,_){if(this._data instanceof z&&this._data.compression.magic===P.magic)return this._data.getCompressedWorker();var F=this._decompressWorker();return this._dataBinary||(F=F.pipe(new g.Utf8EncodeWorker)),z.createWorkerFrom(F,P,_)},_decompressWorker:function(){return this._data instanceof z?this._data.getContentWorker():this._data instanceof $?this._data:new f(this._data)}};for(var T=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],I=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},N=0;N<T.length;N++)c.prototype[T[N]]=I;i.exports=c},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(r,i,a){(function(c){var d,f,g=c.MutationObserver||c.WebKitMutationObserver;if(g){var z=0,$=new g(P),T=c.document.createTextNode("");$.observe(T,{characterData:!0}),d=function(){T.data=z=++z%2}}else if(c.setImmediate||c.MessageChannel===void 0)d="document"in c&&"onreadystatechange"in c.document.createElement("script")?function(){var _=c.document.createElement("script");_.onreadystatechange=function(){P(),_.onreadystatechange=null,_.parentNode.removeChild(_),_=null},c.document.documentElement.appendChild(_)}:function(){setTimeout(P,0)};else{var I=new c.MessageChannel;I.port1.onmessage=P,d=function(){I.port2.postMessage(0)}}var N=[];function P(){var _,F;f=!0;for(var k=N.length;k;){for(F=N,N=[],_=-1;++_<k;)F[_]();k=N.length}f=!1}i.exports=function(_){N.push(_)!==1||f||d()}}).call(this,typeof No<"u"?No:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(r,i,a){var c=r("immediate");function d(){}var f={},g=["REJECTED"],z=["FULFILLED"],$=["PENDING"];function T(k){if(typeof k!="function")throw new TypeError("resolver must be a function");this.state=$,this.queue=[],this.outcome=void 0,k!==d&&_(this,k)}function I(k,S,A){this.promise=k,typeof S=="function"&&(this.onFulfilled=S,this.callFulfilled=this.otherCallFulfilled),typeof A=="function"&&(this.onRejected=A,this.callRejected=this.otherCallRejected)}function N(k,S,A){c(function(){var V;try{V=S(A)}catch(G){return f.reject(k,G)}V===k?f.reject(k,new TypeError("Cannot resolve promise with itself")):f.resolve(k,V)})}function P(k){var S=k&&k.then;if(k&&(typeof k=="object"||typeof k=="function")&&typeof S=="function")return function(){S.apply(k,arguments)}}function _(k,S){var A=!1;function V(re){A||(A=!0,f.reject(k,re))}function G(re){A||(A=!0,f.resolve(k,re))}var le=F(function(){S(G,V)});le.status==="error"&&V(le.value)}function F(k,S){var A={};try{A.value=k(S),A.status="success"}catch(V){A.status="error",A.value=V}return A}(i.exports=T).prototype.finally=function(k){if(typeof k!="function")return this;var S=this.constructor;return this.then(function(A){return S.resolve(k()).then(function(){return A})},function(A){return S.resolve(k()).then(function(){throw A})})},T.prototype.catch=function(k){return this.then(null,k)},T.prototype.then=function(k,S){if(typeof k!="function"&&this.state===z||typeof S!="function"&&this.state===g)return this;var A=new this.constructor(d);return this.state!==$?N(A,this.state===z?k:S,this.outcome):this.queue.push(new I(A,k,S)),A},I.prototype.callFulfilled=function(k){f.resolve(this.promise,k)},I.prototype.otherCallFulfilled=function(k){N(this.promise,this.onFulfilled,k)},I.prototype.callRejected=function(k){f.reject(this.promise,k)},I.prototype.otherCallRejected=function(k){N(this.promise,this.onRejected,k)},f.resolve=function(k,S){var A=F(P,S);if(A.status==="error")return f.reject(k,A.value);var V=A.value;if(V)_(k,V);else{k.state=z,k.outcome=S;for(var G=-1,le=k.queue.length;++G<le;)k.queue[G].callFulfilled(S)}return k},f.reject=function(k,S){k.state=g,k.outcome=S;for(var A=-1,V=k.queue.length;++A<V;)k.queue[A].callRejected(S);return k},T.resolve=function(k){return k instanceof this?k:f.resolve(new this(d),k)},T.reject=function(k){var S=new this(d);return f.reject(S,k)},T.all=function(k){var S=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=k.length,V=!1;if(!A)return this.resolve([]);for(var G=new Array(A),le=0,re=-1,pe=new this(d);++re<A;)be(k[re],re);return pe;function be(Ie,qe){S.resolve(Ie).then(function(Q){G[qe]=Q,++le!==A||V||(V=!0,f.resolve(pe,G))},function(Q){V||(V=!0,f.reject(pe,Q))})}},T.race=function(k){var S=this;if(Object.prototype.toString.call(k)!=="[object Array]")return this.reject(new TypeError("must be an array"));var A=k.length,V=!1;if(!A)return this.resolve([]);for(var G=-1,le=new this(d);++G<A;)re=k[G],S.resolve(re).then(function(pe){V||(V=!0,f.resolve(le,pe))},function(pe){V||(V=!0,f.reject(le,pe))});var re;return le}},{immediate:36}],38:[function(r,i,a){var c={};(0,r("./lib/utils/common").assign)(c,r("./lib/deflate"),r("./lib/inflate"),r("./lib/zlib/constants")),i.exports=c},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(r,i,a){var c=r("./zlib/deflate"),d=r("./utils/common"),f=r("./utils/strings"),g=r("./zlib/messages"),z=r("./zlib/zstream"),$=Object.prototype.toString,T=0,I=-1,N=0,P=8;function _(k){if(!(this instanceof _))return new _(k);this.options=d.assign({level:I,method:P,chunkSize:16384,windowBits:15,memLevel:8,strategy:N,to:""},k||{});var S=this.options;S.raw&&0<S.windowBits?S.windowBits=-S.windowBits:S.gzip&&0<S.windowBits&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new z,this.strm.avail_out=0;var A=c.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(A!==T)throw new Error(g[A]);if(S.header&&c.deflateSetHeader(this.strm,S.header),S.dictionary){var V;if(V=typeof S.dictionary=="string"?f.string2buf(S.dictionary):$.call(S.dictionary)==="[object ArrayBuffer]"?new Uint8Array(S.dictionary):S.dictionary,(A=c.deflateSetDictionary(this.strm,V))!==T)throw new Error(g[A]);this._dict_set=!0}}function F(k,S){var A=new _(S);if(A.push(k,!0),A.err)throw A.msg||g[A.err];return A.result}_.prototype.push=function(k,S){var A,V,G=this.strm,le=this.options.chunkSize;if(this.ended)return!1;V=S===~~S?S:S===!0?4:0,typeof k=="string"?G.input=f.string2buf(k):$.call(k)==="[object ArrayBuffer]"?G.input=new Uint8Array(k):G.input=k,G.next_in=0,G.avail_in=G.input.length;do{if(G.avail_out===0&&(G.output=new d.Buf8(le),G.next_out=0,G.avail_out=le),(A=c.deflate(G,V))!==1&&A!==T)return this.onEnd(A),!(this.ended=!0);G.avail_out!==0&&(G.avail_in!==0||V!==4&&V!==2)||(this.options.to==="string"?this.onData(f.buf2binstring(d.shrinkBuf(G.output,G.next_out))):this.onData(d.shrinkBuf(G.output,G.next_out)))}while((0<G.avail_in||G.avail_out===0)&&A!==1);return V===4?(A=c.deflateEnd(this.strm),this.onEnd(A),this.ended=!0,A===T):V!==2||(this.onEnd(T),!(G.avail_out=0))},_.prototype.onData=function(k){this.chunks.push(k)},_.prototype.onEnd=function(k){k===T&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=k,this.msg=this.strm.msg},a.Deflate=_,a.deflate=F,a.deflateRaw=function(k,S){return(S=S||{}).raw=!0,F(k,S)},a.gzip=function(k,S){return(S=S||{}).gzip=!0,F(k,S)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(r,i,a){var c=r("./zlib/inflate"),d=r("./utils/common"),f=r("./utils/strings"),g=r("./zlib/constants"),z=r("./zlib/messages"),$=r("./zlib/zstream"),T=r("./zlib/gzheader"),I=Object.prototype.toString;function N(_){if(!(this instanceof N))return new N(_);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},_||{});var F=this.options;F.raw&&0<=F.windowBits&&F.windowBits<16&&(F.windowBits=-F.windowBits,F.windowBits===0&&(F.windowBits=-15)),!(0<=F.windowBits&&F.windowBits<16)||_&&_.windowBits||(F.windowBits+=32),15<F.windowBits&&F.windowBits<48&&!(15&F.windowBits)&&(F.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $,this.strm.avail_out=0;var k=c.inflateInit2(this.strm,F.windowBits);if(k!==g.Z_OK)throw new Error(z[k]);this.header=new T,c.inflateGetHeader(this.strm,this.header)}function P(_,F){var k=new N(F);if(k.push(_,!0),k.err)throw k.msg||z[k.err];return k.result}N.prototype.push=function(_,F){var k,S,A,V,G,le,re=this.strm,pe=this.options.chunkSize,be=this.options.dictionary,Ie=!1;if(this.ended)return!1;S=F===~~F?F:F===!0?g.Z_FINISH:g.Z_NO_FLUSH,typeof _=="string"?re.input=f.binstring2buf(_):I.call(_)==="[object ArrayBuffer]"?re.input=new Uint8Array(_):re.input=_,re.next_in=0,re.avail_in=re.input.length;do{if(re.avail_out===0&&(re.output=new d.Buf8(pe),re.next_out=0,re.avail_out=pe),(k=c.inflate(re,g.Z_NO_FLUSH))===g.Z_NEED_DICT&&be&&(le=typeof be=="string"?f.string2buf(be):I.call(be)==="[object ArrayBuffer]"?new Uint8Array(be):be,k=c.inflateSetDictionary(this.strm,le)),k===g.Z_BUF_ERROR&&Ie===!0&&(k=g.Z_OK,Ie=!1),k!==g.Z_STREAM_END&&k!==g.Z_OK)return this.onEnd(k),!(this.ended=!0);re.next_out&&(re.avail_out!==0&&k!==g.Z_STREAM_END&&(re.avail_in!==0||S!==g.Z_FINISH&&S!==g.Z_SYNC_FLUSH)||(this.options.to==="string"?(A=f.utf8border(re.output,re.next_out),V=re.next_out-A,G=f.buf2string(re.output,A),re.next_out=V,re.avail_out=pe-V,V&&d.arraySet(re.output,re.output,A,V,0),this.onData(G)):this.onData(d.shrinkBuf(re.output,re.next_out)))),re.avail_in===0&&re.avail_out===0&&(Ie=!0)}while((0<re.avail_in||re.avail_out===0)&&k!==g.Z_STREAM_END);return k===g.Z_STREAM_END&&(S=g.Z_FINISH),S===g.Z_FINISH?(k=c.inflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===g.Z_OK):S!==g.Z_SYNC_FLUSH||(this.onEnd(g.Z_OK),!(re.avail_out=0))},N.prototype.onData=function(_){this.chunks.push(_)},N.prototype.onEnd=function(_){_===g.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},a.Inflate=N,a.inflate=P,a.inflateRaw=function(_,F){return(F=F||{}).raw=!0,P(_,F)},a.ungzip=P},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(r,i,a){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(g){for(var z=Array.prototype.slice.call(arguments,1);z.length;){var $=z.shift();if($){if(typeof $!="object")throw new TypeError($+"must be non-object");for(var T in $)$.hasOwnProperty(T)&&(g[T]=$[T])}}return g},a.shrinkBuf=function(g,z){return g.length===z?g:g.subarray?g.subarray(0,z):(g.length=z,g)};var d={arraySet:function(g,z,$,T,I){if(z.subarray&&g.subarray)g.set(z.subarray($,$+T),I);else for(var N=0;N<T;N++)g[I+N]=z[$+N]},flattenChunks:function(g){var z,$,T,I,N,P;for(z=T=0,$=g.length;z<$;z++)T+=g[z].length;for(P=new Uint8Array(T),z=I=0,$=g.length;z<$;z++)N=g[z],P.set(N,I),I+=N.length;return P}},f={arraySet:function(g,z,$,T,I){for(var N=0;N<T;N++)g[I+N]=z[$+N]},flattenChunks:function(g){return[].concat.apply([],g)}};a.setTyped=function(g){g?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,d)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,f))},a.setTyped(c)},{}],42:[function(r,i,a){var c=r("./common"),d=!0,f=!0;try{String.fromCharCode.apply(null,[0])}catch{d=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{f=!1}for(var g=new c.Buf8(256),z=0;z<256;z++)g[z]=252<=z?6:248<=z?5:240<=z?4:224<=z?3:192<=z?2:1;function $(T,I){if(I<65537&&(T.subarray&&f||!T.subarray&&d))return String.fromCharCode.apply(null,c.shrinkBuf(T,I));for(var N="",P=0;P<I;P++)N+=String.fromCharCode(T[P]);return N}g[254]=g[254]=1,a.string2buf=function(T){var I,N,P,_,F,k=T.length,S=0;for(_=0;_<k;_++)(64512&(N=T.charCodeAt(_)))==55296&&_+1<k&&(64512&(P=T.charCodeAt(_+1)))==56320&&(N=65536+(N-55296<<10)+(P-56320),_++),S+=N<128?1:N<2048?2:N<65536?3:4;for(I=new c.Buf8(S),_=F=0;F<S;_++)(64512&(N=T.charCodeAt(_)))==55296&&_+1<k&&(64512&(P=T.charCodeAt(_+1)))==56320&&(N=65536+(N-55296<<10)+(P-56320),_++),N<128?I[F++]=N:(N<2048?I[F++]=192|N>>>6:(N<65536?I[F++]=224|N>>>12:(I[F++]=240|N>>>18,I[F++]=128|N>>>12&63),I[F++]=128|N>>>6&63),I[F++]=128|63&N);return I},a.buf2binstring=function(T){return $(T,T.length)},a.binstring2buf=function(T){for(var I=new c.Buf8(T.length),N=0,P=I.length;N<P;N++)I[N]=T.charCodeAt(N);return I},a.buf2string=function(T,I){var N,P,_,F,k=I||T.length,S=new Array(2*k);for(N=P=0;N<k;)if((_=T[N++])<128)S[P++]=_;else if(4<(F=g[_]))S[P++]=65533,N+=F-1;else{for(_&=F===2?31:F===3?15:7;1<F&&N<k;)_=_<<6|63&T[N++],F--;1<F?S[P++]=65533:_<65536?S[P++]=_:(_-=65536,S[P++]=55296|_>>10&1023,S[P++]=56320|1023&_)}return $(S,P)},a.utf8border=function(T,I){var N;for((I=I||T.length)>T.length&&(I=T.length),N=I-1;0<=N&&(192&T[N])==128;)N--;return N<0||N===0?I:N+g[T[N]]>I?N:I}},{"./common":41}],43:[function(r,i,a){i.exports=function(c,d,f,g){for(var z=65535&c|0,$=c>>>16&65535|0,T=0;f!==0;){for(f-=T=2e3<f?2e3:f;$=$+(z=z+d[g++]|0)|0,--T;);z%=65521,$%=65521}return z|$<<16|0}},{}],44:[function(r,i,a){i.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(r,i,a){var c=function(){for(var d,f=[],g=0;g<256;g++){d=g;for(var z=0;z<8;z++)d=1&d?3988292384^d>>>1:d>>>1;f[g]=d}return f}();i.exports=function(d,f,g,z){var $=c,T=z+g;d^=-1;for(var I=z;I<T;I++)d=d>>>8^$[255&(d^f[I])];return-1^d}},{}],46:[function(r,i,a){var c,d=r("../utils/common"),f=r("./trees"),g=r("./adler32"),z=r("./crc32"),$=r("./messages"),T=0,I=4,N=0,P=-2,_=-1,F=4,k=2,S=8,A=9,V=286,G=30,le=19,re=2*V+1,pe=15,be=3,Ie=258,qe=Ie+be+1,Q=42,_e=113,D=1,Te=2,Lt=3,ye=4;function ke(E,Ce){return E.msg=$[Ce],Ce}function he(E){return(E<<1)-(4<E?9:0)}function Oe(E){for(var Ce=E.length;0<=--Ce;)E[Ce]=0}function ae(E){var Ce=E.state,xe=Ce.pending;xe>E.avail_out&&(xe=E.avail_out),xe!==0&&(d.arraySet(E.output,Ce.pending_buf,Ce.pending_out,xe,E.next_out),E.next_out+=xe,Ce.pending_out+=xe,E.total_out+=xe,E.avail_out-=xe,Ce.pending-=xe,Ce.pending===0&&(Ce.pending_out=0))}function fe(E,Ce){f._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,Ce),E.block_start=E.strstart,ae(E.strm)}function ut(E,Ce){E.pending_buf[E.pending++]=Ce}function ot(E,Ce){E.pending_buf[E.pending++]=Ce>>>8&255,E.pending_buf[E.pending++]=255&Ce}function Ue(E,Ce){var xe,X,K=E.max_chain_length,de=E.strstart,Re=E.prev_length,je=E.nice_match,ve=E.strstart>E.w_size-qe?E.strstart-(E.w_size-qe):0,Pe=E.window,ft=E.w_mask,We=E.prev,Pt=E.strstart+Ie,fn=Pe[de+Re-1],vn=Pe[de+Re];E.prev_length>=E.good_match&&(K>>=2),je>E.lookahead&&(je=E.lookahead);do if(Pe[(xe=Ce)+Re]===vn&&Pe[xe+Re-1]===fn&&Pe[xe]===Pe[de]&&Pe[++xe]===Pe[de+1]){de+=2,xe++;do;while(Pe[++de]===Pe[++xe]&&Pe[++de]===Pe[++xe]&&Pe[++de]===Pe[++xe]&&Pe[++de]===Pe[++xe]&&Pe[++de]===Pe[++xe]&&Pe[++de]===Pe[++xe]&&Pe[++de]===Pe[++xe]&&Pe[++de]===Pe[++xe]&&de<Pt);if(X=Ie-(Pt-de),de=Pt-Ie,Re<X){if(E.match_start=Ce,je<=(Re=X))break;fn=Pe[de+Re-1],vn=Pe[de+Re]}}while((Ce=We[Ce&ft])>ve&&--K!=0);return Re<=E.lookahead?Re:E.lookahead}function Xe(E){var Ce,xe,X,K,de,Re,je,ve,Pe,ft,We=E.w_size;do{if(K=E.window_size-E.lookahead-E.strstart,E.strstart>=We+(We-qe)){for(d.arraySet(E.window,E.window,We,We,0),E.match_start-=We,E.strstart-=We,E.block_start-=We,Ce=xe=E.hash_size;X=E.head[--Ce],E.head[Ce]=We<=X?X-We:0,--xe;);for(Ce=xe=We;X=E.prev[--Ce],E.prev[Ce]=We<=X?X-We:0,--xe;);K+=We}if(E.strm.avail_in===0)break;if(Re=E.strm,je=E.window,ve=E.strstart+E.lookahead,Pe=K,ft=void 0,ft=Re.avail_in,Pe<ft&&(ft=Pe),xe=ft===0?0:(Re.avail_in-=ft,d.arraySet(je,Re.input,Re.next_in,ft,ve),Re.state.wrap===1?Re.adler=g(Re.adler,je,ft,ve):Re.state.wrap===2&&(Re.adler=z(Re.adler,je,ft,ve)),Re.next_in+=ft,Re.total_in+=ft,ft),E.lookahead+=xe,E.lookahead+E.insert>=be)for(de=E.strstart-E.insert,E.ins_h=E.window[de],E.ins_h=(E.ins_h<<E.hash_shift^E.window[de+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[de+be-1])&E.hash_mask,E.prev[de&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=de,de++,E.insert--,!(E.lookahead+E.insert<be)););}while(E.lookahead<qe&&E.strm.avail_in!==0)}function en(E,Ce){for(var xe,X;;){if(E.lookahead<qe){if(Xe(E),E.lookahead<qe&&Ce===T)return D;if(E.lookahead===0)break}if(xe=0,E.lookahead>=be&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+be-1])&E.hash_mask,xe=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),xe!==0&&E.strstart-xe<=E.w_size-qe&&(E.match_length=Ue(E,xe)),E.match_length>=be)if(X=f._tr_tally(E,E.strstart-E.match_start,E.match_length-be),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=be){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+be-1])&E.hash_mask,xe=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else X=f._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(X&&(fe(E,!1),E.strm.avail_out===0))return D}return E.insert=E.strstart<be-1?E.strstart:be-1,Ce===I?(fe(E,!0),E.strm.avail_out===0?Lt:ye):E.last_lit&&(fe(E,!1),E.strm.avail_out===0)?D:Te}function Ot(E,Ce){for(var xe,X,K;;){if(E.lookahead<qe){if(Xe(E),E.lookahead<qe&&Ce===T)return D;if(E.lookahead===0)break}if(xe=0,E.lookahead>=be&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+be-1])&E.hash_mask,xe=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=be-1,xe!==0&&E.prev_length<E.max_lazy_match&&E.strstart-xe<=E.w_size-qe&&(E.match_length=Ue(E,xe),E.match_length<=5&&(E.strategy===1||E.match_length===be&&4096<E.strstart-E.match_start)&&(E.match_length=be-1)),E.prev_length>=be&&E.match_length<=E.prev_length){for(K=E.strstart+E.lookahead-be,X=f._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-be),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=K&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+be-1])&E.hash_mask,xe=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=be-1,E.strstart++,X&&(fe(E,!1),E.strm.avail_out===0))return D}else if(E.match_available){if((X=f._tr_tally(E,0,E.window[E.strstart-1]))&&fe(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return D}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(X=f._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<be-1?E.strstart:be-1,Ce===I?(fe(E,!0),E.strm.avail_out===0?Lt:ye):E.last_lit&&(fe(E,!1),E.strm.avail_out===0)?D:Te}function gn(E,Ce,xe,X,K){this.good_length=E,this.max_lazy=Ce,this.nice_length=xe,this.max_chain=X,this.func=K}function lr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*re),this.dyn_dtree=new d.Buf16(2*(2*G+1)),this.bl_tree=new d.Buf16(2*(2*le+1)),Oe(this.dyn_ltree),Oe(this.dyn_dtree),Oe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16(pe+1),this.heap=new d.Buf16(2*V+1),Oe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*V+1),Oe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Zn(E){var Ce;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=k,(Ce=E.state).pending=0,Ce.pending_out=0,Ce.wrap<0&&(Ce.wrap=-Ce.wrap),Ce.status=Ce.wrap?Q:_e,E.adler=Ce.wrap===2?0:1,Ce.last_flush=T,f._tr_init(Ce),N):ke(E,P)}function Xt(E){var Ce=Zn(E);return Ce===N&&function(xe){xe.window_size=2*xe.w_size,Oe(xe.head),xe.max_lazy_match=c[xe.level].max_lazy,xe.good_match=c[xe.level].good_length,xe.nice_match=c[xe.level].nice_length,xe.max_chain_length=c[xe.level].max_chain,xe.strstart=0,xe.block_start=0,xe.lookahead=0,xe.insert=0,xe.match_length=xe.prev_length=be-1,xe.match_available=0,xe.ins_h=0}(E.state),Ce}function zr(E,Ce,xe,X,K,de){if(!E)return P;var Re=1;if(Ce===_&&(Ce=6),X<0?(Re=0,X=-X):15<X&&(Re=2,X-=16),K<1||A<K||xe!==S||X<8||15<X||Ce<0||9<Ce||de<0||F<de)return ke(E,P);X===8&&(X=9);var je=new lr;return(E.state=je).strm=E,je.wrap=Re,je.gzhead=null,je.w_bits=X,je.w_size=1<<je.w_bits,je.w_mask=je.w_size-1,je.hash_bits=K+7,je.hash_size=1<<je.hash_bits,je.hash_mask=je.hash_size-1,je.hash_shift=~~((je.hash_bits+be-1)/be),je.window=new d.Buf8(2*je.w_size),je.head=new d.Buf16(je.hash_size),je.prev=new d.Buf16(je.w_size),je.lit_bufsize=1<<K+6,je.pending_buf_size=4*je.lit_bufsize,je.pending_buf=new d.Buf8(je.pending_buf_size),je.d_buf=1*je.lit_bufsize,je.l_buf=3*je.lit_bufsize,je.level=Ce,je.strategy=de,je.method=xe,Xt(E)}c=[new gn(0,0,0,0,function(E,Ce){var xe=65535;for(xe>E.pending_buf_size-5&&(xe=E.pending_buf_size-5);;){if(E.lookahead<=1){if(Xe(E),E.lookahead===0&&Ce===T)return D;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var X=E.block_start+xe;if((E.strstart===0||E.strstart>=X)&&(E.lookahead=E.strstart-X,E.strstart=X,fe(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-qe&&(fe(E,!1),E.strm.avail_out===0))return D}return E.insert=0,Ce===I?(fe(E,!0),E.strm.avail_out===0?Lt:ye):(E.strstart>E.block_start&&(fe(E,!1),E.strm.avail_out),D)}),new gn(4,4,8,4,en),new gn(4,5,16,8,en),new gn(4,6,32,32,en),new gn(4,4,16,16,Ot),new gn(8,16,32,32,Ot),new gn(8,16,128,128,Ot),new gn(8,32,128,256,Ot),new gn(32,128,258,1024,Ot),new gn(32,258,258,4096,Ot)],a.deflateInit=function(E,Ce){return zr(E,Ce,S,15,8,0)},a.deflateInit2=zr,a.deflateReset=Xt,a.deflateResetKeep=Zn,a.deflateSetHeader=function(E,Ce){return E&&E.state?E.state.wrap!==2?P:(E.state.gzhead=Ce,N):P},a.deflate=function(E,Ce){var xe,X,K,de;if(!E||!E.state||5<Ce||Ce<0)return E?ke(E,P):P;if(X=E.state,!E.output||!E.input&&E.avail_in!==0||X.status===666&&Ce!==I)return ke(E,E.avail_out===0?-5:P);if(X.strm=E,xe=X.last_flush,X.last_flush=Ce,X.status===Q)if(X.wrap===2)E.adler=0,ut(X,31),ut(X,139),ut(X,8),X.gzhead?(ut(X,(X.gzhead.text?1:0)+(X.gzhead.hcrc?2:0)+(X.gzhead.extra?4:0)+(X.gzhead.name?8:0)+(X.gzhead.comment?16:0)),ut(X,255&X.gzhead.time),ut(X,X.gzhead.time>>8&255),ut(X,X.gzhead.time>>16&255),ut(X,X.gzhead.time>>24&255),ut(X,X.level===9?2:2<=X.strategy||X.level<2?4:0),ut(X,255&X.gzhead.os),X.gzhead.extra&&X.gzhead.extra.length&&(ut(X,255&X.gzhead.extra.length),ut(X,X.gzhead.extra.length>>8&255)),X.gzhead.hcrc&&(E.adler=z(E.adler,X.pending_buf,X.pending,0)),X.gzindex=0,X.status=69):(ut(X,0),ut(X,0),ut(X,0),ut(X,0),ut(X,0),ut(X,X.level===9?2:2<=X.strategy||X.level<2?4:0),ut(X,3),X.status=_e);else{var Re=S+(X.w_bits-8<<4)<<8;Re|=(2<=X.strategy||X.level<2?0:X.level<6?1:X.level===6?2:3)<<6,X.strstart!==0&&(Re|=32),Re+=31-Re%31,X.status=_e,ot(X,Re),X.strstart!==0&&(ot(X,E.adler>>>16),ot(X,65535&E.adler)),E.adler=1}if(X.status===69)if(X.gzhead.extra){for(K=X.pending;X.gzindex<(65535&X.gzhead.extra.length)&&(X.pending!==X.pending_buf_size||(X.gzhead.hcrc&&X.pending>K&&(E.adler=z(E.adler,X.pending_buf,X.pending-K,K)),ae(E),K=X.pending,X.pending!==X.pending_buf_size));)ut(X,255&X.gzhead.extra[X.gzindex]),X.gzindex++;X.gzhead.hcrc&&X.pending>K&&(E.adler=z(E.adler,X.pending_buf,X.pending-K,K)),X.gzindex===X.gzhead.extra.length&&(X.gzindex=0,X.status=73)}else X.status=73;if(X.status===73)if(X.gzhead.name){K=X.pending;do{if(X.pending===X.pending_buf_size&&(X.gzhead.hcrc&&X.pending>K&&(E.adler=z(E.adler,X.pending_buf,X.pending-K,K)),ae(E),K=X.pending,X.pending===X.pending_buf_size)){de=1;break}de=X.gzindex<X.gzhead.name.length?255&X.gzhead.name.charCodeAt(X.gzindex++):0,ut(X,de)}while(de!==0);X.gzhead.hcrc&&X.pending>K&&(E.adler=z(E.adler,X.pending_buf,X.pending-K,K)),de===0&&(X.gzindex=0,X.status=91)}else X.status=91;if(X.status===91)if(X.gzhead.comment){K=X.pending;do{if(X.pending===X.pending_buf_size&&(X.gzhead.hcrc&&X.pending>K&&(E.adler=z(E.adler,X.pending_buf,X.pending-K,K)),ae(E),K=X.pending,X.pending===X.pending_buf_size)){de=1;break}de=X.gzindex<X.gzhead.comment.length?255&X.gzhead.comment.charCodeAt(X.gzindex++):0,ut(X,de)}while(de!==0);X.gzhead.hcrc&&X.pending>K&&(E.adler=z(E.adler,X.pending_buf,X.pending-K,K)),de===0&&(X.status=103)}else X.status=103;if(X.status===103&&(X.gzhead.hcrc?(X.pending+2>X.pending_buf_size&&ae(E),X.pending+2<=X.pending_buf_size&&(ut(X,255&E.adler),ut(X,E.adler>>8&255),E.adler=0,X.status=_e)):X.status=_e),X.pending!==0){if(ae(E),E.avail_out===0)return X.last_flush=-1,N}else if(E.avail_in===0&&he(Ce)<=he(xe)&&Ce!==I)return ke(E,-5);if(X.status===666&&E.avail_in!==0)return ke(E,-5);if(E.avail_in!==0||X.lookahead!==0||Ce!==T&&X.status!==666){var je=X.strategy===2?function(ve,Pe){for(var ft;;){if(ve.lookahead===0&&(Xe(ve),ve.lookahead===0)){if(Pe===T)return D;break}if(ve.match_length=0,ft=f._tr_tally(ve,0,ve.window[ve.strstart]),ve.lookahead--,ve.strstart++,ft&&(fe(ve,!1),ve.strm.avail_out===0))return D}return ve.insert=0,Pe===I?(fe(ve,!0),ve.strm.avail_out===0?Lt:ye):ve.last_lit&&(fe(ve,!1),ve.strm.avail_out===0)?D:Te}(X,Ce):X.strategy===3?function(ve,Pe){for(var ft,We,Pt,fn,vn=ve.window;;){if(ve.lookahead<=Ie){if(Xe(ve),ve.lookahead<=Ie&&Pe===T)return D;if(ve.lookahead===0)break}if(ve.match_length=0,ve.lookahead>=be&&0<ve.strstart&&(We=vn[Pt=ve.strstart-1])===vn[++Pt]&&We===vn[++Pt]&&We===vn[++Pt]){fn=ve.strstart+Ie;do;while(We===vn[++Pt]&&We===vn[++Pt]&&We===vn[++Pt]&&We===vn[++Pt]&&We===vn[++Pt]&&We===vn[++Pt]&&We===vn[++Pt]&&We===vn[++Pt]&&Pt<fn);ve.match_length=Ie-(fn-Pt),ve.match_length>ve.lookahead&&(ve.match_length=ve.lookahead)}if(ve.match_length>=be?(ft=f._tr_tally(ve,1,ve.match_length-be),ve.lookahead-=ve.match_length,ve.strstart+=ve.match_length,ve.match_length=0):(ft=f._tr_tally(ve,0,ve.window[ve.strstart]),ve.lookahead--,ve.strstart++),ft&&(fe(ve,!1),ve.strm.avail_out===0))return D}return ve.insert=0,Pe===I?(fe(ve,!0),ve.strm.avail_out===0?Lt:ye):ve.last_lit&&(fe(ve,!1),ve.strm.avail_out===0)?D:Te}(X,Ce):c[X.level].func(X,Ce);if(je!==Lt&&je!==ye||(X.status=666),je===D||je===Lt)return E.avail_out===0&&(X.last_flush=-1),N;if(je===Te&&(Ce===1?f._tr_align(X):Ce!==5&&(f._tr_stored_block(X,0,0,!1),Ce===3&&(Oe(X.head),X.lookahead===0&&(X.strstart=0,X.block_start=0,X.insert=0))),ae(E),E.avail_out===0))return X.last_flush=-1,N}return Ce!==I?N:X.wrap<=0?1:(X.wrap===2?(ut(X,255&E.adler),ut(X,E.adler>>8&255),ut(X,E.adler>>16&255),ut(X,E.adler>>24&255),ut(X,255&E.total_in),ut(X,E.total_in>>8&255),ut(X,E.total_in>>16&255),ut(X,E.total_in>>24&255)):(ot(X,E.adler>>>16),ot(X,65535&E.adler)),ae(E),0<X.wrap&&(X.wrap=-X.wrap),X.pending!==0?N:1)},a.deflateEnd=function(E){var Ce;return E&&E.state?(Ce=E.state.status)!==Q&&Ce!==69&&Ce!==73&&Ce!==91&&Ce!==103&&Ce!==_e&&Ce!==666?ke(E,P):(E.state=null,Ce===_e?ke(E,-3):N):P},a.deflateSetDictionary=function(E,Ce){var xe,X,K,de,Re,je,ve,Pe,ft=Ce.length;if(!E||!E.state||(de=(xe=E.state).wrap)===2||de===1&&xe.status!==Q||xe.lookahead)return P;for(de===1&&(E.adler=g(E.adler,Ce,ft,0)),xe.wrap=0,ft>=xe.w_size&&(de===0&&(Oe(xe.head),xe.strstart=0,xe.block_start=0,xe.insert=0),Pe=new d.Buf8(xe.w_size),d.arraySet(Pe,Ce,ft-xe.w_size,xe.w_size,0),Ce=Pe,ft=xe.w_size),Re=E.avail_in,je=E.next_in,ve=E.input,E.avail_in=ft,E.next_in=0,E.input=Ce,Xe(xe);xe.lookahead>=be;){for(X=xe.strstart,K=xe.lookahead-(be-1);xe.ins_h=(xe.ins_h<<xe.hash_shift^xe.window[X+be-1])&xe.hash_mask,xe.prev[X&xe.w_mask]=xe.head[xe.ins_h],xe.head[xe.ins_h]=X,X++,--K;);xe.strstart=X,xe.lookahead=be-1,Xe(xe)}return xe.strstart+=xe.lookahead,xe.block_start=xe.strstart,xe.insert=xe.lookahead,xe.lookahead=0,xe.match_length=xe.prev_length=be-1,xe.match_available=0,E.next_in=je,E.input=ve,E.avail_in=Re,xe.wrap=de,N},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(r,i,a){i.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(r,i,a){i.exports=function(c,d){var f,g,z,$,T,I,N,P,_,F,k,S,A,V,G,le,re,pe,be,Ie,qe,Q,_e,D,Te;f=c.state,g=c.next_in,D=c.input,z=g+(c.avail_in-5),$=c.next_out,Te=c.output,T=$-(d-c.avail_out),I=$+(c.avail_out-257),N=f.dmax,P=f.wsize,_=f.whave,F=f.wnext,k=f.window,S=f.hold,A=f.bits,V=f.lencode,G=f.distcode,le=(1<<f.lenbits)-1,re=(1<<f.distbits)-1;e:do{A<15&&(S+=D[g++]<<A,A+=8,S+=D[g++]<<A,A+=8),pe=V[S&le];t:for(;;){if(S>>>=be=pe>>>24,A-=be,(be=pe>>>16&255)===0)Te[$++]=65535&pe;else{if(!(16&be)){if(!(64&be)){pe=V[(65535&pe)+(S&(1<<be)-1)];continue t}if(32&be){f.mode=12;break e}c.msg="invalid literal/length code",f.mode=30;break e}Ie=65535&pe,(be&=15)&&(A<be&&(S+=D[g++]<<A,A+=8),Ie+=S&(1<<be)-1,S>>>=be,A-=be),A<15&&(S+=D[g++]<<A,A+=8,S+=D[g++]<<A,A+=8),pe=G[S&re];n:for(;;){if(S>>>=be=pe>>>24,A-=be,!(16&(be=pe>>>16&255))){if(!(64&be)){pe=G[(65535&pe)+(S&(1<<be)-1)];continue n}c.msg="invalid distance code",f.mode=30;break e}if(qe=65535&pe,A<(be&=15)&&(S+=D[g++]<<A,(A+=8)<be&&(S+=D[g++]<<A,A+=8)),N<(qe+=S&(1<<be)-1)){c.msg="invalid distance too far back",f.mode=30;break e}if(S>>>=be,A-=be,(be=$-T)<qe){if(_<(be=qe-be)&&f.sane){c.msg="invalid distance too far back",f.mode=30;break e}if(_e=k,(Q=0)===F){if(Q+=P-be,be<Ie){for(Ie-=be;Te[$++]=k[Q++],--be;);Q=$-qe,_e=Te}}else if(F<be){if(Q+=P+F-be,(be-=F)<Ie){for(Ie-=be;Te[$++]=k[Q++],--be;);if(Q=0,F<Ie){for(Ie-=be=F;Te[$++]=k[Q++],--be;);Q=$-qe,_e=Te}}}else if(Q+=F-be,be<Ie){for(Ie-=be;Te[$++]=k[Q++],--be;);Q=$-qe,_e=Te}for(;2<Ie;)Te[$++]=_e[Q++],Te[$++]=_e[Q++],Te[$++]=_e[Q++],Ie-=3;Ie&&(Te[$++]=_e[Q++],1<Ie&&(Te[$++]=_e[Q++]))}else{for(Q=$-qe;Te[$++]=Te[Q++],Te[$++]=Te[Q++],Te[$++]=Te[Q++],2<(Ie-=3););Ie&&(Te[$++]=Te[Q++],1<Ie&&(Te[$++]=Te[Q++]))}break}}break}}while(g<z&&$<I);g-=Ie=A>>3,S&=(1<<(A-=Ie<<3))-1,c.next_in=g,c.next_out=$,c.avail_in=g<z?z-g+5:5-(g-z),c.avail_out=$<I?I-$+257:257-($-I),f.hold=S,f.bits=A}},{}],49:[function(r,i,a){var c=r("../utils/common"),d=r("./adler32"),f=r("./crc32"),g=r("./inffast"),z=r("./inftrees"),$=1,T=2,I=0,N=-2,P=1,_=852,F=592;function k(Q){return(Q>>>24&255)+(Q>>>8&65280)+((65280&Q)<<8)+((255&Q)<<24)}function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new c.Buf16(320),this.work=new c.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function A(Q){var _e;return Q&&Q.state?(_e=Q.state,Q.total_in=Q.total_out=_e.total=0,Q.msg="",_e.wrap&&(Q.adler=1&_e.wrap),_e.mode=P,_e.last=0,_e.havedict=0,_e.dmax=32768,_e.head=null,_e.hold=0,_e.bits=0,_e.lencode=_e.lendyn=new c.Buf32(_),_e.distcode=_e.distdyn=new c.Buf32(F),_e.sane=1,_e.back=-1,I):N}function V(Q){var _e;return Q&&Q.state?((_e=Q.state).wsize=0,_e.whave=0,_e.wnext=0,A(Q)):N}function G(Q,_e){var D,Te;return Q&&Q.state?(Te=Q.state,_e<0?(D=0,_e=-_e):(D=1+(_e>>4),_e<48&&(_e&=15)),_e&&(_e<8||15<_e)?N:(Te.window!==null&&Te.wbits!==_e&&(Te.window=null),Te.wrap=D,Te.wbits=_e,V(Q))):N}function le(Q,_e){var D,Te;return Q?(Te=new S,(Q.state=Te).window=null,(D=G(Q,_e))!==I&&(Q.state=null),D):N}var re,pe,be=!0;function Ie(Q){if(be){var _e;for(re=new c.Buf32(512),pe=new c.Buf32(32),_e=0;_e<144;)Q.lens[_e++]=8;for(;_e<256;)Q.lens[_e++]=9;for(;_e<280;)Q.lens[_e++]=7;for(;_e<288;)Q.lens[_e++]=8;for(z($,Q.lens,0,288,re,0,Q.work,{bits:9}),_e=0;_e<32;)Q.lens[_e++]=5;z(T,Q.lens,0,32,pe,0,Q.work,{bits:5}),be=!1}Q.lencode=re,Q.lenbits=9,Q.distcode=pe,Q.distbits=5}function qe(Q,_e,D,Te){var Lt,ye=Q.state;return ye.window===null&&(ye.wsize=1<<ye.wbits,ye.wnext=0,ye.whave=0,ye.window=new c.Buf8(ye.wsize)),Te>=ye.wsize?(c.arraySet(ye.window,_e,D-ye.wsize,ye.wsize,0),ye.wnext=0,ye.whave=ye.wsize):(Te<(Lt=ye.wsize-ye.wnext)&&(Lt=Te),c.arraySet(ye.window,_e,D-Te,Lt,ye.wnext),(Te-=Lt)?(c.arraySet(ye.window,_e,D-Te,Te,0),ye.wnext=Te,ye.whave=ye.wsize):(ye.wnext+=Lt,ye.wnext===ye.wsize&&(ye.wnext=0),ye.whave<ye.wsize&&(ye.whave+=Lt))),0}a.inflateReset=V,a.inflateReset2=G,a.inflateResetKeep=A,a.inflateInit=function(Q){return le(Q,15)},a.inflateInit2=le,a.inflate=function(Q,_e){var D,Te,Lt,ye,ke,he,Oe,ae,fe,ut,ot,Ue,Xe,en,Ot,gn,lr,Zn,Xt,zr,E,Ce,xe,X,K=0,de=new c.Buf8(4),Re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!Q||!Q.state||!Q.output||!Q.input&&Q.avail_in!==0)return N;(D=Q.state).mode===12&&(D.mode=13),ke=Q.next_out,Lt=Q.output,Oe=Q.avail_out,ye=Q.next_in,Te=Q.input,he=Q.avail_in,ae=D.hold,fe=D.bits,ut=he,ot=Oe,Ce=I;e:for(;;)switch(D.mode){case P:if(D.wrap===0){D.mode=13;break}for(;fe<16;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(2&D.wrap&&ae===35615){de[D.check=0]=255&ae,de[1]=ae>>>8&255,D.check=f(D.check,de,2,0),fe=ae=0,D.mode=2;break}if(D.flags=0,D.head&&(D.head.done=!1),!(1&D.wrap)||(((255&ae)<<8)+(ae>>8))%31){Q.msg="incorrect header check",D.mode=30;break}if((15&ae)!=8){Q.msg="unknown compression method",D.mode=30;break}if(fe-=4,E=8+(15&(ae>>>=4)),D.wbits===0)D.wbits=E;else if(E>D.wbits){Q.msg="invalid window size",D.mode=30;break}D.dmax=1<<E,Q.adler=D.check=1,D.mode=512&ae?10:12,fe=ae=0;break;case 2:for(;fe<16;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(D.flags=ae,(255&D.flags)!=8){Q.msg="unknown compression method",D.mode=30;break}if(57344&D.flags){Q.msg="unknown header flags set",D.mode=30;break}D.head&&(D.head.text=ae>>8&1),512&D.flags&&(de[0]=255&ae,de[1]=ae>>>8&255,D.check=f(D.check,de,2,0)),fe=ae=0,D.mode=3;case 3:for(;fe<32;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}D.head&&(D.head.time=ae),512&D.flags&&(de[0]=255&ae,de[1]=ae>>>8&255,de[2]=ae>>>16&255,de[3]=ae>>>24&255,D.check=f(D.check,de,4,0)),fe=ae=0,D.mode=4;case 4:for(;fe<16;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}D.head&&(D.head.xflags=255&ae,D.head.os=ae>>8),512&D.flags&&(de[0]=255&ae,de[1]=ae>>>8&255,D.check=f(D.check,de,2,0)),fe=ae=0,D.mode=5;case 5:if(1024&D.flags){for(;fe<16;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}D.length=ae,D.head&&(D.head.extra_len=ae),512&D.flags&&(de[0]=255&ae,de[1]=ae>>>8&255,D.check=f(D.check,de,2,0)),fe=ae=0}else D.head&&(D.head.extra=null);D.mode=6;case 6:if(1024&D.flags&&(he<(Ue=D.length)&&(Ue=he),Ue&&(D.head&&(E=D.head.extra_len-D.length,D.head.extra||(D.head.extra=new Array(D.head.extra_len)),c.arraySet(D.head.extra,Te,ye,Ue,E)),512&D.flags&&(D.check=f(D.check,Te,Ue,ye)),he-=Ue,ye+=Ue,D.length-=Ue),D.length))break e;D.length=0,D.mode=7;case 7:if(2048&D.flags){if(he===0)break e;for(Ue=0;E=Te[ye+Ue++],D.head&&E&&D.length<65536&&(D.head.name+=String.fromCharCode(E)),E&&Ue<he;);if(512&D.flags&&(D.check=f(D.check,Te,Ue,ye)),he-=Ue,ye+=Ue,E)break e}else D.head&&(D.head.name=null);D.length=0,D.mode=8;case 8:if(4096&D.flags){if(he===0)break e;for(Ue=0;E=Te[ye+Ue++],D.head&&E&&D.length<65536&&(D.head.comment+=String.fromCharCode(E)),E&&Ue<he;);if(512&D.flags&&(D.check=f(D.check,Te,Ue,ye)),he-=Ue,ye+=Ue,E)break e}else D.head&&(D.head.comment=null);D.mode=9;case 9:if(512&D.flags){for(;fe<16;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(ae!==(65535&D.check)){Q.msg="header crc mismatch",D.mode=30;break}fe=ae=0}D.head&&(D.head.hcrc=D.flags>>9&1,D.head.done=!0),Q.adler=D.check=0,D.mode=12;break;case 10:for(;fe<32;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}Q.adler=D.check=k(ae),fe=ae=0,D.mode=11;case 11:if(D.havedict===0)return Q.next_out=ke,Q.avail_out=Oe,Q.next_in=ye,Q.avail_in=he,D.hold=ae,D.bits=fe,2;Q.adler=D.check=1,D.mode=12;case 12:if(_e===5||_e===6)break e;case 13:if(D.last){ae>>>=7&fe,fe-=7&fe,D.mode=27;break}for(;fe<3;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}switch(D.last=1&ae,fe-=1,3&(ae>>>=1)){case 0:D.mode=14;break;case 1:if(Ie(D),D.mode=20,_e!==6)break;ae>>>=2,fe-=2;break e;case 2:D.mode=17;break;case 3:Q.msg="invalid block type",D.mode=30}ae>>>=2,fe-=2;break;case 14:for(ae>>>=7&fe,fe-=7&fe;fe<32;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if((65535&ae)!=(ae>>>16^65535)){Q.msg="invalid stored block lengths",D.mode=30;break}if(D.length=65535&ae,fe=ae=0,D.mode=15,_e===6)break e;case 15:D.mode=16;case 16:if(Ue=D.length){if(he<Ue&&(Ue=he),Oe<Ue&&(Ue=Oe),Ue===0)break e;c.arraySet(Lt,Te,ye,Ue,ke),he-=Ue,ye+=Ue,Oe-=Ue,ke+=Ue,D.length-=Ue;break}D.mode=12;break;case 17:for(;fe<14;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(D.nlen=257+(31&ae),ae>>>=5,fe-=5,D.ndist=1+(31&ae),ae>>>=5,fe-=5,D.ncode=4+(15&ae),ae>>>=4,fe-=4,286<D.nlen||30<D.ndist){Q.msg="too many length or distance symbols",D.mode=30;break}D.have=0,D.mode=18;case 18:for(;D.have<D.ncode;){for(;fe<3;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}D.lens[Re[D.have++]]=7&ae,ae>>>=3,fe-=3}for(;D.have<19;)D.lens[Re[D.have++]]=0;if(D.lencode=D.lendyn,D.lenbits=7,xe={bits:D.lenbits},Ce=z(0,D.lens,0,19,D.lencode,0,D.work,xe),D.lenbits=xe.bits,Ce){Q.msg="invalid code lengths set",D.mode=30;break}D.have=0,D.mode=19;case 19:for(;D.have<D.nlen+D.ndist;){for(;gn=(K=D.lencode[ae&(1<<D.lenbits)-1])>>>16&255,lr=65535&K,!((Ot=K>>>24)<=fe);){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(lr<16)ae>>>=Ot,fe-=Ot,D.lens[D.have++]=lr;else{if(lr===16){for(X=Ot+2;fe<X;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(ae>>>=Ot,fe-=Ot,D.have===0){Q.msg="invalid bit length repeat",D.mode=30;break}E=D.lens[D.have-1],Ue=3+(3&ae),ae>>>=2,fe-=2}else if(lr===17){for(X=Ot+3;fe<X;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}fe-=Ot,E=0,Ue=3+(7&(ae>>>=Ot)),ae>>>=3,fe-=3}else{for(X=Ot+7;fe<X;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}fe-=Ot,E=0,Ue=11+(127&(ae>>>=Ot)),ae>>>=7,fe-=7}if(D.have+Ue>D.nlen+D.ndist){Q.msg="invalid bit length repeat",D.mode=30;break}for(;Ue--;)D.lens[D.have++]=E}}if(D.mode===30)break;if(D.lens[256]===0){Q.msg="invalid code -- missing end-of-block",D.mode=30;break}if(D.lenbits=9,xe={bits:D.lenbits},Ce=z($,D.lens,0,D.nlen,D.lencode,0,D.work,xe),D.lenbits=xe.bits,Ce){Q.msg="invalid literal/lengths set",D.mode=30;break}if(D.distbits=6,D.distcode=D.distdyn,xe={bits:D.distbits},Ce=z(T,D.lens,D.nlen,D.ndist,D.distcode,0,D.work,xe),D.distbits=xe.bits,Ce){Q.msg="invalid distances set",D.mode=30;break}if(D.mode=20,_e===6)break e;case 20:D.mode=21;case 21:if(6<=he&&258<=Oe){Q.next_out=ke,Q.avail_out=Oe,Q.next_in=ye,Q.avail_in=he,D.hold=ae,D.bits=fe,g(Q,ot),ke=Q.next_out,Lt=Q.output,Oe=Q.avail_out,ye=Q.next_in,Te=Q.input,he=Q.avail_in,ae=D.hold,fe=D.bits,D.mode===12&&(D.back=-1);break}for(D.back=0;gn=(K=D.lencode[ae&(1<<D.lenbits)-1])>>>16&255,lr=65535&K,!((Ot=K>>>24)<=fe);){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(gn&&!(240&gn)){for(Zn=Ot,Xt=gn,zr=lr;gn=(K=D.lencode[zr+((ae&(1<<Zn+Xt)-1)>>Zn)])>>>16&255,lr=65535&K,!(Zn+(Ot=K>>>24)<=fe);){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}ae>>>=Zn,fe-=Zn,D.back+=Zn}if(ae>>>=Ot,fe-=Ot,D.back+=Ot,D.length=lr,gn===0){D.mode=26;break}if(32&gn){D.back=-1,D.mode=12;break}if(64&gn){Q.msg="invalid literal/length code",D.mode=30;break}D.extra=15&gn,D.mode=22;case 22:if(D.extra){for(X=D.extra;fe<X;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}D.length+=ae&(1<<D.extra)-1,ae>>>=D.extra,fe-=D.extra,D.back+=D.extra}D.was=D.length,D.mode=23;case 23:for(;gn=(K=D.distcode[ae&(1<<D.distbits)-1])>>>16&255,lr=65535&K,!((Ot=K>>>24)<=fe);){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(!(240&gn)){for(Zn=Ot,Xt=gn,zr=lr;gn=(K=D.distcode[zr+((ae&(1<<Zn+Xt)-1)>>Zn)])>>>16&255,lr=65535&K,!(Zn+(Ot=K>>>24)<=fe);){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}ae>>>=Zn,fe-=Zn,D.back+=Zn}if(ae>>>=Ot,fe-=Ot,D.back+=Ot,64&gn){Q.msg="invalid distance code",D.mode=30;break}D.offset=lr,D.extra=15&gn,D.mode=24;case 24:if(D.extra){for(X=D.extra;fe<X;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}D.offset+=ae&(1<<D.extra)-1,ae>>>=D.extra,fe-=D.extra,D.back+=D.extra}if(D.offset>D.dmax){Q.msg="invalid distance too far back",D.mode=30;break}D.mode=25;case 25:if(Oe===0)break e;if(Ue=ot-Oe,D.offset>Ue){if((Ue=D.offset-Ue)>D.whave&&D.sane){Q.msg="invalid distance too far back",D.mode=30;break}Xe=Ue>D.wnext?(Ue-=D.wnext,D.wsize-Ue):D.wnext-Ue,Ue>D.length&&(Ue=D.length),en=D.window}else en=Lt,Xe=ke-D.offset,Ue=D.length;for(Oe<Ue&&(Ue=Oe),Oe-=Ue,D.length-=Ue;Lt[ke++]=en[Xe++],--Ue;);D.length===0&&(D.mode=21);break;case 26:if(Oe===0)break e;Lt[ke++]=D.length,Oe--,D.mode=21;break;case 27:if(D.wrap){for(;fe<32;){if(he===0)break e;he--,ae|=Te[ye++]<<fe,fe+=8}if(ot-=Oe,Q.total_out+=ot,D.total+=ot,ot&&(Q.adler=D.check=D.flags?f(D.check,Lt,ot,ke-ot):d(D.check,Lt,ot,ke-ot)),ot=Oe,(D.flags?ae:k(ae))!==D.check){Q.msg="incorrect data check",D.mode=30;break}fe=ae=0}D.mode=28;case 28:if(D.wrap&&D.flags){for(;fe<32;){if(he===0)break e;he--,ae+=Te[ye++]<<fe,fe+=8}if(ae!==(4294967295&D.total)){Q.msg="incorrect length check",D.mode=30;break}fe=ae=0}D.mode=29;case 29:Ce=1;break e;case 30:Ce=-3;break e;case 31:return-4;case 32:default:return N}return Q.next_out=ke,Q.avail_out=Oe,Q.next_in=ye,Q.avail_in=he,D.hold=ae,D.bits=fe,(D.wsize||ot!==Q.avail_out&&D.mode<30&&(D.mode<27||_e!==4))&&qe(Q,Q.output,Q.next_out,ot-Q.avail_out)?(D.mode=31,-4):(ut-=Q.avail_in,ot-=Q.avail_out,Q.total_in+=ut,Q.total_out+=ot,D.total+=ot,D.wrap&&ot&&(Q.adler=D.check=D.flags?f(D.check,Lt,ot,Q.next_out-ot):d(D.check,Lt,ot,Q.next_out-ot)),Q.data_type=D.bits+(D.last?64:0)+(D.mode===12?128:0)+(D.mode===20||D.mode===15?256:0),(ut==0&&ot===0||_e===4)&&Ce===I&&(Ce=-5),Ce)},a.inflateEnd=function(Q){if(!Q||!Q.state)return N;var _e=Q.state;return _e.window&&(_e.window=null),Q.state=null,I},a.inflateGetHeader=function(Q,_e){var D;return Q&&Q.state&&2&(D=Q.state).wrap?((D.head=_e).done=!1,I):N},a.inflateSetDictionary=function(Q,_e){var D,Te=_e.length;return Q&&Q.state?(D=Q.state).wrap!==0&&D.mode!==11?N:D.mode===11&&d(1,_e,Te,0)!==D.check?-3:qe(Q,_e,Te,Te)?(D.mode=31,-4):(D.havedict=1,I):N},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(r,i,a){var c=r("../utils/common"),d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],f=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],z=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];i.exports=function($,T,I,N,P,_,F,k){var S,A,V,G,le,re,pe,be,Ie,qe=k.bits,Q=0,_e=0,D=0,Te=0,Lt=0,ye=0,ke=0,he=0,Oe=0,ae=0,fe=null,ut=0,ot=new c.Buf16(16),Ue=new c.Buf16(16),Xe=null,en=0;for(Q=0;Q<=15;Q++)ot[Q]=0;for(_e=0;_e<N;_e++)ot[T[I+_e]]++;for(Lt=qe,Te=15;1<=Te&&ot[Te]===0;Te--);if(Te<Lt&&(Lt=Te),Te===0)return P[_++]=20971520,P[_++]=20971520,k.bits=1,0;for(D=1;D<Te&&ot[D]===0;D++);for(Lt<D&&(Lt=D),Q=he=1;Q<=15;Q++)if(he<<=1,(he-=ot[Q])<0)return-1;if(0<he&&($===0||Te!==1))return-1;for(Ue[1]=0,Q=1;Q<15;Q++)Ue[Q+1]=Ue[Q]+ot[Q];for(_e=0;_e<N;_e++)T[I+_e]!==0&&(F[Ue[T[I+_e]]++]=_e);if(re=$===0?(fe=Xe=F,19):$===1?(fe=d,ut-=257,Xe=f,en-=257,256):(fe=g,Xe=z,-1),Q=D,le=_,ke=_e=ae=0,V=-1,G=(Oe=1<<(ye=Lt))-1,$===1&&852<Oe||$===2&&592<Oe)return 1;for(;;){for(pe=Q-ke,Ie=F[_e]<re?(be=0,F[_e]):F[_e]>re?(be=Xe[en+F[_e]],fe[ut+F[_e]]):(be=96,0),S=1<<Q-ke,D=A=1<<ye;P[le+(ae>>ke)+(A-=S)]=pe<<24|be<<16|Ie|0,A!==0;);for(S=1<<Q-1;ae&S;)S>>=1;if(S!==0?(ae&=S-1,ae+=S):ae=0,_e++,--ot[Q]==0){if(Q===Te)break;Q=T[I+F[_e]]}if(Lt<Q&&(ae&G)!==V){for(ke===0&&(ke=Lt),le+=D,he=1<<(ye=Q-ke);ye+ke<Te&&!((he-=ot[ye+ke])<=0);)ye++,he<<=1;if(Oe+=1<<ye,$===1&&852<Oe||$===2&&592<Oe)return 1;P[V=ae&G]=Lt<<24|ye<<16|le-_|0}}return ae!==0&&(P[le+ae]=Q-ke<<24|64<<16|0),k.bits=Lt,0}},{"../utils/common":41}],51:[function(r,i,a){i.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(r,i,a){var c=r("../utils/common"),d=0,f=1;function g(K){for(var de=K.length;0<=--de;)K[de]=0}var z=0,$=29,T=256,I=T+1+$,N=30,P=19,_=2*I+1,F=15,k=16,S=7,A=256,V=16,G=17,le=18,re=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],pe=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],be=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ie=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],qe=new Array(2*(I+2));g(qe);var Q=new Array(2*N);g(Q);var _e=new Array(512);g(_e);var D=new Array(256);g(D);var Te=new Array($);g(Te);var Lt,ye,ke,he=new Array(N);function Oe(K,de,Re,je,ve){this.static_tree=K,this.extra_bits=de,this.extra_base=Re,this.elems=je,this.max_length=ve,this.has_stree=K&&K.length}function ae(K,de){this.dyn_tree=K,this.max_code=0,this.stat_desc=de}function fe(K){return K<256?_e[K]:_e[256+(K>>>7)]}function ut(K,de){K.pending_buf[K.pending++]=255&de,K.pending_buf[K.pending++]=de>>>8&255}function ot(K,de,Re){K.bi_valid>k-Re?(K.bi_buf|=de<<K.bi_valid&65535,ut(K,K.bi_buf),K.bi_buf=de>>k-K.bi_valid,K.bi_valid+=Re-k):(K.bi_buf|=de<<K.bi_valid&65535,K.bi_valid+=Re)}function Ue(K,de,Re){ot(K,Re[2*de],Re[2*de+1])}function Xe(K,de){for(var Re=0;Re|=1&K,K>>>=1,Re<<=1,0<--de;);return Re>>>1}function en(K,de,Re){var je,ve,Pe=new Array(F+1),ft=0;for(je=1;je<=F;je++)Pe[je]=ft=ft+Re[je-1]<<1;for(ve=0;ve<=de;ve++){var We=K[2*ve+1];We!==0&&(K[2*ve]=Xe(Pe[We]++,We))}}function Ot(K){var de;for(de=0;de<I;de++)K.dyn_ltree[2*de]=0;for(de=0;de<N;de++)K.dyn_dtree[2*de]=0;for(de=0;de<P;de++)K.bl_tree[2*de]=0;K.dyn_ltree[2*A]=1,K.opt_len=K.static_len=0,K.last_lit=K.matches=0}function gn(K){8<K.bi_valid?ut(K,K.bi_buf):0<K.bi_valid&&(K.pending_buf[K.pending++]=K.bi_buf),K.bi_buf=0,K.bi_valid=0}function lr(K,de,Re,je){var ve=2*de,Pe=2*Re;return K[ve]<K[Pe]||K[ve]===K[Pe]&&je[de]<=je[Re]}function Zn(K,de,Re){for(var je=K.heap[Re],ve=Re<<1;ve<=K.heap_len&&(ve<K.heap_len&&lr(de,K.heap[ve+1],K.heap[ve],K.depth)&&ve++,!lr(de,je,K.heap[ve],K.depth));)K.heap[Re]=K.heap[ve],Re=ve,ve<<=1;K.heap[Re]=je}function Xt(K,de,Re){var je,ve,Pe,ft,We=0;if(K.last_lit!==0)for(;je=K.pending_buf[K.d_buf+2*We]<<8|K.pending_buf[K.d_buf+2*We+1],ve=K.pending_buf[K.l_buf+We],We++,je===0?Ue(K,ve,de):(Ue(K,(Pe=D[ve])+T+1,de),(ft=re[Pe])!==0&&ot(K,ve-=Te[Pe],ft),Ue(K,Pe=fe(--je),Re),(ft=pe[Pe])!==0&&ot(K,je-=he[Pe],ft)),We<K.last_lit;);Ue(K,A,de)}function zr(K,de){var Re,je,ve,Pe=de.dyn_tree,ft=de.stat_desc.static_tree,We=de.stat_desc.has_stree,Pt=de.stat_desc.elems,fn=-1;for(K.heap_len=0,K.heap_max=_,Re=0;Re<Pt;Re++)Pe[2*Re]!==0?(K.heap[++K.heap_len]=fn=Re,K.depth[Re]=0):Pe[2*Re+1]=0;for(;K.heap_len<2;)Pe[2*(ve=K.heap[++K.heap_len]=fn<2?++fn:0)]=1,K.depth[ve]=0,K.opt_len--,We&&(K.static_len-=ft[2*ve+1]);for(de.max_code=fn,Re=K.heap_len>>1;1<=Re;Re--)Zn(K,Pe,Re);for(ve=Pt;Re=K.heap[1],K.heap[1]=K.heap[K.heap_len--],Zn(K,Pe,1),je=K.heap[1],K.heap[--K.heap_max]=Re,K.heap[--K.heap_max]=je,Pe[2*ve]=Pe[2*Re]+Pe[2*je],K.depth[ve]=(K.depth[Re]>=K.depth[je]?K.depth[Re]:K.depth[je])+1,Pe[2*Re+1]=Pe[2*je+1]=ve,K.heap[1]=ve++,Zn(K,Pe,1),2<=K.heap_len;);K.heap[--K.heap_max]=K.heap[1],function(vn,$r){var hi,Mr,Si,Fn,Ci,vs,Rr=$r.dyn_tree,Po=$r.max_code,$a=$r.stat_desc.static_tree,Mc=$r.stat_desc.has_stree,Ao=$r.stat_desc.extra_bits,Vi=$r.stat_desc.extra_base,lo=$r.stat_desc.max_length,kr=0;for(Fn=0;Fn<=F;Fn++)vn.bl_count[Fn]=0;for(Rr[2*vn.heap[vn.heap_max]+1]=0,hi=vn.heap_max+1;hi<_;hi++)lo<(Fn=Rr[2*Rr[2*(Mr=vn.heap[hi])+1]+1]+1)&&(Fn=lo,kr++),Rr[2*Mr+1]=Fn,Po<Mr||(vn.bl_count[Fn]++,Ci=0,Vi<=Mr&&(Ci=Ao[Mr-Vi]),vs=Rr[2*Mr],vn.opt_len+=vs*(Fn+Ci),Mc&&(vn.static_len+=vs*($a[2*Mr+1]+Ci)));if(kr!==0){do{for(Fn=lo-1;vn.bl_count[Fn]===0;)Fn--;vn.bl_count[Fn]--,vn.bl_count[Fn+1]+=2,vn.bl_count[lo]--,kr-=2}while(0<kr);for(Fn=lo;Fn!==0;Fn--)for(Mr=vn.bl_count[Fn];Mr!==0;)Po<(Si=vn.heap[--hi])||(Rr[2*Si+1]!==Fn&&(vn.opt_len+=(Fn-Rr[2*Si+1])*Rr[2*Si],Rr[2*Si+1]=Fn),Mr--)}}(K,de),en(Pe,fn,K.bl_count)}function E(K,de,Re){var je,ve,Pe=-1,ft=de[1],We=0,Pt=7,fn=4;for(ft===0&&(Pt=138,fn=3),de[2*(Re+1)+1]=65535,je=0;je<=Re;je++)ve=ft,ft=de[2*(je+1)+1],++We<Pt&&ve===ft||(We<fn?K.bl_tree[2*ve]+=We:ve!==0?(ve!==Pe&&K.bl_tree[2*ve]++,K.bl_tree[2*V]++):We<=10?K.bl_tree[2*G]++:K.bl_tree[2*le]++,Pe=ve,fn=(We=0)===ft?(Pt=138,3):ve===ft?(Pt=6,3):(Pt=7,4))}function Ce(K,de,Re){var je,ve,Pe=-1,ft=de[1],We=0,Pt=7,fn=4;for(ft===0&&(Pt=138,fn=3),je=0;je<=Re;je++)if(ve=ft,ft=de[2*(je+1)+1],!(++We<Pt&&ve===ft)){if(We<fn)for(;Ue(K,ve,K.bl_tree),--We!=0;);else ve!==0?(ve!==Pe&&(Ue(K,ve,K.bl_tree),We--),Ue(K,V,K.bl_tree),ot(K,We-3,2)):We<=10?(Ue(K,G,K.bl_tree),ot(K,We-3,3)):(Ue(K,le,K.bl_tree),ot(K,We-11,7));Pe=ve,fn=(We=0)===ft?(Pt=138,3):ve===ft?(Pt=6,3):(Pt=7,4)}}g(he);var xe=!1;function X(K,de,Re,je){ot(K,(z<<1)+(je?1:0),3),function(ve,Pe,ft,We){gn(ve),ut(ve,ft),ut(ve,~ft),c.arraySet(ve.pending_buf,ve.window,Pe,ft,ve.pending),ve.pending+=ft}(K,de,Re)}a._tr_init=function(K){xe||(function(){var de,Re,je,ve,Pe,ft=new Array(F+1);for(ve=je=0;ve<$-1;ve++)for(Te[ve]=je,de=0;de<1<<re[ve];de++)D[je++]=ve;for(D[je-1]=ve,ve=Pe=0;ve<16;ve++)for(he[ve]=Pe,de=0;de<1<<pe[ve];de++)_e[Pe++]=ve;for(Pe>>=7;ve<N;ve++)for(he[ve]=Pe<<7,de=0;de<1<<pe[ve]-7;de++)_e[256+Pe++]=ve;for(Re=0;Re<=F;Re++)ft[Re]=0;for(de=0;de<=143;)qe[2*de+1]=8,de++,ft[8]++;for(;de<=255;)qe[2*de+1]=9,de++,ft[9]++;for(;de<=279;)qe[2*de+1]=7,de++,ft[7]++;for(;de<=287;)qe[2*de+1]=8,de++,ft[8]++;for(en(qe,I+1,ft),de=0;de<N;de++)Q[2*de+1]=5,Q[2*de]=Xe(de,5);Lt=new Oe(qe,re,T+1,I,F),ye=new Oe(Q,pe,0,N,F),ke=new Oe(new Array(0),be,0,P,S)}(),xe=!0),K.l_desc=new ae(K.dyn_ltree,Lt),K.d_desc=new ae(K.dyn_dtree,ye),K.bl_desc=new ae(K.bl_tree,ke),K.bi_buf=0,K.bi_valid=0,Ot(K)},a._tr_stored_block=X,a._tr_flush_block=function(K,de,Re,je){var ve,Pe,ft=0;0<K.level?(K.strm.data_type===2&&(K.strm.data_type=function(We){var Pt,fn=4093624447;for(Pt=0;Pt<=31;Pt++,fn>>>=1)if(1&fn&&We.dyn_ltree[2*Pt]!==0)return d;if(We.dyn_ltree[18]!==0||We.dyn_ltree[20]!==0||We.dyn_ltree[26]!==0)return f;for(Pt=32;Pt<T;Pt++)if(We.dyn_ltree[2*Pt]!==0)return f;return d}(K)),zr(K,K.l_desc),zr(K,K.d_desc),ft=function(We){var Pt;for(E(We,We.dyn_ltree,We.l_desc.max_code),E(We,We.dyn_dtree,We.d_desc.max_code),zr(We,We.bl_desc),Pt=P-1;3<=Pt&&We.bl_tree[2*Ie[Pt]+1]===0;Pt--);return We.opt_len+=3*(Pt+1)+5+5+4,Pt}(K),ve=K.opt_len+3+7>>>3,(Pe=K.static_len+3+7>>>3)<=ve&&(ve=Pe)):ve=Pe=Re+5,Re+4<=ve&&de!==-1?X(K,de,Re,je):K.strategy===4||Pe===ve?(ot(K,2+(je?1:0),3),Xt(K,qe,Q)):(ot(K,4+(je?1:0),3),function(We,Pt,fn,vn){var $r;for(ot(We,Pt-257,5),ot(We,fn-1,5),ot(We,vn-4,4),$r=0;$r<vn;$r++)ot(We,We.bl_tree[2*Ie[$r]+1],3);Ce(We,We.dyn_ltree,Pt-1),Ce(We,We.dyn_dtree,fn-1)}(K,K.l_desc.max_code+1,K.d_desc.max_code+1,ft+1),Xt(K,K.dyn_ltree,K.dyn_dtree)),Ot(K),je&&gn(K)},a._tr_tally=function(K,de,Re){return K.pending_buf[K.d_buf+2*K.last_lit]=de>>>8&255,K.pending_buf[K.d_buf+2*K.last_lit+1]=255&de,K.pending_buf[K.l_buf+K.last_lit]=255&Re,K.last_lit++,de===0?K.dyn_ltree[2*Re]++:(K.matches++,de--,K.dyn_ltree[2*(D[Re]+T+1)]++,K.dyn_dtree[2*fe(de)]++),K.last_lit===K.lit_bufsize-1},a._tr_align=function(K){ot(K,2,3),Ue(K,A,qe),function(de){de.bi_valid===16?(ut(de,de.bi_buf),de.bi_buf=0,de.bi_valid=0):8<=de.bi_valid&&(de.pending_buf[de.pending++]=255&de.bi_buf,de.bi_buf>>=8,de.bi_valid-=8)}(K)}},{"../utils/common":41}],53:[function(r,i,a){i.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(r,i,a){(function(c){(function(d,f){if(!d.setImmediate){var g,z,$,T,I=1,N={},P=!1,_=d.document,F=Object.getPrototypeOf&&Object.getPrototypeOf(d);F=F&&F.setTimeout?F:d,g={}.toString.call(d.process)==="[object process]"?function(V){process.nextTick(function(){S(V)})}:function(){if(d.postMessage&&!d.importScripts){var V=!0,G=d.onmessage;return d.onmessage=function(){V=!1},d.postMessage("","*"),d.onmessage=G,V}}()?(T="setImmediate$"+Math.random()+"$",d.addEventListener?d.addEventListener("message",A,!1):d.attachEvent("onmessage",A),function(V){d.postMessage(T+V,"*")}):d.MessageChannel?(($=new MessageChannel).port1.onmessage=function(V){S(V.data)},function(V){$.port2.postMessage(V)}):_&&"onreadystatechange"in _.createElement("script")?(z=_.documentElement,function(V){var G=_.createElement("script");G.onreadystatechange=function(){S(V),G.onreadystatechange=null,z.removeChild(G),G=null},z.appendChild(G)}):function(V){setTimeout(S,0,V)},F.setImmediate=function(V){typeof V!="function"&&(V=new Function(""+V));for(var G=new Array(arguments.length-1),le=0;le<G.length;le++)G[le]=arguments[le+1];var re={callback:V,args:G};return N[I]=re,g(I),I++},F.clearImmediate=k}function k(V){delete N[V]}function S(V){if(P)setTimeout(S,0,V);else{var G=N[V];if(G){P=!0;try{(function(le){var re=le.callback,pe=le.args;switch(pe.length){case 0:re();break;case 1:re(pe[0]);break;case 2:re(pe[0],pe[1]);break;case 3:re(pe[0],pe[1],pe[2]);break;default:re.apply(f,pe)}})(G)}finally{k(V),P=!1}}}}function A(V){V.source===d&&typeof V.data=="string"&&V.data.indexOf(T)===0&&S(+V.data.slice(T.length))}})(typeof self>"u"?c===void 0?this:c:self)}).call(this,typeof No<"u"?No:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(Ww);var t_=Ww.exports;const rv=mv(t_);var Vw={exports:{}};(function(e,t){(function(r,i){i()})(No,function(){function r(z,$){return typeof $>"u"?$={autoBom:!1}:typeof $!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),$={autoBom:!$}),$.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(z.type)?new Blob(["\uFEFF",z],{type:z.type}):z}function i(z,$,T){var I=new XMLHttpRequest;I.open("GET",z),I.responseType="blob",I.onload=function(){g(I.response,$,T)},I.onerror=function(){console.error("could not download file")},I.send()}function a(z){var $=new XMLHttpRequest;$.open("HEAD",z,!1);try{$.send()}catch{}return 200<=$.status&&299>=$.status}function c(z){try{z.dispatchEvent(new MouseEvent("click"))}catch{var $=document.createEvent("MouseEvents");$.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),z.dispatchEvent($)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof No=="object"&&No.global===No?No:void 0,f=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!f?function(z,$,T){var I=d.URL||d.webkitURL,N=document.createElement("a");$=$||z.name||"download",N.download=$,N.rel="noopener",typeof z=="string"?(N.href=z,N.origin===location.origin?c(N):a(N.href)?i(z,$,T):c(N,N.target="_blank")):(N.href=I.createObjectURL(z),setTimeout(function(){I.revokeObjectURL(N.href)},4e4),setTimeout(function(){c(N)},0))}:"msSaveOrOpenBlob"in navigator?function(z,$,T){if($=$||z.name||"download",typeof z!="string")navigator.msSaveOrOpenBlob(r(z,T),$);else if(a(z))i(z,$,T);else{var I=document.createElement("a");I.href=z,I.target="_blank",setTimeout(function(){c(I)})}}:function(z,$,T,I){if(I=I||open("","_blank"),I&&(I.document.title=I.document.body.innerText="downloading..."),typeof z=="string")return i(z,$,T);var N=z.type==="application/octet-stream",P=/constructor/i.test(d.HTMLElement)||d.safari,_=/CriOS\/[\d]+/.test(navigator.userAgent);if((_||N&&P||f)&&typeof FileReader<"u"){var F=new FileReader;F.onloadend=function(){var A=F.result;A=_?A:A.replace(/^data:[^;]*;/,"data:attachment/file;"),I?I.location.href=A:location=A,I=null},F.readAsDataURL(z)}else{var k=d.URL||d.webkitURL,S=k.createObjectURL(z);I?I.location=S:location.href=S,I=null,setTimeout(function(){k.revokeObjectURL(S)},4e4)}});d.saveAs=g.saveAs=g,e.exports=g})})(Vw);var sv=Vw.exports;(function(){const e=console.error,t=console.warn,r=console.log,i=a=>{for(let c of a){let d="";if(typeof c=="string"?d=c:c&&typeof c=="object"?c.message?d=c.message:c.toString?d=c.toString():d=JSON.stringify(c):c!=null&&(d=String(c)),d.includes("Unable to preventDefault inside passive event listener")||d.includes("passive event listener invocation")||d.includes("preventDefault")&&d.includes("passive"))return!0}return!1};console.error=function(...a){i(a)||e.apply(console,a)},console.warn=function(...a){i(a)||t.apply(console,a)},console.log=function(...a){i(a)||r.apply(console,a)}})();const n_=({canvasRef:e,isDrawing:t})=>{const[r,i]=M.useState(""),a=M.useRef(null),c=M.useCallback(()=>{e.current&&i(e.current.toDataURL())},[e]);return M.useEffect(()=>{e.current&&c()},[e,c]),M.useEffect(()=>{if(!t){c();return}const d=()=>{c(),t&&(a.current=requestAnimationFrame(d))};return a.current=requestAnimationFrame(d),()=>{a.current&&cancelAnimationFrame(a.current)}},[t,c]),r?s.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"rgba(255, 0, 0, 0.3)",mixBlendMode:"multiply",WebkitMaskImage:`url(${r})`,maskImage:`url(${r})`,WebkitMaskSize:"100% 100%",maskSize:"100% 100%",WebkitMaskRepeat:"no-repeat",maskRepeat:"no-repeat"}}):null},Ui=(()=>{const e="tapnow_images_db",r="images";let i=null,a=null;const c=new Map,d=()=>a||(a=new Promise((N,P)=>{if(!window.indexedDB){console.warn("[LocalImageManager] IndexedDB not supported, falling back to memory"),N(null);return}const _=indexedDB.open(e,1);_.onerror=F=>{console.error("[LocalImageManager] IndexedDB init failed:",F.target.error),N(null)},_.onsuccess=F=>{i=F.target.result,console.log("[LocalImageManager] IndexedDB initialized"),N(i)},_.onupgradeneeded=F=>{const k=F.target.result;k.objectStoreNames.contains(r)||(k.createObjectStore(r,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),console.log("[LocalImageManager] Object store created"))}}),a),f=()=>`img_${Date.now()}_${Math.random().toString(36).substring(2,9)}`;return{saveImage:async(N,P=null)=>{const _=await d();if(!_)return null;const F=P||f();return new Promise((k,S)=>{var A;try{let V;if(typeof N=="string"&&N.startsWith("data:")){const be=N.split(","),Ie=((A=be[0].match(/:(.*?);/))==null?void 0:A[1])||"image/png",qe=atob(be[1]),Q=new Uint8Array(qe.length);for(let _e=0;_e<qe.length;_e++)Q[_e]=qe.charCodeAt(_e);V=new Blob([Q],{type:Ie})}else if(N instanceof Blob)V=N;else{console.warn("[LocalImageManager] Invalid data type for saveImage"),k(null);return}const le=_.transaction([r],"readwrite").objectStore(r),re={id:F,blob:V,timestamp:Date.now(),size:V.size},pe=le.put(re);pe.onsuccess=()=>{k(F)},pe.onerror=be=>{console.error("[LocalImageManager] Save failed:",be.target.error),k(null)}}catch(V){console.error("[LocalImageManager] Save error:",V),k(null)}})},getImage:async N=>{if(c.has(N))return c.get(N);const P=await d();return P?new Promise(_=>{try{const S=P.transaction([r],"readonly").objectStore(r).get(N);S.onsuccess=()=>{const A=S.result;if(A&&A.blob){const V=new FileReader;V.onloadend=()=>{const G=V.result;c.set(N,G),_(G)},V.onerror=()=>{console.error("[LocalImageManager] Failed to convert blob to base64"),_(null)},V.readAsDataURL(A.blob)}else _(null)},S.onerror=()=>_(null)}catch(F){console.error("[LocalImageManager] Get error:",F),_(null)}}):null},deleteImage:async N=>{const P=await d();if(!P)return!1;if(c.has(N)){const _=c.get(N);_&&_.startsWith("blob:")&&URL.revokeObjectURL(_),c.delete(N)}return new Promise(_=>{const S=P.transaction([r],"readwrite").objectStore(r).delete(N);S.onsuccess=()=>_(!0),S.onerror=()=>_(!1)})},getStats:async()=>{const N=await d();return N?new Promise(P=>{const k=N.transaction([r],"readonly").objectStore(r).getAll();k.onsuccess=()=>{const S=k.result||[],A=S.reduce((V,G)=>V+(G.size||0),0);P({count:S.length,totalSize:A})},k.onerror=()=>P({count:0,totalSize:0})}):{count:0,totalSize:0}},isImageId:N=>typeof N=="string"&&N.startsWith("img_"),initDB:d}})();window.LocalImageManager=Ui;const ll=e=>!e||typeof e!="string"||!e.startsWith("data:")?e:e.replace(/\s+/g,""),r_=e=>{if(!e)return"";let t=e.replace(/\s+/g,"");if(/%[0-9A-Fa-f]{2}/.test(t))try{t=decodeURIComponent(t)}catch{}t=t.replace(/-/g,"+").replace(/_/g,"/"),t=t.replace(/[^A-Za-z0-9+/=]/g,"");const r=t.length%4;return r&&(t+="=".repeat(4-r)),t},Rm=e=>{const r=ll(e).match(/^data:([^;,]+)(;base64)?,(.*)$/i);if(!r)return null;const i=r[1]||"application/octet-stream",a=!!r[2];let c=r[3]||"";if(!a)try{return new Blob([decodeURIComponent(c)],{type:i})}catch{return new Blob([c],{type:i})}c=r_(c);let d="";try{d=atob(c)}catch{return null}const f=new Uint8Array(d.length);for(let g=0;g<d.length;g++)f[g]=d.charCodeAt(g);return new Blob([f],{type:i})},s_=(e,t)=>{if(!e||!t||t<=0)return e||"";const r=new TextEncoder;let i=0,a="";for(const c of e){const d=r.encode(c).length;if(i+d>t)break;a+=c,i+=d}return a.length<e.length?`${a}...`:a},mr=({src:e,className:t,alt:r,onError:i,onLoad:a,...c})=>{const[d,f]=M.useState(null),[g,z]=M.useState(!1),[$,T]=M.useState(!1),I=M.useRef(null);return M.useEffect(()=>{if(z(!1),!e||e.startsWith("blob:")||e.startsWith("http://")||e.startsWith("https://")){f(e),T(!1);return}if(Ui.isImageId(e)){T(!0),(async()=>{try{const P=await Ui.getImage(e);P?(I.current=P,f(P)):(console.warn(`[LazyBase64Image] Image not found in IDB: ${e}`),z(!0))}catch(P){console.error("[LazyBase64Image] IDB resolve failed:",P),z(!0)}T(!1)})();return}if(e.startsWith("data:")){const N=ll(e);(async()=>{try{const _=Rm(N);if(!_){z(!0),f(null);return}const F=URL.createObjectURL(_);I.current=F,f(F)}catch(_){console.warn("Base64Blob",_),z(!0),f(null)}})()}else f(e);return()=>{I.current&&I.current.startsWith("blob:")&&(URL.revokeObjectURL(I.current),I.current=null)}},[e]),$||g&&!d||!d||Ui.isImageId(d)?null:s.jsx("img",{src:d,className:t,alt:r,onError:i,onLoad:a,...c})},i_=M.memo(({item:e,idx:t,imgUrl:r,displayImgUrl:i,theme:a,canDrag:c,lightboxItem:d,onImageClick:f,onImageContextMenu:g,onCacheMissing:z,handleDragStart:$})=>{const[T,I]=M.useState(!1);M.useEffect(()=>{I(!1)},[i]);const N=e.selectedMjImageIndex===t&&d&&d.id===e.id,P=a==="dark"?"text-zinc-500":"text-[#616161]";return s.jsxs("div",{onClick:_=>f&&f(_,e,r,t),onContextMenu:_=>g&&g(_,e,r,t),onDragStart:_=>{c&&(_.stopPropagation(),$(_,r))},draggable:c,className:`relative w-full h-full cursor-pointer border-2 transition-all overflow-hidden ${N?"border-blue-500 scale-95":"border-transparent hover:border-blue-500/50"}`,children:[s.jsx(mr,{src:i,loading:"lazy",className:"w-full h-full object-contain",alt:`${t+1}`,onLoad:()=>I(!0),onError:_=>{I(!1),console.error(` ${t+1} `),z&&z(e.id,i),_.target.style.display="none"}}),!T&&s.jsxs("div",{className:`absolute inset-0 flex items-center justify-center text-[10px] ${P} pointer-events-none select-none`,style:{fontFamily:'"Microsoft YaHei","","KaiTi","",serif'},children:["",t+1]}),N&&s.jsx("div",{className:"absolute top-1 right-1 w-3 h-3 bg-blue-500 rounded-full flex items-center justify-center z-10",children:s.jsx("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})}),ec=({label:e,values:t,onChange:r,placeholder:i,addLabel:a="+",formatItem:c=P=>P,disabled:d=!1,inputDisabled:f=!1,theme:g="dark",allowAll:z=!1,allowAllLabel:$="",onToggleAll:T=null,normalizeItem:I=P=>P,maxItems:N=1/0})=>{const[P,_]=M.useState(""),F=Array.isArray(t)?t:[],k=d||f,S=Number.isFinite(N)?N:1/0,A=F.length>=S,V=()=>{if(k||A)return;const le=P.trim();if(!le)return;const re=le.split(",").map(be=>be.trim()).filter(Boolean);if(re.length===0)return;const pe=[...F];re.forEach(be=>{const Ie=I(be);pe.length>=S||Ie&&!pe.includes(Ie)&&pe.push(Ie)}),r(pe),_("")},G=le=>{k||r(F.filter(re=>re!==le))};return s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${g==="dark"?"text-zinc-500":"text-zinc-600"}`,children:e}),Number.isFinite(S)&&S!==1/0&&s.jsxs("span",{className:`text-[9px] ${g==="dark"?"text-zinc-600":"text-zinc-500"}`,children:["(",F.length,"/",S,")"]})]}),$&&s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${g==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:!!z,onChange:le=>T&&T(le.target.checked),disabled:d}),s.jsx("span",{children:$})]})]}),s.jsx("div",{className:"flex flex-wrap gap-1 min-h-[18px]",children:F.length>0?F.map(le=>s.jsxs("span",{className:`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] ${g==="dark"?"bg-zinc-800 text-zinc-300":"bg-zinc-100 text-zinc-600"}`,children:[c(le),!k&&s.jsx("button",{onClick:()=>G(le),className:`${g==="dark"?"text-zinc-500 hover:text-red-400":"text-zinc-400 hover:text-red-500"}`,children:"x"})]},le)):s.jsx("span",{className:`text-[9px] ${g==="dark"?"text-zinc-600":"text-zinc-400"}`,children:""})}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("input",{type:"text",value:P,onChange:le=>_(le.target.value),onKeyDown:le=>{le.key==="Enter"&&(le.preventDefault(),V())},placeholder:i,disabled:k,className:`flex-1 rounded px-2 py-1 text-[10px] outline-none border ${g==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`}),s.jsx("button",{onClick:V,disabled:k||!P.trim()||A,className:`px-2 py-1 rounded text-[10px] ${k||!P.trim()||A?g==="dark"?"bg-zinc-800 text-zinc-600 cursor-not-allowed":"bg-zinc-100 text-zinc-400 cursor-not-allowed":g==="dark"?"bg-zinc-700 text-zinc-200 hover:bg-zinc-600":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"}`,children:a})]})]})},o_=({visible:e,progress:t,status:r,type:i})=>e?s.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 backdrop-blur-[2px] animate-in fade-in duration-300 pointer-events-none select-none",children:s.jsxs("div",{className:"relative bg-[#09090b]/90 border border-white/10 rounded-2xl p-8 shadow-2xl flex flex-col items-center min-w-[300px] backdrop-blur-xl",children:[s.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 w-20 h-20 bg-blue-500/20 blur-[50px] rounded-full pointer-events-none"}),s.jsxs("div",{className:"flex flex-col items-center gap-1 mb-6 z-10",children:[s.jsx("span",{className:"font-mono text-[10px] tracking-[0.3em] uppercase text-zinc-500",children:i==="import"?"DATA INGESTION":"SYSTEM ARCHIVING"}),s.jsxs("div",{className:"text-4xl font-bold text-zinc-200 tracking-tighter font-sans",children:[t.toFixed(0),s.jsx("span",{className:"text-sm text-zinc-500 ml-1",children:"%"})]})]}),s.jsx("div",{className:"relative w-full h-[2px] bg-zinc-800 rounded-full overflow-hidden mb-4",children:s.jsx("div",{className:"absolute top-0 left-0 h-full bg-white shadow-[0_0_10px_rgba(255,255,255,0.5)] transition-all duration-100 ease-linear",style:{width:`${t}%`}})}),s.jsx("span",{className:"text-[10px] font-mono text-zinc-400 tracking-widest uppercase animate-pulse",children:r})]})}):null,iv=M.memo(({item:e,theme:t,lightboxItem:r,onDelete:i,onClick:a,onContextMenu:c,onImageClick:d,onImageContextMenu:f,onRefresh:g,onRebuildThumbnail:z,performanceMode:$,localServerUrl:T,localCacheActive:I,onCacheMissing:N,getHistoryMeta:P,isSelected:_,onSelect:F,providers:k,defaultProviders:S})=>{var ut,ot,Ue;const A=e.url||e.originalUrl||e.mjOriginalUrl||(e.mjImages&&e.mjImages.length>0?e.mjImages[0]:null),G=(I&&e.localCacheMap&&A?e.localCacheMap[A]:null)||e.localCacheUrl||(e.localCacheMap?Object.values(e.localCacheMap)[0]:null),le=!!(I&&G),re=e.thumbnailUrl||null,pe=e.status==="completed"&&(e.type==="image"||e.mjImages&&e.mjImages.length>0),be=(()=>{var en,Ot;const Xe=((en=e.apiConfig)==null?void 0:en.modelId)||((Ot=e.apiConfig)==null?void 0:Ot.model)||e.model||e.modelName||"";return e.modelName&&e.provider&&e.modelName.toLowerCase()===e.provider.toLowerCase()?Xe:e.modelName||Xe})(),Ie=s_(be,15),qe=e.provider||((ut=e.apiConfig)==null?void 0:ut.provider)||"",Q=Xe=>le?G:$!=="off"&&re?re:Xe,[_e,D]=M.useState(null),Te=(Xe=null)=>{if(Xe)return I&&e.localCacheMap&&e.localCacheMap[Xe]?e.localCacheMap[Xe]:Xe;if(e.mjImages&&e.mjImages.length>0){const en=e.selectedMjImageIndex??0,Ot=e.mjImages[en]||e.mjImages[0];if(Ot)return I&&e.localCacheMap&&e.localCacheMap[Ot]?e.localCacheMap[Ot]:Ot}return e.originalUrl||e.mjOriginalUrl||e.url||e.localCacheUrl||(e.localCacheMap?Object.values(e.localCacheMap)[0]:"")||""},Lt=(Xe,en=null)=>{const Ot=Te(en);if(!Ot)return;const gn={source:"history",itemId:e.id,url:Ot,selectedIndex:e.selectedMjImageIndex??0};Xe.dataTransfer.effectAllowed="copy",Xe.dataTransfer.setData("application/x-tapnow-history",JSON.stringify(gn)),Xe.dataTransfer.setData("text/uri-list",Ot),Xe.dataTransfer.setData("text/plain",Ot)};M.useEffect(()=>{const Xe=e.url||e.originalUrl||e.mjOriginalUrl;D(le?G:Xe)},[e.url,e.originalUrl,e.mjOriginalUrl,le,G]);const ye=M.useRef({url:null,time:0});M.useEffect(()=>{if(!le||!G)return;const Xe=Date.now();ye.current.url===G&&Xe-ye.current.time<1e4||(ye.current={url:G,time:Xe},fetch(G,{method:"HEAD"}).then(en=>{en.ok||N&&N(e.id,G)}).catch(()=>{N&&N(e.id,G)}))},[le,G,e.id,N]);const ke=P?P(e):null,he=(ke==null?void 0:ke.ratioLabel)??(e.ratio||e.mjRatio),Oe=(ke==null?void 0:ke.resolutionLabel)??(e.resolution||(e.width&&e.height?`${e.width}x${e.height}`:null)),ae=(ke==null?void 0:ke.durationLabel)??(e.type==="video"&&e.duration?`${e.duration}s`:null),fe=(ke==null?void 0:ke.customParamLabels)||[];return s.jsxs("div",{className:`group rounded-lg overflow-hidden border relative cursor-pointer transition-colors ${_?"border-blue-500 ring-2 ring-blue-500/30":t==="dark"?"bg-zinc-900 border-zinc-800 hover:border-blue-500/50":"bg-white border-zinc-200 hover:border-blue-500/50"}`,style:{contentVisibility:"auto",containIntrinsicSize:"1px 300px"},onClick:a,onContextMenu:c,draggable:pe,onDragStart:pe?Xe=>Lt(Xe):void 0,children:[le&&s.jsx("div",{className:"absolute top-1 left-1 z-10 px-1 py-0.5 rounded text-[8px] bg-black/60 text-green-300",children:""}),!le&&$!=="off"&&re&&s.jsx("div",{className:`absolute top-1 left-1 z-10 px-1 py-0.5 rounded text-[8px] bg-black/60 ${$==="ultra"?"text-orange-400":"text-zinc-400"}`,children:$==="ultra"?"":""}),F&&s.jsx("button",{onClick:Xe=>{Xe.stopPropagation(),Xe.preventDefault(),F(e.id)},className:`absolute bottom-2 right-2 z-20 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${_?"bg-green-500 border-green-400 opacity-100":"border-white/60 bg-black/50 opacity-100 hover:bg-black/70"}`,title:_?"":"",children:_&&s.jsx(Od,{size:16,className:"text-white"})}),s.jsxs("div",{className:`${t==="dark"?"bg-black":"bg-[#fafafa]"} relative ${e.mjImages&&(e.mjImages.length===4||e.mjImages.length>1)||e.mjNeedsSplit&&((Ue=(ot=e.apiConfig)==null?void 0:ot.modelId)!=null&&Ue.includes("mj"))?(()=>{const Xe=e.mjRatio||"1:1";return Xe==="16:9"?"aspect-video":Xe==="9:16"?"aspect-[9/16]":Xe==="4:3"?"aspect-[4/3]":Xe==="3:4"?"aspect-[3/4]":Xe==="21:9"?"aspect-[21/9]":"aspect-square"})():"aspect-video"}`,children:[e.status==="completed"?e.mjImages&&(e.mjImages.length===4||e.mjImages.length>1)?s.jsx("div",{className:`w-full h-full grid gap-0.5 p-0.5 ${e.mjImages.length===4?"grid-cols-2 grid-rows-2":"grid-cols-2"}`,children:e.mjImages.map((Xe,en)=>{e.mjImageInfo&&e.mjImageInfo[en];const gn=(I&&e.localCacheMap?e.localCacheMap[Xe]:null)||($!=="off"&&e.mjThumbnails&&e.mjThumbnails[en]?e.mjThumbnails[en]:Xe);return s.jsx(i_,{item:e,idx:en,imgUrl:Xe,displayImgUrl:gn,theme:t,canDrag:pe,lightboxItem:r,onImageClick:d,onImageContextMenu:f,onCacheMissing:N,handleDragStart:Lt},en)})}):e.type==="image"?s.jsx(mr,{src:Q(e.url||e.originalUrl||e.mjOriginalUrl),loading:"lazy",className:"w-full h-full object-cover",alt:e.prompt||"",onError:Xe=>{console.error(":",e.url||e.originalUrl||e.mjOriginalUrl),N&&N(e.id,Q(e.url||e.originalUrl||e.mjOriginalUrl)),Xe.target.style.display="none"}}):s.jsx("video",{src:_e||e.url||e.originalUrl,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,preload:"metadata",onError:()=>{const Xe=e.url||e.originalUrl||e.mjOriginalUrl;le&&Xe&&_e===G?(D(Xe),N&&N(e.id,G)):console.error(":",Xe)}}):s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(wo,{className:"animate-spin text-zinc-600"})}),s.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-1 ${t==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:s.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${e.progress}%`}})})]}),s.jsxs("div",{className:`px-3 py-2 text-[11px] ${t==="solarized"?"bg-[#eee8d5]":""}`,children:[s.jsxs("div",{className:"flex justify-between items-start gap-2",children:[s.jsx("span",{className:`line-clamp-2 ${t==="dark"?"text-zinc-300":t==="solarized"?"text-black":"text-zinc-700"}`,children:e.prompt||"Untitled"}),s.jsxs("div",{className:`shrink-0 ml-1 ${e.type==="image"?"flex flex-col items-center gap-1":"flex items-center gap-1"}`,children:[e.type==="video"&&(e.status==="generating"||e.status==="failed")&&s.jsx("button",{onClick:Xe=>{Xe.stopPropagation(),g&&g(e)},className:`shrink-0 p-0.5 ${t==="dark"?"text-zinc-500 hover:text-white":t==="solarized"?"text-black hover:text-zinc-700":"text-zinc-400 hover:text-zinc-900"}`,title:"",children:s.jsx(qd,{size:12})}),s.jsx("button",{onClick:Xe=>{Xe.stopPropagation(),i&&i(e.id)},className:`shrink-0 p-0.5 ${t==="dark"?"text-zinc-500 hover:text-red-500":t==="solarized"?"text-black hover:text-red-600":"text-zinc-400 hover:text-red-500"}`,title:"",children:s.jsx(cs,{size:12})}),e.type==="image"&&s.jsx("button",{onClick:Xe=>{Xe.stopPropagation(),z&&z(e)},className:`shrink-0 p-0.5 rounded ${t==="dark"?"text-blue-300 hover:text-blue-200 hover:bg-blue-500/20":"text-blue-500 hover:text-blue-600 hover:bg-blue-100"}`,title:"",children:s.jsx(qd,{size:12})})]})]}),e.status==="failed"&&e.errorMsg&&s.jsx("p",{className:"text-[9px] text-red-500 mt-1 break-words whitespace-pre-wrap",children:e.errorMsg.split(`
`).map((Xe,en)=>s.jsxs("span",{children:[Xe,en<e.errorMsg.split(`
`).length-1&&s.jsx("br",{})]},en))}),e.status==="generating"&&s.jsx("p",{className:"text-[9px] text-blue-500 mt-1",children:e.errorMsg||"..."}),s.jsx("div",{className:"h-1.5"}),s.jsxs("div",{className:"flex flex-col w-full",children:[s.jsx("span",{className:t==="dark"?"text-zinc-500":t==="solarized"?"text-black":"text-zinc-400",children:(()=>{const Xe=e.hasInputImages===!0,en=e.type==="video";return[en?Xe?"":"":Xe?"":"",he,Oe,en&&ae?ae:null,...fe].filter(Boolean).join("  ")})()}),s.jsxs("span",{className:t==="dark"?"text-zinc-500":t==="solarized"?"text-black":"text-zinc-400",children:[e.time,"  ",s.jsx("span",{title:qe||be,children:Ie}),typeof e.durationMs=="number"&&e.durationMs>0&&s.jsxs(s.Fragment,{children:["   ",(e.durationMs/1e3).toFixed(1),"s"]})]})]})]})]})},(e,t)=>{var r,i;return e.item===t.item&&e.theme===t.theme&&((r=e.lightboxItem)==null?void 0:r.id)===((i=t.lightboxItem)==null?void 0:i.id)&&e.isSelected===t.isSelected&&e.performanceMode===t.performanceMode&&e.localCacheActive===t.localCacheActive&&e.getHistoryMeta===t.getHistoryMeta}),a_=({nodeId:e,imageUrl:t,imageDimensions:r,isActive:i,onClose:a,onSave:c,theme:d,view:f,maskContent:g,onUpdateNode:z})=>{const $=M.useRef(null),T=M.useRef(null),I=M.useRef(null),[N,P]=M.useState(30),[_,F]=M.useState(!1),[k,S]=M.useState([]),[A,V]=M.useState(-1),G=10,[le,re]=M.useState(r);M.useEffect(()=>{r!=null&&r.w&&(r!=null&&r.h)&&re(r)},[r]),M.useEffect(()=>{if(!i||!t||r!=null&&r.w&&(r!=null&&r.h))return;let ye=!1;return Fr(t).then(ke=>{ye||ke!=null&&ke.w&&(ke!=null&&ke.h)&&(re(ke),z&&z(e,{dimensions:ke}))}).catch(()=>{}),()=>{ye=!0}},[i,t,r,e,z]),M.useEffect(()=>{if(!i||!$.current||!le)return;const ye=$.current,ke=ye.getContext("2d");if(T.current=ke,ye.width=le.w,ye.height=le.h,ke.clearRect(0,0,ye.width,ye.height),g){const he=new Image;he.onload=()=>{ke.drawImage(he,0,0),pe()},he.src=g}else pe()},[i,le,e,g]);const pe=()=>{if(!$.current||!T.current)return;const ye=$.current,he=T.current.getImageData(0,0,ye.width,ye.height),Oe=k.slice(0,A+1);Oe.push(he),Oe.length>G&&Oe.shift(),S(Oe),V(Oe.length-1)},be=ye=>{if(!$.current)return null;const ke=$.current,he=ke.getBoundingClientRect(),Oe=ye.clientX-he.left,ae=ye.clientY-he.top,fe=ke.width/he.width,ut=ke.height/he.height;return{x:Math.round(Oe*fe),y:Math.round(ae*ut)}},Ie=ye=>{if(!_||!$.current||!T.current)return;const ke=be(ye);if(!ke)return;const he=T.current;he.globalCompositeOperation="source-over",he.strokeStyle="#FFFFFF",he.fillStyle="#FFFFFF",he.lineWidth=N,he.lineCap="round",he.lineJoin="round",I.current?(he.beginPath(),he.moveTo(I.current.x,I.current.y),he.lineTo(ke.x,ke.y),he.stroke()):(he.beginPath(),he.arc(ke.x,ke.y,N/2,0,Math.PI*2),he.fill()),I.current=ke},qe=ye=>{ye.button===0&&(ye.preventDefault(),ye.stopPropagation(),I.current=null,F(!0),pe(),Ie(ye))},Q=ye=>{_&&(ye.preventDefault(),ye.stopPropagation(),Ie(ye))},_e=ye=>{_&&(ye.preventDefault(),ye.stopPropagation(),F(!1),I.current=null,pe())},D=()=>{if(A<=0||!$.current||!T.current)return;const ye=A-1;V(ye),T.current.putImageData(k[ye],0,0)},Te=()=>{if(!$.current||!T.current)return;T.current.clearRect(0,0,$.current.width,$.current.height),pe()},Lt=()=>{if(!$.current)return;const ke=$.current.toDataURL("image/png");z&&z(e,{maskContent:ke,isMasking:!1}),c&&c(ke),a&&a()};return M.useEffect(()=>{if(!i)return;const ye=ke=>{(ke.ctrlKey||ke.metaKey)&&ke.key==="z"&&!ke.shiftKey&&(ke.preventDefault(),D())};return window.addEventListener("keydown",ye),()=>window.removeEventListener("keydown",ye)},[i,A,k]),!i||!t||!le?null:s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"absolute inset-0 z-50 pointer-events-auto",style:{mixBlendMode:"normal"},onMouseDown:ye=>ye.stopPropagation(),onMouseMove:ye=>ye.stopPropagation(),onMouseUp:ye=>ye.stopPropagation(),children:[s.jsx("canvas",{ref:$,className:"absolute inset-0 w-full h-full",style:{opacity:.5,mixBlendMode:"multiply",cursor:"crosshair",pointerEvents:"auto",imageRendering:"auto"},onMouseDown:qe,onMouseMove:Q,onMouseUp:_e,onMouseLeave:_e}),s.jsx(n_,{canvasRef:$,isDrawing:_})]}),$f.createPortal(s.jsxs("div",{className:`fixed bottom-4 left-1/2 -translate-x-1/2 flex flex-row items-center gap-4 p-2 rounded-full border backdrop-blur-md shadow-xl z-[9999] ${d==="dark"?"bg-zinc-900/90 border-zinc-700 text-zinc-200":"bg-white/90 border-zinc-300 text-zinc-800"}`,onMouseDown:ye=>ye.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:""}),s.jsx("input",{type:"range",min:"10",max:"150",value:N,onChange:ye=>P(Number(ye.target.value)),className:"w-20",onMouseDown:ye=>ye.stopPropagation()}),s.jsxs("span",{className:"text-[10px] w-8 text-right whitespace-nowrap",children:[N,"px"]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:D,disabled:A<=0,className:`p-1.5 rounded-full transition-colors ${d==="dark"?"hover:bg-zinc-800 disabled:opacity-50 disabled:cursor-not-allowed":"hover:bg-zinc-100 disabled:opacity-50 disabled:cursor-not-allowed"}`,title:" (Ctrl+Z)",children:s.jsx(q5,{size:14})}),s.jsx("button",{onClick:Te,className:`p-1.5 rounded-full transition-colors ${d==="dark"?"hover:bg-zinc-800":"hover:bg-zinc-100"}`,title:"",children:s.jsx(Hw,{size:14})}),s.jsx("button",{onClick:Lt,className:"p-1.5 rounded-full bg-blue-600 hover:bg-blue-500 text-white transition-colors",title:"/",children:s.jsx(rl,{size:14})})]})]}),document.body)]})},l_=`
        /*  */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        :root {
            --canvas-grid-color: rgba(0, 0, 0, 0.05);
        }
        .theme-dark {
            --canvas-grid-color: rgba(255, 255, 255, 0.06);
        }
        .theme-solarized {
            --canvas-grid-color: #eee8d5;
        }
        
        /*  */
        #canvas-bg {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
            background-image: radial-gradient(var(--canvas-grid-color) 1px, transparent 1px);
            background-size: 24px 24px;
            background-position: 0 0;
        }
        .theme-solarized #canvas-bg {
            box-shadow: inset 0 0 0 1px #eee8d5;
        }

        .theme-solarized button[class*="bg-blue-"],
        .theme-solarized button[class*="bg-green-"] {
            background-color: #616161 !important;
            border-color: #616161 !important;
            color: #fdf6e3 !important;
        }
        .theme-solarized button[class*="bg-blue-"]:hover,
        .theme-solarized button[class*="bg-green-"]:hover {
            background-color: #4b4b4b !important;
        }
        
        /*  */
        #canvas-bg > div[style*="transform"] {
            transform: translateZ(0);
            will-change: transform;
        }
        
        /*  */
        .node-wrapper {
            transform: translateZ(0);
            backface-visibility: hidden;
            contain: layout style;
            will-change: transform, left, top;
        }
        
        /*  -  */
        .node-wrapper img,
        .node-wrapper video {
            image-rendering: auto;
            image-rendering: -webkit-optimize-contrast;
            transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            pointer-events: none;
        }
        
        /*  */
        svg {
            shape-rendering: geometricPrecision;
            text-rendering: optimizeLegibility;
        }
        
        /*  */
        .perf-mode .node-wrapper {
            box-shadow: none !important;
            backdrop-filter: none !important;
            border-radius: 0 !important;
            transition: none !important;
        }
        .perf-mode .connection-group {
            opacity: 1 !important;
        }
        
        /*  */
        .interacting .node-wrapper img {
            image-rendering: pixelated;
        }
        .interacting .connection-group {
            display: none;
            pointer-events: none;
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .theme-dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 2px; }
        .theme-dark .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #52525b; }
        .theme-light .custom-scrollbar::-webkit-scrollbar-thumb { background: #d4d4d8; border-radius: 2px; }
        .theme-light .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
        .theme-solarized .custom-scrollbar::-webkit-scrollbar-thumb { background: #c9c2a8; border-radius: 2px; }
        .theme-solarized .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #b9b091; }
        .theme-solarized button[class*="bg-blue-"],
        .theme-solarized button[class*="bg-green-"],
        .theme-solarized button[class*="from-blue-"],
        .theme-solarized button[class*="from-green-"],
        .theme-solarized button[class*="to-emerald-"],
        .theme-solarized button[class*="to-indigo-"] {
            background-image: none !important;
            background-color: #616161 !important;
            border-color: #525252 !important;
            color: #fdf6e3 !important;
        }
        .theme-solarized button[class*="bg-blue-"]:hover,
        .theme-solarized button[class*="bg-green-"]:hover,
        .theme-solarized button[class*="from-blue-"]:hover,
        .theme-solarized button[class*="from-green-"]:hover,
        .theme-solarized button[class*="to-emerald-"]:hover,
        .theme-solarized button[class*="to-indigo-"]:hover {
            background-color: #555555 !important;
        }
        .theme-solarized [class*="hover:bg-zinc-100"]:hover {
            background-color: #fdf6e3 !important;
        }
        .theme-solarized [class*="hover:bg-zinc-200"]:hover {
            background-color: #eee8d5 !important;
        }
        .resize-handle { cursor: nwse-resize; opacity: 0; transition: opacity 0.2s; }
        .node-wrapper:hover .resize-handle { opacity: 1; }
        
        /*  */
        .connector { position: absolute; top: 50%; transform: translateY(-50%); width: 0.9rem; height: 0.9rem; background-color: #27272a; border: 1px solid #71717a; color: #a1a1aa; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: crosshair; transition: all 0.2s; z-index: 30; opacity: 0; pointer-events: auto; }
        .node-wrapper:hover .connector { opacity: 1; }
        .connector:hover, .connector.active { background-color: #d4d4d8; border-color: #fff; transform: translateY(-50%) scale(1.2); opacity: 1; color: #000; }
        .connector-right { right: -0.45rem; }
        
        /*  */
        .input-point { position: absolute; top: 50%; transform: translateY(-50%); left: -0.25rem; width: 0.5rem; height: 0.5rem; background-color: #52525b; border-radius: 50%; border: 1px solid #18181b; transition: all 0.2s; z-index: 20; cursor: crosshair; }
        .node-wrapper:hover .input-point { background-color: #a1a1aa; }
        .input-point.connected { background-color: #60a5fa; box-shadow: 0 0 6px #60a5fa; }
        .input-point.active { background-color: #60a5fa; border-color: #fff; transform: translateY(-50%) scale(1.3); box-shadow: 0 0 8px #60a5fa; }

        /* Lightbox & Overlay */
        .lightbox-overlay { background-color: rgba(0, 0, 0, 0.95); backdrop-filter: blur(5px); }
        
        /* Stack Items */
        .thumb-stack-item {
             transition: transform 0.2s, z-index 0.2s;
        }
        .thumb-stack-item:hover {
            transform: scale(1.1) translateY(-2px);
            z-index: 10 !important;
            border-color: #60a5fa;
        }

        /*  */
        .connection-delete {
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: auto; /*  */
        }
        /*  */
        .connection-group:hover .connection-delete {
            opacity: 1;
        }

        /*  */
        .drop-zone {
            border: 2px dashed transparent;
            transition: all 0.3s;
        }
        .drop-zone.drag-over {
            border-color: #60a5fa;
            background-color: rgba(96, 165, 250, 0.1);
        }

        /* Markdown Styles for Chat */
        .markdown-body { font-size: 13px; line-height: 1.5; color: #e4e4e7; word-wrap: break-word; user-select: text !important; cursor: text; }
        .markdown-body * { user-select: text !important; cursor: text; }
        .markdown-body pre { background: #27272a; padding: 10px; border-radius: 6px; overflow-x: auto; margin: 8px 0; white-space: pre-wrap; word-wrap: break-word; user-select: text !important; cursor: text; }
        .markdown-body code { font-family: monospace; background: #3f3f46; padding: 2px 4px; border-radius: 4px; font-size: 12px; user-select: text !important; cursor: text; }
        .markdown-body pre code { background: transparent; padding: 0; color: #a1a1aa; user-select: text !important; cursor: text; }
        .markdown-body p { margin-bottom: 8px; user-select: text !important; cursor: text; }
        .markdown-body ul, .markdown-body ol { margin-left: 20px; margin-bottom: 8px; list-style: disc; user-select: text !important; cursor: text; }
        .markdown-body li { user-select: text !important; cursor: text; }
        .markdown-body video { max-width: 100%; border-radius: 0.5rem; margin-top: 0.5rem; }
        .markdown-body table { border-collapse: collapse; width: 100%; margin: 12px 0; }
        .markdown-body table th, .markdown-body table td { border: 1px solid #3f3f46; padding: 8px 12px; text-align: left; }
        .markdown-body table th { background-color: #3f3f46; font-weight: 600; }
        .markdown-body table tr:nth-child(even) { background-color: #27272a; }
        .theme-light .markdown-body table th, .theme-light .markdown-body table td { border-color: #d4d4d8; }
        .theme-light .markdown-body table th { background-color: #e4e4e7; }
        .theme-light .markdown-body table tr:nth-child(even) { background-color: #f4f4f5; }
        .theme-light .markdown-body { color: #18181b; }
        .theme-light .markdown-body pre { background: #f4f4f5; color: #18181b; }
        .theme-light .markdown-body code { background: #e4e4e7; color: #18181b; }
        .theme-light .markdown-body pre code { color: #18181b; }
        .theme-solarized .markdown-body table th, .theme-solarized .markdown-body table td { border-color: #d7cfb2; }
        .theme-solarized .markdown-body table th { background-color: #ddddc1; }
        .theme-solarized .markdown-body table tr:nth-child(even) { background-color: #eee8d5; }
        .theme-solarized .markdown-body { color: #586e75; }
        .theme-solarized .markdown-body pre { background: #ddddc1; color: #586e75; }
        .theme-solarized .markdown-body code { background: #ddddc1; color: #586e75; }
        .theme-solarized .markdown-body pre code { color: #586e75; }
        `,c_=4e3,d_=4e3,ss="https://ai.comfly.chat",u_="http://localhost:5100",Ud={openai:{key:"",url:ss,apiType:"openai",useProxy:!1,forceAsync:!1},google:{key:"",url:ss,apiType:"openai",useProxy:!1,forceAsync:!1},deepseek:{key:"",url:ss,apiType:"openai",useProxy:!1,forceAsync:!1},flux:{key:"",url:ss,apiType:"openai",useProxy:!1,forceAsync:!1},midjourney:{key:"",url:"https://api.midjourney.com",apiType:"openai",useProxy:!1,forceAsync:!1},jimeng:{key:"",url:u_,apiType:"openai",useProxy:!1,forceAsync:!1},grok:{key:"",url:"https://ai.t8star.cn",apiType:"openai",useProxy:!1,forceAsync:!1},modelscope:{key:"",url:"https://api-inference.modelscope.cn",apiType:"modelscope",useProxy:!1,forceAsync:!0},yunwu:{key:"",url:"https://yunwu.ai",apiType:"gemini",useProxy:!1,forceAsync:!1},vibecoding:{key:"",url:"https://vibecodingapi.ai",apiType:"gemini",useProxy:!1,forceAsync:!1}},Dm=[{id:"gpt-5.1",provider:"openai",type:"Chat"},{id:"gpt-5.2",provider:"openai",type:"Chat"},{id:"gpt-4o",provider:"openai",type:"Chat"},{id:"deepseek-v3-1-250821",provider:"deepseek",type:"Chat"},{id:"gemini-3-pro-preview",provider:"google",type:"Chat"},{id:"MJ V6",provider:"midjourney",type:"Image"},{id:"flux-kontext-pro",provider:"flux",type:"Image"},{id:"gpt-4o-image",provider:"openai",type:"Image"},{id:"Tongyi-MAI/Z-Image-Turbo",provider:"modelscope",type:"Image"},{id:"gemini-3-pro-image-preview",provider:"yunwu",type:"Image"},{id:"jimeng-4.5",provider:"jimeng",type:"Image"},{id:"jimeng-4.1",provider:"jimeng",type:"Image"},{id:"jimeng-4.0",provider:"jimeng",type:"Image"},{id:"jimeng-3.1",provider:"jimeng",type:"Image"},{id:"jimeng-3.0",provider:"jimeng",type:"Image"},{id:"jimeng-2.1",provider:"jimeng",type:"Image"},{id:"jimeng-xl-pro",provider:"jimeng",type:"Image"},{id:"nanobananapro",provider:"jimeng",type:"Image"},{id:"nanobanana",provider:"jimeng",type:"Image"},{id:"sora-2",provider:"openai",type:"Video",durations:["5s","10s"]},{id:"sora-2-pro",provider:"openai",type:"Video",durations:["15s","25s"]},{id:"jimeng-video-3.5-pro",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-veo3",provider:"jimeng",type:"Video",durations:["8s"]},{id:"jimeng-video-veo3.1",provider:"jimeng",type:"Video",durations:["8s"]},{id:"jimeng-video-sora2",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-3.0-pro",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-3.0",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-3.0-fast",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-2.0-pro",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-2.0",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"grok-video-3",provider:"grok",type:"Video",durations:["8s","5s"]}],Af=["Auto","1:1","16:9","9:16","4:3","3:4","21:9","3:2","2:3"],p_=["3:2","2:3","1:1"],Kw=["1080P","720P"],ov="tapnow_prompt_library",av="3x3 gridKeep character strictly consistent9Character Sheet",lv="UpscaleSharpeningDenoisingBest quality, 8k, masterpiece, highres, ultra detailed, sharp focus, image restoration, upscale, faithful to original.",cv=`you are a veteran Hollywood storyboard artist with years of experience. You have the ability to accurately analyze character features and scene characteristics based on images. Provide me with the most suitable camera angles and storyboards. Strictly base this on the uploaded character and scene images, while maintaining a consistent visual style.

MANDATORY LAYOUT: Create a precise 3x3 GRID containing exactly 9 distinct panels.

- The output image MUST be a single image divided into a 3 (rows) by 3 (columns) matrix.
- There must be EXACTLY 3 horizontal rows and 3 vertical columns.
- Each panel must be completely separated by a thin, distinct, solid black line.
- DO NOT create a collage. DO NOT overlap images. DO NOT create random sizes. 
- The grid structure must be perfectly aligned for slicing.

Subject Content: "[]"

Styling Instructions:
- Each panel shows the SAME subject/scene from a DIFFERENT angle (e.g., Front, Side, Back, Action, Close-up).
- Maintain perfect consistency of the character/object across all panels.
- Cinematic lighting, high fidelity, 8k resolution.

Negative Constraints:
- No text, no captions, no UI elements.
- No watermarks.
- No broken grid lines.`,dv=`(strictly mimic source image art style:1.5), (same visual style:1.4),
score_9, score_8_up, masterpiece, best quality, (character sheet:1.4), (reference sheet:1.3), (consistent art style:1.3), matching visual style, 

[Structure & General Annotations]:
multiple views, full body central figure, clean background, 
(heavy annotation:1.4), (text labels with arrows:1.3), handwriting, data readout,

[SPECIAL CHARACTER DESCRIPTION AREA]:
(prominent character profile text box:1.6), (dedicated biography section:1.5), large descriptive text block,
[],

[Clothing Breakdown]:
(clothing breakdown:1.5), (outfit decomposition:1.4), garment analysis, (floating apparel:1.3), 
displaying outerwear, displaying upper body garment, displaying lower body garment, 

[Footwear Focus]:
(detailed footwear display:1.5), (floating shoes:1.4), shoe design breakdown, focus on shoes, 

[Inventory & Details]:
(inventory knolling:1.2), open container, personal accessories, organized items display, expression panels`,uv=`# Directive: Create a "Rich Narrative Mood Board" (8-Grid Layout)

## 1. PROJECT INPUT 

**A. [Story & Concept / ]**
> []

**B. [Key Symbols /  (Optional)]**
> []

**C. [Color Preferences /  (Optional)]**
> []

**D. [Reference Images / ]**
> (See attached images / )

---

## 2. Role Definition
Act as a **Senior Art Director**. Synthesize the Input above into a single, cohesive, high-density **Visual Mood Board** using a complex **8-Panel Asymmetrical Grid Layout**.

## 3. Layout Mapping (Strict Adherence)
You must design a visual composition that tells the story through **8 distinct panels** within one image. **Do not** generate random grids. Map the content exactly as follows:

* **Panel 1 (The World):** A wide, cinematic establishing shot of the environment (based on Input A).
* **Panel 2 (The Protagonist):** A portrait close-up (based on reference images), focusing on micro-expressions.
* **Panel 3 (The Metaphor):** An **abstract symbolic object** representing the core theme (based on Input B).
* **Panel 4 (The Palette):** A graphical **Color Palette Strip** showcasing 5 specific colors extracted from the scene.
* **Panel 5 (The Texture):** Extreme macro close-up of a material surface (e.g., rust, skin, fabric) to add tactile richness.
* **Panel 6 (The Motion):** A motion-blurred or long-exposure shot representing time/chaos.
* **Panel 7 (The Detail):** A focused shot of a specific prop or accessory relevant to the plot.
* **Panel 8 (The AI Art Interpretation - CRITICAL):** This is your **free creative space**. Generate an artistic, surreal, or abstract re-interpretation of the story's emotion. **Do not just copy the inputs.** Create a "Vibe Image" (e.g., Double Exposure, Oil Painting style, or abstract geometry) that captures the *soul* of the narrative.

## 4. Execution Requirements
* **Composition Style:** High-end Editorial / Magazine Layout. Clean, thin white borders.
* **Visual Unity:** All panels must share the same lighting conditions and color grading logic (Unified Aesthetic).
* **Task:** Provide the **Final English Image Prompt** that explicitly describes this 8-grid layout, ensuring Panel 8 stands out as an artistic variation.`,Lm=["gemini-image","qwen-image","doubao-seedream","jimeng","hailuo-02","kling-v1-6","wan-2.5"],f_=[...Dm.filter(e=>!Lm.includes(e.id)).filter(e=>!["Tongyi-MAI/Z-Image-Turbo","gemini-3-pro-image-preview"].includes(e.id)).map(e=>{var a;const t=e.type==="Video",r=t&&/veo3\.1/i.test(e.id),i=t&&/sora-2/i.test(e.id);return{id:e.id,displayName:e.id,modelName:e.id,type:e.type||"Chat",ratioLimits:null,resolutionLimits:null,durations:Array.isArray(e.durations)?e.durations:null,videoResolutions:t?[...Kw]:null,supportsFirstLastFrame:r,supportsHD:i,apiType:((a=Ud[e.provider])==null?void 0:a.apiType)||"openai",customParams:[]}}),{id:"Tongyi-MAI/Z-Image-Turbo",displayName:"Z-Image Turbo",modelName:"Tongyi-MAI/Z-Image-Turbo",type:"Image",ratioLimits:null,resolutionLimits:["1K","2K","4K"],durations:null,videoResolutions:null,supportsFirstLastFrame:!1,supportsHD:!1,apiType:"modelscope",customParams:[]},{id:"gemini-3-pro-image-preview",displayName:"Gemini 3 Pro Image Preview",modelName:"gemini-3-pro-image-preview",type:"Image",ratioLimits:null,resolutionLimits:["1K","2K","4K"],durations:null,videoResolutions:null,supportsFirstLastFrame:!1,supportsHD:!1,apiType:"gemini",customParams:[]}],h_=e=>e&&e.includes("grok")?p_:Af,Om=["Auto","1K","2K","4K"],Qd=e=>{const t=String(e||"").trim();if(!t)return null;const r=t.toUpperCase();if(r==="AUTO")return"Auto";if(r==="1K"||r==="2K"||r==="4K")return r;const i=t.match(/^(\d+)\s*[xX]\s*(\d+)$/);if(i)return`${i[1]}x${i[2]}`;const a=r.match(/^(\d+)K$/);return a?`${a[1]}K`:t},Md=e=>{const t=Qd(e);return t||"2K"},Bg=e=>{const t=String(e||"").trim();return/^\d+\s*[xX]\s*\d+$/.test(t)},zo=e=>{const t=String(e||"").trim();if(!t)return"720P";if(t==="")return"Auto";const r=t.toUpperCase();return r==="AUTO"?"Auto":(r.endsWith("P")||r.endsWith("K"),r)},Ph=e=>{const t=zo(e);return!t||t==="Auto"?"":t.toLowerCase()},ns=e=>e==="Image"||e==="ChatImage",Td=30,m_=30,Yw=e=>{if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([r,i])=>{const a=String(r||"").trim(),c=typeof i=="string"?i.trim():"";a&&c&&(t[a]=c)}),t},rs=e=>Yw(e),el=e=>{if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([r,i])=>{const a=Qd(r),c=typeof i=="string"?i.trim():"";a&&c&&(t[a]=c)}),t},tc=e=>Array.isArray(e)?e.map((t,r)=>{if(!t)return null;const i=String(t.id||"").trim()||`param-${Date.now()}-${Math.random().toString(36).slice(2,6)}-${r}`,a=typeof t.name=="string"?t.name:"",c=Array.isArray(t.values)?t.values.map(g=>String(g).trim()).filter(Boolean):[],d=Yw(t.valueNotes||t.valueLabels||t.notes),f=typeof t.notesEnabled=="boolean"?t.notesEnabled:Object.keys(d).length>0;return{id:i,name:a,values:c,override:!!t.override,notesEnabled:f,valueNotes:d}}).filter(Boolean):[],Um=(e,t)=>{if(!e||!t)return"";const r=e.id&&t[e.id];if(r!=null&&r!=="")return r;const i=e.name&&t[e.name];return i!=null&&i!==""?i:""},Lr=(e,t,r)=>{if(!e)return"";if(!t)return e;const i=r==null?void 0:r[e];return i?`${e}(${i})`:e},Bp=(e,t,r)=>e?t&&(r==null?void 0:r[e])||e:"",pv=(e,t)=>Lr(t,!!(e!=null&&e.notesEnabled),(e==null?void 0:e.valueNotes)||{}),fv=(e,t,r)=>{if(!e||!Array.isArray(t)||t.length===0)return e;const i=typeof FormData<"u"&&e instanceof FormData;return t.forEach(a=>{const c=String((a==null?void 0:a.name)||"").trim();if(!c)return;const d=Um(a,r);if(!(d===""||d===void 0||d===null)){if(i){(a.override||!e.has(c))&&e.set(c,d);return}(a.override||e[c]===void 0)&&(e[c]=d)}}),e},g_=(e,t)=>{if(!e||!Array.isArray(t)||t.length===0)return e;const r={...e};return t.forEach(i=>{const a=String((i==null?void 0:i.name)||"").trim();if(!a)return;const c=Array.isArray(i.values)&&i.values.length>0?i.values[0]:"";c!==""&&(i.override||r[a]===void 0)&&(r[a]=c)}),r},Pd=e=>!e||typeof e!="object"||Array.isArray(e)?null:{...e},x_=(e,t)=>{if(e===t)return!0;if(typeof e=="object"||typeof t=="object")try{return JSON.stringify(e)===JSON.stringify(t)}catch{return!1}return!1},b_=(e,t)=>{if(!e||!t||typeof t!="object")return null;const r={},i=new Set(Object.keys(e));return Object.keys(t).forEach(a=>{const c=t[a],d=e[a];x_(d,c)||(r[a]=c),i.delete(a)}),i.forEach(a=>{r[a]=null}),Object.keys(r).length>0?r:null},Ah=(e,t)=>{if(!e||!t||typeof t!="object")return e;const r=typeof FormData<"u"&&e instanceof FormData;return Object.entries(t).forEach(([i,a])=>{if(i){if(a===null){r?e.delete(i):delete e[i];return}if(r){const c=typeof a=="string"?a:JSON.stringify(a);e.set(i,c);return}e[i]=a}}),e},y_=e=>e?e.type==="Video"?"/v1/videos/generations":e.type==="Chat"||e.type==="ChatImage"?"/v1/chat/completions":"/v1/images/generations":"/v1/images/generations",v_=(e,t)=>{const r=JSON.stringify(t||{},null,2);return["import requests, json",'BASE_URL = "https://api.example.com"','API_KEY = "YOUR_API_KEY"',`url = f"{BASE_URL}${e}"`,'headers = {"Authorization": f"Bearer {API_KEY}", "Content-Type": "application/json"}',`payload = json.loads('''${r}''')`,"resp = requests.post(url, headers=headers, json=payload)","print(resp.json())"].join(`
`)},w_=e=>e&&e.includes("jimeng-4.5")?["2K","4K"]:Om,Rh=[{label:"MJ V7",value:"--v 7"},{label:"MJ V6.1",value:"--v 6.1"},{label:"MJ V6",value:"--v 6"},{label:"MJ V5.2",value:"--v 5.2"},{label:"MJ V5.1",value:"--v 5.1"},{label:"Niji V6",value:"--niji 6"},{label:"Niji V5",value:"--niji 5"},{label:"Niji V4",value:"--niji 4"}],Jw=(e,t)=>{let r=1024,i=1024;if(Bg(t)){const g=String(t).trim().split(/[xX]/),z=parseInt(g[0],10),$=parseInt(g[1],10);if(Number.isFinite(z)&&Number.isFinite($)){const T=Math.max(16,Math.round(z/16)*16),I=Math.max(16,Math.round($/16)*16);return{str:`${T}x${I}`,w:T,h:I}}}if(t==="1080P")r=1920,i=1080;else if(t==="720P")r=1280,i=720;else if(t==="2K")r=2048,i=2048;else if(t==="4K")r=3840,i=2160;else if(typeof t=="string"){const g=t.toUpperCase().match(/^(\d+)K$/);if(g){const z=parseInt(g[1],10)*1024;r=z,i=z}}if(e==="Auto")return{str:`${r}x${i}`,w:r,h:i};const[a,c]=e.split(":").map(Number);if(!a||!c)return{str:"1024x1024",w:1024,h:1024};let d,f;return Math.abs(a-c)<.1?(d=r,f=i):a>c?(d=t==="Auto"||t==="1K"?1280:r,f=Math.round(d*(c/a))):(f=t==="Auto"||t==="1K"?1280:r,d=Math.round(f*(a/c))),d=Math.round(d/16)*16,f=Math.round(f/16)*16,{str:`${d}x${f}`,w:d,h:f}},z_=(e,t,r)=>{const{str:i,w:a,h:c}=Jw(t,r);return Bg(r)?{sizeStr:i,w:a,h:c}:e.includes("minimax")?{sizeStr:r==="4K"?"1080p":"720p",w:a,h:c}:e.includes("jimeng")||e.includes("veo")?{sizeStr:t,w:a,h:c}:e.includes("grok")?{sizeStr:t,w:a,h:c}:{sizeStr:i,w:a,h:c}},Hp="tapnow_autosave",Gw="tapnow_autosave_meta",k_="tapnow_autosave_db",Cc="autosave",Xw="latest",Zw=()=>typeof indexedDB>"u"?Promise.reject(new Error("IndexedDB not available")):new Promise((e,t)=>{const r=indexedDB.open(k_,1);r.onupgradeneeded=()=>{const i=r.result;i.objectStoreNames.contains(Cc)||i.createObjectStore(Cc)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error||new Error("IndexedDB open failed"))}),j_=async()=>{try{const e=await Zw();return await new Promise(t=>{const r=e.transaction(Cc,"readonly"),a=r.objectStore(Cc).get(Xw);a.onsuccess=()=>t(a.result||null),a.onerror=()=>t(null),r.oncomplete=()=>e.close(),r.onerror=()=>e.close()})}catch{return null}},N_=async e=>{const t=await Zw();return await new Promise((r,i)=>{const a=t.transaction(Cc,"readwrite"),d=a.objectStore(Cc).put(e,Xw);d.onsuccess=()=>r(!0),d.onerror=()=>i(d.error||new Error("IndexedDB write failed")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close()})},Wp=()=>{try{const e=localStorage.getItem(Gw);return e?JSON.parse(e):null}catch{return null}},hv=e=>{try{localStorage.setItem(Gw,JSON.stringify(e))}catch{}},Fr=e=>new Promise((t,r)=>{const i=new Image;i.onload=()=>t({w:i.naturalWidth,h:i.naturalHeight}),i.onerror=()=>r(new Error("Failed to load image")),i.src=e}),Qt=e=>{if(!e)return!1;if(e.startsWith("data:video")||e.includes("force_video_display=true"))return!0;const t=e.split(".").pop().split("?")[0].toLowerCase();return["mp4","webm","ogg","mov"].includes(t)},nc=e=>new Promise((t,r)=>{const i=document.createElement("video");i.preload="metadata",i.muted=!0,i.playsInline=!0,i.onloadedmetadata=()=>{t({duration:Number(i.duration)||0,w:i.videoWidth||0,h:i.videoHeight||0})},i.onerror=()=>r(new Error("")),i.src=e}),__=(e,{fps:t=2}={})=>new Promise((r,i)=>{const a=document.createElement("video"),c=document.createElement("canvas"),d=c.getContext("2d");a.muted=!0,a.playsInline=!0,a.crossOrigin="anonymous",a.src=e;const f=[],g=()=>i(new Error(""));a.onerror=g,a.onloadedmetadata=()=>{const z=Number(a.duration)||0;if(!z||!isFinite(z)){i(new Error(""));return}c.width=a.videoWidth||1280,c.height=a.videoHeight||720;const $=1/Math.max(.1,t);let T=0;const I=()=>{d.drawImage(a,0,0,c.width,c.height),f.push({time:Number(T.toFixed(2)),url:c.toDataURL("image/jpeg",.82)}),T+=$,T<=z?a.currentTime=Math.min(T,z):r(f)};a.onseeked=I,a.currentTime=0}}),S_=Df.memo(({img1:e,img2:t,theme:r="dark"})=>{const[i,a]=M.useState(50),c=M.useRef(null),[d,f]=M.useState(!1),g=M.useRef(),z=r==="solarized",$=r==="dark",T=M.useCallback(_=>{c.current&&(g.current||(g.current=requestAnimationFrame(()=>{if(!c.current)return;const F=c.current.getBoundingClientRect(),k=_.touches?_.touches[0].clientX:_.clientX,S=Math.max(0,Math.min(k-F.left,F.width));a(S/F.width*100),g.current=null})))},[]);M.useEffect(()=>()=>{g.current&&cancelAnimationFrame(g.current)},[]);const I=_=>!_||typeof _!="string"?_:_.startsWith("data:")?ll(_):_,N=I(e),P=I(t||e);return N?s.jsxs("div",{ref:c,className:`relative w-full h-full cursor-col-resize overflow-hidden group rounded-lg select-none shadow-2xl border ${$?"border-zinc-800 bg-[#09090b]":z?"border-[#eee8d5] bg-[#eee8d5]":"border-zinc-200 bg-zinc-100"}`,onMouseMove:T,onTouchMove:T,onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[s.jsx("div",{className:"absolute inset-0 opacity-20 pointer-events-none",style:{backgroundImage:`conic-gradient(${$?"#333":z?"#c9c2a8":"#bbb"} 90deg, transparent 90deg), conic-gradient(transparent 90deg, ${$?"#333":z?"#c9c2a8":"#bbb"} 90deg)`,backgroundSize:"20px 20px",backgroundPosition:"0 0, 10px 10px"}}),s.jsx("img",{src:N,loading:"lazy",decoding:"async",className:"absolute inset-0 w-full h-full object-contain pointer-events-none select-none",draggable:!1}),s.jsx("div",{className:"absolute inset-0 w-full h-full overflow-hidden pointer-events-none select-none",style:{clipPath:`inset(0 0 0 ${i}%)`},children:s.jsx("img",{src:P,loading:"lazy",decoding:"async",className:"absolute inset-0 w-full h-full object-contain",draggable:!1})}),s.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white/80 shadow-[0_0_10px_rgba(0,0,0,0.5)] pointer-events-none",style:{left:`${i}%`},children:s.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 bg-white rounded-full shadow-lg flex items-center justify-center text-black",children:s.jsx(Am,{size:12,className:"rotate-90"})})}),s.jsx("div",{className:`absolute bottom-2 left-2 bg-black/70 text-white text-[10px] font-medium px-2 py-0.5 rounded border border-white/10 transition-opacity duration-200 pointer-events-none ${d?"opacity-100":"opacity-60"}`,children:""}),s.jsx("div",{className:`absolute bottom-2 right-2 bg-blue-600/80 text-white text-[10px] font-medium px-2 py-0.5 rounded border border-white/10 transition-opacity duration-200 pointer-events-none ${d?"opacity-100":"opacity-60"}`,children:""})]}):s.jsxs("div",{className:`w-full h-full flex flex-col items-center justify-center rounded-lg border border-dashed pointer-events-none ${$?"text-zinc-500 bg-zinc-900/50 border-zinc-800":z?"text-zinc-600 bg-[#eee8d5] border-[#d7cfb2]":"text-zinc-500 bg-zinc-100 border-zinc-200"}`,children:[s.jsx(Am,{size:24,className:"mb-2 opacity-50"}),s.jsx("span",{className:"text-xs font-medium",children:""})]})}),Vp=Df.memo(({children:e,onClick:t,className:r="",variant:i="primary",icon:a,disabled:c=!1,title:d=""})=>{const f="flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 font-medium text-xs select-none disabled:opacity-50 disabled:cursor-not-allowed",g={primary:"bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/20 active:scale-95",secondary:"bg-zinc-800 hover:bg-zinc-700 text-zinc-300 border border-zinc-700 active:scale-95",ghost:"bg-transparent hover:bg-zinc-800 text-zinc-400 hover:text-white",danger:"bg-red-900/30 hover:bg-red-800 text-red-200 border border-red-800 active:scale-95"};return s.jsxs("button",{onClick:t,disabled:c,className:`${f} ${g[i]} ${r}`,title:d,children:[a&&s.jsx(a,{size:14,className:e?"mr-1.5":""}),e]})}),Kp=(e,t)=>{let r;return function(...a){const c=()=>{clearTimeout(r),e(...a)};clearTimeout(r),r=setTimeout(c,t)}},C_=({isOpen:e,onClose:t,title:r,children:i,theme:a="dark"})=>{if(!e)return null;const c=a==="dark",d=a==="solarized";return s.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm",onMouseDown:t,children:s.jsxs("div",{className:`rounded-xl shadow-2xl w-[680px] max-w-[90vw] overflow-hidden animate-in fade-in zoom-in-95 duration-200 flex flex-col max-h-[85vh] border ${c?"bg-[#09090b] border-zinc-800":d?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:f=>f.stopPropagation(),onClick:f=>f.stopPropagation(),children:[s.jsxs("div",{className:`flex items-center justify-between p-5 border-b shrink-0 ${c?"border-zinc-800/50":d?"border-[#d7cfb2]":"border-zinc-200"}`,children:[s.jsx("h3",{className:`font-bold text-lg ${c?"text-white":"text-zinc-900"}`,children:r}),s.jsx("button",{onClick:t,className:c?"text-zinc-500 hover:text-white":d?"text-zinc-600 hover:text-zinc-900":"text-zinc-500 hover:text-zinc-900",children:s.jsx(Ws,{size:20})})]}),s.jsx("div",{className:`p-0 overflow-y-auto custom-scrollbar flex-1 ${c?"bg-[#09090b]":d?"bg-[#eee8d5]":"bg-white"}`,children:i})]})})},E_=({item:e,onClose:t,onNavigate:r,onShotNavigate:i,onHistoryNavigate:a})=>{var I;if(!e)return null;const c=M.useRef(e);M.useEffect(()=>{c.current=e},[e]);const d=e.type==="video"||e.url&&Qt(e.url),f=M.useMemo(()=>{const N=[],P=_=>{_&&!N.includes(_)&&N.push(_)};return P(e.url),d||P(e.thumbnailUrl),P(e.originalUrl),P(e.mjOriginalUrl),N},[e,d]),[g,z]=M.useState(0);M.useEffect(()=>{z(0)},[e,f.length]);const $=f[g]||e.url,T=M.useCallback(()=>{z(N=>N<f.length-1?N+1:N)},[f.length]);return M.useEffect(()=>{if(!e)return;const N=P=>{const _=c.current;if(_&&!(P.target.tagName==="INPUT"||P.target.tagName==="TEXTAREA"))if(P.key==="ArrowLeft"||P.key==="Left"){if(!_.mjImages||_.mjImages.length<=1)return;P.preventDefault(),P.stopPropagation();const F=_.selectedMjImageIndex!==void 0?_.selectedMjImageIndex:0,k=F>0?F-1:_.mjImages.length-1;k>=0&&k<_.mjImages.length&&r&&(c.current={..._,selectedMjImageIndex:k,url:_.mjImages[k]},r(k))}else if(P.key==="ArrowRight"||P.key==="Right"){if(!_.mjImages||_.mjImages.length<=1)return;P.preventDefault(),P.stopPropagation();const F=_.selectedMjImageIndex!==void 0?_.selectedMjImageIndex:0,k=F<_.mjImages.length-1?F+1:0;k>=0&&k<_.mjImages.length&&r&&(c.current={..._,selectedMjImageIndex:k,url:_.mjImages[k]},r(k))}else if(P.key==="ArrowUp"||P.key==="Up")if(P.preventDefault(),P.stopPropagation(),_.storyboardContext&&i){const{shotIndex:F,allShots:k}=_.storyboardContext;F>0&&i(F-1,k)}else a&&a(-1);else if(P.key==="ArrowDown"||P.key==="Down")if(P.preventDefault(),P.stopPropagation(),_.storyboardContext&&i){const{shotIndex:F,allShots:k}=_.storyboardContext;F<k.length-1&&i(F+1,k)}else a&&a(1);else(P.key==="Escape"||P.key==="Esc")&&(P.preventDefault(),P.stopPropagation(),t&&t())};return window.addEventListener("keydown",N),()=>{window.removeEventListener("keydown",N)}},[e,r,i,a]),s.jsxs("div",{className:"fixed inset-0 z-[200] lightbox-overlay flex flex-col items-center justify-center animate-in fade-in duration-200",onClick:t,children:[s.jsx("button",{className:"absolute top-4 right-4 text-white/70 hover:text-white p-2 bg-black/50 rounded-full transition-colors",onClick:t,children:s.jsx(Ws,{size:24})}),s.jsxs("div",{className:"max-w-[90vw] max-h-[85vh] relative",onClick:N=>N.stopPropagation(),children:[e.type==="image"?s.jsx(mr,{src:$,alt:e.prompt,className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain",onError:T}):s.jsx("video",{src:$,controls:!0,autoPlay:!0,className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl",poster:e.thumbnailUrl||void 0,onError:T}),s.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black/60 backdrop-blur-md px-6 py-3 rounded-full text-white text-sm font-medium border border-white/10 text-center shadow-2xl",children:[s.jsx("div",{className:"line-clamp-1 max-w-xl",children:e.prompt}),s.jsxs("div",{className:"text-[10px] text-zinc-400 mt-1",children:[e.width,"x",e.height,"  ",e.id,e.mjImages&&e.mjImages.length>1&&s.jsxs("span",{className:"ml-2",children:["(",(e.selectedMjImageIndex!==void 0?e.selectedMjImageIndex:0)+1,"/",e.mjImages.length,")"]}),e.storyboardContext&&s.jsxs("span",{className:"ml-2 text-blue-400",children:["Shot ",e.storyboardContext.shotIndex+1,"/",((I=e.storyboardContext.allShots)==null?void 0:I.length)||1]})]})]}),e.mjImages&&e.mjImages.length>1&&s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white p-3 bg-black/50 rounded-full transition-colors",onClick:N=>{N.stopPropagation();const P=e.selectedMjImageIndex!==void 0?e.selectedMjImageIndex:0,_=P>0?P-1:e.mjImages.length-1;r&&r(_)},title:" ()",children:s.jsx(D5,{size:24})}),s.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white p-3 bg-black/50 rounded-full transition-colors",onClick:N=>{N.stopPropagation();const P=e.selectedMjImageIndex!==void 0?e.selectedMjImageIndex:0,_=P<e.mjImages.length-1?P+1:0;r&&r(_)},title:" ()",children:s.jsx(sl,{size:24})})]})]})]})};function I_(){var fb,hb;const[e,t]=M.useState(()=>{try{return localStorage.getItem("tapnow_theme")||"dark"}catch{return"dark"}}),[r,i]=M.useState([]),a=M.useCallback((n,o="info",l=3e3)=>{const u=Date.now();i(p=>[...p,{id:u,message:n,type:o}]),setTimeout(()=>{i(p=>p.filter(m=>m.id!==u))},l)},[]);M.useEffect(()=>{const n=document.createElement("style");return n.innerText=l_,document.head.appendChild(n),()=>{document.head.removeChild(n)}},[]),M.useEffect(()=>{try{localStorage.setItem("tapnow_theme",e)}catch{}const n=document.documentElement;n.classList.remove("theme-dark","theme-light","theme-solarized"),e==="dark"?(n.classList.add("theme-dark"),document.body.style.backgroundColor="#09090b"):e==="solarized"?(n.classList.add("theme-solarized"),document.body.style.backgroundColor="#fdf6e3"):(n.classList.add("theme-light"),document.body.style.backgroundColor="#f4f4f5")},[e]);const c=M.useRef(!1);M.useEffect(()=>{const n=Wp();c.current=(n==null?void 0:n.storage)==="idb"},[]),M.useEffect(()=>{const n=setInterval(()=>{(async()=>{const l=Date.now(),u={nodes:Us.current,connections:qc.current,timestamp:l},p=JSON.stringify(u);try{await N_(p),c.current=!0,hv({timestamp:l,storage:"idb"});try{localStorage.removeItem(Hp)}catch{}console.log("[AutoSave]  IndexedDB",new Date().toLocaleTimeString())}catch{try{if(p.length>4194304)throw new Error("payload too large");localStorage.setItem(Hp,p),c.current=!1,hv({timestamp:l,storage:"local"}),console.log("[AutoSave] IndexedDB ",new Date().toLocaleTimeString())}catch(h){console.warn("[AutoSave] :",h.message||h)}}})()},6e4);return()=>clearInterval(n)},[]),M.useEffect(()=>{const n=o=>{if(Us.current&&Us.current.length>0)return o.preventDefault(),o.returnValue="",o.returnValue};return window.addEventListener("beforeunload",n),()=>window.removeEventListener("beforeunload",n)},[]);const[d,f]=M.useState(()=>{try{const n=Wp();if((n==null?void 0:n.storage)==="idb")return[];const o=localStorage.getItem(Hp);if(o)return JSON.parse(o).nodes||[];const l=localStorage.getItem("tapnow_nodes");return l?JSON.parse(l):[]}catch{return[]}}),[g,z]=M.useState(()=>{try{const n=Wp();if((n==null?void 0:n.storage)==="idb")return[];const o=localStorage.getItem(Hp);if(o)return JSON.parse(o).connections||[];const l=localStorage.getItem("tapnow_connections");return l?JSON.parse(l):[]}catch{return[]}});M.useEffect(()=>{const n=Wp();if((n==null?void 0:n.storage)!=="idb")return;let o=!1;return(async()=>{const u=await j_();if(!(!u||o))try{const p=JSON.parse(u);Array.isArray(p.nodes)&&f(p.nodes),Array.isArray(p.connections)&&z(p.connections)}catch{}})(),()=>{o=!0}},[]);const[$,T]=M.useState(()=>{const n=localStorage.getItem("tapnow_max_undo_steps");return n?Math.min(30,Math.max(1,parseInt(n)||5)):5}),[I,N]=M.useState([]),[P,_]=M.useState([]),F=M.useRef(!1),[k,S]=M.useState(null),[A,V]=M.useState(null),[G,le]=M.useState(null),[re,pe]=M.useState([]),[be,Ie]=M.useState([]),qe=M.useRef(new Map),Q=M.useRef(new Map),[_e,D]=M.useState(()=>{try{return localStorage.getItem("tapnow_batch_queue_mode")||"parallel"}catch{return"parallel"}}),[Te,Lt]=M.useState(0),[ye,ke]=M.useState(()=>parseInt(localStorage.getItem("tapnow_batch_concurrency")||"1")),he=M.useRef(new Set),Oe=M.useRef("idle");M.useEffect(()=>{localStorage.setItem("tapnow_batch_concurrency",ye)},[ye]),M.useEffect(()=>{localStorage.setItem("tapnow_batch_queue_mode",_e)},[_e]);const ae=M.useCallback(()=>{F.current||(N(n=>[...n,{nodes:JSON.parse(JSON.stringify(d)),connections:JSON.parse(JSON.stringify(g))}].slice(-$)),_([]))},[d,g]),fe=M.useRef(ae);M.useEffect(()=>{fe.current=ae},[ae]),M.useEffect(()=>{if(re.length===0){Oe.current="idle",he.current.clear();return}let n=0;const o=[],l=Date.now(),u=6e4;if(d.forEach(b=>{var v;(v=b.settings)!=null&&v.shots&&b.settings.shots.forEach(y=>{y.status==="generating"&&(n++,y.generationStartTime&&l-y.generationStartTime>u&&o.push({nodeId:b.id,shotId:y.id}));const w=`${b.id}:${y.id}`;he.current.has(w)&&(y.status==="generating"||y.status==="done"||y.status==="failed")&&he.current.delete(w)})}),o.length>0&&(console.warn(`[Batch] ${o.length} tasks timed out (>${u/1e3}s). Auto-marking as failed.`),o.forEach(({nodeId:b,shotId:v})=>{Kt(b,v,{status:"failed",errorMsg:"60s"},{onlyIfStatus:"generating"})}),n-=o.length),n+he.current.size>0){Oe.current="running";return}if(Oe.current==="running"){Oe.current="cooling",setTimeout(()=>{Oe.current="idle",Lt(b=>b+1)},1e3);return}if(Oe.current==="cooling")return;const m=ye===0?re.length:ye,h=re.slice(0,m),x=re.slice(m);h.length>0&&(pe(x),Oe.current="running",h.forEach(b=>{var w,j;he.current.add(`${b.nodeId}:${b.shotId}`);const v=d.find(R=>R.id===b.nodeId),y=(j=(w=v==null?void 0:v.settings)==null?void 0:w.shots)==null?void 0:j.find(R=>R.id===b.shotId);y&&(b.mode==="image"?tb(b.nodeId,y):eb(b.nodeId,y))}))},[re,d,ye,Te]),M.useEffect(()=>{if(re.length===0)return;const n=setInterval(()=>{Lt(o=>o+1)},5e3);return()=>clearInterval(n)},[re.length>0]);const ut=M.useCallback((n=!1)=>{pe([]),he.current.clear(),Oe.current="idle",Q.current.clear(),n&&f(o=>o.map(l=>{var h;if(l.type!=="storyboard-node")return l;const u=((h=l.settings)==null?void 0:h.shots)||[];let p=!1;const m=u.map(x=>x.status==="generating"?(p=!0,{...x,status:"failed",errorMsg:""}):x);return p?{...l,settings:{...l.settings,shots:m}}:l}))},[pe,f]),ot=M.useCallback((n,o)=>{pe(l=>l.filter(u=>!(u.nodeId===n&&u.shotId===o))),he.current.delete(`${n}:${o}`),Kt(n,o,{status:"draft",errorMsg:""})},[pe]),Ue=M.useCallback((n,o)=>{Kt(n,o,{status:"failed",errorMsg:""})},[]),Xe=M.useCallback(n=>{pe(o=>o.filter(l=>l.batchId!==n?!0:(he.current.delete(`${l.nodeId}:${l.shotId}`),Q.current.delete(`${l.nodeId}:${l.shotId}`),Kt(l.nodeId,l.shotId,{status:"draft",errorMsg:""}),!1)))},[pe]),en=M.useCallback((n,o=!1)=>{pe(l=>l.filter(u=>u.nodeId!==n?!0:(he.current.delete(`${u.nodeId}:${u.shotId}`),Q.current.delete(`${u.nodeId}:${u.shotId}`),!1))),o&&f(l=>l.map(u=>{var x;if(u.id!==n||u.type!=="storyboard-node")return u;const p=((x=u.settings)==null?void 0:x.shots)||[];let m=!1;const h=p.map(b=>b.status==="generating"?(m=!0,{...b,status:"failed",errorMsg:""}):b);return m?{...u,settings:{...u.settings,shots:h}}:u}))},[pe,f]),Ot=M.useMemo(()=>re.map((n,o)=>{var h,x;const l=d.find(b=>b.id===n.nodeId),u=((h=l==null?void 0:l.settings)==null?void 0:h.shots)||[],p=u.findIndex(b=>b.id===n.shotId),m=p>=0?u[p]:null;return{...n,order:o+1,projectTitle:((x=l==null?void 0:l.settings)==null?void 0:x.projectTitle)||"",sceneIndex:(m==null?void 0:m.scene_index)||(p>=0?p+1:"?"),taskIndex:n.taskIndex,batchId:n.batchId,batchOrder:n.batchOrder,batchConcurrency:n.batchConcurrency}}),[re,d]),gn=M.useMemo(()=>{const n=[];return d.forEach(o=>{var u;if(o.type!=="storyboard-node")return;(((u=o.settings)==null?void 0:u.shots)||[]).forEach((p,m)=>{var x;if(p.status!=="generating")return;const h=Q.current.get(`${o.id}:${p.id}`)||{};n.push({nodeId:o.id,shotId:p.id,projectTitle:((x=o.settings)==null?void 0:x.projectTitle)||"",sceneIndex:p.scene_index||m+1,batchId:h.batchId,batchOrder:h.batchOrder,taskIndex:h.taskIndex})})}),n},[d]);M.useEffect(()=>{const n=new Set;if(re.forEach(o=>{n.add(`${o.nodeId}:${o.shotId}`)}),d.forEach(o=>{var u;if(o.type!=="storyboard-node")return;(((u=o.settings)==null?void 0:u.shots)||[]).forEach(p=>{p.status==="generating"&&n.add(`${o.id}:${p.id}`)})}),n.size===0){Q.current.clear(),Ie([]);return}Q.current.forEach((o,l)=>{n.has(l)||Q.current.delete(l)}),Ie(o=>o.filter(l=>l.shotIds.some(u=>n.has(`${l.nodeId}:${u}`))))},[re,d]);const lr=M.useCallback(()=>{if(I.length===0)return;F.current=!0;const n=I[I.length-1];_(o=>[...o,{nodes:JSON.parse(JSON.stringify(d)),connections:JSON.parse(JSON.stringify(g))}]),f(n.nodes),z(n.connections),N(o=>o.slice(0,-1)),setTimeout(()=>{F.current=!1},100)},[I,d,g]),Zn=M.useCallback(()=>{if(P.length===0)return;F.current=!0;const n=P[P.length-1];N(o=>[...o,{nodes:JSON.parse(JSON.stringify(d)),connections:JSON.parse(JSON.stringify(g))}]),f(n.nodes),z(n.connections),_(o=>o.slice(0,-1)),setTimeout(()=>{F.current=!1},100)},[P,d,g]);M.useEffect(()=>{const n=o=>{(o.ctrlKey||o.metaKey)&&o.key==="z"&&(o.shiftKey?(o.preventDefault(),Zn()):(o.preventDefault(),lr()))};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[lr,Zn]);const[Xt,zr]=M.useState({x:0,y:0,zoom:1}),E=M.useRef({x:0,y:0,zoom:1});M.useRef(null),M.useRef(new Map),M.useRef(new Map);const[Ce,xe]=M.useState(null),X=(n,o={})=>({...Ud[n]||{key:"",url:ss,apiType:"openai",useProxy:!1,forceAsync:!1},...o,enabled:(o==null?void 0:o.enabled)!==!1}),[K,de]=M.useState(()=>{const n=localStorage.getItem("tapnow_model_library");if(n)try{const o=JSON.parse(n);if(Array.isArray(o))return o.map(l=>({id:l.id,displayName:l.displayName||l.id,modelName:l.modelName||l.id,type:l.type||"Chat",apiType:l.apiType||"openai",ratioLimits:Array.isArray(l.ratioLimits)?l.ratioLimits:null,ratioNotes:rs(l.ratioNotes),ratioNotesEnabled:!!l.ratioNotesEnabled,resolutionLimits:Array.isArray(l.resolutionLimits)?l.resolutionLimits:null,resolutionNotes:el(l.resolutionNotes),resolutionNotesEnabled:!!l.resolutionNotesEnabled,durations:Array.isArray(l.durations)?l.durations:null,durationNotes:rs(l.durationNotes),durationNotesEnabled:!!l.durationNotesEnabled,videoResolutions:Array.isArray(l.videoResolutions)?l.videoResolutions:null,videoResolutionNotes:rs(l.videoResolutionNotes),videoResolutionNotesEnabled:!!l.videoResolutionNotesEnabled,supportsFirstLastFrame:!!l.supportsFirstLastFrame,supportsHD:!!l.supportsHD,customParams:tc(l.customParams),previewOverrideEnabled:!!l.previewOverrideEnabled,previewOverridePatch:Pd(l.previewOverridePatch)})).filter(l=>l.id)}catch(o){console.error(" modelLibrary :",o)}return f_.map(o=>({...o}))}),Re=M.useRef(!1);M.useEffect(()=>{try{localStorage.setItem("tapnow_model_library",JSON.stringify(K))}catch(n){console.error(" modelLibrary :",n)}},[K]),M.useEffect(()=>{Re.current||K.length&&(Aa(new Set(K.map(n=>n.id))),Re.current=!0)},[K]);const[je,ve]=M.useState(()=>{const n=localStorage.getItem("tapnow_api_configs");if(n)try{let o=JSON.parse(n);o=o.map(p=>{const m={...p,id:p.id||p.modelName,provider:p.provider,type:p.type||"Chat",modelName:p.modelName||p.id,displayName:p.displayName||p.modelName||p.id,...p.durations?{durations:p.durations}:{}},{key:h,url:x,isCustom:b,...v}=m;return v}),o=o.filter(p=>!Lm.includes(p.id));const l=new Set(o.map(p=>p.id).filter(Boolean));return Dm.filter(p=>p.type==="Chat").forEach(p=>{l.has(p.id)||(o.push(p),l.add(p.id))}),o=o.map(p=>p._uid?p:{...p,_uid:`uid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),o}catch(o){console.error("[V3.6.0]  apiConfigs :",o)}return Dm.map(o=>({...o,_uid:`uid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}))}),[Pe,ft]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_providers");if(n){const o=JSON.parse(n);return Object.fromEntries(Object.entries(o).map(([l,u])=>[l,X(l,u)]))}}catch(n){console.error(" providers :",n)}return Object.fromEntries(Object.entries(Ud).map(([n,o])=>[n,X(n,o)]))});M.useEffect(()=>{try{localStorage.setItem("tapnow_providers",JSON.stringify(Pe))}catch(n){console.error(" providers :",n)}},[Pe]),M.useCallback(n=>{const o=je.find(u=>u.id===n);if(!o)return{key:"",url:ss,id:n};const l=Pe[o.provider]||{};return{...o,modelName:o.id,key:l.key||"",url:l.url||ss}},[je,Pe]);const[We,Pt]=M.useState(()=>localStorage.getItem("tapnow_global_key")||""),[fn,vn]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_api_blacklist");if(!n)return{};const o=JSON.parse(n),l=new Date().toDateString();return o.date!==l?{}:o.blacklist||{}}catch{return{}}});M.useEffect(()=>{try{localStorage.setItem("tapnow_api_blacklist",JSON.stringify({date:new Date().toDateString(),blacklist:fn}))}catch{}},[fn]);const $r=M.useRef(fn);M.useEffect(()=>{$r.current=fn},[fn]);const hi=(n,o)=>{if(!n)return;const l={date:new Date().toDateString(),reason:o,timestamp:Date.now()},u=$r.current||{};$r.current={...u,[n]:l},vn(p=>({...p,[n]:l}))},[Mr,Si]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_api_suspend");if(!n)return{};const o=JSON.parse(n),l=Date.now();return Object.fromEntries(Object.entries(o).filter(([,u])=>l-u.timestamp<60*60*1e3))}catch{return{}}});M.useEffect(()=>{try{localStorage.setItem("tapnow_api_suspend",JSON.stringify(Mr))}catch{}},[Mr]);const Fn=M.useRef(Mr);M.useEffect(()=>{Fn.current=Mr},[Mr]);const Ci=(n,o,l=60*60*1e3)=>{if(!n)return;const u={reason:o,timestamp:Date.now(),ttl:l};Fn.current={...Fn.current,[n]:u},Si(p=>({...p,[n]:u}))},vs=n=>{var l;const o=(l=Fn.current)==null?void 0:l[n];return o?Date.now()-o.timestamp<(o.ttl||60*60*1e3):!1},Rr=M.useRef([]),Po=2*60*1e3,$a=10,Mc=()=>{const n=Date.now(),o=Rr.current.filter(l=>n-l<Po);return Rr.current=o,o.length>=$a},Ao=()=>{Rr.current.push(Date.now())},[Vi,lo]=M.useState(()=>{const n=localStorage.getItem("tapnow_jimeng_use_local_file");return n!==null?n==="true":!0}),[kr,Tc]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_nodes");return!n||JSON.parse(n).length===0?(localStorage.removeItem("tapnow_project_name"),""):localStorage.getItem("tapnow_project_name")||""}catch{return""}}),[e0,jr]=M.useState(!1),co=M.useRef(null),[wl,Ro]=M.useState({visible:!1,progress:0,status:"",type:"import"}),[Nr,Pc]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_history_performance_mode");return n!==null?n==="true"?"normal":n==="false"?"off":n||"off":localStorage.getItem("tapnow_performance_mode")||"off"}catch{return"off"}}),[Xs,t0]=M.useState(()=>{try{return localStorage.getItem("tapnow_global_performance_mode")||"off"}catch{return"off"}}),[kn,uo]=M.useState(()=>localStorage.getItem("tapnow_local_server_url")||"http://127.0.0.1:9527"),[fs,zl]=M.useState(!1),[as,Ac]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_local_cache_enabled");if(n!==null)return n==="true";const o=localStorage.getItem("tapnow_show_local_cache_banner");return o===null?!0:o==="true"}catch{return!0}}),[mi,ju]=M.useState(0),[Nu,Do]=M.useState(!1),Ei=M.useRef(null),ir=as&&fs,[Qe,se]=M.useState({savePath:"",imageSavePath:"",videoSavePath:"",convertPngToJpg:!0,jpgQuality:95,pilAvailable:!1}),Ve=M.useRef(new Map),_t=M.useRef(new Set),qn=M.useRef(new Map),Qn=M.useRef(new Map),_r=M.useRef({savePath:"",imageSavePath:"",videoSavePath:""}),Gr=M.useRef(new Map),Zs=M.useRef(!1),Ki=M.useRef(!1);M.useEffect(()=>{localStorage.setItem("tapnow_performance_mode",Nr),localStorage.setItem("tapnow_history_performance_mode",Nr)},[Nr]),M.useEffect(()=>{localStorage.setItem("tapnow_global_performance_mode",Xs)},[Xs]),M.useEffect(()=>{localStorage.setItem("tapnow_local_server_url",kn)},[kn]),M.useEffect(()=>{try{localStorage.setItem("tapnow_local_cache_enabled",String(as))}catch{}},[as]);const[kt,gt]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_history");return n?JSON.parse(n).map(l=>{var u,p;return l.mjNeedsSplit&&l.mjOriginalUrl&&((p=(u=l.apiConfig)==null?void 0:u.modelId)!=null&&p.includes("mj"))?{...l,url:l.mjOriginalUrl,mjImages:null,mjNeedsSplit:!0}:l}):[]}catch(n){return console.error(":",n),[]}}),[Ma]=M.useState(()=>Date.now()),[Lo,ws]=M.useState({active:!1,current:0,total:0,filename:""}),[zs,_u]=M.useState(new Set),[$_,M_]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_auto_save_config");return n?JSON.parse(n):{enabled:!1,interval:5,folderPath:""}}catch{return{enabled:!1,interval:5,folderPath:""}}}),[T_,P_]=M.useState(!1),[qs,Ta]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_chat_sessions");return n?JSON.parse(n):[{id:"default",title:"",messages:[]}]}catch{return[{id:"default",title:"",messages:[]}]}}),[Oo,Rc]=M.useState("default"),[kl,Hg]=M.useState(""),[Dc,Yi]=M.useState(!1),[qw,Qw]=M.useState(400),[jl,Ii]=M.useState([]),[Ps,ez]=M.useState(()=>{try{return localStorage.getItem("tapnow_chat_model")||"gemini-3-pro"}catch{return"gemini-3-pro"}}),[Wg,Vg]=M.useState(!1),[Su,Cu]=M.useState(null),[Eu,Kg]=M.useState(!1);M.useEffect(()=>{try{localStorage.setItem("tapnow_chat_model",Ps)}catch{}},[Ps]);const[Uo,cr]=M.useState(null),Iu=M.useRef(Uo);M.useEffect(()=>{Iu.current=Uo},[Uo]);const[Lc,Yg]=M.useState(()=>{try{const n=localStorage.getItem(ov),o=n?JSON.parse(n):[],l=[{id:"grid-default",name:"",prompt:av},{id:"upscale-default",name:"",prompt:lv},{id:"moodboard-default",name:"",prompt:uv},{id:"storyboard-default",name:"",prompt:cv},{id:"character-sheet-default",name:"",prompt:dv}],u=new Set((o||[]).map(m=>m.id)),p=[...o];return l.forEach(m=>{const h=p.some(x=>x.name===m.name);!u.has(m.id)&&!h&&p.unshift(m)}),p}catch{return[{id:"grid-default",name:"",prompt:av},{id:"upscale-default",name:"",prompt:lv},{id:"moodboard-default",name:"",prompt:uv},{id:"storyboard-default",name:"",prompt:cv},{id:"character-sheet-default",name:"",prompt:dv}]}}),[$u,n0]=M.useState({name:"",prompt:""}),[Jg,tz]=M.useState(!1),[r0,nz]=M.useState(!1);M.useEffect(()=>{try{localStorage.setItem(ov,JSON.stringify(Lc))}catch{}},[Lc]);const[Nl,Oc]=M.useState(!1),[s0,Uc]=M.useState(!1),[As,Fc]=M.useState(null),[_l,Mu]=M.useState(null),[xr,Sl]=M.useState(null),[Ln,Rs]=M.useState(null),[Ds,Ls]=M.useState(null),[i0,Qs]=M.useState({x:0,y:0}),[Cl,Fo]=M.useState(null),[A_,Gg]=M.useState(!1),[Xg,o0]=M.useState({});M.useEffect(()=>{const n=setInterval(()=>{const o=Date.now(),l={};let u=!1;Us.current&&Us.current.forEach(p=>{var m;p.type==="storyboard-node"&&((m=p.settings)!=null&&m.shots)&&p.settings.shots.forEach(h=>{if(h.status==="generating"&&h.generationStartTime){const x=(o-h.generationStartTime)/1e3;l[`${p.id}-${h.id}`]=`${x.toFixed(1)}s`,u=!0}})}),u&&o0(l)},100);return()=>clearInterval(n)},[]);const[Bo,a0]=M.useState(!1),[$i,l0]=M.useState(null),[Hn,Hr]=M.useState(new Set),po=M.useRef(!1),[Xr,El]=M.useState({x:0,y:0,worldX:0,worldY:0,visible:!1}),[rz,Ho]=M.useState(!1),[c0,d0]=M.useState({visible:!1,x:0,y:0}),[ks,gi]=M.useState({visible:!1,x:0,y:0,worldX:0,worldY:0,item:null}),[u0,Mi]=M.useState(!1),[sz,Zg]=M.useState(!1),[iz,qg]=M.useState(!1),p0=M.useRef({target:null,at:0}),Bc=M.useCallback(n=>{p0.current={target:n,at:Date.now()}},[]),Pa=M.useRef(null),f0=M.useCallback(()=>{Pa.current&&(clearTimeout(Pa.current),Pa.current=null),Mi(!0)},[]),Qg=M.useCallback(()=>{Pa.current&&clearTimeout(Pa.current),Pa.current=setTimeout(()=>{Mi(!1),Pa.current=null},1e3)},[]),[js,Hc]=M.useState({nodeId:null,shotId:null}),[Wo,h0]=M.useState({visible:!1,x:0,y:0,nodeId:null,frame:null}),[Vo,ex]=M.useState({visible:!1,x:0,y:0,item:null}),[Wc,tx]=M.useState({visible:!1,x:0,y:0,nodeId:null}),[oz,ei]=M.useState(!1),[Tu,nx]=M.useState("providers"),[az,rx]=M.useState(()=>new Set),[lz,m0]=M.useState(()=>new Set),[sx,Aa]=M.useState(()=>new Set),[cz,ix]=M.useState(()=>new Set),[dz,Il]=M.useState(()=>new Set),[uz,Ra]=M.useState(()=>({})),[ox,pz]=M.useState(()=>({})),[Pu,Au]=M.useState(!1),[ax,fz]=M.useState(!1),[lx,hz]=M.useState(!1),[R_,g0]=M.useState(-1),[cx,$l]=M.useState(!1),[br,Ml]=M.useState(()=>{try{const n=localStorage.getItem("tapnow_characters");return n?JSON.parse(n):[]}catch(n){return console.error(":",n),[]}}),[mz,Vc]=M.useState(!1),[fo,Ru]=M.useState("url"),[Tl,Du]=M.useState(""),[Pl,Lu]=M.useState(""),[Al,dx]=M.useState(1),[Rl,ux]=M.useState(3),[Kc,Yc]=M.useState(""),[x0,Dl]=M.useState(!1),[px,Jc]=M.useState(null),[fx,Ou]=M.useState({}),[gz,Uu]=M.useState(!1),[Wr,Da]=M.useState(new Set),[hx,b0]=M.useState(!1),[xz,bz]=M.useState("select"),[Me,wn]=M.useState(null),[er,Dr]=M.useState(null),[Gc,y0]=M.useState({}),[Ll,Fu]=M.useState(null),[yz,v0]=M.useState(null),[mx,w0]=M.useState(null),[z0,Xc]=M.useState({}),[gx,vz]=M.useState({}),[Ko,k0]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_image_model")||"nano-banana"}catch{return"nano-banana"}}),[La,j0]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_video_model")||"sora-2"}catch{return"sora-2"}}),[ho,wz]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_ratio")||"1:1"}catch{return"1:1"}}),[Oa,zz]=M.useState(()=>{try{return Md(localStorage.getItem("tapnow_last_image_res")||"2K")}catch{return"2K"}}),[Ua,xx]=M.useState(()=>{try{return zo(localStorage.getItem("tapnow_last_video_res")||"720P")}catch{return"720P"}}),[kz,jz]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_segment_duration")||"3"}catch{return"3"}}),[Nz,_z]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_analyze_model")||"gemini-3-pro"}catch{return"gemini-3-pro"}}),[Yo,N0]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_extract_model")||""}catch{return""}});M.useEffect(()=>{const n=(kn||"").replace(/\/+$/,"");if(!n){zl(!1);return}const o=async()=>{try{const u=await fetch(`${n}/ping`,{method:"GET"});if(u.ok){const p=await u.json(),m=p.image_save_path_raw??p.image_save_path??"",h=p.video_save_path_raw??p.video_save_path??"";zl(!0),se(x=>({...x,savePath:ls(p.save_path||x.savePath||""),imageSavePath:ls(m||""),videoSavePath:ls(h||""),convertPngToJpg:p.convert_png_to_jpg!==!1,jpgQuality:p.jpg_quality||x.jpgQuality,pilAvailable:p.pil_available||!1}));return}}catch{}zl(!1)};o();const l=setInterval(o,3e4);return()=>clearInterval(l)},[kn]),M.useEffect(()=>{if(Ei.current&&(clearTimeout(Ei.current),Ei.current=null),!as){Do(!1);return}if(fs){Do(!0);return}return Do(!0),Ei.current=setTimeout(()=>{Do(!1),Ei.current=null},18e4),()=>{Ei.current&&(clearTimeout(Ei.current),Ei.current=null)}},[as,fs]),M.useEffect(()=>{f(n=>n.map(o=>{var u,p;if(o.type!=="local-save"||(u=o.settings)!=null&&u.serverUrl)return o;const l=fs?"connected":"disconnected";return((p=o.settings)==null?void 0:p.serverStatus)===l?o:{...o,settings:{...o.settings,serverStatus:l}}}))},[fs]);const ti=M.useCallback(n=>n?n.replace(/[<>:"/\\|?*\x00-\x1F]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,120):"",[]),ls=M.useCallback(n=>n?/^[a-zA-Z]:/.test(n)?n.replace(/\//g,"\\").replace(/\\+/g,"\\").trim():n.trim():"",[]),mo=M.useCallback(n=>{if(!n)return null;try{const l=n.split("?")[0].split("/"),p=l[l.length-1].replace(/\.[^.]+$/,"");return ti(p||"")||null}catch{return null}},[ti]),Jo=M.useCallback((n,o="")=>{if(!n||!n.startsWith("data:"))return o;const l=n.match(/^data:([^;]+);/i);if(!l)return o;const u=l[1].toLowerCase();return{"image/jpeg":".jpg","image/jpg":".jpg","image/png":".png","image/webp":".webp","image/gif":".gif","video/mp4":".mp4","video/webm":".webm","video/quicktime":".mov"}[u]||o},[]),Fa=M.useCallback((n,o="")=>{if(!n)return o;const u=n.split("?")[0].split("#")[0].match(/\.([a-zA-Z0-9]+)$/);if(!u)return o;const p=`.${u[1].toLowerCase()}`;return p===".jpeg"?".jpg":p},[]),bx=M.useCallback(n=>{let o=0;for(let l=0;l<n.length;l++)o=(o<<5)-o+n.charCodeAt(l),o|=0;return Math.abs(o).toString(36)},[]),Ol=M.useCallback((n,o)=>{const l=ti(o||"");if(!n)return l||`cache_${Date.now()}`;const u=bx(n);if(l)return`${l}_${u}`;const p=mo(n);return p?`${p}_${u}`:`cache_${u}`},[mo,ti,bx]),Ul=M.useCallback(async(n,o="normal")=>{const l=o==="ultra"?{maxSize:80,jpegQuality:.3}:{maxSize:150,jpegQuality:.6};let u=n;if(!u)return null;try{Ui.isImageId(u)&&(u=await Ui.getImage(u)),u&&u.startsWith("data:")&&(u=ll(u))}catch{return null}return u?new Promise(p=>{try{const m=new Image;m.crossOrigin="anonymous",m.onload=()=>{const h=document.createElement("canvas");let x=m.naturalWidth,b=m.naturalHeight;x>b?x>l.maxSize&&(b=b*l.maxSize/x,x=l.maxSize):b>l.maxSize&&(x=x*l.maxSize/b,b=l.maxSize),h.width=x,h.height=b,h.getContext("2d").drawImage(m,0,0,x,b),p(h.toDataURL("image/jpeg",l.jpegQuality))},m.onerror=()=>p(null),m.src=u}catch{p(null)}}):null},[]),_0=M.useCallback((n,o=!1)=>{if(!n||typeof n!="string"||n.startsWith("data:")||n.startsWith("blob:")||!/^https?:/i.test(n)||!o)return n;const l=(kn||"").trim().replace(/\/+$/,"");return!l||n.startsWith(l)?n:`${l}/proxy?url=${encodeURIComponent(n)}`},[kn]),Os=async(n,o={})=>{if(!n)throw new Error("Invalid URL");const l=o.useProxy===!0,u=async m=>{const h=await fetch(m);if(!h.ok)throw new Error(`HTTP ${h.status}`);return await h.blob()};if(n.startsWith("data:")){const m=Rm(n);if(!m)throw new Error("Invalid base64 payload");return m}if(n.startsWith("blob:"))try{return await u(n)}catch{throw new Error("Blob ")}const p=l?_0(n,!0):n;if(!p)throw new Error("Invalid URL");return await u(p)},yr=async(n,o={})=>{if(n.startsWith("data:")){const u=ll(n),p=Rm(u);if(!p)throw new Error("Invalid base64 payload");return(await Fl(p)).split(",")[1]||""}const l=await Os(n,o);return new Promise((u,p)=>{const m=new FileReader;m.onloadend=()=>{const h=m.result;u(h.split(",")[1])},m.onerror=p,m.readAsDataURL(l)})},Fl=n=>new Promise((o,l)=>{const u=new FileReader;u.onloadend=()=>o(u.result),u.onerror=l,u.readAsDataURL(n)}),Sz=5*60*1e3,Bu=M.useCallback(n=>{if(!n)return"";try{return new URL(n).origin||n}catch{return n}},[]),Hu=M.useCallback(n=>{if(!n)return!1;const o=Bu(n),l=Gr.current.get(o);return l&&Date.now()-l<Sz},[Bu]),Wu=M.useCallback(n=>{if(!n)return;const o=Bu(n);Gr.current.set(o,Date.now())},[Bu]),Ji=M.useCallback(async(n,o={})=>{const l=o.useProxy===!0;if(!n)throw new Error(": ");const p=!(n.startsWith("data:")||n.startsWith("blob:"))&&l?_0(n,!0):n;try{const m=await Os(p,{useProxy:!1});if(!m||m.size===0)throw new Error(": ");return{blob:m,source:p}}catch(m){throw m||new Error("")}},[_0,Os]),Vu=M.useCallback(async(n,o,l="history",u={})=>{if(!ir)return null;const p=(kn||"").replace(/\/+$/,"");if(!p)return null;const m=u.useProxy===!0;try{const x=(u!=null&&u.forceId?ti(n||""):"")||Ol(o,n);let b=o;if(o.startsWith("data:"))b=ll(o);else{if(!m&&Hu(o))return null;const{blob:w}=await Ji(o,{useProxy:m});b=await new Promise(j=>{const R=new FileReader;R.onloadend=()=>j(R.result),R.readAsDataURL(w)})}const v=Jo(b,Fa(o,".jpg")),y=await fetch(`${p}/save-cache`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:x,content:b,category:l,ext:v,type:"image"})});if(y.ok){const w=await y.json();if(w.success)return{url:w.url,path:w.path}}}catch(h){o&&!o.startsWith("data:")&&!m&&Wu(o),console.warn("[] :",h)}return null},[ir,kn,Ol,Jo,Fa,ti,Hu,Ji,Wu]),yx=M.useCallback(async(n,o,l="history",u={})=>{if(!ir)return null;const p=(kn||"").replace(/\/+$/,"");if(!p)return null;const m=u.useProxy===!0;try{const h=Ol(o,n);if(!m&&Hu(o))return null;const{blob:x}=await Ji(o,{useProxy:m}),b=await new Promise(w=>{const j=new FileReader;j.onloadend=()=>w(j.result),j.readAsDataURL(x)}),v=Jo(b,Fa(o,".mp4")),y=await fetch(`${p}/save-cache`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:h,content:b,category:l,ext:v,type:"video"})});if(y.ok){const w=await y.json();if(w.success)return{url:w.url,path:w.path}}}catch(h){m||Wu(o),console.warn("[] :",h)}return null},[ir,kn,Ol,Jo,Fa,Hu,Ji,Wu]),Bl=M.useCallback(async(n,o={})=>{const l=o.silent===!0,u=(kn||"").replace(/\/+$/,"");if(!u)return l||a("","error"),!1;const p={...n};p.save_path&&(p.save_path=ls(p.save_path)),p.image_save_path&&(p.image_save_path=ls(p.image_save_path)),p.video_save_path&&(p.video_save_path=ls(p.video_save_path));try{const m=await fetch(`${u}/config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!m.ok){const y=await m.text();throw new Error(y||"")}const h=await m.json(),x=(h==null?void 0:h.config)||{},b=x.image_save_path_raw,v=x.video_save_path_raw;return se(y=>({...y,savePath:ls(x.save_path??p.save_path??y.savePath??""),imageSavePath:ls(b!==void 0?b:x.image_save_path??p.image_save_path??y.imageSavePath??""),videoSavePath:ls(v!==void 0?v:x.video_save_path??p.video_save_path??y.videoSavePath??""),convertPngToJpg:(x.convert_png_to_jpg??p.convert_png_to_jpg)!==void 0?(x.convert_png_to_jpg??p.convert_png_to_jpg)!==!1:y.convertPngToJpg,jpgQuality:x.jpg_quality??p.jpg_quality??y.jpgQuality,pilAvailable:x.pil_available??y.pilAvailable})),l||a((h==null?void 0:h.message)||"","success",2e3),!0}catch(m){return l||a(`: ${m.message||""}`,"error",2e3),!1}},[kn,a,ls]),Go=M.useCallback((n={})=>{_t.current=new Set,Ve.current=new Map,qn.current=new Map,Qn.current=new Map,Gr.current=new Map,gt(o=>o.map(l=>({...l,localCacheUrl:null,localFilePath:null,localCacheMap:null}))),Ml(o=>o.map(l=>({...l,localCacheUrl:null,localFilePath:null}))),ju(o=>o+1),n.silent||a("","success")},[a,as,fs,ir,kt.length,Qe.imageSavePath,Qe.videoSavePath]);M.useEffect(()=>{ir&&Go({silent:!0})},[ir,Go]);const Ns=M.useCallback(n=>{var u,p,m,h;if(typeof(n==null?void 0:n.useProxy)=="boolean")return n.useProxy;if(typeof((u=n==null?void 0:n.apiConfig)==null?void 0:u.useProxy)=="boolean")return n.apiConfig.useProxy;const o=String((n==null?void 0:n.provider)||((p=n==null?void 0:n.apiConfig)==null?void 0:p.provider)||"").trim();if(!o)return!1;if((m=Pe[o])!=null&&m.useProxy)return!0;const l=o.toLowerCase();return!!(l&&((h=Pe[l])!=null&&h.useProxy))},[Pe]),S0=M.useMemo(()=>{const n=new Map;return kt.forEach(o=>{o&&(o.localCacheMap&&Object.entries(o.localCacheMap).forEach(([l,u])=>{l&&u&&n.set(l,u)}),o.url&&o.localCacheUrl&&n.set(o.url,o.localCacheUrl))}),n},[kt]),vx=M.useCallback(n=>{if(!n||typeof n!="string"||!/^https?:/i.test(n))return"";try{const o=new URL(n).hostname.toLowerCase();return o.includes("modelscope")||o.includes("muse-ai.oss-cn-hangzhou.aliyuncs.com")?"modelscope":""}catch{return""}},[]),C0=M.useMemo(()=>{const n=new Map;return kt.forEach(o=>{if(!o)return;const l=Ns(o);[o.url,o.originalUrl,o.mjOriginalUrl,...Array.isArray(o.mjImages)?o.mjImages:[],...Array.isArray(o.output_images)?o.output_images:[]].filter(Boolean).forEach(p=>{typeof p=="string"&&/^https?:/i.test(p)&&n.set(p,l)})}),n},[kt,Ns]),Gi=M.useCallback((n,o=!1)=>{var m;if(!n)return!!o;const l=String(n);if(l.startsWith("data:")||l.startsWith("blob:"))return!1;const u=(kn||"").trim();if(u&&l.startsWith(u)||S0.has(l))return!1;if(C0.has(l))return!!C0.get(l);const p=vx(l);return p&&((m=Pe[p])!=null&&m.useProxy)?!0:!!o},[C0,S0,kn,vx,Pe]);M.useEffect(()=>{const n={savePath:Qe.savePath||"",imageSavePath:Qe.imageSavePath||"",videoSavePath:Qe.videoSavePath||""},o=_r.current,l=o.savePath!==n.savePath||o.imageSavePath!==n.imageSavePath||o.videoSavePath!==n.videoSavePath;_r.current=n,!(!as||!l)&&(!o.savePath&&!o.imageSavePath&&!o.videoSavePath||Go({silent:!0}))},[Qe.savePath,Qe.imageSavePath,Qe.videoSavePath,as,Go]);const wx=M.useCallback((n,o)=>{if(n){if(o)for(const[l,u]of Qn.current.entries())u===o&&Qn.current.delete(l);gt(l=>l.map(u=>{if(u.id!==n)return u;if(!o)return{...u,localCacheUrl:null,localFilePath:null,localCacheMap:null};let p=u.localCacheMap?{...u.localCacheMap}:null;p&&p[o]&&delete p[o];const m=p?Object.keys(p):[],h=u.localCacheUrl===o?m.length>0?p[m[0]]:null:u.localCacheUrl;return{...u,localCacheUrl:h||null,localFilePath:h?u.localFilePath:null,localCacheMap:m.length>0?p:null}}))}},[]),Xo=n=>!n||typeof n!="string"?n:n.startsWith("data:")?ll(n):n,Vn=M.useCallback((n,o=null)=>{if(!n)return"";const u=!!(Qe.imageSavePath||Qe.videoSavePath)?"/file/history/":"/file/.tapnow_cache/history/",p=h=>{if(!h)return!1;const x=String(h);return x.includes("/file/")?!x.includes(u):!0};if(o){if(ir&&n.localCacheMap&&n.localCacheMap[o]){const h=n.localCacheMap[o];if(!p(h))return h}return Xo(o)}const m=ir?n.localCacheUrl||(n.localCacheMap?Object.values(n.localCacheMap)[0]:null):null;return m&&p(m)?Xo(n.url||n.originalUrl||n.mjOriginalUrl||""):Xo(m||n.url||n.originalUrl||n.mjOriginalUrl||"")},[ir,Qe.imageSavePath,Qe.videoSavePath]);M.useCallback((n,o=null)=>{if(!n)return"";const u=!!(Qe.imageSavePath||Qe.videoSavePath)?"/file/history/":"/file/.tapnow_cache/history/",p=h=>{if(!h)return!1;const x=String(h);return x.includes("/file/")?!x.includes(u):!0};if(o){if(ir&&n.localCacheMap&&n.localCacheMap[o]){const h=n.localCacheMap[o];if(!p(h))return h}if(Nr!=="off"&&n.mjImages&&n.mjThumbnails){const h=n.mjImages.indexOf(o);if(h>=0&&n.mjThumbnails[h])return n.mjThumbnails[h]}return Xo(o)}const m=ir?n.localCacheUrl||(n.localCacheMap?Object.values(n.localCacheMap)[0]:null):null;return Nr==="off"?m&&p(m)?Xo(n.url||n.originalUrl||n.mjOriginalUrl||""):Xo(m||n.url||n.originalUrl||n.mjOriginalUrl||""):m&&p(m)?Xo(n.thumbnailUrl||n.url||n.originalUrl||n.mjOriginalUrl||""):Xo(m||n.thumbnailUrl||n.url||n.originalUrl||n.mjOriginalUrl||"")},[ir,Qe.imageSavePath,Qe.videoSavePath,Nr]);const Ku=M.useCallback(async(n,o={})=>{if(!n)return;const l=n.mjImages&&n.mjImages.length>0?n.mjImages:[n.url||n.originalUrl||n.mjOriginalUrl].filter(Boolean);if(l.length===0){a("","warning");return}const u=Nr==="ultra"?"ultra":"normal";if(l.forEach(p=>{p&&Ve.current.delete(p);const m=Vn(n,p);m&&Ve.current.delete(m)}),l.length>1){const p=await Promise.all(l.map(async m=>{const h=Vn(n,m);return h?await Ul(h,u):null}));gt(m=>m.map(h=>h.id===n.id?{...h,mjThumbnails:p}:h))}else{const p=Vn(n,l[0]),m=p?await Ul(p,u):null;gt(h=>h.map(x=>x.id===n.id?{...x,thumbnailUrl:m||null}:x))}o.silent||a("","success")},[Ul,Nr,Vn,a]),Cz=M.useCallback(async()=>{const n=kt.filter(o=>o.type==="image"&&(o.mjImages&&o.mjImages.length>0||o.url||o.originalUrl||o.mjOriginalUrl));if(n.length===0){a("","warning");return}a(` ${n.length} `,"success");for(const o of n)await Ku(o,{silent:!0});a("","success")},[kt,Ku,a]),zx=M.useCallback(async(n,o)=>{const l=(kn||"").replace(/\/+$/,"");if(l)try{const p=await fetch(`${l}/pick-path`);if(p.ok){const m=await p.json();if(m!=null&&m.path){const h=ls(m.path);if(await Bl({[o]:h},{silent:!0})){a("","success",2e3),Go({silent:!0});return}a("","error",2e3);return}}}catch{}const u=document.createElement("input");u.type="file",u.setAttribute("webkitdirectory",""),u.setAttribute("directory",""),u.multiple=!0,u.onchange=async()=>{const p=u.files&&u.files[0];if(!p)return;const m=p.path||"";if(!m){a("","warning",3e3);return}const h=m.replace(/[\\/][^\\/]+$/,""),x=ls(h);await Bl({[o]:x},{silent:!0})?(a("","success",2e3),Go({silent:!0})):a("","error",2e3)},u.click()},[kn,ls,Bl,a,Go]);M.useEffect(()=>{if(Nr==="off")return;const o=setTimeout(async()=>{const l=Nr==="ultra"?"ultra":"normal",p=kt.filter(m=>m.status==="completed"&&m.type==="image"&&(m.url||m.originalUrl||m.mjOriginalUrl)&&!m.thumbnailUrl).slice(0,5);if(p.length!==0)for(const m of p)try{const h=m.url||m.originalUrl||m.mjOriginalUrl;if(!h)continue;let x=Ve.current.get(h);x||(x=await Ul(h,l),x&&Ve.current.set(h,x));let b=null;m.mjImages&&m.mjImages.length>0&&(b=await Promise.all(m.mjImages.map(async v=>{if(!v)return null;const y=Ve.current.get(v);if(y)return y;const w=await Ul(v,l);return w&&Ve.current.set(v,w),w}))),(x||b)&&gt(v=>v.map(y=>y.id===m.id?{...y,thumbnailUrl:x||y.thumbnailUrl,mjThumbnails:b||y.mjThumbnails}:y))}catch(h){console.warn("[] :",h)}},100);return()=>clearTimeout(o)},[Nr,kt,Ul]),M.useEffect(()=>{if(!ir)return;const o=setTimeout(async()=>{for(const l of br)if(!l.localCacheUrl&&!(!l.profile_picture_url||l.profile_picture_url.startsWith("blob:")))try{const u=await Vu(l.id,l.profile_picture_url,"characters");u&&Ml(p=>p.map(m=>m.id===l.id?{...m,localCacheUrl:u.url,localFilePath:u.path}:m))}catch(u){console.warn("[] :",l.username,u)}},2e3);return()=>clearTimeout(o)},[br,ir,Vu]),M.useEffect(()=>{if(!ir)return;const n=async()=>{if(Zs.current)return;Zs.current=!0;const l={total:kt.length,processed:0,skippedStatus:0,skippedVideo:0,skippedEmpty:0,saved:0,failed:0,proxy:0,direct:0};try{const p=!!(Qe.imageSavePath||Qe.videoSavePath)?"/file/history/":"/file/.tapnow_cache/history/",m=h=>{if(!h)return!1;const x=String(h);return x.includes("/file/")?p&&!x.includes(p):!0};for(const h of kt){const x=h==null?void 0:h.status;if(!(!x||["completed","complete","success","done"].includes(x))){l.skippedStatus++;continue}const v=(h==null?void 0:h.url)||(h==null?void 0:h.originalUrl)||(h==null?void 0:h.mjOriginalUrl)||"";if((h==null?void 0:h.type)==="video"||Qt(v)){l.skippedVideo++;continue}const w=Ns(h);let j=h.localCacheUrl||null,R=h.localFilePath||null,C=h.localCacheMap?{...h.localCacheMap}:{},H=!1;j&&m(j)&&(j=null,R=null,H=!0),C&&Object.keys(C).length>0&&Object.entries(C).forEach(([Z,oe])=>{m(oe)&&(delete C[Z],H=!0)});const B=j||(Object.keys(C).length>0?Object.values(C)[0]:null);if(B){const Z=!String(B).startsWith("data:")&&!String(B).startsWith("blob:"),oe=Date.now(),te=qn.current.get(h.id)||0;if(Z&&oe-te>3e4){qn.current.set(h.id,oe);let ee=!1;try{const ce=await fetch(B,{method:"HEAD"}),W=Number(ce.headers.get("content-length")||0);ce.ok||(ee=!0),W>0&&W<128&&(ee=!0)}catch{ee=!0}ee&&(C&&Object.keys(C).length>0&&Object.entries(C).forEach(([ce,W])=>{Qn.current.get(ce)===W&&Qn.current.delete(ce)}),j=null,R=null,C={},H=!0,_t.current.delete(h.id))}}const L=h.mjImages&&h.mjImages.length>0?h.mjImages:h.output_images&&h.output_images.length>0?h.output_images:[h.url||h.originalUrl||h.mjOriginalUrl].filter(Boolean),Y=[...new Set(L.filter(Boolean))];if(Y.length===0){l.skippedEmpty++;continue}const J=Y.reduce((Z,oe)=>C[oe]?Z+1:Z,0);if(_t.current.has(h.id)&&J>=Y.length)continue;_t.current.add(h.id),l.processed++;for(let Z=0;Z<Y.length;Z++){const oe=Y[Z];if(!oe||oe.startsWith("blob:")||oe.includes("..."))continue;const te=Y.length>1?`${h.id}-${Z}`:`${h.id}`,ee=Ol(oe,te),ce=ti(ee)||ee;if(C[oe]&&ce&&!String(C[oe]).includes(ce)&&(delete C[oe],H=!0),Qn.current.has(oe)){const W=Qn.current.get(oe);if(W&&(m(W)||ce&&!String(W).includes(ce)))Qn.current.delete(oe);else{W&&!C[oe]&&(C[oe]=W,H=!0),!j&&W&&(j=W);continue}}try{const W=Gi(oe,w);W?l.proxy++:l.direct++;const Se=await Vu(ee,oe,"history",{forceId:!0,useProxy:W});Se?(Qn.current.set(oe,Se.url),C[oe]=Se.url,H=!0,j||(j=Se.url,R=Se.path),l.saved++):l.failed++}catch(W){console.warn("[] :",h.id,W),l.failed++}}const q=Y[0];if(q){const Z=C[q]||null;Z&&!m(Z)?j=Z:(j=null,R=null)}if(H||j!==h.localCacheUrl){const Z=Object.keys(C).length>0?C:null;gt(oe=>oe.map(te=>te.id===h.id?{...te,localCacheUrl:j||null,localFilePath:R||null,localCacheMap:Z}:te))}}}finally{Zs.current=!1}};n();const o=setTimeout(n,3e3);return()=>clearTimeout(o)},[kt,ir,Qe.imageSavePath,Qe.videoSavePath,Vu,ti,Ol,Ns,Gi,mi]),M.useEffect(()=>{if(!ir)return;const n=async()=>{if(Ki.current)return;Ki.current=!0;const l={total:kt.length,processed:0,skippedStatus:0,skippedNonVideo:0,skippedEmpty:0,saved:0,failed:0,proxy:0,direct:0};try{const p=!!Qe.videoSavePath?"/file/history/":"/file/.tapnow_cache/history/",m=h=>{if(!h)return!1;const x=String(h);return x.includes("/file/")?p&&!x.includes(p):!0};for(const h of kt){const x=h==null?void 0:h.status;if(!(!x||["completed","complete","success","done"].includes(x))){l.skippedStatus++;continue}const v=(h==null?void 0:h.url)||(h==null?void 0:h.originalUrl)||"";if(!((h==null?void 0:h.type)==="video"||Qt(v))){l.skippedNonVideo++;continue}const w=Ns(h);if(h.localCacheUrl&&m(h.localCacheUrl)&&gt(j=>j.map(R=>R.id===h.id?{...R,localCacheUrl:null,localFilePath:null}:R)),!h.localCacheUrl&&!_t.current.has(h.id)&&(_t.current.add(h.id),!(v&&(v.includes("localhost:")||v.includes("127.0.0.1:"))))){if(!v||v.startsWith("blob:")||v.includes("...")){l.skippedEmpty++;continue}l.processed++;try{const j=Gi(v,w);j?l.proxy++:l.direct++;const R=await yx(h.id,v,"history",{useProxy:j});R?(gt(C=>C.map(H=>H.id===h.id?{...H,localCacheUrl:R.url,localFilePath:R.path}:H)),l.saved++):l.failed++}catch(j){console.warn("[] :",h.id,j),l.failed++}}}}finally{Ki.current=!1}};n();const o=setTimeout(n,5e3);return()=>clearTimeout(o)},[kt,ir,Qe.videoSavePath,yx,Ns,Gi,mi]);const Xi=M.useRef(null),Zc=M.useRef({x:0,y:0}),kx=M.useRef(null),Ez=M.useRef(null),Us=M.useRef(d),Zi=M.useRef(Ce),ni=M.useRef(Hn),qc=M.useRef(g),Yu=M.useRef({}),go=M.useRef(null),Hl=M.useRef(!1),xo=M.useRef(null),qi=M.useRef(null),Zo=M.useRef(null),Qc=M.useRef(null);M.useEffect(()=>{localStorage.setItem("tapnow_api_configs",JSON.stringify(je))},[je]);const E0=M.useCallback(n=>{ae(),f(o=>o.filter(l=>l.id!==n)),z(o=>o.filter(l=>l.from!==n&&l.to!==n)),Ce===n&&xe(null)},[Ce,ae]),Le=M.useCallback((n,o)=>{f(l=>l.map(u=>u.id===n?{...u,settings:{...u.settings,...o}}:u))},[]),Wl=(n,o)=>{if(!o)return;const l=new FileReader;l.onload=async u=>{const p=u.target.result;let m={duration:0,w:0,h:0};try{m=await nc(p)}catch(h){console.warn("",h)}f(h=>h.map(x=>x.id===n?{...x,content:p,videoMeta:m,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:o.name}:x))},l.readAsDataURL(o)};M.useEffect(()=>{const n=o=>{if(!(o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable)&&(o.key==="Delete"||o.key==="Del")){o.preventDefault(),o.stopPropagation();const l=Zi.current,u=ni.current;if(l)E0(l),xe(null);else if(u&&u.size>0){fe.current&&fe.current();const p=new Set(u);f(m=>m.filter(h=>!p.has(h.id))),z(m=>m.filter(h=>!p.has(h.from)&&!p.has(h.to))),Hr(new Set)}}};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[]);const jx=M.useMemo(()=>Kp(n=>{try{localStorage.setItem("tapnow_characters",JSON.stringify(n))}catch(o){console.error(":",o)}},500),[]);M.useEffect(()=>{jx(br)},[br,jx]),M.useEffect(()=>{Jc(null)},[Tl,Pl,fo]),M.useEffect(()=>{if(!Pu){g0(-1);return}const n=o=>{o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||Uo||(o.key==="ArrowUp"||o.key==="Up"?(o.preventDefault(),o.stopPropagation(),g0(l=>{const u=l<=0?kt.length-1:l-1,p=kt[u],m=Vn(p);return m&&cr({...p,url:m,storyboardContext:null}),u})):o.key==="ArrowDown"||o.key==="Down"?(o.preventDefault(),o.stopPropagation(),g0(l=>{const u=l>=kt.length-1?0:l+1,p=kt[u],m=Vn(p);return m&&cr({...p,url:m,storyboardContext:null}),u})):(o.key==="Escape"||o.key==="Esc")&&(o.preventDefault(),o.stopPropagation(),Au(!1)))};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[Pu,kt,Uo,Vn]);const Iz=80,bo=n=>n&&(n.startsWith("data:")&&n.length>5e3?`${n.substring(0,100)}...`:n),Nx=n=>{const o={...n};return o.url&&(o.url=bo(o.url)),o.originalUrl&&(o.originalUrl=bo(o.originalUrl)),o.mjOriginalUrl&&(o.mjOriginalUrl=bo(o.mjOriginalUrl)),Array.isArray(o.output_images)&&(o.output_images=o.output_images.slice(0,12).map(bo)),Array.isArray(o.mjImages)&&(o.mjImages=o.mjImages.slice(0,12).map(bo)),delete o.mjImageInfo,delete o.localCacheMap,delete o.localCacheUrl,delete o.localFilePath,delete o.apiConfig,o},ed=M.useMemo(()=>Kp(n=>{try{localStorage.setItem("tapnow_history",JSON.stringify(n))}catch(o){console.error(":",o);try{const l=n.map(u=>{var p;return{id:u.id,type:u.type,url:bo(u.url),prompt:((p=u.prompt)==null?void 0:p.substring(0,200))||"",time:u.time,status:u.status,modelName:u.modelName,width:u.width,height:u.height,ratio:u.ratio,mjImages:Array.isArray(u.mjImages)?u.mjImages.slice(0,8).map(bo):u.mjImages,selectedMjImageIndex:u.selectedMjImageIndex,mjRatio:u.mjRatio,mjNeedsSplit:u.mjNeedsSplit}});localStorage.setItem("tapnow_history",JSON.stringify(l))}catch(l){console.error(":",l);try{const u=n.map(p=>{var m;return{id:p.id,type:p.type,url:bo(p.url),prompt:((m=p.prompt)==null?void 0:m.substring(0,100))||"",time:p.time,status:p.status,modelName:p.modelName}});ed(u)}catch(u){console.error(":",u)}}}},1e3),[]),_x=M.useMemo(()=>Kp(n=>{localStorage.setItem("tapnow_global_key",n)},1e3),[]);M.useEffect(()=>{_x(We)},[We,_x]),M.useEffect(()=>{try{const n=kt.slice(0,Iz).map(o=>{var p,m,h,x;const l=Nx(o),u=((m=(p=o.apiConfig)==null?void 0:p.modelId)==null?void 0:m.includes("mj"))||((x=(h=o.modelName)==null?void 0:h.toLowerCase())==null?void 0:x.includes("midjourney"));return o.mjImages&&o.mjImages.length===4&&u&&(l.mjImages=null,l.mjNeedsSplit=!0,l.mjOriginalUrl=bo(o.mjOriginalUrl||o.url)),l});ed(n)}catch(n){console.error(":",n);try{const o=kt.slice(0,20).map(l=>Nx(l));ed(o)}catch(o){console.error(":",o);try{const l=kt.slice(0,10).map(u=>{var p;return{id:u.id,type:u.type,prompt:(p=u.prompt)==null?void 0:p.substring(0,100),time:u.time,status:u.status,modelName:u.modelName}});ed(l)}catch(l){console.error(":",l)}}}},[kt,ed]);const Sx=M.useMemo(()=>Kp(n=>{try{localStorage.setItem("tapnow_chat_sessions",JSON.stringify(n))}catch{}},1e3),[]);M.useEffect(()=>{Sx(qs)},[qs,Sx]),M.useEffect(()=>{Us.current=d,Zi.current=Ce,ni.current=Hn,qc.current=g,po.current=Bo},[d,Ce,Hn,g,Bo]);const At=M.useMemo(()=>{const n=new Map;return d.forEach(o=>{n.set(o.id,o)}),n},[d]),Ju=M.useMemo(()=>{const n=new Map;return K.forEach(o=>{o!=null&&o.id&&n.set(o.id,{...o,displayName:o.displayName||o.id,modelName:o.modelName||o.id,type:o.type||"Chat",apiType:o.apiType||"openai",ratioLimits:Array.isArray(o.ratioLimits)?o.ratioLimits:null,ratioNotes:rs(o.ratioNotes),ratioNotesEnabled:!!o.ratioNotesEnabled,resolutionLimits:Array.isArray(o.resolutionLimits)?o.resolutionLimits:null,resolutionNotes:el(o.resolutionNotes),resolutionNotesEnabled:!!o.resolutionNotesEnabled,durations:Array.isArray(o.durations)?o.durations:null,durationNotes:rs(o.durationNotes),durationNotesEnabled:!!o.durationNotesEnabled,videoResolutions:Array.isArray(o.videoResolutions)?o.videoResolutions:null,videoResolutionNotes:rs(o.videoResolutionNotes),videoResolutionNotesEnabled:!!o.videoResolutionNotesEnabled,supportsFirstLastFrame:!!o.supportsFirstLastFrame,supportsHD:!!o.supportsHD,customParams:tc(o.customParams),previewOverrideEnabled:!!o.previewOverrideEnabled,previewOverridePatch:Pd(o.previewOverridePatch)})}),n},[K]),I0=K.some(n=>!sx.has(n.id)),Vl=M.useCallback(n=>{if(!n)return null;const l=(n.libraryId?Ju.get(n.libraryId):null)||null;return{...n,modelName:(l==null?void 0:l.modelName)||n.modelName||n.id,displayName:(l==null?void 0:l.displayName)||n.displayName||n.id,type:(l==null?void 0:l.type)||n.type||"Chat",apiType:(l==null?void 0:l.apiType)||n.apiType,ratioLimits:l?l.ratioLimits:n.ratioLimits||null,ratioNotes:rs(l?l.ratioNotes:n.ratioNotes),ratioNotesEnabled:l?!!l.ratioNotesEnabled:!!n.ratioNotesEnabled,resolutionLimits:l?l.resolutionLimits:n.resolutionLimits||null,resolutionNotes:el(l?l.resolutionNotes:n.resolutionNotes),resolutionNotesEnabled:l?!!l.resolutionNotesEnabled:!!n.resolutionNotesEnabled,durations:l?l.durations:n.durations||null,durationNotes:rs(l?l.durationNotes:n.durationNotes),durationNotesEnabled:l?!!l.durationNotesEnabled:!!n.durationNotesEnabled,videoResolutions:l?l.videoResolutions:n.videoResolutions||null,videoResolutionNotes:rs(l?l.videoResolutionNotes:n.videoResolutionNotes),videoResolutionNotesEnabled:l?!!l.videoResolutionNotesEnabled:!!n.videoResolutionNotesEnabled,supportsFirstLastFrame:l?!!l.supportsFirstLastFrame:!!n.supportsFirstLastFrame,supportsHD:l?!!l.supportsHD:!!n.supportsHD,customParams:tc(l?l.customParams:n.customParams),previewOverrideEnabled:l?!!l.previewOverrideEnabled:!!n.previewOverrideEnabled,previewOverridePatch:Pd((l==null?void 0:l.previewOverridePatch)||n.previewOverridePatch)}},[Ju]),qo=M.useMemo(()=>{const n=new Map;return je.forEach(o=>{const l=Vl(o);l!=null&&l._uid&&n.set(l._uid,l)}),n},[je,Vl]),Gu=M.useMemo(()=>{const n=new Map;return je.forEach(o=>{const l=Vl(o);l!=null&&l.id&&(n.has(l.id)||n.set(l.id,[]),n.get(l.id).push(l))}),n},[je,Vl]),Ht=M.useCallback(n=>{if(!n)return null;const o=qo.get(n);if(o)return o;const l=Gu.get(n);return!l||l.length===0?null:l.length===1?l[0]:l.find(p=>!p.libraryId)||l[0]},[qo,Gu]),Ut=M.useCallback(n=>{var u,p;if(!n)return"";if(qo.has(n))return n;const o=Gu.get(n);if(!o||o.length===0)return n;if(o.length===1)return((u=o[0])==null?void 0:u._uid)||n;const l=o.find(m=>!m.libraryId);return(l==null?void 0:l._uid)||((p=o[0])==null?void 0:p._uid)||n},[qo,Gu]);M.useEffect(()=>{je.length&&f(n=>{let o=!1;const l=n.map(u=>{if(!u.settings)return u;let p=u.settings,m=!1;const h=x=>{if(!(p!=null&&p[x]))return;const b=Ut(p[x]);b&&b!==p[x]&&(m||(p={...p}),p[x]=b,m=!0)};if(h("model"),h("chatModel"),h("imageModel"),Array.isArray(p.shots)){let x=!1;const b=p.shots.map(v=>{if(!(v!=null&&v.model))return v;const y=Ut(v.model);return y&&y!==v.model?(x=!0,{...v,model:y}):v});x&&(m||(p={...p}),p.shots=b,m=!0)}return m?(o=!0,{...u,settings:p}):u});return o?l:n})},[je.length,Ut,f]);const ri=M.useCallback(n=>{const o=Ht(n);if(!o)return{key:We,url:ss.replace(/\/+$/,""),modelName:n,displayName:n,apiType:"openai",useProxy:!1,forceAsync:!1};const l=Pe[o.provider],u=(l==null?void 0:l.key)||We,p=((l==null?void 0:l.url)||ss).replace(/\/+$/,"");return{key:u,url:p,modelName:o.modelName,displayName:o.displayName,provider:o.provider,type:o.type,apiType:o.apiType||(l==null?void 0:l.apiType)||"openai",useProxy:!!(l!=null&&l.useProxy),forceAsync:!!(l!=null&&l.forceAsync)}},[Ht,Pe,We]),Cx=M.useCallback((n,o)=>{if(!n)return n;const l=Pe[o];if(!(l!=null&&l.useProxy))return n;const u=(kn||"").trim().replace(/\/+$/,"");return u?`${u}/proxy?url=${encodeURIComponent(n)}`:n},[Pe,kn]),td=M.useCallback(n=>{if(!n)return"";const o=Ht(n);return(o==null?void 0:o.displayName)||(o==null?void 0:o.modelName)||(o==null?void 0:o.id)||n},[Ht]),Ex=M.useCallback(n=>{var y,w;if(!n)return null;const o=((y=n==null?void 0:n.apiConfig)==null?void 0:y.modelId)||((w=n==null?void 0:n.apiConfig)==null?void 0:w.id)||(n==null?void 0:n.modelName)||(n==null?void 0:n.modelId),l=o?Ht(o):null,u=n.ratio||n.mjRatio||"",p=u?Bp(u,!!(l!=null&&l.ratioNotesEnabled),(l==null?void 0:l.ratioNotes)||{}):"",m=n.type==="video",h=n.resolution||(n.width&&n.height?`${n.width}x${n.height}`:"");let x=h;if(h){const j=m?!!(l!=null&&l.videoResolutionNotesEnabled):!!(l!=null&&l.resolutionNotesEnabled),R=m?(l==null?void 0:l.videoResolutionNotes)||{}:(l==null?void 0:l.resolutionNotes)||{},H=(m?zo(h):Qd(h))||h;x=Bp(H,j,R)}let b="";if(m&&n.duration){const j=String(n.duration).endsWith("s")?String(n.duration):`${n.duration}s`;b=Bp(j,!!(l!=null&&l.durationNotesEnabled),(l==null?void 0:l.durationNotes)||{})}const v=[];return n.customParams&&Array.isArray(l==null?void 0:l.customParams)&&l.customParams.forEach(j=>{const R=Um(j,n.customParams);if(R===""||R===void 0||R===null)return;const C=Bp(R,!!(j!=null&&j.notesEnabled),(j==null?void 0:j.valueNotes)||{}),H=(j==null?void 0:j.name)||(j==null?void 0:j.id)||"";v.push(`${H}:${C}`)}),{ratioLabel:p,resolutionLabel:x,durationLabel:b,customParamLabels:v}},[Ht]),Ix=M.useCallback((n,o,l)=>{const u=Ht(n),p=Array.isArray(u==null?void 0:u.customParams)?u.customParams:[];if(!p.length)return null;const m=o||{};return s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),p.map(h=>{const x=h.id||h.name,b=Um(h,m),v=Array.isArray(h.values)?h.values:[];return s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[10px] w-16 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:h.name||""}),v.length>0?s.jsxs("select",{value:b||"",onChange:y=>{const w=y.target.value,j={...m};w?j[x]=w:delete j[x],l(j)},className:`flex-1 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:y=>y.stopPropagation(),children:[s.jsx("option",{value:"",children:""}),v.map(y=>s.jsx("option",{value:y,children:pv(h,y)},y))]}):s.jsx("input",{type:"text",value:b||"",onChange:y=>{const w=y.target.value,j={...m};w?j[x]=w:delete j[x],l(j)},placeholder:": size/quality",className:`flex-1 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:y=>y.stopPropagation()}),h.override&&s.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-emerald-500/15 text-emerald-600 border border-emerald-500/30",children:""})]},x)})]})},[Ht,e]),Zr=M.useMemo(()=>{const n={};return Object.entries(Pe).forEach(([o])=>{n[o]={name:o,models:[]}}),je.forEach(o=>{if(Lm.includes(o.id))return;const l=Vl(o);if(!l)return;const u=l.provider||"Other";n[u]||(n[u]={name:u,models:[]}),n[u].models.push(l)}),n},[je,Pe,Vl]),$0=M.useCallback(n=>{if(!n)return Af;const o=Ht(n);if(o!=null&&o.ratioLimits&&Array.isArray(o.ratioLimits)&&o.ratioLimits.length>0){const u=o.ratioLimits.map(p=>String(p));return u.includes("Auto")?u:["Auto",...u]}const l=(o==null?void 0:o.id)||n;return h_(l)},[Ht]),M0=M.useCallback(n=>{if(!n)return Om;const o=Ht(n);if(o!=null&&o.resolutionLimits&&Array.isArray(o.resolutionLimits)&&o.resolutionLimits.length>0){const u=o.resolutionLimits.map(m=>Qd(m)).filter(Boolean),p=u.includes("Auto")?u:["Auto",...u];return Array.from(new Set(p))}const l=(o==null?void 0:o.id)||n;return w_(l)},[Ht]),T0=M.useCallback(n=>{const o=n?Ht(n):null,u=(Array.isArray(o==null?void 0:o.videoResolutions)&&o.videoResolutions.length>0?o.videoResolutions:Kw).map(m=>zo(m)).filter(Boolean),p=u.includes("Auto")?u:["Auto",...u];return Array.from(new Set(p))},[Ht]),Ba=M.useMemo(()=>{const n=new Map;return kt.forEach(o=>{n.set(o.id,o)}),n},[kt]),Xu=M.useMemo(()=>{if(!Xi.current)return d;const n=Xi.current.getBoundingClientRect(),o=200,l=E.current,u=(-l.x-o)/l.zoom,p=(n.width-l.x+o)/l.zoom,m=(-l.y-o)/l.zoom,h=(n.height-l.y+o)/l.zoom;return d.filter(x=>{const b=x.x+(x.width||0),v=x.y+(x.height||0);return x.x<p&&b>u&&x.y<h&&v>m})},[d,Xt.x,Xt.y,Xt.zoom]);M.useCallback(n=>n>=.8?"high":n>=.4?"medium":"low",[]),M.useEffect(()=>{E.current=Xt},[Xt]);const Qo=M.useMemo(()=>{const n={to:new Map,from:new Map};return g.forEach(o=>{n.to.has(o.to)||n.to.set(o.to,[]),n.to.get(o.to).push(o),n.from.has(o.from)||n.from.set(o.from,[]),n.from.get(o.from).push(o)}),n},[g]),P0=M.useCallback(n=>{const o=[],l=new Set,u=Qo.to.get(n)||[],p=(h,x="image",b={})=>{if(!h)return;const v=`${x}:${h}`;l.has(v)||(l.add(v),o.push({url:h,type:x,...b}))},m=(h={},x=null,b=null)=>{var v;if(x){const y=x.provider||((v=x.apiConfig)==null?void 0:v.provider)||h.provider,w=Ns(x);return{...h,provider:y,apiConfig:x.apiConfig||h.apiConfig,useProxy:w}}if(b){const y=Ht(b),w=(y==null?void 0:y.provider)||h.provider,j=w?Ns({provider:w}):!1;return{...h,provider:w,apiConfig:y?{modelId:y.id,provider:y.provider}:h.apiConfig,useProxy:j}}return h};return u.forEach(h=>{var b,v,y,w,j;const x=At.get(h.from);if(x){if(x.type==="gen-image"||x.type==="gen-video"){const R=kt.find(B=>B.sourceNodeId===x.id&&B.status==="completed");if(!R)return;const C=R.prompt||((b=x.settings)==null?void 0:b.prompt)||((v=x.settings)==null?void 0:v.videoPrompt)||"",H=m({},R);if(R.mjImages&&R.mjImages.length>0)R.mjImages.forEach(B=>p(B,R.type||"image",{prompt:C,originalUrl:R.mjOriginalUrl||R.originalUrl||B,...H}));else if(R.output_images&&R.output_images.length>0)R.output_images.forEach(B=>p(B,R.type||"image",{prompt:C,originalUrl:R.originalUrl||B,...H}));else{const B=R.url||R.originalUrl||R.mjOriginalUrl;B&&p(B,R.type||(x.type==="gen-video"?"video":"image"),{prompt:C,originalUrl:R.originalUrl||B,...H})}return}if(x.type==="storyboard-node"){const R=((y=x.settings)==null?void 0:y.shots)||[],C=((w=x.settings)==null?void 0:w.mode)||"video",H=((j=x.settings)==null?void 0:j.projectTitle)||"";R.forEach(B=>{if(!B.outputEnabled)return;const L=m({},null,B.model);if(C==="image")if(B.output_images&&B.output_images.length>0)B.output_images.forEach(Y=>{p(Y,"image",{prompt:B.prompt||B.description||"",projectTitle:H,originalUrl:Y,...L})});else{const Y=B.selectedImageIndex??-1;Y>=0&&B.output_images&&B.output_images[Y]&&p(B.output_images[Y],"image",{prompt:B.prompt||B.description||"",projectTitle:H,originalUrl:B.output_images[Y],...L})}else{const Y=B.output_url||B.image_url;Y&&p(Y,Qt(Y)?"video":"image",{prompt:B.prompt||B.description||"",projectTitle:H,originalUrl:Y,...L})}});return}if(x.type==="video-input"){const R=x.selectedKeyframes&&x.selectedKeyframes.length>0?x.selectedKeyframes.map(C=>C.url):[];R.length>0?R.forEach(C=>p(C,"image",{name:x.videoFileName||"",originalUrl:C})):x.frames&&x.frames.length>0&&p(x.frames[0].url,"image",{name:x.videoFileName||"",originalUrl:x.frames[0].url});return}if(x.type==="input-image"||x.type==="preview"){x.content&&p(x.content,Qt(x.content)?"video":"image",{name:x.title||"",originalUrl:x.content}),x.previewMjImages&&x.previewMjImages.forEach(R=>p(R,"image",{name:x.title||"",originalUrl:R}));return}}}),o},[Qo,At,kt,Ns,Ht]);M.useEffect(()=>{const n=setInterval(()=>{const o=Date.now(),l=kt.filter(p=>p.sourceNodeId&&p.status==="generating"&&p.startTime),u={};l.forEach(p=>{const m=Math.floor((o-p.startTime)/100);u[p.sourceNodeId]=m/10}),vz(u)},500);return()=>clearInterval(n)},[kt]);const Zu=M.useRef(new Set);M.useEffect(()=>{kt.forEach(n=>{var o,l;if(n.mjNeedsSplit&&n.mjOriginalUrl&&((l=(o=n.apiConfig)==null?void 0:o.modelId)!=null&&l.includes("mj"))&&n.status==="completed"){if(Zu.current.has(n.id))return;Zu.current.add(n.id),setTimeout(()=>{let u=n.mjRatio||"1:1";if(n.prompt&&n.prompt.includes("--ar ")){const p=n.prompt.match(/--ar\s+([\d:]+)/);p&&p[1]&&(u=p[1])}Jx(n.mjOriginalUrl,u).then(p=>{const m=p.map(b=>typeof b=="string"?b:b.url),h=p[0],x=typeof h=="string"?h:h.url;gt(b=>b.map(v=>v.id===n.id?{...v,mjImages:m,url:x,selectedMjImageIndex:0,mjRatio:u,mjNeedsSplit:!1,mjImageInfo:p.map(y=>typeof y=="string"?null:{width:y.width,height:y.height,ratio:y.ratio})}:v)),Zu.current.delete(n.id)}).catch(p=>{console.error("Midjourney: :",p),Zu.current.delete(n.id),gt(m=>m.map(h=>h.id===n.id?{...h,mjNeedsSplit:!0}:h))})},500)}})},[kt]);const $x=M.useCallback(async(n=[],o={})=>{const l=o.useProxyResolver,u=[],p=new Map,m=new Set;for(let h=0;h<n.length;h++){const x=n[h],b=x==null?void 0:x.url;if(b&&!m.has(b)){m.add(b);try{let v=b;const y=typeof l=="function"?!!l(x):!1,w=Gi(b,y);if(!b.startsWith("data:")){const{blob:q}=await Ji(b,{useProxy:w});v=await new Promise(Z=>{const oe=new FileReader;oe.onloadend=()=>Z(oe.result),oe.readAsDataURL(q)})}const j=x.type==="video"||b.startsWith("data:video")||Qt(b),R=Jo(v,j?".mp4":".png"),H=[x.projectTitle||(kr&&kr!==""?kr:""),x.prompt].filter(Boolean).join("-")||mo(b)||x.name||"tapnow";let B=ti(H)||"tapnow";B=B.slice(0,80);const L=(p.get(B)||0)+1;p.set(B,L);const Y=x.dedupeKey||x.originalUrl||b,J=mo(Y)||Y;u.push({filename:`${B}-${L}${R}`,content:v,sourceUrl:b,dedupeKey:J,scopedKey:x.scopedKey||"",type:j?"video":"image"})}catch(v){console.warn("[] :",v)}}}return u},[Ji,Jo,mo,ti,kr,Gi]),qu=M.useCallback(n=>{var l;return(((l=n==null?void 0:n.settings)==null?void 0:l.serverUrl)||kn||"").trim().replace(/\/+$/,"")},[kn]),A0=M.useCallback(async(n,o,l={})=>{var Y,J,q,Z,oe;const u=l.silent===!0,p=qu(n);if(!p){u||a("","error");return}const m=((Y=n.settings)==null?void 0:Y.lastSavedUrls)||[],h=(((J=n.settings)==null?void 0:J.subfolder)||"").trim(),x=`${p}::${h}`,b=o.map(te=>{if(!te)return te;const ee=te.dedupeKey||te.originalUrl||te.url,ce=ee?mo(ee)||ee:"",W=ce?`${x}::${ce}`:"",Se=!h&&ce&&m.includes(ce),ze=W&&m.includes(W)||Se;return{...te,dedupeKey:ce,scopedKey:W,isDuplicate:ze}}),v=b.filter(te=>(te==null?void 0:te.url)&&te.scopedKey&&!te.isDuplicate),y=b.filter(te=>(te==null?void 0:te.url)&&te.scopedKey&&te.isDuplicate).length;if(v.length===0){u||a("","success");return}const w=await $x(v,{useProxyResolver:Ns});if(w.length===0){u||a("","warning");return}let j;try{j=await fetch(`${p}/save-batch`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:w,subfolder:((q=n.settings)==null?void 0:q.subfolder)||""})})}catch(te){throw u||a("","error"),te}if(!j.ok){const te=await j.text();throw new Error(te||"")}const R=await j.json(),C=R.results||[],H=C.map((te,ee)=>{var ce,W;return te!=null&&te.success?((ce=w[ee])==null?void 0:ce.scopedKey)||((W=v[ee])==null?void 0:W.scopedKey):null}).filter(Boolean),B=Array.from(new Set([...((Z=n.settings)==null?void 0:Z.lastSavedUrls)||[],...H]));Le(n.id,{lastSavedUrls:B,lastSaved:new Date().toLocaleString(),savedFiles:[...((oe=n.settings)==null?void 0:oe.savedFiles)||[],...C.map(te=>te.path).filter(Boolean)]});const L=C.filter(te=>te.success).length;if(!u){const te=y>0?` ${y} `:"";a(R.message||` ${L} ${te}`,"success")}},[$x,mo,Ns,qu,a]),$z=M.useCallback(async(n,o)=>{const l=(o||kn||"").trim().replace(/\/+$/,"");if(!l){a("","warning");return}Le(n,{serverStatus:"checking"});try{if((await fetch(`${l}/ping`,{method:"GET"})).ok){Le(n,{serverStatus:"connected"}),a("","success");return}}catch{}Le(n,{serverStatus:"disconnected"}),a("","error")},[kn,a,Le]),R0=M.useRef(new Set);M.useEffect(()=>{const n=d.filter(o=>{var l;return o.type==="local-save"&&((l=o.settings)==null?void 0:l.autoSave)});n.length!==0&&n.forEach(async o=>{var v,y;const l=qu(o);if(!l)return;const u=P0(o.id);if(u.length===0)return;const p=((v=o.settings)==null?void 0:v.lastSavedUrls)||[],m=(((y=o.settings)==null?void 0:y.subfolder)||"").trim(),h=`${l}::${m}`,x=u.filter(w=>{const j=(w==null?void 0:w.originalUrl)||(w==null?void 0:w.url),R=j?mo(j)||j:"",C=R?`${h}::${R}`:"",H=!m&&R&&p.includes(R),B=C&&p.includes(C)||H;return C&&!B});if(x.length===0)return;const b=`${o.id}-${x.map(w=>w.url).join("|")}`;R0.current.has(b)||(R0.current.add(b),setTimeout(async()=>{try{await A0(o,x,{silent:!0})}catch(w){console.error(":",w)}finally{R0.current.delete(b)}},1e3))})},[d,kt,P0,A0,qu,mo]);const Mz=n=>{n.preventDefault(),Mx(!0)},[Qu,Mx]=M.useState(!1),ep=M.useCallback(n=>{if(!Qu)return;const o=window.innerWidth-n.clientX;Qw(Math.max(300,Math.min(o,800)))},[Qu]),tp=M.useCallback(()=>{Mx(!1)},[]);M.useEffect(()=>{const n=console.error,o=console.warn,l=u=>{const p=u.map(m=>typeof m=="string"?m:m&&m.toString?m.toString():"").join(" ");return p.includes("Unable to preventDefault")||p.includes("passive event listener")||p.includes("preventDefault")&&p.includes("passive")};return console.error=function(...u){l(u)||n.apply(console,u)},console.warn=function(...u){l(u)||o.apply(console,u)},()=>{console.error=n,console.warn=o}},[]),M.useEffect(()=>{const n=l=>{if(l.ctrlKey)try{l.cancelable&&(l.preventDefault(),l.stopPropagation())}catch{}},o={passive:!1,capture:!0};return window.addEventListener("wheel",n,o),document.addEventListener("wheel",n,o),window.addEventListener("mousewheel",n,o),document.addEventListener("mousewheel",n,o),()=>{window.removeEventListener("wheel",n,o),document.removeEventListener("wheel",n,o),window.removeEventListener("mousewheel",n,o),document.removeEventListener("mousewheel",n,o)}},[]),M.useEffect(()=>{const n=Xi.current;if(!n)return;const o=l=>{if(l.ctrlKey){try{l.cancelable&&(l.preventDefault(),l.stopPropagation())}catch{}return}const u=l.target;let p=!1,m=null;if(u.tagName==="TEXTAREA"&&u.scrollHeight>u.clientHeight){try{l.cancelable&&l.preventDefault()}catch{}const y=u.scrollHeight-u.clientHeight,w=u.scrollTop,j=Math.max(0,Math.min(y,w+l.deltaY));u.scrollTop=j;return}let h=u;for(;h&&h!==n;){if(h.classList){const y=h.classList.contains("flex")&&h.classList.contains("flex-col")&&h.classList.contains("h-full")&&h.classList.contains("rounded-xl")&&h.classList.contains("overflow-hidden");if(h.classList.contains("video-input-container")||h.classList.contains("video-analyze-container")||y){if(p=!0,y)m=h.querySelector(".flex-1.overflow-y-auto.custom-scrollbar"),m||(m=h.querySelector(".flex-1.overflow-y-auto"));else if(m=h.querySelector('.overflow-y-auto, .custom-scrollbar, [class*="overflow-y"]'),!m){const R=window.getComputedStyle(h);(R.overflowY==="auto"||R.overflowY==="scroll"||h.classList.contains("custom-scrollbar"))&&(m=h)}break}const w=h.closest(".video-input-container, .video-analyze-container");if(w){if(p=!0,m=w.querySelector('.overflow-y-auto, .custom-scrollbar, [class*="overflow-y"]'),!m){const R=window.getComputedStyle(w);(R.overflowY==="auto"||R.overflowY==="scroll")&&(m=w)}break}const j=h.closest(".flex.flex-col.h-full.rounded-xl.overflow-hidden");if(j){p=!0,m=j.querySelector(".flex-1.overflow-y-auto.custom-scrollbar"),m||(m=j.querySelector(".flex-1.overflow-y-auto"));break}}h=h.parentElement}if(p&&m){try{l.cancelable&&(l.preventDefault(),l.stopPropagation())}catch{}const y=m.scrollHeight-m.clientHeight,w=m.scrollTop,j=Math.max(0,Math.min(y,w+l.deltaY));m.scrollTop=j;return}try{l.cancelable&&l.preventDefault()}catch{}const x=n.getBoundingClientRect(),b=l.clientX-x.left,v=l.clientY-x.top;zr(y=>{const w=l.deltaY>0?.9:1.1;let j=Math.min(Math.max(y.zoom*w,.2),3);const R=j/y.zoom;return{zoom:j,x:b-(b-y.x)*R,y:v-(v-y.y)*R}})};return n.addEventListener("wheel",o,{passive:!1}),()=>{n.removeEventListener("wheel",o)}},[Xt]),M.useEffect(()=>(Qu?(window.addEventListener("mousemove",ep),window.addEventListener("mouseup",tp)):(window.removeEventListener("mousemove",ep),window.removeEventListener("mouseup",tp)),()=>{window.removeEventListener("mousemove",ep),window.removeEventListener("mouseup",tp)}),[Qu,ep,tp]);const Pn=M.useCallback((n,o)=>{var m;const l=(m=Xi.current)==null?void 0:m.getBoundingClientRect(),u=l?n-l.left:n,p=l?o-l.top:o;return{x:(u-Xt.x)/Xt.zoom,y:(p-Xt.y)/Xt.zoom}},[Xt]),Tz=n=>{var o;if((n.button===0||n.button===1)&&n.currentTarget.id==="canvas-bg"){const l=n.target;if(l&&(l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.tagName==="SELECT"||l.tagName==="BUTTON"||l.isContentEditable||l.closest('input, textarea, select, button, [contenteditable="true"]')))return;const u=window.getSelection();if(u&&u.toString().length>0&&u.removeAllRanges(),n.button===0&&(n.ctrlKey||n.metaKey)){n.preventDefault(),a0(!0),po.current=!0,Oc(!1);const p=(o=Xi.current)==null?void 0:o.getBoundingClientRect(),m=n.clientX-((p==null?void 0:p.left)||0),h=n.clientY-((p==null?void 0:p.top)||0);l0({startX:m,startY:h,endX:m,endY:h}),Hr(new Set),xe(null);return}po.current||(Oc(!0),Hl.current=!0,Uc(!1),Zc.current={x:n.clientX,y:n.clientY})}},np=M.useRef(null),xi=M.useRef(null),ea=M.useRef(null),nd=M.useCallback(()=>{if(ea.current){const l=ea.current,u=new Map(l.map(({nodeId:p})=>[p,!0]));f(p=>{if(p.length>50&&l.length>10){const m=new Map;p.forEach((b,v)=>{u.has(b.id)&&m.set(b.id,v)});const h=[...p];let x=!1;return l.forEach(({nodeId:b,updater:v})=>{const y=m.get(b);if(y!==void 0){const w=v(h[y]);w!==h[y]&&(h[y]=w,x=!0)}}),x?h:p}else{const m=[...p];let h=!1;return l.forEach(({nodeId:x,updater:b})=>{const v=m.findIndex(y=>y.id===x);if(v!==-1){const y=b(m[v]);y!==m[v]&&(m[v]=y,h=!0)}}),h?m:p}}),ea.current=null,xi.current=null;return}if(!np.current){xi.current=null;return}const{nodeId:n,updater:o}=np.current;f(l=>{const u=l.findIndex(h=>h.id===n);if(u===-1)return l;const p=o(l[u]);if(p===l[u])return l;const m=[...l];return m[u]=p,m}),np.current=null,xi.current=null},[]),D0=M.useCallback((n,o)=>{np.current={nodeId:n,updater:o},xi.current||(xi.current=requestAnimationFrame(nd))},[nd]),Tx=M.useCallback(n=>{if(ea.current&&xi.current){const o=ea.current,l=new Map;o.forEach(({nodeId:u,updater:p})=>{l.set(u,p)}),n.forEach(({nodeId:u,updater:p})=>{l.set(u,p)}),ea.current=Array.from(l.entries()).map(([u,p])=>({nodeId:u,updater:p}))}else ea.current=n;xi.current||(xi.current=requestAnimationFrame(nd))},[nd]);M.useEffect(()=>()=>{xi.current&&cancelAnimationFrame(xi.current),xo.current&&cancelAnimationFrame(xo.current)},[]);const rd=M.useRef(null),rp=M.useRef(null),Px=M.useCallback(n=>{var p;const{clientX:o,clientY:l}=n,u=Pn(o,l);if(Qs(u),Bo||po.current){Bo||a0(!0);const m=(p=Xi.current)==null?void 0:p.getBoundingClientRect(),h=o-((m==null?void 0:m.left)||0),x=l-((m==null?void 0:m.top)||0);l0(b=>b?{...b,endX:h,endY:x}:null),rp.current={endX:h,endY:x,rect:m},rd.current||(rd.current=requestAnimationFrame(()=>{if(!rp.current){rd.current=null;return}const{endX:b,endY:v,rect:y}=rp.current,w=$i;if(!w){rd.current=null;return}const j=Math.min(w.startX,b),R=Math.min(w.startY,v),C=Math.max(w.startX,b),H=Math.max(w.startY,v),B=Pn(j+((y==null?void 0:y.left)||0),R+((y==null?void 0:y.top)||0)),L=Pn(C+((y==null?void 0:y.left)||0),H+((y==null?void 0:y.top)||0)),Y=Us.current,J=new Set;Y.forEach(q=>{const Z=q.x+(q.width||260),oe=q.y+(q.height||200);q.x<L.x&&Z>B.x&&q.y<L.y&&oe>B.y&&J.add(q.id)}),Hr(J),rp.current=null,rd.current=null}));return}if((Nl||Hl.current)&&!po.current){Uc(!0);const m=o-Zc.current.x,h=l-Zc.current.y;if(Math.abs(m)<1&&Math.abs(h)<1)return;qi.current?(qi.current.dx+=m,qi.current.dy+=h):qi.current={dx:m,dy:h},xo.current||(xo.current=requestAnimationFrame(()=>{if(!qi.current){xo.current=null;return}const{dx:x,dy:b}=qi.current;zr(v=>{const y=Math.max(.2,Math.min(3,v.zoom)),w=y<.5||y>2.5?1e3:100;return{...v,zoom:y,x:Math.round((v.x+x)*w)/w,y:Math.round((v.y+b)*w)/w}}),qi.current=null,xo.current=null})),Zc.current={x:o,y:l};return}if(_l)D0(_l,m=>({...m,width:Math.max(250,u.x-m.x),height:Math.max(250,u.y-m.y)}));else if(As){const m=Math.max(.2,Math.min(3,Xt.zoom)),h=n.movementX/m,x=n.movementY/m,b=m<.5||m>2.5?.5:1;if(Math.abs(h)<b&&Math.abs(x)<b)return;const v=ni.current;if(v&&v.size>1&&v.has(As)){const y=Us.current,w=Math.max(.2,Math.min(3,Xt.zoom));(!Zo.current||Qc.current!==null&&Math.abs(Qc.current-w)>.01)&&(Zo.current={mouseX:o,mouseY:l,nodes:new Map(Array.from(v).map(H=>{const B=y.find(L=>L.id===H);return B?[H,{x:B.x,y:B.y}]:null}).filter(Boolean))}),Qc.current=w;const j=(o-Zo.current.mouseX)/w,R=(l-Zo.current.mouseY)/w,C=Array.from(Zo.current.nodes.entries()).map(([H,B])=>({nodeId:H,updater:L=>({...L,x:B.x+j,y:B.y+R})}));Tx(C)}else Zo.current=null,D0(As,y=>({...y,x:y.x+h,y:y.y+x}))}},[Nl,Bo,$i,As,_l,Pn,Xt.zoom,D0,Tx]),Ax=()=>{if(xo.current&&(cancelAnimationFrame(xo.current),xo.current=null),qi.current){const{dx:n,dy:o}=qi.current;zr(l=>{const u=Math.max(.2,Math.min(3,l.zoom)),p=u<.5||u>2.5?1e3:100;return{...l,zoom:u,x:Math.round((l.x+n)*p)/p,y:Math.round((l.y+o)*p)/p}}),qi.current=null}if(ea.current&&xi.current&&(cancelAnimationFrame(xi.current),nd()),Bo||po.current){if(a0(!1),po.current=!1,l0(null),Hn.size===1){const n=Array.from(Hn)[0];xe(n)}else Hn.size===0&&xe(null);Uc(!1),Oc(!1),Hl.current=!1,Zo.current=null,Qc.current=null;return}(Nl||Hl.current)&&(Oc(!1),Hl.current=!1,Uc(!1),!xr&&!Ln&&!As&&!_l&&(xe(null),Hr(new Set),El(n=>({...n,visible:!1})),wn(null),gi(n=>({...n,visible:!1})))),!xr&&!Ln&&(Fc(null),Mu(null),Zo.current=null,Qc.current=null),Uc(!1),po.current=!1,Zc.current={x:0,y:0}};M.useEffect(()=>{if(!(Nl||Hl.current||s0||As||_l||Bo||po.current||xr||Ln))return;const o=u=>{u.movementX===void 0&&(u.movementX=0),u.movementY===void 0&&(u.movementY=0),Px(u)},l=()=>{Ax()};return window.addEventListener("pointermove",o,{passive:!1}),window.addEventListener("pointerup",l,{passive:!1}),()=>{window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",l)}},[Nl,s0,As,_l,Bo,xr,Ln,Px,Ax]);const si=M.useCallback((n,o,l="default")=>{if(o.stopPropagation(),xr&&xr!==n)g.some(p=>p.from===xr&&p.to===n&&(p.inputType||"default")===l)||(l!=="default"&&z(p=>p.filter(m=>!(m.to===n&&(m.inputType||"default")===l))),z(p=>[...p,{id:`conn-${Date.now()}`,from:xr,to:n,inputType:l!=="default"?l:void 0}]));else if(Ln&&Ln!==n){const u=Ds||l;g.some(m=>m.from===n&&m.to===Ln&&(m.inputType||"default")===u)||(u!=="default"&&z(m=>m.filter(h=>!(h.to===Ln&&(h.inputType||"default")===u))),z(m=>[...m,{id:`conn-${Date.now()}`,from:n,to:Ln,inputType:u!=="default"?u:void 0}]))}Sl(null),Rs(null),Ls(null),Fo(null),Oc(!1),Fc(null),Mu(null)},[xr,Ln,Ds,g]),Pz=n=>{if(xr){const o=Pn(n.clientX,n.clientY);El({visible:!0,x:n.clientX,y:n.clientY,worldX:o.x,worldY:o.y,sourceNodeId:xr}),Ho(!1),Sl(null)}else if(Ln){const o=Pn(n.clientX,n.clientY);El({visible:!0,x:n.clientX,y:n.clientY,worldX:o.x,worldY:o.y,targetNodeId:Ln,inputType:Ds}),Ho(!1),Rs(null),Ls(null)}},Az=n=>{if(n.currentTarget.id==="canvas-bg"){const o=Pn(n.clientX,n.clientY);El({visible:!0,x:n.clientX,y:n.clientY,worldX:o.x,worldY:o.y,sourceNodeId:void 0}),Ho(!1)}},Rz=n=>{n.preventDefault(),n.stopPropagation(),(Hn.size>0||Ce)&&d0({visible:!0,x:n.clientX,y:n.clientY})},Rx=M.useMemo(()=>{const n=new Map;return g.forEach(o=>{var m,h;const l=o.inputType||"default";n.has(o.to)||n.set(o.to,new Map);const u=n.get(o.to);u.has(l)||u.set(l,[]);const p=At.get(o.from);if(p){let x=[];if(p.type==="video-input"){const b=p.selectedKeyframes&&p.selectedKeyframes.length>0?p.selectedKeyframes.map(v=>v.url):[];b.length>0?x=b:p.frames&&p.frames.length>0&&(x=[p.frames[0].url])}else if(p.type==="input-image"||p.type==="gen-image"||p.type==="preview")p.content&&x.push(p.content),p.previewMjImages&&x.push(...p.previewMjImages);else if(p.type==="storyboard-node"){const b=((m=p.settings)==null?void 0:m.shots)||[],v=((h=p.settings)==null?void 0:h.mode)||"video";b.forEach(y=>{if(y.outputEnabled)if(v==="image"){const w=y.selectedImageIndex??-1;w>=0&&y.output_images&&y.output_images.length>0&&y.output_images[w]&&x.push(y.output_images[w])}else y.output_url?x.push(y.output_url):y.image_url&&x.push(y.image_url)})}x.length>0&&u.get(l).push(...x)}}),n},[g,At,d,js]),Dx=M.useCallback((n,o="default")=>{const l=Rx.get(n);return l?l.get(o)||[]:[]},[Rx]),Lx=M.useMemo(()=>{const n=new Map;return g.forEach(o=>{var l,u,p;if(!n.has(o.to)){const m=At.get(o.from);if(m){if(m.type==="video-input")n.set(o.to,m);else if(m.type==="input-image"){const h={...m,type:"input-image-as-video",videoFileName:"",videoMeta:{duration:0},frames:m.content?[{time:0,url:m.content}]:[],selectedKeyframes:m.content?[{time:0,url:m.content}]:[],isImageInput:!0};n.set(o.to,h)}else if(m.type==="storyboard-node"){const h=((l=m.settings)==null?void 0:l.shots)||[],x=((u=m.settings)==null?void 0:u.mode)||"video",b=((p=m.settings)==null?void 0:p.projectTitle)||"",v=[];h.forEach((w,j)=>{if(!w.outputEnabled)return;let R=null,C=w.image_filename||`${j+1}`;if(x==="image"){const H=w.selectedImageIndex??-1;H>=0&&w.output_images&&w.output_images[H]&&(R=w.output_images[H])}else R=w.output_url||w.image_url;R&&v.push({time:j,url:R,filename:C})});const y={...m,type:"storyboard-as-video",videoFileName:b,videoMeta:{duration:h.length},frames:v,selectedKeyframes:v,isStoryboardInput:!0};n.set(o.to,y)}}}}),n},[g,At]),sd=M.useCallback(n=>Lx.get(n)||null,[Lx]),Dz=M.useCallback(n=>{for(const o of g)if(o.to===n){const l=At.get(o.from);if(l&&l.type==="video-analyze")return l}return null},[g,At]),id=M.useCallback(n=>{const o=[];return g.forEach(l=>{var u;if(l.to===n){const p=At.get(l.from);if(p&&p.type==="text-node"){const m=((u=p.settings)==null?void 0:u.text)||"";m&&o.push(m)}}}),o},[g,At]),Ox=M.useMemo(()=>{const n=new Map;return g.forEach(o=>{const l=o.inputType||"default",u=`${o.to}:${l}`;if(!n.has(u)){const p=At.get(o.from);if(p){let m=null;if(p.type==="video-input"){const h=p.selectedKeyframes&&p.selectedKeyframes.length>0?p.selectedKeyframes[0].url:null;h?m=h:p.frames&&p.frames[0]&&(m=p.frames[0].url)}else p.type==="input-image"&&p.content&&(m=p.content);m&&n.set(u,m)}}}),n},[g,At,d]),ta=M.useCallback((n,o)=>{const l=`${n}:${o||"default"}`;return Ox.get(l)||null},[Ox]),Ti=(n,o,l="image",u=null,p=null,m=null)=>{if(!o&&(!p||p.length===0))return;let h=u;if(!h){const b=Ba.get(n);h=b==null?void 0:b.sourceNodeId}if(!h){console.warn("[Tapnow] updatePreviewFromTask:  sourceNodeId for taskId:",n);return}setTimeout(()=>{var v;const b=At.get(h);if(b&&(b.type==="gen-image"||b.type==="gen-video")){const y=g.filter(w=>w.to===h);for(const w of y){const j=At.get(w.from),R=j&&j.type==="storyboard-node"?j:null;if(R&&((v=R.settings)!=null&&v.shots)){const C=R.settings.shots.find(H=>H.status==="generating");if(C){const H=o||(p&&p.length>0?p[0]:null);if(H){Kt(R.id,C.id,{image_url:H,image_filename:m||C.image_filename,status:"done"});break}}}}}},0);const x=qc.current;f(b=>{const v=x.filter(y=>y.from===h).map(y=>y.to);return v.length?b.map(y=>v.includes(y.id)&&y.type==="preview"?{...y,content:o||(p&&p.length>0?p[0]:o),previewType:l,previewMjImages:p,previewFilename:m||y.previewFilename||""}:y):b})},Ux=n=>{gt(o=>{const l=o.filter(u=>u.id!==n);try{localStorage.setItem("tapnow_history",JSON.stringify(l))}catch(u){console.error(":",u)}return l}),ks.item&&ks.item.id===n&&gi({visible:!1,x:0,y:0,item:null})},Lz=()=>{const n=`model-${Date.now()}`,o={id:n,displayName:n,modelName:n,type:"Image",ratioLimits:null,ratioNotes:{},ratioNotesEnabled:!1,resolutionLimits:null,resolutionNotes:{},resolutionNotesEnabled:!1,durations:null,durationNotes:{},durationNotesEnabled:!1,videoResolutions:null,videoResolutionNotes:{},videoResolutionNotesEnabled:!1,supportsFirstLastFrame:!1,supportsHD:!1,apiType:"openai",customParams:[],previewOverrideEnabled:!1,previewOverridePatch:null};de(l=>[...l,o]),m0(l=>{const u=new Set(l);return u.add(n),u}),Aa(l=>{const u=new Set(l);return u.add(n),u})},qr=M.useCallback((n,o)=>{const l=`${n}:${o}`;return!!ox[l]},[ox]),Kl=M.useCallback((n,o)=>{const l=`${n}:${o}`;pz(u=>({...u,[l]:!u[l]}))},[]),Oz=n=>{n&&de(o=>o.map(l=>{if(l.id!==n)return l;const u=Array.isArray(l.customParams)?[...l.customParams]:[];return u.length>=Td?(a(` ${Td} `,"warning",2e3),l):(u.push({id:`param-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,name:"",values:[],override:!1,notesEnabled:!1,valueNotes:{}}),{...l,customParams:u})}))},od=(n,o,l)=>{!n||!o||de(u=>u.map(p=>{if(p.id!==n)return p;const m=Array.isArray(p.customParams)?p.customParams.map(h=>h.id===o?{...h,...l}:h):[];return{...p,customParams:m}}))},Uz=(n,o)=>{!n||!o||de(l=>l.map(u=>{if(u.id!==n)return u;const p=Array.isArray(u.customParams)?u.customParams.filter(m=>m.id!==o):[];return{...u,customParams:p}}))},pr=(n,o)=>{n&&de(l=>l.map(u=>u.id===n?{...u,...o}:u))},Fz=n=>{n&&(de(o=>o.filter(l=>l.id!==n)),ve(o=>o.map(l=>l.libraryId===n?{...l,libraryId:null}:l)),m0(o=>{const l=new Set(o);return l.delete(n),l}),Aa(o=>{const l=new Set(o);return l.delete(n),l}),ix(o=>{const l=new Set(o);return l.delete(n),l}),Il(o=>{if(!o.has(n))return o;const l=new Set(o);return l.delete(n),l}),Ra(o=>{if(!o[n])return o;const{[n]:l,...u}=o;return u}))},Fx=M.useCallback((n,o)=>{n&&rx(l=>{const u=new Set(l);return o?u.add(n):u.delete(n),u})},[]),Bz=M.useCallback((n,o)=>{n&&(m0(l=>{const u=new Set(l);return o?u.add(n):u.delete(n),u}),o&&Aa(l=>{const u=new Set(l);return u.delete(n),u}))},[]),Hz=M.useCallback(n=>{n&&Aa(o=>{const l=new Set(o);return l.has(n)?l.delete(n):l.add(n),l})},[]),Wz=M.useCallback(n=>{n&&(ix(o=>{const l=new Set(o);return l.has(n)?l.delete(n):l.add(n),l}),Il(o=>{if(!o.has(n))return o;const l=new Set(o);return l.delete(n),l}),Ra(o=>{if(!o[n])return o;const{[n]:l,...u}=o;return u}))},[]),sp=(n,o)=>ve(l=>l.map(u=>u._uid===n?{...u,...o}:u)),Vz=n=>{ve(o=>o.filter(l=>l._uid!==n)),rx(o=>{const l=new Set(o);return l.delete(n),l})},Kz=async n=>{const o=Ht(n),l=(o==null?void 0:o._uid)||n;w0(l),Xc(m=>({...m,[l]:"idle"}));const{key:u,url:p}=ri(n);if(!u){Xc(m=>({...m,[l]:"error"})),w0(null);return}try{(await fetch(`${p}/v1/models`,{method:"GET",headers:{Authorization:`Bearer ${u}`}})).ok?Xc(h=>({...h,[l]:"success"})):Xc(h=>({...h,[l]:"error"}))}catch{Xc(m=>({...m,[l]:"error"}))}w0(null)},Pi=n=>{if(!n)return"bg-zinc-600";const o=z0[n];if(o==="success")return"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.8)]";if(o==="error")return"bg-red-500";const{key:l}=ri(n);return l?"bg-zinc-400":"bg-zinc-700"},Yl=M.useMemo(()=>qs.find(n=>n.id===Oo)||qs[0],[qs,Oo]),Yz=()=>{var n;(n=kx.current)==null||n.scrollIntoView({behavior:"smooth"})};M.useEffect(()=>{Yz()},[Yl==null?void 0:Yl.messages,Dc]);const Jz=()=>{const n=`chat-${Date.now()}`,o={id:n,title:"",messages:[]};Ta(l=>[o,...l]),Rc(n)},Gz=(n,o)=>{n.stopPropagation();const l=qs.filter(u=>u.id!==o);l.length===0?(Ta([{id:"default",title:"",messages:[]}]),Rc("default")):(Ta(l),Oo===o&&Rc(l[0].id))},Bx=M.useCallback(n=>{Array.from(n||[]).forEach(l=>{const u=new FileReader;u.onload=p=>{var C;const m=p.target.result,h=((C=l.name.split(".").pop())==null?void 0:C.toLowerCase())||"",x=l.type.startsWith("image/"),b=l.type.startsWith("video/"),v=l.type.startsWith("audio/"),y=l.type==="application/pdf"||h==="pdf",w=["doc","docx"].includes(h)||l.type.includes("word"),j=["xls","xlsx"].includes(h)||l.type.includes("excel")||l.type.includes("spreadsheet"),R=["js","jsx","ts","tsx","py","java","cpp","c","html","css","json","xml","yaml","yml","md","txt","sh","bash"].includes(h);Ii(H=>[...H,{name:l.name,type:l.type,content:m,isImage:x,isVideo:b,isAudio:v,isPDF:y,isDoc:w,isExcel:j,isCode:R,fileExt:h}])},l.type.startsWith("image/")||l.type.startsWith("video/")||l.type.startsWith("audio/")||l.type==="application/pdf"?u.readAsDataURL(l):l.name.match(/\.(txt|md|js|jsx|ts|tsx|py|html|css|json|csv|xml|yaml|yml|sh|bash|java|cpp|c)$/i)?u.readAsText(l):u.readAsDataURL(l)})},[Ii]),Xz=n=>{Bx(n.target.files),n.target.value=""},Zz=n=>{Ii(o=>o.filter((l,u)=>u!==n))},qz=n=>{if(!n||typeof n!="string")return[];const o=new Set;return(n.match(/!\[[^\]]*]\(([^)]+)\)/g)||[]).forEach(m=>{const h=m.match(/\(([^)]+)\)/);h!=null&&h[1]&&o.add(h[1].trim())}),(n.match(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g)||[]).forEach(m=>o.add(m)),(n.match(/https?:\/\/[^\s)]+/g)||[]).forEach(m=>{const h=m.replace(/[),.]+$/,"");h.match(/\.(png|jpg|jpeg|webp|gif|bmp|svg)(\?|#|$)/i)&&o.add(h)}),Array.from(o)},Hx=(n,o)=>{var h,x,b,v,y,w,j;const l=new Set,u=(R,C="image/png")=>{if(R){if(typeof R=="string"){const H=R.trim();if(!H)return;if(H.startsWith("data:image/")){l.add(H);return}if(H.startsWith("http://")||H.startsWith("https://")){l.add(H);return}/^[A-Za-z0-9+/=]+$/.test(H)&&H.length>64&&l.add(`data:${C};base64,${H}`);return}if(typeof R=="object"){const H=R.url||R.image_url||R.imageUrl||R.file_uri||R.fileUri||R.uri;if(H){l.add(H);return}const B=R.data||R.base64||R.b64;if(B){const L=R.mime_type||R.mimeType||C;l.add(`data:${L};base64,${B}`)}}}};return[(x=(h=n==null?void 0:n.choices)==null?void 0:h[0])==null?void 0:x.message,(y=(v=(b=n==null?void 0:n.data)==null?void 0:b.choices)==null?void 0:v[0])==null?void 0:y.message].forEach(R=>{if(!R)return;const C=R.content;Array.isArray(C)&&C.forEach(H=>{var B;if(H&&(H.type==="image_url"&&u(((B=H.image_url)==null?void 0:B.url)||H.image_url||H.imageUrl),H.type==="image"&&u(H.image||H.image_url||H.imageUrl),H.inline_data||H.inlineData)){const L=H.inline_data||H.inlineData;L!=null&&L.data&&u(L.data,L.mime_type||L.mimeType||"image/png")}})}),[n==null?void 0:n.images,n==null?void 0:n.output_images,(w=n==null?void 0:n.data)==null?void 0:w.output_images,(j=n==null?void 0:n.data)==null?void 0:j.images].forEach(R=>{Array.isArray(R)&&R.forEach(C=>u((C==null?void 0:C.url)||(C==null?void 0:C.image_url)||(C==null?void 0:C.imageUrl)||C))}),qz(o).forEach(R=>l.add(R)),Array.from(l)},Wx=async()=>{var R,C,H,B,L,Y,J,q,Z,oe;if(!kl.trim()&&jl.length===0||Eu)return;const n=Ht(Ps),{key:o,url:l,modelName:u}=ri(Ps);if(!o){alert(" API  Key"),ei(!0);return}const p=Oo||((R=qs[0])==null?void 0:R.id),m=qs.find(te=>te.id===p)||qs[0],h=(m==null?void 0:m.messages)||[];m&&m.id!==Oo&&Rc(m.id),Kg(!0);const x={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:"user",content:kl,files:[...jl],timestamp:Date.now(),modelId:Ps};Ta(te=>te.map(ee=>ee.id===p?{...ee,messages:[...ee.messages,x],title:ee.messages.length===0?kl.slice(0,20):ee.title}:ee)),Hg(""),Ii([]);const b=[...h,x],v=20,y=b.length>v?b.slice(-v):b;let w=[{role:"system",content:"AI"},...y.map(te=>({role:te.role,content:te.content}))];const j=[];x.content&&j.push({type:"text",text:x.content}),x.files.forEach(te=>{const ee=((n==null?void 0:n.modelName)??"").toLowerCase().includes("gemini");te.isImage?j.push({type:"image_url",image_url:{url:te.content}}):te.isVideo?ee?j.push({type:"image_url",image_url:{url:te.content}}):j.push({type:"text",text:`
[User attached video: ${te.name}]
`}):te.isAudio?j.push({type:"text",text:`
[User attached audio: ${te.name}]
`}):te.isPDF||te.isDoc||te.isExcel?j.push({type:"text",text:`
[User attached document: ${te.name} (${te.isPDF?"PDF":te.isDoc?"Word":"Excel"})]
`}):te.isCode||te.content&&typeof te.content=="string"&&te.content.length<5e4?j.push({type:"text",text:`
[File: ${te.name}]
\`\`\`${te.fileExt||"text"}
${te.content}
\`\`\`
`}):j.push({type:"text",text:`
[User attached file: ${te.name}]
`})}),w.push({role:"user",content:j});try{const te=await fetch(`${l}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({model:u||Ps,messages:w,stream:!1})});if(!te.ok){const Ee=await te.text();throw new Error(Ee||`API Error: ${te.status}`)}const ee=await te.json();let ce=null;const W=((H=(C=ee==null?void 0:ee.choices)==null?void 0:C[0])==null?void 0:H.message)||((Y=(L=(B=ee==null?void 0:ee.data)==null?void 0:B.choices)==null?void 0:L[0])==null?void 0:Y.message);(W==null?void 0:W.content)!==void 0?Array.isArray(W.content)?ce=W.content.map(Ee=>typeof(Ee==null?void 0:Ee.text)=="string"?Ee.text:"").filter(Boolean).join(`
`):ce=W.content:ee.content?ce=ee.content:ee.text?ce=ee.text:ee.message?ce=typeof ee.message=="string"?ee.message:ee.message.content:ee.result?ce=typeof ee.result=="string"?ee.result:ee.result.content:(J=ee.data)!=null&&J.content?ce=ee.data.content:(q=ee.data)!=null&&q.text?ce=ee.data.text:(Z=ee.data)!=null&&Z.message?ce=typeof ee.data.message=="string"?ee.data.message:ee.data.message.content:(oe=ee.data)!=null&&oe.result&&(ce=typeof ee.data.result=="string"?ee.data.result:ee.data.result.content),ce&&typeof ce!="string"&&(ce=JSON.stringify(ce)),(!ce||ce.trim()==="")&&(console.error("[] API :",ee),ce="No response");const Se={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:"assistant",content:ce,timestamp:Date.now(),modelId:Ps};Ta(Ee=>Ee.map(Be=>Be.id===Oo?{...Be,messages:[...Be.messages,Se]}:Be));const ze=Hx(ee,ce);if(ze.length>0){const Ee=Date.now(),Be=ze[0],nt=(n==null?void 0:n.displayName)||u||Ps;gt(st=>[{id:`chat-${Ee}-${Math.random().toString(36).slice(2,8)}`,type:"image",url:Be,prompt:x.content||"Chat Image",time:new Date(Ee).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"completed",progress:100,modelName:nt,apiConfig:{modelId:Ps,baseUrl:l,apiKey:o},provider:n==null?void 0:n.provider,startTime:Ee,durationMs:0,output_images:ze,mjImages:ze.length>1?ze:null,selectedMjImageIndex:0},...st])}}catch(te){console.error("Chat Error",te);const ee={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:"assistant",content:`Error: ${te.message}`,isError:!0,timestamp:Date.now()};Ta(ce=>ce.map(W=>W.id===Oo?{...W,messages:[...W.messages,ee]}:W))}finally{Kg(!1)}},Vx=async(n,o=2048,l=8)=>new Promise((u,p)=>{const m=new Image;m.crossOrigin="anonymous",m.onload=()=>{var B,L;const h=m.width,x=m.height;let b=h,v=x;if(h>o||x>o){const Y=o/Math.max(h,x);b=Math.floor(h*Y),v=Math.floor(x*Y)}const y=document.createElement("canvas");y.width=b,y.height=v;const w=y.getContext("2d");w.imageSmoothingEnabled=!0,w.imageSmoothingQuality="high",w.drawImage(m,0,0,b,v);let j=.92,R=y.toDataURL("image/jpeg",j);(((B=R.split(",")[1])==null?void 0:B.length)||0)*3/4/(1024*1024)>l&&(j=.75,R=y.toDataURL("image/jpeg",j),(L=R.split(",")[1])!=null&&L.length),u(R)},m.onerror=h=>{console.error("Midjourney: ",h),u(n)},m.src=n}),Qz=async(n,o,l)=>{try{const p=(await Promise.all(n.map(async(y,w)=>{if(y.startsWith("data:"))try{return await Vx(y,2048,8)}catch(j){return console.error(`Midjourney: [${w}]`,j),y}else try{const j=Gi(y,!1),R=await Os(y,{useProxy:j}),C=await Fl(R);return await Vx(C,2048,8)}catch(j){throw console.error(`Midjourney: [${w}]URL`,j),j}}))).map((y,w)=>{let j=y;if(typeof j!="string")throw new Error(`base64[${w}]`);j.includes(",")?j=j.split(",")[1]:j.startsWith("data:")&&(j=j.replace(/^data:[^;]*;base64,?/i,""));const R=j.length;j=j.replace(/[^A-Za-z0-9+/=]/g,"");const C=j.length;if(!j||j.length<100)throw new Error(`base64[${w}]: ${(j==null?void 0:j.length)||0}`);const H=/^[A-Za-z0-9+/]+={0,2}$/;if(!H.test(j))throw console.error(`Midjourney: base64[${w}]: ${j.length}, 50: ${j.substring(0,50)}`),new Error(`invalid_base64_format: base64[${w}]`);const B=j.length%4;if(B!==0&&(j=j.replace(/=+$/,""),j+="=".repeat(4-B),!H.test(j)))throw console.error(`Midjourney: base64[${w}]: ${j.length}`),new Error(`invalid_base64_format: base64[${w}]`);try{const Y=atob(j);if(!Y||Y.length===0)throw new Error("base64")}catch(Y){throw console.error(`Midjourney: base64[${w}]:`,Y),new Error(`invalid_base64_format: base64[${w}]`)}return`data:image/jpeg;base64,${j}`}),m=`${o}/mj/submit/upload-discord-images`;p.forEach((y,w)=>{if(!y||typeof y!="string")throw new Error(`base64[${w}]`);if(!y.startsWith("data:image/"))throw new Error(`base64[${w}]data URL`);let j="";if(y.includes(","))j=y.split(",")[1];else throw new Error(`base64[${w}]data URL`);if(!j||j.length<100)throw new Error(`base64[${w}]`);if(!/^[A-Za-z0-9+/]+={0,2}$/.test(j))throw console.error(`Midjourney: base64[${w}]`),new Error(`base64[${w}]`);if(j.length%4!==0)throw new Error(`base64[${w}]4: ${j.length}`);try{atob(j)}catch(C){throw new Error(`base64[${w}]: ${C.message}`)}});const x=JSON.stringify({base64Array:p}),b=await fetch(m,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:x});if(!b.ok){let y="";try{y=await b.text();try{const w=JSON.parse(y);throw new Error(`: ${b.status} - ${w.description||w.message||y}`)}catch{throw new Error(`: ${b.status} - ${y}`)}}catch(w){throw new Error(`: ${b.status} - ${w.message||y}`)}}const v=await b.json();if(v.code===1&&v.result&&Array.isArray(v.result))return v.result;{const y=v.description||v.message||"";throw console.error("Midjourney: :",v),new Error(y)}}catch(u){throw console.error("Midjourney: :",u),u}},L0=async(n,o=1920,l=1920)=>new Promise((u,p)=>{const m=new Image;m.crossOrigin="anonymous",m.onload=()=>{const h=m.width,x=m.height;if(h<=o&&x<=l){n.startsWith("data:")?u(n):yr(n).then(R=>{u(`data:image/png;base64,${R}`)}).catch(p);return}let b=h,v=x;if(h>o||x>l){const R=Math.min(o/h,l/x);b=Math.round(h*R),v=Math.round(x*R),b=b%2===0?b:b-1,v=v%2===0?v:v-1}const y=document.createElement("canvas");y.width=b,y.height=v;const w=y.getContext("2d");w.imageSmoothingEnabled=!0,w.imageSmoothingQuality="high",w.drawImage(m,0,0,b,v);const j=y.toDataURL("image/png",.95);u(j)},m.onerror=h=>{console.error("Veo: ",h),p(new Error(""))},n.startsWith("data:")||n.startsWith("blob:")?m.src=n:Os(n).then(h=>{const x=URL.createObjectURL(h);m.src=x}).catch(p)}),O0=M.useCallback(n=>{z(o=>o.filter(u=>u.id!==n))},[]),na=(n,o)=>n?o==="video"&&!Qt(n)?n+(n.includes("?")?"&":"?")+"force_video_display=true":n:"",ra=n=>{const o=n.dataTransfer.getData("application/x-tapnow-history");if(!o)return null;try{return JSON.parse(o)}catch(l){return console.warn("[Drag] Failed to parse history payload",l),null}},sa=n=>{const l=(n.dataTransfer.getData("text/uri-list")||"").split(`
`).find(m=>m&&!m.startsWith("#"))||"",u=n.dataTransfer.getData("text/plain")||"",p=(l||u).trim();return p&&/^(https?:|data:image\/|data:video\/|blob:|file:)/i.test(p)?p:""},ek=async(n,o)=>{o.preventDefault(),o.stopPropagation(),o.currentTarget.classList.remove("drag-over");const l=ra(o);if(l){const h=na(l.url||l.originalUrl||l.mjOriginalUrl||"",l.type);if(h){const x=l.type==="video"||Qt(h);let b=null;if(!x)try{b=await Fr(h)}catch{}ae(),f(v=>v.map(y=>y.id===n?{...y,content:h,dimensions:x?null:b}:y));return}}const u=sa(o);if(u){const h=Qt(u);let x=null;if(!h)try{x=await Fr(u)}catch{}ae(),f(b=>b.map(v=>v.id===n?{...v,content:u,dimensions:h?null:x}:v));return}const m=Array.from(o.dataTransfer.files).filter(h=>h.type.startsWith("image/"));if(m.length>0){const h=m[0],x=new FileReader;x.onload=async b=>{const v=b.target.result;let y={w:0,h:0};try{y=await Fr(v)}catch{}ae(),f(w=>w.map(j=>j.id===n?{...j,content:v,dimensions:y}:j))},x.readAsDataURL(h)}},Kx=M.useCallback(async(n,o)=>{var m;const l=At.get(n);if(!l)return;const u=Array.from(o||[]).filter(h=>h.type.startsWith("image/"));if(u.length===0)return;const p=await Promise.all(u.map(h=>new Promise(x=>{const b=new FileReader;b.onloadend=()=>x(b.result),b.readAsDataURL(h)})));Le(n,{referenceImages:[...((m=l.settings)==null?void 0:m.referenceImages)||[],...p]})},[At,Le]),tk=(n,o)=>{var l,u;o.preventDefault(),o.stopPropagation(),o.currentTarget.classList.remove("drag-over"),(u=(l=o.dataTransfer)==null?void 0:l.files)!=null&&u.length&&Kx(n,o.dataTransfer.files)},Yx=(n,o)=>{const l=o.target.files;l&&l.length>0&&Kx(n,l),o.target.value=""},U0=n=>{n.preventDefault(),n.stopPropagation(),n.currentTarget.classList.add("drag-over")},F0=n=>{n.preventDefault(),n.stopPropagation(),n.currentTarget.classList.remove("drag-over")},nk=(n,o)=>{o.preventDefault(),o.stopPropagation();const l=ra(o);let u="",p=null,m="image";if(l){if(u=na(l.url||l.originalUrl||l.mjOriginalUrl||"",l.type),l.mjImages&&l.mjImages.length>1){p=l.mjImages;const h=l.selectedIndex??0;u=l.mjImages[h]||l.mjImages[0]||u}(l.type==="video"||Qt(u))&&(m="video")}if(!u){const h=sa(o);h&&(u=h,m=Qt(h)?"video":"image")}u&&f(h=>h.map(x=>x.id===n?{...x,content:u,previewType:m,previewMjImages:p}:x))},Ha=n=>{n.preventDefault(),n.stopPropagation()},rk=async n=>{if(n.preventDefault(),n.stopPropagation(),n.currentTarget.id!=="canvas-bg")return;const o=ra(n);let l="",u=!1;if(o&&(l=na(o.url||o.originalUrl||o.mjOriginalUrl||"",o.type),u=o.type==="video"||Qt(l)),!l){const h=sa(n);h&&(l=h,u=Qt(h))}if(!l)return;const p=Pn(n.clientX,n.clientY);if(u){Ur("video-input",p.x,p.y,null,l);return}let m;try{const h=await Fr(l);h!=null&&h.w&&(h!=null&&h.h)&&(m={w:h.w,h:h.h})}catch{}Ur("input-image",p.x,p.y,null,l,m)},sk=n=>{var u,p;n.preventDefault(),n.stopPropagation();const o=ra(n);if(o){const m=na(Vn(o,o.url||o.originalUrl||o.mjOriginalUrl||null),o.type);if(m){const h=o.type==="video"||Qt(m),x=!h,b=x?"png":"mp4",v=x?"image/png":"video/mp4";Ii(y=>[...y,{name:`Generated-${o.itemId||Date.now()}.${b}`,type:v,content:m,isImage:x,isVideo:h,isAudio:!1,fromHistory:!0,fileExt:b}]),Yi(!0)}return}const l=sa(n);if(l){const m=Qt(l),h=!m,x=h?"png":"mp4",b=h?"image/png":"video/mp4";Ii(v=>[...v,{name:`Dropped-${Date.now()}.${x}`,type:b,content:l,isImage:h,isVideo:m,isAudio:!1,fromHistory:!1,fileExt:x}]),Yi(!0);return}(p=(u=n.dataTransfer)==null?void 0:u.files)!=null&&p.length&&(Bx(n.dataTransfer.files),Yi(!0))};M.useEffect(()=>{const n=async u=>{const p=u.target;if(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable){const v=window.getSelection();if(v&&v.toString().trim())return;u.preventDefault();return}const h=Zi.current,x=ni.current,b=h?[h]:x&&x.size>0?Array.from(x):[];if(b.length>0){u.preventDefault(),u.stopPropagation();const v=Us.current.filter(j=>b.includes(j.id)),w=qc.current.filter(j=>b.includes(j.from)||b.includes(j.to)).filter(j=>b.includes(j.from)&&b.includes(j.to));go.current={nodes:v.map(j=>({...j})),connections:w.map(j=>({...j})),timestamp:Date.now()}}},o=async u=>{const p=u.target;if(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable)return;const h=Zi.current;let x=null;if(h&&(x=Us.current.find(b=>b.id===h)),x&&(x.type==="input-image"||x.type==="video-input")){const b=Array.from(u.clipboardData.items),v=b.find(w=>w.type.startsWith("image/")),y=b.find(w=>w.type.startsWith("video/"));if(v&&x.type==="input-image"){u.preventDefault();const w=v.getAsFile();if(w){const j=new FileReader;j.onload=async R=>{const C=R.target.result;let H={w:0,h:0};try{H=await Fr(C)}catch{}ae(),f(B=>B.map(L=>L.id===x.id?{...L,content:C,dimensions:H}:L))},j.readAsDataURL(w)}return}else if(y&&x.type==="video-input"){u.preventDefault();const w=y.getAsFile();w&&Wl(x.id,w);return}}if(go.current&&go.current.nodes&&go.current.nodes.length>0){u.preventDefault(),u.stopPropagation();const b=go.current,v=Xi.current;let y=0,w=0;if(v){const ce=v.getBoundingClientRect(),W=(ce.left+ce.width/2-Xt.x)/Xt.zoom,Se=(ce.top+ce.height/2-Xt.y)/Xt.zoom;y=W,w=Se}const j=b.nodes;if(j.length===0)return;const R=Math.min(...j.map(ce=>ce.x||0)),C=Math.min(...j.map(ce=>ce.y||0)),H=Math.max(...j.map(ce=>(ce.x||0)+(ce.width||0))),B=Math.max(...j.map(ce=>(ce.y||0)+(ce.height||0))),L=(R+H)/2,Y=(C+B)/2,J=y-L,q=w-Y,Z=new Map,oe=Date.now();b.nodes.forEach((ce,W)=>{const Se=`node-${oe}-${W}-${Math.random().toString(36).substr(2,9)}`;Z.set(ce.id,Se)});const te=b.nodes.map(ce=>({...ce,id:Z.get(ce.id),x:ce.x+J,y:ce.y+q})),ee=(b.connections||[]).filter(ce=>ce&&Z.has(ce.from)&&Z.has(ce.to)).map((ce,W)=>({...ce,id:`conn-${oe}-${W}-${Math.random().toString(36).substr(2,9)}`,from:Z.get(ce.from),to:Z.get(ce.to)}));ae(),f(ce=>[...ce,...te]),z(ce=>[...ce,...ee]),te.length===1?(xe(te[0].id),Hr(new Set([te[0].id]))):te.length>1&&(xe(null),Hr(new Set(te.map(ce=>ce.id))))}},l=u=>{const p=u.target;if(!(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable)&&(u.ctrlKey||u.metaKey)&&u.key==="v"){const h=Zi.current;if(h){const x=Us.current.find(b=>b.id===h);if(x&&(x.type==="input-image"||x.type==="video-input"))return}if(go.current&&go.current.nodes&&go.current.nodes.length>0){u.preventDefault(),u.stopPropagation();const x=go.current,b=Xi.current;let v=0,y=0;if(b){const ee=b.getBoundingClientRect(),ce=(ee.left+ee.width/2-Xt.x)/Xt.zoom,W=(ee.top+ee.height/2-Xt.y)/Xt.zoom;v=ce,y=W}const w=x.nodes;if(w.length===0)return;const j=Math.min(...w.map(ee=>ee.x||0)),R=Math.min(...w.map(ee=>ee.y||0)),C=Math.max(...w.map(ee=>(ee.x||0)+(ee.width||0))),H=Math.max(...w.map(ee=>(ee.y||0)+(ee.height||0))),B=(j+C)/2,L=(R+H)/2,Y=v-B,J=y-L,q=new Map,Z=Date.now();x.nodes.forEach((ee,ce)=>{const W=`node-${Z}-${ce}-${Math.random().toString(36).substr(2,9)}`;q.set(ee.id,W)});const oe=x.nodes.map(ee=>({...ee,id:q.get(ee.id),x:ee.x+Y,y:ee.y+J})),te=(x.connections||[]).filter(ee=>ee&&q.has(ee.from)&&q.has(ee.to)).map((ee,ce)=>({...ee,id:`conn-${Z}-${ce}-${Math.random().toString(36).substr(2,9)}`,from:q.get(ee.from),to:q.get(ee.to)}));ae(),f(ee=>[...ee,...oe]),z(ee=>[...ee,...te]),oe.length===1?(xe(oe[0].id),Hr(new Set([oe[0].id]))):oe.length>1&&(xe(null),Hr(new Set(oe.map(ee=>ee.id))))}}};return window.addEventListener("copy",n),window.addEventListener("paste",o),window.addEventListener("keydown",l),()=>{window.removeEventListener("copy",n),window.removeEventListener("paste",o),window.removeEventListener("keydown",l)}},[Le,Wl,f,z,xe,Hr,Xt]);const ia=async(n,o,l,u,p,m,h=0)=>{if(h>90){gt(y=>y.map(w=>w.id===o?{...w,status:"failed",errorMsg:"Veo "}:w));const v=tr.current.get(o);v&&(Kt(v.nodeId,v.shotId,{status:"draft"}),tr.current.delete(o));return}fetch(`${l}/v2/videos/generations/${n}`,{method:"GET",headers:{Authorization:`Bearer ${u}`}}).then(async v=>{var B,L,Y,J,q,Z,oe,te;const y=await v.text();let w;try{w=JSON.parse(y)}catch{setTimeout(()=>ia(n,o,l,u,p,m,h+1),4e3);return}const j=((B=w==null?void 0:w.data)==null?void 0:B.status)||(w==null?void 0:w.status)||((L=w==null?void 0:w.data)==null?void 0:L.task_status),R=((Y=w==null?void 0:w.data)==null?void 0:Y.progress)||(w==null?void 0:w.progress)||"0%",C=((J=w==null?void 0:w.data)==null?void 0:J.fail_reason)||(w==null?void 0:w.fail_reason)||"";if(j==="SUCCESS"||j==="succeeded"||j==="FINISHED"||j==="completed"){const ee=((q=w==null?void 0:w.data)==null?void 0:q.output)||(w==null?void 0:w.output)||((Z=w==null?void 0:w.data)==null?void 0:Z.video_url)||(w==null?void 0:w.video_url)||((te=(oe=w==null?void 0:w.data)==null?void 0:oe.data)==null?void 0:te.output);if(!ee){console.warn("[Tapnow] Veo: URL",w),gt(W=>W.map(Se=>Se.id===o?{...Se,status:"failed",errorMsg:"URL"}:Se));return}const ce=Date.now();gt(W=>{const Se=W.find(ht=>ht.id===o),ze=Se==null?void 0:Se.sourceNodeId,Ee=Se==null?void 0:Se.ratio,Be=ce-((Se==null?void 0:Se.startTime)||ce);let nt=p,st=m;return(async()=>{try{const ht=await nc(ee);if(ht&&ht.w>0&&ht.h>0){const Yt=ht.w,Wt=ht.h;if(Ee==="16:9"){const Ft=Yt/Wt,dn=16/9;Math.abs(Ft-dn)>.1?(console.warn(`[Tapnow] Veo:  ${Ft.toFixed(2)}  16:9 (${dn.toFixed(2)})`),console.warn(`[Tapnow] Veo: : ${Yt}x${Wt}, : 16:9`),console.warn(`[Tapnow] Veo:  16:9 : ${p}x${Math.round(p/(16/9))}`),nt=p,st=Math.round(p/(16/9))):(nt=Yt,st=Wt)}else if(Ee==="9:16"){const Ft=Yt/Wt,dn=9/16;Math.abs(Ft-dn)>.1?(console.warn(`[Tapnow] Veo:  ${Ft.toFixed(2)}  9:16 (${dn.toFixed(2)})`),console.warn(`[Tapnow] Veo: : ${Yt}x${Wt}, : 9:16`),console.warn(`[Tapnow] Veo:  9:16 : ${Math.round(m*(9/16))}x${m}`),nt=Math.round(m*(9/16)),st=m):(nt=Yt,st=Wt)}else nt=Yt,st=Wt;gt(Ft=>Ft.map(dn=>dn.id===o?{...dn,status:"completed",progress:100,url:ee,width:nt,height:st,durationMs:Be,ratio:Ee||dn.ratio}:dn));const Jt=tr.current.get(o);Jt?(Kt(Jt.nodeId,Jt.shotId,{video_url:ee,status:"done",durationCost:Be/1e3}),tr.current.delete(o)):ze&&setTimeout(()=>{Ti(o,ee,"video",ze)},0)}}catch(ht){console.warn("[Tapnow] Veo: ",ht);let Yt=p,Wt=m;if(Ee==="16:9"){const Ft=Yt/Wt;Math.abs(Ft-16/9)>.1&&(Wt=Math.round(Yt/(16/9)))}else if(Ee==="9:16"){const Ft=Yt/Wt;Math.abs(Ft-9/16)>.1&&(Yt=Math.round(Wt*(9/16)))}gt(Ft=>Ft.map(dn=>dn.id===o?{...dn,status:"completed",progress:100,url:ee,width:Yt,height:Wt,durationMs:Be,ratio:Ee||dn.ratio}:dn));const Jt=tr.current.get(o);Jt?(Kt(Jt.nodeId,Jt.shotId,{video_url:ee,status:"done",durationCost:Be/1e3}),tr.current.delete(o)):ze&&setTimeout(()=>{Ti(o,ee,"video",ze)},0)}})(),W});return}if(j==="FAILED"||j==="ERROR"||j==="CANCELLED"){let ee=`: ${j}`;if(C)try{const W=typeof C=="string"?JSON.parse(C):C;ee=(W==null?void 0:W.message)||(W==null?void 0:W.code)||C}catch{ee=C||ee}console.error("[Tapnow] Veo: ",{status:j,failReason:C,errorMsg:ee}),gt(W=>W.map(Se=>Se.id===o?{...Se,status:"failed",errorMsg:ee}:Se));const ce=tr.current.get(o);if(ce){const W=Ba.get(o),Se=W?Date.now()-W.startTime:0;Kt(ce.nodeId,ce.shotId,{status:"failed",errorMsg:ee,durationCost:Se/1e3}),tr.current.delete(o)}return}if(j==="NOT_START"||j==="PENDING"||j==="QUEUED"){const ee=parseInt(R)||0;gt(ce=>ce.map(W=>W.id===o?{...W,status:"generating",progress:Math.max(5,ee),errorMsg:j==="NOT_START"?"...":void 0}:W)),setTimeout(()=>ia(n,o,l,u,p,m,h+1),4e3);return}const H=parseInt(R)||Math.min(95,h*2+10);gt(ee=>ee.map(ce=>ce.id===o?{...ce,status:"generating",progress:H}:ce)),setTimeout(()=>ia(n,o,l,u,p,m,h+1),4e3)}).catch(v=>setTimeout(()=>ia(n,o,l,u,p,m,h+1),4e3))},Wa=(n,o,l,u,p,m,h="",x=0)=>{if(!n||n==="null"||n==="undefined"){console.error(`[Poll Error] Invalid JobId: ${n} for task ${o}`),gt(w=>w.map(j=>j.id===o?{...j,status:"failed",errorMsg:"Task failed: No Job ID returned",durationMs:Date.now()-(j.startTime||Date.now())}:j));return}const b=h==="sora-2-pro"?360:80,v=5e3;if(x>b){gt(j=>j.map(R=>R.id===o?{...R,status:"failed",errorMsg:"Sora "}:R));const w=tr.current.get(o);w&&(Kt(w.nodeId,w.shotId,{status:"draft"}),tr.current.delete(o));return}const y=h!=null&&h.includes("grok")?`${l}/v2/videos/generations/${encodeURIComponent(n)}`:`${l}/v1/videos/${encodeURIComponent(n)}`;fetch(y,{method:"GET",headers:{Authorization:`Bearer ${u}`}}).then(w=>{if(!w.ok)throw new Error(`HTTP ${w.status}: ${w.statusText}`);return w.text()}).then(w=>{var C,H,B,L,Y;let j;try{j=JSON.parse(w)}catch(J){console.error("[Tapnow] Sora/Grok Poll JSON :",J,w),setTimeout(()=>Wa(n,o,l,u,p,m,h,x+1),v);return}const R=((C=j==null?void 0:j.data)==null?void 0:C.status)||(j==null?void 0:j.status)||((H=j==null?void 0:j.data)==null?void 0:H.task_status)||(j==null?void 0:j.task_status);if(R==="SUCCESS"||R==="succeeded"||R==="FINISHED"||R==="completed"){const J=((B=j==null?void 0:j.data)==null?void 0:B.output)||(j==null?void 0:j.output)||((L=j==null?void 0:j.data)==null?void 0:L.video_url)||((Y=j==null?void 0:j.data)==null?void 0:Y.url)||(j==null?void 0:j.video_url)||(j==null?void 0:j.url);if(!J){gt(te=>te.map(ee=>ee.id===o?{...ee,status:"failed",errorMsg:"URL"}:ee));return}const q=Date.now(),Z=Ba.get(o);Z==null||Z.sourceNodeId;const oe=q-((Z==null?void 0:Z.startTime)||q);gt(te=>{const ee=te.map(W=>W.id===o?{...W,status:"completed",progress:100,url:J,width:p,height:m,durationMs:oe}:W),ce=tr.current.get(o);if(ce)Kt(ce.nodeId,ce.shotId,{video_url:J,status:"done",durationCost:oe/1e3}),tr.current.delete(o);else{const W=ee.find(Se=>Se.id===o);W!=null&&W.sourceNodeId?setTimeout(()=>{Ti(o,J,"video",W.sourceNodeId)},0):console.warn("[Tapnow] Sora:  sourceNodeId",{taskId:o,updatedItem:W})}return ee});return}if(R==="FAILED"||R==="ERROR"||R==="CANCELLED"){gt(te=>te.map(ee=>ee.id===o?{...ee,status:"failed",errorMsg:`: ${R}`}:ee));const J=Date.now(),q=Ba.get(o),Z=J-((q==null?void 0:q.startTime)||J),oe=tr.current.get(o);oe&&(Kt(oe.nodeId,oe.shotId,{status:"failed",errorMsg:`: ${R}`,durationCost:Z/1e3}),tr.current.delete(o));return}gt(J=>J.map(q=>q.id===o?{...q,status:"generating",progress:Math.min(95,(q.progress||10)+2)}:q)),setTimeout(()=>Wa(n,o,l,u,p,m,h,x+1),v)}).catch(w=>{console.error("[Tapnow] Sora/Grok Poll :",w),x<b-5?setTimeout(()=>Wa(n,o,l,u,p,m,h,x+1),v):gt(j=>j.map(R=>R.id===o?{...R,status:"failed",errorMsg:`: ${w.message||""}`}:R))})},Jx=async(n,o="1:1")=>new Promise((l,u)=>{const p=new Image;p.crossOrigin="anonymous";const m=setTimeout(()=>{u(new Error(""))},3e4);p.onload=()=>{clearTimeout(m);try{const h=document.createElement("canvas"),x=h.getContext("2d"),b=Math.floor(p.width/2),v=Math.floor(p.height/2),y=b/v,w=[];for(let j=0;j<2;j++)for(let R=0;R<2;R++){const C=Math.max(0,Math.min(R*b,p.width-b)),H=Math.max(0,Math.min(j*v,p.height-v)),B=Math.min(b,p.width-C),L=Math.min(v,p.height-H);h.width=B,h.height=L,x.fillStyle="#ffffff",x.fillRect(0,0,B,L),x.drawImage(p,C,H,B,L,0,0,B,L);const Y=h.toDataURL("image/png");w.push({url:Y,width:B,height:L,ratio:y})}l(w)}catch(h){console.error("Midjourney: :",h),u(h)}},p.onerror=h=>{clearTimeout(m),console.error("Midjourney: Failed to load image for splitting:",h),u(new Error(""))},p.src=n}),ip=(n,o,l,u,p,m,h,x=0,b=!1)=>{const v=b?160:300,y=5e3;if(x>v){const R=b?800:1500;gt(C=>C.map(H=>H.id===n?{...H,status:"failed",errorMsg:`${R}`}:H));return}const j=`${l.replace(/\/+$/,"")}/v1/images/tasks/${o}`;fetch(j,{method:"GET",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}).then(R=>R.text()).then(R=>{var Z,oe,te,ee,ce,W,Se,ze,Ee;let C;try{C=JSON.parse(R)}catch(Be){console.error("[Async Image] Failed to parse response:",Be),setTimeout(()=>ip(n,o,l,u,p,m,h,x+1,b),delayMs);return}const H=(((Z=C==null?void 0:C.data)==null?void 0:Z.status)||(C==null?void 0:C.status)||"").toUpperCase();console.log("[Async Image] :",H,":",{hasData:!!(C!=null&&C.data),hasDataData:!!((oe=C==null?void 0:C.data)!=null&&oe.data),hasDataStatus:!!((te=C==null?void 0:C.data)!=null&&te.status),hasStatus:!!(C!=null&&C.status),dataKeys:C?Object.keys(C):[]});let B=[];if((ee=C==null?void 0:C.data)!=null&&ee.data&&Array.isArray(C.data.data)&&C.data.data.length>0?B=C.data.data:(ce=C==null?void 0:C.data)!=null&&ce.images&&Array.isArray(C.data.images)&&C.data.images.length>0?B=C.data.images:C!=null&&C.images&&Array.isArray(C.images)&&C.images.length>0?B=C.images:C!=null&&C.data&&Array.isArray(C.data)&&C.data.length>0&&(B=C.data),B.length===0){if((W=C==null?void 0:C.data)!=null&&W.data&&Array.isArray(C.data.data)&&C.data.data.length>0){const Be=C.data.data[0];if(Be!=null&&Be.revised_prompt){const nt=Be.revised_prompt.match(/!\[.*?\]\((https?:\/\/[^\s\)]+)\)/);nt&&nt[1]&&(B=[{url:nt[1]}])}}if(B.length===0&&((Se=C==null?void 0:C.data)!=null&&Se.revised_prompt)){const Be=C.data.revised_prompt.match(/!\[.*?\]\((https?:\/\/[^\s\)]+)\)/);Be&&Be[1]&&(B=[{url:Be[1]}])}if(B.length===0&&((ze=C==null?void 0:C.data)!=null&&ze.data)&&Array.isArray(C.data.data)&&C.data.data.length>0){const Be=C.data.data.filter(nt=>(nt==null?void 0:nt.url)||(nt==null?void 0:nt.image_url)||(nt==null?void 0:nt.imageUrl));Be.length>0&&(B=Be)}if(B.length===0&&(H==="COMPLETED"||H==="SUCCESS"||H==="FINISHED"||H==="DONE")){const Be=(st,ht=0,Yt=new WeakSet)=>{if(ht>5||!st||typeof st!="object"||Yt.has(st))return null;Yt.add(st);const Wt=["url","image_url","imageUrl","image","src","link","href"];for(const Jt of Wt)if(st[Jt]&&typeof st[Jt]=="string"&&st[Jt].startsWith("http"))return st[Jt];if(Array.isArray(st)&&st.length>0){const Jt=Be(st[0],ht+1,Yt);if(Jt)return Jt}for(const Jt in st)if(st.hasOwnProperty(Jt)&&!Wt.includes(Jt)){const Ft=Be(st[Jt],ht+1,Yt);if(Ft)return Ft}return null},nt=Be(C);nt?B=[{url:nt}]:console.warn("[Async Image] URL:",JSON.stringify(C,null,2).substring(0,500))}}const L=(C==null?void 0:C.message)||(C==null?void 0:C.error)||(C==null?void 0:C.fail_reason)||"";gt(Be=>{const nt=Be.map(ht=>{var Yt,Wt,Jt,Ft,dn,O,me,Fe,He,ct,jt,wt;if(ht.id===n)if(H==="COMPLETED"||H==="SUCCESS"||H==="FINISHED"||H==="DONE"){const Et=ht.sourceNodeId||h;if(B&&B.length>0){const xt=B.map(yt=>typeof yt=="string"?yt:(yt==null?void 0:yt.url)||(yt==null?void 0:yt.image_url)||(yt==null?void 0:yt.imageUrl)||"").filter(Boolean);if(xt.length>0){const yt=xt[0];if(tr.current.has(n)){const It=tr.current.get(n);It&&It.isImageMode?(Kt(It.nodeId,It.shotId,{output_images:xt,output_url:yt,selectedImageIndex:0,outputEnabled:!1,status:"done",durationCost:pt?pt/1e3:0}),tr.current.delete(n)):console.warn("[V3.7.30 Async Debug] ")}let pt=null;const St=((Yt=C==null?void 0:C.data)==null?void 0:Yt.duration)||((Wt=C==null?void 0:C.data)==null?void 0:Wt.cost_time)||((Jt=C==null?void 0:C.data)==null?void 0:Jt.elapsed_time)||((Ft=C==null?void 0:C.data)==null?void 0:Ft.time_cost)||((dn=C==null?void 0:C.data)==null?void 0:dn.spent_time)||(C==null?void 0:C.duration)||(C==null?void 0:C.cost_time)||(C==null?void 0:C.elapsed_time)||(C==null?void 0:C.time_cost)||(C==null?void 0:C.spent_time);if(St!=null){if(typeof St=="number")pt=St<1e4?St*1e3:St;else if(typeof St=="string"){const It=St.match(/(\d+\.?\d*)\s*(s|ms||)/i);if(It){const an=parseFloat(It[1]),Bt=It[2].toLowerCase();pt=Bt==="s"||Bt===""?an*1e3:an}else{const an=parseFloat(St);isNaN(an)||(pt=an<1e4?an*1e3:an)}}}if(pt===null){const It=Date.now();pt=It-(ht.startTime||It)}console.log("[Async Image] UI:",{taskId:n,url:yt,sourceNodeId:Et,imageCount:xt.length,durationMs:pt,backendDuration:St,frontendCalculated:pt===null?null:Date.now()-(ht.startTime||Date.now())});const hn=Et||ht.sourceNodeId;return console.log("[Async Image] ",{taskId:n,url:yt,sourceNodeId:hn,savedSourceNodeId:Et,hItemSourceNodeId:ht.sourceNodeId,imageCount:xt.length}),requestAnimationFrame(()=>{Ti(n,yt,"image",hn,xt.length>1?xt:null)}),{...ht,status:"completed",progress:100,url:yt,width:p,height:m,durationMs:pt,errorMsg:null,sourceNodeId:Et||ht.sourceNodeId,...xt.length>1?{mjImages:xt,selectedMjImageIndex:0}:{}}}else console.error("[Async Image] URL:",B)}else{console.error("[Async Image] :",{status:H,hasData:!!(C!=null&&C.data),hasDataData:!!((O=C==null?void 0:C.data)!=null&&O.data),fullData:JSON.stringify(C,null,2).substring(0,1e3)});const xt=(pt,St=0)=>{if(St>5||!pt||typeof pt!="object")return null;if(pt.url&&typeof pt.url=="string"&&pt.url.startsWith("http"))return pt.url;if(pt.image_url&&typeof pt.image_url=="string"&&pt.image_url.startsWith("http"))return pt.image_url;if(pt.imageUrl&&typeof pt.imageUrl=="string"&&pt.imageUrl.startsWith("http"))return pt.imageUrl;for(const hn in pt)if(pt.hasOwnProperty(hn)){const It=xt(pt[hn],St+1);if(It)return It}return null},yt=xt(C);if(yt){let pt=null;const St=((me=C==null?void 0:C.data)==null?void 0:me.duration)||((Fe=C==null?void 0:C.data)==null?void 0:Fe.cost_time)||((He=C==null?void 0:C.data)==null?void 0:He.elapsed_time)||((ct=C==null?void 0:C.data)==null?void 0:ct.time_cost)||((jt=C==null?void 0:C.data)==null?void 0:jt.spent_time)||(C==null?void 0:C.duration)||(C==null?void 0:C.cost_time)||(C==null?void 0:C.elapsed_time)||(C==null?void 0:C.time_cost)||(C==null?void 0:C.spent_time);if(St!=null){if(typeof St=="number")pt=St<1e4?St*1e3:St;else if(typeof St=="string"){const It=St.match(/(\d+\.?\d*)\s*(s|ms||)/i);if(It){const an=parseFloat(It[1]),Bt=It[2].toLowerCase();pt=Bt==="s"||Bt===""?an*1e3:an}else{const an=parseFloat(St);isNaN(an)||(pt=an<1e4?an*1e3:an)}}}if(pt===null){const It=Date.now();pt=It-(ht.startTime||It)}const hn=Et||ht.sourceNodeId;return console.log("[Async Image] ",{taskId:n,url:yt,sourceNodeId:hn,savedSourceNodeId:Et,hItemSourceNodeId:ht.sourceNodeId}),requestAnimationFrame(()=>{Ti(n,yt,"image",hn,null)}),{...ht,status:"completed",progress:100,url:yt,width:p,height:m,durationMs:pt,errorMsg:null,sourceNodeId:Et||ht.sourceNodeId}}}return{...ht,status:"failed",errorMsg:L||""}}else if(H==="FAILED"||H==="ERROR"||H==="CANCELLED"||H==="FAILURE"){if(tr.current.has(n)){const Et=tr.current.get(n),xt=Date.now(),yt=xt-(ht.startTime||xt);Kt(Et.nodeId,Et.shotId,{status:"failed",errorMsg:L||`: ${H}`,durationCost:yt/1e3}),tr.current.delete(n)}return{...ht,status:"failed",errorMsg:L||`: ${H}`}}else if(H==="PENDING"||H==="PROCESSING"||H==="GENERATING"||H==="IN_PROGRESS"||H==="RUNNING"){let Et=10+x*2;if((wt=C==null?void 0:C.data)!=null&&wt.progress){const xt=String(C.data.progress);xt.includes("%")?Et=parseInt(xt.replace("%",""),10)||Et:typeof C.data.progress=="number"&&(Et=C.data.progress)}else if(C!=null&&C.progress){const xt=String(C.progress);xt.includes("%")?Et=parseInt(xt.replace("%",""),10)||Et:typeof C.progress=="number"&&(Et=C.progress)}return Et=Math.min(95,Math.max(10,Et)),{...ht,status:"generating",progress:Et,errorMsg:null}}else{const Et=Math.min(90,10+x*1.5);return{...ht,status:"generating",progress:Et,errorMsg:null}}return ht}),st=nt.find(ht=>ht.id===n);return st!=null&&st.progress,nt});const Y=(((Ee=C==null?void 0:C.data)==null?void 0:Ee.status)||(C==null?void 0:C.status)||"").toUpperCase();!(Y==="COMPLETED"||Y==="SUCCESS"||Y==="FINISHED"||Y==="DONE")&&!(Y==="FAILED"||Y==="ERROR"||Y==="CANCELLED"||Y==="FAILURE")&&gt(Be=>{const nt=Be.find(Yt=>Yt.id===n),st=(nt==null?void 0:nt.progress)||10;let ht=y;return st>=90?ht=1e3:st>=70?ht=2e3:st>=50?ht=3e3:x>50&&!b&&(ht=1e4),setTimeout(()=>{ip(n,o,l,u,p,m,h,x+1,b)},ht),Be})}).catch(R=>{console.error("[Async Image] Poll error:",R),setTimeout(()=>ip(n,o,l,u,p,m,h,x+1,b),y)})},op=(n,o,l,u,p,m,h,x,b,v=0)=>{if(v>300){gt(B=>B.map(L=>L.id===n?{...L,status:"failed",errorMsg:"ModelScope "}:L));return}const R=`${l.replace(/\/+$/,"")}/v1/tasks/${o}`,C={Authorization:`Bearer ${u}`,"Content-Type":"application/json"};b&&(C["X-ModelScope-Task-Type"]="image_generation");const H=b?Cx(R,x):R;fetch(H,{method:"GET",headers:C}).then(B=>B.text()).then(B=>{var Se,ze,Ee,Be,nt,st,ht,Yt,Wt,Jt;let L;try{L=JSON.parse(B)}catch(Ft){console.error("[ModelScope] Failed to parse response:",Ft),setTimeout(()=>op(n,o,l,u,p,m,h,x,b,v+1),5e3);return}const Y=(L==null?void 0:L.task_status)||((Se=L==null?void 0:L.data)==null?void 0:Se.task_status)||((ze=L==null?void 0:L.output)==null?void 0:ze.task_status)||(L==null?void 0:L.status)||((Ee=L==null?void 0:L.data)==null?void 0:Ee.status)||"",J=String(Y).toUpperCase(),q=(L==null?void 0:L.output_images)||((Be=L==null?void 0:L.output)==null?void 0:Be.output_images)||((nt=L==null?void 0:L.data)==null?void 0:nt.output_images)||((st=L==null?void 0:L.output)==null?void 0:st.images)||((Yt=(ht=L==null?void 0:L.data)==null?void 0:ht.output)==null?void 0:Yt.output_images)||[],Z=Array.isArray(q)?q.map(Ft=>typeof Ft=="string"?Ft:(Ft==null?void 0:Ft.url)||(Ft==null?void 0:Ft.image_url)||(Ft==null?void 0:Ft.imageUrl)||(Ft==null?void 0:Ft.path)||"").filter(Boolean):[],oe=(L==null?void 0:L.message)||(L==null?void 0:L.error)||((Wt=L==null?void 0:L.data)==null?void 0:Wt.message)||((Jt=L==null?void 0:L.output)==null?void 0:Jt.error)||"",te=new Set(["SUCCEED","SUCCESS","COMPLETED","FINISHED","DONE"]),ee=new Set(["FAILED","ERROR","CANCELLED","FAILURE"]),ce=te.has(J),W=ee.has(J);gt(Ft=>Ft.map(dn=>{if(dn.id!==n)return dn;const O=tr.current.get(n),me=!!O;if(ce){if(Z.length===0)return{...dn,status:"failed",errorMsg:"ModelScope "};const He=Z[0],ct=Date.now(),jt=ct-(dn.startTime||ct);me&&(O.isImageMode?(Kt(O.nodeId,O.shotId,{output_images:Z,output_url:He,selectedImageIndex:0,outputEnabled:!1,status:"done",durationCost:jt/1e3}),tr.current.delete(n)):console.warn("[ModelScope] "));const wt={...dn,status:"completed",progress:100,url:He,width:p,height:m,durationMs:jt,output_images:Z,selectedMjImageIndex:0};return wt.sourceNodeId&&!me&&setTimeout(()=>{Ti(n,He,"image",wt.sourceNodeId,Z)},0),wt}if(W)return me&&O.isImageMode&&(Kt(O.nodeId,O.shotId,{status:"failed",errorMsg:oe||`: ${J||"FAILED"}`,durationCost:(Date.now()-(dn.startTime||Date.now()))/1e3}),tr.current.delete(n)),{...dn,status:"failed",errorMsg:oe||`: ${J||"FAILED"}`};const Fe=Math.min(95,Math.max(10,10+v*2));return{...dn,status:"generating",progress:Fe,errorMsg:null}})),!ce&&!W&&setTimeout(()=>op(n,o,l,u,p,m,h,x,b,v+1),5e3)}).catch(B=>{console.error("[ModelScope] Poll error:",B),setTimeout(()=>op(n,o,l,u,p,m,h,x,b,v+1),5e3)})},ap=(n,o,l,u,p="fast",m,h,x=0)=>{if(x>120){gt(y=>y.map(w=>w.id===o?{...w,status:"failed",errorMsg:"Midjourney "}:w));return}fetch(`${l}/${p}/mj/task/${n}/fetch`,{method:"GET",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}).then(y=>y.text()).then(y=>{let w;try{w=JSON.parse(y)}catch(Y){console.error("Midjourney: Failed to parse response:",Y),setTimeout(()=>ap(n,o,l,u,p,m,h,x+1),5e3);return}const j=(w==null?void 0:w.status)||"",R=(w==null?void 0:w.progress)||"0%",C=(w==null?void 0:w.imageUrl)||"",H=(w==null?void 0:w.failReason)||"",B=(w==null?void 0:w.buttons)||[];let L=0;typeof R=="string"&&R.includes("%")?L=parseInt(R.replace("%",""),10)||0:typeof R=="number"&&(L=R),gt(Y=>Y.map(J=>{var q,Z,oe,te,ee,ce,W;if(J.id===o){let Se=J.status,ze=J.errorMsg,Ee=L;if(j==="SUCCESS"||j==="FINISHED"){if(Se="completed",Ee=100,ze=null,C&&((Z=(q=J.apiConfig)==null?void 0:q.modelId)!=null&&Z.includes("mj"))&&((oe=J.apiConfig)==null?void 0:oe.modelId)!=="mj-zoom"){let nt="1:1";if(J.prompt&&J.prompt.includes("--ar ")){const Wt=J.prompt.match(/--ar\s+([\d:]+)/);Wt&&Wt[1]&&(nt=Wt[1])}gt(Wt=>Wt.map(Jt=>Jt.id===o?{...Jt,url:C,mjRatio:nt,mjOriginalUrl:C,mjNeedsSplit:!0}:Jt));const st=J.sourceNodeId;st?setTimeout(()=>{Ti(o,C,"image",st)},0):console.warn("[Tapnow] Midjourney:  sourceNodeId",{taskId:o,hItem:J}),setTimeout(()=>{Jx(C,nt).then(Wt=>{const Jt=Wt.map(O=>typeof O=="string"?O:O.url),Ft=Wt[0],dn=typeof Ft=="string"?Ft:Ft.url;gt(O=>O.map(me=>me.id===o?{...me,mjImages:Jt,url:dn,selectedMjImageIndex:0,mjRatio:nt,mjOriginalUrl:C,mjNeedsSplit:!1,mjImageInfo:Wt.map(Fe=>typeof Fe=="string"?null:{width:Fe.width,height:Fe.height,ratio:Fe.ratio})}:me))}).catch(Wt=>{console.error("Midjourney: Failed to split image:",Wt),gt(Jt=>Jt.map(Ft=>Ft.id===o?{...Ft,url:C,mjRatio:nt,mjOriginalUrl:C,mjNeedsSplit:!0}:Ft))})},300);const ht=Date.now(),Yt=ht-(J.startTime||ht);return{...J,status:Se,progress:Ee,errorMsg:ze,url:C,width:m,height:h,mjButtons:B,mjOriginalUrl:C,durationMs:Yt}}}else j==="FAILURE"||j==="ERROR"||j==="CANCELLED"?(Se="failed",ze=H||`: ${j}`):j==="NOT_START"||j==="SUBMITTED"||j==="IN_PROGRESS"||j==="MODAL"?(Se="generating",ze=null,Ee===0&&(Ee=5)):(Se="generating",ze=null,Ee=Math.min(95,(J.progress||5)+2));const Be={...J,status:Se,progress:Ee,errorMsg:ze,url:C||J.url,width:m,height:h,mjButtons:B};if((j==="SUCCESS"||j==="FINISHED")&&C&&(!((ee=(te=J.apiConfig)==null?void 0:te.modelId)!=null&&ee.includes("mj"))||((ce=J.apiConfig)==null?void 0:ce.modelId)==="mj-zoom")){J.sourceNodeId?((W=J.apiConfig)==null?void 0:W.modelId)==="mj-zoom"?f(ht=>ht.map(Yt=>Yt.id===J.sourceNodeId&&Yt.type==="expand-image"?{...Yt,content:C}:Yt)):Ti(o,C,"image",J.sourceNodeId):console.warn("[Tapnow] :  sourceNodeId",{taskId:o,hItem:J});const nt=Date.now(),st=nt-(J.startTime||nt);Be.durationMs=st}return Be}return J})),!(j==="SUCCESS"||j==="FINISHED")&&(j==="FAILURE"||j==="ERROR"||j==="CANCELLED"||setTimeout(()=>ap(n,o,l,u,p,m,h,x+1),5e3))}).catch(y=>{console.error(`[Tapnow] Midjourney Poll Fetch Error for task ${o}:`,y),gt(w=>w.map(j=>j.id===o?{...j,status:"failed",errorMsg:`: ${y.message}`}:j)),x<3&&setTimeout(()=>ap(n,o,l,u,p,m,h,x+1),5e3)})},ik=async n=>{if(!n)return null;try{const o=new Image;o.crossOrigin="anonymous",await new Promise((p,m)=>{o.onload=p,o.onerror=m,o.src=n});const l=document.createElement("canvas");l.width=o.width,l.height=o.height;const u=l.getContext("2d");return u.fillStyle="#000000",u.fillRect(0,0,l.width,l.height),u.globalCompositeOperation="destination-out",u.drawImage(o,0,0),new Promise((p,m)=>{l.toBlob(h=>{h?p(h):m(new Error(""))},"image/png")})}catch(o){return console.error("[Inpainting] :",o),null}},Va=async(n,o,l,u,p={})=>{var Be,nt,st,ht,Yt,Wt,Jt,Ft,dn,O,me,Fe,He,ct,jt,wt,Et,xt,yt,pt,St,hn,It,an,Bt,Sr,ie,ge,Je,mt,et,Ae,zt,ln,at,On,Bn,An,xn,lt,Dt,zn,U,Ze,Ge,it,tt,$t,nn,Gt,we,Rt,jn,yn,ue,De,dt,Mt,vt,Mn,rn,cn,Tr,Tn,nr,sn,Sn,bn,Kn,Pr,Yn,Fs,bi,mb;let m=[];const h=Array.isArray(l)?l:l?[l]:[];if(h.length>0)try{m=await Promise.all(h.map(async $e=>{if(Ui.isImageId($e)){const Vt=await Ui.getImage($e);return Vt||(console.warn(`[startGeneration] Failed to resolve IDB image: ${$e}`),$e)}return $e}))}catch($e){console.error("[startGeneration] Error resolving images:",$e),m=h}const x=m,b=x.length>0?x[0]:void 0;if(!n&&!b){alert("");return}let v=null;u&&u.startsWith("storyboard-")&&u.includes("-shot-")?v=null:v=d.find($e=>$e.id===u);let y=null,w=v==null?void 0:v.maskContent;if(!w){let $e=g.find(Vt=>Vt.to===u&&(!Vt.inputType||Vt.inputType==="default"));if($e||($e=g.find(Vt=>Vt.to===u)),$e){const Vt=At.get($e.from);Vt&&Vt.maskContent&&(w=Vt.maskContent)}}w&&(y=await ik(w),y||console.warn("[Inpainting] "));const j=p.model||((Be=v==null?void 0:v.settings)==null?void 0:Be.model)||(o==="image"?"nano-banana":"sora-2"),R=p.customParams||((nt=v==null?void 0:v.settings)==null?void 0:nt.customParams)||null,C=ri(j);let H=C.key,B=H;if(H&&H.includes(",")){const $e=H.split(",").map(Ke=>Ke.trim()).filter(Ke=>Ke),Vt=$r.current||{},vr=$e.filter(Ke=>!Vt[Ke]);vr.length>0?B=vr[Math.floor(Math.random()*vr.length)]:$e.length>0&&(B=$e[Math.floor(Math.random()*$e.length)],console.warn(` [Load Balancing] All ${$e.length} keys are blacklisted, using random selection`))}B&&console.log(`[API Select] Using Key ending in ...${B.slice(-4)}`);let L=C.url,Y=L;if(L.includes(",")){const $e=L.split(",").map(Vt=>Vt.trim()).filter(Vt=>Vt);$e.length>0&&(Y=$e[Math.floor(Math.random()*$e.length)])}if(!B){alert(" API Key"),ei(!0);return}n&&(j.includes("sora")||j==="sora-2"||j==="sora-2-pro")&&(n=n.replace(/@([a-zA-Z0-9_\.]+)(?![a-zA-Z0-9_\.])/g,($e,Vt)=>`@{${Vt}}`),n=n.replace(/@\{([^\}]+)\}/g,($e,Vt)=>` @{${Vt}} `).replace(/\s{2,}/g," ").trim());let J=p.ratio||((st=v==null?void 0:v.settings)==null?void 0:st.ratio)||(j.includes("grok")?"3:2":"1:1"),q=p.resolution||((ht=v==null?void 0:v.settings)==null?void 0:ht.resolution)||(o==="video"?"720P":"2K"),Z=q;o==="image"&&(q=Md(q),Z=q),o==="video"&&(q=zo(q),Z=q==="Auto"?"720P":q);let{sizeStr:oe,w:te,h:ee}=z_(j,J,Z);if(q==="Auto"&&J==="Auto"&&b)try{const $e=await Fr(b),Vt=Math.round($e.w/64)*64,vr=Math.round($e.h/64)*64;te=Vt,ee=vr,oe=`${Vt}x${vr}`}catch($e){console.error("Auto Res Error",$e)}else if(!te||!ee){const $e=Jw(J,q);te=$e.w,ee=$e.h,oe=$e.str}if(b&&J==="Auto"&&["1K","2K","4K"].includes(q))try{const $e=await Fr(b),Vt=q==="4K"?4096:q==="2K"?2048:1024,vr=Math.max($e.w,$e.h)||1,Ke=Vt/vr;let Cn=Math.round($e.w*Ke/16)*16,Nn=Math.round($e.h*Ke/16)*16;Cn=Math.max(16,Cn),Nn=Math.max(16,Nn),te=Cn,ee=Nn,oe=`${Cn}x${Nn}`}catch($e){console.error("Auto+K Upscale Error",$e)}let ce=p.duration?String(p.duration).replace("s",""):((Wt=(Yt=v==null?void 0:v.settings)==null?void 0:Yt.duration)==null?void 0:Wt.replace("s",""))||"5";j.includes("veo")&&(ce="8"),j.includes("jimeng")&&!["5","10"].includes(String(ce))&&(ce="5");const W=p._existingTaskId||`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,Se=()=>{const $e=Ht(j);return j.includes("jimeng")?j:($e==null?void 0:$e.displayName)||($e==null?void 0:$e.modelName)||($e==null?void 0:$e.id)||j},ze=Date.now(),Ee=(v==null?void 0:v.id)||u||null;if(p._isRetry||gt($e=>[{id:W,type:o,url:"",prompt:n||(b?`Img2${o==="image"?"Img":"Vid"}`:"Untitled"),time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"generating",progress:5,modelName:Se(),width:te,height:ee,remoteTaskId:null,apiConfig:{modelId:j,baseUrl:Y,apiKey:B},provider:C.provider,sourceNodeId:Ee,startTime:ze,durationMs:null,ratio:J,resolution:q,duration:o==="video"?ce:null,hasInputImages:x.length>0,customParams:R||null},...$e]),Ee&&Ee.startsWith("storyboard-")&&Ee.includes("-shot-")){const $e=Ee.split("-shot-");if($e.length===2){const Vt=$e[1],vr=$e[0].startsWith("storyboard-img-"),Ke=vr?$e[0].replace("storyboard-img-",""):$e[0].replace("storyboard-","");tr.current.set(W,{nodeId:Ke,shotId:Vt,isImageMode:vr})}}p._isRetry||requestAnimationFrame(()=>{setTimeout(()=>{Au(!0)},0)});try{if(o==="image"){let $e=`${Y}/v1/images/generations`,Vt,vr=!1;const Ke=Ht(j),Cn=Array.isArray(Ke==null?void 0:Ke.customParams)?Ke.customParams:[],Nn=Ke==null?void 0:Ke.provider,Bs=C.apiType||((Jt=Pe[Nn])==null?void 0:Jt.apiType)||"openai",aa=!!C.useProxy,pp=!!C.forceAsync,la=Bs==="modelscope",pd=Bs==="gemini",tn=(Ke==null?void 0:Ke.type)==="ChatImage",Jl=la?pp:!1,hs=Ne=>Gi(Ne,aa),fd=(j.includes("banana")||j.includes("edit")||j.includes("qwen"))&&!(j.includes("nano-banana-2")||((Ke==null?void 0:Ke.modelName)??"").includes("nano-banana-2")),hd=j.includes("gpt")||((Ke==null?void 0:Ke.modelName)??"").includes("gpt-image")||((Ke==null?void 0:Ke.provider)??"").toLowerCase().includes("gpt-4o image"),gb=j.includes("flux")||((Ke==null?void 0:Ke.modelName)??"").includes("flux-kontext"),Gl=((Ke==null?void 0:Ke.modelName)??"").includes("nano-banana-2")||j.includes("nano-banana-2"),K0=j.includes("mj")||((Ke==null?void 0:Ke.provider)??"").toLowerCase().includes("midjourney"),ca=j.includes("jimeng")||((Ke==null?void 0:Ke.modelName)??"").includes("jimeng")||(Ke==null?void 0:Ke.provider)==="jimeng",Ga=()=>{var Ne;return j.includes("jimeng-4.5")?"jimeng-4.5":j.includes("jimeng-4.1")?"jimeng-4.1":j.includes("jimeng-4.0")?"jimeng-4.0":j.includes("jimeng-3.1")?"jimeng-3.1":j.includes("jimeng-3.0")?"jimeng-3.0":(Ne=Ke==null?void 0:Ke.modelName)!=null&&Ne.includes("jimeng")?Ke.modelName:"jimeng-4.5"},Nt=(()=>{if(Gl)return q==="4K"?"4K":q==="2K"?"2K":"1K"})(),_n=Bg(q),or=J==="Auto"||_n?void 0:J;if(tn){$e="/v1/chat/completions";const Ne=[];n&&Ne.push({type:"text",text:n}),(x.length>0?x:b?[b]:[]).forEach(bt=>{bt&&Ne.push({type:"image_url",image_url:{url:bt}})}),Ne.length===0&&Ne.push({type:"text",text:""}),Vt={model:(Ke==null?void 0:Ke.modelName)||j,messages:[{role:"user",content:Ne}],stream:!1}}else if(la){const Ne=(Ke==null?void 0:Ke.modelName)||"Tongyi-MAI/Z-Image-Turbo";$e=`${Y}/v1/images/generations`,Vt={model:Ne,prompt:n||"",n:1,size:oe,...Jl?{async_mode:!0}:{}},or&&(Vt.aspect_ratio=or)}else if(pd){const Ne=(Ke==null?void 0:Ke.modelName)||"gemini-3-pro-image-preview",rt=[];n&&rt.push({text:n});const bt=x.length>0?x:b?[b]:[],In=mn=>{if(!mn)return"image/png";if(mn.startsWith("data:")){const dr=mn.match(/^data:([^;]+);/i);if(dr&&dr[1])return dr[1]}const Un=Fa(mn,".png");return Un===".jpg"||Un===".jpeg"?"image/jpeg":Un===".webp"?"image/webp":Un===".gif"?"image/gif":"image/png"};for(const mn of bt){const Un=await yr(mn,{useProxy:hs(mn)}),dr=In(mn);rt.push({inline_data:{mime_type:dr,data:Un}})}const Wn={};or&&(Wn.aspectRatio=or),q&&q!=="Auto"&&(Wn.imageSize=q),Vt={contents:[{role:"user",parts:rt}],generationConfig:{responseModalities:["TEXT","IMAGE"],...Object.keys(Wn).length>0?{imageConfig:Wn}:{}}};const pn=B?`?key=${encodeURIComponent(B)}`:"";$e=`${Y}/v1beta/models/${Ne}:generateContent${pn}`}else if(x.length>0&&fd){$e=`${Y}/v1/images/edits`,vr=!0;const Ne=new FormData;Ne.append("model",(Ke==null?void 0:Ke.modelName)||"nano-banana"),Ne.append("prompt",n||"enhance"),Ne.append("n","1"),Ne.append("size",oe),or&&Ne.append("aspect_ratio",or),Nt&&Ne.append("image_size",Nt);const rt=x.map(In=>Os(In,{useProxy:hs(In)}));(await Promise.all(rt)).forEach((In,Wn)=>{Ne.append("image",In,`input_${Wn}.png`)}),y&&Ne.append("mask",y,"mask.png"),Vt=Ne}else if(gb){$e=`${Y}/v1/images/edits`,vr=!0;const Ne=new FormData;Ne.append("model",(Ke==null?void 0:Ke.modelName)||"flux-kontext-pro"),Ne.append("prompt",n||""),or&&Ne.append("aspect_ratio",or),oe&&Ne.append("size",oe);const rt=x.length>0?x:b?[b]:[];if(rt.length>0){const bt=rt.map(Wn=>Os(Wn,{useProxy:hs(Wn)}));(await Promise.all(bt)).forEach((Wn,pn)=>Ne.append("image",Wn,`flux_ref_${pn}.png`))}y&&Ne.append("mask",y,"mask.png"),Vt=Ne}else if(hd){let Ne=n||"";const rt={model:(Ke==null?void 0:Ke.modelName)||"gpt-4o-image",prompt:Ne,n:1,size:oe,response_format:"url"};if(or&&(rt.aspect_ratio=or),x.length>0){const bt=x.map(Wn=>yr(Wn,{useProxy:hs(Wn)})),In=await Promise.all(bt);rt.image=In.map(Wn=>`data:image/png;base64,${Wn}`)}Vt=rt}else if(Gl)if(x.length>0){$e=`${Y}/v1/images/edits?async=true`,vr=!0;const rt=new FormData;rt.append("model",(Ke==null?void 0:Ke.modelName)||"nano-banana-2"),rt.append("prompt",n||""),rt.append("response_format","url"),or&&rt.append("aspect_ratio",or),Nt&&rt.append("image_size",Nt);const bt=x.map(Wn=>Os(Wn,{useProxy:hs(Wn)}));(await Promise.all(bt)).forEach((Wn,pn)=>{rt.append("image",Wn,`input_${pn}.png`)}),y&&rt.append("mask",y,"mask.png"),Vt=rt}else{$e=`${Y}/v1/images/generations?async=true`;const rt={model:(Ke==null?void 0:Ke.modelName)||"nano-banana-2",prompt:n||"",response_format:"url",...or?{aspect_ratio:or}:{},...Nt?{image_size:Nt}:{}};if(b){const bt=b.trim();if(bt.startsWith("http"))rt.image=[bt];else if(bt.startsWith("data:"))rt.image=[bt];else{const In=await yr(bt,{useProxy:hs(bt)});rt.image=[`data:image/png;base64,${In}`]}}Vt=rt}else if(K0){const Ne=((Ft=v==null?void 0:v.settings)==null?void 0:Ft.mjMode)||"fast",rt=((dn=v==null?void 0:v.settings)==null?void 0:dn.mjVersion)||"--v 7";let bt=n||"";J&&J!=="Auto"&&(bt.includes("--ar ")||(bt=`${bt} --ar ${J}`.trim()));const In=ta(u,"oref"),Wn=ta(u,"sref"),pn=[],mn=new Map;let Un=null,dr=null,Zt=[];const ii=In||((O=v==null?void 0:v.settings)==null?void 0:O.mjOref)&&v.settings.mjOref.trim();if(ii&&ii.trim()){let Jn=ii.trim();Jn.startsWith("http")?Un=Jn:Jn.startsWith("data:")?(pn.push(Jn),mn.set("oref",pn.length-1)):Un=Jn}const Hs=Wn||((me=v==null?void 0:v.settings)==null?void 0:me.mjSref)&&v.settings.mjSref.trim();if(Hs&&Hs.trim()){let Jn=Hs.trim();Jn.startsWith("http")?dr=Jn:Jn.startsWith("data:")?(pn.push(Jn),mn.set("sref",pn.length-1)):dr=Jn}if(x.length>0)for(const Jn of x)!(In&&Jn===In)&&!(Wn&&Jn===Wn)&&(Jn.startsWith("http")?Zt.push(Jn):Jn.startsWith("data:")?(pn.push(Jn),mn.set(`default_${Zt.length}`,pn.length-1),Zt.push(null)):Zt.push(Jn));if(pn.length>0)try{const Jn=await Qz(pn,Y,B);mn.has("oref")&&(Un=Jn[mn.get("oref")]),mn.has("sref")&&(dr=Jn[mn.get("sref")]);for(let yi=0;yi<Zt.length;yi++)if(Zt[yi]===null){const qa=`default_${yi}`;mn.has(qa)&&(Zt[yi]=Jn[mn.get(qa)])}}catch(Jn){gt(yi=>yi.map(qa=>qa.id===W?{...qa,status:"failed",progress:0,errorMsg:`: ${Jn.message}`}:qa));return}Zt=Zt.filter(Jn=>Jn!==null);let ar="";Zt.length>0&&(ar=Zt.join(" ")+" "),ar+=bt.trim(),!ar.includes("--v ")&&!ar.includes("--niji ")&&(ar=`${ar} ${rt}`.trim()),J&&J!=="Auto"&&!ar.includes("--ar ")&&(ar=`${ar} --ar ${J}`.trim()),Un&&!ar.includes("--oref ")&&(ar=`${ar} --oref ${Un}`.trim()),(Fe=v==null?void 0:v.settings)!=null&&Fe.mjOw&&v.settings.mjOw>0&&!ar.includes("--ow ")&&(ar=`${ar} --ow ${Math.min(1e3,Math.max(1,v.settings.mjOw))}`.trim()),dr&&!ar.includes("--sref ")&&(ar=`${ar} --sref ${dr}`.trim()),$e=`${Y}/${Ne}/mj/submit/imagine`,Vt={prompt:ar,base64Array:[]};const Za=await fetch($e,{method:"POST",headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"},body:JSON.stringify(Vt)}),hp=await Za.text();if(!Za.ok)throw new Error(hp||`Midjourney API error: ${Za.status}`);let md=JSON.parse(hp);if(md.code!==1&&md.code!==22)throw new Error(md.description||`Midjourney: code ${md.code}`);const J0=md.result;if(!J0)throw new Error("ID");gt(Jn=>Jn.map(yi=>yi.id===W?{...yi,remoteTaskId:J0,status:"generating",progress:5}:yi)),ap(J0,W,Y,B,Ne,te,ee);return}else if(ca)if(x.length>0){if($e=`${Y}/v1/images/compositions`,!n||n.trim()==="")throw new Error("");let Ne=J,rt="2k";if(J==="Auto"&&b)try{const mn=await Fr(b),Un=[{name:"1:1",value:1},{name:"4:3",value:4/3},{name:"3:4",value:3/4},{name:"16:9",value:16/9},{name:"9:16",value:9/16},{name:"3:2",value:3/2},{name:"2:3",value:2/3},{name:"21:9",value:21/9}],dr=mn.w/mn.h;let Zt=Un[0],ii=Math.abs(dr-Zt.value);for(const Hs of Un){const ar=Math.abs(dr-Hs.value);ar<ii&&(ii=ar,Zt=Hs)}if(Ne=Zt.name,q==="Auto"){const Hs=Math.max(mn.w,mn.h);rt=Hs<=1024?"1k":Hs<=2048?"2k":"4k"}}catch{Ne="1:1"}else Ne=J==="Auto"?"1:1":J;q!=="Auto"&&(q==="1K"?rt="1k":q==="2K"?rt="2k":q==="4K"&&(rt="4k"));const bt=y?await Fl(y):null,In=x.map(async mn=>{try{return await ak(mn,{useProxy:hs(mn)})}catch(Un){throw mn.startsWith("blob:")?(console.error("[Jimeng] Blob URL :",Un),new Error("Blob URL")):new Error(`: ${Un.message}`)}}),Wn=await Promise.all(In);Vt={model:Ga(),prompt:n.trim(),images:Wn,ratio:Ne,resolution:rt,response_format:"url"},bt&&(Vt.mask=bt)}else{$e=`${Y}/v1/images/generations`;const Ne=J==="Auto"?"1:1":J;let rt="2k";if(q==="1K"?rt="1k":q==="2K"?rt="2k":q==="4K"&&(rt="4k"),!n||n.trim()==="")throw new Error("");Vt={model:Ga(),prompt:n.trim(),ratio:Ne,resolution:rt,response_format:"url"}}else Vt={model:(Ke==null?void 0:Ke.modelName)||j,prompt:n,n:1,size:oe,response_format:"url"};Vt=fv(Vt,Cn,R),Ke!=null&&Ke.previewOverrideEnabled&&Ke.previewOverridePatch&&(Vt=Ah(Vt,Ke.previewOverridePatch));const _s=async(Ne,rt)=>{const bt=vr?{Authorization:`Bearer ${Ne} `}:{Authorization:`Bearer ${Ne} `,"Content-Type":"application/json"};la&&aa&&Jl&&(bt["X-ModelScope-Async-Mode"]="true");let In;$e.startsWith("http")?rt!==Y&&$e.includes(Y)?In=$e.replace(Y,rt):In=$e:In=`${rt.replace(/\/+$/,"")}${$e.startsWith("/")?$e:"/"+$e} `;const Wn=vr?Vt:JSON.stringify(Vt),pn=Cx(In,Nn);return await fetch(pn,{method:"POST",headers:bt,body:Wn})},Qr=H&&H.includes(",")?H.split(",").map(Ne=>Ne.trim()).filter(Ne=>Ne):[H||We],es=L.includes(",")?L.split(",").map(Ne=>Ne.trim()).filter(Ne=>Ne):[(L||ss).replace(/\/+$/,"")],Vr=Ne=>{for(let rt=Ne.length-1;rt>0;rt--){const bt=Math.floor(Math.random()*(rt+1));[Ne[rt],Ne[bt]]=[Ne[bt],Ne[rt]]}return Ne};Qr.length>1&&Vr(Qr),es.length>1&&Vr(es);let un,ne,rr,ms,Qi=!1;const ts=$r.current||{},qt=[];for(const Ne of Qr)if(!ts[Ne]&&!vs(Ne))for(const rt of es)qt.push({key:Ne,url:rt});if(qt.length===0&&Qr.length>0){console.warn("[Blacklist] All specified keys are blacklisted. Trying anyway with all available keys to avoid total failure.");for(const Ne of Qr)for(const rt of es)qt.push({key:Ne,url:rt})}qt.length>1&&Vr(qt);for(const Ne of qt)try{if(un=await _s(Ne.key,Ne.url),un.status===401||un.status===402||un.status===403){const bt=un.status===402?" (402)":un.status===401?" (401)":" (403)";console.warn(`[API Failover] Key ending in ...${Ne.key.slice(-4)} failed with status ${un.status}. Trying next...`),hi(Ne.key,bt),ms=new Error(`API returned ${un.status}: ${bt}`);continue}rr=await un.text();try{ne=JSON.parse(rr)}catch{}let rt=ne==null?void 0:ne.code;if(ne!=null&&ne.message&&typeof ne.message=="string"){const bt=ne.message.match(/:\s*(\d+)/);bt&&(rt=parseInt(bt[1],10))}if(ca&&ne&&ne.code,ca&&(rt===1e3||ne!=null&&ne.message&&ne.message.toLowerCase().includes("invalid parameter")))throw console.error(` [API Fatal]  (1000): ${ne.message}`),new Error(`: ${ne.message||"Invalid parameter"} ( 1000)`);if(ca&&(rt===34010105||ne!=null&&ne.message&&ne.message.includes("34010105"))){console.warn(` [API Suspend] Key ending in ...${Ne.key.slice(-4)}  (34010105) 60 `),Ci(Ne.key," (34010105)",60*60*1e3),ms=new Error(":  session ( 34010105)");continue}if(ca&&rt===1006){if(Ao(),Mc())throw new Error(" : ");const bt=" (1006)";console.warn(` [API Blacklist] Key ending in ...${Ne.key.slice(-4)}  (1006)`),hi(Ne.key,bt),ms=new Error(`Jimeng Error: ${ne.message||"Not enough credits"}`);continue}Qi=!0;break}catch(rt){if(rt.message.includes("")||rt.message.includes(""))throw rt;console.warn(`[API Failover] Network/Parse request failed for ...${Ne.key.slice(-4)}. Error: ${rt.message}`),ms=rt}if(!Qi||!un&&!rr){const Ne=ms?ms.message:"All API combinations failed.";throw new Error(Ne)}if(!ne&&rr)try{ne=JSON.parse(rr)}catch{throw new Error(`: ${rr.substring(0,100)}`)}if(!un.ok){let Ne=(ne==null?void 0:ne.message)||((He=ne==null?void 0:ne.error)==null?void 0:He.message)||rr;throw hd&&un.status===500&&(Ne=`GPT - 4o (500): ${((ct=ne==null?void 0:ne.error)==null?void 0:ct.message)||(ne==null?void 0:ne.error)||(ne==null?void 0:ne.message)||rr} 


1.API Key 
2.(${(Ke==null?void 0:Ke.modelName)||"gpt-4o-image"}) 
3.
4.`,gt(bt=>bt.map(In=>In.id===W?{...In,status:"failed",progress:0,errorMsg:Ne}:In))),new Error(Ne)}if(ca&&(ne==null?void 0:ne.code)!==void 0&&ne.code!==0&&ne.code!==1&&ne.code!==200)throw new Error(ne.message||`API: ${ne.code} `);if(Gl&&(ne!=null&&ne.task_id||typeof(ne==null?void 0:ne.data)=="string"&&ne.data.startsWith("task-"))){const Ne=ne.task_id||ne.data;gt(rt=>rt.map(bt=>bt.id===W?{...bt,status:"generating",progress:10,remoteTaskId:Ne}:bt)),ip(W,Ne,Y,B,te,ee,Ee,0,!0);return}let on=[];if(tn){let Ne=null;const rt=((wt=(jt=ne==null?void 0:ne.choices)==null?void 0:jt[0])==null?void 0:wt.message)||((yt=(xt=(Et=ne==null?void 0:ne.data)==null?void 0:Et.choices)==null?void 0:xt[0])==null?void 0:yt.message);(rt==null?void 0:rt.content)!==void 0?Array.isArray(rt.content)?Ne=rt.content.map(bt=>typeof(bt==null?void 0:bt.text)=="string"?bt.text:"").filter(Boolean).join(`
`):Ne=rt.content:ne!=null&&ne.content?Ne=ne.content:ne!=null&&ne.text?Ne=ne.text:ne!=null&&ne.message?Ne=typeof ne.message=="string"?ne.message:ne.message.content:ne!=null&&ne.result?Ne=typeof ne.result=="string"?ne.result:ne.result.content:(pt=ne==null?void 0:ne.data)!=null&&pt.content?Ne=ne.data.content:(St=ne==null?void 0:ne.data)!=null&&St.text?Ne=ne.data.text:(hn=ne==null?void 0:ne.data)!=null&&hn.message?Ne=typeof ne.data.message=="string"?ne.data.message:ne.data.message.content:(It=ne==null?void 0:ne.data)!=null&&It.result&&(Ne=typeof ne.data.result=="string"?ne.data.result:ne.data.result.content),Ne&&typeof Ne!="string"&&(Ne=JSON.stringify(Ne)),on=Hx(ne,Ne||"")}else if(la){const Ne=(ne==null?void 0:ne.task_id)||(ne==null?void 0:ne.taskId)||((an=ne==null?void 0:ne.data)==null?void 0:an.task_id)||((Bt=ne==null?void 0:ne.output)==null?void 0:Bt.task_id)||((Sr=ne==null?void 0:ne.output)==null?void 0:Sr.taskId),rt=(ne==null?void 0:ne.output_images)||((ie=ne==null?void 0:ne.output)==null?void 0:ie.output_images)||((ge=ne==null?void 0:ne.data)==null?void 0:ge.output_images)||((Je=ne==null?void 0:ne.output)==null?void 0:Je.images)||((et=(mt=ne==null?void 0:ne.data)==null?void 0:mt.output)==null?void 0:et.output_images)||[];if(on=Array.isArray(rt)?rt.map(bt=>typeof bt=="string"?bt:(bt==null?void 0:bt.url)||(bt==null?void 0:bt.image_url)||(bt==null?void 0:bt.imageUrl)||(bt==null?void 0:bt.path)||"").filter(Boolean):[],Ne&&on.length===0){gt(bt=>bt.map(In=>In.id===W?{...In,status:"generating",progress:10,remoteTaskId:Ne}:In)),op(W,Ne,Y,B,te,ee,Ee,Nn,aa,0);return}}else if(pd){const Ne=new Set,rt=(pn,mn="image/png")=>{if(pn){if(typeof pn=="string"){const Un=pn.trim();if(!Un)return;if(Un.startsWith("data:")||Un.startsWith("http://")||Un.startsWith("https://")){Ne.add(Un);return}/^[A-Za-z0-9+/=]+$/.test(Un)&&Un.length>64&&Ne.add(`data:${mn};base64,${Un}`);return}if(typeof pn=="object"){const Un=pn.url||pn.image_url||pn.imageUrl||pn.file_uri||pn.fileUri||pn.uri;if(Un){Ne.add(Un);return}const dr=pn.data||pn.base64||pn.b64;if(dr){const Zt=pn.mime_type||pn.mimeType||mn;Ne.add(`data:${Zt};base64,${dr}`)}}}},bt=pn=>{if(!pn||typeof pn!="string")return;(pn.match(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g)||[]).forEach(dr=>Ne.add(dr)),(pn.match(/https?:\/\/[^\s)]+/g)||[]).forEach(dr=>{dr.match(/\.(png|jpg|jpeg|webp|gif)(\?|#|$)/i)&&Ne.add(dr)})};[ne==null?void 0:ne.candidates,(Ae=ne==null?void 0:ne.data)==null?void 0:Ae.candidates,(zt=ne==null?void 0:ne.response)==null?void 0:zt.candidates,(ln=ne==null?void 0:ne.result)==null?void 0:ln.candidates,(On=(at=ne==null?void 0:ne.data)==null?void 0:at.result)==null?void 0:On.candidates,(Bn=ne==null?void 0:ne.output)==null?void 0:Bn.candidates].forEach(pn=>{Array.isArray(pn)&&pn.forEach(mn=>{var dr;(Array.isArray((dr=mn==null?void 0:mn.content)==null?void 0:dr.parts)?mn.content.parts:Array.isArray(mn==null?void 0:mn.parts)?mn.parts:[]).forEach(Zt=>{const ii=(Zt==null?void 0:Zt.inline_data)||(Zt==null?void 0:Zt.inlineData);if(ii!=null&&ii.data){const ar=ii.mime_type||ii.mimeType||"image/png",Za=ii.data,hp=Za.startsWith("data:")?Za:`data:${ar};base64,${Za}`;Ne.add(hp)}const Hs=(Zt==null?void 0:Zt.file_data)||(Zt==null?void 0:Zt.fileData);if(Hs){const ar=Hs.file_uri||Hs.fileUri||Hs.uri;ar&&Ne.add(ar)}Zt!=null&&Zt.data&&rt(Zt.data,(Zt==null?void 0:Zt.mime_type)||(Zt==null?void 0:Zt.mimeType)||"image/png"),(Zt!=null&&Zt.image_url||Zt!=null&&Zt.imageUrl)&&rt(Zt.image_url||Zt.imageUrl),Zt!=null&&Zt.text&&bt(Zt.text)})})}),[ne==null?void 0:ne.images,ne==null?void 0:ne.image,(An=ne==null?void 0:ne.data)==null?void 0:An.images,(xn=ne==null?void 0:ne.data)==null?void 0:xn.image,(lt=ne==null?void 0:ne.result)==null?void 0:lt.images,(Dt=ne==null?void 0:ne.result)==null?void 0:Dt.image,(zn=ne==null?void 0:ne.result)==null?void 0:zn.output_images,(Ze=(U=ne==null?void 0:ne.result)==null?void 0:U.output)==null?void 0:Ze.output_images,(it=(Ge=ne==null?void 0:ne.data)==null?void 0:Ge.result)==null?void 0:it.images,($t=(tt=ne==null?void 0:ne.data)==null?void 0:tt.result)==null?void 0:$t.output_images,(we=(Gt=(nn=ne==null?void 0:ne.data)==null?void 0:nn.result)==null?void 0:Gt.output)==null?void 0:we.output_images,ne==null?void 0:ne.output_images,(Rt=ne==null?void 0:ne.output)==null?void 0:Rt.images,(jn=ne==null?void 0:ne.output)==null?void 0:jn.output_images,(yn=ne==null?void 0:ne.data)==null?void 0:yn.output_images,(De=(ue=ne==null?void 0:ne.data)==null?void 0:ue.output)==null?void 0:De.output_images].forEach(pn=>{Array.isArray(pn)?pn.forEach(mn=>rt(mn)):pn&&rt(pn)}),on=Array.from(Ne).filter(Boolean)}if(on.length===0&&(ne!=null&&ne.data&&Array.isArray(ne.data)?on=ne.data.map(Ne=>typeof Ne=="string"?Ne:Ne?Ne.url||Ne.image_url||Ne.imageUrl||(Ne.b64_json?`data:image/png;base64,${Ne.b64_json}`:null)||(Ne.base64?`data:image/png;base64,${Ne.base64}`:null):null).filter(Ne=>typeof Ne=="string"):(dt=ne==null?void 0:ne.data)!=null&&dt.data&&Array.isArray(ne.data.data)&&(on=ne.data.data.map(Ne=>typeof Ne=="string"?Ne:Ne?Ne.url||Ne.image_url||Ne.imageUrl||(Ne.b64_json?`data:image/png;base64,${Ne.b64_json}`:null)||(Ne.base64?`data:image/png;base64,${Ne.base64}`:null):null).filter(Boolean))),on.length===0)throw new Error("URL");const Rn=on[0],Y0=Date.now()-ze,yo=tr.current.get(W);yo&&(yo.isImageMode?Kt(yo.nodeId,yo.shotId,{output_images:on,output_url:on[0],selectedImageIndex:0,outputEnabled:!1,status:"done"}):console.warn("[V3.7.30 Debug] "),tr.current.delete(W)),gt(Ne=>Ne.map(bt=>{if(bt.id===W){const In={...bt,status:"completed",progress:100,url:Rn,width:te,height:ee,durationMs:Y0,mjImages:on.length>1?on:null,selectedMjImageIndex:0};return In.sourceNodeId&&!yo&&setTimeout(()=>{Ti(W,Rn,"image",In.sourceNodeId,In.mjImages)},0),In}return bt}));return}if(o==="video"){const $e=Ht(j),Vt=Array.isArray($e==null?void 0:$e.customParams)?$e.customParams:[],vr=!!C.useProxy,Ke=Nt=>Gi(Nt,vr),Cn=Nt=>{const _n=fv(Nt,Vt,R);return $e!=null&&$e.previewOverrideEnabled&&$e.previewOverridePatch&&Ah(_n,$e.previewOverridePatch),_n};if(j.includes("veo")){const Nt=`${Y} /v2/videos / generations`,_n=At.get(u),_s=!!($e!=null&&$e.supportsFirstLastFrame)&&!!((Mt=_n==null?void 0:_n.settings)!=null&&Mt.useFirstLastFrame||(vt=_n==null?void 0:_n.settings)!=null&&vt.veoFramesMode),Qr=_s?ta(u,"veo_start"):null,es=_s?ta(u,"veo_end"):null,Vr=[Qr,es].filter(Boolean),un=(Vr.length>0?Vr:x).slice(0,2),ne=Vr.length>0?Vr[0]:b;let rr=[];if(un&&un.length>0)rr=await Promise.all(un.filter(qt=>qt&&typeof qt=="string"&&qt.trim().length>0).map(async qt=>{const on=qt.trim();if(on.startsWith("http://")||on.startsWith("https://"))try{const Rn=await Fr(on);return Rn.w>1920||Rn.h>1920?await L0(on,1920,1920):on}catch(Rn){return console.warn("Veo: URL",Rn),on}try{const Rn=await Fr(on);return Rn.w>1920||Rn.h>1920?await L0(on,1920,1920):on.startsWith("data:")?on:on.startsWith("blob:")?`data:image/png;base64, ${await yr(on,{useProxy:Ke(on)})} `:on.length>100&&!on.includes("://")&&!on.startsWith("data:")?`data:image/png;base64, ${on} `:`data:image/png;base64, ${await yr(on,{useProxy:Ke(on)})} `}catch(Rn){throw console.error("Veo: Failed to process image:",Rn),new Error(`: ${on.substring(0,50)}...`)}}));else if(ne){const qt=ne.trim();try{const on=await Fr(qt);on.w>1920||on.h>1920?rr=[await L0(qt,1920,1920)]:qt.startsWith("http://")||qt.startsWith("https://")?rr=[qt]:qt.startsWith("data:")?rr=[qt]:qt.startsWith("blob:")?rr=[`data:image/png;base64, ${await yr(qt,{useProxy:Ke(qt)})} `]:qt.length>100&&!qt.includes("://")&&!qt.startsWith("data:")?rr=[`data:image/png;base64, ${qt} `]:rr=[`data:image/png;base64, ${await yr(qt,{useProxy:Ke(qt)})} `]}catch(on){throw console.error("Veo: Failed to process source image:",on),new Error(`: ${on.message} `)}}if(rr.length===0&&((un==null?void 0:un.length)>0||ne))throw console.error("Veo: images ",{effectiveConnectedImages:un,effectiveSourceImage:ne}),new Error("");const ms=rr.filter((qt,on)=>!qt||typeof qt!="string"?(console.warn(`Veo:  ${on}: `),!1):qt==="base64_data"||qt.trim()==="base64_data"?(console.warn(`Veo:  ${on}: base64_data`),!1):!0);if(ms.length===0&&((un==null?void 0:un.length)>0||ne))throw console.error("Veo: ",{images:rr,effectiveConnectedImages:un,effectiveSourceImage:ne}),new Error("");let Qi=null;if(J&&J!=="Auto")if(J==="16:9"||J==="9:16")Qi=J;else{const qt=te/ee;Math.abs(qt-16/9)<Math.abs(qt-9/16)?Qi="16:9":Qi="9:16"}const ts={model:($e==null?void 0:$e.modelName)||"veo3.1",prompt:n,enhance_prompt:!1,images:ms.length>0?ms:[],...Qi?{aspect_ratio:Qi}:{}};Cn(ts),console.log("Veo: ",{endpoint:Nt,model:ts.model,prompt:((Mn=ts.prompt)==null?void 0:Mn.substring(0,50))+"...",imagesCount:ts.images.length,firstImageType:ts.images[0]?ts.images[0].startsWith("http")?"HTTP URL":ts.images[0].startsWith("data:")?"Data URL":"Unknown":"empty",firstImagePreview:ts.images[0]?ts.images[0].startsWith("http")?ts.images[0].substring(0,80):ts.images[0].substring(0,100):"empty",aspect_ratio:ts.aspect_ratio,payloadSize:JSON.stringify(ts).length});try{const qt=await fetch(Nt,{method:"POST",headers:{Authorization:`Bearer ${B} `,"Content-Type":"application/json"},body:JSON.stringify(ts)}),on=await qt.text();if(!qt.ok)throw console.error("Veo: ",{status:qt.status,text:on}),new Error(on||`Veo error: ${qt.status} `);const Rn=JSON.parse(on),Xa=((rn=Rn==null?void 0:Rn.data)==null?void 0:rn.id)||(Rn==null?void 0:Rn.id)||(Rn==null?void 0:Rn.task_id)||((cn=Rn==null?void 0:Rn.data)==null?void 0:cn.task_id);if(!Xa)throw console.error("Veo:  JobId",Rn),new Error("Veo No JobId");gt(Y0=>Y0.map(yo=>yo.id===W?{...yo,status:"generating",progress:10}:yo)),ia(Xa,W,Y,B,te,ee);return}catch(qt){throw console.error("Veo: ",qt),gt(on=>on.map(Rn=>Rn.id===W?{...Rn,status:"failed",errorMsg:qt.message||""}:Rn)),qt}}let Nn="",Bs;const aa={Authorization:`Bearer ${B} `},pp=(()=>{if(ce==null)return 8;const Nt=String(ce).trim().replace(/[^\d]/g,""),_n=parseInt(Nt,10);return Number.isFinite(_n)&&_n>0?_n:8})();if(j.includes("grok")){const Nt=`${Y} /v2/videos / generations`,_n=parseInt(ce,10),or=J&&J!=="Auto"?J:"3:2",_s=q&&q!=="Auto"?q:"1080P",Qr={model:($e==null?void 0:$e.modelName)||"grok-video-3",prompt:n,ratio:or,resolution:_s};if(Number.isFinite(_n)&&_n>0&&(Qr.duration=_n),b)try{let rr="";if(b.startsWith("data:"))rr=b;else{const ms=await Os(b,{useProxy:Ke(b)});rr=await new Promise((Qi,ts)=>{const qt=new FileReader;qt.onloadend=()=>Qi(qt.result),qt.onerror=ts,qt.readAsDataURL(ms)})}Qr.images=[rr]}catch(rr){console.error("Grok Image Conversion Failed:",rr),alert("");return}Cn(Qr);const es=await fetch(Nt,{method:"POST",headers:{Authorization:`Bearer ${B} `,"Content-Type":"application/json"},body:JSON.stringify(Qr)}),Vr=await es.text();if(!es.ok)throw console.error("[Grok API Error]",Vr),new Error(Vr||`Grok API error: ${es.status} `);let un;try{un=JSON.parse(Vr)}catch{throw new Error("API  JSON ")}const ne=((Tr=un==null?void 0:un.data)==null?void 0:Tr.id)||(un==null?void 0:un.id)||(un==null?void 0:un.task_id);if(!ne)throw console.error("Grok No Task ID:",un),new Error("API  Task ID");gt(rr=>rr.map(ms=>ms.id===W?{...ms,status:"generating",progress:10,remoteTaskId:ne}:ms)),Wa(ne,W,Y,B,te,ee,j);return}if(b){const Nt=new FormData,_n=await Os(b,{useProxy:Ke(b)});if(j.includes("sora")){Nn=`${Y} /v1/videos`;let or=n.replace(/@\{([^\}]+)\}/g,(_s,Qr)=>`@${Qr} `);Nt.append("model",($e==null?void 0:$e.modelName)||"sora-2"),Nt.append("prompt",or),Nt.append("seconds",ce),Nt.append("size",oe),j.includes("sora")&&($e!=null&&$e.supportsHD)&&(p.isHD||(Tn=v==null?void 0:v.settings)!=null&&Tn.isHD)&&Nt.append("quality","hd"),Nt.append("input_reference",_n,"ref.png"),Nt.append("image",_n,"ref.png")}else if(j.includes("jimeng")){Nn=`${Y}/v1/videos/generations`,Nt.append("model",($e==null?void 0:$e.modelName)||j||"jimeng-video-3.0"),Nt.append("prompt",n),Nt.append("duration",parseInt(ce));const or=J==="Auto"?"1:1":J;Nt.append("ratio",or);const _s=Ph(q);_s&&Nt.append("resolution",_s);const Qr=x.filter(Boolean).slice(0,2),es=await Promise.all(Qr.map(Vr=>Os(Vr,{useProxy:Ke(Vr)})));es[0]&&Nt.append("image_file_1",es[0],"first.png"),es[1]&&Nt.append("image_file_2",es[1],"last.png")}else j.includes("grok")?(Nn=`${Y} /v1/videos`,Nt.append("model",($e==null?void 0:$e.modelName)||"grok-video-3"),Nt.append("prompt",n),Nt.append("aspect_ratio",J),Nt.append("duration",pp),Nt.append("image",_n,"input.png")):(Nn=`${Y} /v1/videos`,Nt.append("model",$e==null?void 0:$e.modelName),Nt.append("prompt",n),Nt.append("image",_n,"input.png"),Nt.append("size",oe));Cn(Nt),Bs=Nt}else if(aa["Content-Type"]="application/json",j.includes("sora")){delete aa["Content-Type"],Nn=`${Y} /v1/videos`;const Nt=new FormData;let _n=n.replace(/@\{([^\}]+)\}/g,(or,_s)=>`@${_s} `);Nt.append("model",($e==null?void 0:$e.modelName)||"sora-2"),Nt.append("prompt",_n),Nt.append("seconds",ce),Nt.append("size",oe),j.includes("sora")&&($e!=null&&$e.supportsHD)&&(p.isHD||(nr=v==null?void 0:v.settings)!=null&&nr.isHD)&&Nt.append("quality","hd"),Cn(Nt),Bs=Nt}else if(j.includes("jimeng")){Nn=`${Y}/v1/videos/generations`;const Nt=J==="Auto"?"1:1":J,_n=Ph(q),or={model:($e==null?void 0:$e.modelName)||j||"jimeng-video-3.0",prompt:n,duration:parseInt(ce),ratio:Nt};_n&&(or.resolution=_n),Cn(or),Bs=JSON.stringify(or)}else if(j.includes("grok")){Nn=`${Y} /v1/videos`;const Nt={model:($e==null?void 0:$e.modelName)||"grok-video-3",prompt:n,aspect_ratio:J,duration:pp};Cn(Nt),Bs=JSON.stringify(Nt)}else{Nn=`${Y} /minimax/v1 / video_generation`;const Nt={model:$e==null?void 0:$e.modelName,prompt:n,resolution:oe};Cn(Nt),Bs=JSON.stringify(Nt)}const la=await fetch(Nn,{method:"POST",headers:Bs instanceof FormData?{Authorization:aa.Authorization}:aa,body:Bs}),pd=await la.text();if(!la.ok)throw new Error(pd||`Video API error: ${la.status} `);const tn=JSON.parse(pd),Jl=(tn==null?void 0:tn.code)||((sn=tn==null?void 0:tn.data)==null?void 0:sn.code),hs=(tn==null?void 0:tn.message)||((Sn=tn==null?void 0:tn.data)==null?void 0:Sn.message)||"";let fd=Jl;const hd=hs.match(/[:]\s*(\d+)/);if(hd&&(fd=parseInt(hd[1],10)),fd===1e3)throw console.error(` [Video API]  (1000): ${hs}`),new Error(`: ${hs||"Invalid parameter"} ( 1000)`);const Gl=fd===1006,K0=Jl===-2001&&hs.includes("34010105");if(Jl===-2008||hs.includes("2060")){let Nt=" ";throw hs.includes(": 30")&&(Nt+="\\n\\n \\n \\n \\n \\n "),hs.includes("2060")&&(Nt+="\\n\\n: 2060 ()"),new Error(Nt)}if(Gl||K0){const Nt=Gl?" (1006)":" (34010105)";console.warn(` [Video API] Key ending in ...${B.slice(-4)} failed: ${Nt}. Adding to blacklist.`),hi(B,Nt);const _n=new Error(`RETRY_WITH_NEW_KEY: ${hs}`);throw _n.shouldRetry=!0,_n}const Ga=(tn==null?void 0:tn.video_url)||(tn==null?void 0:tn.url)||((bn=tn==null?void 0:tn.data)==null?void 0:bn.video_url)||((Kn=tn==null?void 0:tn.data)==null?void 0:Kn.url)||Array.isArray(tn==null?void 0:tn.data)&&((Pr=tn.data[0])==null?void 0:Pr.url);if(Ga){const Nt=Date.now(),_n=Ba.get(W),or=_n==null?void 0:_n.sourceNodeId,_s=Nt-((_n==null?void 0:_n.startTime)||Nt);gt(Qr=>{const es=Qr.map(un=>un.id===W?{...un,status:"completed",progress:100,url:Ga,width:te,height:ee,durationMs:_s}:un),Vr=tr.current.get(W);if(Vr)Kt(Vr.nodeId,Vr.shotId,{video_url:Ga,status:"done",durationCost:_s/1e3}),tr.current.delete(W);else{const un=es.find(ne=>ne.id===W);un!=null&&un.sourceNodeId?setTimeout(()=>{Ti(W,Ga,"video",un.sourceNodeId)},0):console.warn("[Tapnow] :  sourceNodeId",{taskId:W,updatedItem:un})}return es});return}const fp=((Yn=tn==null?void 0:tn.data)==null?void 0:Yn.id)||(tn==null?void 0:tn.id)||(tn==null?void 0:tn.task_id)||((Fs=tn==null?void 0:tn.data)==null?void 0:Fs.task_id)||(tn==null?void 0:tn.job_id)||((bi=tn==null?void 0:tn.data)==null?void 0:bi.job_id);if(!fp)throw new Error(`No Task/Job ID returned. Response: ${JSON.stringify(tn).substring(0,200)}`);j.includes("veo")?ia(fp,W,Y,B,te,ee):Wa(fp,W,Y,B,te,ee,j)}}catch($e){if($e.shouldRetry)return Va(n,o,l,u,{...p,_isRetry:!0,_existingTaskId:W});console.error("[CONSOLE_ERROR]",$e);const Vt=Date.now(),vr=kt.find(Nn=>Nn.id===W),Ke=vr!=null&&vr.startTime?Vt-vr.startTime:0;let Cn=($e==null?void 0:$e.message)||"";try{if(typeof Cn=="string"&&Cn.trim().startsWith("{")){const Nn=JSON.parse(Cn);(mb=Nn==null?void 0:Nn.error)!=null&&mb.message?Cn=Nn.error.message:Nn!=null&&Nn.error?Cn=typeof Nn.error=="string"?Nn.error:JSON.stringify(Nn.error):Nn!=null&&Nn.message&&(Cn=Nn.message)}(Cn.includes("Cannot find module")||Cn.includes("octetstream")||Cn.includes("MODULE_NOT_FOUND"))&&(!Cn.includes("API")&&!Cn.includes("")?Cn=` API

${Cn.replace(/[:].*?[:]/g,"").trim()} 

 
1.jimeng - api.exe
2.Dockerdocker pull ghcr.io / iptag / jimeng - api: latest`:Cn.includes("")||(Cn=Cn+`

 
1. jimeng-api.exe
2. Dockerdocker pull ghcr.io/iptag/jimeng-api:latest`))}catch{(Cn.includes("Cannot find module")||Cn.includes("octetstream")||Cn.includes("MODULE_NOT_FOUND"))&&!Cn.includes("API")&&!Cn.includes("")&&(Cn=` API

 
1.jimeng - api.exe
2.Dockerdocker pull ghcr.io / iptag / jimeng - api: latest`)}gt(Nn=>Nn.map(Bs=>Bs.id===W?{...Bs,status:"failed",errorMsg:Cn,durationMs:Ke}:Bs))}},ok=()=>{t(n=>n==="dark"?"light":n==="light"?"solarized":"dark")},ak=async(n,o={})=>{if(!n||n.startsWith("data:"))return n;const u=(ir?S0.get(n)||(Qn.current.has(n)?Qn.current.get(n):null):null)||n,p=Gi(u,o.useProxy===!0),m=await Os(u,{useProxy:p});return await Fl(m)},lk=async()=>{const n=Us.current,o=Zi.current,l=ni.current,u=n.filter(p=>(o===p.id||l&&l.has(p.id))&&(p.type==="input-image"||p.type==="video-input"||p.type==="preview")&&p.content);if(u.length===0){alert("");return}for(const p of u)try{const m=p.content;if(!m||typeof m!="string"&&!m.startsWith("data:")){console.warn(` ${p.id} URL: `,m);continue}const h=await fetch(m);if(!h.ok)throw new Error(`HTTP ${h.status}: ${h.statusText} `);const x=await h.blob(),b=URL.createObjectURL(x),v=document.createElement("a");v.href=b;let y=".png";p.type==="preview"?p.previewType==="video"?y=".mp4":y=Qt(m)?".mp4":".png":p.type==="video-input"?y=".mp4":y=Qt(m)?".mp4":".png";const w=`${p.id}${y} `;v.download=w,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(b),await new Promise(j=>setTimeout(j,100))}catch(m){console.error(` ${p.id} : `,m)}},lp=()=>{const n=new Date;return new Date(n.getTime()+8*60*60*1e3).toISOString()},cp=()=>{const n=new Date,o=new Date(n.getTime()+8*60*60*1e3),l=o.getUTCFullYear(),u=String(o.getUTCMonth()+1).padStart(2,"0"),p=String(o.getUTCDate()).padStart(2,"0"),m=String(o.getUTCHours()).padStart(2,"0"),h=String(o.getUTCMinutes()).padStart(2,"0"),x=String(o.getUTCSeconds()).padStart(2,"0");return`${l} -${u} -${p}T${m} -${h} -${x} `},ck=async()=>{try{if(!window.showSaveFilePicker){if(!confirm(`

/>500MB Chrome  Edge 

`))return;const b=(Z,oe)=>oe===void 0?null:oe,v=JSON.parse(JSON.stringify(d,b)),y=async Z=>{if(Z==null)return Z;if(typeof Z=="string"&&Z.startsWith("blob:"))try{const oe=await Os(Z);return await Fl(oe)}catch(oe){return console.error(" Blob URL :",oe),Z}if(Array.isArray(Z))return await Promise.all(Z.map(oe=>y(oe)));if(typeof Z=="object"){const oe={};for(const te in Z)Z.hasOwnProperty(te)&&(oe[te]=await y(Z[te]));return oe}return Z},w=await y(v),j=JSON.parse(JSON.stringify(br,b)),R=await y(j),C={version:"2.5.7",projectName:kr,theme:e,nodes:w,connections:g,view:Xt,history:kt,chatSessions:qs,characterLibrary:R,modelLibrary:K,timestamp:lp()},H=JSON.stringify(C,b,2),B=new Blob([H],{type:"application/json"}),L=URL.createObjectURL(B),Y=document.createElement("a");Y.href=L;const J=cp(),q=`${kr||""}_${J}.json`;Y.download=q,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(L),alert("");return}const n=cp(),l=await(await window.showSaveFilePicker({suggestedName:`${kr||""}_${n}.json`,types:[{description:"JSON File",accept:{"application/json":[".json"]}}]})).createWritable(),u=(x,b)=>b===void 0?null:b,p=async x=>{const b={...x};if(b.content&&typeof b.content=="string"&&b.content.startsWith("blob:"))try{const v=await yr(b.content),y=Qt(b.content)?"video/mp4":"image/png";b.content=`data:${y};base64,${v}`}catch(v){console.error(" content :",v)}if(b.maskContent&&typeof b.maskContent=="string"&&b.maskContent.startsWith("blob:"))try{const v=await yr(b.maskContent);b.maskContent=`data:image/png;base64, ${v} `}catch(v){console.error(" maskContent :",v)}if(Array.isArray(b.selectedKeyframes))for(let v=0;v<b.selectedKeyframes.length;v++){const y=b.selectedKeyframes[v];if(y&&y.url&&typeof y.url=="string"&&y.url.startsWith("blob:"))try{const w=await yr(y.url);y.url=`data:image/png;base64, ${w} `}catch(w){console.error(":",w)}}if(Array.isArray(b.frames))for(let v=0;v<b.frames.length;v++){const y=b.frames[v];if(y&&y.url&&typeof y.url=="string"&&y.url.startsWith("blob:"))try{const w=await yr(y.url);y.url=`data:image/png;base64, ${w} `}catch(w){console.error(":",w)}}if(Array.isArray(b.previewMjImages))for(let v=0;v<b.previewMjImages.length;v++){const y=b.previewMjImages[v];if(y&&typeof y=="string"&&y.startsWith("blob:"))try{const w=await yr(y);b.previewMjImages[v]=`data:image/png;base64,${w}`}catch(w){console.error(" previewMjImages :",w)}}return b},m=async x=>{const b={...x};if(b.url&&typeof b.url=="string"&&b.url.startsWith("blob:"))try{const v=await yr(b.url),y=b.type==="video"?"video/mp4":"image/png";b.url=`data:${y};base64,${v}`}catch(v){console.error(" url :",v)}if(b.mjOriginalUrl&&typeof b.mjOriginalUrl=="string"&&b.mjOriginalUrl.startsWith("blob:"))try{const v=await yr(b.mjOriginalUrl);b.mjOriginalUrl=`data:image/png;base64, ${v} `}catch(v){console.error(" mjOriginalUrl :",v)}if(Array.isArray(b.mjImages))for(let v=0;v<b.mjImages.length;v++){const y=b.mjImages[v];if(y&&typeof y=="string"&&y.startsWith("blob:"))try{const w=await yr(y);b.mjImages[v]=`data:image/png;base64, ${w} `}catch(w){console.error(" mjImages :",w)}}return b},h=async x=>{const b={...x};if(b.avatar&&typeof b.avatar=="string"&&b.avatar.startsWith("blob:"))try{const v=await yr(b.avatar);b.avatar=`data:image/png;base64, ${v} `}catch(v){console.error(" avatar :",v)}if(b.profile_picture_url&&typeof b.profile_picture_url=="string"&&b.profile_picture_url.startsWith("blob:"))try{const v=await yr(b.profile_picture_url);b.profile_picture_url=`data:image/png;base64, ${v} `}catch(v){console.error(" profile_picture_url :",v)}return b};await l.write(`{
    
  "version": "2.5.7", 
  "projectName": ${JSON.stringify(kr||"")}, 
  "theme": ${JSON.stringify(e||"dark")}, 
  "nodes": [
`);for(let x=0;x<d.length;x++){const b=d[x],v=await p(b),y=JSON.stringify(v,u,2),w=x===0?y.split(`
`).join(`
    `):"    "+y.split(`
`).join(`
    `);await l.write(w),x<d.length-1?await l.write(`,
`):await l.write(`
`)}await l.write(`  ], 
  "connections": ${JSON.stringify(g,u,2)}, 
  "view": ${JSON.stringify(Xt,u,2)}, 
  "history": [
`);for(let x=0;x<kt.length;x++){const b=kt[x],v=await m(b),y=JSON.stringify(v,u,2),w=x===0?y.split(`
`).join(`
    `):"    "+y.split(`
`).join(`
    `);await l.write(w),x<kt.length-1?await l.write(`,
`):await l.write(`
`)}await l.write(`  ], 
  "chatSessions": ${JSON.stringify(qs,u,2)}, 
  "characterLibrary": [
`);for(let x=0;x<br.length;x++){const b=br[x],v=await h(b),y=JSON.stringify(v,u,2),w=x===0?y.split(`
`).join(`
    `):"    "+y.split(`
`).join(`
    `);await l.write(w),x<br.length-1?await l.write(`,
`):await l.write(`
`)}await l.write(`  ], 
  "modelLibrary": [
`);for(let x=0;x<K.length;x++){const b=K[x],v=JSON.stringify(b,u,2),y=x===0?v.split(`
`).join(`
    `):"    "+v.split(`
`).join(`
    `);await l.write(y),x<K.length-1?await l.write(`,
`):await l.write(`
`)}await l.write(`  ], 
  "timestamp": ${JSON.stringify(lp())} 

} `),await l.close(),alert("")}catch(n){if(console.error(":",n),n.name==="AbortError")return;alert(": "+(n.message||""))}},dk=async()=>{try{d0({visible:!1,x:0,y:0});const n=Hn.size>0?Hn:Ce?new Set([Ce]):new Set;if(n.size===0){alert("");return}const o=d.filter(b=>n.has(b.id)),l=g.filter(b=>n.has(b.from)&&n.has(b.to));if(!window.showSaveFilePicker){if(!confirm(`

`))return;const v=(J,q)=>q===void 0?null:q,y=JSON.parse(JSON.stringify(o,v)),w=async J=>{if(J==null)return J;if(typeof J=="string"&&J.startsWith("blob:"))try{const q=await Os(J);return await Fl(q)}catch(q){return console.error(" Blob URL :",q),J}if(Array.isArray(J))return await Promise.all(J.map(q=>w(q)));if(typeof J=="object"){const q={};for(const Z in J)J.hasOwnProperty(Z)&&(q[Z]=await w(J[Z]));return q}return J},R={version:"3.7.36c",type:"workflow",nodes:await w(y),connections:l,timestamp:lp()},C=JSON.stringify(R,v,2),H=new Blob([C],{type:"application/json"}),B=URL.createObjectURL(H),L=document.createElement("a");L.href=B;const Y=cp();L.download=`_${Y}.json`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(B),alert("");return}const u=cp(),m=await(await window.showSaveFilePicker({suggestedName:`_${u}.json`,types:[{description:"JSON File",accept:{"application/json":[".json"]}}]})).createWritable(),h=(b,v)=>v===void 0?null:v,x=async b=>{const v={...b};if(v.content&&typeof v.content=="string"&&v.content.startsWith("blob:"))try{const y=await yr(v.content),w=Qt(v.content)?"video/mp4":"image/png";v.content=`data:${w};base64,${y}`}catch(y){console.error(" content :",y)}if(v.maskContent&&typeof v.maskContent=="string"&&v.maskContent.startsWith("blob:"))try{const y=await yr(v.maskContent);v.maskContent=`data:image/png;base64,${y}`}catch(y){console.error(" maskContent :",y)}if(Array.isArray(v.selectedKeyframes))for(let y=0;y<v.selectedKeyframes.length;y++){const w=v.selectedKeyframes[y];if(w&&w.url&&typeof w.url=="string"&&w.url.startsWith("blob:"))try{const j=await yr(w.url);w.url=`data:image/png;base64,${j}`}catch(j){console.error(":",j)}}if(Array.isArray(v.frames))for(let y=0;y<v.frames.length;y++){const w=v.frames[y];if(w&&w.url&&typeof w.url=="string"&&w.url.startsWith("blob:"))try{const j=await yr(w.url);w.url=`data:image/png;base64,${j}`}catch(j){console.error(":",j)}}if(Array.isArray(v.previewMjImages))for(let y=0;y<v.previewMjImages.length;y++){const w=v.previewMjImages[y];if(w&&typeof w=="string"&&w.startsWith("blob:"))try{const j=await yr(w);v.previewMjImages[y]=`data:image/png;base64,${j}`}catch(j){console.error(":",j)}}return v};await m.write(`{
  "version": "3.7.36c",
  "type": "workflow",
  "nodes": [
`);for(let b=0;b<o.length;b++){const v=await x(o[b]),w=JSON.stringify(v,h,4).split(`
`).map(j=>"    "+j).join(`
`);await m.write(w),b<o.length-1?await m.write(`,
`):await m.write(`
`)}await m.write(`  ],
  "connections": ${JSON.stringify(l,h,2)},
  "timestamp": ${JSON.stringify(lp())}
}`),await m.close(),alert("")}catch(n){if(console.error(":",n),n.name==="AbortError")return;alert(": "+(n.message||""))}},uk=async()=>{const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=async o=>{const l=o.target.files[0];if(l)try{const u=await l.text(),p=JSON.parse(u);if(p.type!=="workflow"){alert(`

""`);return}if(!p.nodes||p.nodes.length===0){alert("");return}let m=[];const h=(kn||"http://127.0.0.1:9527").replace(/\/+$/,"");try{if(h){const L=await fetch(`${h}/list-files`);if(L.ok){const Y=await L.json();Y.success&&Y.files&&(m=Y.files,console.log(`[]  ${m.length} `))}}}catch{console.log("[] ")}const x=L=>{if(!m.length||!L)return null;try{const Y=L.split(",")[1];if(!Y)return null;const J=Math.floor(Y.length*.75),q=J*.05,Z=m.find(oe=>Math.abs(oe.size-J)<q);if(Z)return`${h}/file/${encodeURIComponent(Z.rel_path)}`}catch{}return null},b=async L=>{const Y=[L];for(;Y.length>0;){const J=Y.pop();if(!(!J||typeof J!="object"))for(const q in J){const Z=J[q];if(typeof Z=="string"&&(Z.startsWith("data:image/")||Z.startsWith("data:video/")))try{const oe=x(Z);if(oe&&(await fetch(oe,{method:"HEAD"})).ok){J[q]=oe;continue}const ee=await(await fetch(Z)).blob();J[q]=URL.createObjectURL(ee)}catch{}else typeof Z=="object"&&Z!==null&&Y.push(Z)}}return L},v=new Map;p.nodes.forEach(L=>{v.set(L.id,`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`)});const y=Xi.current;let w=100,j=100;if(y){const L=y.getBoundingClientRect(),Y=L.width/2,J=L.height/2,q=Pn(Y+L.left,J+L.top);w=q.x,j=q.y}let R=1/0,C=1/0;p.nodes.forEach(L=>{L.x<R&&(R=L.x),L.y<C&&(C=L.y)});const H=[];for(const L of p.nodes){const Y=await b({...L});Y.id=v.get(L.id),Y.x=L.x-R+w,Y.y=L.y-C+j,H.push(Y)}const B=(p.connections||[]).map(L=>({...L,from:v.get(L.from),to:v.get(L.to)})).filter(L=>L.from&&L.to);f(L=>[...L,...H]),z(L=>[...L,...B]),Hr(new Set(H.map(L=>L.id))),alert(`

 ${H.length}  ${B.length} `)}catch(u){console.error(":",u),alert(": "+(u.message||"JSON"))}},n.click()},pk=()=>{const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=async o=>{const l=o.target.files[0];if(!l)return;Ro({visible:!0,progress:0,status:"INITIALIZING...",type:"import"});let u=[];const p=(kn||"http://127.0.0.1:9527").replace(/\/+$/,"");try{if(p){const H=await fetch(`${p}/list-files`);if(H.ok){const B=await H.json();B.success&&B.files&&(u=B.files,console.log(`[]  ${u.length} `))}}}catch{console.log("[] ")}const m=H=>{if(!u.length||!H)return null;try{const B=H.split(",")[1];if(!B)return null;const L=Math.floor(B.length*.75),Y=L*.05,J=u.find(q=>Math.abs(q.size-L)<Y);if(J)return`${p}/file/${encodeURIComponent(J.rel_path)}`}catch{}return null},h={nodes:[],history:[],connections:[],chatSessions:[],characterLibrary:[],projectName:"",view:null,theme:"",modelLibrary:[],modelLibraryLoaded:!1};let x=null,b="",v="",y=0,w=!1,j=0;const R=l.size,C=async H=>{const B=[H];for(;B.length>0;){const L=B.pop();if(!(!L||typeof L!="object"))for(const Y in L){const J=L[Y];if(typeof J=="string"&&(J.startsWith("data:image/")||J.startsWith("data:video/")))try{const q=m(J);if(q&&(await fetch(q,{method:"HEAD"})).ok){L[Y]=q;continue}const oe=await(await fetch(J)).blob();L[Y]=URL.createObjectURL(oe)}catch{}else typeof J=="object"&&J!==null&&B.push(J)}}return H};try{const B=l.stream().pipeThrough(new TextDecoderStream).getReader();for(;;){const{value:L,done:Y}=await B.read();if(Y)break;if(j+=L.length,Math.random()>.95){const J=Math.min(99,j/R*100);Ro(q=>({...q,progress:J,status:`PROCESSING ${(j/1024/1024).toFixed(0)} MB`}))}for(b+=L;;){const J=b.indexOf(`
`);if(J===-1)break;const q=b.substring(0,J);b=b.substring(J+1);const Z=q.trim();if(Z){if(Z.includes('"nodes": [')){x="nodes";continue}if(Z.includes('"history": [')){x="history";continue}if(Z.includes('"connections": [')){x="connections";continue}if(Z.includes('"chatSessions": [')){x="chatSessions";continue}if(Z.includes('"characterLibrary": [')){x="characterLibrary";continue}if(Z.includes('"modelLibrary": [')){x="modelLibrary",h.modelLibraryLoaded=!0;continue}if((Z==="],"||Z==="]")&&y===0){x=null,v="",w=!1;continue}if(!x){if(Z.startsWith('"projectName":'))try{const oe=Z.match(/"projectName":\s*(.+)/);oe&&(h.projectName=JSON.parse(oe[1].replace(/,$/,"")))}catch{}if(Z.startsWith('"theme":'))try{const oe=Z.match(/"theme":\s*(.+)/);oe&&(h.theme=JSON.parse(oe[1].replace(/,$/,"")))}catch{}if(Z.startsWith('"view":'))try{const oe=Z.match(/"view":\s*(.+)/);oe&&oe[1].endsWith("}")&&(h.view=JSON.parse(oe[1].replace(/,$/,"")))}catch{}continue}if(x){for(let oe of q)oe==="{"&&(y++,w=!0),oe==="}"&&y--;if(v+=q+`
`,w&&y===0){let oe=v.trim();oe.endsWith(",")&&(oe=oe.slice(0,-1));try{const te=JSON.parse(oe);(x==="nodes"||x==="history"||x==="characterLibrary")&&await C(te),x==="nodes"&&te.id?(te.settings||(te.settings={}),h.nodes.push(te)):x==="history"?h.history.push(te):x==="connections"?h.connections.push(te):x==="chatSessions"?h.chatSessions.push(te):x==="characterLibrary"?h.characterLibrary.push(te):x==="modelLibrary"&&h.modelLibrary.push(te)}catch{}v="",w=!1}}}}}Ro(L=>({...L,progress:100,status:"FINALIZING..."})),setTimeout(()=>{if(Tc(h.projectName||""),h.view&&zr(h.view),h.connections.length>0&&z(h.connections),h.chatSessions.length>0&&Ta(h.chatSessions),h.characterLibrary.length>0&&Ml(h.characterLibrary),h.modelLibraryLoaded){const L=h.modelLibrary.map(Y=>({id:Y.id,displayName:Y.displayName||Y.id,modelName:Y.modelName||Y.id,type:Y.type||"Chat",apiType:Y.apiType||"openai",ratioLimits:Array.isArray(Y.ratioLimits)?Y.ratioLimits:null,ratioNotes:rs(Y.ratioNotes),ratioNotesEnabled:!!Y.ratioNotesEnabled,resolutionLimits:Array.isArray(Y.resolutionLimits)?Y.resolutionLimits:null,resolutionNotes:el(Y.resolutionNotes),resolutionNotesEnabled:!!Y.resolutionNotesEnabled,durations:Array.isArray(Y.durations)?Y.durations:null,durationNotes:rs(Y.durationNotes),durationNotesEnabled:!!Y.durationNotesEnabled,videoResolutions:Array.isArray(Y.videoResolutions)?Y.videoResolutions:null,videoResolutionNotes:rs(Y.videoResolutionNotes),videoResolutionNotesEnabled:!!Y.videoResolutionNotesEnabled,supportsFirstLastFrame:!!Y.supportsFirstLastFrame,supportsHD:!!Y.supportsHD,customParams:tc(Y.customParams)})).filter(Y=>Y.id);de(L)}["dark","light","solarized"].includes(h.theme)&&t(h.theme),h.nodes.length>0&&f(h.nodes),h.history.length>0&&gt(h.history),Ro(L=>({...L,visible:!1})),alert(`
${h.nodes.length} `)},200)}catch(H){console.error(":",H),Ro(B=>({...B,visible:!1})),alert(`: ${H.message} `)}},n.click()},Ur=(n,o,l,u,p=void 0,m=void 0,h=void 0,x=void 0)=>{ae();const b=n==="gen-video"?{w:380,h:420}:n==="gen-image"?{w:440,h:340}:n==="video-input"?{w:580,h:460}:n==="video-analyze"?{w:480,h:500}:n==="storyboard-node"?{w:720,h:500}:n==="image-compare"?{w:400,h:300}:n==="preview"?{w:320,h:260}:n==="text-node"?{w:280,h:200}:n==="novel-input"?{w:400,h:500}:n==="extract-characters-scenes"?{w:400,h:500}:n==="character-description"||n==="scene-description"?{w:400,h:400}:n==="create-character"||n==="create-scene"?{w:350,h:300}:n==="generate-character-video"||n==="generate-scene-video"?{w:400,h:450}:n==="generate-character-image"||n==="generate-scene-image"?{w:400,h:450}:n==="local-save"?{w:320,h:380}:{w:260,h:260},v={id:`node - ${Date.now()} `,type:n,x:o-b.w/2,y:l-b.h/2,width:b.w,height:b.h,content:p,...m?{dimensions:m}:{},settings:n==="gen-image"?{model:Ut(Ko),ratio:ho,resolution:Oa,prompt:""}:n==="gen-video"?{model:Ut(La),duration:"5s",ratio:ho,resolution:Ua,videoPrompt:""}:n==="video-analyze"?{model:Ut(Nz),segmentDuration:parseInt(kz),analysisMode:"manual",voiceoverResults:[],analysisResults:[]}:n==="storyboard-node"?{projectTitle:"",shots:[]}:n==="text-node"?{text:p||""}:n==="novel-input"?{content:""}:n==="extract-characters-scenes"?{model:Ut(Yo||""),analysisResults:null,lastAnalyzed:null,isAnalyzing:!1,progress:0,errorMsg:null}:n==="character-description"||n==="scene-description"?{characterId:"",characterName:"",role:"",age:"",gender:"",sceneId:"",sceneName:"",description:"",prompt:"",mode:"video",style:"none",imageModel:Ut(Ko),imageRatio:ho||"16:9",imageResolution:Oa,referenceImages:[],chatModel:Ut(Yo||""),isEnhancing:!1}:n==="create-character"||n==="create-scene"?{name:"",startSecond:1,endSecond:3,isCreating:!1,createProgress:0,createError:null}:n==="generate-character-video"||n==="generate-scene-video"?{model:Ut(La),duration:"15s",ratio:ho||"16:9",resolution:Ua,videoPrompt:"",referenceImages:[],sourceType:"",sourceId:"",isGenerating:!1,progress:0,error:null}:n==="generate-character-image"||n==="generate-scene-image"?{model:Ut(Ko),ratio:ho||"16:9",resolution:Oa,prompt:"",referenceImages:[],chatModel:Ut(Yo||""),imageUrls:[],selectedImageIndex:null,isGenerating:!1,progress:0,error:null}:n==="local-save"?{serverUrl:kn,savePath:"",subfolder:"",autoSave:!1,serverStatus:fs?"connected":"disconnected",lastSaved:null,savedFiles:[],lastSavedUrls:[]}:{}};return f(y=>[...y,v]),u&&z(y=>[...y,{id:`conn - ${Date.now()} `,from:u,to:v.id}]),h&&z(y=>x&&x!=="default"?[...y.filter(j=>!(j.to===h&&(j.inputType||"default")===x)),{id:`conn - ${Date.now()} `,from:v.id,to:h,inputType:x!=="default"?x:void 0}]:[...y,{id:`conn - ${Date.now()} `,from:v.id,to:h}]),El(y=>({...y,visible:!1})),Ho(!1),Sl(null),Rs(null),Ls(null),v},fk=n=>{if(!n)return"";if(typeof n=="number")return`${n}`;const o=String(n).trim();return o?o.includes("")||o.includes("")?o:`${o}`:""},hk=[{value:"none",label:""},{value:"2d-anime",label:"2D"},{value:"3d-anime",label:"3D"},{value:"realistic",label:""},{value:"selfie",label:""},{value:"news",label:""},{value:"manga",label:""}],mk=M.useCallback(n=>{switch(n){case"2d-anime":return"2D";case"3d-anime":return"3D";case"realistic":return"";case"selfie":return"";case"news":return"";case"manga":return"";default:return""}},[]),Gx=n=>{if(!n)return"";let o=n.replace(/360/g,"");return["",""].forEach(u=>{const p=o.indexOf(u);p!==-1&&(o=o.slice(0,p))}),o},Xx=n=>n&&(n.includes("360")?n:`${n}360`),Ka=M.useCallback((n,o="video")=>{const l=(n==null?void 0:n.name)||(n==null?void 0:n.characterName)||"",u=((n==null?void 0:n.role)||(n==null?void 0:n.identity)||(n==null?void 0:n.profession)||"").trim(),p=((n==null?void 0:n.description)||(n==null?void 0:n.appearance)||"").trim(),m=fk(n==null?void 0:n.age),h=n!=null&&n.gender?String(n.gender).trim():"",x=`${m}${h}`.trim()||"",b=[u,p].filter(Boolean).join(""),v=b?`${b}`:"",y=u||p?`${u||p}`:"",w=`${l}${x}${v}`,j=`${w}${l}${y}`;return o==="video"?`${j}360`:w},[]),ad=M.useCallback(n=>{const o=(n==null?void 0:n.location)||(n==null?void 0:n.name)||(n==null?void 0:n.sceneName)||"",l=(n==null?void 0:n.description)||"";return o?`${o}${l}`:l},[]),Zx=async(n,o)=>{var H,B,L,Y,J,q;const l=At.get(n);if(!l||l.type!=="character-description"&&l.type!=="scene-description")return;const u=Ut(((H=l.settings)==null?void 0:H.chatModel)||Yo||"");if(!u){a("","warning",3e3),wn({nodeId:n,type:"desc-model"});return}const p=ri(u);if(!p.key){a(" API Key","error",4e3),ei(!0);return}const m=(((B=l.settings)==null?void 0:B.prompt)||"").trim();if(!m){a("","warning",3e3);return}const h=Ht(u),x=(p.url||ss).replace(/\/+$/,""),b=(h==null?void 0:h.modelName)||u,v=l.type==="character-description",y='"[]"',w="";let j="",R=m,C=.7;v&&o==="filter"?(j=y,C=.3):!v&&o==="enhance"?(j=w,C=.3):j=o==="enhance"?"JSON":"//JSON",Le(n,{isEnhancing:!0});try{const Z=await fetch(`${x}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${p.key}`,"Content-Type":"application/json"},body:JSON.stringify({model:b,messages:[{role:"system",content:j},{role:"user",content:R}],temperature:C})});if(!Z.ok){let ce="";try{const W=await Z.json();ce=((L=W==null?void 0:W.error)==null?void 0:L.message)||(W==null?void 0:W.message)||""}catch{}throw new Error(`API Error: ${Z.status}${ce?` - ${ce}`:""}`)}const oe=await Z.json(),ee=(((q=(J=(Y=oe.choices)==null?void 0:Y[0])==null?void 0:J.message)==null?void 0:q.content)||oe.content||"").replace(/```[\s\S]*?```/g,"").trim();ee?(Le(n,{prompt:ee}),a(o==="enhance"?"":"","success",2e3)):a("","warning",3e3)}catch(Z){console.error("[]",Z),a(`: ${Z.message||""}`,"error",4e3)}finally{Le(n,{isEnhancing:!1})}},gk=M.useCallback((n,o)=>{var L,Y,J,q;const l=At.get(n);if(!l)return;const u=Array.isArray(o==null?void 0:o.characters)?o.characters:[],p=Array.isArray(o==null?void 0:o.scenes)?o.scenes:[];if(u.length===0&&p.length===0)return;ae();const m=l.x+l.width+100,h=l.y,x=450,b=Date.now(),v=Ut(La)||Ut((L=je.find(Z=>Z.type==="Video"&&(Z.id==="sora-2"||Z.id==="sora-2-pro")))==null?void 0:L.id)||Ut((Y=je.find(Z=>Z.type==="Video"))==null?void 0:Y.id)||"",y=Ut(Ko)||Ut((J=je.find(Z=>ns(Z.type)))==null?void 0:J.id)||"",w=Ut(Yo)||Ut((q=je.find(Z=>Z.type==="Chat"))==null?void 0:q.id)||"",j=ho||"16:9",R=Ua||"720p",C=Oa||"2K",H=[],B=[];if(u.length>0&&u.forEach((Z,oe)=>{const te=`node - char-desc - ${b} - ${oe}`,ee=`node - char-video - ${b} - ${oe}`,ce=`node - char-create - ${b} - ${oe}`,W=Ka(Z,"video");H.push({id:te,type:"character-description",x:m,y:h+oe*x,width:400,height:400,settings:{characterId:(Z==null?void 0:Z.id)||"",characterName:(Z==null?void 0:Z.name)||"",role:(Z==null?void 0:Z.role)||"",age:(Z==null?void 0:Z.age)||"",gender:(Z==null?void 0:Z.gender)||"",description:(Z==null?void 0:Z.description)||"",prompt:W,mode:"video",imageModel:y,imageRatio:j,imageResolution:C,referenceImages:[],chatModel:w}}),H.push({id:ee,type:"generate-character-video",x:m+420,y:h+oe*x,width:400,height:450,settings:{model:v,duration:"15s",ratio:j,resolution:R,videoPrompt:W,referenceImages:[],sourceType:"character-description",sourceId:te}}),H.push({id:ce,type:"create-character",x:m+840,y:h+oe*x,width:350,height:300,settings:{name:(Z==null?void 0:Z.name)||"",startSecond:1,endSecond:3}}),B.push({id:`conn - char-desc - ${b} - ${oe}`,from:n,to:te},{id:`conn - char-video - ${b} - ${oe}`,from:te,to:ee},{id:`conn - char-create - ${b} - ${oe}`,from:ee,to:ce})}),p.length>0){const Z=u.length;p.forEach((oe,te)=>{const ee=Z+te,ce=`node - scene-desc - ${b} - ${te}`,W=`node - scene-video - ${b} - ${te}`,Se=`node - scene-create - ${b} - ${te}`,ze=ad(oe),Ee=(oe==null?void 0:oe.location)||(oe==null?void 0:oe.name)||(oe==null?void 0:oe.sceneName)||"";H.push({id:ce,type:"scene-description",x:m,y:h+ee*x,width:400,height:400,settings:{sceneId:(oe==null?void 0:oe.id)||"",sceneName:Ee,description:(oe==null?void 0:oe.description)||"",prompt:ze,mode:"video",style:(oe==null?void 0:oe.style)||"",imageModel:y,imageRatio:j,imageResolution:C,referenceImages:[],chatModel:w}}),H.push({id:W,type:"generate-scene-video",x:m+420,y:h+ee*x,width:400,height:450,settings:{model:v,duration:"15s",ratio:j,resolution:R,videoPrompt:ze,referenceImages:[],sourceType:"scene-description",sourceId:ce}}),H.push({id:Se,type:"create-scene",x:m+840,y:h+ee*x,width:350,height:300,settings:{name:Ee,startSecond:1,endSecond:3}}),B.push({id:`conn - scene-desc - ${b} - ${te}`,from:n,to:ce},{id:`conn - scene-video - ${b} - ${te}`,from:ce,to:W},{id:`conn - scene-create - ${b} - ${te}`,from:W,to:Se})})}H.length>0&&f(Z=>[...Z,...H]),B.length>0&&z(Z=>[...Z,...B])},[At,je,La,Ko,Yo,ho,Ua,Oa,Ka,ad]),xk=n=>{var L,Y,J,q,Z,oe,te,ee,ce,W,Se,ze,Ee,Be,nt,st,ht,Yt;const o=At.get(n);if(!o)return;const l=o.type==="character-description",u=l?"generate-character-image":"generate-scene-image";if(g.find(Wt=>{var Jt;return Wt.from===n&&((Jt=At.get(Wt.to))==null?void 0:Jt.type)===u}))return;const m={name:((L=o.settings)==null?void 0:L.characterName)||((Y=o.settings)==null?void 0:Y.name)||"",role:((J=o.settings)==null?void 0:J.role)||"",description:((q=o.settings)==null?void 0:q.description)||"",age:((Z=o.settings)==null?void 0:Z.age)||"",gender:((oe=o.settings)==null?void 0:oe.gender)||""},h={name:((te=o.settings)==null?void 0:te.sceneName)||((ee=o.settings)==null?void 0:ee.location)||"",location:((ce=o.settings)==null?void 0:ce.sceneName)||((W=o.settings)==null?void 0:W.location)||"",description:((Se=o.settings)==null?void 0:Se.description)||""},x=l?Ka(m,"image"):ad(h),b=o.x+o.width+200,v=o.y+o.height/2,y=Ur(u,b,v,n);if(!(y!=null&&y.id))return;const w=Ut(((ze=o.settings)==null?void 0:ze.imageModel)||Ko||((Ee=je.find(Wt=>ns(Wt.type)))==null?void 0:Ee.id)||""),j=((Be=o.settings)==null?void 0:Be.imageRatio)||ho||"16:9",R=((nt=o.settings)==null?void 0:nt.imageResolution)||Oa||"2K",C=Ut(((st=o.settings)==null?void 0:st.chatModel)||Yo||""),H=((ht=o.settings)==null?void 0:ht.prompt)||x,B=l?Gx(H):H;Le(y.id,{model:w,ratio:j,resolution:R,prompt:B,referenceImages:((Yt=o.settings)==null?void 0:Yt.referenceImages)||[],chatModel:C,sourceType:o.type,sourceId:o.id})},bk=n=>{var B,L,Y,J,q,Z,oe,te,ee,ce,W,Se,ze,Ee,Be,nt;const o=At.get(n);if(!o)return;const l=o.type==="character-description",u=l?"generate-character-video":"generate-scene-video";if(g.find(st=>{var ht;return st.from===n&&((ht=At.get(st.to))==null?void 0:ht.type)===u}))return;const m={name:((B=o.settings)==null?void 0:B.characterName)||((L=o.settings)==null?void 0:L.name)||"",role:((Y=o.settings)==null?void 0:Y.role)||"",description:((J=o.settings)==null?void 0:J.description)||"",age:((q=o.settings)==null?void 0:q.age)||"",gender:((Z=o.settings)==null?void 0:Z.gender)||""},h={name:((oe=o.settings)==null?void 0:oe.sceneName)||((te=o.settings)==null?void 0:te.location)||"",location:((ee=o.settings)==null?void 0:ee.sceneName)||((ce=o.settings)==null?void 0:ce.location)||"",description:((W=o.settings)==null?void 0:W.description)||""},x=l?Ka(m,"video"):ad(h),b=((Se=o.settings)==null?void 0:Se.prompt)||x,v=l?Xx(b):b,y=o.x+o.width+200,w=o.y+o.height/2,j=Ur(u,y,w,n);if(!(j!=null&&j.id))return;const R=Ut(La)||Ut((ze=je.find(st=>st.type==="Video"&&(st.id==="sora-2"||st.id==="sora-2-pro")))==null?void 0:ze.id)||Ut((Ee=je.find(st=>st.type==="Video"))==null?void 0:Ee.id)||"",C=((Be=o.settings)==null?void 0:Be.imageRatio)||ho||"16:9",H=Ua||"720p";Le(j.id,{model:R,duration:"15s",ratio:C,resolution:H,videoPrompt:v,referenceImages:((nt=o.settings)==null?void 0:nt.referenceImages)||[],sourceType:o.type,sourceId:o.id})},yk=M.useCallback(n=>{const o=[];for(const l of g)if(l.from===n){const u=At.get(l.to);u&&(u.type==="gen-image"||u.type==="gen-video")&&o.push(u)}return o},[g,At]),Ya=n=>{if(!n)return"5s";const o=Ht(n);if(Array.isArray(o==null?void 0:o.durations)&&o.durations.length>0)return o.durations[0];const l=(o==null?void 0:o.id)||n;return l==="sora-2-pro"||l.includes("sora-2")||l==="sora-2"?"15s":l.includes("veo")||l==="google-veo3"||l.includes("grok")||l==="grok-3"?"8s":"5s"},ld=n=>{if(!n)return["5s","10s"];const o=Ht(n);if(Array.isArray(o==null?void 0:o.durations)&&o.durations.length>0)return o.durations;const l=(o==null?void 0:o.id)||n;return l==="sora-2-pro"?["15s","25s"]:l.includes("sora-2")||l==="sora-2"?["5s","10s","15s"]:l.includes("veo")||l==="google-veo3"?["8s"]:l.includes("grok")||l==="grok-3"?["8s","5s"]:l.includes("jimeng")?["5s","10s"]:["5s","10s"]},qx=n=>{var x,b,v,y,w,j;const o=At.get(n);if(!o||o.type!=="storyboard-node")return;const l=((x=o.settings)==null?void 0:x.mode)||"video";let u,p,m;l==="image"?(u=Ut(localStorage.getItem("tapnow_last_image_model")||((b=je.find(R=>ns(R.type)))==null?void 0:b.id)||""),p="1:1",m=void 0):(u=Ut(La||localStorage.getItem("tapnow_last_video_model")||((v=je.find(R=>R.type==="Video"))==null?void 0:v.id)||""),p="16:9",m=Ya(u));const h={id:`shot-${Date.now()}`,scene_index:(((w=(y=o.settings)==null?void 0:y.shots)==null?void 0:w.length)||0)+1,time_range:"",image_url:"",description:"",prompt:"",camera:"",tags:[],status:"draft",model:u,ratio:p,duration:m,outputEnabled:!1,selectedImageIndex:-1};Le(n,{shots:[...((j=o.settings)==null?void 0:j.shots)||[],h]})},vk=(n,o)=>{var p;const l=At.get(n);if(!l||l.type!=="storyboard-node")return;const u=(((p=l.settings)==null?void 0:p.shots)||[]).filter(m=>m.id!==o);u.forEach((m,h)=>{m.scene_index=h+1}),Le(n,{shots:u})},Kt=(n,o,l,u={})=>{let p=!1,m=l.status;if(f(h=>{var R,C,H;const x=h.find(B=>B.id===n);if(!x||x.type!=="storyboard-node")return console.warn("[updateShot] :",{nodeId:n,found:!!x,type:x==null?void 0:x.type}),h;if(u.onlyIfStatus){const B=(((R=x.settings)==null?void 0:R.shots)||[]).find(L=>L.id===o);if(B&&B.status!==u.onlyIfStatus)return console.warn(`[updateShot] : ${o},  ${B.status} !==  ${u.onlyIfStatus}`),h}const b=(((C=x.settings)==null?void 0:C.shots)||[]).find(B=>B.id===o),v={...l},y=Object.prototype.hasOwnProperty.call(v,"durationCost"),w=new Set(["done","completed","failed","error"]);if(v.status==="generating"&&!y&&(v.durationCost=0),v.status&&w.has(v.status)&&!y&&b!=null&&b.generationStartTime){const B=(Date.now()-b.generationStartTime)/1e3;v.durationCost=Number(B.toFixed(1))}p=!0,m=v.status;const j=(((H=x.settings)==null?void 0:H.shots)||[]).map(B=>B.id===o?{...B,...v}:B);return h.map(B=>B.id===n?{...B,settings:{...B.settings,shots:j}}:B)}),p&&m){const h=`${n}-${o}`;o0(m==="generating"?x=>({...x,[h]:"0.0s"}):x=>{if(!x[h])return x;const b={...x};return delete b[h],b})}if(l.video_url||l.output_url||l.output_images||l.image_url||l.lastFrame){const h=l.video_url||l.output_url||l.output_images&&l.output_images[0]||l.image_url||l.lastFrame,x=l.video_url?"video":"image",b=l.image_filename||"";setTimeout(()=>{Ti(`temp-${Date.now()}`,h,x,n,null,b)},50)}},wk=(n,o)=>{const l=At.get(n);if(!l||!o||o.length===0){console.warn("[] ");return}const u=o.map((b,v)=>{var B,L,Y,J,q,Z,oe,te,ee,ce;const y=((B=b.keyframes)==null?void 0:B.find(W=>W.type==="current"))||((L=b.keyframes)==null?void 0:L[0]),w=(y==null?void 0:y.mj_prompt)||"",j=(y==null?void 0:y.jimeng_prompt)||"",R=(y==null?void 0:y.description)||((J=(Y=b.keyframes)==null?void 0:Y[0])==null?void 0:J.description)||"",C=[];(Z=(q=b.global_tags)==null?void 0:q.style)!=null&&Z[0]&&C.push(b.global_tags.style[0]),(te=(oe=b.global_tags)==null?void 0:oe.camera)!=null&&te[0]&&C.push(b.global_tags.camera[0]),y!=null&&y.description&&["","","","","","","","Dolly","Pan","Tilt","Zoom"].forEach(Se=>{R.includes(Se)&&C.push(Se)});const H=((ce=(ee=b.global_tags)==null?void 0:ee.camera)==null?void 0:ce[0])||C.find(W=>["","","","","","Dolly","Pan","Tilt","Zoom"].some(Se=>W.includes(Se)))||"";return{id:`shot - ${Date.now()} -${v} `,scene_index:v+1,time_range:b.time_range||"",image_url:"",description:R,prompt:w||j,camera:H,tags:C,status:"draft"}}),p=l.x+l.width+100,m=l.y,h=`node - storyboard - ${Date.now()} `,x={id:h,type:"storyboard-node",x:p,y:m,width:600,height:500,settings:{projectTitle:"AI ",shots:u}};f(b=>[...b,x]),z(b=>[...b,{id:`conn - ${Date.now()} `,from:n,to:h}])},tr=M.useRef(new Map);M.useRef(null);const Qx=async(n,o,l,u=null,p=null)=>{var m;try{const h=je.find(C=>C.type==="Video"&&(C.id==="sora-2"||C.id==="sora-2-pro"));if(!h){alert(" Sora 2  Sora 2  Sora 2 Pro"),Dl(!1);return}const b=ri(h.id).key;if(!b){alert(" API Key"),Dl(!1);return}if(l-o<1||l-o>3){alert(" 1-3 "),Dl(!1);return}const v=`${o},${l} `;let y;p&&p.trim()?y=p.trim():y=`${(h.url||ss).replace(/\/+$/,"")} /sora/v1 / characters`;const w=u?{from_task:u,timestamps:v}:{url:n,timestamps:v};console.log("[Create Character] Request Details:",{endpoint:y,apiKey:b?`${b.substring(0,8)}...${b.substring(b.length-4)} `:"EMPTY",payload:w,fromTaskId:u,videoUrl:u?"N/A (using from_task)":n,customEndpoint:p||"N/A (using default)"});const j=await fetch(y,{method:"POST",headers:{Authorization:`Bearer ${b} `,"Content-Type":"application/json"},body:JSON.stringify(w)});if(!j.ok){const C=await j.text();console.error("[Create Character] API Error:",{status:j.status,statusText:j.statusText,errorText:C,endpoint:y});let H=null;try{H=JSON.parse(C)}catch{}throw j.status===500||H&&(H.code==="get_origin_task_failed"||(m=H.message)!=null&&m.includes("get_origin_task_failed"))?new Error("TASK_NOT_FOUND"):new Error(`API(${j.status}): ${C||j.statusText} `)}const R=await j.json();if(R.id&&R.username){const C={id:R.id,username:R.username,profile_picture_url:R.profile_picture_url||"",permalink:R.permalink||""},H=[...br,C];Ml(H),alert(` "${R.username}" `),Vc(!1),Ru("url"),Du(""),Lu(""),dx(1),ux(3),Yc("")}else throw new Error(" id  username")}catch(h){console.error("[Create Character] Failed:",h);let x=h.message;if(x==="TASK_NOT_FOUND"){alert(`

" URL"`);return}(x.includes("Failed to fetch")||h.name==="TypeError"||h.message.includes("NetworkError"))&&(x=`

1. API 
   -  API  "/sora" 
   -  Sora 

2.  (CORS)
   -  Allow CORS 

3. 
   - `),alert(`: ${x} `)}finally{Dl(!1)}},eb=(n,o)=>{var w,j;let l=o.prompt||"";if(!l&&o.description&&(l=o.description),o.tags&&o.tags.length>0){const R=o.tags.join(", ");l+=`, ${R} `}if(o.camera&&(l+=`, ${o.camera} camera movement`),!l){alert("");return}const u=Ut(o.model||((w=je.find(R=>R.type==="Video"&&R.id==="sora-2"))==null?void 0:w.id)||((j=je.find(R=>R.type==="Video"))==null?void 0:j.id)||""),p=Ht(u);if(!p||p.type!=="Video"){alert("");return}const m=[];o.image_url&&m.push(o.image_url),o.useFirstLastFrame&&o.lastFrame&&m.push(o.lastFrame),Kt(n,o.id,{status:"generating",generationStartTime:Date.now()});let h=o.duration||Ya(u);const x=ld(u);x.includes(h)||(console.warn(`[V3.5.5] Duration "${h}" not valid for model "${u}", using "${x[0]}"`),h=x[0]);const b=String(h).endsWith("s")?h:`${h}s`,v={model:u,ratio:o.ratio||"16:9",duration:b,resolution:Ph(o.resolution||"720p"),isHD:!!o.isHD,customParams:o.customParams||null},y=`storyboard-${n}-shot-${o.id}`;Va(l,"video",m,y,v)},tb=(n,o)=>{var v;let l=o.prompt||"";if(!l&&o.description&&(l=o.description),o.tags&&o.tags.length>0){const y=o.tags.join(", ");l+=`, ${y} `}if(!l){alert("");return}const u=Ut(o.model||localStorage.getItem("tapnow_last_image_model")||((v=je.find(y=>ns(y.type)))==null?void 0:v.id)||""),p=Ht(u);if(!p||!ns(p.type)){alert("");return}if(!ri(u).key){alert(` "${u}"  API Key `),Kt(n,o.id,{status:"failed",errorMsg:"API Key "}),ei(!0);return}const h=[];o.image_url&&h.push(o.image_url),o.referenceImages&&o.referenceImages.length>0&&h.push(...o.referenceImages),Kt(n,o.id,{status:"generating",generationStartTime:Date.now()});const x={model:u,ratio:o.ratio||"1:1",resolution:Md(o.resolution||"2K"),customParams:o.customParams||null},b=`storyboard-img-${n}-shot-${o.id}`;Va(l,"image",h,b,x)},nb=async(n,o={})=>{var j,R,C,H,B,L,Y,J;const l=At.get(n),u=o.inputText||"",p=o.modelId||"";let m=u||((j=l==null?void 0:l.settings)==null?void 0:j.content)||"";if(!m){const q=g.find(Z=>Z.to===n);if(q){const Z=At.get(q.from);Z&&(Z.type==="novel-input"||Z.type==="text-node")&&(m=((R=Z.settings)==null?void 0:R.content)||Z.content||"")}}if(!m||m.trim().length===0){a("","error");return}const h=Ut(p||((C=l==null?void 0:l.settings)==null?void 0:C.model)||"");if(!h){a("","error");return}const x=Ht(h);if(!x){a("","error");return}const b=ri(h),v=b.key;if(!v){a(" API Key","error"),ei(!0);return}((H=l==null?void 0:l.settings)==null?void 0:H.model)!==h&&Le(n,{model:h}),N0(h);try{localStorage.setItem("tapnow_last_extract_model",h)}catch{}Le(n,{isAnalyzing:!0,progress:5,errorMsg:null,analysisResults:null});let y=setInterval(()=>{f(q=>q.map(Z=>{var ee;if(Z.id!==n)return Z;const oe=((ee=Z.settings)==null?void 0:ee.progress)||0,te=Math.min(oe+7,92);return{...Z,settings:{...Z.settings,progress:te}}}))},500);const w=`


${m.substring(0,15e3)} ... ()

 JSON 
{
    "characters": [
        { "name": "", "role": "//", "age": "", "gender": "", "description": "", "appearance": "" }
    ],
    "scenes": [
        { "location": "", "description": "", "mood": "", "style": "" }
    ]
}
 JSON markdown `;try{const q=(b.url||ss).replace(/\/+$/,""),Z=await fetch(`${q}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${v}`,"Content-Type":"application/json"},body:JSON.stringify({model:x.modelName||x.id||"gemini-1.5-pro-latest",messages:[{role:"system",content:"You are a helpful assistant that analyzes novels."},{role:"user",content:w}],temperature:.7})});if(!Z.ok){let Se="";try{const ze=await Z.json();Se=((B=ze==null?void 0:ze.error)==null?void 0:B.message)||(ze==null?void 0:ze.message)||""}catch{}throw Z.status===401&&(a("API Key 401","error",5e3),ei(!0)),new Error(`API Error: ${Z.status}${Se?` - ${Se}`:""}`)}const oe=await Z.json(),te=((J=(Y=(L=oe.choices)==null?void 0:L[0])==null?void 0:Y.message)==null?void 0:J.content)||oe.content||"";let ee=null;try{const Se=te.replace(/```json/g,"").replace(/```/g,"").trim();ee=JSON.parse(Se)}catch(Se){console.warn("JSON Parse Error",Se)}const ce=Array.isArray(ee==null?void 0:ee.characters)?ee.characters:[],W=Array.isArray(ee==null?void 0:ee.scenes)?ee.scenes:[];ee&&(ce.length>0||W.length>0)?(Le(n,{analysisResults:{characters:ce,scenes:W},lastAnalyzed:Date.now(),errorMsg:null}),setTimeout(()=>{gk(n,{characters:ce,scenes:W})},200)):(Le(n,{analysisResults:null,lastAnalyzed:Date.now(),errorMsg:""}),a("/","warning"))}catch(q){console.error("Extraction Failed",q);let Z=(q==null?void 0:q.message)||"";((q==null?void 0:q.name)==="TypeError"||/Failed to fetch|NetworkError/i.test(Z))&&(Z="CORS API http/https CORS "),Le(n,{errorMsg:Z}),a(`: ${Z}`,"error",5e3)}finally{y&&clearInterval(y),f(q=>q.map(Z=>Z.id===n?{...Z,settings:{...Z.settings,isAnalyzing:!1,progress:100}}:Z)),setTimeout(()=>Le(n,{progress:0}),800)}},zk=n=>{var b,v,y,w;const o=At.get(n);if(!o)return;const l=((b=o.settings)==null?void 0:b.content)||"";if(!l||l.trim().length===0){a("","error");return}const u=g.find(j=>{var R;return j.from===n&&((R=At.get(j.to))==null?void 0:R.type)==="extract-characters-scenes"});let p=u==null?void 0:u.to,m=p?At.get(p):null;if(!p){const R=o.x+o.width+50+200,C=o.y+o.height/2,H=Ur("extract-characters-scenes",R,C,n);p=H==null?void 0:H.id,m=H||null}if(!p)return;const h=Ut(((v=m==null?void 0:m.settings)==null?void 0:v.model)||((w=(y=At.get(p))==null?void 0:y.settings)==null?void 0:w.model)||Yo||"");if(!h){a("","warning",4e3),wn({nodeId:p,type:"extract-model"});return}if(!ri(h).key){a(" API Key","error"),ei(!0);return}Le(p,{model:h}),requestAnimationFrame(()=>{nb(p,{inputText:l,modelId:h})})},rb=(n,o)=>{var u;const l=(u=o.target.files)==null?void 0:u[0];if(l){const p=new FileReader;p.onload=async m=>{const h=m.target.result;let x={w:0,h:0};try{x=await Fr(h)}catch{}ae(),f(b=>b.map(v=>v.id===n?{...v,content:h,dimensions:x}:v))},p.readAsDataURL(l)}},kk=(n,o)=>{if(!n||n.length===0)return[];const l=[...n].sort((h,x)=>h.time-x.time),u=[];let p=[],m=l[0].time;return l.forEach((h,x)=>{h.time-m>=o&&p.length>0?(u.push([...p]),p=[h],m=h.time):p.push(h)}),p.length>0&&u.push(p),u},jk=async n=>{var R,C,H,B,L,Y,J,q,Z,oe,te,ee,ce,W,Se;const o=At.get(n);if(!o||o.type!=="video-analyze")return;const l=sd(n);if(!l){alert("");return}const u=l.selectedKeyframes||[];if(u.length===0){alert("");return}const p=Ut(((R=o.settings)==null?void 0:R.model)||"gemini-3-pro"),{key:m,url:h}=ri(p),x=Ht(p);if(!m){alert(" API  Key"),ei(!0);return}const b=((C=o.settings)==null?void 0:C.segmentDuration)||3,v=kk(u,b);if(v.length===0){alert("");return}f(ze=>ze.map(Ee=>Ee.id===n?{...Ee,isGenerating:!0,analysisResults:[]}:Ee));const y=[],w=l.videoFileName||"video.mp4";(H=l.videoMeta)!=null&&H.duration;const j=((B=o.settings)==null?void 0:B.analysisMode)||"manual";try{for(let ze=0;ze<v.length;ze++){const Ee=v[ze],Be=`${Ee[0].time.toFixed(1)}s-${Ee[Ee.length-1].time.toFixed(1)}s`,nt=`AI

 JSON 
{
  "video_id": "${w}",
  "scene_index": ${ze+1},
  "time_range": "${Be}",
  "keyframes": [
    {
      "type": "prev",
      "time": 5.2,
      "description": "",
      "mj_prompt": "Midjourney ",
      "jimeng_prompt": ""
    },
    {
      "type": "current",
      "time": 6.8,
      "description": "",
      "mj_prompt": "Midjourney ",
      "jimeng_prompt": ""
    },
    {
      "type": "next",
      "time": 8.7,
      "description": "",
      "mj_prompt": "Midjourney ",
      "jimeng_prompt": ""
    }
  ],
  "global_tags": {
    "style": ["", ""],
    "camera": ["", ""],
    "color": [""]
  }
}


1.  prev/current/next 
2. mj_prompt  Midjourney
3. jimeng_prompt AI
4. global_tags `,st=[{type:"text",text:` ${ze+1}${Be}`}],ht=15,Yt=Ee.length>ht?Ee.slice(0,ht):Ee;Yt.forEach((jt,wt)=>{st.push({type:"image_url",image_url:{url:jt.url}}),wt<Yt.length-1&&st.push({type:"text",text:` ${wt+1}${jt.time.toFixed(2)}s`})}),Ee.length>ht&&st.push({type:"text",text:` ${Ee.length} API ${ht} `});const Wt=[{role:"system",content:nt},{role:"user",content:st}],Jt=new AbortController,Ft=setTimeout(()=>Jt.abort(),6e4);let dn;try{dn=await fetch(`${h}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({model:(x==null?void 0:x.id)||"gemini-3-pro",messages:Wt,stream:!1}),signal:Jt.signal})}catch(jt){throw clearTimeout(Ft),jt.name==="AbortError"?new Error(""):jt.message&&jt.message.includes("Failed to fetch")?new Error(` API  (${h})
1. API 
2. 
3. API `):new Error(`: ${jt.message}`)}finally{clearTimeout(Ft)}if(!dn.ok){let jt="";try{jt=await dn.text()}catch{jt=`HTTP ${dn.status}: ${dn.statusText}`}throw new Error(jt||`API Error: ${dn.status}`)}const O=await dn.json();console.log("[] API :",{hasData:!!O,hasChoices:!!O.choices,choicesLength:(L=O.choices)==null?void 0:L.length,dataKeys:Object.keys(O||{}),model:(x==null?void 0:x.modelName)||(x==null?void 0:x.id)});let me=null;if(O.choices&&O.choices.length>0?me=(J=(Y=O.choices[0])==null?void 0:Y.message)==null?void 0:J.content:(q=O.data)!=null&&q.choices&&O.data.choices.length>0?me=(oe=(Z=O.data.choices[0])==null?void 0:Z.message)==null?void 0:oe.content:O.content?me=O.content:(te=O.data)!=null&&te.content?me=O.data.content:O.text?me=O.text:(ee=O.data)!=null&&ee.text?me=O.data.text:O.message?me=typeof O.message=="string"?O.message:O.message.content:(ce=O.data)!=null&&ce.message?me=typeof O.data.message=="string"?O.data.message:O.data.message.content:O.result?me=typeof O.result=="string"?O.result:O.result.content:(W=O.data)!=null&&W.result&&(me=typeof O.data.result=="string"?O.data.result:O.data.result.content),!me||me.trim()===""||me==="{}")throw console.error("[] API :",O),new Error(`API : ${JSON.stringify(O).substring(0,200)}`);let Fe=me.trim();Fe.startsWith("```")&&(Fe=Fe.replace(/^```(?:json)?\n?/,"").replace(/\n?```$/,""));let He;try{He=JSON.parse(Fe)}catch(jt){console.error("[]  JSON :",jt,"500:",Fe.substring(0,500));try{Fe=Fe.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/.*/g,""),Fe=Fe.replace(/,(\s*[}\]])/g,"$1"),He=JSON.parse(Fe)}catch(wt){console.error("[] JSON:",wt,":",Fe),He={video_id:w,scene_index:ze+1,time_range:Be,keyframes:Ee.map((Et,xt)=>({type:xt===0?"prev":xt===1?"current":"next",time:Et.time,description:` ${Et.time.toFixed(1)}s`,mj_prompt:"A detailed scene from the video",jimeng_prompt:""})),global_tags:{style:[],camera:[],color:[]}},console.warn("[] :",Fe.substring(0,200))}}if(y.push(He),f(jt=>jt.map(wt=>{if(wt.id===n){const xt=[...wt.analysisResults||[],He];return{...wt,analysisResults:xt}}return wt})),!(j==="manual")){const wt={id:`analyze-${n}-${ze}-${Date.now()}`,type:"analyze",prompt:` -  ${ze+1}`,url:((Se=Ee[0])==null?void 0:Se.url)||"",status:"completed",progress:100,modelName:(x==null?void 0:x.provider)||"Gemini 3 Pro",time:new Date().toLocaleString("zh-CN"),sourceNodeId:n,analysisResult:He,videoFileName:w,sceneIndex:ze+1,timeRange:Be};gt(Et=>[wt,...Et])}}f(ze=>ze.map(Ee=>{if(Ee.id===n){const Be=y.length>0?y:Ee.analysisResults||[];return{...Ee,isGenerating:!1,analysisResults:Be}}return Ee}))}catch(ze){console.error(":",ze);const Ee=ze.message||"";f(Be=>Be.map(nt=>nt.id===n?{...nt,isGenerating:!1,errorMsg:Ee}:nt))}},Nk=async n=>{var x,b,v,y,w,j,R,C,H,B;const o=At.get(n);if(!o||o.type!=="video-analyze")return;const l=sd(n);if(!l||!l.content){alert("");return}let u=l.content;if(u.startsWith("blob:"))try{const L=await fetch(u).then(Y=>Y.blob());u=await new Promise((Y,J)=>{const q=new FileReader;q.onerror=()=>J(new Error("FileReader failed")),q.onloadend=()=>Y(q.result),q.readAsDataURL(L)})}catch(L){console.error("Blob conversion failed",L),alert(" AI");return}let p=je.find(L=>L.id==="gemini-3-pro"&&L.type==="Chat");p||(p=je.find(L=>{var J;return(((J=L.id)==null?void 0:J.toLowerCase())||"").includes("gemini")&&L.type==="Chat"})),p||(p=je.find(L=>L.type==="Chat"));const{key:m,url:h}=ri((p==null?void 0:p.id)||"gemini-3-pro");if(!m){alert(" API  Key"),ei(!0);return}f(L=>L.map(Y=>Y.id===n?{...Y,isGenerating:!0,settings:{...Y.settings,voiceoverResults:[],analysisResults:[]}}:Y));try{const J=[{role:"system",content:`******AI**

1. ****

2. ****Voiceover

 **JSON **Markdown

{
  "voiceover_script": [
    { "time_range": "0s-3s", "text": "..." }
  ],
  "scenes": [
    {
      "scene_id": 1,
      "time_range": "0s-2.5s",
      "visual_analysis": {
        "camera_movement": "(Dolly Zoom Out) (Orbit)",
        "subject_dynamics": "",
        "atmosphere": ""
      },
      "prompts": {
        "jimeng_prompt": "()+++()...",
        "mj_prompt": "Midjourney Prompt: English description, include camera directives like 'dynamic angle', 'fast zoom out', 'cinematic lighting'..."
      }
    }
  ]
}

****
- ****
- ****""
- ****`},{role:"user",content:[{type:"text",text:"JSON"},{type:"image_url",image_url:{url:u}}]}],q=new AbortController,Z=setTimeout(()=>q.abort(),12e4);let oe;try{oe=await fetch(`${h}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"},body:JSON.stringify({model:(p==null?void 0:p.id)||"gemini-3-pro",messages:J,stream:!1}),signal:q.signal})}catch(Ee){throw clearTimeout(Z),Ee.name==="AbortError"?new Error("120"):Ee.message&&Ee.message.includes("Failed to fetch")?new Error(` API  (${h})
1. API 
2. 
3. API 
4.  API Key`):new Error(`: ${Ee.message}`)}finally{clearTimeout(Z)}if(!oe.ok){let Ee="";try{Ee=await oe.text()}catch{Ee=`HTTP ${oe.status}: ${oe.statusText}`}throw new Error(Ee||`API Error: ${oe.status}`)}const te=await oe.json();console.log("[AI] API :",{hasData:!!te,hasChoices:!!te.choices,choicesLength:(x=te.choices)==null?void 0:x.length,dataKeys:Object.keys(te||{}),model:(p==null?void 0:p.modelName)||(p==null?void 0:p.id)});let ee=null;if(te.choices&&te.choices.length>0?ee=(v=(b=te.choices[0])==null?void 0:b.message)==null?void 0:v.content:(y=te.data)!=null&&y.choices&&te.data.choices.length>0?ee=(j=(w=te.data.choices[0])==null?void 0:w.message)==null?void 0:j.content:te.content?ee=te.content:(R=te.data)!=null&&R.content?ee=te.data.content:te.text?ee=te.text:(C=te.data)!=null&&C.text?ee=te.data.text:te.message?ee=typeof te.message=="string"?te.message:te.message.content:(H=te.data)!=null&&H.message?ee=typeof te.data.message=="string"?te.data.message:te.data.message.content:te.result?ee=typeof te.result=="string"?te.result:te.result.content:(B=te.data)!=null&&B.result&&(ee=typeof te.data.result=="string"?te.data.result:te.data.result.content),!ee||ee.trim()===""||ee==="{}")throw console.error("[AI] API :",te),new Error(`API : ${JSON.stringify(te).substring(0,200)}`);let ce=ee.trim();ce.startsWith("```")&&(ce=ce.replace(/^```(?:json)?\n?/,"").replace(/\n?```$/,""));let W;try{W=JSON.parse(ce)}catch(Ee){console.error("[AI]  JSON :",Ee,"500:",ce.substring(0,500));try{ce=ce.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/.*/g,""),ce=ce.replace(/,(\s*[}\]])/g,"$1"),W=JSON.parse(ce)}catch(Be){throw console.error("[AI] JSON:",Be,":",ce.substring(0,500)),new Error(` JSON : ${ce.substring(0,200)}`)}}const Se=(W.voiceover_script||[]).map((Ee,Be)=>({time:Be,text:Ee.text||""})),ze=(W.scenes||[]).map((Ee,Be)=>{var nt,st,ht,Yt,Wt,Jt;return{scene_index:Ee.scene_id||Be+1,time_range:Ee.time_range||"",keyframes:[{type:"current",time:0,description:`${((nt=Ee.visual_analysis)==null?void 0:nt.camera_movement)||""} ${((st=Ee.visual_analysis)==null?void 0:st.subject_dynamics)||""}`.trim(),mj_prompt:((ht=Ee.prompts)==null?void 0:ht.mj_prompt)||"",jimeng_prompt:((Yt=Ee.prompts)==null?void 0:Yt.jimeng_prompt)||""}],global_tags:{style:(Wt=Ee.visual_analysis)!=null&&Wt.atmosphere?[Ee.visual_analysis.atmosphere]:[],camera:(Jt=Ee.visual_analysis)!=null&&Jt.camera_movement?[Ee.visual_analysis.camera_movement]:[],color:[]}}});f(Ee=>Ee.map(Be=>Be.id===n?{...Be,isGenerating:!1,settings:{...Be.settings,voiceoverResults:Se,analysisResults:ze}}:Be)),ze.length>0&&setTimeout(()=>{wk(n,ze)},100)}catch(L){console.error("AI:",L);const Y=L.message||"AI";f(J=>J.map(q=>q.id===n?{...q,isGenerating:!1,errorMsg:Y}:q))}},_k=()=>{const n=$u.name.trim(),o=$u.prompt.trim();if(!n||!o){alert("");return}Yg(l=>[{id:`custom-${Date.now()}`,name:n,prompt:o},...l]),n0({name:"",prompt:""})},Sk=n=>{Yg(o=>o.filter(l=>l.id!==n))},Ck=(n,o)=>{!n||!o||Le(n,{prompt:o})},Ek=async n=>new Promise((o,l)=>{const u=new Image;u.crossOrigin="anonymous";const p=setTimeout(()=>{l(new Error(""))},3e4);u.onload=()=>{clearTimeout(p);try{const h=document.createElement("canvas").getContext("2d"),x=Math.floor(u.width/3),b=Math.floor(u.height/3),v=[],y=[];for(let w=0;w<3;w++)for(let j=0;j<3;j++){const R=Math.max(0,Math.min(j*x,u.width-x)),C=Math.max(0,Math.min(w*b,u.height-b)),H=Math.min(x,u.width-R),B=Math.min(b,u.height-C),L=document.createElement("canvas");L.width=H,L.height=B;const Y=L.getContext("2d");Y.fillStyle="#ffffff",Y.fillRect(0,0,H,B),Y.drawImage(u,R,C,H,B,0,0,H,B);try{const J=L.toDataURL("image/png");y.push(Promise.resolve({url:J,width:H,height:B}))}catch(J){console.error("Canvas toDataURL :",J)}}Promise.all(y).then(w=>{o(w)}).catch(w=>{l(w)})}catch(m){l(m)}},u.onerror=()=>{clearTimeout(p),l(new Error(""))},u.src=n}),cd=async(n,o={})=>{if(!n)return;const{originX:l,originY:u,cols:p=3,spacing:m=20,nodeWidth:h=260,nodeHeight:x=260,replaceSelected:b=!1}=o;try{const v=await Ek(n);if(v.length!==9){alert("9");return}const y=ni.current;if(b&&y&&y.size===9){const H=Array.from(y);f(B=>B.map(L=>{const Y=H.indexOf(L.id);return Y!==-1&&Y<v.length?{...L,content:v[Y].url,dimensions:{w:v[Y].width,h:v[Y].height}}:L}));return}const w=Pn(window.innerWidth/2,window.innerHeight/2),j=l!==void 0?l:w.x,R=u!==void 0?u:w.y,C=[];for(let H=0;H<v.length;H++){const B=Math.floor(H/p),L=H%p,Y=j+L*(h+m),J=R+B*(x+m);C.push({id:`node-${Date.now()}-${H}`,type:"input-image",x:Y,y:J,width:h,height:x,content:v[H].url,dimensions:{w:v[H].width,h:v[H].height}})}f(H=>[...H,...C])}catch(v){alert(": "+v.message)}},Ik=()=>{const n=Zi.current,o=ni.current;let l=[];if(n){const B=Us.current.find(L=>L.id===n);B&&(l=[B])}else o&&o.size>0&&(l=Us.current.filter(B=>o.has(B.id)));if(l.length<2){alert("");return}const u=new Set(l.map(B=>B.id)),p={};l.forEach(B=>{p[B.id]={id:B.id,node:B,parents:[],children:[],level:0,rank:0}}),qc.current.forEach(B=>{u.has(B.from)&&u.has(B.to)&&(p[B.from].children.push(B.to),p[B.to].parents.push(B.from))});let m=Object.values(p).filter(B=>B.parents.length===0);m.length===0&&l.length>0&&(m=[Object.values(p)[0]]),(()=>{const B=m.map(L=>({node:L,lvl:0}));for(;B.length>0;){const{node:L,lvl:Y}=B.shift();Y>=L.level&&(L.level=Y,L.children.forEach(J=>{const q=p[J];q&&Y<20&&B.push({node:q,lvl:Y+1})}))}})();const x=Math.max(...Object.values(p).map(B=>B.level)),b=Array.from({length:x+1},()=>[]);Object.values(p).forEach(B=>{b[B.level].push(B)}),b.forEach(B=>{B.sort((L,Y)=>L.node.y-Y.node.y)});const v=3;for(let B=0;B<v;B++){for(let L=1;L<b.length;L++){const Y=b[L];Y.forEach(J=>{if(J.parents.length>0){let q=0;J.parents.forEach(Z=>{const oe=p[Z],te=b[L-1].indexOf(oe);te!==-1&&(q+=te)}),J.barycenter=q/J.parents.length}else J.barycenter=b[L].indexOf(J)}),Y.sort((J,q)=>(J.barycenter||0)-(q.barycenter||0))}for(let L=b.length-2;L>=0;L--){const Y=b[L];Y.forEach(J=>{if(J.children.length>0){let q=0;J.children.forEach(Z=>{const oe=p[Z],te=b[L+1].indexOf(oe);te!==-1&&(q+=te)}),J.barycenter=q/J.children.length}else J.barycenter=b[L].indexOf(J)}),Y.sort((J,q)=>(J.barycenter||0)-(q.barycenter||0))}}const y=Math.min(...l.map(B=>B.x)),w=Math.min(...l.map(B=>B.y)),j=150,R=40;let C=y;const H=new Map;b.forEach((B,L)=>{if(B.length===0)return;const Y=Math.max(...B.map(q=>q.node.width||260));B.reduce((q,Z)=>q+(Z.node.height||200),0)+(B.length-1)*R;let J=w;B.forEach(q=>{H.set(q.id,{...q.node,x:C,y:J}),J+=(q.node.height||200)+R}),C+=Y+j}),f(B=>B.map(L=>H.has(L.id)?H.get(L.id):L))},dd=M.useCallback((n,o,l=null)=>{const u=At.get(n);if(!u)return;const p=(u==null?void 0:u.frames)||[],m=(u==null?void 0:u.selectedKeyframes)||[],h=(o||[]).filter(Boolean);if(h.length===0)return;const x=h.map((R,C)=>({time:Date.now()+C,url:R,filename:""})),b=l!==null?l:p.length,v=[...p.slice(0,b),...x,...p.slice(b)],y=new Set([...m,...x]),w=v.map((R,C)=>({...R,time:C})),j=w.filter((R,C)=>y.has(v[C]));f(R=>R.map(C=>C.id===n?{...C,frames:w,selectedKeyframes:j}:C))},[At,f]),sb=async(n,o)=>{o.preventDefault(),o.stopPropagation(),o.currentTarget.classList.remove("drag-over");const l=ra(o);if(l){const x=na(l.url||l.originalUrl||l.mjOriginalUrl||"",l.type);if(x){if(l.type==="video"||Qt(x)){let v={duration:0,w:0,h:0};try{v=await nc(x)}catch{}ae(),f(y=>y.map(w=>w.id===n?{...w,content:x,videoMeta:v,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:""}:w))}else dd(n,[x]);return}}const u=sa(o);if(u){if(Qt(u)){let x={duration:0,w:0,h:0};try{x=await nc(u)}catch{}ae(),f(b=>b.map(v=>v.id===n?{...v,content:u,videoMeta:x,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:""}:v))}else dd(n,[u]);return}const p=Array.from(o.dataTransfer.files),m=p.find(x=>x.type.startsWith("video/"));if(m){Wl(n,m);return}const h=p.filter(x=>x.type.startsWith("image/"));if(h.sort((x,b)=>x.name.localeCompare(b.name,void 0,{numeric:!0,sensitivity:"base"})),h.length>0){const x=At.get(n),b=(x==null?void 0:x.frames)||[],v=(x==null?void 0:x.selectedKeyframes)||[];let y=0;const w=[];h.forEach((j,R)=>{const C=new FileReader;C.onload=async H=>{const B=H.target.result,L=await Ui.saveImage(B);if(w[R]={time:b.length+R,url:L,filename:j.name},y++,y===h.length){const Y=w.filter(Boolean);f(J=>J.map(q=>q.id===n?{...q,frames:[...b,...Y],selectedKeyframes:[...v,...Y]}:q))}},C.readAsDataURL(j)})}},$k=(n,o,l)=>{n.preventDefault(),n.stopPropagation();const u=n.currentTarget.getBoundingClientRect(),m=n.clientX-u.left>u.width/2?l+1:l;(A!==m||k!==o)&&(V(m),S(o))},Mk=(n,o,l)=>{n.preventDefault(),n.stopPropagation(),n.target===n.currentTarget&&(A!==l||k!==o)&&(V(l),S(o))},Tk=(n,o)=>{var w;o.preventDefault(),o.stopPropagation();let l=k===n&&A!==null?A:(((w=At.get(n))==null?void 0:w.frames)||[]).length;S(null),V(null);const u=ra(o);if(u){const j=u.url||u.originalUrl||u.mjOriginalUrl||"";j&&!(u.type==="video"||Qt(j))&&dd(n,[j],l);return}const p=sa(o);if(p&&!Qt(p)){dd(n,[p],l);return}const m=Array.from(o.dataTransfer.files).filter(j=>j.type.startsWith("image/"));if(m.length===0)return;m.sort((j,R)=>j.name.localeCompare(R.name,void 0,{numeric:!0,sensitivity:"base"}));const h=At.get(n),x=(h==null?void 0:h.frames)||[],b=(h==null?void 0:h.selectedKeyframes)||[];let v=0;const y=[];m.forEach((j,R)=>{const C=new FileReader;C.onload=async H=>{const B=H.target.result,L=await Ui.saveImage(B);let Y=B;try{const J=await Ui.getImage(L);J&&(Y=URL.createObjectURL(J))}catch(J){console.warn("[KeyframeOrganizer] Failed to create blob URL, using base64:",J)}if(y[R]={time:Date.now()+R,url:Y,imgId:L,filename:j.name},v++,v===m.length){const J=y.filter(Boolean),q=[...x.slice(0,l),...J,...x.slice(l)],Z=new Set([...b,...J]),oe=q.map((ee,ce)=>({...ee,time:ce})),te=oe.filter((ee,ce)=>Z.has(q[ce]));f(ee=>ee.map(ce=>ce.id===n?{...ce,frames:oe,selectedKeyframes:te}:ce))}},C.readAsDataURL(j)})},Pk=async(n,o=30)=>new Promise((l,u)=>{const p=document.createElement("video");p.crossOrigin="anonymous",p.src=n,p.muted=!0;const m=document.createElement("canvas"),h=m.getContext("2d",{willReadFrequently:!0}),x=[];let b=null;p.onloadeddata=async()=>{m.width=320,m.height=Math.floor(320*(p.videoHeight/p.videoWidth));const v=p.duration,y=2;p.currentTime=0;const w=async()=>{const j=p.currentTime;if(j>=v||Math.abs(j-v)<.01){if(x.length===0||parseFloat(x[x.length-1].time)<v-.5){const H=document.createElement("canvas");H.width=p.videoWidth,H.height=p.videoHeight;const B=H.getContext("2d");p.currentTime=Math.max(0,v-.1),await new Promise(L=>{const Y=setTimeout(()=>L(),200);p.onseeked=()=>{clearTimeout(Y),B.drawImage(p,0,0);const J=Math.max(0,v-.1);x.push({time:J.toFixed(2),image:H.toDataURL("image/jpeg",.8)}),L()}})}l(x.map(H=>({time:parseFloat(H.time),url:H.image})));return}h.drawImage(p,0,0,m.width,m.height);const R=h.getImageData(0,0,m.width,m.height).data;if(b){let H=0;for(let L=0;L<R.length;L+=4)H+=Math.abs(R[L]-b[L])+Math.abs(R[L+1]-b[L+1])+Math.abs(R[L+2]-b[L+2]);if(H/(R.length/4*3)>o){const L=document.createElement("canvas");L.width=p.videoWidth,L.height=p.videoHeight,L.getContext("2d").drawImage(p,0,0);const Y=L.toDataURL("image/jpeg",.8),J=p.currentTime;x.push({time:J.toFixed(2),image:Y}),b=null}else b=R}else{b=R;const H=p.currentTime,B=document.createElement("canvas");B.width=p.videoWidth,B.height=p.videoHeight,B.getContext("2d").drawImage(p,0,0),x.push({time:H.toFixed(2),image:B.toDataURL("image/jpeg",.8)})}const C=p.currentTime+1/y;if(C>=v){if(x.length===0||parseFloat(x[x.length-1].time)<v-.5){const H=document.createElement("canvas");H.width=p.videoWidth,H.height=p.videoHeight;const B=H.getContext("2d");p.currentTime=Math.max(0,v-.1),await new Promise(L=>{const Y=setTimeout(()=>L(),200);p.onseeked=()=>{clearTimeout(Y),B.drawImage(p,0,0);const J=Math.max(0,v-.1);x.push({time:J.toFixed(2),image:H.toDataURL("image/jpeg",.8)}),L()}})}l(x.map(H=>({time:parseFloat(H.time),url:H.image})));return}p.currentTime=C,await new Promise(H=>{const B=setTimeout(()=>H(),200);p.onseeked=()=>{clearTimeout(B),H()}}),w()};w()},p.onerror=v=>u(new Error(""))}),Ak=async(n,o=2)=>{const l=At.get(n);if(l!=null&&l.content){f(u=>u.map(p=>p.id===n?{...p,extractingFrames:!0}:p));try{const u=await __(l.content,{fps:o});f(p=>p.map(m=>m.id===n?{...m,frames:u,selectedKeyframes:[],extractingFrames:!1}:m))}catch(u){console.error("",u),f(p=>p.map(m=>m.id===n?{...m,extractingFrames:!1}:m))}}},Rk=async(n,o=30)=>{const l=At.get(n);if(l!=null&&l.content){f(u=>u.map(p=>p.id===n?{...p,extractingFrames:!0}:p));try{const u=await Pk(l.content,o);f(p=>p.map(m=>m.id===n?{...m,frames:u,selectedKeyframes:[],extractingFrames:!1}:m))}catch(u){console.error("",u),alert(`: ${u.message}`),f(p=>p.map(m=>m.id===n?{...m,extractingFrames:!1}:m))}}},Dk=(n,o,l=0,u=null)=>{const p=!!(u!=null&&u.shiftKey);f(m=>m.map(h=>{if(h.id!==n)return h;const x=h.frames||[],b=j=>`${j.time}-${j.url}`,v=new Map(x.map(j=>[b(j),j]));let w=[...h.selectedKeyframes||[]];if(p&&Yu.current[n]!==void 0&&Yu.current[n]!==null&&x.length>0){const j=Yu.current[n],R=Math.min(j,l),C=Math.max(j,l),H=x.slice(R,C+1),B=new Set(w.map(b));H.forEach(L=>B.add(b(L))),w=Array.from(B).map(L=>v.get(L)).filter(Boolean)}else w=w.some(R=>b(R)===b(o))?w.filter(R=>b(R)!==b(o)):[...w,o];return Yu.current[n]=l,{...h,selectedKeyframes:w}}))},Lk=(n,o,l)=>{n.preventDefault(),n.stopPropagation(),h0({visible:!0,x:n.clientX,y:n.clientY,nodeId:o,frame:l})},dp=()=>{h0({visible:!1,x:0,y:0,nodeId:null,frame:null})},Ok=()=>{const{frame:n}=Wo;if(!(n!=null&&n.url))return;const o={name:`Frame-${(n.time??0).toFixed(2)}s.png`,type:"image/png",content:n.url,isImage:!0,isVideo:!1,isAudio:!1,fromHistory:!0,fileExt:"png"};Ii(l=>[...l,o]),Yi(!0),dp()},Uk=async()=>{const{frame:n}=Wo;if(!(n!=null&&n.url))return;let o=n.url;if(o.startsWith("blob:"))try{o=`data:image/png;base64,${await yr(o)}`}catch(y){console.error(" Blob URL  URL:",y)}let l;try{const y=await Fr(o);y!=null&&y.w&&(y!=null&&y.h)&&(l={w:y.w,h:y.h})}catch{}const u=d.filter(y=>y.type==="input-image");let p,m;if(u.length>0){const y=u[u.length-1];p=y.x-40,m=y.y+35}else{const y=Pn(window.innerWidth/2,window.innerHeight/2);p=y.x+50,m=y.y+50}let h=p,x=m;const b=(y,w)=>d.some(j=>Math.abs(j.x-y)<80&&Math.abs(j.y-w)<80);let v=0;for(;b(h,x)&&v<50;)h-=40,x+=35,v++;Ur("input-image",h,x,null,o,l),dp()},Fk=()=>{const{frame:n}=Wo;n!=null&&n.url&&(f(o=>{const l=Zi.current,u=ni.current,p=o.filter(h=>h.type==="preview");if(!p.length)return o;let m=null;if(l){const h=p.find(x=>x.id===l);h&&(m=h.id)}if(!m&&u&&u.size>0){const h=p.find(x=>u.has(x.id));h&&(m=h.id)}return m||(m=p[p.length-1].id),o.map(h=>h.id===m?{...h,content:n.url,previewType:"image"}:h)}),dp())},Bk=()=>{const{frame:n}=Wo;if(!(n!=null&&n.url))return;const o=Ce,l=At.get(o);l&&l.type==="input-image"?f(u=>u.map(p=>p.id===o?{...p,content:n.url}:p)):alert('""'),dp()},up=(n,o,l=null,u=null)=>{n.preventDefault(),n.stopPropagation();const p=l?Vn(o,l):Vn(o),m=u!==null?u:o.selectedMjImageIndex!==void 0?o.selectedMjImageIndex:null,h={...o,url:p,selectedMjImageIndex:m},x=Pn(n.clientX,n.clientY);gi({visible:!0,x:n.clientX,y:n.clientY,worldX:x.x,worldY:x.y,item:h}),Mi(!1)},ib=n=>{if(!js.nodeId||!js.shotId)return!1;const o=Vn(n);return o?n.type==="video"||Qt(o)?(a("","warning"),!1):(Kt(js.nodeId,js.shotId,{image_url:o,image_filename:""}),!0):!1},B0=M.useCallback(n=>n==="video-input"?{w:580,h:460}:n==="input-image"?{w:260,h:260}:{w:260,h:260},[]),oa=M.useCallback(async(n,o,l)=>{if(!n||!o)return!1;const u=l?"video-input":"input-image",p=B0(u),h=n.x-40-p.w/2,x=n.y+n.height/2;let b;if(!l)try{b=await Fr(o)}catch{}const v=Ur(u,h,x,null,o,b,n.id);if(l&&(v!=null&&v.id))try{const y=await nc(o);f(w=>w.map(j=>j.id===v.id?{...j,content:o,videoMeta:y,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:""}:j))}catch{}return!0},[Ur,B0,f]),Hk=async(n,o)=>{if(!n)return!1;const l=na(Vn(o),o.type);if(!l)return!1;if(n.type==="preview"){const u=o.mjImages&&o.mjImages.length>1?o.mjImages:null,p=o.selectedMjImageIndex??0,m=u?u[p]||u[0]:l;return f(h=>h.map(x=>x.id===n.id?{...x,content:m,previewType:o.type==="video"||Qt(m)?"video":"image",previewMjImages:u}:x)),!0}if(n.type==="input-image"){let u=null;if(!Qt(l))try{u=await Fr(l)}catch{}return f(p=>p.map(m=>m.id===n.id?{...m,content:l,dimensions:Qt(l)?null:u}:m)),!0}if(n.type==="video-input"){if(o.type==="video"||Qt(l)){let u={duration:0,w:0,h:0};try{u=await nc(l)}catch{}return f(p=>p.map(m=>m.id===n.id?{...m,content:l,videoMeta:u,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:""}:m)),!0}return dd(n.id,[l]),!0}if(n.type==="video-analyze"){const u=o.type==="video"||Qt(l);return await oa(n,l,u)}if(n.type==="gen-image"||n.type==="gen-video"||n.type==="image-compare"){const u=o.type==="video"||Qt(l);return u&&n.type==="gen-image"?(a("AI ","warning"),!1):u&&n.type==="image-compare"?(a("","warning"),!1):await oa(n,l,u)}return!1},Wk=async(n,o)=>{o.preventDefault(),o.stopPropagation();const l=At.get(n);if(!l)return;const u=ra(o);if(u){const b=na(u.url||u.originalUrl||u.mjOriginalUrl||"",u.type);if(b){const v=u.type==="video"||Qt(b);await oa(l,b,v)}return}const p=sa(o);if(p){await oa(l,p,Qt(p));return}const m=Array.from(o.dataTransfer.files||[]),h=m.find(b=>b.type.startsWith("video/"));if(h){const b=B0("video-input"),y=l.x-40-b.w/2,w=l.y+l.height/2,j=Ur("video-input",y,w,null,void 0,void 0,l.id);j!=null&&j.id&&Wl(j.id,h);return}const x=m.find(b=>b.type.startsWith("image/"));if(x){const b=new FileReader;b.onload=async v=>{const y=v.target.result;y&&await oa(l,y,!1)},b.readAsDataURL(x)}},H0=async(n,o)=>{o.preventDefault(),o.stopPropagation();const l=At.get(n);if(!l)return;const u=ra(o);if(u){const b=na(u.url||u.originalUrl||u.mjOriginalUrl||"",u.type);if(b){if((u.type==="video"||Qt(b))&&(l.type==="gen-image"||l.type==="image-compare"||l.type==="gen-video")){a("","warning");return}await oa(l,b,!1)}return}const p=sa(o);if(p){if(Qt(p)&&(l.type==="gen-image"||l.type==="image-compare"||l.type==="gen-video")){a("","warning");return}await oa(l,p,!1);return}const m=Array.from(o.dataTransfer.files||[]),h=m.find(b=>b.type.startsWith("image/"));if(h){const b=new FileReader;b.onload=async v=>{const y=v.target.result;y&&await oa(l,y,!1)},b.readAsDataURL(h);return}m.find(b=>b.type.startsWith("video/"))&&a("","warning")},ob=async()=>{const n=ks.item,o=Vn(n,(n==null?void 0:n.url)||(n==null?void 0:n.originalUrl)||(n==null?void 0:n.mjOriginalUrl)||null);if(!o)return;let l=o;n.type==="video"&&!Qt(l)&&(l+=(l.includes("?")?"&":"?")+"force_video_display=true");let u;if(n.type==="image")try{const w=await Fr(l);w!=null&&w.w&&(w!=null&&w.h)&&(u={w:w.w,h:w.h})}catch(w){console.error("SendHistoryToCanvas getImageDimensions error",w)}const p=d.filter(w=>w.type==="input-image");let m,h;if(p.length>0){const w=p[p.length-1];m=w.x-40,h=w.y+35}else{const w=Pn(window.innerWidth/2,window.innerHeight/2);m=w.x+50,h=w.y+50}let x=m,b=h;const v=(w,j)=>d.some(R=>Math.abs(R.x-w)<80&&Math.abs(R.y-j)<80);let y=0;for(;v(x,b)&&y<50;)x-=40,b+=35,y++;Ur("input-image",x,b,null,l,u),gi({visible:!1,x:0,y:0,item:null}),Mi(!1)},ab=()=>{const n=ks.item,o=Vn(n,(n==null?void 0:n.url)||(n==null?void 0:n.originalUrl)||(n==null?void 0:n.mjOriginalUrl)||null);if(!n||!o)return;const l=n.type==="image",u=n.type==="video",p=l?"png":u?"mp4":"file",m=l?"image/png":u?"video/mp4":"application/octet-stream",h={name:`Generated-${n.id}.${p}`,type:m,content:o,isImage:l,isVideo:u,isAudio:!1,fromHistory:!0,fileExt:p};Ii(x=>[...x,h]),Yi(!0),gi({visible:!1,x:0,y:0,item:null}),Mi(!1)},Vk=()=>{const n=ks.item,o=Vn(n,(n==null?void 0:n.url)||(n==null?void 0:n.originalUrl)||(n==null?void 0:n.mjOriginalUrl)||null);if(!o)return;const l=n!=null&&n.mjImages&&n.mjImages.length>1?n.mjImages:null,u=(n==null?void 0:n.selectedMjImageIndex)??0,p=l&&(l[u]||l[0])||o;f(m=>{const h=m.filter(y=>y.type==="preview");if(!h.length)return m;const x=Zi.current,b=ni.current;let v=null;if(x){const y=h.find(w=>w.id===x);y&&(v=y.id)}if(!v&&b&&b.size>0){const y=h.find(w=>b.has(w.id));y&&(v=y.id)}return v||(v=h[h.length-1].id),m.map(y=>y.id===v?{...y,content:p,previewType:n.type==="video"||Qt(p)?"video":"image",previewMjImages:l}:y)}),gi({visible:!1,x:0,y:0,item:null}),Mi(!1)},Kk=async()=>{const n=ks.item;if(!n)return;const o=p0.current.target==="chat"&&Date.now()-p0.current.at<3e3;if(sz||iz||o){ab();return}const l=Zi.current||ni.current&&[...ni.current][0];if(l){const u=At.get(l);if(u){if(u.type==="storyboard-node"){if(js.nodeId&&js.shotId&&ib(n)){gi({visible:!1,x:0,y:0,item:null}),Mi(!1);return}a("","warning");return}if(await Hk(u,n)){gi({visible:!1,x:0,y:0,item:null}),Mi(!1);return}}}if(js.nodeId&&js.shotId&&ib(n)){gi({visible:!1,x:0,y:0,item:null}),Mi(!1);return}ob()},W0=async n=>{if(!n||n.length===0){console.warn("[V3.5.1 Debug] No items to download");return}const o=m=>(m==null?void 0:m.localCacheUrl)||(m==null?void 0:m.url)||(m==null?void 0:m.originalUrl)||(m==null?void 0:m.mjOriginalUrl);if(n.length===1){const m=n[0],h=o(m);if(!(m!=null&&m.mjImages)&&h){ws({active:!0,current:0,total:1});try{const b=h;let v="mp4";if(b.startsWith("data:image"))v="png";else if(b.startsWith("data:video"))v="mp4";else if(m.type==="video"||b.includes("/video/")||b.includes("video_mp4"))v="mp4";else if(m.type==="image")v="png";else{const R=b.split("?")[0].split("/").pop();if(R&&R.includes(".")){const C=R.split(".").pop();C&&C.length<=5&&/^[a-z0-9]+$/i.test(C)&&(v=C)}}const w=`${(m.prompt||"download").replace(/[\\/:*?"<>|]/g,"_").slice(0,50)}.${v}`;if(b.startsWith("data:")){const j=document.createElement("a");j.href=b,j.download=w,j.click()}else{const j=Ns(m),{blob:R}=await Ji(b,{useProxy:j}),C=document.createElement("a");C.href=URL.createObjectURL(R),C.download=w,C.click()}ws({active:!1,current:1,total:1})}catch(b){console.error(":",b),ws({active:!1,current:0,total:0}),alert(": "+b.message)}return}}const l=new rv;let u=0;const p=n.length;ws({active:!0,current:0,total:p});try{for(const b of n){if(!b)continue;const v=[];if(b.mjImages&&b.mjImages.length>0)b.mjImages.forEach((y,w)=>{v.push({url:y,suffix:`_${w+1}`})});else{const y=o(b);y&&v.push({url:y,suffix:""})}for(const y of v)try{let w;if(y.url.startsWith("data:")){const L=y.url.split(","),Y=L[0].match(/:(.*?);/)[1],J=atob(L[1]);let q=J.length;const Z=new Uint8Array(q);for(;q--;)Z[q]=J.charCodeAt(q);w=new Blob([Z],{type:Y})}else{const L=Ns(b);w=(await Ji(y.url,{useProxy:L})).blob}let j=w.type.split("/")[1]||"png";const R=o(b);if(R&&!R.startsWith("data:")){const L=R.split(".").pop().split("?")[0];L&&L.length<5&&(j=L)}const C=(b.prompt||"untitled").replace(/[\\/:*?"<>|]/g,"_").slice(0,40),H=b.id?`_${b.id.slice(-4)}`:"",B=`${C}${H}${y.suffix}.${j}`;l.file(B,w),u++}catch(w){console.error(` [${b.id}]:`,w)}ws(y=>({...y,current:y.current+1}))}if(u===0){ws({active:!1,current:0,total:0}),alert("");return}const m=await l.generateAsync({type:"blob"}),h=new Date,x=`${h.getFullYear().toString().slice(2)}${(h.getMonth()+1).toString().padStart(2,"0")}${h.getDate().toString().padStart(2,"0")}-${h.getHours().toString().padStart(2,"0")}${h.getMinutes().toString().padStart(2,"0")}`;sv.saveAs(m,`tapnow-assets-${x}.zip`),ws({active:!1,current:0,total:0})}catch(m){console.error(":",m),ws({active:!1,current:0,total:0}),alert(": "+m.message)}},Yk=(n,o="all")=>{var w,j,R;const l=((w=n.settings)==null?void 0:w.mode)||"video",u=((j=n.settings)==null?void 0:j.shots)||[],p=((R=n.settings)==null?void 0:R.projectTitle)||"",m=ti(p)||"",h=[],x=C=>{const H=(C.description||C.prompt||"").trim();return ti(H)||""},b=(C,H,B,L)=>{if(!B)return;const Y=B.startsWith("data:")?Jo(B,".png")||".png":Fa(B,".png")||".png",J=x(C),q=`${m}-${J}-${H}-${L}${Y}`;h.push({url:B,filename:q})},v=(C,H,B)=>{if(!B)return;const L=B.startsWith("data:")?Jo(B,".mp4")||".mp4":Fa(B,".mp4")||".mp4",Y=x(C),J=`${m}-${Y}-${H}${L}`;h.push({url:B,filename:J})},y=o!=="all"&&u.some(C=>C.outputEnabled);return u.forEach((C,H)=>{var L;const B=C.scene_index||H+1;if(l==="image"){const Y=(L=C.output_images)!=null&&L.length?C.output_images:C.output_url?[C.output_url]:[];if(Y.length===0)return;if(o==="all"){Y.forEach((Z,oe)=>b(C,B,Z,oe+1));return}const J=Number.isInteger(C.selectedImageIndex)?C.selectedImageIndex:-1,q=!!C.outputEnabled;if(y){if(!q)return;if(J>=0&&Y[J]){b(C,B,Y[J],J+1);return}Y.forEach((Z,oe)=>b(C,B,Z,oe+1));return}J>=0&&Y[J]&&b(C,B,Y[J],J+1)}else{const Y=C.video_url||C.output_url;if(!Y)return;if(o==="all"){v(C,B,Y);return}C.outputEnabled&&v(C,B,Y)}}),h},lb=async(n,o="all")=>{var w;const l=Yk(n,o);if(!l.length){alert("");return}const u=new Date,p=`${u.getFullYear().toString().slice(2)}${String(u.getMonth()+1).padStart(2,"0")}${String(u.getDate()).padStart(2,"0")}-${String(u.getHours()).padStart(2,"0")}${String(u.getMinutes()).padStart(2,"0")}`,m=((w=n.settings)==null?void 0:w.projectTitle)||"",h=`${ti(m)||""}-batch-${p}.zip`,x=async j=>{var C;if(j.startsWith("data:")){const H=j.split(","),B=((C=H[0].match(/:(.*?);/i))==null?void 0:C[1])||"application/octet-stream",L=atob(H[1]||""),Y=new Uint8Array(L.length);for(let J=0;J<L.length;J++)Y[J]=L.charCodeAt(J);return new Blob([Y],{type:B})}const R=await fetch(j);if(!R.ok)throw new Error(`HTTP ${R.status}`);return await R.blob()};if(l.length===1){try{ws({active:!0,current:0,total:1});const j=await x(l[0].url),R=document.createElement("a");R.href=URL.createObjectURL(j),R.download=l[0].filename,R.click(),URL.revokeObjectURL(R.href),ws({active:!1,current:1,total:1})}catch(j){ws({active:!1,current:0,total:0}),alert(": "+j.message)}return}const b=new rv;ws({active:!0,current:0,total:l.length});let v=0;for(const j of l){try{const R=await x(j.url);b.file(j.filename,R),v+=1}catch(R){console.error(":",j.filename,R)}ws(R=>({...R,current:R.current+1}))}if(v===0){ws({active:!1,current:0,total:0}),alert("");return}const y=await b.generateAsync({type:"blob"});sv.saveAs(y,h),ws({active:!1,current:0,total:0})},ud=(n,o)=>{o!=null&&o.url&&(n.preventDefault(),n.stopPropagation(),ex({visible:!0,x:n.clientX,y:n.clientY,item:o}))},Ja=()=>ex({visible:!1,x:0,y:0,item:null}),Jk=()=>{const n=Vo.item;if(!(n!=null&&n.url))return;const o=n.type!=="video",l=n.type==="video",u=o?"png":"mp4",p=o?"image/png":"video/mp4",m={name:`Preview-${Date.now()}.${u}`,type:p,content:n.url,isImage:o,isVideo:l,isAudio:!1,fileExt:u};Ii(h=>[...h,m]),Yi(!0),Ja()},Gk=async()=>{const n=Vo.item;if(!(n!=null&&n.url))return;const o=Pn(window.innerWidth/2,window.innerHeight/2);let l={w:512,h:512};try{l=await Fr(n.url)}catch(u){console.warn("Preview dims fail",u)}Ur("input-image",o.x+50,o.y+50,null,n.url,l),Ja()},Xk=(n,o)=>{n.preventDefault(),n.stopPropagation();const l=At.get(o);!l||!l.content||tx({visible:!0,x:n.clientX,y:n.clientY,nodeId:o})},V0=()=>{tx({visible:!1,x:0,y:0,nodeId:null})},Zk=()=>{const n=Wc.nodeId,o=At.get(n);if(!o||!o.content)return;const l=!Qt(o.content),u=Qt(o.content),p=l?"png":"mp4",m=l?"image/png":"video/mp4",h={name:`InputImage-${Date.now()}.${p}`,type:m,content:o.content,isImage:l,isVideo:u,isAudio:!1,fileExt:p};Ii(x=>[...x,h]),Yi(!0),V0()},cb=M.memo(({connections:n,nodesMap:o,connectionsByNode:l,connectingSource:u,connectingTarget:p,connectingInputType:m,mousePos:h,apiConfigsMap:x,selectedNodeId:b,onDisconnectConnection:v,visibleNodes:y})=>{const w=M.useMemo(()=>new Set(y.map(R=>R.id)),[y]),j=M.useMemo(()=>n.filter(R=>w.has(R.from)||w.has(R.to)),[n,w]);return s.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-visible w-full h-full",children:s.jsxs("svg",{className:"absolute inset-0 overflow-visible w-full h-full pointer-events-none",children:[j.map(R=>{var Se;const C=o.get(R.from),H=o.get(R.to);if(!C||!H)return null;const B=b&&(C.id===b||H.id===b),L=B?1:.35,Y=C.x+C.width-4,J=C.y+C.height/2,q=H.x+4;let Z=H.y+H.height/2;if(H.type==="image-compare"){const Ee=(l.to.get(H.id)||[]).findIndex(Be=>Be.id===R.id);Ee===0?Z=H.y+H.height*.33:Ee>=1&&(Z=H.y+H.height*.66)}if(H.type==="gen-image"&&(R.inputType==="oref"||R.inputType==="sref")){const ze=Ht((Se=H.settings)==null?void 0:Se.model);if(ze&&(ze.id.includes("mj")||ze.provider.toLowerCase().includes("midjourney"))){const Fe=(l.to.get(H.id)||[]).some(ct=>!ct.inputType||ct.inputType==="default");let He=12;He+=24,Fe&&(He+=68),He+=108,R.inputType==="oref"?Z=H.y+He+16*.5:R.inputType==="sref"&&(Z=H.y+He+16+6+28+6+16*.5)}}if(H.type==="gen-video"&&(R.inputType==="veo_start"||R.inputType==="veo_end")){const ht=Math.max(110,Math.min(180,H.height*.4)),Yt=8,Wt=12,Jt=14,Ft=12,dn=8,O=18,me=8,He=(l.to.get(H.id)||[]).some(xt=>!xt.inputType||xt.inputType==="default");let ct=12;ct+=24,He&&(ct+=68),ct+=ht+Yt;const wt=ct+Wt+Jt+dn+Ft+dn+O*.5,Et=wt+O+me;Z=H.y+(R.inputType==="veo_start"?wt:Et)}const oe=Math.abs(q-Y),te=Y+oe*.5,ee=q-oe*.5,ce=(Y+q)/2,W=(J+Z)/2;return s.jsxs("g",{className:"connection-group",style:{opacity:L},children:[s.jsx("path",{d:`M ${Y} ${J} C ${te} ${J}, ${ee} ${Z}, ${q} ${Z}`,stroke:"transparent",strokeWidth:"20",fill:"none",style:{pointerEvents:"stroke"}}),s.jsx("path",{d:`M ${Y} ${J} C ${te} ${J}, ${ee} ${Z}, ${q} ${Z}`,stroke:"#18181b",strokeWidth:"4",fill:"none"}),s.jsx("path",{d:`M ${Y} ${J} C ${te} ${J}, ${ee} ${Z}, ${q} ${Z}`,stroke:"#71717a",strokeWidth:"2",fill:"none"}),s.jsx("circle",{cx:Y,cy:J,r:"2",fill:"#71717a"}),s.jsx("circle",{cx:q,cy:Z,r:"2",fill:"#71717a"}),s.jsxs("g",{className:"connection-delete cursor-pointer",style:{opacity:B?1:.35,pointerEvents:"auto",cursor:"pointer"},onClick:ze=>{ze.stopPropagation(),ze.preventDefault(),v(R.id)},onMouseDown:ze=>{ze.stopPropagation(),ze.preventDefault(),v(R.id)},children:[s.jsx("circle",{cx:ce,cy:W,r:"25",fill:"transparent",style:{pointerEvents:"auto",cursor:"pointer"},onClick:ze=>{ze.stopPropagation(),ze.preventDefault(),v(R.id)},onMouseDown:ze=>{ze.stopPropagation(),ze.preventDefault(),v(R.id)}}),s.jsx("circle",{cx:ce,cy:W,r:"12",fill:"#ef4444",opacity:"0.8",style:{pointerEvents:"none"}}),s.jsx("circle",{cx:ce,cy:W,r:"8",fill:"#ef4444",style:{pointerEvents:"none"}}),s.jsx(Q5,{size:10,className:"text-white",x:ce-5,y:W-5,style:{pointerEvents:"none"}})]})]},R.id)}),u&&(()=>{const R=o.get(u);return R?s.jsx("path",{d:`M ${R.x+R.width-4} ${R.y+R.height/2} C ${R.x+R.width+100} ${R.y+R.height/2}, ${h.x-100} ${h.y}, ${h.x} ${h.y}`,stroke:"#60a5fa",strokeWidth:"2",fill:"none",strokeDasharray:"4,4"}):null})(),p&&(()=>{var B;const R=o.get(p);if(!R)return null;const C=R.x+4;let H=R.y+R.height/2;if(R.type==="gen-image"&&m){const L=Ht((B=R.settings)==null?void 0:B.model);if(L&&(L.id.includes("mj")||L.provider.toLowerCase().includes("midjourney"))){const Be=(l.to.get(R.id)||[]).some(st=>!st.inputType||st.inputType==="default");let nt=12;nt+=24,Be&&(nt+=68),nt+=108,m==="oref"?H=R.y+nt+16*.5:m==="sref"&&(H=R.y+nt+16+6+28+6+16*.5)}}else if(R.type==="gen-video"&&(m==="veo_start"||m==="veo_end")){const oe=Math.max(110,Math.min(180,R.height*.4)),te=8,ee=12,ce=14,W=12,Se=8,ze=18,Ee=8,nt=(l.to.get(R.id)||[]).some(Jt=>!Jt.inputType||Jt.inputType==="default");let st=12;st+=24,nt&&(st+=68),st+=oe+te;const Yt=st+ee+ce+Se+W+Se+ze*.5,Wt=Yt+ze+Ee;H=R.y+(m==="veo_start"?Yt:Wt)}else R.type==="image-compare"&&(H=R.y+R.height/2);return s.jsx("path",{d:`M ${C} ${H} C ${C-100} ${H}, ${h.x+100} ${h.y}, ${h.x} ${h.y}`,stroke:"#60a5fa",strokeWidth:"2",fill:"none",strokeDasharray:"4,4"})})()]})})},(n,o)=>n.connections===o.connections&&n.visibleNodes===o.visibleNodes&&n.selectedNodeId===o.selectedNodeId&&n.connectingSource===o.connectingSource&&n.connectingTarget===o.connectingTarget&&n.connectingInputType===o.connectingInputType&&n.mousePos.x===o.mousePos.x&&n.mousePos.y===o.mousePos.y);M.useCallback(()=>s.jsx(cb,{connections:g,nodesMap:At,connectionsByNode:Qo,connectingSource:xr,connectingTarget:Ln,connectingInputType:Ds,mousePos:i0,apiConfigsMap:qo,selectedNodeId:Ce,onDisconnectConnection:O0,visibleNodes:Xu}),[g,At,Qo,xr,Ln,Ds,i0,qo,Ce,O0,Xu]);const db=M.useMemo(()=>{const n=new Map;return g.forEach(o=>{(!o.inputType||o.inputType==="default")&&n.set(o.to,!0)}),n},[g]),ub=M.useCallback(n=>{const o=new Set,l=Qo.from.get(n)||[],u=Qo.to.get(n)||[];return l.forEach(p=>o.add(p.to)),u.forEach(p=>o.add(p.from)),o},[Qo]),pb=M.useMemo(()=>{const n=new Map;if(Ce||Hn.size>0){const o=Ce||(Hn.size===1?Array.from(Hn)[0]:null);o&&n.set(o,ub(o))}return n},[Ce,Hn,ub]),qk=M.useCallback(n=>{var C,H,B,L,Y,J,q,Z,oe,te,ee,ce,W,Se,ze,Ee,Be,nt,st,ht,Yt,Wt,Jt,Ft,dn;const l=Xt.zoom<.4,u=Ce===n.id||Hn.has(n.id),p=Dx(n.id),m=Cl===n.id,h=db.get(n.id)||!1,x=As===n.id||As&&Hn.has(n.id),b=Ce||(Hn.size===1?Array.from(Hn)[0]:null),v=b?pb.get(b):null,y=b&&b!==n.id&&v&&v.has(n.id),w=Ht((C=n.settings)==null?void 0:C.model),j=w?(w.modelName||w.id||"").includes("nano-banana-2"):(((H=n.settings)==null?void 0:H.model)||"").includes("nano-banana-2"),R=n.type==="gen-image"||n.type==="gen-video"||n.type==="image-compare";return l?s.jsxs("div",{"data-node-id":n.id,className:`absolute node-wrapper flex flex-col ${u?"ring-1 ring-blue-500":e==="dark"?"border border-zinc-800":e==="solarized"?"border border-[#eee8d5]":"border border-zinc-200"} ${e==="dark"?"bg-[#18181b]":e==="solarized"?"bg-[#eee8d5]":"bg-white"}`,style:{left:n.x,top:n.y,width:n.width,height:n.height,cursor:As===n.id||As&&Hn.has(n.id)?"grabbing":"default",zIndex:x?50:10,border:`1px solid ${e==="dark"?"#3f3f46":e==="solarized"?"#eee8d5":"#e4e4e7"}`,background:e==="dark"?"#18181b":e==="solarized"?"#eee8d5":"#fff",boxShadow:"none",borderRadius:"0",transform:"translateZ(0)",backfaceVisibility:"hidden"},onDragOver:R?Ha:void 0,onDrop:R?O=>H0(n.id,O):void 0,onMouseDownCapture:O=>{if(O.button!==0||O.target===O.currentTarget||!O.target.closest('input, textarea, select, button, a, [contenteditable="true"]'))return;if(O.nativeEvent&&(O.nativeEvent.__tapnowSelectionHandled=!0),O.ctrlKey||O.metaKey){Hr(He=>{const ct=new Set(He);return ct.has(n.id)?ct.delete(n.id):ct.add(n.id),ct.size===1?xe(Array.from(ct)[0]):xe(null),ct});return}Hn.has(n.id)&&Hn.size>1?xe(n.id):(xe(n.id),Hr(new Set([n.id])))},onMouseDown:O=>{var me;(me=O.nativeEvent)!=null&&me.__tapnowSelectionHandled||O.button===0&&(O.stopPropagation(),Bc("node"),O.ctrlKey||O.metaKey?Hr(Fe=>{const He=new Set(Fe);return He.has(n.id)?He.delete(n.id):He.add(n.id),He.size===1?xe(Array.from(He)[0]):xe(null),He}):Hn.has(n.id)&&Hn.size>1?xe(n.id):(xe(n.id),Hr(new Set([n.id]))),Fc(n.id))},onMouseEnter:()=>{(xr||Ln)&&Fo(n.id)},onMouseLeave:()=>{(xr||Ln)&&Cl===n.id&&Fo(null)},onMouseUp:O=>si(n.id,O),children:[n.type==="input-image"&&n.content&&s.jsx("div",{className:"w-full h-full relative",children:Qt(n.content)?s.jsx("video",{src:n.content,className:"w-full h-full object-cover opacity-80",muted:!0,playsInline:!0}):s.jsx(mr,{src:n.content,className:"w-full h-full object-cover opacity-80",alt:""})}),n.type==="video-input"&&n.content&&s.jsx("video",{src:n.content,className:"w-full h-full object-cover opacity-80",muted:!0,playsInline:!0}),!n.content&&s.jsx("div",{className:`p-2 font-bold text-sm truncate ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:n.type==="input-image"?"":n.type==="video-input"?"":n.type==="gen-image"||n.type==="gen-image"?"":n.type==="gen-video"?"":n.type==="text-node"?"":n.type==="preview"?"":n.type==="novel-input"?"":n.type==="extract-characters-scenes"?"":n.type==="character-description"?"":n.type==="scene-description"?"":n.type==="generate-character-video"?"":n.type==="generate-scene-video"?"":n.type==="generate-character-image"?"":n.type==="generate-scene-image"?"":n.type==="create-character"?"":n.type==="create-scene"?"":n.type==="save-to-local"||n.type==="local-save"?"":n.type||""}),n.type!=="input-image"&&n.type!=="video-input"&&n.type!=="video-analyze"&&n.type!=="preview"&&(n.type==="image-compare"?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"input-point",style:{top:"33%",left:"-0.25rem",width:"0.5rem",height:"0.5rem",backgroundColor:h?"#60a5fa":"#52525b",borderRadius:"50%",position:"absolute",zIndex:20,pointerEvents:"auto"},onMouseDown:O=>{O.stopPropagation(),O.preventDefault();const me=Pn(O.clientX,O.clientY);Qs(me),Rs(n.id),Ls("default")},onMouseUp:O=>si(n.id,O,"default")}),s.jsx("div",{className:"input-point",style:{top:"66%",left:"-0.25rem",width:"0.5rem",height:"0.5rem",backgroundColor:h?"#60a5fa":"#52525b",borderRadius:"50%",position:"absolute",zIndex:20,pointerEvents:"auto"},onMouseDown:O=>{O.stopPropagation(),O.preventDefault();const me=Pn(O.clientX,O.clientY);Qs(me),Rs(n.id),Ls("default")},onMouseUp:O=>si(n.id,O,"default")})]}):s.jsx("div",{className:"input-point",style:{top:"50%",left:"-0.25rem",width:"0.5rem",height:"0.5rem",backgroundColor:h?"#60a5fa":"#52525b",borderRadius:"50%",position:"absolute",zIndex:20,pointerEvents:"auto"},onMouseDown:O=>{O.stopPropagation(),O.preventDefault();const me=Pn(O.clientX,O.clientY);Qs(me),Rs(n.id),Ls("default")},onMouseUp:O=>si(n.id,O,"default")})),n.type!=="preview"&&s.jsx("div",{className:"connector connector-right",style:{position:"absolute",top:"50%",right:"-0.45rem",width:"0.9rem",height:"0.9rem",backgroundColor:xr===n.id?"#d4d4d8":"#27272a",border:"1px solid #71717a",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"crosshair",zIndex:30,opacity:xr===n.id?1:.5,pointerEvents:"auto"},onMouseDown:O=>{O.stopPropagation(),O.preventDefault();const me=Pn(O.clientX,O.clientY);Qs(me),Sl(n.id)},children:s.jsx(vo,{size:10})})]},n.id):s.jsxs("div",{"data-node-id":n.id,className:`absolute rounded-xl shadow-xl transition-shadow duration-150 group flex flex-col node-wrapper ${u?"ring-1 ring-blue-500 shadow-blue-500/20":y?"ring-2 ring-blue-300/60 shadow-blue-300/30":e==="dark"?"border border-zinc-800 shadow-black/40":e==="solarized"?"border border-[#eee8d5] shadow-black/10":"border border-zinc-200 shadow-black/10"} ${m&&(xr&&xr!==n.id||Ln&&Ln!==n.id)?"ring-2 ring-green-500/50":""} ${e==="dark"?"bg-[#18181b]":e==="solarized"?"bg-[#eee8d5]":"bg-white"}`,style:{left:n.x,top:n.y,width:n.width,height:n.height,cursor:As===n.id||As&&Hn.has(n.id)?"grabbing":"default",zIndex:x?50:10,WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",transform:"translateZ(0)",backfaceVisibility:"hidden"},onDragOver:R?Ha:void 0,onDrop:R?O=>H0(n.id,O):void 0,onMouseDownCapture:O=>{if(O.button!==0||O.target===O.currentTarget||!O.target.closest('input, textarea, select, button, a, [contenteditable="true"]'))return;if(O.nativeEvent&&(O.nativeEvent.__tapnowSelectionHandled=!0),O.ctrlKey||O.metaKey){Hr(He=>{const ct=new Set(He);return ct.has(n.id)?ct.delete(n.id):ct.add(n.id),ct.size===1?xe(Array.from(ct)[0]):xe(null),ct});return}Hn.has(n.id)&&Hn.size>1?xe(n.id):(xe(n.id),Hr(new Set([n.id])))},onMouseDown:O=>{var me;(me=O.nativeEvent)!=null&&me.__tapnowSelectionHandled||O.button===0&&(O.stopPropagation(),Bc("node"),O.ctrlKey||O.metaKey?Hr(Fe=>{const He=new Set(Fe);return He.has(n.id)?He.delete(n.id):He.add(n.id),He.size===1?xe(Array.from(He)[0]):xe(null),He}):Hn.has(n.id)&&Hn.size>1?xe(n.id):(xe(n.id),Hr(new Set([n.id]))),Fc(n.id),wn(null))},onMouseEnter:()=>{(xr||Ln)&&Fo(n.id)},onMouseLeave:()=>{(xr||Ln)&&Cl===n.id&&Fo(null)},onMouseUp:O=>si(n.id,O),onDoubleClick:O=>{O.stopPropagation(),(n.type==="input-image"||n.type==="video-input")&&n.content&&cr({url:n.content,type:Qt(n.content)?"video":"image"})},children:[s.jsx("button",{onClick:O=>{O.stopPropagation(),E0(n.id)},className:`absolute -top-2.5 -right-2.5 z-50 p-1 rounded-full shadow border opacity-0 group-hover:opacity-100 transition-opacity scale-90 hover:scale-100 ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:text-red-500 hover:bg-zinc-700 border-zinc-700":"bg-zinc-100 text-zinc-500 hover:text-red-500 hover:bg-zinc-200 border-zinc-300"}`,onMouseDown:O=>O.stopPropagation(),children:s.jsx(Ws,{size:12})}),s.jsx("div",{className:"absolute bottom-1 right-1 w-4 h-4 z-[100] resize-handle flex items-end justify-end p-0.5",onMouseDown:O=>{O.stopPropagation(),O.preventDefault(),Mu(n.id)},children:s.jsx("svg",{width:"6",height:"6",viewBox:"0 0 8 8",fill:"none",className:"text-zinc-600",children:s.jsx("path",{d:"M8 0L8 8L0 8",stroke:"currentColor",strokeWidth:"2"})})}),n.type!=="input-image"&&n.type!=="video-input"&&n.type!=="video-analyze"&&n.type!=="preview"&&(n.type==="image-compare"?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`input-point ${Ln===n.id&&!Ds?"active":""}`,style:{top:"33%"},title:" 1 ",onMouseDown:O=>{O.stopPropagation(),O.preventDefault();const me=Pn(O.clientX,O.clientY);Qs(me),Rs(n.id),Ls("default")},onMouseUp:O=>si(n.id,O,"default")}),s.jsx("div",{className:`input-point ${Ln===n.id&&!Ds?"active":""}`,style:{top:"66%"},title:" 2 ",onMouseDown:O=>{O.stopPropagation(),O.preventDefault();const me=Pn(O.clientX,O.clientY);Qs(me),Rs(n.id),Ls("default")},onMouseUp:O=>si(n.id,O,"default")})]}):s.jsx("div",{className:`input-point ${h?"connected":""} ${Ln===n.id&&!Ds?"active":""}`,title:"",onMouseDown:O=>{O.stopPropagation(),O.preventDefault();const me=Pn(O.clientX,O.clientY);Qs(me),Rs(n.id),Ls("default")},onMouseUp:O=>si(n.id,O,"default")})),n.type!=="preview"&&s.jsx("div",{className:`connector connector-right ${xr===n.id?"active":""} ${Ln&&Cl===n.id?"ring-2 ring-green-500/50":""}`,title:"",onMouseDown:O=>{O.stopPropagation(),O.preventDefault();const me=Pn(O.clientX,O.clientY);Qs(me),Sl(n.id)},onMouseEnter:()=>{Ln&&Fo(n.id)},onMouseLeave:()=>{Ln&&Cl===n.id&&Fo(null)},children:s.jsx(vo,{size:10})}),s.jsxs("div",{className:`overflow-hidden rounded-xl flex-1 flex flex-col pointer-events-none h-full w-full relative ${e==="dark"?"bg-[#18181b]":e==="solarized"?"bg-[#eee8d5]":"bg-white"}`,children:[n.type==="novel-input"&&s.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:[s.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-2 border-b text-xs font-semibold shrink-0",children:[s.jsx(oi,{size:12,className:"text-blue-500"}),s.jsx("span",{children:""})]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-2 p-3 overflow-hidden min-h-0",children:[s.jsx("textarea",{value:((B=n.settings)==null?void 0:B.content)||"",onChange:O=>{const me=O.target.value;me.length<=1e4&&Le(n.id,{content:me})},placeholder:"10,000...",maxLength:1e4,className:`w-full flex-1 resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"||e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:O=>O.stopPropagation()}),s.jsxs("div",{className:"text-right text-[10px] text-zinc-500 shrink-0",children:[(((L=n.settings)==null?void 0:L.content)||"").length,"/10,000"]}),s.jsxs("button",{className:"w-full py-2 rounded text-xs font-medium transition-colors flex items-center justify-center gap-1.5 bg-blue-600 hover:bg-blue-500 text-white shrink-0",onMouseDown:O=>O.stopPropagation(),onClick:O=>{O.stopPropagation(),zk(n.id)},children:[s.jsx($d,{size:12})," "]})]})]}),n.type==="extract-characters-scenes"&&s.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b shrink-0",children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-semibold",children:[s.jsx(Lp,{size:12,className:"text-purple-500"}),s.jsx("span",{children:""})]}),((Y=n.settings)==null?void 0:Y.analysisResults)&&s.jsx("span",{className:"text-[10px] opacity-70",children:(((J=n.settings.analysisResults.characters)==null?void 0:J.length)||0)+(((q=n.settings.analysisResults.scenes)==null?void 0:q.length)||0)})]}),s.jsxs("div",{className:"flex-1 flex flex-col p-3 overflow-hidden min-h-0",children:[s.jsx("div",{className:"flex flex-col gap-3",children:s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsx("label",{className:"text-[10px] font-medium opacity-70",children:""}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:O=>{O.stopPropagation(),wn((Me==null?void 0:Me.nodeId)===n.id&&Me.type==="extract-model"?null:{nodeId:n.id,type:"extract-model"})},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:O=>O.stopPropagation(),children:[s.jsx("span",{className:"truncate font-mono",children:td((Z=n.settings)==null?void 0:Z.model)}),s.jsx(Kr,{size:12,className:"opacity-50 shrink-0"})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="extract-model"&&s.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:O=>O.stopPropagation(),onMouseLeave:()=>Dr(null),children:[s.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(Zr).filter(([,O])=>O.models.some(me=>me.type==="Chat")).map(([O,me])=>s.jsx("button",{onMouseEnter:()=>Dr(O),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${er===O?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:me.name||O},O))}),s.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[er&&((oe=Zr[er])==null?void 0:oe.models.filter(O=>O.type==="Chat").map(O=>{var He;const me=O._uid||O.id,Fe=Ut((He=n.settings)==null?void 0:He.model);return s.jsxs("button",{onClick:()=>{Le(n.id,{model:me}),N0(me);try{localStorage.setItem("tapnow_last_extract_model",me)}catch{}wn(null),Dr(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${Fe===me?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[s.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:O.displayName||O.modelName||O.id}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(me)}`})]},me)})),!er&&s.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar mt-2",children:[(()=>{var He;const O=(He=n.settings)==null?void 0:He.analysisResults;if(!O)return s.jsxs("div",{className:"flex flex-col items-center justify-center py-6 text-[11px] opacity-70",children:[s.jsx(nv,{size:18,className:"mb-1 opacity-70"}),s.jsx("span",{children:""})]});const me=Array.isArray(O.characters)?O.characters:[],Fe=Array.isArray(O.scenes)?O.scenes:[];return s.jsxs("div",{className:"flex flex-col gap-3",children:[me.length>0&&s.jsxs("div",{children:[s.jsxs("div",{className:"text-[10px] font-medium mb-1 opacity-70",children:[" (",me.length,")"]}),me.map((ct,jt)=>s.jsxs("div",{className:`p-2 rounded mb-1 ${e==="dark"?"bg-zinc-800":"bg-white border border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-1 text-[11px]",children:[s.jsx("span",{className:`w-2 h-2 rounded-full shrink-0 ${jt===0?"bg-red-500":jt===1?"bg-purple-500":jt===2?"bg-blue-500":"bg-zinc-400"}`}),s.jsx("span",{className:"font-medium",children:ct.name||""})]}),ct.description&&s.jsx("div",{className:"mt-1 text-[10px] opacity-70 leading-snug",children:ct.description})]},`${ct.name||"char"}-${jt}`))]}),Fe.length>0&&s.jsxs("div",{children:[s.jsxs("div",{className:"text-[10px] font-medium mb-1 opacity-70",children:[" (",Fe.length,")"]}),Fe.map((ct,jt)=>s.jsxs("div",{className:`p-2 rounded mb-1 ${e==="dark"?"bg-zinc-800":"bg-white border border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-1 text-[11px]",children:[s.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 shrink-0"}),s.jsx("span",{className:"font-medium",children:ct.location||ct.name||""})]}),ct.description&&s.jsx("div",{className:"mt-1 text-[10px] opacity-70 leading-snug",children:ct.description})]},`${ct.location||"scene"}-${jt}`))]}),me.length===0&&Fe.length===0&&s.jsx("div",{className:"text-[11px] text-zinc-500",children:"/"})]})})(),((te=n.settings)==null?void 0:te.errorMsg)&&s.jsx("div",{className:"mt-2 text-[10px] text-red-500 break-words",children:n.settings.errorMsg})]}),((ee=n.settings)==null?void 0:ee.isAnalyzing)&&s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"text-[10px] mb-1 opacity-70",children:"..."}),s.jsx("div",{className:`w-full h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:s.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${((ce=n.settings)==null?void 0:ce.progress)||0}%`}})}),s.jsxs("div",{className:"text-[10px] mt-1 opacity-70",children:[((W=n.settings)==null?void 0:W.progress)||0,"%"]})]}),s.jsx("button",{className:`mt-2 w-full py-2 rounded text-xs font-medium transition-colors flex items-center justify-center gap-1.5 ${(Se=n.settings)!=null&&Se.isAnalyzing?"bg-zinc-700 text-zinc-400 cursor-not-allowed":"bg-purple-600 hover:bg-purple-500 text-white"}`,onMouseDown:O=>O.stopPropagation(),onClick:O=>{O.stopPropagation(),nb(n.id)},children:(ze=n.settings)!=null&&ze.isAnalyzing?s.jsxs(s.Fragment,{children:[s.jsx(wo,{size:12,className:"animate-spin"}),"..."]}):s.jsxs(s.Fragment,{children:[s.jsx($d,{size:12}),""]})})]})]}),(n.type==="character-description"||n.type==="scene-description")&&s.jsx("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:(()=>{var Et,xt,yt,pt,St,hn,It,an,Bt,Sr,ie,ge,Je,mt,et,Ae,zt,ln,at,On,Bn,An,xn;const O=n.type==="character-description",me=O?"":"",Fe=((Et=n.settings)==null?void 0:Et.mode)||"video",He={name:((xt=n.settings)==null?void 0:xt.characterName)||((yt=n.settings)==null?void 0:yt.name)||"",role:((pt=n.settings)==null?void 0:pt.role)||"",description:((St=n.settings)==null?void 0:St.description)||"",age:((hn=n.settings)==null?void 0:hn.age)||"",gender:((It=n.settings)==null?void 0:It.gender)||""},ct={name:((an=n.settings)==null?void 0:an.sceneName)||((Bt=n.settings)==null?void 0:Bt.location)||"",location:((Sr=n.settings)==null?void 0:Sr.sceneName)||((ie=n.settings)==null?void 0:ie.location)||"",description:((ge=n.settings)==null?void 0:ge.description)||""},jt=O?Ka(He,Fe):ad(ct),wt=((Je=n.settings)==null?void 0:Je.prompt)||jt;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`flex items-center justify-between px-3 py-2 border-b text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(oi,{size:12,className:O?"text-red-500":"text-green-500"}),s.jsx("span",{children:me})]}),O?He.name?s.jsxs("div",{className:"text-[10px] text-zinc-500",children:[": ",He.name]}):null:ct.name?s.jsxs("div",{className:"text-[10px] text-zinc-500",children:[": ",ct.name]}):null]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-y-auto custom-scrollbar min-h-0",children:[s.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[s.jsx("button",{className:`px-2 py-1 rounded text-[10px] transition-colors ${Fe==="video"?"bg-blue-500 text-white":e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,onMouseDown:lt=>lt.stopPropagation(),onClick:()=>{var zn;const lt=((zn=n.settings)==null?void 0:zn.prompt)||(O?Ka(He,"image"):jt),Dt=O?Xx(lt):lt;Le(n.id,{mode:"video",prompt:Dt}),setTimeout(()=>bk(n.id),0)},children:""}),s.jsx("button",{className:`px-2 py-1 rounded text-[10px] transition-colors ${Fe==="image"?"bg-blue-500 text-white":e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,onMouseDown:lt=>lt.stopPropagation(),onClick:()=>{var zn;const lt=((zn=n.settings)==null?void 0:zn.prompt)||(O?Ka(He,"video"):jt),Dt=O?Gx(lt):lt;Le(n.id,{mode:"image",prompt:Dt}),setTimeout(()=>xk(n.id),0)},children:""}),s.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[s.jsx("button",{onClick:()=>Zx(n.id,"enhance"),disabled:(mt=n.settings)==null?void 0:mt.isEnhancing,className:`px-2 py-1 rounded text-[10px] transition-colors ${(et=n.settings)!=null&&et.isEnhancing?e==="dark"?"bg-zinc-700 text-zinc-500 cursor-not-allowed":"bg-zinc-200 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-purple-600/80 text-white hover:bg-purple-500":"bg-purple-600 text-white hover:bg-purple-500"}`,children:O?"":""}),s.jsx("button",{onClick:()=>Zx(n.id,"filter"),disabled:(Ae=n.settings)==null?void 0:Ae.isEnhancing,className:`px-2 py-1 rounded text-[10px] transition-colors ${(zt=n.settings)!=null&&zt.isEnhancing?e==="dark"?"bg-zinc-700 text-zinc-500 cursor-not-allowed":"bg-zinc-200 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"}`,children:""})]})]}),s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("div",{className:"flex items-center justify-between text-[10px] text-zinc-500",children:[s.jsx("span",{children:""}),((ln=n.settings)==null?void 0:ln.isEnhancing)&&s.jsxs("span",{className:"flex items-center gap-1 text-blue-400",children:[s.jsx(wo,{size:10,className:"animate-spin"}),""]})]}),s.jsx("textarea",{value:wt,onChange:lt=>Le(n.id,{prompt:lt.target.value}),placeholder:"/...",className:`w-full h-28 resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:lt=>lt.stopPropagation()})]}),s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsx("label",{className:"text-[10px] font-medium opacity-70",children:"/"}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:lt=>{lt.stopPropagation(),wn((Me==null?void 0:Me.nodeId)===n.id&&Me.type==="desc-model"?null:{nodeId:n.id,type:"desc-model"})},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:lt=>lt.stopPropagation(),children:[s.jsx("span",{className:"truncate font-mono",children:td((at=n.settings)==null?void 0:at.chatModel)}),s.jsx(Kr,{size:12,className:"opacity-50 shrink-0"})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="desc-model"&&s.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:lt=>lt.stopPropagation(),onMouseLeave:()=>Dr(null),children:[s.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(Zr).filter(([,lt])=>lt.models.some(Dt=>Dt.type==="Chat")).map(([lt,Dt])=>s.jsx("button",{onMouseEnter:()=>Dr(lt),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${er===lt?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:Dt.name||lt},lt))}),s.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[er&&((On=Zr[er])==null?void 0:On.models.filter(lt=>lt.type==="Chat").map(lt=>{var U;const Dt=lt._uid||lt.id,zn=Ut((U=n.settings)==null?void 0:U.chatModel);return s.jsxs("button",{onClick:()=>{Le(n.id,{chatModel:Dt}),N0(Dt);try{localStorage.setItem("tapnow_last_extract_model",Dt)}catch{}wn(null),Dr(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${zn===Dt?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[s.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:lt.displayName||lt.modelName||lt.id}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(Dt)}`})]},Dt)})),!er&&s.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsx("label",{className:"text-[10px] font-medium opacity-70",children:""}),s.jsx("select",{value:((Bn=n.settings)==null?void 0:Bn.style)||"none",onChange:lt=>{var Ge;const Dt=lt.target.value,zn=mk(Dt),U=((Ge=n.settings)==null?void 0:Ge.prompt)||jt,Ze=U.includes("")?U.replace(/^[^]+/,`${zn}`):`${zn}${U}`;Le(n.id,{style:Dt,prompt:Ze})},className:`w-full text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:lt=>lt.stopPropagation(),children:hk.map(lt=>s.jsx("option",{value:lt.value,children:lt.label},lt.value))})]}),s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsx("label",{className:"text-[10px] font-medium opacity-70",children:""}),s.jsx("div",{className:`rounded-lg border-2 border-dashed p-2 transition-colors drop-zone ${e==="dark"?"border-zinc-700 bg-zinc-800/60":"border-zinc-300 bg-white"}`,onDrop:lt=>tk(n.id,lt),onDragOver:U0,onDragLeave:F0,onMouseDown:lt=>lt.stopPropagation(),children:((xn=(An=n.settings)==null?void 0:An.referenceImages)==null?void 0:xn.length)>0?s.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[n.settings.referenceImages.map((lt,Dt)=>s.jsxs("div",{className:"relative aspect-square rounded overflow-hidden",children:[s.jsx(mr,{src:lt,className:"w-full h-full object-cover"}),s.jsx("button",{onClick:zn=>{zn.stopPropagation();const U=[...n.settings.referenceImages];U.splice(Dt,1),Le(n.id,{referenceImages:U})},className:"absolute top-1 right-1 p-1 rounded-full bg-black/60 text-white hover:bg-red-500",title:"",children:s.jsx(Ws,{size:10})})]},`${n.id}-ref-${Dt}`)),s.jsxs("label",{className:"aspect-square rounded border border-dashed border-zinc-500/60 flex items-center justify-center text-[10px] text-zinc-400 cursor-pointer hover:border-blue-400 hover:text-blue-400",children:["+ ",s.jsx("input",{type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:lt=>Yx(n.id,lt)})]})]}):s.jsxs("label",{className:"flex flex-col items-center justify-center gap-1 text-[10px] text-zinc-500 cursor-pointer",children:[s.jsx(ua,{size:16}),"",s.jsx("input",{type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:lt=>Yx(n.id,lt)})]})})]})]})]})})()}),(n.type==="generate-character-video"||n.type==="generate-scene-video")&&s.jsx("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:(()=>{var xn,lt,Dt,zn,U,Ze,Ge,it,tt,$t,nn,Gt;const O=n.type==="generate-character-video",me=O?"character-description":"scene-description",Fe=O?"generate-character-image":"generate-scene-image",He=g.filter(we=>we.to===n.id).map(we=>At.get(we.from)).find(we=>(we==null?void 0:we.type)===me),ct=g.filter(we=>we.to===n.id).map(we=>At.get(we.from)).find(we=>(we==null?void 0:we.type)===Fe),jt=kt.find(we=>we.sourceNodeId===n.id&&we.status==="completed"),wt=kt.find(we=>we.sourceNodeId===n.id&&we.status==="generating"),Et=kt.find(we=>we.sourceNodeId===n.id&&we.status==="failed"),xt=Vn(jt),yt=ct?kt.find(we=>we.sourceNodeId===ct.id&&we.status==="completed"):null,pt=(xn=yt==null?void 0:yt.output_images)!=null&&xn.length?yt.output_images:(lt=yt==null?void 0:yt.mjImages)!=null&&lt.length?yt.mjImages:[],St=Vn(yt),hn=pt.length>0?pt:St?[St]:[],It=(Dt=ct==null?void 0:ct.settings)==null?void 0:Dt.selectedImageIndex,an=It!=null&&hn[It]?hn[It]:null,Bt=((zn=n.settings)==null?void 0:zn.videoPrompt)||((U=He==null?void 0:He.settings)==null?void 0:U.prompt)||"",Sr=gx[n.id]||0,ie=jt!=null&&jt.durationMs?(jt.durationMs/1e3).toFixed(1):null,ge=!!wt,Je=Ut(La)||Ut((Ze=je.find(we=>we.type==="Video"&&(we.id==="sora-2"||we.id==="sora-2-pro")))==null?void 0:Ze.id)||Ut((Ge=je.find(we=>we.type==="Video"))==null?void 0:Ge.id)||"",mt=Ut(((it=n.settings)==null?void 0:it.model)||Je),et=ld(mt),Ae=(tt=n.settings)==null?void 0:tt.duration,zt=et.includes(Ae)?Ae:et[0]||"5s";et.length>0&&Ae&&!et.includes(Ae)&&setTimeout(()=>{Le(n.id,{duration:et[0]||"5s"})},0);const ln=T0(mt),at=Ht(mt),On=zo((($t=n.settings)==null?void 0:$t.resolution)||Ua||"720P"),Bn=ln.find(we=>we!=="Auto")||"720P",An=ln.includes(On)?On:Bn;return An!==On&&setTimeout(()=>{Le(n.id,{resolution:An})},0),s.jsxs(s.Fragment,{children:[(ge||ie)&&s.jsx("div",{className:`m-3 mb-0 px-2 py-1 rounded text-[10px] font-mono text-center ${e==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-50 text-blue-600 border border-blue-200"}`,children:ge?s.jsxs("span",{children:["? ",Sr.toFixed(1),"s"]}):s.jsxs("span",{children:["?  ",ie,"s"]})}),s.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-2 border-b text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[s.jsx(F5,{size:12,className:"text-green-500"}),s.jsx("span",{children:O?"":""})]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-y-auto min-h-0",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:we=>{we.stopPropagation(),wn((Me==null?void 0:Me.nodeId)===n.id&&Me.type==="role-video-model"?null:{nodeId:n.id,type:"role-video-model"})},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:we=>we.stopPropagation(),children:[s.jsx("span",{className:"truncate font-mono",children:td(mt)}),s.jsx(Kr,{size:12,className:"opacity-50 shrink-0"})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="role-video-model"&&s.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:we=>we.stopPropagation(),onMouseLeave:()=>Dr(null),children:[s.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(Zr).filter(([,we])=>we.models.some(Rt=>Rt.type==="Video")).map(([we,Rt])=>s.jsx("button",{onMouseEnter:()=>Dr(we),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${er===we?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:Rt.name||we},we))}),s.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[er&&((nn=Zr[er])==null?void 0:nn.models.filter(we=>we.type==="Video").map(we=>{var yn;const Rt=we._uid||we.id,jn=Ut((yn=n.settings)==null?void 0:yn.model);return s.jsxs("button",{onClick:()=>{Le(n.id,{model:Rt}),j0(Rt);try{localStorage.setItem("tapnow_last_video_model",Rt)}catch{}wn(null),Dr(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${jn===Rt?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[s.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:we.displayName||we.modelName||we.id}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(Rt)}`})]},Rt)})),!er&&s.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsx("select",{value:zt,onChange:we=>Le(n.id,{duration:we.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:we=>we.stopPropagation(),children:(et.length>0?et:["5s","10s","15s"]).map(we=>s.jsx("option",{value:we,children:Lr(we,!!(at!=null&&at.durationNotesEnabled),(at==null?void 0:at.durationNotes)||{})},we))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsx("select",{value:((Gt=n.settings)==null?void 0:Gt.ratio)||"16:9",onChange:we=>Le(n.id,{ratio:we.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:we=>we.stopPropagation(),children:$0(mt).map(we=>s.jsx("option",{value:we,children:we==="Auto"?"Auto":Lr(we,!!(at!=null&&at.ratioNotesEnabled),(at==null?void 0:at.ratioNotes)||{})},we))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsx("select",{value:An,onChange:we=>{const Rt=we.target.value;if(Le(n.id,{resolution:Rt}),Rt!=="Auto"){xx(Rt);try{localStorage.setItem("tapnow_last_video_res",Rt)}catch{}}},className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:we=>we.stopPropagation(),children:ln.map(we=>s.jsx("option",{value:we,children:we==="Auto"?"":Lr(we,!!(at!=null&&at.videoResolutionNotesEnabled),(at==null?void 0:at.videoResolutionNotes)||{})},we))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsx("textarea",{value:Bt,onChange:we=>Le(n.id,{videoPrompt:we.target.value}),placeholder:"...",className:`w-full h-20 resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:we=>we.stopPropagation()})]}),xt?s.jsx("div",{className:"relative w-full aspect-video bg-black rounded-lg overflow-hidden cursor-pointer",onDoubleClick:we=>{we.preventDefault(),we.stopPropagation(),cr({id:`preview-video-${n.id}`,url:xt,type:"video"}),setLightboxOpen(!0)},onContextMenu:we=>{we.preventDefault(),we.stopPropagation();const Rt=Pn(we.clientX,we.clientY);Ur("video-input",Rt.x,Rt.y,null,xt,{w:400,h:300})},onMouseDown:we=>we.stopPropagation(),children:s.jsx("video",{src:xt,controls:!0,className:"w-full h-full object-contain",onMouseDown:we=>we.stopPropagation()})}):s.jsx("div",{className:`w-full aspect-video rounded border-2 border-dashed flex items-center justify-center ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,children:s.jsx("span",{className:`text-sm ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""})}),wt&&s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"text-[10px] mb-1 text-zinc-500",children:"..."}),s.jsx("div",{className:`w-full h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:s.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${wt.progress||0}%`}})}),s.jsxs("div",{className:"text-[10px] text-zinc-500 mt-1",children:[wt.progress||0,"%"]})]}),(Et==null?void 0:Et.errorMsg)&&s.jsx("div",{className:"text-[10px] text-red-500",children:Et.errorMsg})]}),s.jsx("div",{className:"px-3 py-2 border-t shrink-0",children:s.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-colors ${wt?"bg-zinc-400 cursor-not-allowed text-white":e==="dark"?"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white":"bg-green-600 hover:bg-green-500 text-white"}`,disabled:!!wt,onMouseDown:we=>we.stopPropagation(),onClick:()=>{var yn,ue,De;const we=Bt,Rt=((yn=n.settings)==null?void 0:yn.referenceImages)||((ue=He==null?void 0:He.settings)==null?void 0:ue.referenceImages)||[],jn=an?[an]:Rt;if(!we&&jn.length===0){alert("");return}if(!mt){alert("");return}Va(we||"","video",jn,n.id,{model:mt,ratio:((De=n.settings)==null?void 0:De.ratio)||"16:9",duration:zt,resolution:An})},children:wt?"...":""})})]})})()}),(n.type==="generate-character-image"||n.type==="generate-scene-image")&&s.jsx("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:(()=>{var yt,pt,St,hn,It,an,Bt,Sr,ie;const O=n.type==="generate-scene-image",me=kt.find(ge=>ge.sourceNodeId===n.id&&ge.status==="completed"),Fe=kt.find(ge=>ge.sourceNodeId===n.id&&ge.status==="generating"),He=kt.find(ge=>ge.sourceNodeId===n.id&&ge.status==="failed"),ct=Vn(me),jt=(yt=me==null?void 0:me.output_images)!=null&&yt.length?me.output_images:(pt=me==null?void 0:me.mjImages)!=null&&pt.length?me.mjImages:ct?[ct]:[],wt=((St=n.settings)==null?void 0:St.selectedImageIndex)??null,Et=Ut(Ko)||Ut((hn=je.find(ge=>ns(ge.type)))==null?void 0:hn.id)||"",xt=Ut(((It=n.settings)==null?void 0:It.model)||Et);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-2 border-b text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[s.jsx(oi,{size:12,className:"text-blue-500"}),s.jsx("span",{children:O?"":""})]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-y-auto min-h-0",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:ge=>{ge.stopPropagation(),wn((Me==null?void 0:Me.nodeId)===n.id&&Me.type==="role-image-model"?null:{nodeId:n.id,type:"role-image-model"})},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:ge=>ge.stopPropagation(),children:[s.jsx("span",{className:"truncate font-mono",children:td(xt)}),s.jsx(Kr,{size:12,className:"opacity-50 shrink-0"})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="role-image-model"&&s.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:ge=>ge.stopPropagation(),onMouseLeave:()=>Dr(null),children:[s.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(Zr).filter(([,ge])=>ge.models.some(Je=>ns(Je.type))).map(([ge,Je])=>s.jsx("button",{onMouseEnter:()=>Dr(ge),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${er===ge?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:Je.name||ge},ge))}),s.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[er&&((an=Zr[er])==null?void 0:an.models.filter(ge=>ns(ge.type)).map(ge=>{var et;const Je=ge._uid||ge.id,mt=Ut((et=n.settings)==null?void 0:et.model);return s.jsxs("button",{onClick:()=>{Le(n.id,{model:Je}),k0(Je);try{localStorage.setItem("tapnow_last_image_model",Je)}catch{}wn(null),Dr(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${mt===Je?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[s.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:ge.displayName||ge.modelName||ge.id}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(Je)}`})]},Je)})),!er&&s.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsxs("select",{value:((Bt=n.settings)==null?void 0:Bt.ratio)||"16:9",onChange:ge=>Le(n.id,{ratio:ge.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:ge=>ge.stopPropagation(),children:[s.jsx("option",{value:"16:9",children:"16:9"}),s.jsx("option",{value:"9:16",children:"9:16"}),s.jsx("option",{value:"1:1",children:"1:1"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsxs("select",{value:((Sr=n.settings)==null?void 0:Sr.resolution)||"2K",onChange:ge=>Le(n.id,{resolution:ge.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:ge=>ge.stopPropagation(),children:[s.jsx("option",{value:"1K",children:"1K"}),s.jsx("option",{value:"2K",children:"2K"}),s.jsx("option",{value:"4K",children:"4K"}),s.jsx("option",{value:"Auto",children:"Auto"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsx("textarea",{value:((ie=n.settings)==null?void 0:ie.prompt)||"",onChange:ge=>Le(n.id,{prompt:ge.target.value}),placeholder:"...",className:`w-full h-20 resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:ge=>ge.stopPropagation()})]}),jt.length>0?s.jsx("div",{className:"grid grid-cols-2 gap-2",children:jt.map((ge,Je)=>s.jsxs("div",{className:`relative aspect-square bg-black rounded-lg overflow-hidden cursor-pointer transition-all ${wt===Je?"ring-2 ring-blue-500 ring-offset-2":"hover:ring-1 hover:ring-zinc-400"}`,onClick:mt=>{mt.stopPropagation();const et=wt===Je?null:Je;Le(n.id,{selectedImageIndex:et})},onDoubleClick:mt=>{mt.preventDefault(),mt.stopPropagation(),cr({id:`preview-${n.id}-${Je}`,url:ge,type:"image",mjImages:jt,selectedMjImageIndex:Je}),setLightboxOpen(!0)},onContextMenu:mt=>{mt.preventDefault(),mt.stopPropagation();const et=Pn(mt.clientX,mt.clientY);Ur("input-image",et.x,et.y,null,ge,{w:400,h:300})},onMouseDown:mt=>mt.stopPropagation(),children:[s.jsx(mr,{src:ge,className:"w-full h-full object-contain"}),s.jsxs("div",{className:"absolute top-1 left-1 bg-black/50 text-white text-[10px] px-1 py-0.5 rounded",children:[Je+1,"/",jt.length]}),wt===Je&&s.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white text-[10px] px-1 py-0.5 rounded",children:""})]},`${ge}-${Je}`))}):s.jsx("div",{className:`w-full h-28 rounded border-2 border-dashed flex items-center justify-center ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,children:s.jsx("span",{className:`text-sm ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""})}),Fe&&s.jsxs("div",{className:"mb-2",children:[s.jsx("div",{className:"text-[10px] mb-1 text-zinc-500",children:"..."}),s.jsx("div",{className:`w-full h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:s.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${Fe.progress||0}%`}})}),s.jsxs("div",{className:"text-[10px] text-zinc-500 mt-1",children:[Fe.progress||0,"%"]})]}),(He==null?void 0:He.errorMsg)&&s.jsx("div",{className:"text-[10px] text-red-500",children:He.errorMsg})]}),s.jsx("div",{className:"px-3 py-2 border-t shrink-0",children:s.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-colors ${Fe?"bg-zinc-400 cursor-not-allowed text-white":e==="dark"?"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,disabled:!!Fe,onMouseDown:ge=>ge.stopPropagation(),onClick:()=>{var mt,et,Ae,zt,ln,at,On;const ge=((mt=n.settings)==null?void 0:mt.prompt)||"",Je=Ut(((et=n.settings)==null?void 0:et.model)||Ko||((Ae=je.find(Bn=>ns(Bn.type)))==null?void 0:Ae.id)||"");if(!ge&&(!((zt=n.settings)!=null&&zt.referenceImages)||n.settings.referenceImages.length===0)){alert("");return}if(!Je){alert("");return}Va(ge,"image",((ln=n.settings)==null?void 0:ln.referenceImages)||[],n.id,{model:Je,ratio:((at=n.settings)==null?void 0:at.ratio)||"16:9",resolution:((On=n.settings)==null?void 0:On.resolution)||Oa||"2K"})},children:Fe?"...":""})})]})})()}),(n.type==="create-character"||n.type==="create-scene")&&s.jsx("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:(()=>{var ct,jt,wt,Et,xt,yt,pt,St,hn;const O=n.type==="create-character",me=O?"":"",Fe=Number.isFinite((ct=n.settings)==null?void 0:ct.startSecond)?n.settings.startSecond:1,He=Number.isFinite((jt=n.settings)==null?void 0:jt.endSecond)?n.settings.endSecond:3;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-2 border-b text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[s.jsx(Th,{size:12,className:O?"text-blue-500":"text-green-500"}),s.jsx("span",{children:me})]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-y-auto min-h-0",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:O?"":""}),s.jsx("input",{type:"text",value:((wt=n.settings)==null?void 0:wt.name)||"",onChange:It=>Le(n.id,{name:It.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,placeholder:O?"...":"...",onMouseDown:It=>It.stopPropagation()})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:" 1-3 "}),s.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[s.jsx("input",{type:"number",min:"0",step:"0.1",value:Fe,onChange:It=>Le(n.id,{startSecond:parseFloat(It.target.value)||0}),className:`w-20 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:It=>It.stopPropagation()}),s.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""}),s.jsx("input",{type:"number",min:"0",step:"0.1",value:He,onChange:It=>Le(n.id,{endSecond:parseFloat(It.target.value)||0}),className:`w-20 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:It=>It.stopPropagation()}),s.jsxs("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:[": ",(He-Fe).toFixed(1),"s"]})]})]})]}),((Et=n.settings)==null?void 0:Et.isCreating)&&s.jsxs("div",{className:"px-3 py-2 border-t shrink-0",children:[s.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsxs("span",{className:"text-[10px] text-zinc-500",children:[me,"..."]}),s.jsxs("span",{className:"text-[10px] text-zinc-500",children:[((xt=n.settings)==null?void 0:xt.createProgress)||0,"%"]})]}),s.jsx("div",{className:`w-full h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:s.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${((yt=n.settings)==null?void 0:yt.createProgress)||0}%`}})})]})}),((pt=n.settings)==null?void 0:pt.createError)&&s.jsx("div",{className:"text-[10px] text-red-500 mt-1",children:n.settings.createError})]}),s.jsx("div",{className:"px-3 py-2 border-t shrink-0",children:s.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-colors ${(St=n.settings)!=null&&St.isCreating?"bg-zinc-400 cursor-not-allowed text-white":e==="dark"?"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,onMouseDown:It=>It.stopPropagation(),type:"button",disabled:(hn=n.settings)==null?void 0:hn.isCreating,onClick:async()=>{var et,Ae;const It=((et=n.settings)==null?void 0:et.name)||"";if(!It||It.trim().length===0){alert(`${O?"":""}`);return}const an=Fe??1,Bt=He??3;if(Bt-an<1||Bt-an>3){alert(" 1-3 ");return}const Sr=O?"generate-character-video":"generate-scene-video",ie=g.filter(zt=>zt.to===n.id).map(zt=>At.get(zt.from)).find(zt=>(zt==null?void 0:zt.type)===Sr);if(!ie){alert("");return}const ge=kt.find(zt=>zt.sourceNodeId===ie.id&&zt.status==="completed"),Je=(ge==null?void 0:ge.localCacheUrl)||(ge==null?void 0:ge.url)||(ge==null?void 0:ge.originalUrl)||ie.content||"";if(!Je){alert("URL");return}const mt=(ge==null?void 0:ge.remoteTaskId)||null;Le(n.id,{isCreating:!0,createProgress:10,createError:null});try{const zt=je.find(U=>U.type==="Video"&&(U.id==="sora-2"||U.id==="sora-2-pro"));if(!zt){Le(n.id,{isCreating:!1,createError:" Sora 2 "}),alert(" Sora 2  Sora 2  Sora 2 Pro");return}const ln=ri(zt.id),at=ln.key;if(!at){Le(n.id,{isCreating:!1,createError:" API Key"}),alert(" API Key"),ei(!0);return}Le(n.id,{createProgress:40});const On=(ln.url||ss).replace(/\/+$/,""),Bn=Kc&&Kc.trim()?Kc.trim():`${On}/sora/v1/characters`,An=`${an},${Bt}`,xn=mt?{from_task:mt,timestamps:An}:{url:Je,timestamps:An};Le(n.id,{createProgress:70});const lt=await fetch(Bn,{method:"POST",headers:{Authorization:`Bearer ${at}`,"Content-Type":"application/json"},body:JSON.stringify(xn)});if(Le(n.id,{createProgress:90}),!lt.ok){const U=await lt.text();let Ze=null;try{Ze=JSON.parse(U)}catch{}throw lt.status===500||Ze&&(Ze.code==="get_origin_task_failed"||(Ae=Ze.message)!=null&&Ae.includes("get_origin_task_failed"))?new Error("TASK_NOT_FOUND"):new Error(`API (${lt.status}): ${U||lt.statusText}`)}const Dt=await lt.json();if(!(Dt!=null&&Dt.id)||!(Dt!=null&&Dt.username))throw new Error(" id  username");const zn={id:Dt.id,username:Dt.username,profile_picture_url:Dt.profile_picture_url||"",permalink:Dt.permalink||""};Ml(U=>[...U,zn]),setTimeout(()=>{Le(n.id,{isCreating:!1,createProgress:0,createError:null,characterId:Dt.id,characterUsername:Dt.username}),alert(`${O?"":""} "${Dt.username}" `)},300)}catch(zt){let ln=zt.message||"";ln==="TASK_NOT_FOUND"?ln="":(ln.includes("Failed to fetch")||zt.name==="TypeError"||zt.message.includes("NetworkError"))&&(ln=`

1. API 
   -  API  "/sora" 
   -  Sora 

2.  (CORS)
   -  Allow CORS 

3. 
   - `),Le(n.id,{isCreating:!1,createProgress:0,createError:ln}),alert(`${O?"":""}: ${ln}`)}},children:O?"":""})})]})})()}),n.type==="local-save"&&(()=>{var jt,wt,Et,xt,yt,pt,St,hn,It,an;const O=P0(n.id),me=O.length,Fe=!!((jt=n.settings)!=null&&jt.isSaving),ct=(((wt=n.settings)==null?void 0:wt.serverUrl)||"").trim()?((Et=n.settings)==null?void 0:Et.serverStatus)==="connected":fs;return s.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b shrink-0",children:[s.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-semibold",children:[s.jsx(B5,{size:12,className:"text-green-500"}),s.jsx("span",{children:""})]}),s.jsx("div",{className:`w-2 h-2 rounded-full ${ct?"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":"bg-red-500"}`,title:ct?"":""})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar flex flex-col gap-3",children:[s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsx("label",{className:"text-[10px] font-medium opacity-70",children:""}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:((xt=n.settings)==null?void 0:xt.serverUrl)??"",onChange:Bt=>Le(n.id,{serverUrl:Bt.target.value}),placeholder:kn||"http://127.0.0.1:9527",className:`flex-1 text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:Bt=>Bt.stopPropagation()}),s.jsx("button",{className:`px-2 py-1 text-[10px] rounded border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-blue-500":"bg-white border-zinc-300 text-zinc-700 hover:border-blue-500"}`,onMouseDown:Bt=>Bt.stopPropagation(),onClick:()=>{var Bt;return $z(n.id,((Bt=n.settings)==null?void 0:Bt.serverUrl)||"")},children:""})]})]}),s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsx("label",{className:"text-[10px] font-medium opacity-70",children:""}),s.jsx("input",{type:"text",value:((yt=n.settings)==null?void 0:yt.subfolder)||"",onChange:Bt=>Le(n.id,{subfolder:Bt.target.value}),placeholder:"v1_characters",className:`w-full text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:Bt=>Bt.stopPropagation()})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:"text-[10px] font-medium opacity-70",children:" ()"}),s.jsx("button",{className:`w-10 h-5 rounded-full relative transition-colors ${(pt=n.settings)!=null&&pt.autoSave?"bg-green-600":e==="solarized"?"bg-zinc-300":"bg-zinc-600"}`,onClick:()=>{var Bt;return Le(n.id,{autoSave:!((Bt=n.settings)!=null&&Bt.autoSave)})},onMouseDown:Bt=>Bt.stopPropagation(),children:s.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${(St=n.settings)!=null&&St.autoSave?"left-6":"left-1"}`})})]}),s.jsxs("div",{className:"flex items-center justify-between text-[10px] text-zinc-500 mt-1",children:[s.jsx("span",{children:""}),s.jsx("span",{children:me})]}),me>0?s.jsx("div",{className:"grid grid-cols-4 gap-2",children:O.slice(0,4).map((Bt,Sr)=>{const ie=Bt.type==="video"||Qt(Bt.url)||Bt.url.startsWith("data:video");return s.jsx("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-black/40 border border-zinc-700/40",children:ie?s.jsx("div",{className:"w-full h-full flex items-center justify-center text-[10px] text-zinc-300",children:s.jsx(Op,{size:14,className:"text-purple-300"})}):s.jsx(mr,{src:Bt.url,className:"w-full h-full object-cover"})},`${Bt.url}-${Sr}`)})}):s.jsx("div",{className:"text-[10px] text-zinc-500",children:""}),s.jsxs("div",{className:"mt-auto border-t pt-2 border-zinc-700/50",children:[s.jsxs("div",{className:"text-[10px] text-zinc-500 flex justify-between",children:[s.jsx("span",{children:":"}),s.jsx("span",{children:(hn=n.settings)!=null&&hn.lastSaved?n.settings.lastSaved.split(" ")[1]:""})]}),s.jsxs("div",{className:"text-[10px] text-zinc-500 flex justify-between mt-1",children:[s.jsx("span",{children:":"}),s.jsxs("span",{children:[((an=(It=n.settings)==null?void 0:It.savedFiles)==null?void 0:an.length)||0," "]})]})]}),s.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-colors ${Fe?"bg-zinc-600 cursor-not-allowed text-white":"bg-green-600 hover:bg-green-500 text-white"}`,disabled:Fe||me===0,onMouseDown:Bt=>Bt.stopPropagation(),onClick:async()=>{if(me===0){a("","warning");return}Le(n.id,{isSaving:!0});try{await A0(n,O)}catch(Bt){a(`: ${Bt.message||""}`,"error")}finally{Le(n.id,{isSaving:!1})}},children:Fe?"...":""})]})]})})(),n.type==="input-image"&&s.jsx("div",{className:`relative w-full h-full flex flex-col items-center justify-center transition-colors pointer-events-auto drop-zone ${e==="dark"?"bg-zinc-900 group-hover:bg-zinc-800":e==="solarized"?"bg-[#eee8d5] group-hover:bg-[#e4dcc2]":"bg-zinc-100 group-hover:bg-zinc-200"}`,onDrop:O=>ek(n.id,O),onDragOver:U0,onDragLeave:F0,onContextMenu:O=>Xk(O,n.id),children:n.content?s.jsxs("div",{className:"relative w-full h-full",children:[Qt(n.content)?s.jsx("video",{src:n.content,controls:!0,className:`w-full h-full object-contain ${e==="dark"?"bg-black/50":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-100"}`,draggable:!1,style:{imageRendering:Xt.zoom>=1?"auto":"crisp-edges",WebkitFontSmoothing:"antialiased",transform:"translateZ(0)",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"}}):s.jsx("img",{src:n.content,className:`w-full h-full object-contain ${e==="dark"?"bg-black/50":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-100"}`,draggable:!1,loading:"lazy",style:{imageRendering:Xt.zoom>=1?"auto":"crisp-edges",WebkitFontSmoothing:"antialiased",transform:"translateZ(0)",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"}}),n.dimensions&&s.jsxs("div",{className:`absolute bottom-2 right-2 text-[10px] px-1.5 py-0.5 rounded backdrop-blur-sm border ${e==="dark"?"bg-black/70 text-white border-white/10":"bg-white/80 text-zinc-800 border-zinc-200"}`,children:[n.dimensions.w,"x",n.dimensions.h]}),!n.isMasking&&s.jsxs("div",{className:"absolute inset-0 bg-black/40 transition-opacity gap-2 opacity-0 group-hover:opacity-100 flex flex-col items-center justify-center",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("label",{className:`cursor-pointer px-3 py-1.5 rounded-lg text-xs backdrop-blur-sm border transition-colors ${e==="dark"?"bg-white/10 hover:bg-white/20 text-white border-white/10":"bg-white hover:bg-zinc-100 text-zinc-800 border-zinc-300"}`,onMouseDown:O=>O.stopPropagation(),children:[" ",s.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:O=>rb(n.id,O)})]}),!Qt(n.content)&&s.jsxs("button",{onClick:O=>{O.stopPropagation(),f(me=>me.map(Fe=>Fe.id===n.id?{...Fe,isMasking:!Fe.isMasking}:Fe))},className:`px-3 py-1.5 rounded-lg text-xs backdrop-blur-sm border transition-colors flex items-center gap-1 ${e==="dark"?n.isMasking?"bg-red-500/80 hover:bg-red-500 text-white border-red-400":"bg-white/10 hover:bg-white/20 text-white border-white/10":n.isMasking?"bg-red-500 hover:bg-red-600 text-white border-red-400":"bg-white hover:bg-zinc-100 text-zinc-800 border-zinc-300"}`,onMouseDown:O=>O.stopPropagation(),children:[s.jsx(A5,{size:12}),""]})]}),s.jsxs("div",{className:`text-[10px] text-center px-2 ${e==="dark"?"text-zinc-300":"text-zinc-500"}`,children:["",s.jsx("br",{})," Ctrl+V "]})]}),!n.isMasking&&n.maskContent&&s.jsx("div",{className:"absolute inset-0 z-20 pointer-events-none",style:{background:"rgba(255, 0, 0, 0.3)",mixBlendMode:"multiply",WebkitMaskImage:`url(${n.maskContent})`,maskImage:`url(${n.maskContent})`,WebkitMaskSize:"100% 100%",maskSize:"100% 100%",WebkitMaskRepeat:"no-repeat",maskRepeat:"no-repeat"}}),n.isMasking&&!Qt(n.content)&&s.jsx(a_,{nodeId:n.id,imageUrl:n.content,imageDimensions:n.dimensions,isActive:n.isMasking,onClose:()=>{f(O=>O.map(me=>me.id===n.id?{...me,isMasking:!1}:me))},onSave:O=>{},onUpdateNode:(O,me)=>{f(Fe=>Fe.map(He=>He.id===O?{...He,...me}:He))},theme:e,view:Xt,maskContent:n.maskContent})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full",children:[s.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center mb-3 border ${e==="dark"?"bg-zinc-800 border-zinc-700/50":"bg-zinc-100 border-zinc-300"}`,children:s.jsx(ql,{className:`w-6 h-6 ${e==="dark"?"text-zinc-500":"text-zinc-400"}`})}),s.jsxs("label",{className:`px-4 py-2 rounded-lg text-xs font-medium transition-colors cursor-pointer pointer-events-auto ${e==="solarized"?"bg-[#616161] hover:bg-[#4b4b4b] text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,onMouseDown:O=>O.stopPropagation(),children:["",s.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:O=>rb(n.id,O)})]}),s.jsxs("div",{className:"text-[10px] text-center mt-2 pointer-events-none text-zinc-500",children:["",s.jsx("br",{})," Ctrl+V "]})]})}),n.type==="video-input"&&s.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto drop-zone video-input-container ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-100"}`,onDragOver:U0,onDragLeave:F0,children:[s.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b text-xs font-semibold",children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(Op,{size:13,className:"text-blue-500"}),s.jsx("span",{children:" / "}),s.jsx("button",{onClick:O=>{var hn;O.stopPropagation();const me=((hn=n.settings)==null?void 0:hn.videoExpanded)===!1,Fe=(n.frames||[]).length,He=me?Math.max(1,Math.floor(n.width/290)):1,ct=Math.max(1,Math.ceil(Fe/He)),jt=72,wt=me?n.content?230:190:0,Et=n.content&&me?48:0,xt=36,yt=30,pt=me?158:106,St=jt+wt+Et+xt+ct*pt+yt;f(It=>It.map(an=>an.id===n.id?{...an,height:Math.max(me?500:220,St),settings:{...an.settings,videoExpanded:me}}:an))},className:`p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded transition-colors ml-1 ${((Ee=n.settings)==null?void 0:Ee.videoExpanded)===!1?"bg-zinc-200 dark:bg-zinc-700":""}`,title:((Be=n.settings)==null?void 0:Be.videoExpanded)===!1?"":"",children:((nt=n.settings)==null?void 0:nt.videoExpanded)===!1?s.jsx(Kr,{size:12}):s.jsx(Ch,{size:12})})]}),s.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-zinc-500",children:[(st=n.videoMeta)!=null&&st.duration?s.jsxs("span",{children:[" ",n.videoMeta.duration.toFixed(1),"s"]}):null,(ht=n.videoMeta)!=null&&ht.w?s.jsxs("span",{children:[n.videoMeta.w,"x",n.videoMeta.h]}):null,(Yt=n.selectedKeyframes)!=null&&Yt.length?s.jsxs("span",{className:"text-blue-500",children:[" ",n.selectedKeyframes.length," "]}):null]})]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-hidden min-h-0",children:[n.content?s.jsxs("div",{className:"space-y-2",children:[((Wt=n.settings)==null?void 0:Wt.videoExpanded)!==!1&&s.jsx("div",{className:"relative w-full max-w-[360px] aspect-video bg-black rounded-lg overflow-hidden flex items-center justify-center mx-auto",onDrop:O=>sb(n.id,O),children:s.jsx("video",{src:n.content,controls:!0,className:"w-full h-full object-contain",draggable:!1})}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("label",{className:"bg-blue-600 hover:bg-blue-500 text-white px-3 py-1.5 rounded text-xs font-medium transition-colors cursor-pointer",onMouseDown:O=>O.stopPropagation(),children:["",s.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:O=>{var me;return Wl(n.id,(me=O.target.files)==null?void 0:me[0])}})]}),s.jsx("button",{className:`px-3 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"border-zinc-700 bg-zinc-800 text-zinc-300 hover:border-blue-500 hover:text-blue-400":"border-zinc-300 hover:border-blue-500 hover:text-blue-600"}`,onMouseDown:O=>O.stopPropagation(),onClick:()=>Ak(n.id,2),children:s.jsx("span",{className:"whitespace-nowrap",children:"2fps"})}),s.jsx("button",{className:`px-3 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-green-600/40 border-green-500 text-green-200 hover:bg-green-600/60 hover:border-green-400":"bg-green-50 border-green-300 hover:border-green-500 hover:text-green-600"}`,onMouseDown:O=>O.stopPropagation(),onClick:()=>Rk(n.id,30),children:s.jsx("span",{className:"whitespace-nowrap",children:""})}),n.extractingFrames&&s.jsx("span",{className:"text-[11px] text-blue-500",children:"..."})]})]}):((Jt=n.settings)==null?void 0:Jt.videoExpanded)!==!1&&s.jsx("div",{className:"flex flex-col items-center justify-center gap-3 w-full px-4 mx-auto shrink-0 transition-colors border-2 border-transparent hover:border-blue-500/30 rounded-lg p-4",onDrop:O=>sb(n.id,O),children:s.jsxs("div",{className:"flex flex-col gap-2 items-center justify-center shrink-0 w-full",children:[s.jsx("div",{className:`relative w-full h-64 flex flex-col items-center justify-center border-2 border-dashed rounded-lg transition-colors ${G===n.id&&!k?"border-blue-500 bg-blue-500/10":e==="dark"?"border-zinc-700 hover:border-zinc-500":"border-zinc-300 hover:border-zinc-400"}`,children:s.jsxs("label",{className:"cursor-pointer flex flex-col items-center justify-center w-full h-full",children:[s.jsx(e_,{size:48,className:`mb-2 ${e==="dark"?"text-zinc-500":"text-zinc-400"}`}),s.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""}),s.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:O=>{var me;return Wl(n.id,(me=O.target.files)==null?void 0:me[0])}})]})}),s.jsx("div",{className:"text-[10px] text-center text-zinc-500 pointer-events-none",children:" MP4/WEBM Ctrl+V "})]})}),s.jsxs("div",{className:"flex items-center justify-between text-[11px] text-zinc-500",children:[s.jsx("span",{children:""}),s.jsxs("div",{className:"flex items-center gap-2 flex-nowrap shrink-0 whitespace-nowrap",children:[s.jsxs("span",{children:[(n.frames||[]).length," "]}),(n.frames||[]).length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>{const O=n.frames||[],me=n.selectedKeyframes||[];let Fe=[];me.length===0?Fe=O.map(He=>({url:He.url,time:He.time,filename:He.filename})):Fe=[],f(He=>He.map(ct=>ct.id===n.id?{...ct,selectedKeyframes:Fe}:ct))},className:`text-[10px] px-1.5 py-0.5 rounded transition-colors flex items-center gap-1 ${e==="dark"?"bg-blue-600/30 text-blue-300 hover:bg-blue-600/50":"bg-blue-100 text-blue-600 hover:bg-blue-200"}`,onMouseDown:O=>O.stopPropagation(),title:(n.selectedKeyframes||[]).length>0?"":"",children:[(n.selectedKeyframes||[]).length>0?s.jsx(ev,{size:10}):s.jsx(R5,{size:10}),(n.selectedKeyframes||[]).length>0?"":""]}),s.jsxs("button",{onClick:()=>{confirm("")&&f(O=>O.map(me=>me.id===n.id?{...me,frames:[],selectedKeyframes:[]}:me))},className:`text-[10px] px-1.5 py-0.5 rounded transition-colors flex items-center gap-1 flex-nowrap ${e==="dark"?"bg-red-600/30 text-red-300 hover:bg-red-600/50":"bg-red-100 text-red-600 hover:bg-red-200"}`,onMouseDown:O=>O.stopPropagation(),title:"",children:[s.jsx(cs,{size:10}),""]})]})]})]}),s.jsx("div",{className:"grid gap-3 w-full overflow-y-auto custom-scrollbar flex-1 min-h-0 relative p-1 content-start items-start",style:{gridTemplateColumns:((Ft=n.settings)==null?void 0:Ft.videoExpanded)===!1?"1fr":"repeat(auto-fill, minmax(260px, 1fr))",gridAutoRows:"auto"},onDrop:O=>Tk(n.id,O),onDragOver:O=>Mk(O,n.id,(n.frames||[]).length),onDragLeave:O=>{O.currentTarget.contains(O.relatedTarget)||(S(null),V(null))},children:(n.frames||[]).length===0?s.jsxs("div",{className:`col-span-full text-[11px] text-zinc-500 text-center py-4 border rounded ${e==="dark"?"bg-zinc-800/40 border-zinc-700":"bg-white/40 border-zinc-300"}`,children:["",s.jsx("div",{className:"mt-1 opacity-50 text-[9px]",children:""})]}):(n.frames||[]).map((O,me)=>{var jt;const Fe=(n.selectedKeyframes||[]).some(wt=>wt.url===O.url&&wt.time===O.time),He=k===n.id&&A===me,ct=k===n.id&&A===(n.frames||[]).length&&me===(n.frames||[]).length-1;return s.jsxs("div",{className:"relative",children:[He&&s.jsx("div",{className:"absolute -top-1.5 left-0 right-0 h-1 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.8)] z-50"}),s.jsxs("button",{className:`relative w-full rounded overflow-hidden group transition-all ${Fe?"ring-2 ring-blue-500 border-2 border-blue-500 bg-blue-900/30":e==="dark"?"border border-zinc-700 hover:border-zinc-500":"border border-zinc-300 hover:border-zinc-400"}`,onMouseDown:wt=>wt.stopPropagation(),onClick:wt=>Dk(n.id,O,me,wt),onContextMenu:wt=>Lk(wt,n.id,O),onDragOver:wt=>$k(wt,n.id,me),children:[s.jsx(mr,{src:O.url,className:`w-full bg-black ${((jt=n.settings)==null?void 0:jt.videoExpanded)===!1?"h-[90px] object-cover":"aspect-video object-contain max-h-[140px]"}`,alt:`frame-${me}`}),s.jsxs("div",{className:"absolute left-1 top-1 text-[10px] px-1 py-0.5 rounded bg-black/60 text-white",children:[typeof O.time=="number"?O.time.toFixed(2):O.time,"s"]}),O.filename&&s.jsx("div",{className:"absolute left-0 bottom-0 right-0 bg-black/80 text-white text-[9px] px-1 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity truncate",title:O.filename,children:O.filename}),s.jsxs("div",{className:"absolute top-1 bottom-1 right-1 flex flex-col justify-between items-center z-20 pointer-events-none",children:[s.jsx("div",{className:"pointer-events-auto w-5 h-5 rounded-full border border-white/80 bg-black/40 flex items-center justify-center shrink-0 mb-auto",children:Fe?s.jsx(Od,{size:12,className:"text-white"}):null}),s.jsx("button",{onClick:wt=>{wt.stopPropagation(),f(Et=>Et.map(xt=>{if(xt.id!==n.id)return xt;const yt=(xt.frames||[]).filter((St,hn)=>hn!==me),pt=(xt.selectedKeyframes||[]).filter(St=>St.url!==O.url);return{...xt,frames:yt,selectedKeyframes:pt}}))},className:"pointer-events-auto w-5 h-5 rounded bg-red-600/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 my-1 shrink-0",title:"",children:s.jsx(Ws,{size:12})}),s.jsxs("div",{className:"pointer-events-auto flex flex-col gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0 mt-auto",children:[me>0&&s.jsx("button",{onClick:wt=>{wt.stopPropagation(),f(Et=>Et.map(xt=>{if(xt.id!==n.id)return xt;const yt=[...xt.frames||[]];[yt[me-1],yt[me]]=[yt[me],yt[me-1]];const pt=[...xt.selectedKeyframes||[]],St=pt.findIndex(hn=>hn.url===O.url);return St>0&&([pt[St-1],pt[St]]=[pt[St],pt[St-1]]),{...xt,frames:yt,selectedKeyframes:pt}}))},className:"w-5 h-5 rounded bg-black/70 text-white flex items-center justify-center hover:bg-blue-600",title:"",children:s.jsx(Ch,{size:12})}),me<(n.frames||[]).length-1&&s.jsx("button",{onClick:wt=>{wt.stopPropagation(),f(Et=>Et.map(xt=>{if(xt.id!==n.id)return xt;const yt=[...xt.frames||[]];[yt[me],yt[me+1]]=[yt[me+1],yt[me]];const pt=[...xt.selectedKeyframes||[]],St=pt.findIndex(hn=>hn.url===O.url);return St>=0&&St<pt.length-1&&([pt[St],pt[St+1]]=[pt[St+1],pt[St]]),{...xt,frames:yt,selectedKeyframes:pt}}))},className:"w-5 h-5 rounded bg-black/70 text-white flex items-center justify-center hover:bg-blue-600",title:"",children:s.jsx(Kr,{size:12})})]})]})]}),ct&&s.jsx("div",{className:"absolute -bottom-1.5 left-0 right-0 h-1 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.8)] z-50"})]},`${O.url}-${me}`)})})]})]}),n.type==="text-node"&&s.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-100"}`,children:[s.jsx("div",{className:"flex items-center justify-between px-3 py-2 border-b text-xs font-semibold",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(oi,{size:13,className:"text-blue-500"}),s.jsx("span",{children:""})]})}),s.jsx("div",{className:"flex-1 p-3",children:s.jsx("textarea",{"data-node-type":"text-node","data-node-id":n.id,value:((dn=n.settings)==null?void 0:dn.text)||"",onChange:O=>{Le(n.id,{text:O.target.value})},placeholder:"...",className:`w-full h-full resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:O=>O.stopPropagation()})})]}),n.type==="video-analyze"&&s.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto video-analyze-container ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,onDrop:O=>Wk(n.id,O),onDragOver:Ha,onClick:O=>{const me=window.getSelection();if(me&&me.toString().length>0)return;const Fe=O.target;Fe&&(Fe.tagName==="INPUT"||Fe.tagName==="TEXTAREA"||Fe.tagName==="SELECT"||Fe.tagName==="BUTTON"||Fe.isContentEditable||Fe.closest('input, textarea, select, button, [contenteditable="true"]'))||O.stopPropagation()},children:[s.jsx("div",{className:"flex items-center justify-between px-3 py-2 border-b text-xs font-semibold",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(U5,{size:13,className:"text-blue-500"}),s.jsx("span",{children:" / "})]})}),s.jsx("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-hidden min-h-0",children:(()=>{var ct,jt,wt,Et,xt,yt,pt,St,hn,It,an,Bt,Sr,ie,ge,Je,mt,et;const O=sd(n.id);if(!O)return s.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 gap-2 text-[11px] text-zinc-500",children:[s.jsx(Id,{size:24,className:"text-zinc-400"}),s.jsx("span",{children:""})]});const me=O.videoFileName||"",Fe=((ct=O.videoMeta)==null?void 0:ct.duration)||0,He=O.selectedKeyframes||[];return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:`text-[11px] px-2 py-1.5 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700":"bg-zinc-50 border-zinc-300"}`,children:[s.jsx("div",{className:"flex items-center justify-between mb-1",children:s.jsx("span",{className:"text-zinc-500",children:O.isImageInput?"":""})}),s.jsxs("div",{className:"text-zinc-700 dark:text-zinc-300",children:[s.jsxs("div",{children:[": ",O.isImageInput?"":me]}),!O.isImageInput&&s.jsxs("div",{children:[": ",Fe.toFixed(1),"s"]}),s.jsxs("div",{children:[": ",He.length," "]})]})]}),s.jsxs("div",{className:`flex items-center gap-2 p-1 rounded-lg border shadow-inner ${e==="dark"?"bg-zinc-800 border-zinc-700":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-100 border-zinc-200"}`,children:[s.jsxs("button",{onClick:()=>Le(n.id,{analysisMode:"manual"}),className:`flex-1 py-1 px-2 text-[11px] rounded transition-all flex justify-center items-center gap-1 ${(((jt=n.settings)==null?void 0:jt.analysisMode)||"manual")==="manual"?e==="dark"?"bg-zinc-600 shadow-md text-blue-300 font-bold":"bg-white shadow-md text-blue-600 font-bold":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:Ae=>Ae.stopPropagation(),children:[s.jsx(By,{size:12})," "]}),s.jsxs("button",{onClick:()=>Le(n.id,{analysisMode:"auto"}),className:`flex-1 py-1 px-2 text-[11px] rounded transition-all flex justify-center items-center gap-1 ${((wt=n.settings)==null?void 0:wt.analysisMode)==="auto"?e==="dark"?"bg-zinc-600 shadow-md text-purple-300 font-bold":"bg-white shadow-md text-purple-600 font-bold":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:Ae=>Ae.stopPropagation(),children:[s.jsx($d,{size:12})," AI "]})]}),(((Et=n.settings)==null?void 0:Et.analysisMode)||"manual")==="manual"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-[11px] text-zinc-500",children:":"}),s.jsx("input",{type:"number",min:"1",max:"30",value:((xt=n.settings)==null?void 0:xt.segmentDuration)||3,onChange:Ae=>{const zt=parseInt(Ae.target.value)||3;Le(n.id,{segmentDuration:zt}),jz(zt.toString());try{localStorage.setItem("tapnow_last_segment_duration",zt.toString())}catch{}},className:`w-16 px-2 py-1 text-[11px] rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:Ae=>Ae.stopPropagation()}),s.jsx("span",{className:"text-[11px] text-zinc-500",children:""})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("label",{className:"text-[11px] text-zinc-500",children:":"}),s.jsxs("div",{className:"relative flex-1",children:[s.jsxs("button",{onClick:Ae=>{Ae.stopPropagation(),wn((Me==null?void 0:Me.nodeId)===n.id&&Me.type==="analyze-model"?null:{nodeId:n.id,type:"analyze-model"})},className:`w-full flex items-center justify-between px-2 py-1 rounded text-[11px] border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":"bg-zinc-50 border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:Ae=>Ae.stopPropagation(),children:[s.jsx("span",{className:"truncate font-mono",children:((pt=Ht((yt=n.settings)==null?void 0:yt.model))==null?void 0:pt.id)||((St=n.settings)==null?void 0:St.model)||"gemini-3-pro"}),s.jsx(Kr,{size:10,className:"opacity-50 shrink-0 ml-1"})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="analyze-model"&&s.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:Ae=>Ae.stopPropagation(),onMouseLeave:()=>Dr(null),children:[s.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(Zr).filter(([,Ae])=>Ae.models.some(zt=>zt.type==="Chat")).map(([Ae,zt])=>s.jsx("button",{onMouseEnter:()=>Dr(Ae),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${er===Ae?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:zt.name||Ae},Ae))}),s.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[er&&((hn=Zr[er])==null?void 0:hn.models.filter(Ae=>Ae.type==="Chat").map(Ae=>{var at;const zt=Ae._uid||Ae.id,ln=Ut((at=n.settings)==null?void 0:at.model);return s.jsxs("button",{onClick:()=>{Le(n.id,{model:zt}),_z(zt);try{localStorage.setItem("tapnow_last_analyze_model",zt)}catch{}wn(null),Dr(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${ln===zt?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[s.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:Ae.id}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(zt)}`})]},zt)})),!er&&s.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]})]}),s.jsx("button",{onClick:()=>{var Ae;return((Ae=n.settings)==null?void 0:Ae.analysisMode)==="auto"?Nk(n.id):jk(n.id)},disabled:n.isGenerating||(((It=n.settings)==null?void 0:It.analysisMode)||"manual")==="manual"&&He.length===0,className:`w-full px-3 py-2 rounded text-xs font-medium transition-colors flex items-center justify-center gap-2 ${n.isGenerating?"bg-zinc-600 text-zinc-400 cursor-not-allowed":((an=n.settings)==null?void 0:an.analysisMode)==="auto"?"bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white shadow-lg":"bg-blue-600 hover:bg-blue-500 text-white"}`,onMouseDown:Ae=>Ae.stopPropagation(),children:n.isGenerating?s.jsxs(s.Fragment,{children:[s.jsx(wo,{size:14,className:"animate-spin"}),s.jsx("span",{children:((Bt=n.settings)==null?void 0:Bt.analysisMode)==="auto"?"AI ...":"..."})]}):s.jsxs(s.Fragment,{children:[s.jsx($d,{size:14}),s.jsx("span",{children:((Sr=n.settings)==null?void 0:Sr.analysisMode)==="auto"?"":""})]})}),n.errorMsg&&s.jsx("div",{className:"text-[10px] text-red-500 px-2 py-1 rounded bg-red-500/10",children:n.errorMsg})]}),((ie=n.settings)==null?void 0:ie.analysisMode)==="auto"&&((Je=(ge=n.settings)==null?void 0:ge.analysisResults)==null?void 0:Je.length)>0&&s.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar pt-2",children:[((mt=n.settings.voiceoverResults)==null?void 0:mt.length)>0&&s.jsxs("div",{className:`p-2 rounded-lg mb-4 ${e==="dark"?"bg-zinc-700/50 border border-zinc-700":"bg-zinc-50 border border-blue-200"}`,children:[s.jsxs("h4",{className:`text-xs font-semibold mb-2 flex items-center gap-1 ${e==="dark"?"text-white":"text-blue-700"}`,children:[s.jsx(H5,{size:12})," "]}),s.jsx("div",{className:"space-y-1",children:n.settings.voiceoverResults.map((Ae,zt)=>s.jsxs("p",{className:`text-[10px] select-text cursor-text ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,onMouseDown:ln=>ln.stopPropagation(),children:[s.jsxs("span",{className:"font-mono text-xs mr-2 opacity-70",children:["[",Ae.time_range||`${Ae.time}s`,"]"]}),Ae.text||s.jsx("span",{className:"text-zinc-400 italic",children:""})]},zt))})]}),s.jsxs("h4",{className:`text-xs font-semibold mb-3 flex items-center gap-1 ${e==="dark"?"text-white":"text-zinc-800"}`,children:[s.jsx(By,{size:12}),"  (",n.settings.analysisResults.length," )"]}),s.jsx("div",{className:"space-y-4",children:n.settings.analysisResults.map((Ae,zt)=>{var ln,at,On,Bn,An,xn,lt,Dt;return s.jsxs("div",{className:`p-3 rounded-lg ${e==="dark"?"bg-zinc-800 border border-zinc-700":"bg-zinc-50 border border-zinc-200"}`,children:[s.jsxs("h5",{className:`text-sm font-bold mb-2 ${e==="dark"?"text-purple-400":"text-purple-700"}`,children:[" ",Ae.scene_index||Ae.scene_id||zt+1," ",s.jsxs("span",{className:"text-xs font-normal opacity-70 ml-2",children:["(",Ae.time_range,")"]})]}),s.jsxs("div",{className:"text-[11px] space-y-1 mb-3",children:[((at=(ln=Ae.keyframes)==null?void 0:ln[0])==null?void 0:at.description)&&s.jsxs("p",{className:`select-text cursor-text ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,onMouseDown:zn=>zn.stopPropagation(),children:[s.jsx("span",{className:"font-semibold mr-1",children:"/:"})," ",Ae.keyframes[0].description]}),((Bn=(On=Ae.global_tags)==null?void 0:On.style)==null?void 0:Bn[0])&&s.jsxs("p",{className:`select-text cursor-text ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,onMouseDown:zn=>zn.stopPropagation(),children:[s.jsx("span",{className:"font-semibold mr-1",children:"/:"})," ",Ae.global_tags.style[0]]})]}),s.jsxs("div",{className:"space-y-2",children:[((xn=(An=Ae.keyframes)==null?void 0:An[0])==null?void 0:xn.jimeng_prompt)&&s.jsxs("div",{className:`p-2 rounded ${e==="dark"?"bg-zinc-700 border border-zinc-600":"bg-zinc-50 border border-gray-300"}`,children:[s.jsxs("h6",{className:`text-[10px] font-semibold mb-1 flex items-center gap-1 ${e==="dark"?"text-yellow-300":"text-yellow-700"}`,children:[s.jsx(Eh,{size:10}),"  Prompt"]}),s.jsx("p",{className:`text-[10px] whitespace-pre-wrap select-text cursor-text ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,onMouseDown:zn=>zn.stopPropagation(),children:Ae.keyframes[0].jimeng_prompt}),s.jsxs("button",{onClick:()=>navigator.clipboard.writeText(Ae.keyframes[0].jimeng_prompt),className:"mt-1 flex items-center text-[9px] text-blue-400 hover:text-blue-300",onMouseDown:zn=>zn.stopPropagation(),children:[s.jsx(Wy,{size:10,className:"mr-1"})," "]})]}),((Dt=(lt=Ae.keyframes)==null?void 0:lt[0])==null?void 0:Dt.mj_prompt)&&s.jsxs("div",{className:`p-2 rounded ${e==="dark"?"bg-zinc-700 border border-zinc-600":"bg-zinc-50 border border-gray-300"}`,children:[s.jsxs("h6",{className:`text-[10px] font-semibold mb-1 flex items-center gap-1 ${e==="dark"?"text-green-300":"text-green-700"}`,children:[s.jsx(Eh,{size:10})," MJ Prompt"]}),s.jsx("p",{className:`text-[10px] whitespace-pre-wrap select-text cursor-text ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,onMouseDown:zn=>zn.stopPropagation(),children:Ae.keyframes[0].mj_prompt}),s.jsxs("button",{onClick:()=>navigator.clipboard.writeText(Ae.keyframes[0].mj_prompt),className:"mt-1 flex items-center text-[9px] text-blue-400 hover:text-blue-300",onMouseDown:zn=>zn.stopPropagation(),children:[s.jsx(Wy,{size:10,className:"mr-1"})," "]})]})]})]},zt)})})]}),(((et=n.settings)==null?void 0:et.analysisMode)||"manual")==="manual"&&n.analysisResults&&n.analysisResults.length>0?s.jsxs("div",{className:"space-y-3 flex-1 flex flex-col min-h-0",children:[s.jsxs("div",{className:"text-[11px] font-medium text-zinc-700 dark:text-zinc-300 shrink-0",children:[" (",n.analysisResults.length," )"]}),s.jsx("div",{className:"space-y-3 flex-1 overflow-y-auto custom-scrollbar min-h-0",children:n.analysisResults.map((Ae,zt)=>{var xn,lt,Dt,zn,U,Ze,Ge;const ln=it=>{var nn,Gt;const tt=(nn=O.selectedKeyframes)==null?void 0:nn.find(we=>Math.abs(we.time-it)<.1);if(tt)return tt.url;const $t=(Gt=O.frames)==null?void 0:Gt.find(we=>Math.abs(we.time-it)<.1);return($t==null?void 0:$t.url)||null},at=((xn=Ae.keyframes)==null?void 0:xn.find(it=>it.type==="current"))||((lt=Ae.keyframes)==null?void 0:lt[0]),On=(Dt=Ae.keyframes)==null?void 0:Dt.find(it=>it.type==="prev"),Bn=(zn=Ae.keyframes)==null?void 0:zn.find(it=>it.type==="next"),An=(at==null?void 0:at.description)||((Ze=(U=Ae.keyframes)==null?void 0:U[0])==null?void 0:Ze.description)||"";return s.jsxs("div",{className:`p-3 rounded-lg border ${e==="dark"?"bg-zinc-800 border-zinc-700":"bg-white border-zinc-300"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"font-medium text-[11px] text-zinc-800 dark:text-zinc-200",children:[" ",Ae.scene_index||zt+1]}),s.jsx("div",{className:"text-[10px] text-zinc-500",children:Ae.time_range})]}),s.jsx("div",{className:"text-[10px] text-zinc-600 dark:text-zinc-400 mb-3 line-clamp-2 select-text cursor-text",onMouseDown:it=>it.stopPropagation(),children:An}),s.jsx("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[On,at,Bn].map((it,tt)=>{if(!it)return s.jsx("div",{className:"aspect-video bg-zinc-200 dark:bg-zinc-700 rounded"},tt);const $t=ln(it.time);return s.jsxs("div",{className:"relative aspect-video bg-black rounded overflow-hidden",children:[$t?s.jsx("img",{src:$t,className:"w-full h-full object-cover",alt:` ${tt+1}`,loading:"lazy"}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-[8px] text-zinc-500",children:it.type==="prev"?"":it.type==="current"?"":""}),s.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[8px] px-1 py-0.5 text-center",children:[it.time.toFixed(1),"s"]})]},tt)})}),s.jsx("div",{className:"space-y-2",children:(Ge=Ae.keyframes)==null?void 0:Ge.map((it,tt)=>s.jsxs("div",{className:"space-y-1.5",children:[s.jsxs("div",{className:"text-[9px] text-zinc-500",children:[it.type==="prev"?"":it.type==="current"?"":""," (",it.time.toFixed(1),"s)"]}),it.mj_prompt&&s.jsx("div",{className:`p-2 rounded border ${e==="dark"?"bg-zinc-900 border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-[9px] text-zinc-500 mb-1",children:"Midjourney "}),s.jsx("div",{className:"text-[10px] text-zinc-700 dark:text-zinc-300 break-words select-text cursor-text",onMouseDown:$t=>$t.stopPropagation(),children:it.mj_prompt})]}),s.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(it.mj_prompt),alert("")}catch{alert("")}},className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:$t=>$t.stopPropagation(),title:"",children:s.jsx(Zl,{size:12})}),s.jsx("button",{onClick:()=>{const $t=Pn(n.x+n.width+100,n.y+n.height/2),nn=`node-${Date.now()}`,Gt={id:nn,type:"gen-image",x:$t.x-180,y:$t.y-170,width:360,height:340,settings:{model:"mj-v6",prompt:it.mj_prompt,ratio:"Auto",resolution:"2K"}};f(we=>[...we,Gt]),setTimeout(()=>{const we=Pn(n.x+n.width+200,n.y+n.height/2),Rt=`node-${Date.now()+1}`,jn={id:Rt,type:"preview",x:we.x-160,y:we.y-130,width:320,height:260};f(yn=>[...yn,jn]),z(yn=>[...yn,{id:`conn-${Date.now()}`,from:nn,to:Rt}])},50)},className:"p-1 rounded hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors text-blue-600 dark:text-blue-400",onMouseDown:$t=>$t.stopPropagation(),title:"",children:s.jsx(Gy,{size:12})})]})]})}),it.jimeng_prompt&&s.jsx("div",{className:`p-2 rounded border ${e==="dark"?"bg-zinc-900 border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-[9px] text-zinc-500 mb-1",children:""}),s.jsx("div",{className:"text-[10px] text-zinc-700 dark:text-zinc-300 break-words select-text cursor-text",onMouseDown:$t=>$t.stopPropagation(),children:it.jimeng_prompt})]}),s.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(it.jimeng_prompt),alert("")}catch{alert("")}},className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:$t=>$t.stopPropagation(),title:"",children:s.jsx(Zl,{size:12})})]})})]},tt))}),Ae.global_tags&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-zinc-300 dark:border-zinc-700",children:[s.jsx("div",{className:"text-[9px] text-zinc-500 mb-1",children:""}),s.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(Ae.global_tags).map(([it,tt])=>Array.isArray(tt)&&tt.map(($t,nn)=>s.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",children:$t},`${it}-${nn}`)))})]})]},zt)})})]}):null]})})()})]}),n.type==="storyboard-node"&&(()=>{var jt,wt,Et,xt,yt,pt,St,hn,It,an,Bt,Sr,ie,ge,Je,mt,et,Ae,zt,ln,at,On,Bn,An,xn,lt,Dt,zn;const O=(U,Ze)=>{const Ge=U.clipboardData.items;for(let it=0;it<Ge.length;it++)if(Ge[it].type.indexOf("image")!==-1){U.preventDefault(),U.stopPropagation();const tt=Ge[it].getAsFile(),$t=new FileReader;$t.onload=nn=>Kt(n.id,Ze,{image_url:nn.target.result}),$t.readAsDataURL(tt);return}},me=(U,Ze)=>{var jn,yn;U.preventDefault(),U.stopPropagation();const Ge=(((jn=n.settings)==null?void 0:jn.shots)||[]).find(ue=>ue.id===Ze),it=((yn=n.settings)==null?void 0:yn.mode)||"video",tt=ue=>{if(!ue)return!1;if(it==="video"){const dt=(Ge==null?void 0:Ge.useFirstLastFrame)&&(Ge==null?void 0:Ge.activeInput)==="last"?"lastFrame":"image_url";return Kt(n.id,Ze,{[dt]:ue,image_filename:""}),!0}if(Ge!=null&&Ge.useMultiRef){const dt=(Ge.referenceImages&&Ge.referenceImages.length>0?Ge.referenceImages:Ge.image_url?[Ge.image_url]:[]).slice(0,5);return dt.length<5?dt.push(ue):dt[0]=ue,Kt(n.id,Ze,{referenceImages:dt,image_url:dt[0]||ue}),!0}return Kt(n.id,Ze,{image_url:ue,image_filename:"",referenceImages:[]}),!0};if(U.dataTransfer.files&&U.dataTransfer.files.length>0){const ue=U.dataTransfer.files[0];if(ue.type.startsWith("image/")){const De=new FileReader;De.onload=dt=>tt(dt.target.result),De.readAsDataURL(ue);return}}const $t=U.dataTransfer.getData("application/x-tapnow-history");if($t)try{const ue=JSON.parse($t),De=(ue==null?void 0:ue.url)||(ue==null?void 0:ue.originalUrl)||(ue==null?void 0:ue.previewUrl)||"";if(tt(De))return}catch(ue){console.warn("[StoryboardDrop] Failed to parse payload",ue)}const Gt=(U.dataTransfer.getData("text/uri-list")||"").split(`
`).find(ue=>ue&&!ue.startsWith("#"))||"",we=U.dataTransfer.getData("text/plain")||"",Rt=(Gt||we).trim();Rt&&/^(https?:|data:image\/|blob:|file:)/i.test(Rt)&&tt(Rt)},He=Ot.filter(U=>U.nodeId===n.id),ct=gn.filter(U=>U.nodeId===n.id);return s.jsx("div",{className:"flex h-full",children:s.jsxs("div",{className:`flex flex-col h-full rounded-xl overflow-hidden pointer-events-auto transition-colors flex-1 ${e==="dark"?"bg-zinc-950 border border-zinc-800":e==="solarized"?"bg-[#eee8d5] border border-[#d7cfb2]":"bg-white border border-zinc-300 shadow-sm"}`,onMouseEnter:()=>Gg(!0),onMouseLeave:()=>Gg(!1),children:[s.jsxs("div",{className:`px-4 py-3 border-b flex items-center shrink-0 flex-nowrap overflow-x-auto no-scrollbar ${e==="dark"?"bg-zinc-900 border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.jsx(Dp,{size:16,className:"text-purple-500"}),s.jsx("span",{className:`font-bold text-xs ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,children:""}),s.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"/"}),(jt=n.settings)!=null&&jt.isEditingTitle?s.jsx("input",{type:"text",value:((wt=n.settings)==null?void 0:wt.projectTitle)||"",onChange:U=>Le(n.id,{projectTitle:U.target.value}),placeholder:"",className:`font-bold text-xs bg-transparent border-b border-blue-500 outline-none w-32 transition-colors ${e==="dark"?"text-zinc-200 placeholder-zinc-500":"text-zinc-800 placeholder-zinc-400"}`,onMouseDown:U=>U.stopPropagation(),onClick:U=>U.stopPropagation(),onKeyDown:U=>{U.stopPropagation(),(U.key==="Enter"||U.key==="Escape")&&Le(n.id,{isEditingTitle:!1})},onBlur:()=>Le(n.id,{isEditingTitle:!1}),autoFocus:!0}):s.jsx("span",{className:`font-bold text-xs cursor-move ${e==="dark"?"text-zinc-200":"text-zinc-800"} ${(Et=n.settings)!=null&&Et.projectTitle?"":e==="dark"?"text-zinc-500":"text-zinc-400"}`,title:"",children:((xt=n.settings)==null?void 0:xt.projectTitle)||""}),s.jsx("button",{onClick:U=>{var Ze;U.stopPropagation(),Le(n.id,{isEditingTitle:!((Ze=n.settings)!=null&&Ze.isEditingTitle)})},onMouseDown:U=>U.stopPropagation(),className:`p-0.5 rounded transition-colors ${(yt=n.settings)!=null&&yt.isEditingTitle?"text-blue-500":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:"",children:s.jsx($h,{size:12})}),s.jsxs("div",{className:`flex items-center ml-2 p-0.5 rounded-full ${e==="dark"?"bg-zinc-800":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-200"}`,children:[s.jsx("button",{onClick:U=>{var $t,nn;U.stopPropagation();const Ze="image",Ge=Ut(localStorage.getItem("tapnow_last_image_model")||(($t=je.find(Gt=>ns(Gt.type)))==null?void 0:$t.id)||""),tt=(((nn=n.settings)==null?void 0:nn.shots)||[]).map(Gt=>{const we=Ht(Gt.model);return!we||we.type==="Video"?{...Gt,model:Ge,duration:void 0}:Gt});Le(n.id,{mode:Ze,shots:tt})},className:`text-[10px] px-2 py-0.5 rounded-full transition-all ${(((pt=n.settings)==null?void 0:pt.mode)||"video")==="image"?"bg-blue-500 text-white shadow-sm":e==="dark"?"text-zinc-400 hover:text-zinc-200":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:U=>U.stopPropagation(),title:"",children:""}),s.jsx("button",{onClick:U=>{var $t,nn;U.stopPropagation();const Ze="video",Ge=Ut(localStorage.getItem("tapnow_last_video_model")||(($t=je.find(Gt=>Gt.type==="Video"))==null?void 0:$t.id)||""),tt=(((nn=n.settings)==null?void 0:nn.shots)||[]).map(Gt=>{const we=Ht(Gt.model);return!we||ns(we.type)?{...Gt,model:Ge,duration:Ya(Ge)}:Gt});Le(n.id,{mode:Ze,shots:tt})},className:`text-[10px] px-2 py-0.5 rounded-full transition-all ${(((St=n.settings)==null?void 0:St.mode)||"video")==="video"?"bg-green-500 text-white shadow-sm":e==="dark"?"text-zinc-400 hover:text-zinc-200":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:U=>U.stopPropagation(),title:"",children:""})]})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-auto relative z-10 shrink-0",children:[s.jsx("button",{onClick:U=>{U.stopPropagation(),confirm("")&&Le(n.id,{shots:[]})},className:"p-1 hover:bg-red-100 hover:text-red-500 rounded text-zinc-400 transition-colors",title:"",children:s.jsx(cs,{size:14})}),s.jsxs("button",{onClick:()=>{var Ze,Ge;const U=id(n.id);if(U.length>0){const it=U.join(`
`),tt=/#\s*(\d+)\s*([^#]*)|\s*(\d+)\s*\s*([^#]*)/g,$t=[];let nn;for(;(nn=tt.exec(it))!==null;){const Gt=parseInt(nn[1]||nn[3]),we=(nn[2]||nn[4]||"").trim();we&&$t.push({num:Gt,text:we})}if($t.length===0&&it.split(`
`).filter(we=>we.trim()).forEach((we,Rt)=>{const jn=we.match(/^(\d+)[.\s]+(.*)/);jn?$t.push({num:parseInt(jn[1]),text:jn[2].trim()}):$t.push({num:Rt+1,text:we.trim()})}),$t.length>0){const Gt=((Ze=n.settings)==null?void 0:Ze.shots)||[],we=[...Gt];$t.forEach((Rt,jn)=>{jn<Gt.length?we[jn]={...we[jn],prompt:Rt.text,description:Rt.text}:we.push({id:Date.now()+Math.random()+jn,prompt:Rt.text,description:Rt.text,model:Ut(localStorage.getItem("tapnow_last_video_model")||""),duration:5,status:"draft",outputEnabled:!0,selectedImageIndex:0})}),Le(n.id,{shots:we})}else alert(" (: #1 )")}else Le(n.id,{scriptExpanded:!((Ge=n.settings)!=null&&Ge.scriptExpanded)})},className:`text-xs px-2 py-1 rounded transition-colors flex items-center gap-1 ${e==="dark"?"bg-purple-600 hover:bg-purple-500 text-white":"bg-purple-500 hover:bg-purple-400 text-white"}`,onMouseDown:U=>U.stopPropagation(),title:id(n.id).length>0?"":"",children:[s.jsx(oi,{size:12}),s.jsx("span",{className:"whitespace-nowrap",children:""})]}),(()=>{var Ge;const U=sd(n.id),Ze=((Ge=U==null?void 0:U.selectedKeyframes)==null?void 0:Ge.length)||0;return s.jsxs("button",{onClick:async()=>{var Gt;if(!U||Ze===0){alert("");return}const it=U.selectedKeyframes,tt=((Gt=n.settings)==null?void 0:Gt.shots)||[],$t=Math.max(tt.length,it.length),nn=Array.from({length:$t},(we,Rt)=>{var jn,yn,ue,De,dt,Mt,vt,Mn,rn;return{id:((jn=tt[Rt])==null?void 0:jn.id)||`shot-${Date.now()}-${Rt}`,...tt[Rt],prompt:((yn=tt[Rt])==null?void 0:yn.prompt)??"",description:((ue=tt[Rt])==null?void 0:ue.description)??"",model:Ut(((De=tt[Rt])==null?void 0:De.model)||localStorage.getItem("tapnow_last_video_model")||""),image_url:((dt=it[Rt])==null?void 0:dt.url)??((Mt=tt[Rt])==null?void 0:Mt.image_url)??"",image_filename:((vt=it[Rt])==null?void 0:vt.filename)||((Mn=tt[Rt])==null?void 0:Mn.image_filename)||"",status:((rn=tt[Rt])==null?void 0:rn.status)||"draft"}});if(ae(),window.LocalImageManager){for(let we of nn)if(we.image_url&&(we.image_url.startsWith("file://")||we.image_url.startsWith("img_"))){const jn=we.image_url.startsWith("img_")?we.image_url:we.imgId||we.image_filename;if(jn)try{const yn=await window.LocalImageManager.getImage(jn);yn&&(we.image_url=URL.createObjectURL(yn))}catch(yn){console.error("[KeyframeImport] Failed to load local image:",jn,yn)}}}Le(n.id,{shots:nn})},className:`text-xs px-2 py-1 rounded transition-colors flex items-center gap-1 ${Ze>0?"bg-blue-600 hover:bg-blue-500 text-white":e==="dark"?"bg-zinc-700 text-zinc-400 cursor-not-allowed":"bg-zinc-200 text-zinc-500 cursor-not-allowed"}`,onMouseDown:it=>it.stopPropagation(),disabled:Ze===0,title:Ze>0?` ${Ze} `:"",children:[s.jsx(ql,{size:12}),s.jsxs("span",{className:"whitespace-nowrap",children:["",Ze>0?` (${Ze})`:""]})]})})(),(()=>{var it;const U=((it=n.settings)==null?void 0:it.mode)||"video",Ze=g.filter(tt=>tt.to===n.id).map(tt=>At.get(tt.from)).find(tt=>tt&&(U==="image"&&tt.type==="gen-image"||U==="video"&&tt.type==="gen-video"));if(!Ze)return null;const Ge=Ze.settings||{};return s.jsxs("button",{onClick:()=>{var nn;const tt=((nn=n.settings)==null?void 0:nn.shots)||[];if(tt.length===0){Le(n.id,{errorMsg:""});return}ae();const $t=tt.map(Gt=>({...Gt,model:Ge.model||Gt.model,ratio:Ge.ratio||Gt.ratio,resolution:Ge.resolution||Gt.resolution,duration:Ge.duration||Gt.duration}));Le(n.id,{shots:$t}),a(`  ${$t.length}  | ${Ge.model||"?"} / ${Ge.ratio||"?"}`,"success",5e3)},className:`text-xs px-2 py-1 rounded transition-colors flex items-center gap-1 ${e==="dark"?"bg-green-600 hover:bg-green-500 text-white":"bg-green-500 hover:bg-green-400 text-white"}`,onMouseDown:tt=>tt.stopPropagation(),title:` ${U==="image"?"":""}: ${Ge.model||"?"} / ${Ge.ratio||"?"} / ${Ge.resolution||"?"}${U==="video"?` / ${Ge.duration||"?"}`:""}`,children:[s.jsx(qd,{size:12}),s.jsx("span",{className:"whitespace-nowrap",children:""})]})})(),s.jsxs("div",{className:`flex items-center gap-1 border-l pl-2 ml-1 ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,children:[s.jsx("input",{type:"number",min:"0",max:"20",value:ye,onChange:U=>ke(Math.max(0,parseInt(U.target.value)||0)),className:`w-8 text-center text-xs rounded border outline-none py-0.5 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":"bg-white border-zinc-300"}`,title:" (0=)"}),s.jsx("button",{onClick:()=>{var yn,ue;const U=((yn=n.settings)==null?void 0:yn.mode)||"video",Ze=((ue=n.settings)==null?void 0:ue.shots)||[],Ge=Ze.filter(De=>De.status==="generating");if(Ge.length>0){const De=prompt(` ${Ge.length} 




  "1"  "ok" = 
  "2"  "skip" = 
  = `,"");if(De===null||De.trim()==="")return;const dt=De.trim().toLowerCase();(dt==="1"||dt==="ok"||dt==="")&&Ge.forEach(Mt=>{Kt(n.id,Mt.id,{status:"pending",errorMsg:""}),Mt.status="pending"})}let it=Ze.filter(De=>De.status!=="done"&&De.status!=="generating"&&!De.outputEnabled),tt=!1;if(it.length===0){if(it=Ze.filter(De=>!De.outputEnabled&&De.status==="done"),it.length===0){const De=Ze.every(Mt=>Mt.outputEnabled);Ze.some(Mt=>Mt.status==="generating")?alert(""):De&&Ze.length>0?alert(`
`):alert("");return}tt=!0}if(tt){const De=`

 ${it.length} 

 
 

`;if(!confirm(De))return}const $t=it.length,nn=ye===0?$t:Math.max(1,ye),Gt=(qe.current.get(n.id)||0)+1;qe.current.set(n.id,Gt);const we=`batch-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,Rt=it.map(De=>De.id);Rt.forEach((De,dt)=>{Q.current.set(`${n.id}:${De}`,{batchId:we,batchOrder:dt,taskIndex:Gt})}),Ie(De=>{var dt;return[...De,{id:we,nodeId:n.id,projectTitle:((dt=n.settings)==null?void 0:dt.projectTitle)||"",total:$t,concurrency:nn,createdAt:Date.now(),mode:U,taskIndex:Gt,shotIds:Rt}]});const jn=it.map((De,dt)=>({nodeId:n.id,shotId:De.id,retryCount:0,mode:U,batchId:we,batchOrder:dt,batchConcurrency:nn,taskIndex:Gt}));pe(De=>[...De,...jn]),Oe.current!=="running"&&(Oe.current="idle"),Lt(De=>De+1),a(`  ${jn.length} ${U==="image"?"":""} | : ${ye===0?"":ye}${tt?" ()":""}`,"success",5e3)},className:`p-1 rounded transition-colors ${(((hn=n.settings)==null?void 0:hn.mode)||"video")==="image"?e==="dark"?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-500 hover:bg-blue-400 text-white":e==="dark"?"bg-yellow-600 hover:bg-yellow-500 text-white":"bg-yellow-500 hover:bg-yellow-400 text-white"}`,title:`${(((It=n.settings)==null?void 0:It.mode)||"video")==="image"?"":""}`,children:s.jsxs("div",{className:"flex items-center gap-1",children:[(((an=n.settings)==null?void 0:an.mode)||"video")==="image"?s.jsx(ql,{size:12}):s.jsx(Up,{size:12,fill:"currentColor"}),s.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:""})]})}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:U=>{U.stopPropagation();const Ze=U.currentTarget.getBoundingClientRect();wn((Me==null?void 0:Me.nodeId)===n.id&&Me.type==="storyboard-download"?null:{nodeId:n.id,type:"storyboard-download",anchor:{top:Ze.top,left:Ze.left,right:Ze.right,bottom:Ze.bottom,width:Ze.width,height:Ze.height}})},className:`p-1 rounded transition-colors flex items-center gap-0.5 ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-600"}`,title:"",onMouseDown:U=>U.stopPropagation(),children:[s.jsx(Qa,{size:12}),s.jsx(Kr,{size:10})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="storyboard-download"&&Me.anchor&&$f.createPortal(s.jsxs("div",{className:`fixed mt-1 w-32 rounded-lg shadow-xl py-1 z-[9999] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{top:Me.anchor.bottom+6,left:Me.anchor.right,transform:"translateX(-100%)"},onMouseLeave:()=>wn(null),onMouseDown:U=>U.stopPropagation(),children:[s.jsx("button",{onClick:()=>{wn(null),lb(n,"all")},className:`w-full text-left px-3 py-2 text-xs transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,children:""}),s.jsx("button",{onClick:()=>{wn(null),lb(n,"selected")},className:`w-full text-left px-3 py-2 text-xs transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,children:""})]}),document.body)]}),s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:U=>{U.stopPropagation();const Ze=U.currentTarget.getBoundingClientRect();wn((Me==null?void 0:Me.nodeId)===n.id&&Me.type==="batch-queue"?null:{nodeId:n.id,type:"batch-queue",anchor:{top:Ze.top,left:Ze.left,right:Ze.right,bottom:Ze.bottom,width:Ze.width,height:Ze.height}})},className:`p-1 rounded transition-colors relative ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-600"}`,title:` ${ct.length} |  ${He.length}`,onMouseDown:U=>U.stopPropagation(),children:[s.jsx(Ih,{size:12}),He.length>0&&s.jsx("span",{className:`absolute -top-1 -right-1 text-[8px] px-1 rounded-full ${e==="dark"?"bg-blue-500 text-white":"bg-blue-600 text-white"}`,children:He.length})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="batch-queue"&&Me.anchor&&$f.createPortal(s.jsxs("div",{className:`fixed mt-1 w-64 rounded-lg shadow-xl py-2 z-[9999] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{top:Me.anchor.bottom+6,left:Me.anchor.right,transform:"translateX(-100%)"},onMouseLeave:()=>wn(null),onMouseDown:U=>U.stopPropagation(),children:[s.jsxs("div",{className:`px-3 pb-2 text-[10px] ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:[" ",ct.length,"   ",He.length]}),s.jsxs("div",{className:"px-3 pb-2 flex gap-2",children:[s.jsx("button",{onClick:()=>{wn(null),He.length!==0&&confirm("")&&en(n.id,!1)},className:`text-[10px] px-2 py-1 rounded ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:""}),s.jsx("button",{onClick:()=>{wn(null),!(ct.length===0&&He.length===0)&&confirm("")&&en(n.id,!0)},className:`text-[10px] px-2 py-1 rounded ${e==="dark"?"bg-red-900/40 text-red-300 hover:bg-red-900/60":"bg-red-50 text-red-600 hover:bg-red-100"}`,children:""})]}),ct.length>0&&s.jsxs("div",{className:"px-3 pb-2",children:[s.jsx("div",{className:"text-[10px] mb-1 text-zinc-500",children:""}),s.jsxs("div",{className:"space-y-1",children:[ct.slice(0,6).map((U,Ze)=>s.jsxs("div",{className:`text-[10px] flex items-center justify-between gap-2 ${e==="dark"?"text-zinc-300":"text-zinc-600"}`,children:[s.jsxs("span",{className:"truncate max-w-[150px]",children:[U.projectTitle,"  ",U.sceneIndex]}),s.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.jsx("span",{className:"text-green-500",children:""}),s.jsx("button",{onClick:()=>{confirm("")&&Ue(U.nodeId,U.shotId)},className:`p-0.5 rounded ${e==="dark"?"text-zinc-500 hover:text-red-300":"text-zinc-400 hover:text-red-500"}`,title:"",children:s.jsx(cs,{size:10})})]})]},`${U.nodeId}-${U.shotId}-${Ze}`)),ct.length>6&&s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:" 6 "})]})]}),s.jsxs("div",{className:"px-3",children:[s.jsx("div",{className:"text-[10px] mb-1 text-zinc-500",children:""}),He.length===0?s.jsx("div",{className:`text-[10px] ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:""}):s.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto pr-1",children:[He.slice(0,12).map(U=>s.jsxs("div",{className:`text-[10px] flex items-center justify-between gap-2 ${e==="dark"?"text-zinc-300":"text-zinc-600"}`,children:[s.jsxs("span",{className:"truncate max-w-[150px]",children:["#",U.order," ",U.projectTitle,"  ",U.sceneIndex]}),s.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.jsx("span",{className:"text-blue-400",children:U.mode==="image"?"":""}),s.jsx("button",{onClick:()=>{confirm("")&&ot(U.nodeId,U.shotId)},className:`p-0.5 rounded ${e==="dark"?"text-zinc-500 hover:text-red-300":"text-zinc-400 hover:text-red-500"}`,title:"",children:s.jsx(cs,{size:10})})]})]},`${U.nodeId}-${U.shotId}-${U.order}`)),He.length>12&&s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:" 12 "})]})]})]}),document.body)]}),s.jsx("button",{onClick:U=>{U.stopPropagation(),f(Ze=>Ze.map(Ge=>{var it;if(Ge.id===n.id){const tt=(it=Ge.settings)==null?void 0:it.showOutputPreview,$t=tt?Math.max(380,Ge.width-220):Ge.width+220;return{...Ge,width:$t,settings:{...Ge.settings,showOutputPreview:!tt}}}return Ge}))},className:`p-1 rounded transition-colors ${(Bt=n.settings)!=null&&Bt.showOutputPreview?"bg-blue-500 text-white":e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-400":"bg-zinc-200 hover:bg-zinc-300 text-zinc-500"}`,title:(Sr=n.settings)!=null&&Sr.showOutputPreview?"":"",onMouseDown:U=>U.stopPropagation(),children:s.jsx(sl,{size:12,className:`transition-transform ${(ie=n.settings)!=null&&ie.showOutputPreview?"rotate-90":""}`})})]}),((ge=n.settings)==null?void 0:ge.showOutputPreview)&&s.jsx("div",{className:"shrink-0 flex items-center justify-center gap-2 ml-1 ",style:{width:220},children:(((Je=n.settings)==null?void 0:Je.mode)||"video")==="image"?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:U=>{var it;U.stopPropagation();const Ze=((it=n.settings)==null?void 0:it.shots)||[],Ge=Ze.length>0&&Ze.every(tt=>tt.outputEnabled);Le(n.id,{shots:Ze.map(tt=>({...tt,outputEnabled:!Ge}))})},className:`text-[10px] px-2 py-1 rounded transition-colors whitespace-nowrap ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-600"}`,onMouseDown:U=>U.stopPropagation(),title:"/",children:(((mt=n.settings)==null?void 0:mt.shots)||[]).every(U=>U.outputEnabled)?"":""}),s.jsxs("button",{onClick:U=>{var it;U.stopPropagation();const Ze=((it=n.settings)==null?void 0:it.shots)||[],Ge=Ze.some(tt=>tt.selectedImageIndex>=0);Le(n.id,{shots:Ze.map(tt=>({...tt,selectedImageIndex:tt.outputEnabled?tt.selectedImageIndex:Ge?-1:0}))})},className:`text-[10px] px-2 py-1 rounded transition-colors flex items-center gap-1 whitespace-nowrap ${e==="dark"?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-500 hover:bg-blue-400 text-white"}`,onMouseDown:U=>U.stopPropagation(),title:"==",children:[s.jsx(ql,{size:10}),s.jsx("span",{children:(((et=n.settings)==null?void 0:et.shots)||[]).some(U=>U.selectedImageIndex>=0)?"":""})]})]}):s.jsx("button",{onClick:U=>{var it;U.stopPropagation();const Ze=((it=n.settings)==null?void 0:it.shots)||[],Ge=Ze.length>0&&Ze.every(tt=>tt.outputEnabled);Le(n.id,{shots:Ze.map(tt=>({...tt,outputEnabled:!Ge}))})},className:`text-[10px] px-2 py-1 rounded transition-colors whitespace-nowrap ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-600"}`,onMouseDown:U=>U.stopPropagation(),title:"/",children:(((Ae=n.settings)==null?void 0:Ae.shots)||[]).every(U=>U.outputEnabled)?"":""})})]})]}),((zt=n.settings)==null?void 0:zt.scriptExpanded)&&s.jsxs("div",{className:`border-b shrink-0 p-3 space-y-2 ${e==="dark"?"bg-zinc-900/30 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":"bg-zinc-50/50 border-zinc-200"}`,children:[s.jsx("textarea",{value:((ln=n.settings)==null?void 0:ln.scriptText)||"",onChange:U=>Le(n.id,{scriptText:U.target.value}),placeholder:": #1  #2  ...",className:`w-full h-24 p-2 text-xs rounded border resize-none overflow-y-auto custom-scrollbar ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:U=>U.stopPropagation(),onWheel:U=>{U.stopPropagation()}}),s.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.jsx("button",{onClick:()=>{var Rt,jn;const Ze=id(n.id).join(`
`),Ge=((Rt=n.settings)==null?void 0:Rt.scriptText)||"",it=Ze||Ge,tt=[],$t=/#\s*(\d+)\s*([^#]*)|\s*(\d+)\s*\s*([^#]*)/g;let nn;for(;(nn=$t.exec(it))!==null;){const yn=parseInt(nn[1]||nn[3]),ue=(nn[2]||nn[4]||"").trim();ue&&tt.push({num:yn,text:ue})}if(tt.length===0&&it.split(`
`).filter(ue=>ue.trim()).forEach((ue,De)=>{const dt=ue.match(/^(\d+)[.\s]+(.*)/);dt?tt.push({num:parseInt(dt[1]),text:dt[2].trim()}):tt.push({num:De+1,text:ue.trim()})}),tt.length===0){alert(": #1  #2 ");return}tt.sort((yn,ue)=>yn.num-ue.num);const Gt=((jn=n.settings)==null?void 0:jn.shots)||[],we=[...Gt];tt.forEach((yn,ue)=>{ue<Gt.length?we[ue]={...we[ue],prompt:yn.text,description:yn.text}:we.push({id:Date.now()+Math.random()+ue,prompt:yn.text,description:yn.text,model:Ut(localStorage.getItem("tapnow_last_video_model")||""),duration:5,status:"draft",outputEnabled:!0,selectedImageIndex:0})}),Le(n.id,{shots:we,scriptExpanded:!1})},className:"px-3 py-1.5 text-xs bg-purple-600 text-white rounded hover:bg-purple-500 transition-colors",onMouseDown:U=>U.stopPropagation(),children:""}),s.jsxs("button",{onClick:async()=>{var tt,$t,nn,Gt,we,Rt,jn,yn,ue,De;const U=((tt=n.settings)==null?void 0:tt.scriptText)||"";if(!U.trim()){Le(n.id,{errorMsg:""});return}((($t=n.settings)==null?void 0:$t.shots)||[]).length>0&&window.confirm(`
""""`);const{key:Ge,url:it}=ri(Ps);if(!Ge){Le(n.id,{errorMsg:" Chat  Key"});return}try{ae(),Le(n.id,{isGenerating:!0,errorMsg:""});const dt=((nn=n.settings)==null?void 0:nn.llmSplitPrompt)||`
 JSON : [{"prompt": "1"}, {"prompt": "2"}, ...]
 JSON`,rn=(((Rt=(we=(Gt=(await(await fetch(`${it}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${Ge}`,"Content-Type":"application/json"},body:JSON.stringify({model:Ps,messages:[{role:"system",content:dt},{role:"user",content:U}],stream:!1})})).json()).choices)==null?void 0:Gt[0])==null?void 0:we.message)==null?void 0:Rt.content)||"").match(/\[[\s\S]*\]/);if(rn){const cn=JSON.parse(rn[0]),Tr=((jn=n.settings)==null?void 0:jn.mode)||"video",Tn=Ut(Tr==="image"?localStorage.getItem("tapnow_last_image_model")||((yn=je.find(Yn=>ns(Yn.type)))==null?void 0:yn.id)||"":localStorage.getItem("tapnow_last_video_model")||((ue=je.find(Yn=>Yn.type==="Video"))==null?void 0:ue.id)||""),nr=Tr==="image"?"1:1":"16:9",sn=Tr==="video"?Ya(Tn):void 0,Sn=cn.map((Yn,Fs)=>({id:`shot-${Date.now()}-${Fs}`,scene_index:Fs+1,prompt:Yn.prompt||Yn.description||"",description:Yn.description||Yn.prompt||"",image_url:"",video_url:"",output_url:"",model:Tn,ratio:nr,duration:sn,status:"draft",outputEnabled:!1,selectedImageIndex:-1})),bn=((De=n.settings)==null?void 0:De.shots)||[],Pr=bn.length>0&&!window.lastLlmSplitOverwrite?[...bn,...Sn]:Sn;Le(n.id,{shots:Pr,scriptExpanded:!1,isGenerating:!1})}else throw new Error("AI ")}catch(dt){console.error("[LLM Split] Error:",dt),Le(n.id,{isGenerating:!1,errorMsg:dt.message})}},className:"px-2 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-500 transition-colors flex items-center gap-1",onMouseDown:U=>U.stopPropagation(),disabled:(at=n.settings)==null?void 0:at.isGenerating,title:" AI ",children:[s.jsx($d,{size:12}),(On=n.settings)!=null&&On.isGenerating?"...":"LLM"]}),s.jsx("button",{onClick:()=>{var U;return Le(n.id,{showLlmPromptEditor:!((U=n.settings)!=null&&U.showLlmPromptEditor)})},className:`p-1.5 text-xs rounded transition-colors ${(Bn=n.settings)!=null&&Bn.showLlmPromptEditor?"bg-blue-500 text-white":e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-700"}`,onMouseDown:U=>U.stopPropagation(),title:" LLM  Prompt",children:s.jsx(Xy,{size:12})}),!((An=n.settings)!=null&&An.showLlmPromptEditor)&&s.jsxs("div",{className:`flex flex-col text-[10px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:[s.jsx("span",{children:": #1 #2 "}),s.jsx("span",{children:"LLM: "})]})]}),((xn=n.settings)==null?void 0:xn.showLlmPromptEditor)&&s.jsxs("div",{className:"flex items-start gap-2 mt-2",children:[s.jsx("span",{className:`text-[10px] shrink-0 pt-1 ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:"LLM Prompt:"}),s.jsx("textarea",{value:((lt=n.settings)==null?void 0:lt.llmSplitPrompt)||`
 JSON : [{"prompt": "1"}, {"prompt": "2"}, ...]
 JSON`,onChange:U=>Le(n.id,{llmSplitPrompt:U.target.value}),className:`flex-1 text-xs p-2 rounded resize-none overflow-y-auto custom-scrollbar ${e==="dark"?"bg-zinc-800 text-zinc-200 border-zinc-700":e==="solarized"?"bg-[#fdf6e3] text-zinc-800 border-[#eee8d5]":"bg-white text-zinc-800 border-zinc-300"} border`,rows:3,placeholder:" LLM  Prompt...",onMouseDown:U=>U.stopPropagation(),onClick:U=>U.stopPropagation(),onKeyDown:U=>U.stopPropagation(),onWheel:U=>{U.stopPropagation()}})]})]}),s.jsx("div",{className:`flex-1 overflow-y-auto custom-scrollbar p-3 space-y-3 min-h-0 bg-opacity-50 ${e==="solarized"?"bg-[#fdf6e3]":""}`,onWheel:U=>{U.stopPropagation()},children:((zn=(Dt=n.settings)==null?void 0:Dt.shots)==null?void 0:zn.length)>0?n.settings.shots.map((U,Ze)=>{var it,tt,$t,nn,Gt,we,Rt,jn,yn;const Ge=(js==null?void 0:js.nodeId)===n.id&&(js==null?void 0:js.shotId)===U.id;return s.jsxs(Df.Fragment,{children:[s.jsxs("div",{className:"relative h-2 -mt-1 -mb-1 z-10 group/insert flex items-center justify-center cursor-pointer hover:h-6 transition-all",onClick:ue=>{ue.stopPropagation();const De=[...n.settings.shots||[]];De.splice(Ze,0,{id:Date.now()+Math.random(),prompt:"",description:"",model:Ut(localStorage.getItem("tapnow_last_video_model")||""),duration:5,status:"draft",outputEnabled:!0,selectedImageIndex:0}),Le(n.id,{shots:De})},title:"",children:[s.jsx("div",{className:"w-full h-[2px] bg-blue-500 opacity-0 group-hover/insert:opacity-100 transition-opacity"}),s.jsx("div",{className:"absolute w-5 h-5 rounded-full bg-blue-600 text-white flex items-center justify-center opacity-0 group-hover/insert:opacity-100 transition-opacity shadow-sm scale-75 group-hover/insert:scale-100",children:s.jsx(vo,{size:12})})]}),s.jsxs("div",{className:"flex items-stretch gap-2 w-full",children:[s.jsxs("div",{tabIndex:0,onClick:ue=>{ue.stopPropagation(),Hc({nodeId:n.id,shotId:U.id}),ue.currentTarget.focus()},onPaste:ue=>O(ue,U.id),className:`relative flex-1 flex gap-3 p-3 rounded-lg border transition-all group/shot cursor-pointer outline-none focus:ring-2 focus:ring-blue-500/50 ${Ge?"border-blue-500 ring-1 ring-blue-500 bg-blue-500/5 z-10":e==="dark"?"bg-zinc-900/50 border-zinc-800 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] hover:border-[#d7cfb2]":"bg-white border-zinc-200 hover:border-blue-300 hover:shadow-md"}`,children:[s.jsx("div",{className:`font-mono text-sm w-6 shrink-0 flex items-start pt-1 font-bold ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:Ze+1}),s.jsx("div",{className:"flex flex-col gap-2 shrink-0 mr-2 h-full min-h-[14rem] w-52",onDragOver:ue=>{ue.preventDefault()},onDrop:ue=>me(ue,U.id),children:(()=>{var Tn,nr;const De=(((Tn=n.settings)==null?void 0:Tn.mode)||"video")==="video",dt=!!((nr=Ht(U.model))!=null&&nr.supportsFirstLastFrame),Mt=dt&&U.useFirstLastFrame,vt=U.activeInput||"first",Mn=U.useMultiRef,rn=e==="dark"?"border-zinc-800":e==="solarized"?"border-[#eee8d5]":"border-zinc-300",cn=e==="dark"?"bg-black":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-50",Tr=(sn,Sn)=>{var Pr;const bn=(Pr=sn.target.files)==null?void 0:Pr[0];if(!bn)return;const Kn=new FileReader;Kn.onload=Yn=>{Kt(n.id,U.id,{[Sn]:Yn.target.result})},Kn.readAsDataURL(bn),sn.target.value=""};if(De){const sn=(Sn,bn)=>{const Kn=Sn==="first"?"image_url":"lastFrame",Pr=U[Kn],Yn=Sn==="first"?"":"",Fs=bn?"flex-1 h-full":"w-14 h-full shrink-0";return s.jsxs("div",{className:`relative rounded-lg border overflow-hidden group ${Fs} ${cn} ${rn} flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 transition-all`,onClick:bi=>{bi.stopPropagation(),bn||Kt(n.id,U.id,{activeInput:Sn})},children:[Pr?s.jsx(mr,{src:Pr,className:`w-full h-full object-cover ${bn?"":"opacity-60 hover:opacity-100"}`}):s.jsxs("div",{className:"flex flex-col items-center gap-1 text-zinc-500",children:[s.jsx(ua,{size:bn?20:14}),bn&&s.jsxs("span",{className:"text-[10px]",children:["",Yn]})]}),s.jsx("div",{className:"absolute top-0 left-0 bg-black/60 text-white text-[9px] px-1.5 py-0.5 rounded-br z-20 backdrop-blur-md pointer-events-none",children:Yn}),Pr&&s.jsx("button",{onClick:bi=>{bi.stopPropagation(),cr({url:Pr,type:"image"})},className:"absolute bottom-1 left-1 p-1 rounded-full bg-black/60 text-white hover:bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity z-30",title:"",children:s.jsx(Ri,{size:10})}),bn&&s.jsxs(s.Fragment,{children:[Pr&&s.jsx("button",{onClick:bi=>{bi.stopPropagation(),Kt(n.id,U.id,{[Kn]:""})},className:"absolute top-1 right-1 p-1 rounded-full bg-black/60 text-white hover:bg-red-500 opacity-0 group-hover:opacity-100 transition-opacity z-30",children:s.jsx(Ws,{size:12})}),s.jsxs("label",{className:"absolute inset-0 z-10 flex items-center justify-center cursor-pointer opacity-0 hover:opacity-100",children:[s.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:bi=>Tr(bi,Kn)}),s.jsx("div",{className:"p-2 rounded-full bg-black/50 text-white",children:s.jsx(ua,{size:16})})]}),dt&&s.jsx("div",{className:"absolute bottom-1 right-1 p-1 rounded bg-black/40 hover:bg-blue-500 text-white transition-colors cursor-pointer z-30",onClick:bi=>{bi.stopPropagation(),Kt(n.id,U.id,{useFirstLastFrame:!Mt,activeInput:Mt?"first":"last"})},title:"",children:s.jsx(Am,{size:12})}),Pr&&U.image_filename&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] pl-8 pr-8 py-0.5 truncate opacity-0 group-hover:opacity-100 transition-opacity z-20",title:U.image_filename,children:U.image_filename})]})]},Sn)};return Mt?s.jsxs("div",{className:"flex flex-row gap-2 h-full w-full",children:[sn("first",vt==="first"),sn("last",vt==="last")]}):sn("first",!0)}else{const sn=U.referenceImages&&U.referenceImages.length>0?U.referenceImages:U.image_url?[U.image_url]:[],Sn=sn[0]||"";return s.jsxs("div",{className:"flex flex-col gap-2 h-full w-full",children:[s.jsxs("div",{className:`relative flex-1 rounded-lg border overflow-hidden group ${cn} ${rn} flex flex-col items-center justify-center`,children:[Sn?s.jsxs(s.Fragment,{children:[s.jsx(mr,{src:Sn,className:"w-full h-full object-cover"}),s.jsx("button",{onClick:bn=>{bn.stopPropagation(),cr({url:Sn,type:"image"})},className:"absolute bottom-1 left-1 p-1 rounded-full bg-black/60 text-white hover:bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity z-30",title:"",children:s.jsx(Ri,{size:12})}),U.image_filename&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] px-8 py-0.5 truncate opacity-0 group-hover:opacity-100 transition-opacity z-20",title:U.image_filename,children:U.image_filename}),s.jsx("button",{onClick:bn=>{bn.stopPropagation(),Kt(n.id,U.id,{image_url:"",image_filename:"",referenceImages:[]})},className:"absolute top-1 right-1 p-1 rounded-full bg-black/60 text-white hover:bg-red-500 opacity-0 group-hover:opacity-100 transition-opacity z-30",title:"",children:s.jsx(Ws,{size:12})})]}):s.jsxs("div",{className:"flex flex-col items-center gap-1 text-zinc-500",children:[s.jsx(ua,{size:20}),s.jsx("span",{className:"text-[10px]",children:""})]}),s.jsxs("label",{className:`absolute inset-0 z-10 flex items-center justify-center cursor-pointer ${Sn?"opacity-0 hover:opacity-100":"opacity-100"}`,children:[s.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:bn=>{var Pr;const Kn=(Pr=bn.target.files)==null?void 0:Pr[0];if(Kn){const Yn=new FileReader;Yn.onload=Fs=>{Kt(n.id,U.id,{image_url:Fs.target.result,image_filename:Kn.name})},Yn.readAsDataURL(Kn)}}}),Sn&&s.jsx("div",{className:"p-2 rounded-full bg-black/50 text-white",children:s.jsx(ua,{size:16})})]}),s.jsx("div",{className:`absolute bottom-1 right-1 p-1 rounded bg-black/40 hover:bg-blue-500 text-white transition-colors cursor-pointer z-30 ${Mn?"text-blue-400 bg-blue-500/30":"text-zinc-400"}`,onClick:bn=>{bn.stopPropagation(),Kt(n.id,U.id,{useMultiRef:!Mn})},title:"",children:s.jsx(Dp,{size:12})})]}),Mn&&s.jsxs("div",{className:"flex gap-2 h-14 shrink-0 overflow-x-auto no-scrollbar items-center",children:[sn.slice(1).map((bn,Kn)=>s.jsxs("div",{className:`relative w-12 h-14 shrink-0 rounded border overflow-hidden cursor-pointer hover:border-blue-500 transition-all ${rn} ${cn}`,onClick:Pr=>{Pr.stopPropagation();const Yn=[...sn],Fs=Kn+1;[Yn[0],Yn[Fs]]=[Yn[Fs],Yn[0]],Kt(n.id,U.id,{referenceImages:Yn,image_url:Yn[0]})},children:[s.jsx(mr,{src:bn,className:"w-full h-full object-cover"}),s.jsx("div",{className:"absolute top-0 left-0 bg-black/50 text-white text-[8px] px-1 backdrop-blur-sm",children:Kn+2})]},Kn+1)),sn.length<5&&s.jsxs("label",{className:`w-12 h-14 shrink-0 rounded border border-dashed flex items-center justify-center cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-800 ${rn} text-zinc-400 hover:text-blue-500 hover:border-blue-500 transition-colors`,children:[s.jsx(vo,{size:16}),s.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:bn=>{var Pr;const Kn=(Pr=bn.target.files)==null?void 0:Pr[0];if(Kn){const Yn=new FileReader;Yn.onload=Fs=>{Kt(n.id,U.id,{referenceImages:[...sn,Fs.target.result]})},Yn.readAsDataURL(Kn)}}})]})]})]})}})()}),s.jsxs("div",{className:"flex-1 min-w-0 flex flex-col gap-2",children:[s.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:ue=>{ue.stopPropagation(),wn((Me==null?void 0:Me.nodeId)===n.id&&Me.type==="shot-model"&&Me.shotId===U.id?null:{nodeId:n.id,type:"shot-model",shotId:U.id})},onMouseDown:ue=>ue.stopPropagation(),className:`flex items-center justify-between gap-1 px-2 py-1 rounded border text-xs transition-colors min-w-[100px] ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,children:[s.jsx("span",{className:"truncate font-mono text-[10px]",children:(()=>{var ue,De;return(ue=n.settings)!=null&&ue.mode,((De=Ht(U.model))==null?void 0:De.id)||U.model||""})()}),s.jsx(Kr,{size:10,className:"opacity-50 shrink-0"})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="shot-model"&&Me.shotId===U.id&&s.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:ue=>ue.stopPropagation(),onMouseLeave:()=>Dr(null),children:[s.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:(()=>{var dt;const De=(((dt=n.settings)==null?void 0:dt.mode)||"video")==="image";return Object.entries(Zr).filter(([,Mt])=>Mt.models.some(vt=>De?ns(vt.type):vt.type==="Video")).map(([Mt,vt])=>s.jsx("button",{onMouseEnter:()=>Dr(Mt),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${er===Mt?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:vt.name||Mt},Mt))})()}),s.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[(()=>{var dt,Mt;const De=(((dt=n.settings)==null?void 0:dt.mode)||"video")==="image";return er&&((Mt=Zr[er])==null?void 0:Mt.models.filter(vt=>De?ns(vt.type):vt.type==="Video").map(vt=>{const Mn=vt._uid||vt.id,rn=Ut(U.model);return s.jsxs("button",{onClick:()=>{var nr;const cn=((nr=n.settings)==null?void 0:nr.mode)||"video",Tr=Ya(Mn);Kt(n.id,U.id,{model:Mn,duration:U.duration||Tr});const Tn=cn==="image"?"tapnow_last_image_model":"tapnow_last_video_model";localStorage.setItem(Tn,Mn),cn==="image"?k0(Mn):j0(Mn),wn(null),Dr(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${rn===Mn?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[s.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:vt.id}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(Mn)}`})]},Mn)}))})(),!er&&s.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]}),(()=>{var Mt;const ue=((Mt=n.settings)==null?void 0:Mt.mode)||"video",De=ue==="video"?$0(U.model):Af,dt=Ht(U.model);return s.jsx("select",{value:U.ratio||(ue==="video"?"16:9":"1:1"),onChange:vt=>Kt(n.id,U.id,{ratio:vt.target.value}),onClick:vt=>vt.stopPropagation(),onMouseDown:vt=>vt.stopPropagation(),className:`text-xs px-2 py-1 rounded border outline-none transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,children:De.map(vt=>s.jsx("option",{value:vt,children:vt==="Auto"?"Auto":Lr(vt,!!(dt!=null&&dt.ratioNotesEnabled),(dt==null?void 0:dt.ratioNotes)||{})},vt))})})(),(()=>{var De;if((((De=n.settings)==null?void 0:De.mode)||"video")==="video"){const dt=T0(U.model);if(!dt.length)return null;const Mt=Ht(U.model),vt=zo(U.resolution||dt[0]||"720P"),Mn=dt[0]||"720P",rn=dt.includes(vt)?vt:Mn;return rn!==vt&&setTimeout(()=>Kt(n.id,U.id,{resolution:rn}),0),s.jsx("select",{value:rn,onChange:cn=>Kt(n.id,U.id,{resolution:cn.target.value}),onClick:cn=>cn.stopPropagation(),onMouseDown:cn=>cn.stopPropagation(),className:`text-xs px-2 py-1 rounded border outline-none transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,title:"",children:dt.map(cn=>s.jsx("option",{value:cn,children:Lr(cn,!!(Mt!=null&&Mt.videoResolutionNotesEnabled),(Mt==null?void 0:Mt.videoResolutionNotes)||{})},cn))})}else{const dt=M0(U.model),Mt=Ht(U.model),vt=Md(U.resolution||"2K"),Mn=dt[0]||"2K",rn=dt.includes(vt)?vt:Mn;return rn!==vt&&setTimeout(()=>Kt(n.id,U.id,{resolution:rn}),0),s.jsx("select",{value:rn,onChange:cn=>Kt(n.id,U.id,{resolution:cn.target.value}),onClick:cn=>cn.stopPropagation(),onMouseDown:cn=>cn.stopPropagation(),className:`text-xs px-2 py-1 rounded border outline-none transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,title:"",children:dt.map(cn=>s.jsx("option",{value:cn,children:Lr(cn,!!(Mt!=null&&Mt.resolutionNotesEnabled),(Mt==null?void 0:Mt.resolutionNotes)||{})},cn))})}})(),(((it=n.settings)==null?void 0:it.mode)||"video")==="video"&&(()=>{var vt,Mn;const ue=U.model||((vt=je.find(rn=>rn.type==="Video"&&rn.id==="sora-2"))==null?void 0:vt.id)||((Mn=je.find(rn=>rn.type==="Video"))==null?void 0:Mn.id)||"",De=Ht(ue),dt=(De==null?void 0:De.durations)||ld(ue),Mt=Ya(ue);return s.jsx("select",{value:U.duration||Mt,onChange:rn=>Kt(n.id,U.id,{duration:rn.target.value}),onClick:rn=>rn.stopPropagation(),onMouseDown:rn=>rn.stopPropagation(),className:`text-xs px-2 py-1 rounded border outline-none transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,children:dt.map(rn=>s.jsx("option",{value:rn,children:Lr(rn,!!(De!=null&&De.durationNotesEnabled),(De==null?void 0:De.durationNotes)||{})},rn))})})(),(((tt=n.settings)==null?void 0:tt.mode)||"video")==="video"&&(()=>{const ue=U.model||"",De=Ht(ue),dt=!!(De!=null&&De.supportsFirstLastFrame),Mt=!!(De!=null&&De.supportsHD);return!dt&&!Mt?null:s.jsxs("div",{className:"flex items-center gap-2",children:[dt&&s.jsxs("label",{className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border cursor-pointer transition-colors ${e==="dark"?U.useFirstLastFrame?"bg-emerald-600/25 border-emerald-500 text-emerald-200":"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?U.useFirstLastFrame?"bg-[#eee8d5] border-[#d7cfb2] text-zinc-800":"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":U.useFirstLastFrame?"bg-emerald-500/20 border-emerald-300 text-emerald-700":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,onClick:vt=>vt.stopPropagation(),children:[s.jsx("input",{type:"checkbox",checked:!!U.useFirstLastFrame,onChange:vt=>{vt.stopPropagation(),Kt(n.id,U.id,{useFirstLastFrame:vt.target.checked})},className:"w-3 h-3 cursor-pointer",onMouseDown:vt=>vt.stopPropagation()}),s.jsx("span",{children:""})]}),Mt&&s.jsxs("label",{className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border cursor-pointer transition-colors ${e==="dark"?U.isHD?"bg-blue-600/30 border-blue-500 text-blue-300":"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?U.isHD?"bg-[#eee8d5] border-[#d7cfb2] text-zinc-800":"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":U.isHD?"bg-blue-500/30 border-blue-400 text-blue-700":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,onClick:vt=>vt.stopPropagation(),children:[s.jsx("input",{type:"checkbox",checked:!!U.isHD,onChange:vt=>{vt.stopPropagation(),Kt(n.id,U.id,{isHD:vt.target.checked})},className:"w-3 h-3 cursor-pointer",onMouseDown:vt=>vt.stopPropagation()}),s.jsx("span",{children:"HD"})]})]})})()]}),(()=>{const ue=Ix(U.model,U.customParams,De=>Kt(n.id,U.id,{customParams:De}));return ue?s.jsx("div",{className:"mt-2",onMouseDown:De=>De.stopPropagation(),children:ue}):null})(),s.jsx("textarea",{className:`text-sm outline-none resize-none bg-transparent transition-all ${e==="dark"?"text-zinc-200 placeholder:text-zinc-700":"text-zinc-800 placeholder:text-zinc-400"}`,value:U.description||"",placeholder:"...",title:U.description||"",onChange:ue=>Kt(n.id,U.id,{description:ue.target.value}),onClick:ue=>{ue.stopPropagation(),Ge||Hc({nodeId:n.id,shotId:U.id})},onMouseDown:ue=>ue.stopPropagation(),onFocus:ue=>{ue.stopPropagation(),Ge||Hc({nodeId:n.id,shotId:U.id})},onInput:ue=>{Ge&&(ue.currentTarget.style.height="auto",ue.currentTarget.style.height=ue.currentTarget.scrollHeight+"px")},ref:ue=>{ue&&Ge&&(ue.style.height="auto",ue.style.height=ue.scrollHeight+"px")},style:{minHeight:Ge?"8rem":"2.5rem",height:Ge?"auto":"2.5rem",transition:"all 0.2s ease-in-out"}}),s.jsxs("div",{className:`p-2 rounded text-xs font-mono border transition-all relative ${e==="dark"?"bg-zinc-950 border-zinc-800 text-zinc-400":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-600":"bg-zinc-50 border-zinc-200 text-zinc-600"}`,style:{minHeight:Ge?"8rem":"2rem",transition:"all 0.2s ease-in-out"},children:[s.jsx("textarea",{className:"w-full bg-transparent outline-none resize-none placeholder:text-opacity-50 transition-all pr-8",value:U.prompt||"",placeholder:"...",onChange:ue=>Kt(n.id,U.id,{prompt:ue.target.value}),onClick:ue=>{ue.stopPropagation(),Ge||Hc({nodeId:n.id,shotId:U.id})},onMouseDown:ue=>ue.stopPropagation(),onFocus:ue=>{ue.stopPropagation(),Ge||Hc({nodeId:n.id,shotId:U.id})},onInput:ue=>{Ge&&(ue.currentTarget.style.height="auto",ue.currentTarget.style.height=ue.currentTarget.scrollHeight+"px")},ref:ue=>{ue&&Ge&&(ue.style.height="auto",ue.style.height=ue.scrollHeight+"px")},style:{minHeight:Ge?"8rem":"2rem",height:Ge?"auto":"2rem",transition:"all 0.2s ease-in-out"}}),(U.model==="sora-2"||U.model==="sora-2-pro")&&br.length>0&&s.jsx("button",{onClick:ue=>{ue.stopPropagation(),$l(!0)},className:`absolute top-2 right-2 p-1 rounded transition-colors ${e==="dark"?"text-zinc-500 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-400 hover:text-zinc-700 hover:bg-zinc-200"}`,title:"",children:s.jsx(Lp,{size:12})})]}),(()=>{const ue=U.model||"";if(!(ue&&(ue.includes("sora")||ue==="sora-2"||ue==="sora-2-pro"))||br.length===0)return null;const dt=U.prompt||"",Mt=`${n.id}-${U.id}`,vt=fx[Mt]||!1,Mn=5,rn=br.length>Mn;return s.jsx("div",{className:"border-t border-dashed mt-1",style:{borderColor:e==="dark"?"rgba(63, 63, 70, 0.5)":"rgba(161, 161, 170, 0.5)"},children:s.jsxs("div",{className:"flex items-center justify-between py-1 px-1",children:[s.jsx("div",{className:"flex gap-2 overflow-x-auto py-2 flex-1 custom-scrollbar",children:(vt?br:br.slice(0,Mn)).map(cn=>{const Tr=`@${cn.username}`,Tn=dt.includes(Tr);return s.jsxs("button",{onClick:nr=>{nr.stopPropagation();let sn=dt||"";Tn?sn=sn.replace(Tr,"").replace(/\s{2,}/g," ").trim():(sn=sn.trim(),sn=sn?`${sn} ${Tr} `:`${Tr} `),Kt(n.id,U.id,{prompt:sn})},className:`relative shrink-0 transition-all ${Tn?"scale-110":"opacity-70 hover:opacity-100"}`,title:cn.username,children:[s.jsx("img",{src:cn.localCacheUrl||cn.profile_picture_url||"",alt:cn.username,className:`w-8 h-8 rounded-full object-cover border-2 ${Tn?"border-blue-500 ring-2 ring-blue-500":"border-transparent"}`,onError:nr=>{nr.target.style.display="none"}}),s.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 bg-black/50 rounded-full p-0.5",children:s.jsx(Id,{size:8,className:"text-green-400"})})]},cn.id)})}),rn&&s.jsx("button",{onClick:cn=>{cn.stopPropagation(),vt?Ou(Tr=>{const Tn={...Tr};return delete Tn[Mt],Tn}):($l(!0),Ou(Tr=>({...Tr,[Mt]:!0})))},className:`shrink-0 px-2 py-1 text-[10px] rounded transition-colors ml-2 ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,title:vt?"":"",children:vt?"":`+${br.length-Mn}`})]})})})(),s.jsxs("div",{className:"flex gap-1 flex-wrap items-center mt-1",children:[($t=U.tags)==null?void 0:$t.map((ue,De)=>s.jsx("span",{className:`px-1.5 py-0.5 text-[10px] rounded border ${e==="dark"?"bg-blue-900/30 text-blue-300 border-blue-800":"bg-blue-50 text-blue-600 border-blue-200"}`,children:ue},De)),U.camera&&s.jsxs("span",{className:`px-1.5 py-0.5 text-[10px] rounded border flex items-center gap-1 ${e==="dark"?"bg-purple-900/30 text-purple-300 border-purple-800":"bg-purple-50 text-purple-600 border-purple-200"}`,children:[s.jsx(Op,{size:8})," ",U.camera]}),U.time_range&&s.jsx("span",{className:`text-[10px] ml-auto font-mono ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:U.time_range})]})]}),s.jsxs("div",{className:`flex flex-col items-center gap-3 justify-between border-l pl-6 pr-2 shrink-0 w-16 ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[(U.status==="generating"||U.status==="done"||U.status==="completed"||U.status==="failed"||U.status==="error")&&s.jsxs("div",{className:`px-1.5 py-0.5 rounded text-[11px] font-mono flex items-center justify-center gap-1 ${e==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-50 text-blue-600 border border-blue-200"}`,children:[s.jsx(Vy,{size:12}),s.jsx("span",{children:U.status==="generating"?Xg[`${n.id}-${U.id}`]?Xg[`${n.id}-${U.id}`].replace(" ",""):"0.0s":`${(U.durationCost||0).toFixed(1)}s`})]}),s.jsx("button",{onClick:()=>{confirm("")&&vk(n.id,U.id)},className:`p-1.5 transition-colors ${e==="dark"?"text-zinc-600 hover:text-red-500":"text-zinc-400 hover:text-red-600"}`,title:"",onMouseDown:ue=>ue.stopPropagation(),children:s.jsx(cs,{size:16})})]}),(()=>{var Mt;const ue=((Mt=n.settings)==null?void 0:Mt.mode)||"video",De=ue==="image"?U.output_url:U.video_url,dt=U.status==="done"&&De;return s.jsx("button",{onClick:vt=>{vt.stopPropagation(),U.status==="generating"?Kt(n.id,U.id,{status:"draft",errorMsg:null}):ue==="image"?tb(n.id,U):eb(n.id,U)},className:`p-3 rounded text-white shadow-sm transition-all active:scale-95 ${U.status==="generating"?"bg-zinc-500 hover:bg-red-500":dt?"bg-blue-500 hover:bg-green-600":ue==="image"?"bg-blue-600 hover:bg-blue-500":"bg-green-600 hover:bg-green-500"}`,title:U.status==="generating"?"":dt?"":`${ue==="image"?"":""}`,onMouseDown:vt=>vt.stopPropagation(),children:U.status==="generating"?s.jsxs("div",{className:"relative w-4 h-4 flex items-center justify-center",children:[s.jsx(wo,{size:18,className:"animate-spin absolute"}),s.jsx(ev,{size:14,fill:"currentColor",className:"opacity-0 hover:opacity-100 absolute z-10 transition-opacity"})]}):dt?s.jsx(Od,{size:18}):ue==="image"?s.jsx(ql,{size:18}):s.jsx(Zy,{size:18,fill:"currentColor"})})})(),s.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[s.jsx("button",{onClick:()=>{var dt;const ue=[...((dt=n.settings)==null?void 0:dt.shots)||[]],De=ue.findIndex(Mt=>Mt.id===U.id);De>0&&([ue[De-1],ue[De]]=[ue[De],ue[De-1]],Le(n.id,{shots:ue}))},disabled:Ze===0,className:`p-1.5 rounded transition-colors ${Ze===0?"opacity-30 cursor-not-allowed":""} ${e==="dark"?"text-zinc-500 hover:text-blue-400 hover:bg-zinc-800":"text-zinc-400 hover:text-blue-500 hover:bg-zinc-100"}`,title:"",onMouseDown:ue=>ue.stopPropagation(),children:s.jsx(Ch,{size:16})}),s.jsx("button",{onClick:()=>{var dt;const ue=[...((dt=n.settings)==null?void 0:dt.shots)||[]],De=ue.findIndex(Mt=>Mt.id===U.id);De<ue.length-1&&([ue[De],ue[De+1]]=[ue[De+1],ue[De]],Le(n.id,{shots:ue}))},disabled:Ze===(((Gt=(nn=n.settings)==null?void 0:nn.shots)==null?void 0:Gt.length)||0)-1,className:`p-1.5 rounded transition-colors ${Ze===(((Rt=(we=n.settings)==null?void 0:we.shots)==null?void 0:Rt.length)||0)-1?"opacity-30 cursor-not-allowed":""} ${e==="dark"?"text-zinc-500 hover:text-blue-400 hover:bg-zinc-800":"text-zinc-400 hover:text-blue-500 hover:bg-zinc-100"}`,title:"",onMouseDown:ue=>ue.stopPropagation(),children:s.jsx(Kr,{size:16})})]})]})]}),((jn=n.settings)==null?void 0:jn.showOutputPreview)&&s.jsxs("div",{className:`shrink-0 p-2 ml-1 flex flex-col gap-2 rounded-lg border transition-all ${e==="dark"?"bg-zinc-900/50 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":"bg-white border-zinc-200"} ${U.outputEnabled?e==="dark"?"bg-blue-900/20 border-blue-800":"bg-blue-50 border-blue-300":""}`,style:{width:220},children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:`w-4 h-4 rounded border cursor-pointer flex items-center justify-center transition-colors ${U.outputEnabled?"bg-blue-500 border-blue-500 text-white":e==="dark"?"border-zinc-600 hover:border-blue-400":"border-zinc-400 hover:border-blue-400"}`,onClick:ue=>{ue.stopPropagation(),Kt(n.id,U.id,{outputEnabled:!U.outputEnabled})},title:U.outputEnabled?"":"",children:U.outputEnabled&&s.jsx(rl,{size:10})}),s.jsx("span",{className:`text-[10px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:((yn=U.output_images)==null?void 0:yn.length)>0?"":""})]}),(()=>{var Tr;const ue=U.output_images||[],De=U.selectedImageIndex??0,dt=((Tr=n.settings)==null?void 0:Tr.mode)||"video",Mt=Tn=>e==="solarized"?Tn%2===0?"bg-[#fdf6e3]":"bg-[#eee8d5]":"";if(dt==="video")return s.jsxs("div",{className:`flex-1 min-h-[80px] rounded overflow-hidden relative group/preview cursor-pointer border ${e==="dark"?"border-zinc-800 bg-black":e==="solarized"?`border-[#eee8d5] ${Mt(0)}`:"border-zinc-200 bg-zinc-50"}`,onClick:Tn=>{Tn.stopPropagation(),U.video_url&&cr({url:U.video_url,type:"video",prompt:U.prompt})},children:[U.video_url?s.jsx("video",{src:U.video_url,className:"w-full h-full object-cover",muted:!0}):s.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-30",children:s.jsx(Ky,{size:16})}),U.video_url&&s.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover/preview:opacity-100 flex items-center justify-center transition-opacity",children:s.jsx(Ri,{size:16,className:"text-white drop-shadow-md"})}),U.video_filename&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[8px] px-1 py-0.5 truncate opacity-0 group-hover/preview:opacity-100 transition-opacity",title:U.video_filename,children:U.video_filename})]});const vt=U.outputEnabled,Mn=De>=0,rn=Mn?De:0;if(ue.length>=2)if(Ge){const Tn=ue[rn]||ue[0],nr=ue.slice(0,4).map((sn,Sn)=>({img:sn,idx:Sn})).filter(sn=>sn.idx!==rn);return s.jsxs("div",{className:"flex flex-col gap-1 flex-1 min-h-[100px]",children:[s.jsxs("div",{className:`relative flex-1 rounded border overflow-hidden transition-all group/main ${Mn?"border-blue-500 ring-1 ring-blue-500/50":e==="dark"?"border-zinc-700":"border-zinc-300"} ${e==="solarized"?Mt(rn):""} ${vt?"cursor-not-allowed opacity-80":"cursor-pointer"}`,onClick:sn=>{sn.stopPropagation(),vt||Kt(n.id,U.id,{selectedImageIndex:Mn?-1:rn})},onDoubleClick:sn=>{var Sn,bn;sn.stopPropagation(),cr({url:Tn,type:"image",prompt:U.prompt,mjImages:ue,selectedMjImageIndex:rn,storyboardContext:{nodeId:n.id,shotId:U.id,shotIndex:(((Sn=n.settings)==null?void 0:Sn.shots)||[]).findIndex(Kn=>Kn.id===U.id),allShots:((bn=n.settings)==null?void 0:bn.shots)||[]}})},onContextMenu:sn=>{ud(sn,{url:Tn,type:"image",prompt:U.prompt,mjImages:ue,selectedMjImageIndex:rn,sourceNode:n})},children:[s.jsx(mr,{src:Tn,className:"w-full h-full object-cover"}),s.jsx("div",{className:`absolute top-0 left-0 text-[8px] px-1 py-0.5 rounded-br ${Mn?"bg-blue-500 text-white":"bg-black/50 text-white"}`,children:rn+1}),Mn&&s.jsx("div",{className:"absolute top-0 right-0 bg-blue-500 text-white p-0.5 rounded-bl",children:s.jsx(rl,{size:10})}),vt&&s.jsx("div",{className:"absolute top-1 right-1 bg-yellow-500 text-black p-0.5 rounded text-[8px]",children:""}),s.jsx("button",{onClick:sn=>{var Sn,bn;sn.stopPropagation(),cr({url:Tn,type:"image",prompt:U.prompt,mjImages:ue,selectedMjImageIndex:rn,storyboardContext:{nodeId:n.id,shotId:U.id,shotIndex:(((Sn=n.settings)==null?void 0:Sn.shots)||[]).findIndex(Kn=>Kn.id===U.id),allShots:((bn=n.settings)==null?void 0:bn.shots)||[]}})},className:"absolute bottom-0 left-0 p-0.5 rounded-tr bg-black/60 text-white hover:bg-blue-500 opacity-0 group-hover/main:opacity-100 transition-opacity z-10",title:"",children:s.jsx(Ri,{size:10})})]}),s.jsx("div",{className:"flex gap-1 h-10 shrink-0",children:nr.map(({img:sn,idx:Sn})=>s.jsxs("div",{className:`relative flex-1 rounded border overflow-hidden transition-all group/thumb ${e==="dark"?"border-zinc-700":"border-zinc-300"} ${e==="solarized"?Mt(Sn):""} ${vt?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-blue-400"}`,onClick:bn=>{bn.stopPropagation(),vt||Kt(n.id,U.id,{selectedImageIndex:Sn})},onContextMenu:bn=>{ud(bn,{url:sn,type:"image",prompt:U.prompt,mjImages:ue,selectedMjImageIndex:Sn,sourceNode:n})},children:[s.jsx(mr,{src:sn,className:"w-full h-full object-cover"}),s.jsx("div",{className:"absolute top-0 left-0 bg-black/50 text-white text-[7px] px-0.5",children:Sn+1})]},Sn))})]})}else return s.jsx("div",{className:"grid grid-cols-2 gap-1 flex-1 min-h-[100px]",children:ue.slice(0,4).map((Tn,nr)=>s.jsxs("div",{className:`relative rounded border overflow-hidden transition-all group/cell ${De===nr?"border-blue-500 ring-1 ring-blue-500/50":e==="dark"?"border-zinc-700":"border-zinc-300"} ${e==="solarized"?Mt(nr):""} ${vt?"cursor-not-allowed opacity-80":"cursor-pointer hover:border-blue-400"}`,onClick:sn=>{sn.stopPropagation(),vt||Kt(n.id,U.id,{selectedImageIndex:De===nr?-1:nr})},onDoubleClick:sn=>{var Sn,bn;sn.stopPropagation(),cr({url:Tn,type:"image",prompt:U.prompt,mjImages:ue,selectedMjImageIndex:nr,storyboardContext:{nodeId:n.id,shotId:U.id,shotIndex:(((Sn=n.settings)==null?void 0:Sn.shots)||[]).findIndex(Kn=>Kn.id===U.id),allShots:((bn=n.settings)==null?void 0:bn.shots)||[]}})},onContextMenu:sn=>{ud(sn,{url:Tn,type:"image",prompt:U.prompt,mjImages:ue,selectedMjImageIndex:nr,sourceNode:n})},children:[s.jsx(mr,{src:Tn,className:"w-full h-full object-cover"}),s.jsx("div",{className:`absolute top-0 left-0 text-[7px] px-0.5 rounded-br ${De===nr?"bg-blue-500 text-white":"bg-black/50 text-white"}`,children:nr+1}),De===nr&&s.jsx("div",{className:"absolute top-0 right-0 bg-blue-500 text-white p-0.5 rounded-bl",children:s.jsx(rl,{size:8})}),s.jsx("button",{onClick:sn=>{var Sn,bn;sn.stopPropagation(),cr({url:Tn,type:"image",prompt:U.prompt,mjImages:ue,selectedMjImageIndex:nr,storyboardContext:{nodeId:n.id,shotId:U.id,shotIndex:(((Sn=n.settings)==null?void 0:Sn.shots)||[]).findIndex(Kn=>Kn.id===U.id),allShots:((bn=n.settings)==null?void 0:bn.shots)||[]}})},className:"absolute bottom-0 left-0 p-0.5 rounded-tr bg-black/60 text-white hover:bg-blue-500 opacity-0 group-hover/cell:opacity-100 transition-opacity z-10",title:"",children:s.jsx(Ri,{size:8})})]},nr))});const cn=ue[0]||U.output_url;return s.jsxs("div",{className:`flex-1 min-h-[80px] rounded overflow-hidden relative group/preview cursor-pointer border ${e==="dark"?"border-zinc-800 bg-black":e==="solarized"?`border-[#eee8d5] ${Mt(0)}`:"border-zinc-200 bg-zinc-50"}`,onClick:Tn=>{Tn.stopPropagation(),cn&&cr({url:cn,type:"image",prompt:U.prompt})},onContextMenu:Tn=>{cn&&ud(Tn,{url:cn,type:"image",prompt:U.prompt,sourceNode:n})},children:[cn?s.jsx(mr,{src:cn,className:"w-full h-full object-cover"}):s.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-30",children:s.jsx(Ky,{size:16})}),cn&&s.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover/preview:opacity-100 flex items-center justify-center transition-opacity",children:s.jsx(Ri,{size:16,className:"text-white drop-shadow-md"})}),U.image_filename&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[8px] px-1 py-0.5 truncate opacity-0 group-hover/preview:opacity-100 transition-opacity",title:U.image_filename,children:U.image_filename})]})})()]})]})]},U.id)}):s.jsxs("div",{className:`flex flex-col items-center justify-center h-40 gap-3 rounded-lg border-2 border-dashed cursor-pointer transition-colors ${e==="dark"?"border-zinc-800 text-zinc-600 hover:border-zinc-700":"border-zinc-300 text-zinc-400 hover:border-blue-300 hover:text-blue-500"}`,onClick:()=>qx(n.id),onMouseDown:U=>U.stopPropagation(),children:[s.jsx(Dp,{size:32,className:"opacity-50"}),s.jsx("span",{className:"text-xs",children:""})]})}),s.jsx("div",{className:`p-3 border-t shrink-0 ${e==="dark"?"bg-zinc-900 border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:s.jsxs("button",{onClick:()=>qx(n.id),className:`w-full py-2 border border-dashed text-xs rounded transition-colors flex items-center justify-center gap-2 ${e==="dark"?"border-zinc-700 text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200":"border-zinc-300 text-zinc-500 hover:bg-white hover:text-blue-600 hover:border-blue-400"}`,onMouseDown:U=>U.stopPropagation(),children:[s.jsx(vo,{size:14})," "]})})]})})})(),n.type==="image-compare"&&s.jsx("div",{className:"w-full h-full pointer-events-auto",children:s.jsx(S_,{img1:p[0],img2:p[1],theme:e})}),n.type==="preview"&&s.jsxs("div",{className:"flex flex-col h-full pointer-events-auto",children:[s.jsxs("div",{className:`flex items-center justify-between px-3 py-2 border-b text-xs font-semibold ${e==="dark"?"border-zinc-800 text-zinc-200":"border-zinc-200 text-zinc-700"}`,children:[s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx(Ri,{size:13,className:"text-blue-500"}),s.jsx("span",{children:""})]}),s.jsx("span",{className:"text-[10px] text-zinc-500",children:n.previewType==="video"?"":""})]}),s.jsxs("div",{className:"flex-1 flex flex-col p-2 gap-2 min-h-0",children:[s.jsx("div",{className:`relative flex-1 rounded-lg overflow-hidden flex items-center justify-center min-h-0 ${e==="dark"?"bg-zinc-900":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,onDrop:O=>nk(n.id,O),onDragOver:Ha,onContextMenu:O=>{const me=n.content||n.previewMjImages&&n.previewMjImages[0];me&&ud(O,{url:me,type:n.previewType||(Qt(me)?"video":"image"),sourceNode:n})},onDoubleClick:O=>{O.stopPropagation(),O.preventDefault();const me=n.content||n.previewMjImages&&n.previewMjImages[0];me&&cr({url:me,type:n.previewType||(Qt(me)?"video":"image")})},children:n.content||n.previewMjImages&&n.previewMjImages.length>0?Qt(n.content)||n.previewType==="video"?s.jsx("video",{src:n.content,className:`w-full h-full object-contain ${e==="dark"?"bg-black":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,controls:!0,draggable:!1}):n.previewMjImages&&(n.previewMjImages.length===4||n.previewMjImages.length>1)?s.jsx("div",{className:`w-full h-full grid gap-0.5 p-0.5 ${n.previewMjImages.length===4?"grid-cols-2 grid-rows-2":"grid-cols-2"}`,children:n.previewMjImages.map((O,me)=>s.jsx("div",{className:`relative w-full h-full overflow-hidden flex items-center justify-center group ${e==="dark"?"bg-black":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:s.jsx("img",{src:O,className:"max-w-full max-h-full w-auto h-auto object-contain",alt:` ${me+1}`,draggable:!1,onError:Fe=>{console.error(` ${me+1} `),Fe.target.style.display="none"}})},me))}):s.jsxs("div",{className:"w-full h-full relative group/preview",children:[s.jsx(mr,{src:n.content||n.previewMjImages&&n.previewMjImages[0],className:`w-full h-full object-contain ${e==="dark"?"bg-black":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,draggable:!1,onError:O=>{console.warn("[Preview] Image load error")}}),n.previewFilename&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] px-2 py-1 truncate opacity-0 group-hover/preview:opacity-100 transition-opacity backdrop-blur-sm",title:n.previewFilename,children:n.previewFilename})]}):s.jsxs("div",{className:"flex flex-col items-center justify-center text-[11px] text-zinc-500",children:[s.jsx(ql,{className:"w-6 h-6 mb-1 text-zinc-400"}),s.jsx("span",{children:" AI  / AI  "}),s.jsx("span",{children:""})]})}),s.jsxs("div",{className:"flex items-center justify-between gap-2 text-[11px]",children:[s.jsxs("button",{className:`flex-1 inline-flex items-center justify-center gap-1 px-2 py-1 rounded border ${e==="dark"?"border-zinc-700 text-zinc-200 hover:bg-zinc-800":"border-zinc-300 text-zinc-700 hover:bg-zinc-100"}`,onMouseDown:O=>O.stopPropagation(),onClick:async()=>{if(n.content)try{await navigator.clipboard.writeText(n.content)}catch{}},children:[s.jsx(Zl,{size:13}),""]}),s.jsxs("button",{className:`flex-1 inline-flex items-center justify-center gap-1 px-2 py-1 rounded border ${e==="dark"?"border-zinc-700 text-zinc-200 hover:bg-zinc-800":"border-zinc-300 text-zinc-700 hover:bg-zinc-100"}`,onMouseDown:O=>O.stopPropagation(),onClick:async()=>{if(!n.content)return;const O=Pn(n.x+n.width+100,n.y+n.height/2);let me;if(!Qt(n.content))try{const Fe=await Fr(n.content);Fe!=null&&Fe.w&&(Fe!=null&&Fe.h)&&(me={w:Fe.w,h:Fe.h})}catch{}Ur("input-image",O.x,O.y,null,n.content,me)},children:[s.jsx(Sh,{size:13}),""]}),s.jsxs("button",{className:`flex-1 inline-flex items-center justify-center gap-1 px-2 py-1 rounded border ${e==="dark"?"border-zinc-700 text-zinc-200 hover:bg-zinc-800":"border-zinc-300 text-zinc-700 hover:bg-zinc-100"}`,onMouseDown:O=>O.stopPropagation(),onClick:()=>{if(!n.content)return;const O={name:n.previewType==="video"?"Preview.mp4":"Preview.png",type:n.previewType==="video"?"video/mp4":"image/png",content:n.content,isImage:n.previewType!=="video",isVideo:n.previewType==="video",isAudio:!1,fromPreview:!0};Ii(me=>[...me,O]),Yi(!0)},children:[s.jsx(Ql,{size:13}),""]})]})]})]}),(n.type==="gen-image"||n.type==="gen-video")&&(()=>{var ct,jt,wt,Et,xt,yt,pt,St,hn,It,an,Bt,Sr;const O=kt.find(ie=>ie.sourceNodeId===n.id&&(ie.status==="generating"||ie.status==="completed")),me=O&&O.status==="generating",Fe=O!=null&&O.durationMs?(O.durationMs/1e3).toFixed(1):null,He=gx[n.id]||0;return s.jsxs("div",{className:"p-3 flex flex-col h-full pointer-events-auto",children:[(me||Fe)&&s.jsx("div",{className:`mb-2 px-2 py-1 rounded text-[10px] font-mono text-center ${e==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-50 text-blue-600 border border-blue-200"}`,children:me?s.jsxs("span",{children:[" ",He.toFixed(1),"s"]}):s.jsxs("span",{children:["  ",Fe,"s"]})}),s.jsxs("div",{className:`flex items-center gap-1.5 mb-2 text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[n.type==="gen-image"?s.jsx(nv,{size:12,className:"text-blue-400"}):s.jsx(Op,{size:12,className:"text-purple-400"}),s.jsx("span",{children:n.type==="gen-image"?"AI ":"AI "})]}),p.length>0&&s.jsxs("div",{className:`mb-2 rounded-lg border p-2 relative group/ref ${e==="dark"?"bg-zinc-900/50 border-purple-500/20":"bg-violet-50 border-violet-200"}`,children:[s.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[s.jsxs("span",{className:`text-[10px] font-medium flex items-center gap-1 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[s.jsx(Gy,{size:10}),""]}),s.jsxs("span",{className:"text-[9px] font-mono text-zinc-500",children:[p.length,"/10"]})]}),s.jsx("div",{className:"flex -space-x-2 overflow-visible pb-1 items-center custom-scrollbar pl-1",children:p.map((ie,ge)=>s.jsx("div",{className:"relative shrink-0 flex flex-col items-center gap-0 ",children:s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute -top-1 -left-1 w-4 h-4 text-[9px] font-semibold rounded-full bg-zinc-700 text-white select-none flex items-center justify-center border border-white/70 shadow-sm leading-none pointer-events-none",style:{zIndex:30},children:ge+1}),s.jsx("div",{className:`relative w-8 h-8 rounded-full border-2 thumb-stack-item cursor-pointer overflow-hidden ${e==="dark"?"border-[#18181b] bg-zinc-800":"border-white bg-zinc-200"}`,style:{zIndex:10-ge},children:s.jsx(mr,{src:ie,className:"w-full h-full object-cover"})})]})},ge))})]}),s.jsxs("div",{className:`rounded-lg p-3 mb-2 border focus-within:border-blue-500/30 transition-colors flex-1 flex flex-col ${e==="dark"?"bg-zinc-950/50 border-zinc-800":e==="solarized"||e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[n.type==="gen-image"&&(()=>{const ie=n==null?void 0:n.maskContent;let ge=g.find(Ae=>Ae.to===n.id&&(!Ae.inputType||Ae.inputType==="default"));ge||(ge=g.find(Ae=>Ae.to===n.id));const Je=ge?At.get(ge.from):null,mt=Je&&Je.maskContent;return ie||mt?s.jsxs("div",{className:`flex items-center gap-1.5 mb-2 px-2 py-1 rounded text-[10px] font-medium ${e==="dark"?"bg-purple-900/30 text-purple-300 border border-purple-800":"bg-purple-50 text-purple-600 border border-purple-200"}`,children:[s.jsx(Hw,{size:12}),s.jsx("span",{children:mt?"":""})]}):null})(),s.jsxs("div",{className:"flex items-start gap-2 mb-1 flex-1 h-full min-h-0",children:[s.jsx("textarea",{className:`flex-1 h-full bg-transparent text-xs outline-none resize-none custom-scrollbar ${e==="dark"?"text-zinc-300 placeholder-zinc-600":"text-zinc-800 placeholder-zinc-400"}`,placeholder:"...",value:n.type==="gen-image"?((ct=n.settings)==null?void 0:ct.prompt)||"":((jt=n.settings)==null?void 0:jt.videoPrompt)||"",onChange:ie=>Le(n.id,n.type==="gen-image"?{prompt:ie.target.value}:{videoPrompt:ie.target.value}),onMouseDown:ie=>ie.stopPropagation()}),n.type==="gen-video"&&(((wt=n.settings)==null?void 0:wt.model)==="sora-2"||((Et=n.settings)==null?void 0:Et.model)==="sora-2-pro")&&br.length>0&&s.jsx("div",{className:"relative shrink-0",children:s.jsx("button",{onClick:ie=>{ie.stopPropagation(),$l(!0)},className:`p-1.5 rounded transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:"",children:s.jsx(Lp,{size:14})})})]})]}),n.type==="gen-video"&&(()=>{var at,On;const ie=((at=n.settings)==null?void 0:at.model)||"",ge=Ht(ie),Je=(ge==null?void 0:ge.modelName)||(ge==null?void 0:ge.id)||ie;if(!(Je&&(Je.includes("sora")||ie.includes("sora")))||br.length===0)return null;const et=((On=n.settings)==null?void 0:On.videoPrompt)||"",Ae=fx[n.id]||!1,zt=5,ln=br.length>zt;return s.jsx("div",{className:"border-t border-dashed mt-1",style:{borderColor:e==="dark"?"rgba(63, 63, 70, 0.5)":"rgba(161, 161, 170, 0.5)"},children:s.jsxs("div",{className:"flex items-center justify-between py-1 px-1",children:[s.jsx("div",{className:"flex gap-2 overflow-x-auto py-2 flex-1 custom-scrollbar",children:(Ae?br:br.slice(0,zt)).map(Bn=>{const An=`@${Bn.username}`,xn=et.includes(An);return s.jsxs("button",{onClick:lt=>{lt.stopPropagation();let Dt=et||"";xn?Dt=Dt.replace(An,"").replace(/\s{2,}/g," ").trim():(Dt=Dt.trim(),Dt=Dt?`${Dt} ${An} `:`${An} `),Le(n.id,{videoPrompt:Dt})},className:`relative shrink-0 transition-all ${xn?"scale-110":"opacity-70 hover:opacity-100"}`,title:Bn.username,children:[s.jsx(mr,{src:Bn.localCacheUrl||Bn.profile_picture_url||"",alt:Bn.username,className:`w-8 h-8 rounded-full object-cover border-2 ${xn?"border-blue-500 ring-2 ring-blue-500":"border-transparent"}`,onError:lt=>{lt.target.style.display="none"}}),s.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 bg-black/50 rounded-full p-0.5",children:s.jsx(Id,{size:8,className:"text-green-400"})})]},Bn.id)})}),ln&&s.jsx("button",{onClick:Bn=>{Bn.stopPropagation(),Ae?Ou(An=>{const xn={...An};return delete xn[n.id],xn}):($l(!0),Ou(An=>({...An,[n.id]:!0})))},className:`shrink-0 px-2 py-1 text-[10px] rounded transition-colors ml-2 ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,title:Ae?"":"",children:Ae?"":`+${br.length-zt}`})]})})})(),n.type==="gen-video"&&(()=>{var Ae,zt,ln;const ie=Ht((Ae=n.settings)==null?void 0:Ae.model),ge=!!(ie!=null&&ie.supportsFirstLastFrame),Je=!!((zt=n.settings)!=null&&zt.useFirstLastFrame||(ln=n.settings)!=null&&ln.veoFramesMode);if(!ge||!Je)return null;const mt=ta(n.id,"veo_start"),et=ta(n.id,"veo_end");return s.jsxs("div",{className:`mb-2 rounded-lg border p-3 space-y-2 ${e==="dark"?"bg-zinc-900/40 border-emerald-500/20":"bg-emerald-50 border-emerald-200"}`,onMouseDown:at=>at.stopPropagation(),children:[s.jsx("div",{className:`text-[11px] font-semibold ${e==="dark"?"text-zinc-200":"text-zinc-700"}`,children:""}),s.jsx("div",{className:"text-[10px] text-zinc-500",children:" 2 "}),s.jsxs("div",{className:"relative flex items-center gap-2",children:[s.jsx("div",{className:`input-point ${mt?"connected":""} ${Ln===n.id&&Ds==="veo_start"?"active":""}`,title:"",onMouseDown:at=>{at.stopPropagation(),at.preventDefault();const On=Pn(at.clientX,at.clientY);Qs(On),Rs(n.id),Ls("veo_start")},onMouseUp:at=>si(n.id,at,"veo_start"),"data-input-type":"veo_start",style:{position:"absolute",top:"50%",left:"0",transform:"translateY(-50%)",width:"0.5rem",height:"0.5rem",zIndex:20,cursor:"crosshair"}}),s.jsxs("div",{className:"flex items-center justify-between flex-1 ml-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:""}),mt&&s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]}),mt?s.jsx("div",{className:"w-8 h-8 rounded overflow-hidden border border-zinc-700/40",children:s.jsx(mr,{src:mt,className:"w-full h-full object-cover"})}):s.jsx("span",{className:`text-[10px] ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:""})]})]}),s.jsxs("div",{className:"relative flex items-center gap-2",children:[s.jsx("div",{className:`input-point ${et?"connected":""} ${Ln===n.id&&Ds==="veo_end"?"active":""}`,title:"",onMouseDown:at=>{at.stopPropagation(),at.preventDefault();const On=Pn(at.clientX,at.clientY);Qs(On),Rs(n.id),Ls("veo_end")},onMouseUp:at=>si(n.id,at,"veo_end"),"data-input-type":"veo_end",style:{position:"absolute",top:"50%",left:"0",transform:"translateY(-50%)",width:"0.5rem",height:"0.5rem",zIndex:20,cursor:"crosshair"}}),s.jsxs("div",{className:"flex items-center justify-between flex-1 ml-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:""}),et&&s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]}),et?s.jsx("div",{className:"w-8 h-8 rounded overflow-hidden border border-zinc-700/40",children:s.jsx(mr,{src:et,className:"w-full h-full object-cover"})}):s.jsx("span",{className:`text-[10px] ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:""})]})]})]})})(),n.type==="gen-image"&&(()=>{var Je;const ie=Ht((Je=n.settings)==null?void 0:Je.model);return ie&&(ie.id.includes("mj")||ie.provider.toLowerCase().includes("midjourney"))})()&&(()=>{var Je,mt;const ie=ta(n.id,"oref"),ge=ta(n.id,"sref");return s.jsxs("div",{className:"flex flex-col gap-1.5 mb-2 relative","data-mj-instructions":"true",children:[s.jsxs("div",{className:"relative flex items-center gap-1.5","data-mj-oref":"true",children:[s.jsx("div",{className:`input-point ${ie?"connected":""} ${Ln===n.id&&Ds==="oref"?"active":""}`,title:"oref",onMouseDown:et=>{et.stopPropagation(),et.preventDefault();const Ae=Pn(et.clientX,et.clientY);Qs(Ae),Rs(n.id),Ls("oref")},onMouseUp:et=>si(n.id,et,"oref"),"data-input-type":"oref",style:{position:"absolute",top:"50%",left:"-0.25rem",transform:"translateY(-50%)",width:"0.5rem",height:"0.5rem",marginRight:"0.25rem",zIndex:20,cursor:"crosshair"}}),s.jsxs("div",{className:"flex items-center gap-1.5 flex-1 ml-2",children:[s.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:"oref"}),ie&&s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]})]}),s.jsxs("div",{className:"relative flex items-center gap-1.5",children:[s.jsx("div",{className:"w-0.5rem h-0.5rem mr-0.25rem ml-2"}),s.jsxs("div",{className:"flex items-center gap-1.5 flex-1",children:[s.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:"ow"}),((Je=n.settings)==null?void 0:Je.mjOw)&&n.settings.mjOw>0&&s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]}),s.jsx("input",{type:"number",min:"1",max:"1000",placeholder:"1-1000",value:((mt=n.settings)==null?void 0:mt.mjOw)||"",onChange:et=>{const Ae=parseInt(et.target.value,10);isNaN(Ae)||Ae<1?Le(n.id,{mjOw:""}):Ae>1e3?Le(n.id,{mjOw:1e3}):Le(n.id,{mjOw:Ae})},onMouseDown:et=>et.stopPropagation(),className:`flex-1 px-2 py-1 rounded text-[10px] border outline-none focus:border-blue-500/50 ${e==="dark"?"bg-zinc-900/50 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`})]}),s.jsxs("div",{className:"relative flex items-center gap-1.5","data-mj-sref":"true",children:[s.jsx("div",{className:`input-point ${ge?"connected":""} ${Ln===n.id&&Ds==="sref"?"active":""}`,title:"sref",onMouseDown:et=>{et.stopPropagation(),et.preventDefault();const Ae=Pn(et.clientX,et.clientY);Qs(Ae),Rs(n.id),Ls("sref")},onMouseUp:et=>si(n.id,et,"sref"),"data-input-type":"sref",style:{position:"absolute",top:"50%",left:"-0.25rem",transform:"translateY(-50%)",width:"0.5rem",height:"0.5rem",marginRight:"0.25rem",zIndex:20,cursor:"crosshair"}}),s.jsxs("div",{className:"flex items-center gap-1.5 flex-1 ml-2",children:[s.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:"sref"}),ge&&s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]})]})]})})(),n.type==="gen-image"&&j&&s.jsxs("div",{className:`mb-2 rounded-lg border p-3 space-y-2 ${e==="dark"?"bg-zinc-900/50 border-zinc-800":"bg-white border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("button",{className:"flex items-center gap-1 text-[11px] font-semibold",onClick:()=>tz(ie=>!ie),onMouseDown:ie=>ie.stopPropagation(),children:[s.jsx("span",{className:e==="dark"?"text-zinc-200":"text-zinc-700",children:""}),s.jsx(sl,{size:12,className:`transition-transform ${Jg?"":"rotate-90"} ${e==="dark"?"text-zinc-400":"text-zinc-500"}`})]}),s.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[s.jsxs("span",{className:"text-zinc-500",children:[Lc.length," "]}),s.jsx("button",{className:`px-2 py-0.5 rounded text-[10px] border ${e==="dark"?"border-zinc-700 text-zinc-300 hover:bg-zinc-800":"border-zinc-300 text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>nz(ie=>!ie),onMouseDown:ie=>ie.stopPropagation(),children:r0?"":""})]})]}),!Jg&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"max-h-36 overflow-y-auto custom-scrollbar flex flex-wrap gap-2",children:[Lc.map(ie=>s.jsxs("div",{className:`border rounded-lg px-2 py-1.5 flex items-center gap-2 text-[11px] ${e==="dark"?"border-zinc-700 bg-zinc-950/50 text-zinc-200":"border-zinc-200 bg-zinc-50 text-zinc-700"}`,children:[s.jsx("span",{className:"font-medium whitespace-nowrap",children:ie.name}),s.jsx("button",{onClick:()=>Ck(n.id,ie.prompt),className:"px-2 py-0.5 rounded text-[10px] bg-blue-600 text-white hover:bg-blue-500 transition-colors",onMouseDown:ge=>ge.stopPropagation(),children:""}),r0&&s.jsx("button",{onClick:()=>Sk(ie.id),className:`px-2 py-0.5 rounded text-[10px] border ${e==="dark"?"border-red-500/50 text-red-400 hover:bg-red-500/10":"border-red-200 text-red-600 hover:bg-red-50"}`,onMouseDown:ge=>ge.stopPropagation(),children:""})]},ie.id)),Lc.length===0&&s.jsx("div",{className:`text-[11px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:""})]}),r0&&s.jsxs("div",{className:"grid grid-cols-1 gap-1.5",children:[s.jsx("input",{type:"text",value:$u.name,onChange:ie=>n0(ge=>({...ge,name:ie.target.value})),placeholder:"",className:`w-full px-2 py-1 text-[11px] rounded border ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 placeholder:text-zinc-600":"bg-white border-zinc-300 text-zinc-800 placeholder:text-zinc-400"}`,onMouseDown:ie=>ie.stopPropagation()}),s.jsx("textarea",{value:$u.prompt,onChange:ie=>n0(ge=>({...ge,prompt:ie.target.value})),placeholder:"...",className:`w-full min-h-[70px] px-2 py-1 text-[11px] rounded border resize-none custom-scrollbar ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 placeholder:text-zinc-600":"bg-white border-zinc-300 text-zinc-800 placeholder:text-zinc-400"}`,onMouseDown:ie=>ie.stopPropagation()}),s.jsx("button",{onClick:_k,className:"w-full py-1.5 rounded text-[11px] font-medium bg-blue-600 hover:bg-blue-500 text-white transition-colors",onMouseDown:ie=>ie.stopPropagation(),children:""})]})]})]}),(()=>{var ge,Je;const ie=Ix((ge=n.settings)==null?void 0:ge.model,(Je=n.settings)==null?void 0:Je.customParams,mt=>Le(n.id,{customParams:mt}));return ie?s.jsx("div",{className:"mb-2",children:ie}):null})(),s.jsxs("div",{className:`mt-auto pt-2 flex items-center justify-between shrink-0 relative gap-2 border-t ${e==="dark"?"border-zinc-800/50":"border-zinc-200"}`,children:[s.jsxs("div",{className:"relative flex-1 min-w-0",children:[s.jsxs("button",{title:(yt=Ht((xt=n.settings)==null?void 0:xt.model))==null?void 0:yt.provider,onClick:ie=>{ie.stopPropagation(),wn((Me==null?void 0:Me.type)==="model"?null:{nodeId:n.id,type:"model"})},className:`flex items-center gap-2 pl-1 pr-2 py-1 rounded text-[10px] transition-colors border w-full ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-300 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-700 border-zinc-300"}`,children:[s.jsx("span",{className:`w-2 h-2 rounded-full ${Pi(Ut((pt=n.settings)==null?void 0:pt.model))}`}),s.jsx("span",{className:"truncate font-mono",children:((hn=Ht((St=n.settings)==null?void 0:St.model))==null?void 0:hn.id)||"Model"})]}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="model"&&s.jsxs("div",{className:`absolute bottom-full left-0 mb-1 w-96 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:ie=>ie.stopPropagation(),onMouseLeave:()=>Dr(null),children:[s.jsx("div",{className:`w-36 border-r pr-1 max-h-64 overflow-y-auto custom-scrollbar flex flex-col justify-end ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(Zr).filter(([,ie])=>ie.models.some(ge=>n.type==="gen-image"?ns(ge.type):ge.type==="Video")).map(([ie,ge])=>s.jsxs("button",{onMouseEnter:()=>Dr(ie),className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left text-[10px] transition-colors ${er===ie?e==="dark"?"bg-zinc-700 text-zinc-100":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-200 text-zinc-900":e==="dark"?"hover:bg-zinc-800 text-zinc-400":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-600"}`,children:[s.jsx("span",{className:"truncate font-medium",children:ge.name}),s.jsx(sl,{size:10,className:"opacity-50"})]},ie))}),s.jsxs("div",{className:"flex-1 pl-1 max-h-64 overflow-y-auto custom-scrollbar flex flex-col justify-end",children:[er&&((It=Zr[er])==null?void 0:It.models.filter(ie=>n.type==="gen-image"?ns(ie.type):ie.type==="Video").map(ie=>{var mt;const ge=ie._uid||ie.id,Je=Ut((mt=n.settings)==null?void 0:mt.model);return s.jsxs("button",{onClick:()=>{const et={model:ge};if(ie.id==="grok-3"&&(et.ratio="3:2",et.duration="8s",et.resolution="1080P"),Le(n.id,et),n.type==="gen-image"){k0(ge);try{localStorage.setItem("tapnow_last_image_model",ge)}catch{}}else if(n.type==="gen-video"){j0(ge);try{localStorage.setItem("tapnow_last_video_model",ge)}catch{}}wn(null),Dr(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${Je===ge?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[s.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:ie.id}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(ge)}`})]},ge)})),!er&&s.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]}),n.type==="gen-image"&&(()=>{var ge;const ie=Ht((ge=n.settings)==null?void 0:ge.model);return ie&&(ie.id.includes("mj")||ie.provider.toLowerCase().includes("midjourney"))})()&&s.jsxs("div",{className:"relative flex-1 min-w-0",children:[s.jsx("button",{title:((an=Rh.find(ie=>{var ge;return ie.value===((ge=n.settings)==null?void 0:ge.mjVersion)}))==null?void 0:an.label)||"MJ V7",onClick:ie=>{ie.stopPropagation(),wn((Me==null?void 0:Me.type)==="mjVersion"&&Me.nodeId===n.id?null:{nodeId:n.id,type:"mjVersion"})},className:`flex items-center gap-2 pl-1 pr-2 py-1 rounded text-[10px] transition-colors border w-full ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-300 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-700 border-zinc-300"}`,children:s.jsx("span",{className:"truncate",children:((Bt=Rh.find(ie=>{var ge;return ie.value===((ge=n.settings)==null?void 0:ge.mjVersion)}))==null?void 0:Bt.label)||"MJ V7"})}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="mjVersion"&&s.jsx("div",{className:`absolute bottom-full left-0 mb-1 w-32 rounded-lg shadow-xl p-1 z-[60] border max-h-64 overflow-y-auto custom-scrollbar ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:ie=>ie.stopPropagation(),children:Rh.map(ie=>{var ge,Je;return s.jsxs("button",{onClick:()=>{Le(n.id,{mjVersion:ie.value}),wn(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"} ${((ge=n.settings)==null?void 0:ge.mjVersion)===ie.value?e==="dark"?"bg-zinc-800":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100":""}`,children:[s.jsx("span",{className:"text-xs font-medium",children:ie.label}),((Je=n.settings)==null?void 0:Je.mjVersion)===ie.value&&s.jsx("svg",{className:"w-3 h-3 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},ie.value)})})]}),s.jsxs("div",{className:"flex gap-1 shrink-0",children:[s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:ie=>{ie.stopPropagation(),wn((Me==null?void 0:Me.type)==="ratio"&&Me.nodeId===n.id?null:{nodeId:n.id,type:"ratio"})},className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-600 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,children:(()=>{var Je,mt;const ie=((Je=n.settings)==null?void 0:Je.ratio)||"Auto",ge=Ht((mt=n.settings)==null?void 0:mt.model);return ie==="Auto"?"Auto":Lr(ie,!!(ge!=null&&ge.ratioNotesEnabled),(ge==null?void 0:ge.ratioNotes)||{})})()}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="ratio"&&s.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-20 rounded-lg shadow-xl p-1 z-[60] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:ie=>ie.stopPropagation(),children:$0((Sr=n.settings)==null?void 0:Sr.model).map(ie=>{var mt;const ge=Ht((mt=n.settings)==null?void 0:mt.model),Je=ie==="Auto"?"Auto":Lr(ie,!!(ge!=null&&ge.ratioNotesEnabled),(ge==null?void 0:ge.ratioNotes)||{});return s.jsx("button",{onClick:()=>{Le(n.id,{ratio:ie}),wz(ie);try{localStorage.setItem("tapnow_last_ratio",ie)}catch{}wn(null)},className:`w-full text-center py-1 text-[10px] rounded ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":e==="solarized"?"text-zinc-700 hover:bg-[#fdf6e3]":"text-zinc-700 hover:bg-zinc-100"}`,children:Je},ie)})})]}),n.type==="gen-video"&&(()=>{var zt,ln;const ie=Ht((zt=n.settings)==null?void 0:zt.model),ge=(ie==null?void 0:ie.id)||(ie==null?void 0:ie.modelName)||"",Je=T0(ge);if(!Je.length)return null;const mt=zo(((ln=n.settings)==null?void 0:ln.resolution)||Ua||"720P"),et=Je.find(at=>at!=="Auto")||"720P",Ae=Je.includes(mt)?mt:et;return Ae!==mt&&setTimeout(()=>{Le(n.id,{resolution:Ae})},0),s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:at=>{at.stopPropagation(),wn((Me==null?void 0:Me.type)==="vres"&&Me.nodeId===n.id?null:{nodeId:n.id,type:"vres"})},className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-600 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,children:Ae==="Auto"?"":Lr(Ae,!!(ie!=null&&ie.videoResolutionNotesEnabled),(ie==null?void 0:ie.videoResolutionNotes)||{})}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="vres"&&s.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-24 rounded-lg shadow-xl p-1 z-[60] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:at=>at.stopPropagation(),children:Je.map(at=>s.jsx("button",{onClick:()=>{if(Le(n.id,{resolution:at}),at!=="Auto"){xx(at);try{localStorage.setItem("tapnow_last_video_res",at)}catch{}}wn(null)},className:`w-full text-center py-1 text-[10px] rounded ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":e==="solarized"?"text-zinc-700 hover:bg-[#fdf6e3]":"text-zinc-700 hover:bg-zinc-100"}`,children:at==="Auto"?"":Lr(at,!!(ie!=null&&ie.videoResolutionNotesEnabled),(ie==null?void 0:ie.videoResolutionNotes)||{})},at))})]})})(),n.type==="gen-image"&&(()=>{var Je;const ie=Ht((Je=n.settings)==null?void 0:Je.model);return!(ie&&(ie.id.includes("mj")||ie.provider.toLowerCase().includes("midjourney")))})()?s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:ie=>{ie.stopPropagation(),wn((Me==null?void 0:Me.type)==="res"&&Me.nodeId===n.id?null:{nodeId:n.id,type:"res"})},className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-600 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,children:(()=>{var ln,at;const ie=Ht((ln=n.settings)==null?void 0:ln.model),ge=(ie==null?void 0:ie.id)||(ie==null?void 0:ie.modelName)||"",Je=M0(ge),mt=((at=n.settings)==null?void 0:at.resolution)||"2K",et=Md(mt),Ae=Je.includes(et)?et:Je[0]||"2K",zt=Lr(Ae,!!(ie!=null&&ie.resolutionNotesEnabled),(ie==null?void 0:ie.resolutionNotes)||{});return mt!==et&&Je.includes(et)?setTimeout(()=>{Le(n.id,{resolution:et})},0):!Je.includes(et)&&Je.length>0&&setTimeout(()=>{Le(n.id,{resolution:Je[0]})},0),zt})()}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="res"&&(()=>{var mt;const ie=Ht((mt=n.settings)==null?void 0:mt.model),ge=(ie==null?void 0:ie.id)||(ie==null?void 0:ie.modelName)||"",Je=M0(ge);return s.jsx("div",{className:`absolute bottom-full right-0 mb-1 w-24 rounded-lg shadow-xl p-1 z-[60] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:et=>et.stopPropagation(),children:Je.map(et=>s.jsx("button",{onClick:()=>{Le(n.id,{resolution:et}),zz(et);try{localStorage.setItem("tapnow_last_image_res",et)}catch{}wn(null)},className:`w-full text-center py-1 text-[10px] rounded ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":e==="solarized"?"text-zinc-700 hover:bg-[#fdf6e3]":"text-zinc-700 hover:bg-zinc-100"}`,children:Lr(et,!!(ie!=null&&ie.resolutionNotesEnabled),(ie==null?void 0:ie.resolutionNotes)||{})},et))})})()]}):(()=>{var Ae,zt,ln,at,On,Bn,An;const ie=Ht((Ae=n.settings)==null?void 0:Ae.model),ge=ie&&(ie.id.includes("mj")||ie.provider.toLowerCase().includes("midjourney")),Je=ld((zt=n.settings)==null?void 0:zt.model),mt=(ln=n.settings)==null?void 0:ln.duration,et=Je.includes(mt)?mt:Je[0]||"5s";return(!mt||!Je.includes(mt))&&setTimeout(()=>{Le(n.id,{duration:Je[0]||"5s"})},0),ge?null:s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:xn=>{xn.stopPropagation(),wn((Me==null?void 0:Me.type)==="duration"&&Me.nodeId===n.id?null:{nodeId:n.id,type:"duration"})},className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,children:Lr(et,!!(ie!=null&&ie.durationNotesEnabled),(ie==null?void 0:ie.durationNotes)||{})}),(Me==null?void 0:Me.nodeId)===n.id&&Me.type==="duration"&&s.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-20 rounded-lg shadow-xl p-1 z-[60] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:xn=>xn.stopPropagation(),children:(Je.length>0?Je:["5s","10s"]).map(xn=>s.jsx("button",{onClick:()=>{Le(n.id,{duration:xn}),wn(null)},className:`w-full text-center py-1 text-[10px] rounded ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":e==="solarized"?"text-zinc-700 hover:bg-[#fdf6e3]":"text-zinc-700 hover:bg-zinc-100"}`,children:Lr(xn,!!(ie!=null&&ie.durationNotesEnabled),(ie==null?void 0:ie.durationNotes)||{})},xn))})]}),n.type==="gen-video"&&(ie==null?void 0:ie.supportsHD)&&s.jsxs("label",{className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border cursor-pointer transition-colors ${e==="dark"?(at=n.settings)!=null&&at.isHD?"bg-blue-600/30 border-blue-500 text-blue-300":"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?(On=n.settings)!=null&&On.isHD?"bg-[#eee8d5] border-[#d7cfb2] text-zinc-800":"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":(Bn=n.settings)!=null&&Bn.isHD?"bg-blue-500/30 border-blue-400 text-blue-700":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,onClick:xn=>xn.stopPropagation(),children:[s.jsx("input",{type:"checkbox",checked:((An=n.settings)==null?void 0:An.isHD)||!1,onChange:xn=>{xn.stopPropagation(),Le(n.id,{isHD:xn.target.checked})},className:"w-3 h-3 cursor-pointer",onMouseDown:xn=>xn.stopPropagation()}),s.jsx("span",{children:"HD"})]}),n.type==="gen-video"&&(()=>{var Dt,zn;const xn=!!(ie!=null&&ie.supportsFirstLastFrame),lt=!!((Dt=n.settings)!=null&&Dt.useFirstLastFrame||(zn=n.settings)!=null&&zn.veoFramesMode);return xn?s.jsxs("label",{className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border cursor-pointer transition-colors ${e==="dark"?lt?"bg-emerald-600/25 border-emerald-500 text-emerald-200":"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?lt?"bg-[#eee8d5] border-[#d7cfb2] text-zinc-800":"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":lt?"bg-emerald-500/20 border-emerald-300 text-emerald-700":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,onClick:U=>U.stopPropagation(),children:[s.jsx("input",{type:"checkbox",checked:lt,onChange:U=>{U.stopPropagation(),Le(n.id,{useFirstLastFrame:U.target.checked,veoFramesMode:U.target.checked})},className:"w-3 h-3 cursor-pointer",onMouseDown:U=>U.stopPropagation()}),s.jsx("span",{children:""})]}):null})()]})})()]}),s.jsx("button",{onClick:()=>{var mt,et,Ae;const ie=n.type==="gen-image"?((mt=n.settings)==null?void 0:mt.prompt)||"":((et=n.settings)==null?void 0:et.videoPrompt)||"",ge=id(n.id),Je=ge.length>0?ge.join(" ")+(ie?" "+ie:""):ie;Va(Je,n.type==="gen-image"?"image":"video",p,n.id,{customParams:(Ae=n.settings)==null?void 0:Ae.customParams})},className:"bg-blue-600 hover:bg-blue-500 text-white p-1.5 rounded-md shadow-lg active:scale-95 transition-transform shrink-0",title:"",children:s.jsx(Zy,{size:12,fill:"currentColor"})})]})]})})()]})]},n.id)},[Ce,Hn,Cl,db,pb,qo,Dx,e,Xt,As,xr,Ln,Ds,E0,si,Pn,Fc,xe,Hr,wn,Fo,Sl,Rs,Ls,Mu,cr,Qt,Le,id,Va,Ya,ld,yk,sd,Dz,Ha,H0,Bc]),Qk=d.length>50||Xs!=="off",e2=s0||Nl;return s.jsxs(s.Fragment,{children:[s.jsx(o_,{visible:wl.visible,progress:wl.progress,status:wl.status,type:wl.type}),s.jsxs("div",{className:`w-full h-screen font-sans overflow-hidden select-none flex flex-col transition-colors duration-300 ${e==="dark"?"bg-[#09090b] text-white":e==="solarized"?"bg-[#fdf6e3] text-[#586e75]":"bg-zinc-100 text-zinc-900"} ${Qk?"perf-mode":""} ${e2?"interacting":""}`,onClick:()=>{ks.visible&&gi(n=>({...n,visible:!1})),u0&&Mi(!1),Wo.visible&&h0(n=>({...n,visible:!1}))},children:[s.jsxs("div",{className:`h-12 flex items-center justify-between px-4 z-50 shrink-0 border-b transition-colors duration-300 ${e==="dark"?"bg-[#09090b] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-7 h-7 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-md flex items-center justify-center",children:s.jsx(Ih,{size:16,className:"text-white"})}),s.jsx("span",{className:`font-bold text-sm tracking-wide ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,children:"Tapnow Studio"}),e0?s.jsx("input",{ref:co,type:"text",value:kr,onChange:n=>Tc(n.target.value),onBlur:()=>{jr(!1);try{localStorage.setItem("tapnow_project_name",kr)}catch{}},onKeyDown:n=>{if(n.key==="Enter"){jr(!1);try{localStorage.setItem("tapnow_project_name",kr)}catch{}}},className:`ml-2 px-2 py-0.5 text-xs border rounded outline-none ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,style:{minWidth:"100px",maxWidth:"200px"}}):s.jsx("span",{onClick:()=>{jr(!0),setTimeout(()=>{var n;return(n=co.current)==null?void 0:n.focus()},0)},className:`ml-2 text-xs cursor-pointer hover:underline ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,title:"",children:kr})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("button",{onClick:()=>{const n=["off","normal","ultra"],l=(n.indexOf(Xs)+1)%n.length,u=n[l];t0(u)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${Xs!=="off"?e==="dark"?"bg-blue-600 border-blue-500 text-white hover:bg-blue-500":e==="solarized"?"bg-blue-600 border-blue-500 text-[#fdf6e3] hover:bg-blue-500":"bg-blue-500 border-blue-400 text-white hover:bg-blue-600":e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:Xs==="ultra"?"":Xs==="normal"?"":"",children:[s.jsx(Up,{size:14,className:Xs!=="off"?"fill-current":""}),s.jsx("span",{children:Xs==="ultra"?"":""})]}),s.jsxs("button",{onClick:lk,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:"/",children:[s.jsx(Qa,{size:14}),s.jsx("span",{children:""})]}),s.jsx("button",{onClick:ok,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:"",children:e==="light"?s.jsxs(s.Fragment,{children:[s.jsx(tv,{size:14,className:"text-amber-400"}),s.jsx("span",{children:""})]}):e==="solarized"?s.jsxs(s.Fragment,{children:[s.jsx(tv,{size:14,className:"text-yellow-600"}),s.jsx("span",{children:""})]}):s.jsxs(s.Fragment,{children:[s.jsx(W5,{size:14,className:"text-blue-500"}),s.jsx("span",{children:""})]})}),s.jsx("button",{onClick:lr,disabled:I.length===0,className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors border ${I.length===0?e==="dark"?"bg-zinc-900/50 border-zinc-800 text-zinc-600 cursor-not-allowed":e==="solarized"?"bg-[#616161]/60 border-[#525252] text-[#fdf6e3]/60 cursor-not-allowed":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-400 cursor-not-allowed":"bg-zinc-50 border-zinc-200 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:" (Ctrl+Z)",children:s.jsx(G5,{size:14})}),s.jsx("button",{onClick:Zn,disabled:P.length===0,className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors border ${P.length===0?e==="dark"?"bg-zinc-900/50 border-zinc-800 text-zinc-600 cursor-not-allowed":e==="solarized"?"bg-[#616161]/60 border-[#525252] text-[#fdf6e3]/60 cursor-not-allowed":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-400 cursor-not-allowed":"bg-zinc-50 border-zinc-200 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:" (Ctrl+Shift+Z)",children:s.jsx(X5,{size:14})}),s.jsx(Vp,{variant:"ghost",onClick:()=>{ae(),f([]),z([]),Tc(""),localStorage.removeItem("tapnow_project_name")},className:e==="solarized"?"!bg-[#616161] !border !border-[#525252] !text-[#fdf6e3] hover:!bg-[#555555]":"",children:""}),s.jsx(Vp,{variant:"secondary",icon:Z5,onClick:()=>ei(!0),className:e==="solarized"?"!bg-[#616161] !border-[#525252] !text-[#fdf6e3] hover:!bg-[#555555]":"",children:"API "})]})]}),s.jsxs("div",{className:`flex-1 relative overflow-hidden flex transition-colors duration-300 ${e==="dark"?"bg-[#09090b]":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:[s.jsxs("div",{className:`w-14 border-r flex flex-col items-center py-3 gap-3 z-40 shrink-0 transition-colors duration-300 ${e==="dark"?"bg-[#09090b] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,children:[s.jsx("button",{onClick:Ik,className:`p-2.5 rounded-lg transition-all mb-2 ${e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-800 hover:bg-zinc-200"}`,title:"",children:s.jsx(K5,{size:18})}),[{id:"select",icon:V5},{id:"history",icon:Jy},{id:"characters",icon:Lp}].map(n=>s.jsx("button",{onClick:()=>{bz(n.id),n.id==="history"&&Au(!Pu),n.id==="characters"&&$l(!cx)},className:`p-2.5 rounded-lg transition-all ${xz===n.id?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#616161] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-200 text-zinc-900":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-800"}`,children:s.jsx(n.icon,{size:18})},n.id)),s.jsx("div",{className:"flex-1"}),s.jsx("button",{onClick:()=>Yi(!Dc),className:`p-2.5 rounded-lg transition-all mb-2 ${Dc?e==="solarized"?"bg-[#616161] text-[#fdf6e3] hover:bg-[#555555]":"bg-blue-600 text-white":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-800"}`,title:"AI ",children:s.jsx(Ql,{size:18})}),s.jsx("button",{onClick:ck,className:`p-2.5 rounded-lg transition-all ${e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-800 hover:bg-zinc-200"}`,title:"",children:s.jsx(qy,{size:18})}),s.jsx("button",{onClick:pk,className:`p-2.5 rounded-lg transition-all mb-2 ${e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-800 hover:bg-zinc-200"}`,title:"",children:s.jsx(ua,{size:18})}),s.jsx("button",{onClick:uk,className:`p-2.5 rounded-lg transition-all mb-2 ${e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-800 hover:bg-zinc-200"}`,title:"",children:s.jsx(Qa,{size:18})})]}),Pu&&s.jsxs("div",{className:`w-72 z-30 flex flex-col animate-in slide-in-from-left border-r transition-colors duration-300 ${e==="dark"?"bg-[#121214] border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[s.jsxs("div",{className:`p-3 border-b flex justify-between items-center ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("h3",{className:`font-bold text-xs leading-tight ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[s.jsx("span",{className:"block",children:""}),s.jsx("span",{className:"block",children:""})]}),Lo.active&&s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("div",{className:"w-16 h-1.5 bg-zinc-700 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-blue-500 transition-all duration-200",style:{width:`${Lo.current/Lo.total*100}%`}})}),s.jsxs("span",{className:"text-[9px] text-zinc-500 font-mono",children:[Lo.current,"/",Lo.total]})]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>{const n=["off","normal","ultra"],l=(n.indexOf(Nr)+1)%n.length;Pc(n[l])},className:`p-1.5 rounded transition-colors flex items-center gap-1 ${Nr==="ultra"?e==="dark"?"text-orange-400 bg-orange-500/20 hover:bg-orange-500/30":"text-orange-600 bg-orange-100 hover:bg-orange-200":Nr==="normal"?e==="dark"?"text-green-400 bg-green-500/20 hover:bg-green-500/30":"text-green-600 bg-green-100 hover:bg-green-200":e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:Nr==="ultra"?"":Nr==="normal"?"":"",children:s.jsx(Up,{size:14})}),s.jsx("button",{onClick:()=>fz(n=>!n),className:`p-1.5 rounded transition-colors ${ax?e==="dark"?"text-blue-400 bg-blue-500/20 hover:bg-blue-500/30":"text-blue-600 bg-blue-100 hover:bg-blue-200":e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:"",children:s.jsx(ua,{size:14})}),s.jsx("button",{onClick:()=>hz(n=>!n),className:`p-1.5 rounded transition-colors ${lx?e==="dark"?"text-blue-400 bg-blue-500/20 hover:bg-blue-500/30":"text-blue-600 bg-blue-100 hover:bg-blue-200":e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:"",children:s.jsx(Ih,{size:14})}),s.jsxs("button",{onClick:()=>{const o=kt.filter(l=>l.status==="completed");zs.size>0?_u(new Set):_u(new Set(o.map(l=>l.id)))},className:`p-1.5 rounded transition-colors flex items-center gap-1 ${zs.size>0?e==="dark"?"text-blue-400 bg-blue-500/20 hover:bg-blue-500/30":"text-blue-600 bg-blue-100 hover:bg-blue-200":e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:zs.size>0?` (${zs.size})`:"",children:[zs.size>0?s.jsx(Od,{size:14}):s.jsx(L5,{size:14}),zs.size>0&&s.jsx("span",{className:"text-[9px] font-bold",children:zs.size})]}),s.jsx("button",{onClick:()=>Uu(!0),className:`p-1.5 rounded transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:"",children:s.jsx(Dp,{size:14})}),s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>{if(zs.size>0){const n=[...zs].map(o=>kt.find(l=>l.id===o)).filter(Boolean);W0(n)}else wn((Me==null?void 0:Me.type)==="batch-download"?null:{type:"batch-download"})},className:`p-1.5 rounded transition-colors ${zs.size>0?"text-blue-400 bg-blue-500/20":e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:zs.size>0?` (${zs.size})`:"",children:s.jsx(Qa,{size:14})}),(Me==null?void 0:Me.type)==="batch-download"&&zs.size===0&&s.jsxs("div",{className:`absolute right-0 top-full mt-1 w-40 rounded-lg shadow-xl py-1 z-50 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseLeave:()=>wn(null),children:[s.jsxs("button",{onClick:()=>{wn(null);const n=kt.filter(o=>(o.startTime||0)>=Ma);W0(n)},className:`w-full text-left px-3 py-2 text-xs transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,children:[" (",kt.filter(n=>(n.startTime||0)>=Ma).length,")"]}),s.jsxs("button",{onClick:()=>{wn(null),W0(kt)},className:`w-full text-left px-3 py-2 text-xs transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,children:[" (",kt.length,")"]})]})]}),s.jsx("button",{onClick:()=>Au(!1),children:s.jsx(Ws,{size:12,className:e==="dark"?"text-zinc-500":"text-zinc-400"})})]})]}),as&&Nu&&s.jsx("div",{className:`w-full border-b ${e==="dark"?"border-zinc-800":e==="solarized"?"border-[#d7cfb2]":"border-zinc-200"}`,children:s.jsxs("div",{className:`flex items-center justify-between gap-2 text-[10px] px-3 py-1.5 ${fs?e==="dark"?"bg-emerald-500/10 text-emerald-200":"bg-emerald-50 text-emerald-700":e==="dark"?"bg-red-500/10 text-red-200":"bg-red-50 text-red-600"}`,children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${fs?"bg-green-500":"bg-red-500"}`}),s.jsx("span",{children:fs?" - ":""})]}),s.jsx("button",{onClick:()=>{Ac(!1),Do(!1)},className:`p-0.5 rounded ${e==="dark"?"text-zinc-300 hover:text-white hover:bg-zinc-800/60":"text-zinc-400 hover:text-zinc-600 hover:bg-zinc-200"}`,title:"",children:s.jsx(Ws,{size:10})})]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 space-y-3",children:[lx&&s.jsxs("div",{className:`rounded-lg border p-3 space-y-3 ${e==="dark"?"bg-zinc-900/60 border-zinc-800":"bg-white border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between gap-2",children:[s.jsx("span",{className:`text-xs font-semibold ${e==="dark"?"text-zinc-200":"text-zinc-700"}`,children:""}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>D("pipeline"),className:`text-[10px] px-2 py-1 rounded ${_e==="pipeline"?e==="dark"?"bg-blue-600/30 text-blue-300":"bg-blue-100 text-blue-600":e==="dark"?"bg-zinc-800 text-zinc-400 hover:text-zinc-200":"bg-zinc-100 text-zinc-500 hover:text-zinc-700"}`,children:""}),s.jsx("button",{onClick:()=>D("parallel"),className:`text-[10px] px-2 py-1 rounded ${_e==="parallel"?e==="dark"?"bg-blue-600/30 text-blue-300":"bg-blue-100 text-blue-600":e==="dark"?"bg-zinc-800 text-zinc-400 hover:text-zinc-200":"bg-zinc-100 text-zinc-500 hover:text-zinc-700"}`,children:""})]})]}),(()=>{const n=new Map;be.forEach(p=>{n.set(p.id,{...p,queued:[],running:[]})});const o=p=>{var b;const m=At.get(p.nodeId),h=((b=m==null?void 0:m.settings)==null?void 0:b.projectTitle)||"",x=p.batchId||`legacy-${p.nodeId}`;return n.has(x)||n.set(x,{id:x,nodeId:p.nodeId,projectTitle:h,total:0,concurrency:p.batchConcurrency||1,createdAt:Date.now(),mode:p.mode,taskIndex:p.taskIndex||0,shotIds:[],queued:[],running:[]}),n.get(x)};re.forEach(p=>{const m=p.batchId&&n.has(p.batchId)?n.get(p.batchId):o(p);m&&(Array.isArray(m.queued)||(m.queued=[]),m.queued.push(p))}),gn.forEach(p=>{const m=p.batchId&&n.has(p.batchId)?n.get(p.batchId):o(p);m&&(Array.isArray(m.running)||(m.running=[]),m.running.push(p))});const l=[...n.values()].filter(p=>p.queued.length>0||p.running.length>0).sort((p,m)=>(m.createdAt||0)-(p.createdAt||0)),u=(p,m)=>{var b,v;const h=At.get(p),x=(v=(b=h==null?void 0:h.settings)==null?void 0:b.shots)==null?void 0:v.find(y=>y.id===m);return((x==null?void 0:x.description)||(x==null?void 0:x.prompt)||"").trim()};return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`text-[10px] ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:[" ",gn.length,"   ",re.length]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{re.length!==0&&confirm("")&&ut(!1)},className:`text-[10px] px-2 py-1 rounded ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:""}),s.jsx("button",{onClick:()=>{gn.length===0&&re.length===0||confirm("")&&ut(!0)},className:`text-[10px] px-2 py-1 rounded ${e==="dark"?"bg-red-900/40 text-red-300 hover:bg-red-900/60":"bg-red-50 text-red-600 hover:bg-red-100"}`,children:""})]}),l.length===0?s.jsx("div",{className:`text-xs text-center py-4 ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:""}):s.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto custom-scrollbar pr-1",children:l.map(p=>{const m=Math.max(1,p.concurrency||1),h=p.total||p.queued.length+p.running.length,x=Math.ceil(h/m),b=Math.ceil(p.queued.length/m),v=p.taskIndex?`Task ${p.taskIndex}`:"Task",y=[...p.running.map(w=>({...w,status:"running"})),...p.queued.map(w=>({...w,status:"queued"}))].sort((w,j)=>(w.batchOrder??0)-(j.batchOrder??0));return s.jsxs("div",{className:`rounded-lg border p-2 ${e==="dark"?"border-zinc-800 bg-zinc-900/60":"border-zinc-200 bg-zinc-50"}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{children:[s.jsxs("div",{className:`text-[11px] font-semibold ${e==="dark"?"text-zinc-200":"text-zinc-700"}`,children:["NODE - ",p.projectTitle,"  ",v]}),s.jsxs("div",{className:"text-[10px] mt-0.5 text-zinc-500",children:[h,"   ",m,"   ",x,"  ",b," "]})]}),p.queued.length>0&&s.jsx("button",{onClick:()=>{confirm("")&&Xe(p.id)},className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-red-300":"text-zinc-400 hover:text-red-500"}`,title:"",children:s.jsx(cs,{size:12})})]}),s.jsx("div",{className:"mt-2 space-y-1",children:y.map((w,j)=>{const R=Math.floor((w.batchOrder??0)/m)+1,C=p.taskIndex?`T${p.taskIndex}B${R}`:`B${R}`,H=u(w.nodeId,w.shotId),B=w.status==="running"?"":"";return s.jsxs("div",{className:`text-[10px] flex items-center justify-between gap-2 ${e==="dark"?"text-zinc-300":"text-zinc-600"}`,children:[s.jsxs("span",{className:"truncate",children:[C,"  ",H||`${w.sceneIndex||""}`]}),s.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[s.jsx("span",{className:w.status==="running"?"text-green-500":"text-blue-400",children:B}),s.jsx("button",{onClick:()=>{w.status==="running"?confirm("")&&Ue(w.nodeId,w.shotId):confirm("")&&ot(w.nodeId,w.shotId)},className:`p-0.5 rounded ${e==="dark"?"text-zinc-500 hover:text-red-300":"text-zinc-400 hover:text-red-500"}`,title:w.status==="running"?"":"",children:s.jsx(cs,{size:10})})]})]},`${p.id}-${w.nodeId}-${w.shotId}-${j}`)})})]},p.id)})})]})})()]}),ax&&s.jsx("div",{className:`rounded-lg border p-3 space-y-3 ${e==="dark"?"bg-zinc-900/60 border-zinc-800":"bg-white border-zinc-200"}`,children:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:Qe.imageSavePath||"",onChange:n=>{const o=ls(n.target.value);se(l=>({...l,imageSavePath:o}))},onBlur:n=>Bl({image_save_path:ls(n.target.value||"")}),onKeyDown:n=>{n.key==="Enter"&&n.currentTarget.blur()},placeholder:" history",className:`flex-1 text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`}),s.jsx("button",{onClick:()=>zx("imageSavePath","image_save_path"),className:`px-2 py-1.5 text-[10px] rounded border ${e==="dark"?"bg-zinc-800 text-zinc-300 border-zinc-700 hover:bg-zinc-700":"bg-zinc-100 text-zinc-700 border-zinc-300 hover:bg-zinc-200"}`,children:""})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"text",value:Qe.videoSavePath||"",onChange:n=>{const o=ls(n.target.value);se(l=>({...l,videoSavePath:o}))},onBlur:n=>Bl({video_save_path:ls(n.target.value||"")}),onKeyDown:n=>{n.key==="Enter"&&n.currentTarget.blur()},placeholder:" history",className:`flex-1 text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`}),s.jsx("button",{onClick:()=>zx("videoSavePath","video_save_path"),className:`px-2 py-1.5 text-[10px] rounded border ${e==="dark"?"bg-zinc-800 text-zinc-300 border-zinc-700 hover:bg-zinc-700":"bg-zinc-100 text-zinc-700 border-zinc-300 hover:bg-zinc-200"}`,children:""})]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-[10px] text-zinc-500",children:""}),s.jsx("div",{className:"text-[9px] text-zinc-500 mt-0.5",children:""})]}),s.jsx("button",{className:`w-10 h-5 rounded-full relative transition-colors ${as?"bg-green-600":e==="solarized"?"bg-zinc-300":"bg-zinc-600"}`,onClick:()=>Ac(n=>!n),children:s.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${as?"left-6":"left-1"}`})})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-[10px] text-zinc-500",children:"PNG  JPG"}),s.jsx("button",{className:`w-10 h-5 rounded-full relative transition-colors ${Qe.convertPngToJpg?"bg-green-600":e==="solarized"?"bg-zinc-300":"bg-zinc-600"} ${Qe.pilAvailable?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>{if(!Qe.pilAvailable)return;const n=!Qe.convertPngToJpg;se(o=>({...o,convertPngToJpg:n})),Bl({convert_png_to_jpg:n},{silent:!0})},disabled:!Qe.pilAvailable,children:s.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${Qe.convertPngToJpg?"left-6":"left-1"}`})})]}),!Qe.pilAvailable&&s.jsx("div",{className:"text-[9px] text-amber-400",children:"PIL PNG  JPG "}),s.jsx("button",{className:`w-full py-2 rounded text-[10px] font-medium transition-colors ${e==="dark"?"bg-orange-600/30 text-orange-200 hover:bg-orange-600/40":"bg-orange-100 text-orange-600 hover:bg-orange-200"}`,onClick:Go,children:""}),s.jsx("div",{className:"text-[9px] text-zinc-500",children:""}),s.jsx("button",{className:`w-full py-2 rounded text-[10px] font-medium transition-colors ${e==="dark"?"bg-blue-600/20 text-blue-200 hover:bg-blue-600/30":"bg-blue-50 text-blue-600 hover:bg-blue-100"}`,onClick:Cz,children:""})]})}),(()=>{const n=kt.filter(l=>(l.startTime||0)>=Ma),o=kt.filter(l=>(l.startTime||0)<Ma);return s.jsxs(s.Fragment,{children:[n.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`flex items-center gap-2 text-[10px] ${e==="dark"?"text-blue-400":"text-blue-600"}`,children:[s.jsx("div",{className:"flex-1 h-px bg-blue-500/30"}),s.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-blue-500/10 font-medium",children:[" (",n.length,")"]}),s.jsx("div",{className:"flex-1 h-px bg-blue-500/30"})]}),n.map(l=>s.jsx(iv,{item:l,theme:e,lightboxItem:Uo,performanceMode:Nr,providers:Pe,defaultProviders:Ud,localCacheActive:ir,onCacheMissing:wx,onDelete:Ux,getHistoryMeta:Ex,isSelected:zs.has(l.id),onSelect:u=>{_u(p=>{const m=new Set(p);return m.has(u)?m.delete(u):m.add(u),m})},onClick:()=>{const u=l.mjImages&&l.mjImages.length>1&&l.selectedMjImageIndex!==void 0?l.selectedMjImageIndex:0,p=l.mjImages&&l.mjImages.length>1?l.mjImages[u]:null,m=p?Vn(l,p):Vn(l);m&&cr({...l,url:m,selectedMjImageIndex:u,storyboardContext:null})},onContextMenu:u=>up(u,l),onImageClick:(u,p,m,h)=>{u.stopPropagation(),gt(v=>v.map(y=>y.id===p.id?{...y,url:m,selectedMjImageIndex:h}:y));const x=Vn(p,m),b={...p,url:x,selectedMjImageIndex:h,storyboardContext:null};cr(b)},onImageContextMenu:(u,p,m,h)=>up(u,p,m,h),onRebuildThumbnail:Ku,onRefresh:u=>{u.apiConfig&&(gt(p=>p.map(m=>m.id===u.id?{...m,status:"generating",errorMsg:null,progress:5}:m)),u.modelName.includes("veo")?ia(u.remoteTaskId,u.id,u.apiConfig.baseUrl,u.apiConfig.apiKey,u.width,u.height):Wa(u.remoteTaskId,u.id,u.apiConfig.baseUrl,u.apiConfig.apiKey,u.width,u.height,u.apiConfig.modelId||""))},Loader2:wo,Trash2:cs,RefreshCw:qd},l.id))]}),o.length>0&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`flex items-center gap-2 text-[10px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:[s.jsx("div",{className:`flex-1 h-px ${e==="dark"?"bg-zinc-700":"bg-zinc-300"}`}),s.jsxs("span",{className:"px-2 py-0.5 font-medium",children:[" (",o.length,")"]}),s.jsx("div",{className:`flex-1 h-px ${e==="dark"?"bg-zinc-700":"bg-zinc-300"}`})]}),o.map(l=>s.jsx(iv,{item:l,theme:e,lightboxItem:Uo,performanceMode:Nr,providers:Pe,defaultProviders:Ud,localCacheActive:ir,onCacheMissing:wx,onDelete:Ux,getHistoryMeta:Ex,isSelected:zs.has(l.id),onSelect:u=>{_u(p=>{const m=new Set(p);return m.has(u)?m.delete(u):m.add(u),m})},onClick:()=>{const u=l.mjImages&&l.mjImages.length>1&&l.selectedMjImageIndex!==void 0?l.selectedMjImageIndex:0,p=l.mjImages&&l.mjImages.length>1?l.mjImages[u]:null,m=p?Vn(l,p):Vn(l);m&&cr({...l,url:m,selectedMjImageIndex:u,storyboardContext:null})},onContextMenu:u=>up(u,l),onImageClick:(u,p,m,h)=>{u.stopPropagation(),gt(v=>v.map(y=>y.id===p.id?{...y,url:m,selectedMjImageIndex:h}:y));const x=Vn(p,m),b={...p,url:x,selectedMjImageIndex:h,storyboardContext:null};cr(b)},onImageContextMenu:(u,p,m,h)=>up(u,p,m,h),onRebuildThumbnail:Ku,onRefresh:u=>{u.apiConfig&&(gt(p=>p.map(m=>m.id===u.id?{...m,status:"generating",errorMsg:null,progress:5}:m)),u.modelName.includes("veo")?ia(u.remoteTaskId,u.id,u.apiConfig.baseUrl,u.apiConfig.apiKey,u.width,u.height):Wa(u.remoteTaskId,u.id,u.apiConfig.baseUrl,u.apiConfig.apiKey,u.width,u.height,u.apiConfig.modelId||""))},Loader2:wo,Trash2:cs,RefreshCw:qd},l.id))]})]})})()]})]}),cx&&s.jsxs("div",{className:`w-72 z-30 flex flex-col animate-in slide-in-from-left border-r transition-colors duration-300 ${e==="dark"?"bg-[#121214] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[s.jsxs("div",{className:`p-3 border-b flex justify-between items-center ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[s.jsx("h3",{className:`font-bold text-xs ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:"Sora "}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{const n=je.find(o=>o.type==="Video"&&(o.id==="sora-2"||o.id==="sora-2-pro"));if(n){const o=(n.url||ss).replace(/\/+$/,"");Yc(`${o}/sora/v1/characters`)}else{const o=ss.replace(/\/+$/,"");Yc(`${o}/sora/v1/characters`)}Vc(!0)},className:`px-2 py-1 text-[10px] rounded transition-colors ${e==="dark"?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}`,children:""}),s.jsx("button",{onClick:()=>$l(!1),children:s.jsx(Ws,{size:12,className:e==="dark"?"text-zinc-500":"text-zinc-400"})})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3",children:br.length===0?s.jsx("div",{className:`text-center py-8 text-sm ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:'""'}):s.jsx("div",{className:"grid grid-cols-2 gap-3",children:br.map(n=>s.jsxs("div",{className:`group rounded-lg overflow-hidden border cursor-pointer hover:border-blue-500/50 transition-colors ${e==="dark"?"bg-zinc-900 border-zinc-800":"bg-white border-zinc-200"}`,onClick:()=>{const o=` @${n.username} `,l=document.activeElement;if(l&&(l.tagName==="TEXTAREA"||l.tagName==="INPUT")){const u=l,p=u.selectionStart||0,m=u.selectionEnd||0,h=u.value,x=h.slice(0,p)+o+h.slice(m);u.value=x;const b=p+o.length;u.setSelectionRange(b,b),u.dispatchEvent(new Event("input",{bubbles:!0})),u.focus()}else navigator.clipboard.writeText(o.trim()).then(()=>{alert(`: ${o.trim()}`)})},children:[s.jsxs("div",{className:"aspect-square bg-zinc-800 relative group/char",children:[n.localCacheUrl||n.profile_picture_url?s.jsx(mr,{src:n.localCacheUrl||n.profile_picture_url,alt:n.username,className:"w-full h-full object-cover",onError:o=>{o.target.style.display="none"}}):s.jsx("div",{className:"w-full h-full flex items-center justify-center text-zinc-500",children:s.jsx(Th,{size:24})}),s.jsx("button",{onClick:o=>{if(o.stopPropagation(),confirm(` "${n.username}" `)){const l=br.filter(u=>u.id!==n.id);Ml(l);try{localStorage.setItem("tapnow_characters",JSON.stringify(l))}catch(u){console.error(":",u)}}},className:"absolute top-1 right-1 p-1.5 rounded-full bg-black/50 text-white opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 z-10",title:"",children:s.jsx(cs,{size:12})})]}),s.jsx("div",{className:"p-2 relative",children:s.jsxs("p",{className:`text-xs truncate flex items-center gap-1 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[n.username,s.jsx(Id,{size:12,className:"text-green-500 shrink-0",title:"Sora 2 "})]})})]},n.id))})})]}),mz&&s.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center",onClick:()=>Vc(!1),children:s.jsxs("div",{className:`w-[500px] max-h-[90vh] overflow-y-auto rounded-lg shadow-2xl flex flex-col ${e==="dark"?"bg-[#121214] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"} border`,onClick:n=>n.stopPropagation(),children:[s.jsxs("div",{className:`p-4 border-b flex justify-between items-center ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[s.jsx("h3",{className:`font-bold text-sm ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:""}),s.jsx("button",{onClick:()=>Vc(!1),children:s.jsx(Ws,{size:16,className:e==="dark"?"text-zinc-500":"text-zinc-400"})})]}),s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs mb-2 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:""}),s.jsxs("div",{className:"flex gap-2 mb-2",children:[s.jsx("button",{onClick:()=>{Ru("url"),Lu("")},className:`px-3 py-1.5 text-xs rounded transition-colors ${fo==="url"?e==="dark"?"bg-blue-600 text-white":"bg-blue-500 text-white":e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:" URL"}),s.jsx("button",{onClick:()=>{Ru("history"),Du(""),Jc(null)},className:`px-3 py-1.5 text-xs rounded transition-colors ${fo==="history"?e==="dark"?"bg-blue-600 text-white":"bg-blue-500 text-white":e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:""})]}),fo==="url"?s.jsx("input",{type:"text",value:Tl,onChange:n=>Du(n.target.value),placeholder:" URL...",className:`w-full px-3 py-2 text-xs rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`}):s.jsxs("select",{value:Pl,onChange:n=>{const o=n.target.value;if(Lu(o),o){const l=Ba.get(o),u=Vn(l);u&&(Ru("url"),Du(u),Lu(""))}},className:`w-full px-3 py-2 text-xs rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,children:[s.jsx("option",{value:"",children:"..."}),kt.filter(n=>n.type==="video"&&n.status==="completed"&&(n.url||n.localCacheUrl||n.originalUrl)).map(n=>{var o;return s.jsxs("option",{value:n.id,children:[((o=n.prompt)==null?void 0:o.slice(0,50))||"Untitled"," - ",n.time]},n.id)})]}),(()=>{let n=null;if(fo==="url"&&Tl.trim())n=Tl.trim();else if(fo==="history"&&Pl){const o=Ba.get(Pl),l=Vn(o);l&&(n=l)}return n?s.jsxs("div",{className:"mt-2 mb-2",children:[s.jsx("video",{controls:!0,crossOrigin:"anonymous",className:"w-full h-40 object-contain bg-black rounded-lg",src:n,onError:o=>{console.error(":",n,o),Jc("")},onLoadStart:()=>{Jc(null)},onLoadedData:()=>{Jc(null)}},n),px&&s.jsx("div",{className:"text-red-500 text-xs mt-1 text-center",children:px})]}):null})()]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs mb-2 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:" 1-3 "}),s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("input",{type:"number",min:"0",step:"0.1",value:Al,onChange:n=>dx(parseFloat(n.target.value)||0),className:`w-20 px-2 py-1.5 text-xs rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`}),s.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""}),s.jsx("input",{type:"number",min:"0",step:"0.1",value:Rl,onChange:n=>ux(parseFloat(n.target.value)||0),className:`w-20 px-2 py-1.5 text-xs rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`}),s.jsxs("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:[": ",(Rl-Al).toFixed(1),"s"]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:`block text-xs mb-2 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:"API  (API Endpoint)"}),s.jsx("input",{type:"text",value:Kc,onChange:n=>Yc(n.target.value),placeholder:": https://your-domain.com/sora/v1/characters",className:`w-full px-3 py-2 text-xs rounded border outline-none font-mono ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onFocus:n=>{if(!n.target.value){const o=je.find(u=>u.type==="Video"&&(u.id==="sora-2"||u.id==="sora-2-pro")),l=o?(o.url||ss).replace(/\/+$/,""):ss.replace(/\/+$/,"");Yc(`${l}/sora/v1/characters`)}}}),s.jsx("p",{className:`text-[10px] mt-1 ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:""})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[s.jsx("button",{onClick:()=>Vc(!1),className:`px-4 py-2 text-xs rounded transition-colors ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-700 hover:bg-zinc-200"}`,children:""}),s.jsx("button",{onClick:async()=>{if(fo==="url"&&!Tl.trim()){alert(" URL");return}if(fo==="history"&&!Pl){alert("");return}if(Rl-Al<1||Rl-Al>3){alert(" 1-3 ");return}Dl(!0);try{const n=Kc.trim()||null;fo==="url"?await Qx(Tl,Al,Rl,null,n):await Qx("",Al,Rl,Pl,n)}finally{Dl(!1)}},disabled:x0,className:`px-4 py-2 text-xs rounded transition-colors ${x0?"bg-zinc-400 text-zinc-200 cursor-not-allowed":e==="dark"?"bg-blue-600 text-white hover:bg-blue-500":"bg-blue-500 text-white hover:bg-blue-600"}`,children:x0?"...":""})]})]})]})}),s.jsxs("div",{className:"flex-1 relative overflow-hidden flex",children:[s.jsxs("div",{ref:Xi,id:"canvas-bg",className:"flex-1 h-full cursor-default relative",onMouseDown:Tz,onClick:Pz,onDoubleClick:Az,onContextMenu:Rz,onDrop:rk,onDragOver:Ha,style:{backgroundColor:e==="dark"?"#09090b":e==="solarized"?"#fdf6e3":"#f4f4f5",backgroundImage:e==="dark"?"radial-gradient(#27272a 1px, transparent 1px)":e==="solarized"?"radial-gradient(#eee8d5 1px, transparent 1px)":"radial-gradient(rgba(0, 0, 0, 0.08) 0.5px, transparent 0.5px)",backgroundSize:`${20*Xt.zoom}px ${20*Xt.zoom}px`,backgroundPosition:`${Xt.x}px ${Xt.y}px`,backgroundRepeat:"repeat",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",transform:"translateZ(0)",backfaceVisibility:"hidden"},children:[s.jsxs("div",{className:"absolute origin-top-left will-change-transform",style:{transform:`translate3d(${Xt.x}px, ${Xt.y}px, 0) scale(${Xt.zoom})`,width:c_,height:d_,WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",transformOrigin:"top left",imageRendering:Xt.zoom>=1?"auto":"crisp-edges"},children:[s.jsx(cb,{connections:g,nodesMap:At,connectionsByNode:Qo,connectingSource:xr,connectingTarget:Ln,connectingInputType:Ds,mousePos:i0,apiConfigsMap:qo,selectedNodeId:Ce,onDisconnectConnection:O0,visibleNodes:Xu}),Xu.map(n=>qk(n))]}),$i&&s.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-500/10 pointer-events-none z-50",style:{left:Math.min($i.startX,$i.endX),top:Math.min($i.startY,$i.endY),width:Math.abs($i.endX-$i.startX),height:Math.abs($i.endY-$i.startY)}})]}),s.jsxs("div",{className:`fixed right-0 top-12 bottom-0 border-l shadow-2xl flex flex-col z-50 transition-transform duration-300 ease-in-out select-text ${e==="dark"?"bg-[#121214] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"} ${Dc?"translate-x-0":"translate-x-full"}`,style:{width:qw,pointerEvents:Dc?"auto":"none"},onMouseEnter:()=>qg(!0),onMouseLeave:()=>qg(!1),onMouseDown:()=>Bc("chat"),onDragOver:Ha,onDrop:sk,children:[s.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1.5 cursor-ew-resize transition-colors z-50 flex items-center justify-center group ${e==="dark"?"hover:bg-blue-600/50":"hover:bg-blue-400/30"}`,onMouseDown:Mz,children:s.jsx("div",{className:`h-8 w-1 rounded transition-colors ${e==="dark"?"bg-zinc-700 group-hover:bg-blue-500":"bg-zinc-300 group-hover:bg-blue-500"}`})}),s.jsxs("div",{className:`h-12 flex items-center justify-between px-3 shrink-0 border-b ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsxs("div",{className:"relative z-50",children:[s.jsxs("button",{onClick:n=>{n.stopPropagation(),Vg(!Wg),Cu(null)},className:`flex items-center gap-2 text-xs border rounded px-2 py-1 outline-none focus:border-blue-500 cursor-pointer max-w-[200px] ${e==="dark"?"bg-zinc-800 text-zinc-300 border-zinc-700 hover:border-zinc-600":"bg-white text-zinc-800 border-zinc-300 hover:border-zinc-400"}`,children:[s.jsx("span",{className:"truncate font-mono",children:td(Ps)}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(Ut(Ps))}`}),s.jsx(Kr,{size:12,className:"shrink-0 opacity-50"})]}),Wg&&s.jsxs("div",{className:`absolute top-full left-0 mt-1 w-72 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseLeave:()=>Cu(null),children:[s.jsx("div",{className:`w-24 border-r pr-1 max-h-64 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(Zr).filter(([,n])=>n.models.some(o=>o.type==="Chat")).map(([n,o])=>s.jsx("button",{onMouseEnter:()=>Cu(n),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${Su===n?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:o.name||n},n))}),s.jsxs("div",{className:"flex-1 pl-1 max-h-64 overflow-y-auto custom-scrollbar",children:[Su&&((fb=Zr[Su])==null?void 0:fb.models.filter(n=>n.type==="Chat").map(n=>{const o=n._uid||n.id,l=Ut(Ps);return s.jsxs("button",{onClick:()=>{ez(o),Vg(!1),Cu(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${l===o?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[s.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:n.id}),s.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${Pi(o)}`})]},o)})),!Su&&s.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:Jz,className:`p-1.5 rounded ${e==="dark"?"text-zinc-400 hover:text-white hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100"}`,title:"",children:s.jsx(vo,{size:16})}),qs.length>1&&s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>b0(!hx),className:`p-1.5 rounded ${e==="dark"?"text-zinc-400 hover:text-white hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100"}`,children:s.jsx(Jy,{size:16})}),hx&&s.jsx("div",{className:`absolute right-0 top-full mt-1 w-48 rounded-lg shadow-xl py-1 z-50 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseLeave:()=>b0(!1),children:qs.map(n=>s.jsxs("div",{className:`flex items-center justify-between px-3 py-2 text-xs cursor-pointer ${Oo===n.id?e==="dark"?"bg-zinc-800 text-white":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:bg-zinc-800/50":"text-zinc-500 hover:bg-zinc-100"}`,onClick:()=>{Rc(n.id),b0(!1)},children:[s.jsx("span",{className:"truncate flex-1",children:n.title}),s.jsx("button",{onClick:o=>{o.stopPropagation(),Gz(o,n.id)},className:`p-1 ${e==="dark"?"text-zinc-600 hover:text-red-500":"text-zinc-400 hover:text-red-500"}`,children:s.jsx(Ws,{size:10})})]},n.id))})]}),s.jsx("button",{onClick:()=>Yi(!1),className:`p-1.5 rounded ${e==="dark"?"text-zinc-400 hover:text-white hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100"}`,children:s.jsx(sl,{size:16})})]})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4 select-text",children:[Yl==null?void 0:Yl.messages.map(n=>s.jsxs("div",{className:`flex gap-3 select-text ${n.role==="user"?"flex-row-reverse":""}`,children:[s.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 select-none ${n.role==="user"?"bg-blue-600":"bg-green-600"}`,children:n.role==="user"?s.jsx(Th,{size:16,className:"text-white"}):s.jsx(Fy,{size:16,className:"text-white"})}),s.jsxs("div",{className:`flex flex-col gap-1 max-w-[85%] select-text ${n.role==="user"?"items-end":"items-start"}`,children:[n.files&&n.files.length>0&&s.jsx("div",{className:`flex flex-wrap gap-2 mb-1 ${n.role==="user"?"justify-end":"justify-start"}`,children:n.files.map((o,l)=>s.jsx("div",{className:`rounded p-1 border flex items-center gap-1 ${e==="dark"?"bg-zinc-800 border-zinc-700":"bg-zinc-100 border-zinc-300"}`,children:o.isImage?s.jsx(mr,{src:o.content,className:"w-16 h-16 object-cover rounded",alt:o.name}):o.isVideo?s.jsx("video",{src:o.content,controls:!0,className:`max-w-full rounded-lg bg-black max-h-[300px] border ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,playsInline:!0}):o.isAudio?s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(Yy,{size:16}),s.jsx("span",{className:"text-[8px] mt-1",children:""})]}):o.isPDF?s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(oi,{size:16}),s.jsx("span",{className:"text-[8px] mt-1",children:"PDF"})]}):o.isDoc?s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(oi,{size:16}),s.jsx("span",{className:"text-[8px] mt-1",children:"DOC"})]}):o.isExcel?s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(oi,{size:16}),s.jsx("span",{className:"text-[8px] mt-1",children:"XLS"})]}):s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(oi,{size:16}),s.jsx("span",{className:"text-[8px] mt-1 max-w-full truncate px-1",children:o.fileExt||o.name.split(".").pop()||""})]})},l))}),n.content&&n.content.trim()&&s.jsx("div",{className:`rounded-2xl px-4 py-2.5 text-sm select-text break-words ${n.role==="user"?e==="dark"?"bg-zinc-800 text-white rounded-tr-none":"bg-zinc-300 text-zinc-900 rounded-tr-none":e==="dark"?"bg-zinc-800/50 text-zinc-300 rounded-tl-none border border-zinc-800":"bg-zinc-100 text-zinc-800 rounded-tl-none border border-zinc-200"}`,style:{userSelect:"text",cursor:"text"},children:n.isError?s.jsx("span",{className:"text-red-500 select-text cursor-text",style:{userSelect:"text",cursor:"text"},children:n.content}):n.content?s.jsx("div",{className:"markdown-body",dangerouslySetInnerHTML:{__html:$5.sanitize(Gn.parse(n.content))},style:{userSelect:"text",cursor:"text"}}):null})]})]},n.id||n.timestamp||`msg-${Math.random()}`)),Eu&&s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-green-600 flex items-center justify-center shrink-0",children:s.jsx(Fy,{size:16,className:"text-white"})}),s.jsx("div",{className:`rounded-2xl rounded-tl-none px-4 py-2 border flex items-center ${e==="dark"?"bg-zinc-800/50 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-100 border-zinc-200"}`,children:s.jsxs("div",{className:"flex gap-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-500 rounded-full animate-bounce",style:{animationDelay:"0s"}}),s.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),s.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-500 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})]}),s.jsx("div",{ref:kx})]}),s.jsxs("div",{className:`p-3 border-t ${e==="dark"?"border-zinc-800 bg-[#121214]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-zinc-50"}`,children:[jl.length>0&&s.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 mb-2 custom-scrollbar",children:jl.map((n,o)=>s.jsxs("div",{className:"relative group shrink-0",children:[n.isImage?s.jsx(mr,{src:n.content,className:`w-12 h-12 object-cover rounded border ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,alt:n.name}):n.isVideo?s.jsx("video",{src:n.content,className:`w-16 h-12 object-cover rounded border bg-black ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,muted:!0,playsInline:!0}):n.isAudio?s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(Yy,{size:16}),s.jsx("span",{className:"text-[8px] mt-1",children:""})]}):n.isPDF?s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(oi,{size:16}),s.jsx("span",{className:"text-[8px] mt-1",children:"PDF"})]}):n.isDoc?s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(oi,{size:16}),s.jsx("span",{className:"text-[8px] mt-1",children:"DOC"})]}):n.isExcel?s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(oi,{size:16}),s.jsx("span",{className:"text-[8px] mt-1",children:"XLS"})]}):s.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[s.jsx(oi,{size:16}),s.jsx("span",{className:"text-[8px] mt-1 max-w-full truncate px-1",children:n.fileExt||n.name.split(".").pop()||""})]}),s.jsx("button",{onClick:()=>Zz(o),className:`absolute -top-1 -right-1 rounded-full p-0.5 border opacity-0 group-hover:opacity-100 transition-opacity ${e==="dark"?"bg-zinc-900 text-zinc-400 hover:text-white border-zinc-700":"bg-white text-zinc-500 hover:text-zinc-900 border-zinc-300"}`,children:s.jsx(Ws,{size:10})})]},o))}),s.jsxs("div",{className:`relative rounded-xl flex items-end p-2 focus-within:border-blue-500/50 transition-colors border ${e==="dark"?"bg-zinc-800/50 border-zinc-700":"bg-white border-zinc-300"}`,children:[s.jsxs("label",{className:`p-2 cursor-pointer transition-colors ${e==="dark"?"text-zinc-400 hover:text-white":"text-zinc-500 hover:text-zinc-900"}`,title:"",children:[s.jsx(Y5,{size:18}),s.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:Xz,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md,.js,.py,.html,.css,.json,.csv"})]}),s.jsx("textarea",{ref:Ez,value:kl,onChange:n=>Hg(n.target.value),onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),Wx())},onFocus:()=>{Zg(!0),Bc("chat")},onBlur:()=>Zg(!1),placeholder:"...",className:`w-full bg-transparent text-sm resize-none outline-none max-h-32 py-2 px-1 custom-scrollbar ${e==="dark"?"text-white placeholder-zinc-500":"text-zinc-800 placeholder-zinc-400"}`,rows:1,style:{minHeight:"36px"}}),s.jsx("button",{onClick:Wx,disabled:!kl.trim()&&jl.length===0||Eu,className:`p-2 rounded-lg transition-all mb-0.5 ${!kl.trim()&&jl.length===0||Eu?"opacity-50 bg-transparent text-zinc-400":"bg-blue-600 text-white hover:bg-blue-500"}`,children:s.jsx(Qy,{size:16})})]}),s.jsx("div",{className:`text-[10px] text-center mt-2 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:" MP4/MP3/PDF/Doc/Excel/Code   Enter "})]})]}),Xr.visible&&s.jsx("div",{className:`fixed z-50 w-40 rounded-lg shadow-xl border ${e==="dark"?"bg-[#18181b] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:Xr.x,top:Xr.y,transform:"translate(-50%, -50%)"},onMouseLeave:()=>{El(n=>({...n,visible:!1})),Ho(!1)},children:s.jsx("div",{className:"p-1",children:[{type:"input-image",label:""},{type:"text-node",label:""},{type:"novel-input",label:""},{type:"extract-characters-scenes",label:"",children:[{type:"character-description",label:""},{type:"scene-description",label:""},{type:"generate-character-image",label:""},{type:"generate-scene-image",label:""},{type:"generate-character-video",label:""},{type:"generate-scene-video",label:""},{type:"create-character",label:""},{type:"create-scene",label:""}]},{type:"video-input",label:" / "},{type:"video-analyze",label:" / "},{type:"storyboard-node",label:""},{type:"gen-image",label:"AI "},{type:"gen-video",label:"AI "},{type:"image-compare",label:""},{type:"preview",label:""},{type:"local-save",label:""}].map(n=>s.jsx("div",{children:n.children?s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex items-center",onMouseEnter:()=>Ho(!0),children:[s.jsx("button",{className:`flex-1 text-left px-3 py-2 text-xs rounded transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>Ur(n.type,Xr.worldX,Xr.worldY,Xr.sourceNodeId,void 0,void 0,Xr.targetNodeId,Xr.inputType),children:n.label}),s.jsx("button",{className:`px-2 py-2 rounded transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-100"}`,onClick:o=>{o.stopPropagation(),Ho(l=>!l)},onMouseEnter:()=>Ho(!0),title:"",children:s.jsx(sl,{size:12,className:"transition-transform"})})]}),rz&&s.jsx("div",{className:`absolute left-full top-0 ml-1 w-40 rounded-lg shadow-xl p-1 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,children:n.children.map(o=>s.jsx("button",{className:`w-full text-left px-3 py-2 text-[11px] rounded transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>Ur(o.type,Xr.worldX,Xr.worldY,Xr.sourceNodeId,void 0,void 0,Xr.targetNodeId,Xr.inputType),children:o.label},o.type))})]}):s.jsx("button",{className:`w-full text-left px-3 py-2 text-xs rounded transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>Ur(n.type,Xr.worldX,Xr.worldY,Xr.sourceNodeId,void 0,void 0,Xr.targetNodeId,Xr.inputType),children:n.label})},n.type))})}),ks.visible&&s.jsxs("div",{className:`fixed z-[100] w-max rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:ks.x,top:ks.y},children:[s.jsx("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:""}),s.jsxs("div",{className:"relative",onMouseEnter:f0,onMouseLeave:Qg,children:[s.jsxs("button",{className:`w-full whitespace-nowrap text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Kk,children:[s.jsx(Qy,{size:14,className:"text-blue-500"})," "]}),s.jsx("button",{className:`absolute right-2 top-2 p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-200":"text-zinc-400 hover:text-zinc-700"}`,onMouseEnter:f0,onClick:n=>{n.stopPropagation(),Mi(o=>!o)},title:"",children:s.jsx(sl,{size:12,className:`transition-transform ${u0?"rotate-90":""}`})}),u0&&s.jsxs("div",{className:`absolute left-full top-0 ml-1 w-max rounded-lg shadow-2xl py-1 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseEnter:f0,onMouseLeave:Qg,children:[s.jsxs("button",{className:`w-full whitespace-nowrap text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:ab,children:[s.jsx(Ql,{size:14,className:"text-purple-500"})," "]}),s.jsxs("button",{className:`w-full whitespace-nowrap text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Vk,children:[s.jsx(Ri,{size:14,className:"text-emerald-500"})," "]}),s.jsxs("button",{className:`w-full whitespace-nowrap text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:ob,children:[s.jsx(Zl,{size:14,className:"text-blue-500"})," "]})]})]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>{const n=ks.item,o=(n==null?void 0:n.url)||(n==null?void 0:n.localCacheUrl)||(n==null?void 0:n.originalUrl)||(n==null?void 0:n.mjOriginalUrl);if(o){const l=(ks.worldX||0)+340,u=ks.worldY||0;cd(o,{originX:l,originY:u})}gi({visible:!1,x:0,y:0,worldX:0,worldY:0,item:null})},children:[s.jsx(Mh,{size:14,className:"text-blue-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:async()=>{const n=ks.item,o=(n==null?void 0:n.url)||(n==null?void 0:n.localCacheUrl)||(n==null?void 0:n.originalUrl)||(n==null?void 0:n.mjOriginalUrl);if(o){try{const u=n.type==="video"||o.includes("/video/")||o.includes("video_mp4")?"mp4":"png",m=`${(n.prompt||"download").replace(/[\\/:*?"<>|]/g,"_").slice(0,50)}.${u}`,h=Ns(n),{blob:x}=await Ji(o,{useProxy:h}),b=window.URL.createObjectURL(x),v=document.createElement("a");v.href=b,v.download=m,v.click(),window.URL.revokeObjectURL(b)}catch(l){console.error(":",l),alert("")}gi({visible:!1,x:0,y:0,worldX:0,worldY:0,item:null})}},children:[s.jsx(Qa,{size:14,className:"text-green-500"})," ",((hb=ks.item)==null?void 0:hb.type)==="video"?"":""]})]}),c0.visible&&s.jsxs("div",{className:`fixed z-[120] w-52 rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:c0.x,top:c0.y},onMouseLeave:()=>d0({visible:!1,x:0,y:0}),children:[s.jsxs("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:[" ",Hn.size>0?Hn.size:Ce?1:0," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:dk,children:[s.jsx(qy,{size:14,className:"text-blue-500"})," "]})]}),Wo.visible&&s.jsxs("div",{className:`fixed z-[110] w-48 rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:Wo.x,top:Wo.y},children:[s.jsx("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:""}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Ok,children:[s.jsx(Ql,{size:14,className:"text-purple-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Uk,children:[s.jsx(Zl,{size:14,className:"text-blue-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Fk,children:[s.jsx(Ri,{size:14,className:"text-emerald-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Bk,children:[s.jsx(Sh,{size:14,className:Ce?"text-green-500":"text-zinc-400"})," "]})]}),Vo.visible&&s.jsxs("div",{className:`fixed z-[110] w-48 rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:Vo.x,top:Vo.y},onMouseLeave:Ja,children:[s.jsx("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:""}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Jk,children:[s.jsx(Ql,{size:14,className:"text-purple-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Gk,children:[s.jsx(Zl,{size:14,className:"text-blue-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>{const n=Vo.item;n!=null&&n.url&&cr({url:n.url,type:n.type||"image",prompt:n.prompt||"",mjImages:n.mjImages,selectedMjImageIndex:n.selectedMjImageIndex||0}),Ja()},children:[s.jsx(Ri,{size:14,className:"text-green-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>{const n=Vo.item;if(n!=null&&n.url){const o=ni.current;if(o&&o.size===9)cd(n.url,{replaceSelected:!0});else{const u=n.sourceNode,p=u?u.x+u.width+20:void 0,m=u?u.y:void 0;cd(n.url,{originX:p,originY:m})}}Ja()},children:[s.jsx(Mh,{size:14,className:"text-blue-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:async()=>{const n=Vo.item;if(!(n!=null&&n.url)){Ja();return}try{const l=n.type==="video"||n.url.includes("/video/")||n.url.includes("video_mp4")?"mp4":"png",p=`${(n.prompt||"download").replace(/[\\/:*?"<>|]/g,"_").slice(0,50)}_${Date.now()}.${l}`,m=Ns(n),{blob:h}=await Ji(n.url,{useProxy:m}),x=window.URL.createObjectURL(h),b=document.createElement("a");b.href=x,b.download=p,b.click(),window.URL.revokeObjectURL(x)}catch(o){console.error(":",o),a("","error")}Ja()},children:[s.jsx(Qa,{size:14,className:"text-cyan-500"})," "]})]}),Wc.visible&&s.jsxs("div",{className:`fixed z-[110] w-48 rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:Wc.x,top:Wc.y},onMouseLeave:V0,children:[s.jsx("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:""}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:Zk,children:[s.jsx(Ql,{size:14,className:"text-purple-500"})," "]}),s.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>{const n=Wc.nodeId,o=At.get(n);if(!o||!o.content)return;const l=ni.current;if(l&&l.size===9)cd(o.content,{replaceSelected:!0});else{const p=o.x+o.width+20,m=o.y;cd(o.content,{originX:p,originY:m})}V0()},children:[s.jsx(Mh,{size:14,className:"text-blue-500"})," "]})]}),s.jsx(E_,{item:Uo,onClose:()=>cr(null),onNavigate:n=>{const o=Iu.current;if(o&&o.mjImages&&o.mjImages.length>n&&n>=0){const l=Math.max(0,Math.min(n,o.mjImages.length-1)),u=o.mjImages[l],p=Vn(o,u);o.id&&!o.storyboardContext&&gt(m=>m.map(h=>h.id===o.id?{...h,url:u,selectedMjImageIndex:l}:h)),cr({...o,url:p,selectedMjImageIndex:l})}},onShotNavigate:(n,o)=>{const l=Iu.current;if(!(l!=null&&l.storyboardContext)||!o)return;const u=l.storyboardContext.shotIndex,p=n>u?1:-1;let m=n,h=null;for(;m>=0&&m<o.length;){const v=o[m];if(((v==null?void 0:v.output_images)||[]).length>0){h=v;break}m+=p}if(!h)return;const x=h.output_images||[],b=0;cr({url:x[b],type:"image",mjImages:x,selectedMjImageIndex:b,prompt:h.prompt,storyboardContext:{...l.storyboardContext,shotId:h.id,shotIndex:m}})},onHistoryNavigate:n=>{const o=Iu.current;if(!o||o.storyboardContext)return;const l=kt.findIndex(p=>p.id===o.id);if(l===-1)return;let u=l+n;for(;u>=0&&u<kt.length;){const p=kt[u];if(p.url&&p.status==="completed"){const h=p.mjImages&&p.mjImages.length>1?p.mjImages[0]:p.url,x=h?Vn(p,h):Vn(p);cr({...p,url:x,selectedMjImageIndex:0,storyboardContext:null});return}u+=n}}}),s.jsxs(C_,{isOpen:oz,onClose:()=>ei(!1),title:"",theme:e,children:[s.jsx("div",{className:"px-4 pt-3",children:s.jsxs("div",{className:`inline-flex rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-zinc-50"} p-1`,children:[s.jsx("button",{onClick:()=>nx("providers"),className:`px-3 py-1 text-xs rounded ${Tu==="providers"?e==="dark"?"bg-zinc-800 text-zinc-100":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-white text-zinc-800":e==="dark"?"text-zinc-400 hover:text-zinc-200":e==="solarized"?"text-[#586e75] hover:text-zinc-800":"text-zinc-500 hover:text-zinc-700"}`,children:""}),s.jsx("button",{onClick:()=>nx("library"),className:`px-3 py-1 text-xs rounded ${Tu==="library"?e==="dark"?"bg-zinc-800 text-zinc-100":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-white text-zinc-800":e==="dark"?"text-zinc-400 hover:text-zinc-200":e==="solarized"?"text-[#586e75] hover:text-zinc-800":"text-zinc-500 hover:text-zinc-700"}`,children:""})]})}),Tu==="providers"&&s.jsxs(s.Fragment,{children:[s.jsxs("details",{className:`mx-4 mt-3 rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-white"}`,children:[s.jsx("summary",{className:`cursor-pointer select-none px-3 py-2 text-xs font-medium ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:""}),s.jsxs("div",{className:"px-3 pb-3 pt-2 space-y-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"Global API Key Key"}),s.jsx("input",{type:"password",value:We,onChange:n=>Pt(n.target.value),className:`w-full rounded px-2 py-1 text-xs outline-none focus:border-blue-600/50 border ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,placeholder:" Key Key"})]}),s.jsxs("div",{className:"border-t pt-3 border-zinc-700/50",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:""}),s.jsxs("select",{value:Nr,onChange:n=>{const o=n.target.value;Pc(o),localStorage.setItem("tapnow_performance_mode",o)},className:`text-xs rounded px-2 py-0.5 border outline-none ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":"bg-white border-zinc-300"}`,children:[s.jsx("option",{value:"off",children:" ()"}),s.jsx("option",{value:"normal",children:" ()"}),s.jsx("option",{value:"ultra",children:" ()"})]})]}),s.jsx("p",{className:"text-[9px] text-zinc-500",children:""})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:""}),s.jsx("input",{type:"text",value:kn,onChange:n=>{const o=n.target.value;uo(o),localStorage.setItem("tapnow_local_server_url",o)},placeholder:"http://127.0.0.1:9527",className:`w-full text-xs rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":"bg-white border-zinc-300"}`}),s.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-zinc-500",children:[s.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${as?fs?"bg-green-500":"bg-red-500":"bg-zinc-400"}`}),s.jsx("span",{children:as?fs?"":"":""})]})]}),s.jsx("p",{className:"text-[9px] text-zinc-500 mt-1",children:""})]})]})]}),s.jsxs("div",{className:"border-t pt-3 border-zinc-700/50 space-y-2",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsx("div",{className:"mb-2",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"/"}),s.jsx("p",{className:`text-[10px] mt-0.5 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:" ()"})]}),s.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[s.jsx("input",{type:"range",min:"1",max:"30",value:$,onChange:n=>{const o=parseInt(n.target.value)||5;T(o),localStorage.setItem("tapnow_max_undo_steps",String(o))},className:"w-20",onMouseDown:n=>n.stopPropagation()}),s.jsx("span",{className:`text-xs font-mono w-6 text-center ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:$})]})]})}),s.jsx("div",{className:"mb-2",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsx("p",{className:`text-[10px] mt-0.5 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:"FormDataURL"})]}),s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-3",children:[s.jsx("input",{type:"checkbox",checked:Vi,onChange:n=>{const o=n.target.checked;lo(o),localStorage.setItem("tapnow_jimeng_use_local_file",String(o))},className:"sr-only peer"}),s.jsx("div",{className:`w-11 h-6 rounded-full peer peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500/50 ${Vi?"bg-blue-600":e==="dark"?"bg-zinc-700":"bg-zinc-300"} peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all`})]})]})})]})]})]}),s.jsx("div",{className:`mx-4 mt-3 rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-white"}`,children:s.jsxs("div",{className:"px-3 py-3",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"API "}),s.jsxs("div",{className:"flex gap-2 mt-2",children:[s.jsxs("button",{onClick:()=>{const n={version:"3.4.23",exportTime:new Date().toISOString(),globalApiKey:We,providers:Pe,modelLibrary:K,apiConfigs:je.map(({key:y,url:w,...j})=>j)},o=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),l=URL.createObjectURL(o),u=document.createElement("a");u.href=l;const p=new Date,m=p.getFullYear().toString().slice(2),h=(p.getMonth()+1).toString().padStart(2,"0"),x=p.getDate().toString().padStart(2,"0"),b=p.getHours().toString().padStart(2,"0"),v=p.getMinutes().toString().padStart(2,"0");u.download=`tapnow-api-keys-${m}${h}${x}-${b}${v}.json`,u.click(),URL.revokeObjectURL(l)},className:`flex-1 px-3 py-2 text-xs rounded flex items-center justify-center gap-2 transition-colors ${e==="dark"?"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30 border border-blue-500/30":"bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200"}`,children:[s.jsx(Qa,{size:14})," API Keys"]}),s.jsxs("button",{onClick:()=>{const n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=async o=>{const l=o.target.files[0];if(l)try{const u=await l.text(),p=JSON.parse(u);if(p.globalApiKey&&(Pt(p.globalApiKey),localStorage.setItem("tapnow_global_key",p.globalApiKey)),p.providers){const m=Object.fromEntries(Object.entries(p.providers).map(([h,x])=>[h,X(h,x)]));ft(h=>({...h,...m}))}if(p.modelLibrary&&Array.isArray(p.modelLibrary)){const m=p.modelLibrary.map(h=>({id:h.id,displayName:h.displayName||h.id,modelName:h.modelName||h.id,type:h.type||"Chat",apiType:h.apiType||"openai",ratioLimits:Array.isArray(h.ratioLimits)?h.ratioLimits:null,ratioNotes:rs(h.ratioNotes),ratioNotesEnabled:!!h.ratioNotesEnabled,resolutionLimits:Array.isArray(h.resolutionLimits)?h.resolutionLimits:null,resolutionNotes:el(h.resolutionNotes),resolutionNotesEnabled:!!h.resolutionNotesEnabled,durations:Array.isArray(h.durations)?h.durations:null,durationNotes:rs(h.durationNotes),durationNotesEnabled:!!h.durationNotesEnabled,videoResolutions:Array.isArray(h.videoResolutions)?h.videoResolutions:null,videoResolutionNotes:rs(h.videoResolutionNotes),videoResolutionNotesEnabled:!!h.videoResolutionNotesEnabled,supportsFirstLastFrame:!!h.supportsFirstLastFrame,supportsHD:!!h.supportsHD,customParams:tc(h.customParams),previewOverrideEnabled:!!h.previewOverrideEnabled,previewOverridePatch:Pd(h.previewOverridePatch)})).filter(h=>h.id);de(m)}if(p.apiConfigs&&Array.isArray(p.apiConfigs)){const m=p.apiConfigs.map(h=>{const x={...h,id:h.id||h.modelName,provider:h.provider,type:h.type||"Chat",modelName:h.modelName||h.id,displayName:h.displayName||h.modelName||h.id,_uid:h._uid||`uid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,...h.durations?{durations:h.durations}:{}},{key:b,url:v,isCustom:y,...w}=x;return w});ve(m)}alert("API ")}catch(u){alert(": "+u.message)}},n.click()},className:`flex-1 px-3 py-2 text-xs rounded flex items-center justify-center gap-2 transition-colors ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700 border border-zinc-700":"bg-zinc-100 text-zinc-700 hover:bg-zinc-200 border border-zinc-300"}`,children:[s.jsx(ua,{size:14})," API Keys"]})]}),s.jsx("p",{className:"text-[9px] text-zinc-500 mt-1",children:" KeyProvider  Key"})]})}),s.jsx("div",{className:`mx-4 mt-3 rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-white"}`,children:s.jsxs("div",{className:"px-3 py-3",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"API "}),s.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[s.jsxs("button",{onClick:()=>{vn({}),$r.current={},alert("")},className:`px-2 py-1.5 text-[10px] rounded flex items-center justify-center gap-1 transition-colors ${e==="dark"?"bg-red-600/20 text-red-400 hover:bg-red-600/30 border border-red-500/30":"bg-red-50 text-red-600 hover:bg-red-100 border border-red-200"}`,children:[s.jsx(P5,{size:12}),"",Object.keys(fn).length>0&&s.jsx("span",{className:"ml-1 px-1 rounded bg-red-500/30 text-[9px]",children:Object.keys(fn).length})]}),s.jsxs("button",{onClick:()=>{Si({}),alert("")},className:`px-2 py-1.5 text-[10px] rounded flex items-center justify-center gap-1 transition-colors ${e==="dark"?"bg-amber-600/20 text-amber-400 hover:bg-amber-600/30 border border-amber-500/30":"bg-amber-50 text-amber-600 hover:bg-amber-100 border border-amber-200"}`,children:[s.jsx(Vy,{size:12}),"",Object.keys(Mr).length>0&&s.jsx("span",{className:"ml-1 px-1 rounded bg-amber-500/30 text-[9px]",children:Object.keys(Mr).length})]}),s.jsxs("button",{onClick:()=>{Rr.current=[],alert("")},className:`px-2 py-1.5 text-[10px] rounded flex items-center justify-center gap-1 transition-colors ${e==="dark"?"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30 border border-blue-500/30":"bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200"}`,children:[s.jsx(Up,{size:12}),""]})]}),s.jsx("p",{className:"text-[9px] text-zinc-500 mt-1",children:" =  = 60 = 1006"})]})}),s.jsxs("div",{className:`mx-4 mt-3 rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-white"}`,children:[s.jsx("div",{className:`px-3 py-2 text-xs font-medium ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:""}),s.jsxs("div",{className:"px-3 pb-3 pt-2",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{const n=Object.values(Gc).some(l=>l),o={};n||Object.keys(Zr).forEach(l=>o[l]=!0),y0(o)},className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,title:Object.values(Gc).some(n=>n)?"":"",children:s.jsx(Hy,{size:14,className:`transition-transform ${Object.values(Gc).some(n=>n)?"":"rotate-180"}`})}),s.jsxs(Vp,{className:"h-7 text-xs px-3 bg-blue-600 hover:bg-blue-500",onClick:()=>{const n=`custom-${Date.now()}`,o="New Provider";ft(l=>({...l,[n]:X(n,{key:"",url:"",enabled:!0})})),y0(l=>({...l,[n]:!0})),Fu({key:n,tempName:o})},children:[s.jsx(vo,{size:14,className:"mr-1"})," "]})]})]}),s.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto custom-scrollbar pr-1",children:Object.entries(Zr).map(([n,o])=>{var l,u,p,m,h,x,b,v;return s.jsxs("div",{className:`group rounded-lg border ${e==="dark"?"bg-[#18181b] border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[s.jsx("button",{onClick:()=>y0(y=>({...y,[n]:!y[n]})),className:`w-full flex items-center justify-between px-3 py-2.5 text-left transition-colors ${e==="dark"?"hover:bg-zinc-800/50":e==="solarized"?"hover:bg-[#eee8d5]":"hover:bg-zinc-100"}`,children:yz===n?s.jsxs("div",{className:"flex items-center justify-between w-full",children:[s.jsxs("span",{className:`text-sm font-semibold ${e==="dark"?"text-zinc-100":"text-zinc-800"}`,children:[" ",o.name,"?"]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:y=>{y.stopPropagation(),ft(w=>{const j={...w};return delete j[n],j}),v0(null)},className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded",children:""}),s.jsx("button",{onClick:y=>{y.stopPropagation(),v0(null)},className:`text-xs px-2 py-1 rounded ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-700"}`,children:""})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${((l=Pe[n])==null?void 0:l.enabled)!==!1?"bg-green-500":"bg-zinc-500"}`}),(Ll==null?void 0:Ll.key)===n?s.jsx("input",{type:"text",value:Ll.tempName,onChange:y=>Fu(w=>({...w,tempName:y.target.value})),onBlur:()=>{const y=Ll.tempName.trim(),w=n;y&&y!==w&&(ft(j=>{const{[w]:R,...C}=j;return{...C,[y]:R}}),ve(j=>j.map(R=>R.provider===w?{...R,provider:y}:R))),Fu(null)},onKeyDown:y=>{y.key==="Enter"&&y.target.blur(),y.stopPropagation()},onClick:y=>y.stopPropagation(),autoFocus:!0,className:`text-sm font-semibold bg-transparent border-b border-blue-500 outline-none w-full ${e==="dark"?"text-zinc-100":"text-zinc-800"}`}):s.jsx("span",{className:`text-sm font-semibold ${e==="dark"?"text-zinc-100":"text-zinc-800"}`,children:o.name}),s.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${e==="dark"?"bg-zinc-800 text-zinc-500":e==="solarized"?"bg-[#eee8d5] text-zinc-600":"bg-zinc-200 text-zinc-500"}`,children:[o.models.length," "]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[!Ll&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:y=>{y.stopPropagation(),Fu({key:n,tempName:o.name})},className:"p-1 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors opacity-0 group-hover:opacity-100",title:"",children:s.jsx(J5,{size:12,className:e==="dark"?"text-zinc-400":"text-zinc-500"})}),s.jsx("button",{onClick:y=>{y.stopPropagation(),v0(n)},className:"p-1 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors opacity-0 group-hover:opacity-100",title:"",children:s.jsx(cs,{size:12,className:e==="dark"?"text-zinc-400 hover:text-red-400":"text-zinc-500 hover:text-red-500"})})]}),s.jsx(Kr,{size:16,className:`transition-transform ${Gc[n]?"rotate-180":""} ${e==="dark"?"text-zinc-500":"text-zinc-400"}`})]})]})}),Gc[n]&&s.jsxs("div",{className:`px-3 pb-3 border-t ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[s.jsxs("div",{className:"pt-3 pb-2 space-y-2",children:[s.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("select",{value:((u=Pe[n])==null?void 0:u.apiType)||"openai",onChange:y=>ft(w=>({...w,[n]:{...w[n],apiType:y.target.value}})),className:`col-span-3 w-full rounded px-2 py-1 text-xs outline-none focus:border-blue-600/50 border ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,children:[s.jsx("option",{value:"openai",children:"OpenAI"}),s.jsx("option",{value:"gemini",children:"Gemini"}),s.jsx("option",{value:"modelscope",children:"ModelScope"})]})]}),s.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:!!((p=Pe[n])!=null&&p.useProxy),onChange:y=>ft(w=>({...w,[n]:{...w[n],useProxy:y.target.checked}})),className:"sr-only peer"}),s.jsx("div",{className:`w-9 h-5 rounded-full peer peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500/50 ${(m=Pe[n])!=null&&m.useProxy?"bg-blue-600":e==="dark"?"bg-zinc-700":"bg-zinc-300"} peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all`})]}),s.jsxs("span",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[" ",kn||"http://127.0.0.1:9527","/proxy"]})]})]}),s.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[s.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:!!((h=Pe[n])!=null&&h.forceAsync),onChange:y=>ft(w=>({...w,[n]:{...w[n],forceAsync:y.target.checked}})),className:"sr-only peer"}),s.jsx("div",{className:`w-9 h-5 rounded-full peer peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500/50 ${(x=Pe[n])!=null&&x.forceAsync?"bg-blue-600":e==="dark"?"bg-zinc-700":"bg-zinc-300"} peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all`})]}),s.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"ModelScope "})]})]}),s.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"API Key"}),s.jsx("input",{type:"password",value:((b=Pe[n])==null?void 0:b.key)||"",onChange:y=>ft(w=>({...w,[n]:{...w[n],key:y.target.value}})),className:`col-span-3 w-full rounded px-2 py-1 text-xs outline-none focus:border-blue-600/50 border ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,placeholder:"sk-..."})]}),s.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[s.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"Base URL"}),s.jsx("input",{type:"text",value:((v=Pe[n])==null?void 0:v.url)||"",onChange:y=>ft(w=>({...w,[n]:{...w[n],url:y.target.value}})),className:`col-span-3 w-full rounded px-2 py-1 text-xs outline-none focus:border-blue-600/50 border ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,placeholder:"https://..."})]})]}),s.jsxs("div",{className:`mt-2 pt-2 border-t ${e==="dark"?"border-zinc-800/50":"border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("div",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("button",{onClick:()=>{const y=`${n}-${Date.now()}`,w=`uid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;ve(j=>[...j,{id:y,provider:n,type:"Chat",_uid:w}]),Fx(w,!0)},className:`text-[9px] px-1.5 py-0.5 rounded flex items-center gap-1 ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-600 hover:bg-zinc-300"}`,children:[s.jsx(vo,{size:10})," "]})]}),s.jsx("div",{className:"space-y-1.5",children:o.models.map(y=>{var H,B;const w=az.has(y._uid),j=y.libraryId?((H=Ju.get(y.libraryId))==null?void 0:H.displayName)||y.libraryId:"",R=y.apiType||((B=Pe[n])==null?void 0:B.apiType)||"openai",C=y._uid||y.id;return s.jsxs("div",{className:`flex flex-col gap-2 px-2 py-2 rounded ${e==="dark"?"bg-zinc-900/50 hover:bg-zinc-800/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5]":"bg-white hover:bg-zinc-100"}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-1",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${Pi(y._uid)}`}),s.jsx("input",{type:"text",value:y.id||"",onChange:L=>sp(y._uid,{id:L.target.value}),className:`text-xs bg-transparent border-b border-transparent hover:border-zinc-600 focus:border-blue-500 outline-none flex-1 min-w-[120px] font-mono ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,placeholder:"model-id",title:` ID: ${y.id}`,disabled:!w}),s.jsxs("select",{value:y.type||"Chat",onChange:L=>sp(y._uid,{type:L.target.value}),className:`text-[9px] px-1 py-0.5 rounded cursor-pointer outline-none ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-500 hover:bg-zinc-300"}`,disabled:!w||!!y.libraryId,children:[s.jsx("option",{value:"Chat",children:"Chat"}),s.jsx("option",{value:"Image",children:"Image"}),s.jsx("option",{value:"ChatImage",children:"Chat Image"}),s.jsx("option",{value:"Video",children:"Video"})]}),s.jsxs("select",{value:y.libraryId||"",onChange:L=>{const Y=L.target.value||null,J=Y?Ju.get(Y):null,q={libraryId:Y};J&&(q.modelName=J.modelName,q.displayName=J.displayName,q.type=J.type||y.type,q.apiType=J.apiType||y.apiType,q.ratioLimits=Array.isArray(J.ratioLimits)?J.ratioLimits:null,q.resolutionLimits=Array.isArray(J.resolutionLimits)?J.resolutionLimits:null,q.durations=Array.isArray(J.durations)?J.durations:null,q.videoResolutions=Array.isArray(J.videoResolutions)?J.videoResolutions:null),sp(y._uid,q)},className:`text-[9px] px-1 py-0.5 rounded cursor-pointer outline-none min-w-[120px] ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-500 hover:bg-zinc-300"}`,disabled:!w,children:[s.jsx("option",{value:"",children:""}),K.map(L=>s.jsx("option",{value:L.id,children:L.displayName||L.id},L.id))]}),s.jsxs("select",{value:y.apiType||"",onChange:L=>sp(y._uid,{apiType:L.target.value||null}),className:`text-[9px] px-1 py-0.5 rounded cursor-pointer outline-none ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-500 hover:bg-zinc-300"}`,disabled:!w||!!y.libraryId,children:[s.jsx("option",{value:"",children:" Provider"}),s.jsx("option",{value:"openai",children:"OpenAI"}),s.jsx("option",{value:"gemini",children:"Gemini"}),s.jsx("option",{value:"modelscope",children:"ModelScope"})]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>Fx(y._uid,!w),className:`px-1.5 py-0.5 rounded text-[9px] ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:w?"":"",children:w?s.jsx(rl,{size:10}):s.jsx($h,{size:10})}),s.jsx("button",{onClick:()=>Kz(C),disabled:mx===C,className:`px-1.5 py-0.5 rounded text-[9px] ${z0[C]==="success"?"text-green-500":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,children:mx===C?s.jsx(wo,{size:10,className:"animate-spin"}):z0[C]==="success"?s.jsx(Od,{size:10}):s.jsx(Id,{size:10})}),s.jsx("button",{onClick:()=>Vz(y._uid),className:`px-1 ${e==="dark"?"text-zinc-600 hover:text-red-500":"text-zinc-400 hover:text-red-500"}`,children:s.jsx(cs,{size:10})})]})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[9px] text-zinc-500",children:[s.jsxs("span",{children:["",y.libraryId?j:""]}),s.jsxs("span",{children:["API",y.modelName||y.id]}),s.jsxs("span",{children:["",R]})]})]},y._uid)})})]})]})]},n)})})]})]})]}),Tu==="library"&&s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:`text-xs font-medium ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:""}),s.jsx("p",{className:"text-[9px] text-zinc-500",children:""})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{Aa(I0?new Set(K.map(n=>n.id)):new Set)},className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,title:I0?"":"",children:s.jsx(Hy,{size:14,className:`transition-transform ${I0?"":"rotate-180"}`})}),s.jsxs("button",{onClick:Lz,className:`text-[10px] px-2 py-1 rounded flex items-center gap-1 ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-200 text-zinc-600 hover:bg-zinc-300"}`,children:[s.jsx(vo,{size:10})," "]})]})]}),s.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto custom-scrollbar pr-1",children:K.map(n=>{const o=lz.has(n.id),l=sx.has(n.id),u=cz.has(n.id),p=n.ratioLimits===null,m=Array.isArray(n.ratioLimits)?n.ratioLimits:[],h=n.ratioNotes||{},x=!!n.ratioNotesEnabled,b=Array.isArray(n.resolutionLimits)?n.resolutionLimits:[],v=el(n.resolutionNotes),y=!!n.resolutionNotesEnabled,w=Array.isArray(n.durations)?n.durations:[],j=n.durationNotes||{},R=!!n.durationNotesEnabled,C=Array.isArray(n.videoResolutions)?n.videoResolutions:[],H=n.videoResolutionNotes||{},B=!!n.videoResolutionNotesEnabled,L=Array.isArray(n.customParams)?n.customParams:[],Y={model:n.modelName||n.id,type:n.type||"Chat",apiType:n.apiType||"openai"};ns(n.type)&&(Y.ratio=m[0]||"1:1",Y.size=b[0]||"2K"),n.type==="Video"&&(Y.ratio=m[0]||"16:9",Y.duration=w[0]||"5s",Y.resolution=C[0]||"720P");const J=g_(Y,L),q=Pd(n.previewOverridePatch),Z=n.previewOverrideEnabled&&q?Ah({...J},q):J,oe=y_(n),te=v_(oe,Z),ee=dz.has(n.id),ce=uz[n.id]||"";return s.jsxs("div",{className:`rounded-lg border p-3 space-y-3 ${e==="dark"?"bg-[#18181b] border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":"bg-white border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 w-full",children:[s.jsx("div",{className:`text-xs font-medium ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,children:n.displayName||n.modelName||n.id}),s.jsx("div",{className:"ml-auto flex items-center justify-end",children:o?s.jsxs("select",{value:n.type||"Chat",onChange:W=>pr(n.id,{type:W.target.value}),className:`text-[9px] px-1 py-0.5 rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-300":"bg-white border-zinc-300 text-zinc-700"}`,disabled:!o,children:[s.jsx("option",{value:"Chat",children:"Chat"}),s.jsx("option",{value:"Image",children:"Image"}),s.jsx("option",{value:"ChatImage",children:"Chat Image"}),s.jsx("option",{value:"Video",children:"Video"})]}):s.jsx("span",{className:`text-[9px] px-1.5 py-0.5 rounded ${e==="dark"?"bg-zinc-800 text-zinc-300":e==="solarized"?"bg-[#eee8d5] text-zinc-600":"bg-zinc-100 text-zinc-600"}`,children:n.type||"Chat"})})]}),s.jsxs("div",{className:"text-[9px] text-zinc-500",children:["ID",n.modelName||n.id]})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("button",{onClick:()=>Wz(n.id),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:u?"":"",children:s.jsx(Eh,{size:12,className:u?"text-blue-500":""})}),s.jsx("button",{onClick:()=>Hz(n.id),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:l?"":"",children:s.jsx(Kr,{size:12,className:`transition-transform ${l?"":"rotate-180"}`})}),s.jsx("button",{onClick:()=>Bz(n.id,!o),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:o?"":"",children:o?s.jsx(rl,{size:12}):s.jsx($h,{size:12})}),s.jsx("button",{onClick:()=>Fz(n.id),className:`p-1 ${e==="dark"?"text-zinc-500 hover:text-red-400":"text-zinc-400 hover:text-red-500"}`,title:"",children:s.jsx(cs,{size:12})})]})]}),!l&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[s.jsxs("div",{className:"col-span-5 space-y-1",children:[s.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsx("input",{className:`w-full text-xs rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,value:n.displayName||"",onChange:W=>pr(n.id,{displayName:W.target.value}),placeholder:"",disabled:!o})]}),s.jsxs("div",{className:"col-span-5 space-y-1",children:[s.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"ID"}),s.jsx("input",{className:`w-full text-xs rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,value:n.modelName||"",onChange:W=>pr(n.id,{modelName:W.target.value}),placeholder:"gemini-3-pro-image-preview",disabled:!o})]}),s.jsxs("div",{className:"col-span-2 space-y-1",children:[s.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("select",{value:n.apiType||"openai",onChange:W=>pr(n.id,{apiType:W.target.value}),className:`w-full text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,disabled:!o,children:[s.jsx("option",{value:"openai",children:"OpenAI"}),s.jsx("option",{value:"gemini",children:"Gemini"}),s.jsx("option",{value:"modelscope",children:"ModelScope"})]})]})]}),ns(n.type)&&s.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[s.jsxs("div",{className:"col-span-6",children:[s.jsx(ec,{label:"",values:m,onChange:W=>{const Se={...h};Object.keys(Se).forEach(ze=>{W.includes(ze)||delete Se[ze]}),pr(n.id,{ratioLimits:W,ratioNotes:Se})},placeholder:"1:1,16:9",disabled:!o,inputDisabled:!o||p,theme:e,allowAllLabel:"",allowAll:p,onToggleAll:W=>pr(n.id,{ratioLimits:W?null:[]}),formatItem:W=>Lr(W,x,h)}),m.length>0&&s.jsxs("div",{className:"mt-1 space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:x,onChange:W=>pr(n.id,{ratioNotesEnabled:W.target.checked}),disabled:!o}),s.jsx("span",{children:""})]}),s.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:""}),s.jsx("button",{onClick:()=>Kl(n.id,"ratio"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:qr(n.id,"ratio")?"":"",children:s.jsx(Kr,{size:12,className:`transition-transform ${qr(n.id,"ratio")?"":"rotate-180"}`})})]}),x&&!qr(n.id,"ratio")&&m.map(W=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:W,children:W}),s.jsx("input",{value:h[W]||"",onChange:Se=>{const ze={...h},Ee=Se.target.value;Ee?ze[W]=Ee:delete ze[W],pr(n.id,{ratioNotes:ze})},placeholder:"1:1 / ",disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},W))]})]}),s.jsxs("div",{className:"col-span-6",children:[s.jsx(ec,{label:"",values:b,onChange:W=>{const Se={...v};Object.keys(Se).forEach(ze=>{W.includes(ze)||delete Se[ze]}),pr(n.id,{resolutionLimits:W,resolutionNotes:Se})},placeholder:"1K,2K,4K",disabled:!o,theme:e,normalizeItem:W=>Qd(W),formatItem:W=>Lr(W,y,v)}),b.length>0&&s.jsxs("div",{className:"mt-1 space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:y,onChange:W=>pr(n.id,{resolutionNotesEnabled:W.target.checked}),disabled:!o}),s.jsx("span",{children:""})]}),s.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:""}),s.jsx("button",{onClick:()=>Kl(n.id,"resolution"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:qr(n.id,"resolution")?"":"",children:s.jsx(Kr,{size:12,className:`transition-transform ${qr(n.id,"resolution")?"":"rotate-180"}`})})]}),y&&!qr(n.id,"resolution")&&b.map(W=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:W,children:W}),s.jsx("input",{value:v[W]||"",onChange:Se=>{const ze={...v},Ee=Se.target.value;Ee?ze[W]=Ee:delete ze[W],pr(n.id,{resolutionNotes:ze})},placeholder:"1:1 / ",disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},W))]})]})]}),n.type==="Video"&&s.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[s.jsxs("div",{className:"col-span-4",children:[s.jsx(ec,{label:"",values:m,onChange:W=>{const Se={...h};Object.keys(Se).forEach(ze=>{W.includes(ze)||delete Se[ze]}),pr(n.id,{ratioLimits:W,ratioNotes:Se})},placeholder:"16:9,9:16",disabled:!o,inputDisabled:!o||p,theme:e,allowAllLabel:"",allowAll:p,onToggleAll:W=>pr(n.id,{ratioLimits:W?null:[]}),formatItem:W=>Lr(W,x,h)}),m.length>0&&s.jsxs("div",{className:"mt-1 space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:x,onChange:W=>pr(n.id,{ratioNotesEnabled:W.target.checked}),disabled:!o}),s.jsx("span",{children:""})]}),s.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:""}),s.jsx("button",{onClick:()=>Kl(n.id,"ratio"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:qr(n.id,"ratio")?"":"",children:s.jsx(Kr,{size:12,className:`transition-transform ${qr(n.id,"ratio")?"":"rotate-180"}`})})]}),x&&!qr(n.id,"ratio")&&m.map(W=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:W,children:W}),s.jsx("input",{value:h[W]||"",onChange:Se=>{const ze={...h},Ee=Se.target.value;Ee?ze[W]=Ee:delete ze[W],pr(n.id,{ratioNotes:ze})},placeholder:"16:9 / ",disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},W))]})]}),s.jsxs("div",{className:"col-span-4",children:[s.jsx(ec,{label:"",values:w,onChange:W=>{const Se={...j};Object.keys(Se).forEach(ze=>{W.includes(ze)||delete Se[ze]}),pr(n.id,{durations:W,durationNotes:Se})},placeholder:"5s,10s",disabled:!o,theme:e,normalizeItem:W=>{const Se=String(W).trim();return Se.endsWith("s")?Se:`${Se}s`},formatItem:W=>Lr(W,R,j)}),w.length>0&&s.jsxs("div",{className:"mt-1 space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:R,onChange:W=>pr(n.id,{durationNotesEnabled:W.target.checked}),disabled:!o}),s.jsx("span",{children:""})]}),s.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:""}),s.jsx("button",{onClick:()=>Kl(n.id,"duration"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:qr(n.id,"duration")?"":"",children:s.jsx(Kr,{size:12,className:`transition-transform ${qr(n.id,"duration")?"":"rotate-180"}`})})]}),R&&!qr(n.id,"duration")&&w.map(W=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:W,children:W}),s.jsx("input",{value:j[W]||"",onChange:Se=>{const ze={...j},Ee=Se.target.value;Ee?ze[W]=Ee:delete ze[W],pr(n.id,{durationNotes:ze})},placeholder:"5s / ",disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},W))]})]}),s.jsxs("div",{className:"col-span-4",children:[s.jsx(ec,{label:"",values:C,onChange:W=>{const Se={...H};Object.keys(Se).forEach(ze=>{W.includes(ze)||delete Se[ze]}),pr(n.id,{videoResolutions:W,videoResolutionNotes:Se})},placeholder:"720P,1080P",disabled:!o,theme:e,normalizeItem:W=>zo(W),formatItem:W=>Lr(W,B,H)}),C.length>0&&s.jsxs("div",{className:"mt-1 space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:B,onChange:W=>pr(n.id,{videoResolutionNotesEnabled:W.target.checked}),disabled:!o}),s.jsx("span",{children:""})]}),s.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:""}),s.jsx("button",{onClick:()=>Kl(n.id,"video-resolution"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:qr(n.id,"video-resolution")?"":"",children:s.jsx(Kr,{size:12,className:`transition-transform ${qr(n.id,"video-resolution")?"":"rotate-180"}`})})]}),B&&!qr(n.id,"video-resolution")&&C.map(W=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:W,children:W}),s.jsx("input",{value:H[W]||"",onChange:Se=>{const ze={...H},Ee=Se.target.value;Ee?ze[W]=Ee:delete ze[W],pr(n.id,{videoResolutionNotes:ze})},placeholder:"16:9 / ",disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},W))]})]}),s.jsxs("div",{className:"col-span-12 flex items-center gap-3 pt-1",children:[s.jsxs("label",{className:`flex items-center gap-1 text-[10px] ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:!!n.supportsFirstLastFrame,onChange:W=>pr(n.id,{supportsFirstLastFrame:W.target.checked}),className:"w-3 h-3 cursor-pointer",disabled:!o}),s.jsx("span",{children:""})]}),s.jsxs("label",{className:`flex items-center gap-1 text-[10px] ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:!!n.supportsHD,onChange:W=>pr(n.id,{supportsHD:W.target.checked}),className:"w-3 h-3 cursor-pointer",disabled:!o}),s.jsx("span",{children:"HD"})]})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("button",{onClick:()=>Oz(n.id),disabled:!o||L.length>=Td,className:`text-[9px] px-1.5 py-0.5 rounded ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-200 text-zinc-600 hover:bg-zinc-300"} ${!o||L.length>=Td?"opacity-50 cursor-not-allowed":""}`,children:["+  (",L.length,"/",Td,")"]})]}),L.length>0?s.jsx("div",{className:"space-y-2",children:L.map(W=>s.jsx("div",{className:`rounded-md border p-2 space-y-2 ${e==="dark"?"bg-zinc-900/60 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:(()=>{const Se=Array.isArray(W.values)?W.values:[],ze=W.valueNotes||{},Ee=!!W.notesEnabled;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("input",{value:W.name||"",onChange:Be=>od(n.id,W.id,{name:Be.target.value}),placeholder:" size / quality / model",disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`}),s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:!!W.override,onChange:Be=>od(n.id,W.id,{override:Be.target.checked}),disabled:!o}),s.jsx("span",{children:""})]}),s.jsx("button",{onClick:()=>Uz(n.id,W.id),disabled:!o,className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-red-400":"text-zinc-400 hover:text-red-500"} ${o?"":"opacity-40 cursor-not-allowed"}`,title:"",children:s.jsx(cs,{size:12})})]}),s.jsx(ec,{label:"",values:Se,onChange:Be=>{const nt={...ze};Object.keys(nt).forEach(st=>{Be.includes(st)||delete nt[st]}),od(n.id,W.id,{values:Be,valueNotes:nt})},placeholder:"1024x1024,2K,low,high",disabled:!o,theme:e,formatItem:Be=>pv(W,Be),maxItems:m_}),Se.length>0&&s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:""}),s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:Ee,onChange:Be=>od(n.id,W.id,{notesEnabled:Be.target.checked}),disabled:!o}),s.jsx("span",{children:""})]}),s.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:""}),s.jsx("button",{onClick:()=>Kl(n.id,`param-${W.id}`),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:qr(n.id,`param-${W.id}`)?"":"",children:s.jsx(Kr,{size:12,className:`transition-transform ${qr(n.id,`param-${W.id}`)?"":"rotate-180"}`})})]}),Ee&&!qr(n.id,`param-${W.id}`)&&Se.map(Be=>s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:Be,children:Be}),s.jsx("input",{value:ze[Be]||"",onChange:nt=>{const st={...ze},ht=nt.target.value;ht?st[Be]=ht:delete st[Be],od(n.id,W.id,{valueNotes:st})},placeholder:"1:1 / ",disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},Be))]})]})})()},W.id))}):s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:""})]}),u&&s.jsxs("div",{className:`rounded-md border p-2 ${e==="dark"?"bg-zinc-950/60 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-1",children:[s.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"JSON"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[s.jsx("input",{type:"checkbox",checked:!!n.previewOverrideEnabled,onChange:W=>pr(n.id,{previewOverrideEnabled:W.target.checked})}),s.jsx("span",{children:""})]}),s.jsx("button",{onClick:()=>{ee?(Il(W=>{const Se=new Set(W);return Se.delete(n.id),Se}),Ra(W=>{const{[n.id]:Se,...ze}=W;return ze})):(Il(W=>{const Se=new Set(W);return Se.add(n.id),Se}),Ra(W=>({...W,[n.id]:JSON.stringify(Z,null,2)})))},className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:ee?"":"",children:s.jsx(Xy,{size:12,className:ee?"text-blue-500":""})})]})]}),s.jsxs("div",{className:`text-[9px] mb-1 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:["Endpoint: ",oe]}),ee?s.jsxs("div",{className:"space-y-2",children:[s.jsx("textarea",{value:ce,onChange:W=>Ra(Se=>({...Se,[n.id]:W.target.value})),className:`w-full h-40 text-[9px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-200":"bg-white border-zinc-300 text-zinc-800"}`}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[s.jsx("button",{onClick:()=>{try{const W=ce?JSON.parse(ce):{};if(!W||typeof W!="object"||Array.isArray(W))throw new Error(" JSON ");const Se=b_(J,W);pr(n.id,{previewOverridePatch:Se}),Il(ze=>{const Ee=new Set(ze);return Ee.delete(n.id),Ee}),Ra(ze=>{const{[n.id]:Ee,...Be}=ze;return Be}),a("","success",2e3)}catch{a("JSON ","error",2e3)}},className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-700 text-zinc-200 hover:bg-zinc-600":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"}`,children:""}),s.jsx("button",{onClick:()=>{Il(W=>{const Se=new Set(W);return Se.delete(n.id),Se}),Ra(W=>{const{[n.id]:Se,...ze}=W;return ze})},className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-500 hover:bg-zinc-200"}`,children:""})]})]}):s.jsx("pre",{className:`text-[9px] whitespace-pre-wrap ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:JSON.stringify(Z,null,2)}),s.jsx("div",{className:`text-[9px] mt-2 mb-1 ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"Python "}),s.jsx("pre",{className:`text-[9px] whitespace-pre-wrap ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:te})]})]})]},n.id)})}),s.jsx("p",{className:"text-[9px] text-zinc-500",children:"ID"})]}),s.jsx("div",{className:`pt-2 flex justify-end gap-2 border-t mt-3 ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:s.jsx(Vp,{variant:"secondary",onClick:()=>ei(!1),children:""})})]}),gz&&s.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[s.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>{Uu(!1),Da(new Set)}}),s.jsxs("div",{className:`relative w-[90vw] h-[85vh] max-w-7xl rounded-lg shadow-2xl flex flex-col ${e==="dark"?"bg-[#121214] border border-zinc-800":e==="solarized"?"bg-[#eee8d5] border border-[#d7cfb2]":"bg-white border border-zinc-200"}`,children:[s.jsxs("div",{className:`p-4 border-b flex items-center justify-between ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("h2",{className:`text-lg font-bold ${e==="dark"?"text-zinc-100":"text-zinc-900"}`,children:""}),s.jsxs("span",{className:`text-sm ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:[" ",Wr.size," "]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{Wr.size===kt.length?Da(new Set):Da(new Set(kt.map(n=>n.id)))},className:`px-3 py-1.5 text-xs rounded transition-colors ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-700 hover:bg-zinc-200"}`,children:Wr.size===kt.length?"":""}),s.jsxs("button",{onClick:()=>{Wr.size!==0&&confirm(` ${Wr.size} `)&&(gt(n=>{const o=n.filter(l=>!Wr.has(l.id));try{localStorage.setItem("tapnow_history",JSON.stringify(o))}catch(l){console.error(":",l)}return o}),Da(new Set))},disabled:Wr.size===0,className:`px-3 py-1.5 text-xs rounded transition-colors flex items-center gap-1.5 ${Wr.size===0?e==="dark"?"bg-zinc-800/50 text-zinc-600 cursor-not-allowed":"bg-zinc-100 text-zinc-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700"}`,children:[s.jsx(cs,{size:14}),""]}),s.jsxs("button",{onClick:async()=>{if(Wr.size===0)return;const n=(kn||"").replace(/\/+$/,"");if(!n){a("","error");return}const l=kt.filter(u=>Wr.has(u.id)).map(u=>u.localFilePath||u.localCacheUrl).filter(Boolean);if(l.length===0){a("","warning");return}try{const u=await fetch(`${n}/delete-batch`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:l})});if(!u.ok){const m=await u.text();throw new Error(m||"")}const p=await u.json();gt(m=>m.map(h=>Wr.has(h.id)?{...h,localCacheUrl:null,localFilePath:null}:h)),a((p==null?void 0:p.message)||` ${l.length} `,"success")}catch(u){a(`: ${u.message||""}`,"error")}},disabled:Wr.size===0,className:`px-3 py-1.5 text-xs rounded transition-colors flex items-center gap-1.5 ${Wr.size===0?e==="dark"?"bg-zinc-800/50 text-zinc-600 cursor-not-allowed":"bg-zinc-100 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-amber-600/30 text-amber-200 hover:bg-amber-600/40":"bg-amber-100 text-amber-600 hover:bg-amber-200"}`,children:[s.jsx(cs,{size:14}),""]}),s.jsxs("button",{onClick:async()=>{if(Wr.size===0)return;const n=kt.filter(p=>Wr.has(p.id)&&(p.url||p.localCacheUrl||p.originalUrl||p.mjOriginalUrl));if(n.length===0){alert("");return}const o=Pn(window.innerWidth/2,window.innerHeight/2),l=o.x,u=o.y;n.forEach((p,m)=>{const h=m%5*20,x=Math.floor(m/5)*20;let b=p.localCacheUrl||p.url||p.originalUrl||p.mjOriginalUrl;p.type==="video"&&!Qt(b)&&(b+=(b.includes("?")?"&":"?")+"force_video_display=true"),p.type==="image"?(async()=>{try{const v=await Fr(b);Ur("input-image",l+h,u+x,null,b,v)}catch{Ur("input-image",l+h,u+x,null,b)}})():p.type==="video"&&Ur("video-input",l+h,u+x,null,b)}),Uu(!1),Da(new Set)},disabled:Wr.size===0,className:`px-3 py-1.5 text-xs rounded transition-colors flex items-center gap-1.5 ${Wr.size===0?e==="dark"?"bg-zinc-800/50 text-zinc-600 cursor-not-allowed":"bg-zinc-100 text-zinc-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[s.jsx(Sh,{size:14}),""]}),s.jsx("button",{onClick:()=>{Uu(!1),Da(new Set)},className:`p-1.5 rounded transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,children:s.jsx(Ws,{size:18})})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4",children:s.jsx("div",{className:"grid grid-cols-4 gap-4",children:kt.map(n=>{var te,ee,ce,W,Se;const o=Wr.has(n.id),l=n.modelName||((te=n.apiConfig)==null?void 0:te.modelId)||((ee=n.apiConfig)==null?void 0:ee.model)||((ce=n.apiConfig)==null?void 0:ce.modelName)||n.model||"",u=l.length>12?`${l.slice(0,9)}...`:l,p=(ir?n.localCacheUrl||(n.localCacheMap?Object.values(n.localCacheMap)[0]:null):null)||n.url||n.originalUrl||n.mjOriginalUrl,m=n.mjImages&&n.mjImages.length>0?n.mjImages:n.output_images&&n.output_images.length>0?n.output_images:null,h=m?m.map(ze=>ir&&n.localCacheMap&&n.localCacheMap[ze]?n.localCacheMap[ze]:ze):null,x=typeof n.selectedMjImageIndex=="number"?n.selectedMjImageIndex:0,b=h?Math.min(x,h.length-1):0,v=h&&h.length>=4?h.slice(0,4):null,y=v?Math.min(b,v.length-1):0,w=h?h[b]||h[0]:p,j=!!(ir&&(n.localCacheUrl||n.localFilePath||n.localCacheMap&&Object.keys(n.localCacheMap).length>0)),R=n.type==="video"||(w?Qt(w):!1),C=n.ratio||n.mjRatio||"",H=n.resolution||(n.width&&n.height?`${n.width}x${n.height}`:""),B=H?H.replace(/p$/i,""):"",L=R&&n.duration?`${String(n.duration).replace(/s$/i,"")}s`:"",Y=[C,B].filter(Boolean);R&&L&&Y.push(L);const J=Y.join("/"),q=n.startTime?new Date(n.startTime).toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"}):n.time||"",Z=typeof n.durationMs=="number"&&n.durationMs>0?`${(n.durationMs/6e4).toFixed(1)}m`:"",oe=R?n.hasInputImages?"":"":n.hasInputImages?"":"";return s.jsxs("div",{className:`relative rounded-lg overflow-hidden border-2 transition-all ${o?"border-blue-500 shadow-lg shadow-blue-500/20":e==="dark"?"border-zinc-800 hover:border-zinc-700":"border-zinc-200 hover:border-zinc-300"}`,children:[s.jsxs("div",{className:"absolute top-2 right-2 z-10 flex items-center gap-1.5",children:[o&&s.jsx("div",{className:"bg-blue-500 rounded-full p-1",children:s.jsx(rl,{size:16,className:"text-white"})}),n.status==="completed"&&w&&s.jsx("button",{onClick:ze=>{ze.stopPropagation();const Ee={...n,url:w,selectedMjImageIndex:m&&m.length>1?b:void 0};cr(Ee)},className:`p-1.5 rounded-full transition-colors backdrop-blur-sm ${e==="dark"?"bg-black/60 text-white hover:bg-black/80":"bg-white/80 text-zinc-700 hover:bg-white"}`,title:" ()",children:s.jsx(Ri,{size:14})})]}),s.jsxs("div",{className:`relative ${n.mjImages&&(n.mjImages.length===4||n.mjImages.length>1)||n.mjNeedsSplit&&((Se=(W=n.apiConfig)==null?void 0:W.modelId)!=null&&Se.includes("mj"))?(()=>{const ze=n.mjRatio||"1:1";return ze==="16:9"?"aspect-video":ze==="9:16"?"aspect-[9/16]":ze==="4:3"?"aspect-[4/3]":ze==="3:4"?"aspect-[3/4]":ze==="21:9"?"aspect-[21/9]":"aspect-square"})():"aspect-video"} ${e==="dark"?"bg-zinc-900":"bg-zinc-100"}`,children:[j&&s.jsx("div",{className:"absolute top-2 left-2 z-10 text-[9px] px-2 py-0.5 rounded bg-orange-500 text-white shadow",children:""}),n.status==="completed"&&(w||v&&v.length>0)?R?s.jsx("video",{src:w,className:"w-full h-full object-contain",controls:!0,playsInline:!0,preload:"metadata"}):v&&v.length>0?s.jsx("div",{className:"grid grid-cols-2 grid-rows-2 w-full h-full",children:v.map((ze,Ee)=>{const Be=y===Ee;return s.jsxs("div",{className:`relative w-full h-full cursor-pointer ${Be?"ring-2 ring-blue-400":""}`,onClick:nt=>{nt.stopPropagation(),gt(st=>st.map(ht=>ht.id===n.id?{...ht,selectedMjImageIndex:Ee}:ht))},onDoubleClick:nt=>{nt.preventDefault(),nt.stopPropagation(),cr({...n,url:ze,selectedMjImageIndex:Ee})},children:[s.jsx(mr,{src:ze,className:`w-full h-full object-cover ${Be?"opacity-80":""}`,alt:`-${Ee+1}`}),Be&&s.jsx("div",{className:"absolute inset-0 bg-black/20 pointer-events-none"}),s.jsx("div",{className:"absolute bottom-1 left-1 bg-black/60 text-white text-[9px] px-1.5 py-0.5 rounded",children:Ee+1})]},`${n.id}-${Ee}`)})}):s.jsx(mr,{src:w,className:"w-full h-full object-contain",alt:"",onError:ze=>{ze.target.style.display="none"}}):s.jsx("div",{className:`w-full h-full flex items-center justify-center ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:n.status==="generating"?s.jsx(wo,{size:24,className:"animate-spin"}):s.jsx(O5,{size:24})})]}),s.jsxs("div",{onClick:()=>{const ze=new Set(Wr);o?ze.delete(n.id):ze.add(n.id),Da(ze)},className:`p-2 text-xs cursor-pointer ${e==="dark"?"bg-zinc-900 text-zinc-300":"bg-zinc-50 text-zinc-700"}`,children:[s.jsx("div",{className:"truncate font-medium",children:n.prompt||""}),s.jsxs("div",{className:"text-[10px] opacity-70 mt-0.5",children:[s.jsxs("span",{children:[oe," "]}),s.jsx("span",{title:l,children:u}),J&&s.jsxs("span",{children:["  ",J]}),q&&s.jsxs("span",{children:["  ",q]}),Z&&s.jsxs("span",{children:["  ",Z]})]})]})]},n.id)})})})]})]})]})]})]}),s.jsx("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-[9999] flex flex-col gap-2 pointer-events-none",children:r.map(n=>s.jsx("div",{className:`px-4 py-2 rounded-lg shadow-lg text-sm font-medium pointer-events-auto animate-pulse ${n.type==="success"?"bg-green-600 text-white":n.type==="error"?"bg-red-600 text-white":n.type==="warning"?"bg-yellow-500 text-black":"bg-zinc-800 text-white"}`,children:n.message},n.id))})]})}Dh.createRoot(document.getElementById("root")).render(s.jsx(Df.StrictMode,{children:s.jsx(I_,{})}));</script>
  <style rel="stylesheet" crossorigin>*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.\!visible{visibility:visible!important}.visible{visibility:visible}.collapse{visibility:collapse}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.-bottom-0\.5{bottom:-.125rem}.-bottom-1\.5{bottom:-.375rem}.-left-1{left:-.25rem}.-right-0\.5{right:-.125rem}.-right-1{right:-.25rem}.-right-2\.5{right:-.625rem}.-top-1{top:-.25rem}.-top-1\.5{top:-.375rem}.-top-10{top:-2.5rem}.-top-2\.5{top:-.625rem}.bottom-0{bottom:0}.bottom-1{bottom:.25rem}.bottom-2{bottom:.5rem}.bottom-4{bottom:1rem}.bottom-8{bottom:2rem}.bottom-full{bottom:100%}.left-0{left:0}.left-1{left:.25rem}.left-1\/2{left:50%}.left-2{left:.5rem}.left-4{left:1rem}.left-6{left:1.5rem}.left-full{left:100%}.right-0{right:0}.right-1{right:.25rem}.right-2{right:.5rem}.right-4{right:1rem}.top-0{top:0}.top-1{top:.25rem}.top-1\/2{top:50%}.top-12{top:3rem}.top-2{top:.5rem}.top-20{top:5rem}.top-4{top:1rem}.top-full{top:100%}.z-10{z-index:10}.z-20{z-index:20}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.z-\[100\]{z-index:100}.z-\[110\]{z-index:110}.z-\[120\]{z-index:120}.z-\[200\]{z-index:200}.z-\[60\]{z-index:60}.z-\[9999\]{z-index:9999}.col-span-12{grid-column:span 12 / span 12}.col-span-2{grid-column:span 2 / span 2}.col-span-3{grid-column:span 3 / span 3}.col-span-4{grid-column:span 4 / span 4}.col-span-5{grid-column:span 5 / span 5}.col-span-6{grid-column:span 6 / span 6}.col-span-full{grid-column:1 / -1}.m-3{margin:.75rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.-mb-1{margin-bottom:-.25rem}.-mt-1{margin-top:-.25rem}.mb-0{margin-bottom:0}.mb-0\.5{margin-bottom:.125rem}.mb-1{margin-bottom:.25rem}.mb-1\.5{margin-bottom:.375rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-auto{margin-bottom:auto}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-3{margin-left:.75rem}.ml-auto{margin-left:auto}.mr-0{margin-right:0}.mr-1{margin-right:.25rem}.mr-1\.5{margin-right:.375rem}.mr-2{margin-right:.5rem}.mt-0\.5{margin-top:.125rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-auto{margin-top:auto}.line-clamp-1{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}.line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.aspect-\[21\/9\]{aspect-ratio:21/9}.aspect-\[3\/4\]{aspect-ratio:3/4}.aspect-\[4\/3\]{aspect-ratio:4/3}.aspect-\[9\/16\]{aspect-ratio:9/16}.aspect-square{aspect-ratio:1 / 1}.aspect-video{aspect-ratio:16 / 9}.h-0{height:0px}.h-1{height:.25rem}.h-1\.5{height:.375rem}.h-10{height:2.5rem}.h-12{height:3rem}.h-14{height:3.5rem}.h-16{height:4rem}.h-2{height:.5rem}.h-20{height:5rem}.h-24{height:6rem}.h-28{height:7rem}.h-3{height:.75rem}.h-4{height:1rem}.h-40{height:10rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-7{height:1.75rem}.h-8{height:2rem}.h-\[2px\]{height:2px}.h-\[85vh\]{height:85vh}.h-\[90px\]{height:90px}.h-auto{height:auto}.h-full{height:100%}.h-px{height:1px}.h-screen{height:100vh}.max-h-32{max-height:8rem}.max-h-36{max-height:9rem}.max-h-40{max-height:10rem}.max-h-64{max-height:16rem}.max-h-80{max-height:20rem}.max-h-\[140px\]{max-height:140px}.max-h-\[300px\]{max-height:300px}.max-h-\[50vh\]{max-height:50vh}.max-h-\[60vh\]{max-height:60vh}.max-h-\[85vh\]{max-height:85vh}.max-h-\[90vh\]{max-height:90vh}.max-h-full{max-height:100%}.min-h-0{min-height:0px}.min-h-\[100px\]{min-height:100px}.min-h-\[14rem\]{min-height:14rem}.min-h-\[18px\]{min-height:18px}.min-h-\[70px\]{min-height:70px}.min-h-\[80px\]{min-height:80px}.w-0{width:0px}.w-0\.5{width:.125rem}.w-1{width:.25rem}.w-1\.5{width:.375rem}.w-10{width:2.5rem}.w-11{width:2.75rem}.w-12{width:3rem}.w-14{width:3.5rem}.w-16{width:4rem}.w-2{width:.5rem}.w-20{width:5rem}.w-24{width:6rem}.w-3{width:.75rem}.w-32{width:8rem}.w-36{width:9rem}.w-4{width:1rem}.w-40{width:10rem}.w-48{width:12rem}.w-5{width:1.25rem}.w-52{width:13rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-7{width:1.75rem}.w-72{width:18rem}.w-8{width:2rem}.w-9{width:2.25rem}.w-96{width:24rem}.w-\[500px\]{width:500px}.w-\[680px\]{width:680px}.w-\[90vw\]{width:90vw}.w-auto{width:auto}.w-full{width:100%}.w-max{width:-moz-max-content;width:max-content}.min-w-0{min-width:0px}.min-w-\[100px\]{min-width:100px}.min-w-\[120px\]{min-width:120px}.min-w-\[300px\]{min-width:300px}.max-w-7xl{max-width:80rem}.max-w-\[150px\]{max-width:150px}.max-w-\[200px\]{max-width:200px}.max-w-\[360px\]{max-width:360px}.max-w-\[85\%\]{max-width:85%}.max-w-\[90vw\]{max-width:90vw}.max-w-full{max-width:100%}.max-w-xl{max-width:36rem}.flex-1{flex:1 1 0%}.shrink-0{flex-shrink:0}.border-collapse{border-collapse:collapse}.origin-top-left{transform-origin:top left}.-translate-x-1\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-0{--tw-translate-x: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-full{--tw-translate-x: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-180{--tw-rotate: 180deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-90{--tw-rotate: 90deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-110{--tw-scale-x: 1.1;--tw-scale-y: 1.1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-75{--tw-scale-x: .75;--tw-scale-y: .75;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-90{--tw-scale-x: .9;--tw-scale-y: .9;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-95{--tw-scale-x: .95;--tw-scale-y: .95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes bounce{0%,to{transform:translateY(-25%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,.2,1)}}.animate-bounce{animation:bounce 1s infinite}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes spin{to{transform:rotate(360deg)}}.cursor-col-resize{cursor:col-resize}.cursor-default{cursor:default}.cursor-ew-resize{cursor:ew-resize}.cursor-move{cursor:move}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.cursor-text{cursor:text}.resize-none{resize:none}.resize{resize:both}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-rows-2{grid-template-rows:repeat(2,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.flex-nowrap{flex-wrap:nowrap}.content-start{align-content:flex-start}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-stretch{align-items:stretch}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0{gap:0px}.gap-0\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\.5{gap:.375rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.-space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(-.5rem * var(--tw-space-x-reverse));margin-left:calc(-.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-1\.5>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.375rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.375rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-visible{overflow:visible}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.break-words{overflow-wrap:break-word}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-xl{border-radius:.75rem}.rounded-bl{border-bottom-left-radius:.25rem}.rounded-br{border-bottom-right-radius:.25rem}.rounded-tl-none{border-top-left-radius:0}.rounded-tr{border-top-right-radius:.25rem}.rounded-tr-none{border-top-right-radius:0}.\!border{border-width:1px!important}.border{border-width:1px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l{border-left-width:1px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-dashed{border-style:dashed}.\!border-\[\#525252\]{--tw-border-opacity: 1 !important;border-color:rgb(82 82 82 / var(--tw-border-opacity, 1))!important}.border-\[\#18181b\]{--tw-border-opacity: 1;border-color:rgb(24 24 27 / var(--tw-border-opacity, 1))}.border-\[\#525252\]{--tw-border-opacity: 1;border-color:rgb(82 82 82 / var(--tw-border-opacity, 1))}.border-\[\#d7cfb2\]{--tw-border-opacity: 1;border-color:rgb(215 207 178 / var(--tw-border-opacity, 1))}.border-\[\#eee8d5\]{--tw-border-opacity: 1;border-color:rgb(238 232 213 / var(--tw-border-opacity, 1))}.border-amber-200{--tw-border-opacity: 1;border-color:rgb(253 230 138 / var(--tw-border-opacity, 1))}.border-amber-500\/30{border-color:#f59e0b4d}.border-blue-200{--tw-border-opacity: 1;border-color:rgb(191 219 254 / var(--tw-border-opacity, 1))}.border-blue-300{--tw-border-opacity: 1;border-color:rgb(147 197 253 / var(--tw-border-opacity, 1))}.border-blue-400{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.border-blue-500\/30{border-color:#3b82f64d}.border-blue-800{--tw-border-opacity: 1;border-color:rgb(30 64 175 / var(--tw-border-opacity, 1))}.border-emerald-200{--tw-border-opacity: 1;border-color:rgb(167 243 208 / var(--tw-border-opacity, 1))}.border-emerald-300{--tw-border-opacity: 1;border-color:rgb(110 231 183 / var(--tw-border-opacity, 1))}.border-emerald-500{--tw-border-opacity: 1;border-color:rgb(16 185 129 / var(--tw-border-opacity, 1))}.border-emerald-500\/20{border-color:#10b98133}.border-emerald-500\/30{border-color:#10b9814d}.border-gray-300{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-green-300{--tw-border-opacity: 1;border-color:rgb(134 239 172 / var(--tw-border-opacity, 1))}.border-green-400{--tw-border-opacity: 1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-purple-200{--tw-border-opacity: 1;border-color:rgb(233 213 255 / var(--tw-border-opacity, 1))}.border-purple-500\/20{border-color:#a855f733}.border-purple-800{--tw-border-opacity: 1;border-color:rgb(107 33 168 / var(--tw-border-opacity, 1))}.border-red-200{--tw-border-opacity: 1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1))}.border-red-400{--tw-border-opacity: 1;border-color:rgb(248 113 113 / var(--tw-border-opacity, 1))}.border-red-500\/30{border-color:#ef44444d}.border-red-500\/50{border-color:#ef444480}.border-red-800{--tw-border-opacity: 1;border-color:rgb(153 27 27 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.border-violet-200{--tw-border-opacity: 1;border-color:rgb(221 214 254 / var(--tw-border-opacity, 1))}.border-white{--tw-border-opacity: 1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.border-white\/10{border-color:#ffffff1a}.border-white\/60{border-color:#fff9}.border-white\/70{border-color:#ffffffb3}.border-white\/80{border-color:#fffc}.border-zinc-200{--tw-border-opacity: 1;border-color:rgb(228 228 231 / var(--tw-border-opacity, 1))}.border-zinc-300{--tw-border-opacity: 1;border-color:rgb(212 212 216 / var(--tw-border-opacity, 1))}.border-zinc-400{--tw-border-opacity: 1;border-color:rgb(161 161 170 / var(--tw-border-opacity, 1))}.border-zinc-500\/60{border-color:#71717a99}.border-zinc-600{--tw-border-opacity: 1;border-color:rgb(82 82 91 / var(--tw-border-opacity, 1))}.border-zinc-700{--tw-border-opacity: 1;border-color:rgb(63 63 70 / var(--tw-border-opacity, 1))}.border-zinc-700\/40{border-color:#3f3f4666}.border-zinc-700\/50{border-color:#3f3f4680}.border-zinc-800{--tw-border-opacity: 1;border-color:rgb(39 39 42 / var(--tw-border-opacity, 1))}.border-zinc-800\/50{border-color:#27272a80}.\!bg-\[\#616161\]{--tw-bg-opacity: 1 !important;background-color:rgb(97 97 97 / var(--tw-bg-opacity, 1))!important}.bg-\[\#09090b\]{--tw-bg-opacity: 1;background-color:rgb(9 9 11 / var(--tw-bg-opacity, 1))}.bg-\[\#09090b\]\/90{background-color:#09090be6}.bg-\[\#121214\]{--tw-bg-opacity: 1;background-color:rgb(18 18 20 / var(--tw-bg-opacity, 1))}.bg-\[\#18181b\]{--tw-bg-opacity: 1;background-color:rgb(24 24 27 / var(--tw-bg-opacity, 1))}.bg-\[\#616161\]{--tw-bg-opacity: 1;background-color:rgb(97 97 97 / var(--tw-bg-opacity, 1))}.bg-\[\#616161\]\/60{background-color:#61616199}.bg-\[\#eee8d5\]{--tw-bg-opacity: 1;background-color:rgb(238 232 213 / var(--tw-bg-opacity, 1))}.bg-\[\#fafafa\]{--tw-bg-opacity: 1;background-color:rgb(250 250 250 / var(--tw-bg-opacity, 1))}.bg-\[\#fdf6e3\]{--tw-bg-opacity: 1;background-color:rgb(253 246 227 / var(--tw-bg-opacity, 1))}.bg-amber-100{--tw-bg-opacity: 1;background-color:rgb(254 243 199 / var(--tw-bg-opacity, 1))}.bg-amber-50{--tw-bg-opacity: 1;background-color:rgb(255 251 235 / var(--tw-bg-opacity, 1))}.bg-amber-500\/30{background-color:#f59e0b4d}.bg-amber-600\/20{background-color:#d9770633}.bg-amber-600\/30{background-color:#d977064d}.bg-black{--tw-bg-opacity: 1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-black\/20{background-color:#0003}.bg-black\/40{background-color:#0006}.bg-black\/50{background-color:#00000080}.bg-black\/60{background-color:#0009}.bg-black\/70{background-color:#000000b3}.bg-black\/80{background-color:#000c}.bg-blue-100{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-blue-500\/10{background-color:#3b82f61a}.bg-blue-500\/20{background-color:#3b82f633}.bg-blue-500\/30{background-color:#3b82f64d}.bg-blue-500\/5{background-color:#3b82f60d}.bg-blue-600{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-blue-600\/20{background-color:#2563eb33}.bg-blue-600\/30{background-color:#2563eb4d}.bg-blue-600\/80{background-color:#2563ebcc}.bg-blue-900\/20{background-color:#1e3a8a33}.bg-blue-900\/30{background-color:#1e3a8a4d}.bg-emerald-50{--tw-bg-opacity: 1;background-color:rgb(236 253 245 / var(--tw-bg-opacity, 1))}.bg-emerald-500\/10{background-color:#10b9811a}.bg-emerald-500\/15{background-color:#10b98126}.bg-emerald-500\/20{background-color:#10b98133}.bg-emerald-600\/25{background-color:#05966940}.bg-green-100{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-500\/20{background-color:#22c55e33}.bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-green-600\/40{background-color:#16a34a66}.bg-orange-100{--tw-bg-opacity: 1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1))}.bg-orange-500{--tw-bg-opacity: 1;background-color:rgb(249 115 22 / var(--tw-bg-opacity, 1))}.bg-orange-500\/20{background-color:#f9731633}.bg-orange-600\/30{background-color:#ea580c4d}.bg-purple-50{--tw-bg-opacity: 1;background-color:rgb(250 245 255 / var(--tw-bg-opacity, 1))}.bg-purple-500{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity: 1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-purple-600\/80{background-color:#9333eacc}.bg-purple-900\/30{background-color:#581c874d}.bg-red-100{--tw-bg-opacity: 1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.bg-red-50{--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-red-500\/10{background-color:#ef44441a}.bg-red-500\/30{background-color:#ef44444d}.bg-red-500\/80{background-color:#ef4444cc}.bg-red-600{--tw-bg-opacity: 1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.bg-red-600\/20{background-color:#dc262633}.bg-red-600\/30{background-color:#dc26264d}.bg-red-600\/80{background-color:#dc2626cc}.bg-red-900\/30{background-color:#7f1d1d4d}.bg-red-900\/40{background-color:#7f1d1d66}.bg-transparent{background-color:transparent}.bg-violet-50{--tw-bg-opacity: 1;background-color:rgb(245 243 255 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/10{background-color:#ffffff1a}.bg-white\/40{background-color:#fff6}.bg-white\/80{background-color:#fffc}.bg-white\/90{background-color:#ffffffe6}.bg-yellow-500{--tw-bg-opacity: 1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.bg-yellow-600{--tw-bg-opacity: 1;background-color:rgb(202 138 4 / var(--tw-bg-opacity, 1))}.bg-zinc-100{--tw-bg-opacity: 1;background-color:rgb(244 244 245 / var(--tw-bg-opacity, 1))}.bg-zinc-200{--tw-bg-opacity: 1;background-color:rgb(228 228 231 / var(--tw-bg-opacity, 1))}.bg-zinc-300{--tw-bg-opacity: 1;background-color:rgb(212 212 216 / var(--tw-bg-opacity, 1))}.bg-zinc-400{--tw-bg-opacity: 1;background-color:rgb(161 161 170 / var(--tw-bg-opacity, 1))}.bg-zinc-50{--tw-bg-opacity: 1;background-color:rgb(250 250 250 / var(--tw-bg-opacity, 1))}.bg-zinc-50\/50{background-color:#fafafa80}.bg-zinc-500{--tw-bg-opacity: 1;background-color:rgb(113 113 122 / var(--tw-bg-opacity, 1))}.bg-zinc-600{--tw-bg-opacity: 1;background-color:rgb(82 82 91 / var(--tw-bg-opacity, 1))}.bg-zinc-700{--tw-bg-opacity: 1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.bg-zinc-700\/50{background-color:#3f3f4680}.bg-zinc-800{--tw-bg-opacity: 1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}.bg-zinc-800\/40{background-color:#27272a66}.bg-zinc-800\/50{background-color:#27272a80}.bg-zinc-800\/60{background-color:#27272a99}.bg-zinc-900{--tw-bg-opacity: 1;background-color:rgb(24 24 27 / var(--tw-bg-opacity, 1))}.bg-zinc-900\/30{background-color:#18181b4d}.bg-zinc-900\/40{background-color:#18181b66}.bg-zinc-900\/50{background-color:#18181b80}.bg-zinc-900\/60{background-color:#18181b99}.bg-zinc-900\/80{background-color:#18181bcc}.bg-zinc-900\/90{background-color:#18181be6}.bg-zinc-950{--tw-bg-opacity: 1;background-color:rgb(9 9 11 / var(--tw-bg-opacity, 1))}.bg-zinc-950\/50{background-color:#09090b80}.bg-zinc-950\/60{background-color:#09090b99}.bg-opacity-50{--tw-bg-opacity: .5}.bg-gradient-to-br{background-image:linear-gradient(to bottom right,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-blue-600{--tw-gradient-from: #2563eb var(--tw-gradient-from-position);--tw-gradient-to: rgb(37 99 235 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-green-600{--tw-gradient-from: #16a34a var(--tw-gradient-from-position);--tw-gradient-to: rgb(22 163 74 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-600{--tw-gradient-from: #9333ea var(--tw-gradient-from-position);--tw-gradient-to: rgb(147 51 234 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.to-emerald-600{--tw-gradient-to: #059669 var(--tw-gradient-to-position)}.to-indigo-600{--tw-gradient-to: #4f46e5 var(--tw-gradient-to-position)}.fill-current{fill:currentColor}.object-contain{-o-object-fit:contain;object-fit:contain}.object-cover{-o-object-fit:cover;object-fit:cover}.p-0{padding:0}.p-0\.5{padding:.125rem}.p-1{padding:.25rem}.p-1\.5{padding:.375rem}.p-2{padding:.5rem}.p-2\.5{padding:.625rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-8{padding:2rem}.px-0\.5{padding-left:.125rem;padding-right:.125rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\.5{padding-left:.375rem;padding-right:.375rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\.5{padding-top:.375rem;padding-bottom:.375rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-2\.5{padding-top:.625rem;padding-bottom:.625rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pb-1{padding-bottom:.25rem}.pb-2{padding-bottom:.5rem}.pb-3{padding-bottom:.75rem}.pl-1{padding-left:.25rem}.pl-2{padding-left:.5rem}.pl-6{padding-left:1.5rem}.pl-8{padding-left:2rem}.pr-1{padding-right:.25rem}.pr-2{padding-right:.5rem}.pr-8{padding-right:2rem}.pt-1{padding-top:.25rem}.pt-2{padding-top:.5rem}.pt-3{padding-top:.75rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-sans{font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-\[10px\]{font-size:10px}.text-\[11px\]{font-size:11px}.text-\[7px\]{font-size:7px}.text-\[8px\]{font-size:8px}.text-\[9px\]{font-size:9px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.leading-none{line-height:1}.leading-snug{line-height:1.375}.leading-tight{line-height:1.25}.tracking-\[0\.3em\]{letter-spacing:.3em}.tracking-tighter{letter-spacing:-.05em}.tracking-wide{letter-spacing:.025em}.tracking-wider{letter-spacing:.05em}.tracking-widest{letter-spacing:.1em}.\!text-\[\#fdf6e3\]{--tw-text-opacity: 1 !important;color:rgb(253 246 227 / var(--tw-text-opacity, 1))!important}.text-\[\#586e75\]{--tw-text-opacity: 1;color:rgb(88 110 117 / var(--tw-text-opacity, 1))}.text-\[\#616161\]{--tw-text-opacity: 1;color:rgb(97 97 97 / var(--tw-text-opacity, 1))}.text-\[\#fdf6e3\]{--tw-text-opacity: 1;color:rgb(253 246 227 / var(--tw-text-opacity, 1))}.text-\[\#fdf6e3\]\/60{color:#fdf6e399}.text-amber-200{--tw-text-opacity: 1;color:rgb(253 230 138 / var(--tw-text-opacity, 1))}.text-amber-400{--tw-text-opacity: 1;color:rgb(251 191 36 / var(--tw-text-opacity, 1))}.text-amber-600{--tw-text-opacity: 1;color:rgb(217 119 6 / var(--tw-text-opacity, 1))}.text-black{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity, 1))}.text-blue-200{--tw-text-opacity: 1;color:rgb(191 219 254 / var(--tw-text-opacity, 1))}.text-blue-300{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-blue-500{--tw-text-opacity: 1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity: 1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-cyan-500{--tw-text-opacity: 1;color:rgb(6 182 212 / var(--tw-text-opacity, 1))}.text-emerald-200{--tw-text-opacity: 1;color:rgb(167 243 208 / var(--tw-text-opacity, 1))}.text-emerald-500{--tw-text-opacity: 1;color:rgb(16 185 129 / var(--tw-text-opacity, 1))}.text-emerald-600{--tw-text-opacity: 1;color:rgb(5 150 105 / var(--tw-text-opacity, 1))}.text-emerald-700{--tw-text-opacity: 1;color:rgb(4 120 87 / var(--tw-text-opacity, 1))}.text-green-200{--tw-text-opacity: 1;color:rgb(187 247 208 / var(--tw-text-opacity, 1))}.text-green-300{--tw-text-opacity: 1;color:rgb(134 239 172 / var(--tw-text-opacity, 1))}.text-green-400{--tw-text-opacity: 1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-green-500{--tw-text-opacity: 1;color:rgb(34 197 94 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity: 1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity: 1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-orange-200{--tw-text-opacity: 1;color:rgb(254 215 170 / var(--tw-text-opacity, 1))}.text-orange-400{--tw-text-opacity: 1;color:rgb(251 146 60 / var(--tw-text-opacity, 1))}.text-orange-600{--tw-text-opacity: 1;color:rgb(234 88 12 / var(--tw-text-opacity, 1))}.text-purple-300{--tw-text-opacity: 1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.text-purple-400{--tw-text-opacity: 1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.text-purple-500{--tw-text-opacity: 1;color:rgb(168 85 247 / var(--tw-text-opacity, 1))}.text-purple-600{--tw-text-opacity: 1;color:rgb(147 51 234 / var(--tw-text-opacity, 1))}.text-purple-700{--tw-text-opacity: 1;color:rgb(126 34 206 / var(--tw-text-opacity, 1))}.text-red-200{--tw-text-opacity: 1;color:rgb(254 202 202 / var(--tw-text-opacity, 1))}.text-red-300{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity: 1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-white\/70{color:#ffffffb3}.text-yellow-300{--tw-text-opacity: 1;color:rgb(253 224 71 / var(--tw-text-opacity, 1))}.text-yellow-600{--tw-text-opacity: 1;color:rgb(202 138 4 / var(--tw-text-opacity, 1))}.text-yellow-700{--tw-text-opacity: 1;color:rgb(161 98 7 / var(--tw-text-opacity, 1))}.text-zinc-100{--tw-text-opacity: 1;color:rgb(244 244 245 / var(--tw-text-opacity, 1))}.text-zinc-200{--tw-text-opacity: 1;color:rgb(228 228 231 / var(--tw-text-opacity, 1))}.text-zinc-300{--tw-text-opacity: 1;color:rgb(212 212 216 / var(--tw-text-opacity, 1))}.text-zinc-400{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.text-zinc-500{--tw-text-opacity: 1;color:rgb(113 113 122 / var(--tw-text-opacity, 1))}.text-zinc-600{--tw-text-opacity: 1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.text-zinc-700{--tw-text-opacity: 1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.text-zinc-800{--tw-text-opacity: 1;color:rgb(39 39 42 / var(--tw-text-opacity, 1))}.text-zinc-900{--tw-text-opacity: 1;color:rgb(24 24 27 / var(--tw-text-opacity, 1))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.placeholder-zinc-400::-moz-placeholder{--tw-placeholder-opacity: 1;color:rgb(161 161 170 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-400::placeholder{--tw-placeholder-opacity: 1;color:rgb(161 161 170 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-500::-moz-placeholder{--tw-placeholder-opacity: 1;color:rgb(113 113 122 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-500::placeholder{--tw-placeholder-opacity: 1;color:rgb(113 113 122 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-600::-moz-placeholder{--tw-placeholder-opacity: 1;color:rgb(82 82 91 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-600::placeholder{--tw-placeholder-opacity: 1;color:rgb(82 82 91 / var(--tw-placeholder-opacity, 1))}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-20{opacity:.2}.opacity-30{opacity:.3}.opacity-40{opacity:.4}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.opacity-70{opacity:.7}.opacity-80{opacity:.8}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-2xl{--tw-shadow: 0 25px 50px -12px rgb(0 0 0 / .25);--tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_10px_rgba\(0\,0\,0\,0\.5\)\]{--tw-shadow: 0 0 10px rgba(0,0,0,.5);--tw-shadow-colored: 0 0 10px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_10px_rgba\(255\,255\,255\,0\.5\)\]{--tw-shadow: 0 0 10px rgba(255,255,255,.5);--tw-shadow-colored: 0 0 10px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_8px_rgba\(239\,68\,68\,0\.8\)\]{--tw-shadow: 0 0 8px rgba(239,68,68,.8);--tw-shadow-colored: 0 0 8px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_8px_rgba\(34\,197\,94\,0\.6\)\]{--tw-shadow: 0 0 8px rgba(34,197,94,.6);--tw-shadow-colored: 0 0 8px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_8px_rgba\(34\,197\,94\,0\.8\)\]{--tw-shadow: 0 0 8px rgba(34,197,94,.8);--tw-shadow-colored: 0 0 8px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-inner{--tw-shadow: inset 0 2px 4px 0 rgb(0 0 0 / .05);--tw-shadow-colored: inset 0 2px 4px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow: 0 20px 25px -5px rgb(0 0 0 / .1), 0 8px 10px -6px rgb(0 0 0 / .1);--tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-black\/10{--tw-shadow-color: rgb(0 0 0 / .1);--tw-shadow: var(--tw-shadow-colored)}.shadow-black\/40{--tw-shadow-color: rgb(0 0 0 / .4);--tw-shadow: var(--tw-shadow-colored)}.shadow-blue-300\/30{--tw-shadow-color: rgb(147 197 253 / .3);--tw-shadow: var(--tw-shadow-colored)}.shadow-blue-500\/20{--tw-shadow-color: rgb(59 130 246 / .2);--tw-shadow: var(--tw-shadow-colored)}.shadow-blue-900\/20{--tw-shadow-color: rgb(30 58 138 / .2);--tw-shadow: var(--tw-shadow-colored)}.outline-none{outline:2px solid transparent;outline-offset:2px}.ring-1{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-blue-300\/60{--tw-ring-color: rgb(147 197 253 / .6)}.ring-blue-400{--tw-ring-opacity: 1;--tw-ring-color: rgb(96 165 250 / var(--tw-ring-opacity, 1))}.ring-blue-500{--tw-ring-opacity: 1;--tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity, 1))}.ring-blue-500\/30{--tw-ring-color: rgb(59 130 246 / .3)}.ring-blue-500\/50{--tw-ring-color: rgb(59 130 246 / .5)}.ring-green-500\/50{--tw-ring-color: rgb(34 197 94 / .5)}.ring-offset-2{--tw-ring-offset-width: 2px}.blur{--tw-blur: blur(8px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.blur-\[50px\]{--tw-blur: blur(50px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-md{--tw-drop-shadow: drop-shadow(0 4px 3px rgb(0 0 0 / .07)) drop-shadow(0 2px 2px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.grayscale{--tw-grayscale: grayscale(100%);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur-\[2px\]{--tw-backdrop-blur: blur(2px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-md{--tw-backdrop-blur: blur(12px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur: blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-xl{--tw-backdrop-blur: blur(24px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-filter{-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-shadow{transition-property:box-shadow;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-100{transition-duration:.1s}.duration-150{transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.ease-linear{transition-timing-function:linear}.will-change-transform{will-change:transform}body{margin:0;padding:0;background-color:#09090b}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.select-text{-webkit-user-select:text;-moz-user-select:text;user-select:text}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.art-loader-container{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#09090b;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;color:#e4e4e7}.art-center-group{display:flex;flex-direction:column;align-items:center;transform:translateY(-20px)}.art-visual{position:relative;width:60px;height:60px;margin-bottom:30px}.art-ring-outer{position:absolute;top:0;right:0;bottom:0;left:0;border:1px solid rgba(255,255,255,.1);border-radius:50%;animation:art-breathe 4s ease-in-out infinite}.art-ring-inner{position:absolute;top:0;right:0;bottom:0;left:0;border-radius:50%;border:1px solid transparent;border-top-color:#fff;border-left-color:#ffffff4d;opacity:.8;animation:art-spin 2s cubic-bezier(.4,0,.2,1) infinite}.art-dot{position:absolute;top:50%;left:50%;width:4px;height:4px;background-color:#fff;border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 0 10px #ffffff80}.art-title{font-size:12px;font-weight:300;text-transform:uppercase;letter-spacing:.3em;opacity:.9;margin-bottom:8px}.art-status{font-family:Courier New,monospace;font-size:10px;color:#71717a;letter-spacing:.1em;animation:art-pulse 2s ease-in-out infinite}.art-footer{position:absolute;bottom:40px;display:flex;flex-direction:column;align-items:center;text-align:center;gap:12px;opacity:0;animation:art-fade-up 1s ease-out .5s forwards}.footer-author{display:flex;flex-direction:column;gap:4px}.footer-author .label{font-size:9px;color:#52525b;text-transform:uppercase;letter-spacing:.2em}.footer-author .name{font-size:14px;font-weight:500;letter-spacing:.5em;color:#fff;text-indent:.5em}.footer-divider{width:20px;height:1px;background-color:#27272a}.footer-thanks{display:flex;flex-direction:column;gap:2px}.footer-thanks .label{font-size:8px;color:#3f3f46;text-transform:uppercase;letter-spacing:.1em}.footer-thanks .content{font-size:10px;color:#71717a;font-family:Courier New,monospace}.footer-thanks .highlight{color:#a1a1aa;font-weight:600}@keyframes art-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes art-breathe{0%,to{transform:scale(1);opacity:.5}50%{transform:scale(1.1);opacity:.2}}@keyframes art-pulse{0%,to{opacity:.4}50%{opacity:.8}}@keyframes art-fade-up{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}.markdown-body{line-height:1.5}.markdown-body p{margin:0}.markdown-body p+p{margin-top:.5em}.markdown-body ul,.markdown-body ol{margin:.5em 0;padding-left:1.5em}.markdown-body pre{margin:.5em 0;padding:.5em;border-radius:.5em;overflow-x:auto}.markdown-body code{font-size:.875em}.placeholder\:text-zinc-400::-moz-placeholder{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-400::placeholder{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-600::-moz-placeholder{--tw-text-opacity: 1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-600::placeholder{--tw-text-opacity: 1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-700::-moz-placeholder{--tw-text-opacity: 1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-700::placeholder{--tw-text-opacity: 1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.placeholder\:text-opacity-50::-moz-placeholder{--tw-text-opacity: .5}.placeholder\:text-opacity-50::placeholder{--tw-text-opacity: .5}.after\:absolute:after{content:var(--tw-content);position:absolute}.after\:left-\[2px\]:after{content:var(--tw-content);left:2px}.after\:top-\[2px\]:after{content:var(--tw-content);top:2px}.after\:h-4:after{content:var(--tw-content);height:1rem}.after\:h-5:after{content:var(--tw-content);height:1.25rem}.after\:w-4:after{content:var(--tw-content);width:1rem}.after\:w-5:after{content:var(--tw-content);width:1.25rem}.after\:rounded-full:after{content:var(--tw-content);border-radius:9999px}.after\:bg-white:after{content:var(--tw-content);--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.after\:transition-all:after{content:var(--tw-content);transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.after\:content-\[\'\'\]:after{--tw-content: "";content:var(--tw-content)}.focus-within\:border-blue-500\/30:focus-within{border-color:#3b82f64d}.focus-within\:border-blue-500\/50:focus-within{border-color:#3b82f680}.hover\:h-6:hover{height:1.5rem}.hover\:scale-100:hover{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-\[\#d7cfb2\]:hover{--tw-border-opacity: 1;border-color:rgb(215 207 178 / var(--tw-border-opacity, 1))}.hover\:border-blue-300:hover{--tw-border-opacity: 1;border-color:rgb(147 197 253 / var(--tw-border-opacity, 1))}.hover\:border-blue-400:hover{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.hover\:border-blue-500:hover{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.hover\:border-blue-500\/30:hover{border-color:#3b82f64d}.hover\:border-blue-500\/50:hover{border-color:#3b82f680}.hover\:border-green-400:hover{--tw-border-opacity: 1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.hover\:border-green-500:hover{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.hover\:border-zinc-300:hover{--tw-border-opacity: 1;border-color:rgb(212 212 216 / var(--tw-border-opacity, 1))}.hover\:border-zinc-400:hover{--tw-border-opacity: 1;border-color:rgb(161 161 170 / var(--tw-border-opacity, 1))}.hover\:border-zinc-500:hover{--tw-border-opacity: 1;border-color:rgb(113 113 122 / var(--tw-border-opacity, 1))}.hover\:border-zinc-600:hover{--tw-border-opacity: 1;border-color:rgb(82 82 91 / var(--tw-border-opacity, 1))}.hover\:border-zinc-700:hover{--tw-border-opacity: 1;border-color:rgb(63 63 70 / var(--tw-border-opacity, 1))}.hover\:\!bg-\[\#555555\]:hover{--tw-bg-opacity: 1 !important;background-color:rgb(85 85 85 / var(--tw-bg-opacity, 1))!important}.hover\:bg-\[\#4b4b4b\]:hover{--tw-bg-opacity: 1;background-color:rgb(75 75 75 / var(--tw-bg-opacity, 1))}.hover\:bg-\[\#555555\]:hover{--tw-bg-opacity: 1;background-color:rgb(85 85 85 / var(--tw-bg-opacity, 1))}.hover\:bg-\[\#eee8d5\]:hover{--tw-bg-opacity: 1;background-color:rgb(238 232 213 / var(--tw-bg-opacity, 1))}.hover\:bg-\[\#fdf6e3\]:hover{--tw-bg-opacity: 1;background-color:rgb(253 246 227 / var(--tw-bg-opacity, 1))}.hover\:bg-amber-100:hover{--tw-bg-opacity: 1;background-color:rgb(254 243 199 / var(--tw-bg-opacity, 1))}.hover\:bg-amber-200:hover{--tw-bg-opacity: 1;background-color:rgb(253 230 138 / var(--tw-bg-opacity, 1))}.hover\:bg-amber-600\/30:hover{background-color:#d977064d}.hover\:bg-amber-600\/40:hover{background-color:#d9770666}.hover\:bg-black\/70:hover{background-color:#000000b3}.hover\:bg-black\/80:hover{background-color:#000c}.hover\:bg-blue-100:hover{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-200:hover{--tw-bg-opacity: 1;background-color:rgb(191 219 254 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-400:hover{--tw-bg-opacity: 1;background-color:rgb(96 165 250 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-400\/30:hover{background-color:#60a5fa4d}.hover\:bg-blue-500:hover{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-500\/20:hover{background-color:#3b82f633}.hover\:bg-blue-500\/30:hover{background-color:#3b82f64d}.hover\:bg-blue-600:hover{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-600\/30:hover{background-color:#2563eb4d}.hover\:bg-blue-600\/50:hover{background-color:#2563eb80}.hover\:bg-blue-700:hover{--tw-bg-opacity: 1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-green-200:hover{--tw-bg-opacity: 1;background-color:rgb(187 247 208 / var(--tw-bg-opacity, 1))}.hover\:bg-green-400:hover{--tw-bg-opacity: 1;background-color:rgb(74 222 128 / var(--tw-bg-opacity, 1))}.hover\:bg-green-500:hover{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.hover\:bg-green-500\/30:hover{background-color:#22c55e4d}.hover\:bg-green-600:hover{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.hover\:bg-green-600\/60:hover{background-color:#16a34a99}.hover\:bg-orange-200:hover{--tw-bg-opacity: 1;background-color:rgb(254 215 170 / var(--tw-bg-opacity, 1))}.hover\:bg-orange-500\/30:hover{background-color:#f973164d}.hover\:bg-orange-600\/40:hover{background-color:#ea580c66}.hover\:bg-purple-400:hover{--tw-bg-opacity: 1;background-color:rgb(192 132 252 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-500:hover{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.hover\:bg-red-100:hover{--tw-bg-opacity: 1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.hover\:bg-red-200:hover{--tw-bg-opacity: 1;background-color:rgb(254 202 202 / var(--tw-bg-opacity, 1))}.hover\:bg-red-50:hover{--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.hover\:bg-red-500:hover{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.hover\:bg-red-500\/10:hover{background-color:#ef44441a}.hover\:bg-red-600:hover{--tw-bg-opacity: 1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.hover\:bg-red-600\/30:hover{background-color:#dc26264d}.hover\:bg-red-600\/50:hover{background-color:#dc262680}.hover\:bg-red-700:hover{--tw-bg-opacity: 1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:bg-red-800:hover{--tw-bg-opacity: 1;background-color:rgb(153 27 27 / var(--tw-bg-opacity, 1))}.hover\:bg-red-900\/60:hover{background-color:#7f1d1d99}.hover\:bg-white:hover{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.hover\:bg-white\/20:hover{background-color:#fff3}.hover\:bg-yellow-400:hover{--tw-bg-opacity: 1;background-color:rgb(250 204 21 / var(--tw-bg-opacity, 1))}.hover\:bg-yellow-500:hover{--tw-bg-opacity: 1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-100:hover{--tw-bg-opacity: 1;background-color:rgb(244 244 245 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-200:hover{--tw-bg-opacity: 1;background-color:rgb(228 228 231 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-300:hover{--tw-bg-opacity: 1;background-color:rgb(212 212 216 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-600:hover{--tw-bg-opacity: 1;background-color:rgb(82 82 91 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-700:hover{--tw-bg-opacity: 1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-800:hover{--tw-bg-opacity: 1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-800\/50:hover{background-color:#27272a80}.hover\:bg-zinc-800\/60:hover{background-color:#27272a99}.hover\:from-blue-500:hover{--tw-gradient-from: #3b82f6 var(--tw-gradient-from-position);--tw-gradient-to: rgb(59 130 246 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:from-green-500:hover{--tw-gradient-from: #22c55e var(--tw-gradient-from-position);--tw-gradient-to: rgb(34 197 94 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:from-purple-500:hover{--tw-gradient-from: #a855f7 var(--tw-gradient-from-position);--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:to-emerald-500:hover{--tw-gradient-to: #10b981 var(--tw-gradient-to-position)}.hover\:to-indigo-500:hover{--tw-gradient-to: #6366f1 var(--tw-gradient-to-position)}.hover\:text-blue-200:hover{--tw-text-opacity: 1;color:rgb(191 219 254 / var(--tw-text-opacity, 1))}.hover\:text-blue-300:hover{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.hover\:text-blue-400:hover{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.hover\:text-blue-500:hover{--tw-text-opacity: 1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.hover\:text-blue-600:hover{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.hover\:text-green-600:hover{--tw-text-opacity: 1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.hover\:text-red-300:hover{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.hover\:text-red-400:hover{--tw-text-opacity: 1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.hover\:text-red-500:hover{--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.hover\:text-red-600:hover{--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.hover\:text-white:hover{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\:text-zinc-200:hover{--tw-text-opacity: 1;color:rgb(228 228 231 / var(--tw-text-opacity, 1))}.hover\:text-zinc-300:hover{--tw-text-opacity: 1;color:rgb(212 212 216 / var(--tw-text-opacity, 1))}.hover\:text-zinc-600:hover{--tw-text-opacity: 1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.hover\:text-zinc-700:hover{--tw-text-opacity: 1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.hover\:text-zinc-800:hover{--tw-text-opacity: 1;color:rgb(39 39 42 / var(--tw-text-opacity, 1))}.hover\:text-zinc-900:hover{--tw-text-opacity: 1;color:rgb(24 24 27 / var(--tw-text-opacity, 1))}.hover\:underline:hover{text-decoration-line:underline}.hover\:opacity-100:hover{opacity:1}.hover\:shadow-md:hover{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.hover\:ring-1:hover{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.hover\:ring-zinc-400:hover{--tw-ring-opacity: 1;--tw-ring-color: rgb(161 161 170 / var(--tw-ring-opacity, 1))}.focus\:border-blue-500:focus{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.focus\:border-blue-500\/50:focus{border-color:#3b82f680}.focus\:border-blue-600\/50:focus{border-color:#2563eb80}.focus\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500\/50:focus{--tw-ring-color: rgb(59 130 246 / .5)}.active\:scale-95:active{--tw-scale-x: .95;--tw-scale-y: .95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:opacity-50:disabled{opacity:.5}.group\/insert:hover .group-hover\/insert\:scale-100{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:bg-\[\#e4dcc2\]{--tw-bg-opacity: 1;background-color:rgb(228 220 194 / var(--tw-bg-opacity, 1))}.group:hover .group-hover\:bg-blue-500{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.group:hover .group-hover\:bg-zinc-200{--tw-bg-opacity: 1;background-color:rgb(228 228 231 / var(--tw-bg-opacity, 1))}.group:hover .group-hover\:bg-zinc-800{--tw-bg-opacity: 1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}.group\/cell:hover .group-hover\/cell\:opacity-100,.group\/insert:hover .group-hover\/insert\:opacity-100,.group\/main:hover .group-hover\/main\:opacity-100,.group\/preview:hover .group-hover\/preview\:opacity-100,.group:hover .group-hover\:opacity-100{opacity:1}.peer:checked~.peer-checked\:after\:translate-x-full:after{content:var(--tw-content);--tw-translate-x: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.peer:checked~.peer-checked\:after\:border-white:after{content:var(--tw-content);--tw-border-opacity: 1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.peer:focus~.peer-focus\:outline-none{outline:2px solid transparent;outline-offset:2px}.peer:focus~.peer-focus\:ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.peer:focus~.peer-focus\:ring-blue-500\/50{--tw-ring-color: rgb(59 130 246 / .5)}@media (prefers-color-scheme: dark){.dark\:border-zinc-700{--tw-border-opacity: 1;border-color:rgb(63 63 70 / var(--tw-border-opacity, 1))}.dark\:bg-blue-900\/30{background-color:#1e3a8a4d}.dark\:bg-zinc-700{--tw-bg-opacity: 1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.dark\:text-blue-300{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.dark\:text-blue-400{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.dark\:text-zinc-200{--tw-text-opacity: 1;color:rgb(228 228 231 / var(--tw-text-opacity, 1))}.dark\:text-zinc-300{--tw-text-opacity: 1;color:rgb(212 212 216 / var(--tw-text-opacity, 1))}.dark\:text-zinc-400{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.dark\:hover\:bg-blue-900\/30:hover{background-color:#1e3a8a4d}.dark\:hover\:bg-zinc-700:hover{--tw-bg-opacity: 1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.dark\:hover\:bg-zinc-800:hover{--tw-bg-opacity: 1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}}</style>
</head>

<body style="margin: 0; padding: 0; background-color: #09090b;">
    <div id="root"></div>
</body>

</html>