# ============================================
# Tapnow Studio Docker Compose 配置
# ============================================
# 使用方法:
#   启动: docker-compose up -d
#   停止: docker-compose down
#   查看日志: docker-compose logs -f
#   重建: docker-compose up -d --build
# ============================================

version: '3.8'

services:
  tapnow:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: tapnow-studio
    ports:
      - "9527:9527"
    volumes:
      # 数据持久化
      - tapnow_data:/app/data
      # 可选: 挂载本地下载目录
      # - ~/Downloads/TapnowStudio:/app/downloads
    environment:
      # 功能开关
      - TAPNOW_ENABLE_FILE_SERVER=true
      - TAPNOW_ENABLE_PROXY=true
      - TAPNOW_ENABLE_COMFY=false
      - TAPNOW_ENABLE_LOG=true
    restart: unless-stopped
    # 健康检查
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:9527/ping')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

volumes:
  tapnow_data:
    driver: local
