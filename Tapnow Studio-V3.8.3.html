<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tapnow Studio</title>
  <script type="module" crossorigin>var cS=Object.defineProperty;var Tv=e=>{throw TypeError(e)};var dS=(e,t,n)=>t in e?cS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Nn=(e,t,n)=>dS(e,typeof t!="symbol"?t+"":t,n),uS=(e,t,n)=>t.has(e)||Tv("Cannot "+n);var Mv=(e,t,n)=>t.has(e)?Tv("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);var Df=(e,t,n)=>(uS(e,t,"access private method"),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();var ma=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Gw(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Yw={exports:{}},m0={},Xw={exports:{}},Or={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Op=Symbol.for("react.element"),pS=Symbol.for("react.portal"),fS=Symbol.for("react.fragment"),hS=Symbol.for("react.strict_mode"),mS=Symbol.for("react.profiler"),gS=Symbol.for("react.provider"),xS=Symbol.for("react.context"),bS=Symbol.for("react.forward_ref"),yS=Symbol.for("react.suspense"),vS=Symbol.for("react.memo"),wS=Symbol.for("react.lazy"),Rv=Symbol.iterator;function zS(e){return e===null||typeof e!="object"?null:(e=Rv&&e[Rv]||e["@@iterator"],typeof e=="function"?e:null)}var Zw={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Qw=Object.assign,ez={};function Rd(e,t,n){this.props=e,this.context=t,this.refs=ez,this.updater=n||Zw}Rd.prototype.isReactComponent={};Rd.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Rd.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function tz(){}tz.prototype=Rd.prototype;function Vx(e,t,n){this.props=e,this.context=t,this.refs=ez,this.updater=n||Zw}var Wx=Vx.prototype=new tz;Wx.constructor=Vx;Qw(Wx,Rd.prototype);Wx.isPureReactComponent=!0;var Ov=Array.isArray,rz=Object.prototype.hasOwnProperty,Kx={current:null},nz={key:!0,ref:!0,__self:!0,__source:!0};function sz(e,t,n){var s,a={},c=null,d=null;if(t!=null)for(s in t.ref!==void 0&&(d=t.ref),t.key!==void 0&&(c=""+t.key),t)rz.call(t,s)&&!nz.hasOwnProperty(s)&&(a[s]=t[s]);var h=arguments.length-2;if(h===1)a.children=n;else if(1<h){for(var g=Array(h),x=0;x<h;x++)g[x]=arguments[x+2];a.children=g}if(e&&e.defaultProps)for(s in h=e.defaultProps,h)a[s]===void 0&&(a[s]=h[s]);return{$$typeof:Op,type:e,key:c,ref:d,props:a,_owner:Kx.current}}function kS(e,t){return{$$typeof:Op,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Jx(e){return typeof e=="object"&&e!==null&&e.$$typeof===Op}function jS(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var Lv=/\/+/g;function Bm(e,t){return typeof e=="object"&&e!==null&&e.key!=null?jS(""+e.key):t.toString(36)}function wh(e,t,n,s,a){var c=typeof e;(c==="undefined"||c==="boolean")&&(e=null);var d=!1;if(e===null)d=!0;else switch(c){case"string":case"number":d=!0;break;case"object":switch(e.$$typeof){case Op:case pS:d=!0}}if(d)return d=e,a=a(d),e=s===""?"."+Bm(d,0):s,Ov(a)?(n="",e!=null&&(n=e.replace(Lv,"$&/")+"/"),wh(a,t,n,"",function(x){return x})):a!=null&&(Jx(a)&&(a=kS(a,n+(!a.key||d&&d.key===a.key?"":(""+a.key).replace(Lv,"$&/")+"/")+e)),t.push(a)),1;if(d=0,s=s===""?".":s+":",Ov(e))for(var h=0;h<e.length;h++){c=e[h];var g=s+Bm(c,h);d+=wh(c,t,n,g,a)}else if(g=zS(e),typeof g=="function")for(e=g.call(e),h=0;!(c=e.next()).done;)c=c.value,g=s+Bm(c,h++),d+=wh(c,t,n,g,a);else if(c==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return d}function Uf(e,t,n){if(e==null)return e;var s=[],a=0;return wh(e,s,"","",function(c){return t.call(n,c,a++)}),s}function NS(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ti={current:null},zh={transition:null},SS={ReactCurrentDispatcher:ti,ReactCurrentBatchConfig:zh,ReactCurrentOwner:Kx};function iz(){throw Error("act(...) is not supported in production builds of React.")}Or.Children={map:Uf,forEach:function(e,t,n){Uf(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return Uf(e,function(){t++}),t},toArray:function(e){return Uf(e,function(t){return t})||[]},only:function(e){if(!Jx(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Or.Component=Rd;Or.Fragment=fS;Or.Profiler=mS;Or.PureComponent=Vx;Or.StrictMode=hS;Or.Suspense=yS;Or.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SS;Or.act=iz;Or.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=Qw({},e.props),a=e.key,c=e.ref,d=e._owner;if(t!=null){if(t.ref!==void 0&&(c=t.ref,d=Kx.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var h=e.type.defaultProps;for(g in t)rz.call(t,g)&&!nz.hasOwnProperty(g)&&(s[g]=t[g]===void 0&&h!==void 0?h[g]:t[g])}var g=arguments.length-2;if(g===1)s.children=n;else if(1<g){h=Array(g);for(var x=0;x<g;x++)h[x]=arguments[x+2];s.children=h}return{$$typeof:Op,type:e.type,key:a,ref:c,props:s,_owner:d}};Or.createContext=function(e){return e={$$typeof:xS,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:gS,_context:e},e.Consumer=e};Or.createElement=sz;Or.createFactory=function(e){var t=sz.bind(null,e);return t.type=e,t};Or.createRef=function(){return{current:null}};Or.forwardRef=function(e){return{$$typeof:bS,render:e}};Or.isValidElement=Jx;Or.lazy=function(e){return{$$typeof:wS,_payload:{_status:-1,_result:e},_init:NS}};Or.memo=function(e,t){return{$$typeof:vS,type:e,compare:t===void 0?null:t}};Or.startTransition=function(e){var t=zh.transition;zh.transition={};try{e()}finally{zh.transition=t}};Or.unstable_act=iz;Or.useCallback=function(e,t){return ti.current.useCallback(e,t)};Or.useContext=function(e){return ti.current.useContext(e)};Or.useDebugValue=function(){};Or.useDeferredValue=function(e){return ti.current.useDeferredValue(e)};Or.useEffect=function(e,t){return ti.current.useEffect(e,t)};Or.useId=function(){return ti.current.useId()};Or.useImperativeHandle=function(e,t,n){return ti.current.useImperativeHandle(e,t,n)};Or.useInsertionEffect=function(e,t){return ti.current.useInsertionEffect(e,t)};Or.useLayoutEffect=function(e,t){return ti.current.useLayoutEffect(e,t)};Or.useMemo=function(e,t){return ti.current.useMemo(e,t)};Or.useReducer=function(e,t,n){return ti.current.useReducer(e,t,n)};Or.useRef=function(e){return ti.current.useRef(e)};Or.useState=function(e){return ti.current.useState(e)};Or.useSyncExternalStore=function(e,t,n){return ti.current.useSyncExternalStore(e,t,n)};Or.useTransition=function(){return ti.current.useTransition()};Or.version="18.3.1";Xw.exports=Or;var M=Xw.exports;const ic=Gw(M);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _S=M,CS=Symbol.for("react.element"),ES=Symbol.for("react.fragment"),IS=Object.prototype.hasOwnProperty,PS=_S.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$S={key:!0,ref:!0,__self:!0,__source:!0};function oz(e,t,n){var s,a={},c=null,d=null;n!==void 0&&(c=""+n),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(d=t.ref);for(s in t)IS.call(t,s)&&!$S.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps,t)a[s]===void 0&&(a[s]=t[s]);return{$$typeof:CS,type:e,key:c,ref:d,props:a,_owner:PS.current}}m0.Fragment=ES;m0.jsx=oz;m0.jsxs=oz;Yw.exports=m0;var i=Yw.exports,Dg={},az={exports:{}},Ti={},lz={exports:{}},cz={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(_e,be){var Xe=_e.length;_e.push(be);e:for(;0<Xe;){var de=Xe-1>>>1,fe=_e[de];if(0<a(fe,be))_e[de]=be,_e[Xe]=fe,Xe=de;else break e}}function n(_e){return _e.length===0?null:_e[0]}function s(_e){if(_e.length===0)return null;var be=_e[0],Xe=_e.pop();if(Xe!==be){_e[0]=Xe;e:for(var de=0,fe=_e.length,Ge=fe>>>1;de<Ge;){var gt=2*(de+1)-1,We=_e[gt],Ir=gt+1,Qr=_e[Ir];if(0>a(We,Xe))Ir<fe&&0>a(Qr,We)?(_e[de]=Qr,_e[Ir]=Xe,de=Ir):(_e[de]=We,_e[gt]=Xe,de=gt);else if(Ir<fe&&0>a(Qr,Xe))_e[de]=Qr,_e[Ir]=Xe,de=Ir;else break e}}return be}function a(_e,be){var Xe=_e.sortIndex-be.sortIndex;return Xe!==0?Xe:_e.id-be.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var d=Date,h=d.now();e.unstable_now=function(){return d.now()-h}}var g=[],x=[],N=1,C=null,A=3,_=!1,R=!1,$=!1,L=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function O(_e){for(var be=n(x);be!==null;){if(be.callback===null)s(x);else if(be.startTime<=_e)s(x),be.sortIndex=be.expirationTime,t(g,be);else break;be=n(x)}}function K(_e){if($=!1,O(_e),!R)if(n(g)!==null)R=!0,Ut(Q);else{var be=n(x);be!==null&&je(K,be.startTime-_e)}}function Q(_e,be){R=!1,$&&($=!1,S(we),we=-1),_=!0;var Xe=A;try{for(O(be),C=n(g);C!==null&&(!(C.expirationTime>be)||_e&&!ot());){var de=C.callback;if(typeof de=="function"){C.callback=null,A=C.priorityLevel;var fe=de(C.expirationTime<=be);be=e.unstable_now(),typeof fe=="function"?C.callback=fe:C===n(g)&&s(g),O(be)}else s(g);C=n(g)}if(C!==null)var Ge=!0;else{var gt=n(x);gt!==null&&je(K,gt.startTime-be),Ge=!1}return Ge}finally{C=null,A=Xe,_=!1}}var ue=!1,oe=null,we=-1,he=5,ze=-1;function ot(){return!(e.unstable_now()-ze<he)}function re(){if(oe!==null){var _e=e.unstable_now();ze=_e;var be=!0;try{be=oe(!0,_e)}finally{be?Se():(ue=!1,oe=null)}}else ue=!1}var Se;if(typeof P=="function")Se=function(){P(re)};else if(typeof MessageChannel<"u"){var D=new MessageChannel,Me=D.port2;D.port1.onmessage=re,Se=function(){Me.postMessage(null)}}else Se=function(){L(re,0)};function Ut(_e){oe=_e,ue||(ue=!0,Se())}function je(_e,be){we=L(function(){_e(e.unstable_now())},be)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(_e){_e.callback=null},e.unstable_continueExecution=function(){R||_||(R=!0,Ut(Q))},e.unstable_forceFrameRate=function(_e){0>_e||125<_e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):he=0<_e?Math.floor(1e3/_e):5},e.unstable_getCurrentPriorityLevel=function(){return A},e.unstable_getFirstCallbackNode=function(){return n(g)},e.unstable_next=function(_e){switch(A){case 1:case 2:case 3:var be=3;break;default:be=A}var Xe=A;A=be;try{return _e()}finally{A=Xe}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(_e,be){switch(_e){case 1:case 2:case 3:case 4:case 5:break;default:_e=3}var Xe=A;A=_e;try{return be()}finally{A=Xe}},e.unstable_scheduleCallback=function(_e,be,Xe){var de=e.unstable_now();switch(typeof Xe=="object"&&Xe!==null?(Xe=Xe.delay,Xe=typeof Xe=="number"&&0<Xe?de+Xe:de):Xe=de,_e){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=Xe+fe,_e={id:N++,callback:be,priorityLevel:_e,startTime:Xe,expirationTime:fe,sortIndex:-1},Xe>de?(_e.sortIndex=Xe,t(x,_e),n(g)===null&&_e===n(x)&&($?(S(we),we=-1):$=!0,je(K,Xe-de))):(_e.sortIndex=fe,t(g,_e),R||_||(R=!0,Ut(Q))),_e},e.unstable_shouldYield=ot,e.unstable_wrapCallback=function(_e){var be=A;return function(){var Xe=A;A=be;try{return _e.apply(this,arguments)}finally{A=Xe}}}})(cz);lz.exports=cz;var AS=lz.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TS=M,Ai=AS;function ct(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dz=new Set,bp={};function fc(e,t){Ed(e,t),Ed(e+"Capture",t)}function Ed(e,t){for(bp[e]=t,e=0;e<t.length;e++)dz.add(t[e])}var va=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ug=Object.prototype.hasOwnProperty,MS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Dv={},Uv={};function RS(e){return Ug.call(Uv,e)?!0:Ug.call(Dv,e)?!1:MS.test(e)?Uv[e]=!0:(Dv[e]=!0,!1)}function OS(e,t,n,s){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function LS(e,t,n,s){if(t===null||typeof t>"u"||OS(e,t,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ri(e,t,n,s,a,c,d){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=s,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=c,this.removeEmptyString=d}var Ts={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Ts[e]=new ri(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Ts[t]=new ri(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Ts[e]=new ri(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Ts[e]=new ri(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Ts[e]=new ri(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Ts[e]=new ri(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Ts[e]=new ri(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Ts[e]=new ri(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Ts[e]=new ri(e,5,!1,e.toLowerCase(),null,!1,!1)});var qx=/[\-:]([a-z])/g;function Gx(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(qx,Gx);Ts[t]=new ri(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(qx,Gx);Ts[t]=new ri(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(qx,Gx);Ts[t]=new ri(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Ts[e]=new ri(e,1,!1,e.toLowerCase(),null,!1,!1)});Ts.xlinkHref=new ri("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Ts[e]=new ri(e,1,!1,e.toLowerCase(),null,!0,!0)});function Yx(e,t,n,s){var a=Ts.hasOwnProperty(t)?Ts[t]:null;(a!==null?a.type!==0:s||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(LS(t,n,a,s)&&(n=null),s||a===null?RS(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,s=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}var ja=TS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ff=Symbol.for("react.element"),cd=Symbol.for("react.portal"),dd=Symbol.for("react.fragment"),Xx=Symbol.for("react.strict_mode"),Fg=Symbol.for("react.profiler"),uz=Symbol.for("react.provider"),pz=Symbol.for("react.context"),Zx=Symbol.for("react.forward_ref"),Bg=Symbol.for("react.suspense"),Hg=Symbol.for("react.suspense_list"),Qx=Symbol.for("react.memo"),sl=Symbol.for("react.lazy"),fz=Symbol.for("react.offscreen"),Fv=Symbol.iterator;function Eu(e){return e===null||typeof e!="object"?null:(e=Fv&&e[Fv]||e["@@iterator"],typeof e=="function"?e:null)}var Ln=Object.assign,Hm;function Yu(e){if(Hm===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);Hm=t&&t[1]||""}return`
`+Hm+e}var Vm=!1;function Wm(e,t){if(!e||Vm)return"";Vm=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(x){var s=x}Reflect.construct(e,[],t)}else{try{t.call()}catch(x){s=x}e.call(t.prototype)}else{try{throw Error()}catch(x){s=x}e()}}catch(x){if(x&&s&&typeof x.stack=="string"){for(var a=x.stack.split(`
`),c=s.stack.split(`
`),d=a.length-1,h=c.length-1;1<=d&&0<=h&&a[d]!==c[h];)h--;for(;1<=d&&0<=h;d--,h--)if(a[d]!==c[h]){if(d!==1||h!==1)do if(d--,h--,0>h||a[d]!==c[h]){var g=`
`+a[d].replace(" at new "," at ");return e.displayName&&g.includes("<anonymous>")&&(g=g.replace("<anonymous>",e.displayName)),g}while(1<=d&&0<=h);break}}}finally{Vm=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?Yu(e):""}function DS(e){switch(e.tag){case 5:return Yu(e.type);case 16:return Yu("Lazy");case 13:return Yu("Suspense");case 19:return Yu("SuspenseList");case 0:case 2:case 15:return e=Wm(e.type,!1),e;case 11:return e=Wm(e.type.render,!1),e;case 1:return e=Wm(e.type,!0),e;default:return""}}function Vg(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case dd:return"Fragment";case cd:return"Portal";case Fg:return"Profiler";case Xx:return"StrictMode";case Bg:return"Suspense";case Hg:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case pz:return(e.displayName||"Context")+".Consumer";case uz:return(e._context.displayName||"Context")+".Provider";case Zx:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Qx:return t=e.displayName||null,t!==null?t:Vg(e.type)||"Memo";case sl:t=e._payload,e=e._init;try{return Vg(e(t))}catch{}}return null}function US(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vg(t);case 8:return t===Xx?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function bl(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function hz(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function FS(e){var t=hz(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,c=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(d){s=""+d,c.call(this,d)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(d){s=""+d},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Bf(e){e._valueTracker||(e._valueTracker=FS(e))}function mz(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=hz(e)?e.checked?"true":"false":e.value),e=s,e!==n?(t.setValue(e),!0):!1}function Mh(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Wg(e,t){var n=t.checked;return Ln({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Bv(e,t){var n=t.defaultValue==null?"":t.defaultValue,s=t.checked!=null?t.checked:t.defaultChecked;n=bl(t.value!=null?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function gz(e,t){t=t.checked,t!=null&&Yx(e,"checked",t,!1)}function Kg(e,t){gz(e,t);var n=bl(t.value),s=t.type;if(n!=null)s==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(s==="submit"||s==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Jg(e,t.type,n):t.hasOwnProperty("defaultValue")&&Jg(e,t.type,bl(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Hv(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!(s!=="submit"&&s!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Jg(e,t,n){(t!=="number"||Mh(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var Xu=Array.isArray;function kd(e,t,n,s){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&s&&(e[n].defaultSelected=!0)}else{for(n=""+bl(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,s&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function qg(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(ct(91));return Ln({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Vv(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(ct(92));if(Xu(n)){if(1<n.length)throw Error(ct(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:bl(n)}}function xz(e,t){var n=bl(t.value),s=bl(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),s!=null&&(e.defaultValue=""+s)}function Wv(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function bz(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Gg(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?bz(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Hf,yz=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,s,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,s,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Hf=Hf||document.createElement("div"),Hf.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Hf.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function yp(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var np={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BS=["Webkit","ms","Moz","O"];Object.keys(np).forEach(function(e){BS.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),np[t]=np[e]})});function vz(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||np.hasOwnProperty(e)&&np[e]?(""+t).trim():t+"px"}function wz(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var s=n.indexOf("--")===0,a=vz(n,t[n],s);n==="float"&&(n="cssFloat"),s?e.setProperty(n,a):e[n]=a}}var HS=Ln({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yg(e,t){if(t){if(HS[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(ct(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(ct(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(ct(61))}if(t.style!=null&&typeof t.style!="object")throw Error(ct(62))}}function Xg(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zg=null;function eb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Qg=null,jd=null,Nd=null;function Kv(e){if(e=Up(e)){if(typeof Qg!="function")throw Error(ct(280));var t=e.stateNode;t&&(t=v0(t),Qg(e.stateNode,e.type,t))}}function zz(e){jd?Nd?Nd.push(e):Nd=[e]:jd=e}function kz(){if(jd){var e=jd,t=Nd;if(Nd=jd=null,Kv(e),t)for(e=0;e<t.length;e++)Kv(t[e])}}function jz(e,t){return e(t)}function Nz(){}var Km=!1;function Sz(e,t,n){if(Km)return e(t,n);Km=!0;try{return jz(e,t,n)}finally{Km=!1,(jd!==null||Nd!==null)&&(Nz(),kz())}}function vp(e,t){var n=e.stateNode;if(n===null)return null;var s=v0(n);if(s===null)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(e=e.type,s=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!s;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(ct(231,t,typeof n));return n}var ex=!1;if(va)try{var Iu={};Object.defineProperty(Iu,"passive",{get:function(){ex=!0}}),window.addEventListener("test",Iu,Iu),window.removeEventListener("test",Iu,Iu)}catch{ex=!1}function VS(e,t,n,s,a,c,d,h,g){var x=Array.prototype.slice.call(arguments,3);try{t.apply(n,x)}catch(N){this.onError(N)}}var sp=!1,Rh=null,Oh=!1,tx=null,WS={onError:function(e){sp=!0,Rh=e}};function KS(e,t,n,s,a,c,d,h,g){sp=!1,Rh=null,VS.apply(WS,arguments)}function JS(e,t,n,s,a,c,d,h,g){if(KS.apply(this,arguments),sp){if(sp){var x=Rh;sp=!1,Rh=null}else throw Error(ct(198));Oh||(Oh=!0,tx=x)}}function hc(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function _z(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Jv(e){if(hc(e)!==e)throw Error(ct(188))}function qS(e){var t=e.alternate;if(!t){if(t=hc(e),t===null)throw Error(ct(188));return t!==e?null:e}for(var n=e,s=t;;){var a=n.return;if(a===null)break;var c=a.alternate;if(c===null){if(s=a.return,s!==null){n=s;continue}break}if(a.child===c.child){for(c=a.child;c;){if(c===n)return Jv(a),e;if(c===s)return Jv(a),t;c=c.sibling}throw Error(ct(188))}if(n.return!==s.return)n=a,s=c;else{for(var d=!1,h=a.child;h;){if(h===n){d=!0,n=a,s=c;break}if(h===s){d=!0,s=a,n=c;break}h=h.sibling}if(!d){for(h=c.child;h;){if(h===n){d=!0,n=c,s=a;break}if(h===s){d=!0,s=c,n=a;break}h=h.sibling}if(!d)throw Error(ct(189))}}if(n.alternate!==s)throw Error(ct(190))}if(n.tag!==3)throw Error(ct(188));return n.stateNode.current===n?e:t}function Cz(e){return e=qS(e),e!==null?Ez(e):null}function Ez(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Ez(e);if(t!==null)return t;e=e.sibling}return null}var Iz=Ai.unstable_scheduleCallback,qv=Ai.unstable_cancelCallback,GS=Ai.unstable_shouldYield,YS=Ai.unstable_requestPaint,ts=Ai.unstable_now,XS=Ai.unstable_getCurrentPriorityLevel,tb=Ai.unstable_ImmediatePriority,Pz=Ai.unstable_UserBlockingPriority,Lh=Ai.unstable_NormalPriority,ZS=Ai.unstable_LowPriority,$z=Ai.unstable_IdlePriority,g0=null,Vo=null;function QS(e){if(Vo&&typeof Vo.onCommitFiberRoot=="function")try{Vo.onCommitFiberRoot(g0,e,void 0,(e.current.flags&128)===128)}catch{}}var zo=Math.clz32?Math.clz32:r5,e5=Math.log,t5=Math.LN2;function r5(e){return e>>>=0,e===0?32:31-(e5(e)/t5|0)|0}var Vf=64,Wf=4194304;function Zu(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Dh(e,t){var n=e.pendingLanes;if(n===0)return 0;var s=0,a=e.suspendedLanes,c=e.pingedLanes,d=n&268435455;if(d!==0){var h=d&~a;h!==0?s=Zu(h):(c&=d,c!==0&&(s=Zu(c)))}else d=n&~a,d!==0?s=Zu(d):c!==0&&(s=Zu(c));if(s===0)return 0;if(t!==0&&t!==s&&!(t&a)&&(a=s&-s,c=t&-t,a>=c||a===16&&(c&4194240)!==0))return t;if(s&4&&(s|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=s;0<t;)n=31-zo(t),a=1<<n,s|=e[n],t&=~a;return s}function n5(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function s5(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,a=e.expirationTimes,c=e.pendingLanes;0<c;){var d=31-zo(c),h=1<<d,g=a[d];g===-1?(!(h&n)||h&s)&&(a[d]=n5(h,t)):g<=t&&(e.expiredLanes|=h),c&=~h}}function rx(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Az(){var e=Vf;return Vf<<=1,!(Vf&4194240)&&(Vf=64),e}function Jm(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Lp(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-zo(t),e[t]=n}function i5(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-zo(n),c=1<<a;t[a]=0,s[a]=-1,e[a]=-1,n&=~c}}function rb(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-zo(n),a=1<<s;a&t|e[s]&t&&(e[s]|=t),n&=~a}}var dn=0;function Tz(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Mz,nb,Rz,Oz,Lz,nx=!1,Kf=[],dl=null,ul=null,pl=null,wp=new Map,zp=new Map,ol=[],o5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gv(e,t){switch(e){case"focusin":case"focusout":dl=null;break;case"dragenter":case"dragleave":ul=null;break;case"mouseover":case"mouseout":pl=null;break;case"pointerover":case"pointerout":wp.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":zp.delete(t.pointerId)}}function Pu(e,t,n,s,a,c){return e===null||e.nativeEvent!==c?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:c,targetContainers:[a]},t!==null&&(t=Up(t),t!==null&&nb(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function a5(e,t,n,s,a){switch(t){case"focusin":return dl=Pu(dl,e,t,n,s,a),!0;case"dragenter":return ul=Pu(ul,e,t,n,s,a),!0;case"mouseover":return pl=Pu(pl,e,t,n,s,a),!0;case"pointerover":var c=a.pointerId;return wp.set(c,Pu(wp.get(c)||null,e,t,n,s,a)),!0;case"gotpointercapture":return c=a.pointerId,zp.set(c,Pu(zp.get(c)||null,e,t,n,s,a)),!0}return!1}function Dz(e){var t=ec(e.target);if(t!==null){var n=hc(t);if(n!==null){if(t=n.tag,t===13){if(t=_z(n),t!==null){e.blockedOn=t,Lz(e.priority,function(){Rz(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function kh(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=sx(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var s=new n.constructor(n.type,n);Zg=s,n.target.dispatchEvent(s),Zg=null}else return t=Up(n),t!==null&&nb(t),e.blockedOn=n,!1;t.shift()}return!0}function Yv(e,t,n){kh(e)&&n.delete(t)}function l5(){nx=!1,dl!==null&&kh(dl)&&(dl=null),ul!==null&&kh(ul)&&(ul=null),pl!==null&&kh(pl)&&(pl=null),wp.forEach(Yv),zp.forEach(Yv)}function $u(e,t){e.blockedOn===t&&(e.blockedOn=null,nx||(nx=!0,Ai.unstable_scheduleCallback(Ai.unstable_NormalPriority,l5)))}function kp(e){function t(a){return $u(a,e)}if(0<Kf.length){$u(Kf[0],e);for(var n=1;n<Kf.length;n++){var s=Kf[n];s.blockedOn===e&&(s.blockedOn=null)}}for(dl!==null&&$u(dl,e),ul!==null&&$u(ul,e),pl!==null&&$u(pl,e),wp.forEach(t),zp.forEach(t),n=0;n<ol.length;n++)s=ol[n],s.blockedOn===e&&(s.blockedOn=null);for(;0<ol.length&&(n=ol[0],n.blockedOn===null);)Dz(n),n.blockedOn===null&&ol.shift()}var Sd=ja.ReactCurrentBatchConfig,Uh=!0;function c5(e,t,n,s){var a=dn,c=Sd.transition;Sd.transition=null;try{dn=1,sb(e,t,n,s)}finally{dn=a,Sd.transition=c}}function d5(e,t,n,s){var a=dn,c=Sd.transition;Sd.transition=null;try{dn=4,sb(e,t,n,s)}finally{dn=a,Sd.transition=c}}function sb(e,t,n,s){if(Uh){var a=sx(e,t,n,s);if(a===null)ng(e,t,s,Fh,n),Gv(e,s);else if(a5(a,e,t,n,s))s.stopPropagation();else if(Gv(e,s),t&4&&-1<o5.indexOf(e)){for(;a!==null;){var c=Up(a);if(c!==null&&Mz(c),c=sx(e,t,n,s),c===null&&ng(e,t,s,Fh,n),c===a)break;a=c}a!==null&&s.stopPropagation()}else ng(e,t,s,null,n)}}var Fh=null;function sx(e,t,n,s){if(Fh=null,e=eb(s),e=ec(e),e!==null)if(t=hc(e),t===null)e=null;else if(n=t.tag,n===13){if(e=_z(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Fh=e,null}function Uz(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XS()){case tb:return 1;case Pz:return 4;case Lh:case ZS:return 16;case $z:return 536870912;default:return 16}default:return 16}}var ll=null,ib=null,jh=null;function Fz(){if(jh)return jh;var e,t=ib,n=t.length,s,a="value"in ll?ll.value:ll.textContent,c=a.length;for(e=0;e<n&&t[e]===a[e];e++);var d=n-e;for(s=1;s<=d&&t[n-s]===a[c-s];s++);return jh=a.slice(e,1<s?1-s:void 0)}function Nh(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Jf(){return!0}function Xv(){return!1}function Mi(e){function t(n,s,a,c,d){this._reactName=n,this._targetInst=a,this.type=s,this.nativeEvent=c,this.target=d,this.currentTarget=null;for(var h in e)e.hasOwnProperty(h)&&(n=e[h],this[h]=n?n(c):c[h]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?Jf:Xv,this.isPropagationStopped=Xv,this}return Ln(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Jf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Jf)},persist:function(){},isPersistent:Jf}),t}var Od={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ob=Mi(Od),Dp=Ln({},Od,{view:0,detail:0}),u5=Mi(Dp),qm,Gm,Au,x0=Ln({},Dp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ab,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==Au&&(Au&&e.type==="mousemove"?(qm=e.screenX-Au.screenX,Gm=e.screenY-Au.screenY):Gm=qm=0,Au=e),qm)},movementY:function(e){return"movementY"in e?e.movementY:Gm}}),Zv=Mi(x0),p5=Ln({},x0,{dataTransfer:0}),f5=Mi(p5),h5=Ln({},Dp,{relatedTarget:0}),Ym=Mi(h5),m5=Ln({},Od,{animationName:0,elapsedTime:0,pseudoElement:0}),g5=Mi(m5),x5=Ln({},Od,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),b5=Mi(x5),y5=Ln({},Od,{data:0}),Qv=Mi(y5),v5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},w5={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},z5={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function k5(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=z5[e])?!!t[e]:!1}function ab(){return k5}var j5=Ln({},Dp,{key:function(e){if(e.key){var t=v5[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=Nh(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?w5[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ab,charCode:function(e){return e.type==="keypress"?Nh(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?Nh(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),N5=Mi(j5),S5=Ln({},x0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),e1=Mi(S5),_5=Ln({},Dp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ab}),C5=Mi(_5),E5=Ln({},Od,{propertyName:0,elapsedTime:0,pseudoElement:0}),I5=Mi(E5),P5=Ln({},x0,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),$5=Mi(P5),A5=[9,13,27,32],lb=va&&"CompositionEvent"in window,ip=null;va&&"documentMode"in document&&(ip=document.documentMode);var T5=va&&"TextEvent"in window&&!ip,Bz=va&&(!lb||ip&&8<ip&&11>=ip),t1=" ",r1=!1;function Hz(e,t){switch(e){case"keyup":return A5.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vz(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ud=!1;function M5(e,t){switch(e){case"compositionend":return Vz(t);case"keypress":return t.which!==32?null:(r1=!0,t1);case"textInput":return e=t.data,e===t1&&r1?null:e;default:return null}}function R5(e,t){if(ud)return e==="compositionend"||!lb&&Hz(e,t)?(e=Fz(),jh=ib=ll=null,ud=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Bz&&t.locale!=="ko"?null:t.data;default:return null}}var O5={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function n1(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!O5[e.type]:t==="textarea"}function Wz(e,t,n,s){zz(s),t=Bh(t,"onChange"),0<t.length&&(n=new ob("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var op=null,jp=null;function L5(e){rk(e,0)}function b0(e){var t=hd(e);if(mz(t))return e}function D5(e,t){if(e==="change")return t}var Kz=!1;if(va){var Xm;if(va){var Zm="oninput"in document;if(!Zm){var s1=document.createElement("div");s1.setAttribute("oninput","return;"),Zm=typeof s1.oninput=="function"}Xm=Zm}else Xm=!1;Kz=Xm&&(!document.documentMode||9<document.documentMode)}function i1(){op&&(op.detachEvent("onpropertychange",Jz),jp=op=null)}function Jz(e){if(e.propertyName==="value"&&b0(jp)){var t=[];Wz(t,jp,e,eb(e)),Sz(L5,t)}}function U5(e,t,n){e==="focusin"?(i1(),op=t,jp=n,op.attachEvent("onpropertychange",Jz)):e==="focusout"&&i1()}function F5(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return b0(jp)}function B5(e,t){if(e==="click")return b0(t)}function H5(e,t){if(e==="input"||e==="change")return b0(t)}function V5(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var jo=typeof Object.is=="function"?Object.is:V5;function Np(e,t){if(jo(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var a=n[s];if(!Ug.call(t,a)||!jo(e[a],t[a]))return!1}return!0}function o1(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function a1(e,t){var n=o1(e);e=0;for(var s;n;){if(n.nodeType===3){if(s=e+n.textContent.length,e<=t&&s>=t)return{node:n,offset:t-e};e=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=o1(n)}}function qz(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?qz(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Gz(){for(var e=window,t=Mh();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Mh(e.document)}return t}function cb(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function W5(e){var t=Gz(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&qz(n.ownerDocument.documentElement,n)){if(s!==null&&cb(n)){if(t=s.start,e=s.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,c=Math.min(s.start,a);s=s.end===void 0?c:Math.min(s.end,a),!e.extend&&c>s&&(a=s,s=c,c=a),a=a1(n,c);var d=a1(n,s);a&&d&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==d.node||e.focusOffset!==d.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),c>s?(e.addRange(t),e.extend(d.node,d.offset)):(t.setEnd(d.node,d.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var K5=va&&"documentMode"in document&&11>=document.documentMode,pd=null,ix=null,ap=null,ox=!1;function l1(e,t,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ox||pd==null||pd!==Mh(s)||(s=pd,"selectionStart"in s&&cb(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),ap&&Np(ap,s)||(ap=s,s=Bh(ix,"onSelect"),0<s.length&&(t=new ob("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=pd)))}function qf(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var fd={animationend:qf("Animation","AnimationEnd"),animationiteration:qf("Animation","AnimationIteration"),animationstart:qf("Animation","AnimationStart"),transitionend:qf("Transition","TransitionEnd")},Qm={},Yz={};va&&(Yz=document.createElement("div").style,"AnimationEvent"in window||(delete fd.animationend.animation,delete fd.animationiteration.animation,delete fd.animationstart.animation),"TransitionEvent"in window||delete fd.transitionend.transition);function y0(e){if(Qm[e])return Qm[e];if(!fd[e])return e;var t=fd[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Yz)return Qm[e]=t[n];return e}var Xz=y0("animationend"),Zz=y0("animationiteration"),Qz=y0("animationstart"),ek=y0("transitionend"),tk=new Map,c1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function wl(e,t){tk.set(e,t),fc(t,[e])}for(var eg=0;eg<c1.length;eg++){var tg=c1[eg],J5=tg.toLowerCase(),q5=tg[0].toUpperCase()+tg.slice(1);wl(J5,"on"+q5)}wl(Xz,"onAnimationEnd");wl(Zz,"onAnimationIteration");wl(Qz,"onAnimationStart");wl("dblclick","onDoubleClick");wl("focusin","onFocus");wl("focusout","onBlur");wl(ek,"onTransitionEnd");Ed("onMouseEnter",["mouseout","mouseover"]);Ed("onMouseLeave",["mouseout","mouseover"]);Ed("onPointerEnter",["pointerout","pointerover"]);Ed("onPointerLeave",["pointerout","pointerover"]);fc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fc("onBeforeInput",["compositionend","keypress","textInput","paste"]);fc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),G5=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qu));function d1(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,JS(s,t,void 0,e),e.currentTarget=null}function rk(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var s=e[n],a=s.event;s=s.listeners;e:{var c=void 0;if(t)for(var d=s.length-1;0<=d;d--){var h=s[d],g=h.instance,x=h.currentTarget;if(h=h.listener,g!==c&&a.isPropagationStopped())break e;d1(a,h,x),c=g}else for(d=0;d<s.length;d++){if(h=s[d],g=h.instance,x=h.currentTarget,h=h.listener,g!==c&&a.isPropagationStopped())break e;d1(a,h,x),c=g}}}if(Oh)throw e=tx,Oh=!1,tx=null,e}function Sn(e,t){var n=t[ux];n===void 0&&(n=t[ux]=new Set);var s=e+"__bubble";n.has(s)||(nk(t,e,2,!1),n.add(s))}function rg(e,t,n){var s=0;t&&(s|=4),nk(n,e,s,t)}var Gf="_reactListening"+Math.random().toString(36).slice(2);function Sp(e){if(!e[Gf]){e[Gf]=!0,dz.forEach(function(n){n!=="selectionchange"&&(G5.has(n)||rg(n,!1,e),rg(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Gf]||(t[Gf]=!0,rg("selectionchange",!1,t))}}function nk(e,t,n,s){switch(Uz(t)){case 1:var a=c5;break;case 4:a=d5;break;default:a=sb}n=a.bind(null,t,n,e),a=void 0,!ex||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),s?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function ng(e,t,n,s,a){var c=s;if(!(t&1)&&!(t&2)&&s!==null)e:for(;;){if(s===null)return;var d=s.tag;if(d===3||d===4){var h=s.stateNode.containerInfo;if(h===a||h.nodeType===8&&h.parentNode===a)break;if(d===4)for(d=s.return;d!==null;){var g=d.tag;if((g===3||g===4)&&(g=d.stateNode.containerInfo,g===a||g.nodeType===8&&g.parentNode===a))return;d=d.return}for(;h!==null;){if(d=ec(h),d===null)return;if(g=d.tag,g===5||g===6){s=c=d;continue e}h=h.parentNode}}s=s.return}Sz(function(){var x=c,N=eb(n),C=[];e:{var A=tk.get(e);if(A!==void 0){var _=ob,R=e;switch(e){case"keypress":if(Nh(n)===0)break e;case"keydown":case"keyup":_=N5;break;case"focusin":R="focus",_=Ym;break;case"focusout":R="blur",_=Ym;break;case"beforeblur":case"afterblur":_=Ym;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=Zv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=f5;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=C5;break;case Xz:case Zz:case Qz:_=g5;break;case ek:_=I5;break;case"scroll":_=u5;break;case"wheel":_=$5;break;case"copy":case"cut":case"paste":_=b5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=e1}var $=(t&4)!==0,L=!$&&e==="scroll",S=$?A!==null?A+"Capture":null:A;$=[];for(var P=x,O;P!==null;){O=P;var K=O.stateNode;if(O.tag===5&&K!==null&&(O=K,S!==null&&(K=vp(P,S),K!=null&&$.push(_p(P,K,O)))),L)break;P=P.return}0<$.length&&(A=new _(A,R,null,n,N),C.push({event:A,listeners:$}))}}if(!(t&7)){e:{if(A=e==="mouseover"||e==="pointerover",_=e==="mouseout"||e==="pointerout",A&&n!==Zg&&(R=n.relatedTarget||n.fromElement)&&(ec(R)||R[wa]))break e;if((_||A)&&(A=N.window===N?N:(A=N.ownerDocument)?A.defaultView||A.parentWindow:window,_?(R=n.relatedTarget||n.toElement,_=x,R=R?ec(R):null,R!==null&&(L=hc(R),R!==L||R.tag!==5&&R.tag!==6)&&(R=null)):(_=null,R=x),_!==R)){if($=Zv,K="onMouseLeave",S="onMouseEnter",P="mouse",(e==="pointerout"||e==="pointerover")&&($=e1,K="onPointerLeave",S="onPointerEnter",P="pointer"),L=_==null?A:hd(_),O=R==null?A:hd(R),A=new $(K,P+"leave",_,n,N),A.target=L,A.relatedTarget=O,K=null,ec(N)===x&&($=new $(S,P+"enter",R,n,N),$.target=O,$.relatedTarget=L,K=$),L=K,_&&R)t:{for($=_,S=R,P=0,O=$;O;O=Xc(O))P++;for(O=0,K=S;K;K=Xc(K))O++;for(;0<P-O;)$=Xc($),P--;for(;0<O-P;)S=Xc(S),O--;for(;P--;){if($===S||S!==null&&$===S.alternate)break t;$=Xc($),S=Xc(S)}$=null}else $=null;_!==null&&u1(C,A,_,$,!1),R!==null&&L!==null&&u1(C,L,R,$,!0)}}e:{if(A=x?hd(x):window,_=A.nodeName&&A.nodeName.toLowerCase(),_==="select"||_==="input"&&A.type==="file")var Q=D5;else if(n1(A))if(Kz)Q=H5;else{Q=F5;var ue=U5}else(_=A.nodeName)&&_.toLowerCase()==="input"&&(A.type==="checkbox"||A.type==="radio")&&(Q=B5);if(Q&&(Q=Q(e,x))){Wz(C,Q,n,N);break e}ue&&ue(e,A,x),e==="focusout"&&(ue=A._wrapperState)&&ue.controlled&&A.type==="number"&&Jg(A,"number",A.value)}switch(ue=x?hd(x):window,e){case"focusin":(n1(ue)||ue.contentEditable==="true")&&(pd=ue,ix=x,ap=null);break;case"focusout":ap=ix=pd=null;break;case"mousedown":ox=!0;break;case"contextmenu":case"mouseup":case"dragend":ox=!1,l1(C,n,N);break;case"selectionchange":if(K5)break;case"keydown":case"keyup":l1(C,n,N)}var oe;if(lb)e:{switch(e){case"compositionstart":var we="onCompositionStart";break e;case"compositionend":we="onCompositionEnd";break e;case"compositionupdate":we="onCompositionUpdate";break e}we=void 0}else ud?Hz(e,n)&&(we="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(we="onCompositionStart");we&&(Bz&&n.locale!=="ko"&&(ud||we!=="onCompositionStart"?we==="onCompositionEnd"&&ud&&(oe=Fz()):(ll=N,ib="value"in ll?ll.value:ll.textContent,ud=!0)),ue=Bh(x,we),0<ue.length&&(we=new Qv(we,e,null,n,N),C.push({event:we,listeners:ue}),oe?we.data=oe:(oe=Vz(n),oe!==null&&(we.data=oe)))),(oe=T5?M5(e,n):R5(e,n))&&(x=Bh(x,"onBeforeInput"),0<x.length&&(N=new Qv("onBeforeInput","beforeinput",null,n,N),C.push({event:N,listeners:x}),N.data=oe))}rk(C,t)})}function _p(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Bh(e,t){for(var n=t+"Capture",s=[];e!==null;){var a=e,c=a.stateNode;a.tag===5&&c!==null&&(a=c,c=vp(e,n),c!=null&&s.unshift(_p(e,c,a)),c=vp(e,t),c!=null&&s.push(_p(e,c,a))),e=e.return}return s}function Xc(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function u1(e,t,n,s,a){for(var c=t._reactName,d=[];n!==null&&n!==s;){var h=n,g=h.alternate,x=h.stateNode;if(g!==null&&g===s)break;h.tag===5&&x!==null&&(h=x,a?(g=vp(n,c),g!=null&&d.unshift(_p(n,g,h))):a||(g=vp(n,c),g!=null&&d.push(_p(n,g,h)))),n=n.return}d.length!==0&&e.push({event:t,listeners:d})}var Y5=/\r\n?/g,X5=/\u0000|\uFFFD/g;function p1(e){return(typeof e=="string"?e:""+e).replace(Y5,`
`).replace(X5,"")}function Yf(e,t,n){if(t=p1(t),p1(e)!==t&&n)throw Error(ct(425))}function Hh(){}var ax=null,lx=null;function cx(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var dx=typeof setTimeout=="function"?setTimeout:void 0,Z5=typeof clearTimeout=="function"?clearTimeout:void 0,f1=typeof Promise=="function"?Promise:void 0,Q5=typeof queueMicrotask=="function"?queueMicrotask:typeof f1<"u"?function(e){return f1.resolve(null).then(e).catch(e_)}:dx;function e_(e){setTimeout(function(){throw e})}function sg(e,t){var n=t,s=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(s===0){e.removeChild(a),kp(t);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=a}while(n);kp(t)}function fl(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function h1(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Ld=Math.random().toString(36).slice(2),Uo="__reactFiber$"+Ld,Cp="__reactProps$"+Ld,wa="__reactContainer$"+Ld,ux="__reactEvents$"+Ld,t_="__reactListeners$"+Ld,r_="__reactHandles$"+Ld;function ec(e){var t=e[Uo];if(t)return t;for(var n=e.parentNode;n;){if(t=n[wa]||n[Uo]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=h1(e);e!==null;){if(n=e[Uo])return n;e=h1(e)}return t}e=n,n=e.parentNode}return null}function Up(e){return e=e[Uo]||e[wa],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function hd(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ct(33))}function v0(e){return e[Cp]||null}var px=[],md=-1;function zl(e){return{current:e}}function _n(e){0>md||(e.current=px[md],px[md]=null,md--)}function wn(e,t){md++,px[md]=e.current,e.current=t}var yl={},Bs=zl(yl),hi=zl(!1),oc=yl;function Id(e,t){var n=e.type.contextTypes;if(!n)return yl;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var a={},c;for(c in n)a[c]=t[c];return s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function mi(e){return e=e.childContextTypes,e!=null}function Vh(){_n(hi),_n(Bs)}function m1(e,t,n){if(Bs.current!==yl)throw Error(ct(168));wn(Bs,t),wn(hi,n)}function sk(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var a in s)if(!(a in t))throw Error(ct(108,US(e)||"Unknown",a));return Ln({},n,s)}function Wh(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||yl,oc=Bs.current,wn(Bs,e),wn(hi,hi.current),!0}function g1(e,t,n){var s=e.stateNode;if(!s)throw Error(ct(169));n?(e=sk(e,t,oc),s.__reactInternalMemoizedMergedChildContext=e,_n(hi),_n(Bs),wn(Bs,e)):_n(hi),wn(hi,n)}var ha=null,w0=!1,ig=!1;function ik(e){ha===null?ha=[e]:ha.push(e)}function n_(e){w0=!0,ik(e)}function kl(){if(!ig&&ha!==null){ig=!0;var e=0,t=dn;try{var n=ha;for(dn=1;e<n.length;e++){var s=n[e];do s=s(!0);while(s!==null)}ha=null,w0=!1}catch(a){throw ha!==null&&(ha=ha.slice(e+1)),Iz(tb,kl),a}finally{dn=t,ig=!1}}return null}var gd=[],xd=0,Kh=null,Jh=0,Yi=[],Xi=0,ac=null,ga=1,xa="";function Gl(e,t){gd[xd++]=Jh,gd[xd++]=Kh,Kh=e,Jh=t}function ok(e,t,n){Yi[Xi++]=ga,Yi[Xi++]=xa,Yi[Xi++]=ac,ac=e;var s=ga;e=xa;var a=32-zo(s)-1;s&=~(1<<a),n+=1;var c=32-zo(t)+a;if(30<c){var d=a-a%5;c=(s&(1<<d)-1).toString(32),s>>=d,a-=d,ga=1<<32-zo(t)+a|n<<a|s,xa=c+e}else ga=1<<c|n<<a|s,xa=e}function db(e){e.return!==null&&(Gl(e,1),ok(e,1,0))}function ub(e){for(;e===Kh;)Kh=gd[--xd],gd[xd]=null,Jh=gd[--xd],gd[xd]=null;for(;e===ac;)ac=Yi[--Xi],Yi[Xi]=null,xa=Yi[--Xi],Yi[Xi]=null,ga=Yi[--Xi],Yi[Xi]=null}var $i=null,Pi=null,An=!1,wo=null;function ak(e,t){var n=Zi(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function x1(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,$i=e,Pi=fl(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,$i=e,Pi=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=ac!==null?{id:ga,overflow:xa}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=Zi(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,$i=e,Pi=null,!0):!1;default:return!1}}function fx(e){return(e.mode&1)!==0&&(e.flags&128)===0}function hx(e){if(An){var t=Pi;if(t){var n=t;if(!x1(e,t)){if(fx(e))throw Error(ct(418));t=fl(n.nextSibling);var s=$i;t&&x1(e,t)?ak(s,n):(e.flags=e.flags&-4097|2,An=!1,$i=e)}}else{if(fx(e))throw Error(ct(418));e.flags=e.flags&-4097|2,An=!1,$i=e}}}function b1(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;$i=e}function Xf(e){if(e!==$i)return!1;if(!An)return b1(e),An=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!cx(e.type,e.memoizedProps)),t&&(t=Pi)){if(fx(e))throw lk(),Error(ct(418));for(;t;)ak(e,t),t=fl(t.nextSibling)}if(b1(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ct(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){Pi=fl(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}Pi=null}}else Pi=$i?fl(e.stateNode.nextSibling):null;return!0}function lk(){for(var e=Pi;e;)e=fl(e.nextSibling)}function Pd(){Pi=$i=null,An=!1}function pb(e){wo===null?wo=[e]:wo.push(e)}var s_=ja.ReactCurrentBatchConfig;function Tu(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ct(309));var s=n.stateNode}if(!s)throw Error(ct(147,e));var a=s,c=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===c?t.ref:(t=function(d){var h=a.refs;d===null?delete h[c]:h[c]=d},t._stringRef=c,t)}if(typeof e!="string")throw Error(ct(284));if(!n._owner)throw Error(ct(290,e))}return e}function Zf(e,t){throw e=Object.prototype.toString.call(t),Error(ct(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function y1(e){var t=e._init;return t(e._payload)}function ck(e){function t(S,P){if(e){var O=S.deletions;O===null?(S.deletions=[P],S.flags|=16):O.push(P)}}function n(S,P){if(!e)return null;for(;P!==null;)t(S,P),P=P.sibling;return null}function s(S,P){for(S=new Map;P!==null;)P.key!==null?S.set(P.key,P):S.set(P.index,P),P=P.sibling;return S}function a(S,P){return S=xl(S,P),S.index=0,S.sibling=null,S}function c(S,P,O){return S.index=O,e?(O=S.alternate,O!==null?(O=O.index,O<P?(S.flags|=2,P):O):(S.flags|=2,P)):(S.flags|=1048576,P)}function d(S){return e&&S.alternate===null&&(S.flags|=2),S}function h(S,P,O,K){return P===null||P.tag!==6?(P=pg(O,S.mode,K),P.return=S,P):(P=a(P,O),P.return=S,P)}function g(S,P,O,K){var Q=O.type;return Q===dd?N(S,P,O.props.children,K,O.key):P!==null&&(P.elementType===Q||typeof Q=="object"&&Q!==null&&Q.$$typeof===sl&&y1(Q)===P.type)?(K=a(P,O.props),K.ref=Tu(S,P,O),K.return=S,K):(K=$h(O.type,O.key,O.props,null,S.mode,K),K.ref=Tu(S,P,O),K.return=S,K)}function x(S,P,O,K){return P===null||P.tag!==4||P.stateNode.containerInfo!==O.containerInfo||P.stateNode.implementation!==O.implementation?(P=fg(O,S.mode,K),P.return=S,P):(P=a(P,O.children||[]),P.return=S,P)}function N(S,P,O,K,Q){return P===null||P.tag!==7?(P=sc(O,S.mode,K,Q),P.return=S,P):(P=a(P,O),P.return=S,P)}function C(S,P,O){if(typeof P=="string"&&P!==""||typeof P=="number")return P=pg(""+P,S.mode,O),P.return=S,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case Ff:return O=$h(P.type,P.key,P.props,null,S.mode,O),O.ref=Tu(S,null,P),O.return=S,O;case cd:return P=fg(P,S.mode,O),P.return=S,P;case sl:var K=P._init;return C(S,K(P._payload),O)}if(Xu(P)||Eu(P))return P=sc(P,S.mode,O,null),P.return=S,P;Zf(S,P)}return null}function A(S,P,O,K){var Q=P!==null?P.key:null;if(typeof O=="string"&&O!==""||typeof O=="number")return Q!==null?null:h(S,P,""+O,K);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case Ff:return O.key===Q?g(S,P,O,K):null;case cd:return O.key===Q?x(S,P,O,K):null;case sl:return Q=O._init,A(S,P,Q(O._payload),K)}if(Xu(O)||Eu(O))return Q!==null?null:N(S,P,O,K,null);Zf(S,O)}return null}function _(S,P,O,K,Q){if(typeof K=="string"&&K!==""||typeof K=="number")return S=S.get(O)||null,h(P,S,""+K,Q);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case Ff:return S=S.get(K.key===null?O:K.key)||null,g(P,S,K,Q);case cd:return S=S.get(K.key===null?O:K.key)||null,x(P,S,K,Q);case sl:var ue=K._init;return _(S,P,O,ue(K._payload),Q)}if(Xu(K)||Eu(K))return S=S.get(O)||null,N(P,S,K,Q,null);Zf(P,K)}return null}function R(S,P,O,K){for(var Q=null,ue=null,oe=P,we=P=0,he=null;oe!==null&&we<O.length;we++){oe.index>we?(he=oe,oe=null):he=oe.sibling;var ze=A(S,oe,O[we],K);if(ze===null){oe===null&&(oe=he);break}e&&oe&&ze.alternate===null&&t(S,oe),P=c(ze,P,we),ue===null?Q=ze:ue.sibling=ze,ue=ze,oe=he}if(we===O.length)return n(S,oe),An&&Gl(S,we),Q;if(oe===null){for(;we<O.length;we++)oe=C(S,O[we],K),oe!==null&&(P=c(oe,P,we),ue===null?Q=oe:ue.sibling=oe,ue=oe);return An&&Gl(S,we),Q}for(oe=s(S,oe);we<O.length;we++)he=_(oe,S,we,O[we],K),he!==null&&(e&&he.alternate!==null&&oe.delete(he.key===null?we:he.key),P=c(he,P,we),ue===null?Q=he:ue.sibling=he,ue=he);return e&&oe.forEach(function(ot){return t(S,ot)}),An&&Gl(S,we),Q}function $(S,P,O,K){var Q=Eu(O);if(typeof Q!="function")throw Error(ct(150));if(O=Q.call(O),O==null)throw Error(ct(151));for(var ue=Q=null,oe=P,we=P=0,he=null,ze=O.next();oe!==null&&!ze.done;we++,ze=O.next()){oe.index>we?(he=oe,oe=null):he=oe.sibling;var ot=A(S,oe,ze.value,K);if(ot===null){oe===null&&(oe=he);break}e&&oe&&ot.alternate===null&&t(S,oe),P=c(ot,P,we),ue===null?Q=ot:ue.sibling=ot,ue=ot,oe=he}if(ze.done)return n(S,oe),An&&Gl(S,we),Q;if(oe===null){for(;!ze.done;we++,ze=O.next())ze=C(S,ze.value,K),ze!==null&&(P=c(ze,P,we),ue===null?Q=ze:ue.sibling=ze,ue=ze);return An&&Gl(S,we),Q}for(oe=s(S,oe);!ze.done;we++,ze=O.next())ze=_(oe,S,we,ze.value,K),ze!==null&&(e&&ze.alternate!==null&&oe.delete(ze.key===null?we:ze.key),P=c(ze,P,we),ue===null?Q=ze:ue.sibling=ze,ue=ze);return e&&oe.forEach(function(re){return t(S,re)}),An&&Gl(S,we),Q}function L(S,P,O,K){if(typeof O=="object"&&O!==null&&O.type===dd&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case Ff:e:{for(var Q=O.key,ue=P;ue!==null;){if(ue.key===Q){if(Q=O.type,Q===dd){if(ue.tag===7){n(S,ue.sibling),P=a(ue,O.props.children),P.return=S,S=P;break e}}else if(ue.elementType===Q||typeof Q=="object"&&Q!==null&&Q.$$typeof===sl&&y1(Q)===ue.type){n(S,ue.sibling),P=a(ue,O.props),P.ref=Tu(S,ue,O),P.return=S,S=P;break e}n(S,ue);break}else t(S,ue);ue=ue.sibling}O.type===dd?(P=sc(O.props.children,S.mode,K,O.key),P.return=S,S=P):(K=$h(O.type,O.key,O.props,null,S.mode,K),K.ref=Tu(S,P,O),K.return=S,S=K)}return d(S);case cd:e:{for(ue=O.key;P!==null;){if(P.key===ue)if(P.tag===4&&P.stateNode.containerInfo===O.containerInfo&&P.stateNode.implementation===O.implementation){n(S,P.sibling),P=a(P,O.children||[]),P.return=S,S=P;break e}else{n(S,P);break}else t(S,P);P=P.sibling}P=fg(O,S.mode,K),P.return=S,S=P}return d(S);case sl:return ue=O._init,L(S,P,ue(O._payload),K)}if(Xu(O))return R(S,P,O,K);if(Eu(O))return $(S,P,O,K);Zf(S,O)}return typeof O=="string"&&O!==""||typeof O=="number"?(O=""+O,P!==null&&P.tag===6?(n(S,P.sibling),P=a(P,O),P.return=S,S=P):(n(S,P),P=pg(O,S.mode,K),P.return=S,S=P),d(S)):n(S,P)}return L}var $d=ck(!0),dk=ck(!1),qh=zl(null),Gh=null,bd=null,fb=null;function hb(){fb=bd=Gh=null}function mb(e){var t=qh.current;_n(qh),e._currentValue=t}function mx(e,t,n){for(;e!==null;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,s!==null&&(s.childLanes|=t)):s!==null&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function _d(e,t){Gh=e,fb=bd=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(fi=!0),e.firstContext=null)}function eo(e){var t=e._currentValue;if(fb!==e)if(e={context:e,memoizedValue:t,next:null},bd===null){if(Gh===null)throw Error(ct(308));bd=e,Gh.dependencies={lanes:0,firstContext:e}}else bd=bd.next=e;return t}var tc=null;function gb(e){tc===null?tc=[e]:tc.push(e)}function uk(e,t,n,s){var a=t.interleaved;return a===null?(n.next=n,gb(t)):(n.next=a.next,a.next=n),t.interleaved=n,za(e,s)}function za(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var il=!1;function xb(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pk(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ya(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function hl(e,t,n){var s=e.updateQueue;if(s===null)return null;if(s=s.shared,Wr&2){var a=s.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),s.pending=t,za(e,n)}return a=s.interleaved,a===null?(t.next=t,gb(s)):(t.next=a.next,a.next=t),s.interleaved=t,za(e,n)}function Sh(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,rb(e,n)}}function v1(e,t){var n=e.updateQueue,s=e.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var a=null,c=null;if(n=n.firstBaseUpdate,n!==null){do{var d={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};c===null?a=c=d:c=c.next=d,n=n.next}while(n!==null);c===null?a=c=t:c=c.next=t}else a=c=t;n={baseState:s.baseState,firstBaseUpdate:a,lastBaseUpdate:c,shared:s.shared,effects:s.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Yh(e,t,n,s){var a=e.updateQueue;il=!1;var c=a.firstBaseUpdate,d=a.lastBaseUpdate,h=a.shared.pending;if(h!==null){a.shared.pending=null;var g=h,x=g.next;g.next=null,d===null?c=x:d.next=x,d=g;var N=e.alternate;N!==null&&(N=N.updateQueue,h=N.lastBaseUpdate,h!==d&&(h===null?N.firstBaseUpdate=x:h.next=x,N.lastBaseUpdate=g))}if(c!==null){var C=a.baseState;d=0,N=x=g=null,h=c;do{var A=h.lane,_=h.eventTime;if((s&A)===A){N!==null&&(N=N.next={eventTime:_,lane:0,tag:h.tag,payload:h.payload,callback:h.callback,next:null});e:{var R=e,$=h;switch(A=t,_=n,$.tag){case 1:if(R=$.payload,typeof R=="function"){C=R.call(_,C,A);break e}C=R;break e;case 3:R.flags=R.flags&-65537|128;case 0:if(R=$.payload,A=typeof R=="function"?R.call(_,C,A):R,A==null)break e;C=Ln({},C,A);break e;case 2:il=!0}}h.callback!==null&&h.lane!==0&&(e.flags|=64,A=a.effects,A===null?a.effects=[h]:A.push(h))}else _={eventTime:_,lane:A,tag:h.tag,payload:h.payload,callback:h.callback,next:null},N===null?(x=N=_,g=C):N=N.next=_,d|=A;if(h=h.next,h===null){if(h=a.shared.pending,h===null)break;A=h,h=A.next,A.next=null,a.lastBaseUpdate=A,a.shared.pending=null}}while(!0);if(N===null&&(g=C),a.baseState=g,a.firstBaseUpdate=x,a.lastBaseUpdate=N,t=a.shared.interleaved,t!==null){a=t;do d|=a.lane,a=a.next;while(a!==t)}else c===null&&(a.shared.lanes=0);cc|=d,e.lanes=d,e.memoizedState=C}}function w1(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var s=e[t],a=s.callback;if(a!==null){if(s.callback=null,s=n,typeof a!="function")throw Error(ct(191,a));a.call(s)}}}var Fp={},Wo=zl(Fp),Ep=zl(Fp),Ip=zl(Fp);function rc(e){if(e===Fp)throw Error(ct(174));return e}function bb(e,t){switch(wn(Ip,t),wn(Ep,e),wn(Wo,Fp),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Gg(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Gg(t,e)}_n(Wo),wn(Wo,t)}function Ad(){_n(Wo),_n(Ep),_n(Ip)}function fk(e){rc(Ip.current);var t=rc(Wo.current),n=Gg(t,e.type);t!==n&&(wn(Ep,e),wn(Wo,n))}function yb(e){Ep.current===e&&(_n(Wo),_n(Ep))}var Rn=zl(0);function Xh(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var og=[];function vb(){for(var e=0;e<og.length;e++)og[e]._workInProgressVersionPrimary=null;og.length=0}var _h=ja.ReactCurrentDispatcher,ag=ja.ReactCurrentBatchConfig,lc=0,On=null,fs=null,ks=null,Zh=!1,lp=!1,Pp=0,i_=0;function Ds(){throw Error(ct(321))}function wb(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!jo(e[n],t[n]))return!1;return!0}function zb(e,t,n,s,a,c){if(lc=c,On=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,_h.current=e===null||e.memoizedState===null?c_:d_,e=n(s,a),lp){c=0;do{if(lp=!1,Pp=0,25<=c)throw Error(ct(301));c+=1,ks=fs=null,t.updateQueue=null,_h.current=u_,e=n(s,a)}while(lp)}if(_h.current=Qh,t=fs!==null&&fs.next!==null,lc=0,ks=fs=On=null,Zh=!1,t)throw Error(ct(300));return e}function kb(){var e=Pp!==0;return Pp=0,e}function Do(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ks===null?On.memoizedState=ks=e:ks=ks.next=e,ks}function to(){if(fs===null){var e=On.alternate;e=e!==null?e.memoizedState:null}else e=fs.next;var t=ks===null?On.memoizedState:ks.next;if(t!==null)ks=t,fs=e;else{if(e===null)throw Error(ct(310));fs=e,e={memoizedState:fs.memoizedState,baseState:fs.baseState,baseQueue:fs.baseQueue,queue:fs.queue,next:null},ks===null?On.memoizedState=ks=e:ks=ks.next=e}return ks}function $p(e,t){return typeof t=="function"?t(e):t}function lg(e){var t=to(),n=t.queue;if(n===null)throw Error(ct(311));n.lastRenderedReducer=e;var s=fs,a=s.baseQueue,c=n.pending;if(c!==null){if(a!==null){var d=a.next;a.next=c.next,c.next=d}s.baseQueue=a=c,n.pending=null}if(a!==null){c=a.next,s=s.baseState;var h=d=null,g=null,x=c;do{var N=x.lane;if((lc&N)===N)g!==null&&(g=g.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),s=x.hasEagerState?x.eagerState:e(s,x.action);else{var C={lane:N,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};g===null?(h=g=C,d=s):g=g.next=C,On.lanes|=N,cc|=N}x=x.next}while(x!==null&&x!==c);g===null?d=s:g.next=h,jo(s,t.memoizedState)||(fi=!0),t.memoizedState=s,t.baseState=d,t.baseQueue=g,n.lastRenderedState=s}if(e=n.interleaved,e!==null){a=e;do c=a.lane,On.lanes|=c,cc|=c,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function cg(e){var t=to(),n=t.queue;if(n===null)throw Error(ct(311));n.lastRenderedReducer=e;var s=n.dispatch,a=n.pending,c=t.memoizedState;if(a!==null){n.pending=null;var d=a=a.next;do c=e(c,d.action),d=d.next;while(d!==a);jo(c,t.memoizedState)||(fi=!0),t.memoizedState=c,t.baseQueue===null&&(t.baseState=c),n.lastRenderedState=c}return[c,s]}function hk(){}function mk(e,t){var n=On,s=to(),a=t(),c=!jo(s.memoizedState,a);if(c&&(s.memoizedState=a,fi=!0),s=s.queue,jb(bk.bind(null,n,s,e),[e]),s.getSnapshot!==t||c||ks!==null&&ks.memoizedState.tag&1){if(n.flags|=2048,Ap(9,xk.bind(null,n,s,a,t),void 0,null),js===null)throw Error(ct(349));lc&30||gk(n,t,a)}return a}function gk(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=On.updateQueue,t===null?(t={lastEffect:null,stores:null},On.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function xk(e,t,n,s){t.value=n,t.getSnapshot=s,yk(t)&&vk(e)}function bk(e,t,n){return n(function(){yk(t)&&vk(e)})}function yk(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!jo(e,n)}catch{return!0}}function vk(e){var t=za(e,1);t!==null&&ko(t,e,1,-1)}function z1(e){var t=Do();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$p,lastRenderedState:e},t.queue=e,e=e.dispatch=l_.bind(null,On,e),[t.memoizedState,e]}function Ap(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},t=On.updateQueue,t===null?(t={lastEffect:null,stores:null},On.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e)),e}function wk(){return to().memoizedState}function Ch(e,t,n,s){var a=Do();On.flags|=e,a.memoizedState=Ap(1|t,n,void 0,s===void 0?null:s)}function z0(e,t,n,s){var a=to();s=s===void 0?null:s;var c=void 0;if(fs!==null){var d=fs.memoizedState;if(c=d.destroy,s!==null&&wb(s,d.deps)){a.memoizedState=Ap(t,n,c,s);return}}On.flags|=e,a.memoizedState=Ap(1|t,n,c,s)}function k1(e,t){return Ch(8390656,8,e,t)}function jb(e,t){return z0(2048,8,e,t)}function zk(e,t){return z0(4,2,e,t)}function kk(e,t){return z0(4,4,e,t)}function jk(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Nk(e,t,n){return n=n!=null?n.concat([e]):null,z0(4,4,jk.bind(null,t,e),n)}function Nb(){}function Sk(e,t){var n=to();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&wb(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function _k(e,t){var n=to();t=t===void 0?null:t;var s=n.memoizedState;return s!==null&&t!==null&&wb(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function Ck(e,t,n){return lc&21?(jo(n,t)||(n=Az(),On.lanes|=n,cc|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,fi=!0),e.memoizedState=n)}function o_(e,t){var n=dn;dn=n!==0&&4>n?n:4,e(!0);var s=ag.transition;ag.transition={};try{e(!1),t()}finally{dn=n,ag.transition=s}}function Ek(){return to().memoizedState}function a_(e,t,n){var s=gl(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Ik(e))Pk(t,n);else if(n=uk(e,t,n,s),n!==null){var a=Zs();ko(n,e,s,a),$k(n,t,s)}}function l_(e,t,n){var s=gl(e),a={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ik(e))Pk(t,a);else{var c=e.alternate;if(e.lanes===0&&(c===null||c.lanes===0)&&(c=t.lastRenderedReducer,c!==null))try{var d=t.lastRenderedState,h=c(d,n);if(a.hasEagerState=!0,a.eagerState=h,jo(h,d)){var g=t.interleaved;g===null?(a.next=a,gb(t)):(a.next=g.next,g.next=a),t.interleaved=a;return}}catch{}finally{}n=uk(e,t,a,s),n!==null&&(a=Zs(),ko(n,e,s,a),$k(n,t,s))}}function Ik(e){var t=e.alternate;return e===On||t!==null&&t===On}function Pk(e,t){lp=Zh=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function $k(e,t,n){if(n&4194240){var s=t.lanes;s&=e.pendingLanes,n|=s,t.lanes=n,rb(e,n)}}var Qh={readContext:eo,useCallback:Ds,useContext:Ds,useEffect:Ds,useImperativeHandle:Ds,useInsertionEffect:Ds,useLayoutEffect:Ds,useMemo:Ds,useReducer:Ds,useRef:Ds,useState:Ds,useDebugValue:Ds,useDeferredValue:Ds,useTransition:Ds,useMutableSource:Ds,useSyncExternalStore:Ds,useId:Ds,unstable_isNewReconciler:!1},c_={readContext:eo,useCallback:function(e,t){return Do().memoizedState=[e,t===void 0?null:t],e},useContext:eo,useEffect:k1,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Ch(4194308,4,jk.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Ch(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ch(4,2,e,t)},useMemo:function(e,t){var n=Do();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=Do();return t=n!==void 0?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=a_.bind(null,On,e),[s.memoizedState,e]},useRef:function(e){var t=Do();return e={current:e},t.memoizedState=e},useState:z1,useDebugValue:Nb,useDeferredValue:function(e){return Do().memoizedState=e},useTransition:function(){var e=z1(!1),t=e[0];return e=o_.bind(null,e[1]),Do().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=On,a=Do();if(An){if(n===void 0)throw Error(ct(407));n=n()}else{if(n=t(),js===null)throw Error(ct(349));lc&30||gk(s,t,n)}a.memoizedState=n;var c={value:n,getSnapshot:t};return a.queue=c,k1(bk.bind(null,s,c,e),[e]),s.flags|=2048,Ap(9,xk.bind(null,s,c,n,t),void 0,null),n},useId:function(){var e=Do(),t=js.identifierPrefix;if(An){var n=xa,s=ga;n=(s&~(1<<32-zo(s)-1)).toString(32)+n,t=":"+t+"R"+n,n=Pp++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=i_++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},d_={readContext:eo,useCallback:Sk,useContext:eo,useEffect:jb,useImperativeHandle:Nk,useInsertionEffect:zk,useLayoutEffect:kk,useMemo:_k,useReducer:lg,useRef:wk,useState:function(){return lg($p)},useDebugValue:Nb,useDeferredValue:function(e){var t=to();return Ck(t,fs.memoizedState,e)},useTransition:function(){var e=lg($p)[0],t=to().memoizedState;return[e,t]},useMutableSource:hk,useSyncExternalStore:mk,useId:Ek,unstable_isNewReconciler:!1},u_={readContext:eo,useCallback:Sk,useContext:eo,useEffect:jb,useImperativeHandle:Nk,useInsertionEffect:zk,useLayoutEffect:kk,useMemo:_k,useReducer:cg,useRef:wk,useState:function(){return cg($p)},useDebugValue:Nb,useDeferredValue:function(e){var t=to();return fs===null?t.memoizedState=e:Ck(t,fs.memoizedState,e)},useTransition:function(){var e=cg($p)[0],t=to().memoizedState;return[e,t]},useMutableSource:hk,useSyncExternalStore:mk,useId:Ek,unstable_isNewReconciler:!1};function bo(e,t){if(e&&e.defaultProps){t=Ln({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function gx(e,t,n,s){t=e.memoizedState,n=n(s,t),n=n==null?t:Ln({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var k0={isMounted:function(e){return(e=e._reactInternals)?hc(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=Zs(),a=gl(e),c=ya(s,a);c.payload=t,n!=null&&(c.callback=n),t=hl(e,c,a),t!==null&&(ko(t,e,a,s),Sh(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=Zs(),a=gl(e),c=ya(s,a);c.tag=1,c.payload=t,n!=null&&(c.callback=n),t=hl(e,c,a),t!==null&&(ko(t,e,a,s),Sh(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Zs(),s=gl(e),a=ya(n,s);a.tag=2,t!=null&&(a.callback=t),t=hl(e,a,s),t!==null&&(ko(t,e,s,n),Sh(t,e,s))}};function j1(e,t,n,s,a,c,d){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(s,c,d):t.prototype&&t.prototype.isPureReactComponent?!Np(n,s)||!Np(a,c):!0}function Ak(e,t,n){var s=!1,a=yl,c=t.contextType;return typeof c=="object"&&c!==null?c=eo(c):(a=mi(t)?oc:Bs.current,s=t.contextTypes,c=(s=s!=null)?Id(e,a):yl),t=new t(n,c),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=k0,e.stateNode=t,t._reactInternals=e,s&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=c),t}function N1(e,t,n,s){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,s),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&k0.enqueueReplaceState(t,t.state,null)}function xx(e,t,n,s){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},xb(e);var c=t.contextType;typeof c=="object"&&c!==null?a.context=eo(c):(c=mi(t)?oc:Bs.current,a.context=Id(e,c)),a.state=e.memoizedState,c=t.getDerivedStateFromProps,typeof c=="function"&&(gx(e,t,c,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&k0.enqueueReplaceState(a,a.state,null),Yh(e,n,a,s),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Td(e,t){try{var n="",s=t;do n+=DS(s),s=s.return;while(s);var a=n}catch(c){a=`
Error generating stack: `+c.message+`
`+c.stack}return{value:e,source:t,stack:a,digest:null}}function dg(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function bx(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var p_=typeof WeakMap=="function"?WeakMap:Map;function Tk(e,t,n){n=ya(-1,n),n.tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){t0||(t0=!0,Cx=s),bx(e,t)},n}function Mk(e,t,n){n=ya(-1,n),n.tag=3;var s=e.type.getDerivedStateFromError;if(typeof s=="function"){var a=t.value;n.payload=function(){return s(a)},n.callback=function(){bx(e,t)}}var c=e.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(n.callback=function(){bx(e,t),typeof s!="function"&&(ml===null?ml=new Set([this]):ml.add(this));var d=t.stack;this.componentDidCatch(t.value,{componentStack:d!==null?d:""})}),n}function S1(e,t,n){var s=e.pingCache;if(s===null){s=e.pingCache=new p_;var a=new Set;s.set(t,a)}else a=s.get(t),a===void 0&&(a=new Set,s.set(t,a));a.has(n)||(a.add(n),e=S_.bind(null,e,t,n),t.then(e,e))}function _1(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function C1(e,t,n,s,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=ya(-1,1),t.tag=2,hl(n,t,1))),n.lanes|=1),e)}var f_=ja.ReactCurrentOwner,fi=!1;function Xs(e,t,n,s){t.child=e===null?dk(t,null,n,s):$d(t,e.child,n,s)}function E1(e,t,n,s,a){n=n.render;var c=t.ref;return _d(t,a),s=zb(e,t,n,s,c,a),n=kb(),e!==null&&!fi?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ka(e,t,a)):(An&&n&&db(t),t.flags|=1,Xs(e,t,s,a),t.child)}function I1(e,t,n,s,a){if(e===null){var c=n.type;return typeof c=="function"&&!Ab(c)&&c.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=c,Rk(e,t,c,s,a)):(e=$h(n.type,null,s,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(c=e.child,!(e.lanes&a)){var d=c.memoizedProps;if(n=n.compare,n=n!==null?n:Np,n(d,s)&&e.ref===t.ref)return ka(e,t,a)}return t.flags|=1,e=xl(c,s),e.ref=t.ref,e.return=t,t.child=e}function Rk(e,t,n,s,a){if(e!==null){var c=e.memoizedProps;if(Np(c,s)&&e.ref===t.ref)if(fi=!1,t.pendingProps=s=c,(e.lanes&a)!==0)e.flags&131072&&(fi=!0);else return t.lanes=e.lanes,ka(e,t,a)}return yx(e,t,n,s,a)}function Ok(e,t,n){var s=t.pendingProps,a=s.children,c=e!==null?e.memoizedState:null;if(s.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},wn(vd,Ei),Ei|=n;else{if(!(n&1073741824))return e=c!==null?c.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,wn(vd,Ei),Ei|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=c!==null?c.baseLanes:n,wn(vd,Ei),Ei|=s}else c!==null?(s=c.baseLanes|n,t.memoizedState=null):s=n,wn(vd,Ei),Ei|=s;return Xs(e,t,a,n),t.child}function Lk(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function yx(e,t,n,s,a){var c=mi(n)?oc:Bs.current;return c=Id(t,c),_d(t,a),n=zb(e,t,n,s,c,a),s=kb(),e!==null&&!fi?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ka(e,t,a)):(An&&s&&db(t),t.flags|=1,Xs(e,t,n,a),t.child)}function P1(e,t,n,s,a){if(mi(n)){var c=!0;Wh(t)}else c=!1;if(_d(t,a),t.stateNode===null)Eh(e,t),Ak(t,n,s),xx(t,n,s,a),s=!0;else if(e===null){var d=t.stateNode,h=t.memoizedProps;d.props=h;var g=d.context,x=n.contextType;typeof x=="object"&&x!==null?x=eo(x):(x=mi(n)?oc:Bs.current,x=Id(t,x));var N=n.getDerivedStateFromProps,C=typeof N=="function"||typeof d.getSnapshotBeforeUpdate=="function";C||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==s||g!==x)&&N1(t,d,s,x),il=!1;var A=t.memoizedState;d.state=A,Yh(t,s,d,a),g=t.memoizedState,h!==s||A!==g||hi.current||il?(typeof N=="function"&&(gx(t,n,N,s),g=t.memoizedState),(h=il||j1(t,n,h,s,A,g,x))?(C||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount()),typeof d.componentDidMount=="function"&&(t.flags|=4194308)):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=g),d.props=s,d.state=g,d.context=x,s=h):(typeof d.componentDidMount=="function"&&(t.flags|=4194308),s=!1)}else{d=t.stateNode,pk(e,t),h=t.memoizedProps,x=t.type===t.elementType?h:bo(t.type,h),d.props=x,C=t.pendingProps,A=d.context,g=n.contextType,typeof g=="object"&&g!==null?g=eo(g):(g=mi(n)?oc:Bs.current,g=Id(t,g));var _=n.getDerivedStateFromProps;(N=typeof _=="function"||typeof d.getSnapshotBeforeUpdate=="function")||typeof d.UNSAFE_componentWillReceiveProps!="function"&&typeof d.componentWillReceiveProps!="function"||(h!==C||A!==g)&&N1(t,d,s,g),il=!1,A=t.memoizedState,d.state=A,Yh(t,s,d,a);var R=t.memoizedState;h!==C||A!==R||hi.current||il?(typeof _=="function"&&(gx(t,n,_,s),R=t.memoizedState),(x=il||j1(t,n,x,s,A,R,g)||!1)?(N||typeof d.UNSAFE_componentWillUpdate!="function"&&typeof d.componentWillUpdate!="function"||(typeof d.componentWillUpdate=="function"&&d.componentWillUpdate(s,R,g),typeof d.UNSAFE_componentWillUpdate=="function"&&d.UNSAFE_componentWillUpdate(s,R,g)),typeof d.componentDidUpdate=="function"&&(t.flags|=4),typeof d.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof d.componentDidUpdate!="function"||h===e.memoizedProps&&A===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&A===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=R),d.props=s,d.state=R,d.context=g,s=x):(typeof d.componentDidUpdate!="function"||h===e.memoizedProps&&A===e.memoizedState||(t.flags|=4),typeof d.getSnapshotBeforeUpdate!="function"||h===e.memoizedProps&&A===e.memoizedState||(t.flags|=1024),s=!1)}return vx(e,t,n,s,c,a)}function vx(e,t,n,s,a,c){Lk(e,t);var d=(t.flags&128)!==0;if(!s&&!d)return a&&g1(t,n,!1),ka(e,t,c);s=t.stateNode,f_.current=t;var h=d&&typeof n.getDerivedStateFromError!="function"?null:s.render();return t.flags|=1,e!==null&&d?(t.child=$d(t,e.child,null,c),t.child=$d(t,null,h,c)):Xs(e,t,h,c),t.memoizedState=s.state,a&&g1(t,n,!0),t.child}function Dk(e){var t=e.stateNode;t.pendingContext?m1(e,t.pendingContext,t.pendingContext!==t.context):t.context&&m1(e,t.context,!1),bb(e,t.containerInfo)}function $1(e,t,n,s,a){return Pd(),pb(a),t.flags|=256,Xs(e,t,n,s),t.child}var wx={dehydrated:null,treeContext:null,retryLane:0};function zx(e){return{baseLanes:e,cachePool:null,transitions:null}}function Uk(e,t,n){var s=t.pendingProps,a=Rn.current,c=!1,d=(t.flags&128)!==0,h;if((h=d)||(h=e!==null&&e.memoizedState===null?!1:(a&2)!==0),h?(c=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),wn(Rn,a&1),e===null)return hx(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(d=s.children,e=s.fallback,c?(s=t.mode,c=t.child,d={mode:"hidden",children:d},!(s&1)&&c!==null?(c.childLanes=0,c.pendingProps=d):c=S0(d,s,0,null),e=sc(e,s,n,null),c.return=t,e.return=t,c.sibling=e,t.child=c,t.child.memoizedState=zx(n),t.memoizedState=wx,e):Sb(t,d));if(a=e.memoizedState,a!==null&&(h=a.dehydrated,h!==null))return h_(e,t,d,s,h,a,n);if(c){c=s.fallback,d=t.mode,a=e.child,h=a.sibling;var g={mode:"hidden",children:s.children};return!(d&1)&&t.child!==a?(s=t.child,s.childLanes=0,s.pendingProps=g,t.deletions=null):(s=xl(a,g),s.subtreeFlags=a.subtreeFlags&14680064),h!==null?c=xl(h,c):(c=sc(c,d,n,null),c.flags|=2),c.return=t,s.return=t,s.sibling=c,t.child=s,s=c,c=t.child,d=e.child.memoizedState,d=d===null?zx(n):{baseLanes:d.baseLanes|n,cachePool:null,transitions:d.transitions},c.memoizedState=d,c.childLanes=e.childLanes&~n,t.memoizedState=wx,s}return c=e.child,e=c.sibling,s=xl(c,{mode:"visible",children:s.children}),!(t.mode&1)&&(s.lanes=n),s.return=t,s.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=s,t.memoizedState=null,s}function Sb(e,t){return t=S0({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Qf(e,t,n,s){return s!==null&&pb(s),$d(t,e.child,null,n),e=Sb(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function h_(e,t,n,s,a,c,d){if(n)return t.flags&256?(t.flags&=-257,s=dg(Error(ct(422))),Qf(e,t,d,s)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(c=s.fallback,a=t.mode,s=S0({mode:"visible",children:s.children},a,0,null),c=sc(c,a,d,null),c.flags|=2,s.return=t,c.return=t,s.sibling=c,t.child=s,t.mode&1&&$d(t,e.child,null,d),t.child.memoizedState=zx(d),t.memoizedState=wx,c);if(!(t.mode&1))return Qf(e,t,d,null);if(a.data==="$!"){if(s=a.nextSibling&&a.nextSibling.dataset,s)var h=s.dgst;return s=h,c=Error(ct(419)),s=dg(c,s,void 0),Qf(e,t,d,s)}if(h=(d&e.childLanes)!==0,fi||h){if(s=js,s!==null){switch(d&-d){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(s.suspendedLanes|d)?0:a,a!==0&&a!==c.retryLane&&(c.retryLane=a,za(e,a),ko(s,e,a,-1))}return $b(),s=dg(Error(ct(421))),Qf(e,t,d,s)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=__.bind(null,e),a._reactRetry=t,null):(e=c.treeContext,Pi=fl(a.nextSibling),$i=t,An=!0,wo=null,e!==null&&(Yi[Xi++]=ga,Yi[Xi++]=xa,Yi[Xi++]=ac,ga=e.id,xa=e.overflow,ac=t),t=Sb(t,s.children),t.flags|=4096,t)}function A1(e,t,n){e.lanes|=t;var s=e.alternate;s!==null&&(s.lanes|=t),mx(e.return,t,n)}function ug(e,t,n,s,a){var c=e.memoizedState;c===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:a}:(c.isBackwards=t,c.rendering=null,c.renderingStartTime=0,c.last=s,c.tail=n,c.tailMode=a)}function Fk(e,t,n){var s=t.pendingProps,a=s.revealOrder,c=s.tail;if(Xs(e,t,s.children,n),s=Rn.current,s&2)s=s&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&A1(e,n,t);else if(e.tag===19)A1(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(wn(Rn,s),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&Xh(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),ug(t,!1,a,n,c);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Xh(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}ug(t,!0,n,null,c);break;case"together":ug(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Eh(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function ka(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),cc|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(ct(153));if(t.child!==null){for(e=t.child,n=xl(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=xl(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function m_(e,t,n){switch(t.tag){case 3:Dk(t),Pd();break;case 5:fk(t);break;case 1:mi(t.type)&&Wh(t);break;case 4:bb(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,a=t.memoizedProps.value;wn(qh,s._currentValue),s._currentValue=a;break;case 13:if(s=t.memoizedState,s!==null)return s.dehydrated!==null?(wn(Rn,Rn.current&1),t.flags|=128,null):n&t.child.childLanes?Uk(e,t,n):(wn(Rn,Rn.current&1),e=ka(e,t,n),e!==null?e.sibling:null);wn(Rn,Rn.current&1);break;case 19:if(s=(n&t.childLanes)!==0,e.flags&128){if(s)return Fk(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),wn(Rn,Rn.current),s)break;return null;case 22:case 23:return t.lanes=0,Ok(e,t,n)}return ka(e,t,n)}var Bk,kx,Hk,Vk;Bk=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};kx=function(){};Hk=function(e,t,n,s){var a=e.memoizedProps;if(a!==s){e=t.stateNode,rc(Wo.current);var c=null;switch(n){case"input":a=Wg(e,a),s=Wg(e,s),c=[];break;case"select":a=Ln({},a,{value:void 0}),s=Ln({},s,{value:void 0}),c=[];break;case"textarea":a=qg(e,a),s=qg(e,s),c=[];break;default:typeof a.onClick!="function"&&typeof s.onClick=="function"&&(e.onclick=Hh)}Yg(n,s);var d;n=null;for(x in a)if(!s.hasOwnProperty(x)&&a.hasOwnProperty(x)&&a[x]!=null)if(x==="style"){var h=a[x];for(d in h)h.hasOwnProperty(d)&&(n||(n={}),n[d]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(bp.hasOwnProperty(x)?c||(c=[]):(c=c||[]).push(x,null));for(x in s){var g=s[x];if(h=a!=null?a[x]:void 0,s.hasOwnProperty(x)&&g!==h&&(g!=null||h!=null))if(x==="style")if(h){for(d in h)!h.hasOwnProperty(d)||g&&g.hasOwnProperty(d)||(n||(n={}),n[d]="");for(d in g)g.hasOwnProperty(d)&&h[d]!==g[d]&&(n||(n={}),n[d]=g[d])}else n||(c||(c=[]),c.push(x,n)),n=g;else x==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,h=h?h.__html:void 0,g!=null&&h!==g&&(c=c||[]).push(x,g)):x==="children"?typeof g!="string"&&typeof g!="number"||(c=c||[]).push(x,""+g):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(bp.hasOwnProperty(x)?(g!=null&&x==="onScroll"&&Sn("scroll",e),c||h===g||(c=[])):(c=c||[]).push(x,g))}n&&(c=c||[]).push("style",n);var x=c;(t.updateQueue=x)&&(t.flags|=4)}};Vk=function(e,t,n,s){n!==s&&(t.flags|=4)};function Mu(e,t){if(!An)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Us(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,s=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,s|=a.subtreeFlags&14680064,s|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,s|=a.subtreeFlags,s|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function g_(e,t,n){var s=t.pendingProps;switch(ub(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Us(t),null;case 1:return mi(t.type)&&Vh(),Us(t),null;case 3:return s=t.stateNode,Ad(),_n(hi),_n(Bs),vb(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(e===null||e.child===null)&&(Xf(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,wo!==null&&(Px(wo),wo=null))),kx(e,t),Us(t),null;case 5:yb(t);var a=rc(Ip.current);if(n=t.type,e!==null&&t.stateNode!=null)Hk(e,t,n,s,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(t.stateNode===null)throw Error(ct(166));return Us(t),null}if(e=rc(Wo.current),Xf(t)){s=t.stateNode,n=t.type;var c=t.memoizedProps;switch(s[Uo]=t,s[Cp]=c,e=(t.mode&1)!==0,n){case"dialog":Sn("cancel",s),Sn("close",s);break;case"iframe":case"object":case"embed":Sn("load",s);break;case"video":case"audio":for(a=0;a<Qu.length;a++)Sn(Qu[a],s);break;case"source":Sn("error",s);break;case"img":case"image":case"link":Sn("error",s),Sn("load",s);break;case"details":Sn("toggle",s);break;case"input":Bv(s,c),Sn("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!c.multiple},Sn("invalid",s);break;case"textarea":Vv(s,c),Sn("invalid",s)}Yg(n,c),a=null;for(var d in c)if(c.hasOwnProperty(d)){var h=c[d];d==="children"?typeof h=="string"?s.textContent!==h&&(c.suppressHydrationWarning!==!0&&Yf(s.textContent,h,e),a=["children",h]):typeof h=="number"&&s.textContent!==""+h&&(c.suppressHydrationWarning!==!0&&Yf(s.textContent,h,e),a=["children",""+h]):bp.hasOwnProperty(d)&&h!=null&&d==="onScroll"&&Sn("scroll",s)}switch(n){case"input":Bf(s),Hv(s,c,!0);break;case"textarea":Bf(s),Wv(s);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(s.onclick=Hh)}s=a,t.updateQueue=s,s!==null&&(t.flags|=4)}else{d=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=bz(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=d.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof s.is=="string"?e=d.createElement(n,{is:s.is}):(e=d.createElement(n),n==="select"&&(d=e,s.multiple?d.multiple=!0:s.size&&(d.size=s.size))):e=d.createElementNS(e,n),e[Uo]=t,e[Cp]=s,Bk(e,t,!1,!1),t.stateNode=e;e:{switch(d=Xg(n,s),n){case"dialog":Sn("cancel",e),Sn("close",e),a=s;break;case"iframe":case"object":case"embed":Sn("load",e),a=s;break;case"video":case"audio":for(a=0;a<Qu.length;a++)Sn(Qu[a],e);a=s;break;case"source":Sn("error",e),a=s;break;case"img":case"image":case"link":Sn("error",e),Sn("load",e),a=s;break;case"details":Sn("toggle",e),a=s;break;case"input":Bv(e,s),a=Wg(e,s),Sn("invalid",e);break;case"option":a=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},a=Ln({},s,{value:void 0}),Sn("invalid",e);break;case"textarea":Vv(e,s),a=qg(e,s),Sn("invalid",e);break;default:a=s}Yg(n,a),h=a;for(c in h)if(h.hasOwnProperty(c)){var g=h[c];c==="style"?wz(e,g):c==="dangerouslySetInnerHTML"?(g=g?g.__html:void 0,g!=null&&yz(e,g)):c==="children"?typeof g=="string"?(n!=="textarea"||g!=="")&&yp(e,g):typeof g=="number"&&yp(e,""+g):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(bp.hasOwnProperty(c)?g!=null&&c==="onScroll"&&Sn("scroll",e):g!=null&&Yx(e,c,g,d))}switch(n){case"input":Bf(e),Hv(e,s,!1);break;case"textarea":Bf(e),Wv(e);break;case"option":s.value!=null&&e.setAttribute("value",""+bl(s.value));break;case"select":e.multiple=!!s.multiple,c=s.value,c!=null?kd(e,!!s.multiple,c,!1):s.defaultValue!=null&&kd(e,!!s.multiple,s.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Hh)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Us(t),null;case 6:if(e&&t.stateNode!=null)Vk(e,t,e.memoizedProps,s);else{if(typeof s!="string"&&t.stateNode===null)throw Error(ct(166));if(n=rc(Ip.current),rc(Wo.current),Xf(t)){if(s=t.stateNode,n=t.memoizedProps,s[Uo]=t,(c=s.nodeValue!==n)&&(e=$i,e!==null))switch(e.tag){case 3:Yf(s.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Yf(s.nodeValue,n,(e.mode&1)!==0)}c&&(t.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Uo]=t,t.stateNode=s}return Us(t),null;case 13:if(_n(Rn),s=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(An&&Pi!==null&&t.mode&1&&!(t.flags&128))lk(),Pd(),t.flags|=98560,c=!1;else if(c=Xf(t),s!==null&&s.dehydrated!==null){if(e===null){if(!c)throw Error(ct(318));if(c=t.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ct(317));c[Uo]=t}else Pd(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Us(t),c=!1}else wo!==null&&(Px(wo),wo=null),c=!0;if(!c)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(s=s!==null,s!==(e!==null&&e.memoizedState!==null)&&s&&(t.child.flags|=8192,t.mode&1&&(e===null||Rn.current&1?hs===0&&(hs=3):$b())),t.updateQueue!==null&&(t.flags|=4),Us(t),null);case 4:return Ad(),kx(e,t),e===null&&Sp(t.stateNode.containerInfo),Us(t),null;case 10:return mb(t.type._context),Us(t),null;case 17:return mi(t.type)&&Vh(),Us(t),null;case 19:if(_n(Rn),c=t.memoizedState,c===null)return Us(t),null;if(s=(t.flags&128)!==0,d=c.rendering,d===null)if(s)Mu(c,!1);else{if(hs!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(d=Xh(e),d!==null){for(t.flags|=128,Mu(c,!1),s=d.updateQueue,s!==null&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;n!==null;)c=n,e=s,c.flags&=14680066,d=c.alternate,d===null?(c.childLanes=0,c.lanes=e,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=d.childLanes,c.lanes=d.lanes,c.child=d.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=d.memoizedProps,c.memoizedState=d.memoizedState,c.updateQueue=d.updateQueue,c.type=d.type,e=d.dependencies,c.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return wn(Rn,Rn.current&1|2),t.child}e=e.sibling}c.tail!==null&&ts()>Md&&(t.flags|=128,s=!0,Mu(c,!1),t.lanes=4194304)}else{if(!s)if(e=Xh(d),e!==null){if(t.flags|=128,s=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Mu(c,!0),c.tail===null&&c.tailMode==="hidden"&&!d.alternate&&!An)return Us(t),null}else 2*ts()-c.renderingStartTime>Md&&n!==1073741824&&(t.flags|=128,s=!0,Mu(c,!1),t.lanes=4194304);c.isBackwards?(d.sibling=t.child,t.child=d):(n=c.last,n!==null?n.sibling=d:t.child=d,c.last=d)}return c.tail!==null?(t=c.tail,c.rendering=t,c.tail=t.sibling,c.renderingStartTime=ts(),t.sibling=null,n=Rn.current,wn(Rn,s?n&1|2:n&1),t):(Us(t),null);case 22:case 23:return Pb(),s=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==s&&(t.flags|=8192),s&&t.mode&1?Ei&1073741824&&(Us(t),t.subtreeFlags&6&&(t.flags|=8192)):Us(t),null;case 24:return null;case 25:return null}throw Error(ct(156,t.tag))}function x_(e,t){switch(ub(t),t.tag){case 1:return mi(t.type)&&Vh(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Ad(),_n(hi),_n(Bs),vb(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return yb(t),null;case 13:if(_n(Rn),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(ct(340));Pd()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return _n(Rn),null;case 4:return Ad(),null;case 10:return mb(t.type._context),null;case 22:case 23:return Pb(),null;case 24:return null;default:return null}}var eh=!1,Fs=!1,b_=typeof WeakSet=="function"?WeakSet:Set,Gt=null;function yd(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Wn(e,t,s)}else n.current=null}function jx(e,t,n){try{n()}catch(s){Wn(e,t,s)}}var T1=!1;function y_(e,t){if(ax=Uh,e=Gz(),cb(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var a=s.anchorOffset,c=s.focusNode;s=s.focusOffset;try{n.nodeType,c.nodeType}catch{n=null;break e}var d=0,h=-1,g=-1,x=0,N=0,C=e,A=null;t:for(;;){for(var _;C!==n||a!==0&&C.nodeType!==3||(h=d+a),C!==c||s!==0&&C.nodeType!==3||(g=d+s),C.nodeType===3&&(d+=C.nodeValue.length),(_=C.firstChild)!==null;)A=C,C=_;for(;;){if(C===e)break t;if(A===n&&++x===a&&(h=d),A===c&&++N===s&&(g=d),(_=C.nextSibling)!==null)break;C=A,A=C.parentNode}C=_}n=h===-1||g===-1?null:{start:h,end:g}}else n=null}n=n||{start:0,end:0}}else n=null;for(lx={focusedElem:e,selectionRange:n},Uh=!1,Gt=t;Gt!==null;)if(t=Gt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Gt=e;else for(;Gt!==null;){t=Gt;try{var R=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(R!==null){var $=R.memoizedProps,L=R.memoizedState,S=t.stateNode,P=S.getSnapshotBeforeUpdate(t.elementType===t.type?$:bo(t.type,$),L);S.__reactInternalSnapshotBeforeUpdate=P}break;case 3:var O=t.stateNode.containerInfo;O.nodeType===1?O.textContent="":O.nodeType===9&&O.documentElement&&O.removeChild(O.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ct(163))}}catch(K){Wn(t,t.return,K)}if(e=t.sibling,e!==null){e.return=t.return,Gt=e;break}Gt=t.return}return R=T1,T1=!1,R}function cp(e,t,n){var s=t.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var a=s=s.next;do{if((a.tag&e)===e){var c=a.destroy;a.destroy=void 0,c!==void 0&&jx(t,n,c)}a=a.next}while(a!==s)}}function j0(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function Nx(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Wk(e){var t=e.alternate;t!==null&&(e.alternate=null,Wk(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Uo],delete t[Cp],delete t[ux],delete t[t_],delete t[r_])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Kk(e){return e.tag===5||e.tag===3||e.tag===4}function M1(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Kk(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Sx(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Hh));else if(s!==4&&(e=e.child,e!==null))for(Sx(e,t,n),e=e.sibling;e!==null;)Sx(e,t,n),e=e.sibling}function _x(e,t,n){var s=e.tag;if(s===5||s===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(s!==4&&(e=e.child,e!==null))for(_x(e,t,n),e=e.sibling;e!==null;)_x(e,t,n),e=e.sibling}var $s=null,vo=!1;function tl(e,t,n){for(n=n.child;n!==null;)Jk(e,t,n),n=n.sibling}function Jk(e,t,n){if(Vo&&typeof Vo.onCommitFiberUnmount=="function")try{Vo.onCommitFiberUnmount(g0,n)}catch{}switch(n.tag){case 5:Fs||yd(n,t);case 6:var s=$s,a=vo;$s=null,tl(e,t,n),$s=s,vo=a,$s!==null&&(vo?(e=$s,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):$s.removeChild(n.stateNode));break;case 18:$s!==null&&(vo?(e=$s,n=n.stateNode,e.nodeType===8?sg(e.parentNode,n):e.nodeType===1&&sg(e,n),kp(e)):sg($s,n.stateNode));break;case 4:s=$s,a=vo,$s=n.stateNode.containerInfo,vo=!0,tl(e,t,n),$s=s,vo=a;break;case 0:case 11:case 14:case 15:if(!Fs&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){a=s=s.next;do{var c=a,d=c.destroy;c=c.tag,d!==void 0&&(c&2||c&4)&&jx(n,t,d),a=a.next}while(a!==s)}tl(e,t,n);break;case 1:if(!Fs&&(yd(n,t),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(h){Wn(n,t,h)}tl(e,t,n);break;case 21:tl(e,t,n);break;case 22:n.mode&1?(Fs=(s=Fs)||n.memoizedState!==null,tl(e,t,n),Fs=s):tl(e,t,n);break;default:tl(e,t,n)}}function R1(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new b_),t.forEach(function(s){var a=C_.bind(null,e,s);n.has(s)||(n.add(s),s.then(a,a))})}}function ho(e,t){var n=t.deletions;if(n!==null)for(var s=0;s<n.length;s++){var a=n[s];try{var c=e,d=t,h=d;e:for(;h!==null;){switch(h.tag){case 5:$s=h.stateNode,vo=!1;break e;case 3:$s=h.stateNode.containerInfo,vo=!0;break e;case 4:$s=h.stateNode.containerInfo,vo=!0;break e}h=h.return}if($s===null)throw Error(ct(160));Jk(c,d,a),$s=null,vo=!1;var g=a.alternate;g!==null&&(g.return=null),a.return=null}catch(x){Wn(a,t,x)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)qk(t,e),t=t.sibling}function qk(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ho(t,e),Mo(e),s&4){try{cp(3,e,e.return),j0(3,e)}catch($){Wn(e,e.return,$)}try{cp(5,e,e.return)}catch($){Wn(e,e.return,$)}}break;case 1:ho(t,e),Mo(e),s&512&&n!==null&&yd(n,n.return);break;case 5:if(ho(t,e),Mo(e),s&512&&n!==null&&yd(n,n.return),e.flags&32){var a=e.stateNode;try{yp(a,"")}catch($){Wn(e,e.return,$)}}if(s&4&&(a=e.stateNode,a!=null)){var c=e.memoizedProps,d=n!==null?n.memoizedProps:c,h=e.type,g=e.updateQueue;if(e.updateQueue=null,g!==null)try{h==="input"&&c.type==="radio"&&c.name!=null&&gz(a,c),Xg(h,d);var x=Xg(h,c);for(d=0;d<g.length;d+=2){var N=g[d],C=g[d+1];N==="style"?wz(a,C):N==="dangerouslySetInnerHTML"?yz(a,C):N==="children"?yp(a,C):Yx(a,N,C,x)}switch(h){case"input":Kg(a,c);break;case"textarea":xz(a,c);break;case"select":var A=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!c.multiple;var _=c.value;_!=null?kd(a,!!c.multiple,_,!1):A!==!!c.multiple&&(c.defaultValue!=null?kd(a,!!c.multiple,c.defaultValue,!0):kd(a,!!c.multiple,c.multiple?[]:"",!1))}a[Cp]=c}catch($){Wn(e,e.return,$)}}break;case 6:if(ho(t,e),Mo(e),s&4){if(e.stateNode===null)throw Error(ct(162));a=e.stateNode,c=e.memoizedProps;try{a.nodeValue=c}catch($){Wn(e,e.return,$)}}break;case 3:if(ho(t,e),Mo(e),s&4&&n!==null&&n.memoizedState.isDehydrated)try{kp(t.containerInfo)}catch($){Wn(e,e.return,$)}break;case 4:ho(t,e),Mo(e);break;case 13:ho(t,e),Mo(e),a=e.child,a.flags&8192&&(c=a.memoizedState!==null,a.stateNode.isHidden=c,!c||a.alternate!==null&&a.alternate.memoizedState!==null||(Eb=ts())),s&4&&R1(e);break;case 22:if(N=n!==null&&n.memoizedState!==null,e.mode&1?(Fs=(x=Fs)||N,ho(t,e),Fs=x):ho(t,e),Mo(e),s&8192){if(x=e.memoizedState!==null,(e.stateNode.isHidden=x)&&!N&&e.mode&1)for(Gt=e,N=e.child;N!==null;){for(C=Gt=N;Gt!==null;){switch(A=Gt,_=A.child,A.tag){case 0:case 11:case 14:case 15:cp(4,A,A.return);break;case 1:yd(A,A.return);var R=A.stateNode;if(typeof R.componentWillUnmount=="function"){s=A,n=A.return;try{t=s,R.props=t.memoizedProps,R.state=t.memoizedState,R.componentWillUnmount()}catch($){Wn(s,n,$)}}break;case 5:yd(A,A.return);break;case 22:if(A.memoizedState!==null){L1(C);continue}}_!==null?(_.return=A,Gt=_):L1(C)}N=N.sibling}e:for(N=null,C=e;;){if(C.tag===5){if(N===null){N=C;try{a=C.stateNode,x?(c=a.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(h=C.stateNode,g=C.memoizedProps.style,d=g!=null&&g.hasOwnProperty("display")?g.display:null,h.style.display=vz("display",d))}catch($){Wn(e,e.return,$)}}}else if(C.tag===6){if(N===null)try{C.stateNode.nodeValue=x?"":C.memoizedProps}catch($){Wn(e,e.return,$)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===e)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===e)break e;for(;C.sibling===null;){if(C.return===null||C.return===e)break e;N===C&&(N=null),C=C.return}N===C&&(N=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:ho(t,e),Mo(e),s&4&&R1(e);break;case 21:break;default:ho(t,e),Mo(e)}}function Mo(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Kk(n)){var s=n;break e}n=n.return}throw Error(ct(160))}switch(s.tag){case 5:var a=s.stateNode;s.flags&32&&(yp(a,""),s.flags&=-33);var c=M1(e);_x(e,c,a);break;case 3:case 4:var d=s.stateNode.containerInfo,h=M1(e);Sx(e,h,d);break;default:throw Error(ct(161))}}catch(g){Wn(e,e.return,g)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function v_(e,t,n){Gt=e,Gk(e)}function Gk(e,t,n){for(var s=(e.mode&1)!==0;Gt!==null;){var a=Gt,c=a.child;if(a.tag===22&&s){var d=a.memoizedState!==null||eh;if(!d){var h=a.alternate,g=h!==null&&h.memoizedState!==null||Fs;h=eh;var x=Fs;if(eh=d,(Fs=g)&&!x)for(Gt=a;Gt!==null;)d=Gt,g=d.child,d.tag===22&&d.memoizedState!==null?D1(a):g!==null?(g.return=d,Gt=g):D1(a);for(;c!==null;)Gt=c,Gk(c),c=c.sibling;Gt=a,eh=h,Fs=x}O1(e)}else a.subtreeFlags&8772&&c!==null?(c.return=a,Gt=c):O1(e)}}function O1(e){for(;Gt!==null;){var t=Gt;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Fs||j0(5,t);break;case 1:var s=t.stateNode;if(t.flags&4&&!Fs)if(n===null)s.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:bo(t.type,n.memoizedProps);s.componentDidUpdate(a,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var c=t.updateQueue;c!==null&&w1(t,c,s);break;case 3:var d=t.updateQueue;if(d!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}w1(t,d,n)}break;case 5:var h=t.stateNode;if(n===null&&t.flags&4){n=h;var g=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":g.autoFocus&&n.focus();break;case"img":g.src&&(n.src=g.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var x=t.alternate;if(x!==null){var N=x.memoizedState;if(N!==null){var C=N.dehydrated;C!==null&&kp(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ct(163))}Fs||t.flags&512&&Nx(t)}catch(A){Wn(t,t.return,A)}}if(t===e){Gt=null;break}if(n=t.sibling,n!==null){n.return=t.return,Gt=n;break}Gt=t.return}}function L1(e){for(;Gt!==null;){var t=Gt;if(t===e){Gt=null;break}var n=t.sibling;if(n!==null){n.return=t.return,Gt=n;break}Gt=t.return}}function D1(e){for(;Gt!==null;){var t=Gt;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{j0(4,t)}catch(g){Wn(t,n,g)}break;case 1:var s=t.stateNode;if(typeof s.componentDidMount=="function"){var a=t.return;try{s.componentDidMount()}catch(g){Wn(t,a,g)}}var c=t.return;try{Nx(t)}catch(g){Wn(t,c,g)}break;case 5:var d=t.return;try{Nx(t)}catch(g){Wn(t,d,g)}}}catch(g){Wn(t,t.return,g)}if(t===e){Gt=null;break}var h=t.sibling;if(h!==null){h.return=t.return,Gt=h;break}Gt=t.return}}var w_=Math.ceil,e0=ja.ReactCurrentDispatcher,_b=ja.ReactCurrentOwner,Qi=ja.ReactCurrentBatchConfig,Wr=0,js=null,ls=null,As=0,Ei=0,vd=zl(0),hs=0,Tp=null,cc=0,N0=0,Cb=0,dp=null,pi=null,Eb=0,Md=1/0,ua=null,t0=!1,Cx=null,ml=null,th=!1,cl=null,r0=0,up=0,Ex=null,Ih=-1,Ph=0;function Zs(){return Wr&6?ts():Ih!==-1?Ih:Ih=ts()}function gl(e){return e.mode&1?Wr&2&&As!==0?As&-As:s_.transition!==null?(Ph===0&&(Ph=Az()),Ph):(e=dn,e!==0||(e=window.event,e=e===void 0?16:Uz(e.type)),e):1}function ko(e,t,n,s){if(50<up)throw up=0,Ex=null,Error(ct(185));Lp(e,n,s),(!(Wr&2)||e!==js)&&(e===js&&(!(Wr&2)&&(N0|=n),hs===4&&al(e,As)),gi(e,s),n===1&&Wr===0&&!(t.mode&1)&&(Md=ts()+500,w0&&kl()))}function gi(e,t){var n=e.callbackNode;s5(e,t);var s=Dh(e,e===js?As:0);if(s===0)n!==null&&qv(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(n!=null&&qv(n),t===1)e.tag===0?n_(U1.bind(null,e)):ik(U1.bind(null,e)),Q5(function(){!(Wr&6)&&kl()}),n=null;else{switch(Tz(s)){case 1:n=tb;break;case 4:n=Pz;break;case 16:n=Lh;break;case 536870912:n=$z;break;default:n=Lh}n=n2(n,Yk.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Yk(e,t){if(Ih=-1,Ph=0,Wr&6)throw Error(ct(327));var n=e.callbackNode;if(Cd()&&e.callbackNode!==n)return null;var s=Dh(e,e===js?As:0);if(s===0)return null;if(s&30||s&e.expiredLanes||t)t=n0(e,s);else{t=s;var a=Wr;Wr|=2;var c=Zk();(js!==e||As!==t)&&(ua=null,Md=ts()+500,nc(e,t));do try{j_();break}catch(h){Xk(e,h)}while(!0);hb(),e0.current=c,Wr=a,ls!==null?t=0:(js=null,As=0,t=hs)}if(t!==0){if(t===2&&(a=rx(e),a!==0&&(s=a,t=Ix(e,a))),t===1)throw n=Tp,nc(e,0),al(e,s),gi(e,ts()),n;if(t===6)al(e,s);else{if(a=e.current.alternate,!(s&30)&&!z_(a)&&(t=n0(e,s),t===2&&(c=rx(e),c!==0&&(s=c,t=Ix(e,c))),t===1))throw n=Tp,nc(e,0),al(e,s),gi(e,ts()),n;switch(e.finishedWork=a,e.finishedLanes=s,t){case 0:case 1:throw Error(ct(345));case 2:Yl(e,pi,ua);break;case 3:if(al(e,s),(s&130023424)===s&&(t=Eb+500-ts(),10<t)){if(Dh(e,0)!==0)break;if(a=e.suspendedLanes,(a&s)!==s){Zs(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=dx(Yl.bind(null,e,pi,ua),t);break}Yl(e,pi,ua);break;case 4:if(al(e,s),(s&4194240)===s)break;for(t=e.eventTimes,a=-1;0<s;){var d=31-zo(s);c=1<<d,d=t[d],d>a&&(a=d),s&=~c}if(s=a,s=ts()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*w_(s/1960))-s,10<s){e.timeoutHandle=dx(Yl.bind(null,e,pi,ua),s);break}Yl(e,pi,ua);break;case 5:Yl(e,pi,ua);break;default:throw Error(ct(329))}}}return gi(e,ts()),e.callbackNode===n?Yk.bind(null,e):null}function Ix(e,t){var n=dp;return e.current.memoizedState.isDehydrated&&(nc(e,t).flags|=256),e=n0(e,t),e!==2&&(t=pi,pi=n,t!==null&&Px(t)),e}function Px(e){pi===null?pi=e:pi.push.apply(pi,e)}function z_(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var a=n[s],c=a.getSnapshot;a=a.value;try{if(!jo(c(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function al(e,t){for(t&=~Cb,t&=~N0,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-zo(t),s=1<<n;e[n]=-1,t&=~s}}function U1(e){if(Wr&6)throw Error(ct(327));Cd();var t=Dh(e,0);if(!(t&1))return gi(e,ts()),null;var n=n0(e,t);if(e.tag!==0&&n===2){var s=rx(e);s!==0&&(t=s,n=Ix(e,s))}if(n===1)throw n=Tp,nc(e,0),al(e,t),gi(e,ts()),n;if(n===6)throw Error(ct(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Yl(e,pi,ua),gi(e,ts()),null}function Ib(e,t){var n=Wr;Wr|=1;try{return e(t)}finally{Wr=n,Wr===0&&(Md=ts()+500,w0&&kl())}}function dc(e){cl!==null&&cl.tag===0&&!(Wr&6)&&Cd();var t=Wr;Wr|=1;var n=Qi.transition,s=dn;try{if(Qi.transition=null,dn=1,e)return e()}finally{dn=s,Qi.transition=n,Wr=t,!(Wr&6)&&kl()}}function Pb(){Ei=vd.current,_n(vd)}function nc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,Z5(n)),ls!==null)for(n=ls.return;n!==null;){var s=n;switch(ub(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Vh();break;case 3:Ad(),_n(hi),_n(Bs),vb();break;case 5:yb(s);break;case 4:Ad();break;case 13:_n(Rn);break;case 19:_n(Rn);break;case 10:mb(s.type._context);break;case 22:case 23:Pb()}n=n.return}if(js=e,ls=e=xl(e.current,null),As=Ei=t,hs=0,Tp=null,Cb=N0=cc=0,pi=dp=null,tc!==null){for(t=0;t<tc.length;t++)if(n=tc[t],s=n.interleaved,s!==null){n.interleaved=null;var a=s.next,c=n.pending;if(c!==null){var d=c.next;c.next=a,s.next=d}n.pending=s}tc=null}return e}function Xk(e,t){do{var n=ls;try{if(hb(),_h.current=Qh,Zh){for(var s=On.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Zh=!1}if(lc=0,ks=fs=On=null,lp=!1,Pp=0,_b.current=null,n===null||n.return===null){hs=1,Tp=t,ls=null;break}e:{var c=e,d=n.return,h=n,g=t;if(t=As,h.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){var x=g,N=h,C=N.tag;if(!(N.mode&1)&&(C===0||C===11||C===15)){var A=N.alternate;A?(N.updateQueue=A.updateQueue,N.memoizedState=A.memoizedState,N.lanes=A.lanes):(N.updateQueue=null,N.memoizedState=null)}var _=_1(d);if(_!==null){_.flags&=-257,C1(_,d,h,c,t),_.mode&1&&S1(c,x,t),t=_,g=x;var R=t.updateQueue;if(R===null){var $=new Set;$.add(g),t.updateQueue=$}else R.add(g);break e}else{if(!(t&1)){S1(c,x,t),$b();break e}g=Error(ct(426))}}else if(An&&h.mode&1){var L=_1(d);if(L!==null){!(L.flags&65536)&&(L.flags|=256),C1(L,d,h,c,t),pb(Td(g,h));break e}}c=g=Td(g,h),hs!==4&&(hs=2),dp===null?dp=[c]:dp.push(c),c=d;do{switch(c.tag){case 3:c.flags|=65536,t&=-t,c.lanes|=t;var S=Tk(c,g,t);v1(c,S);break e;case 1:h=g;var P=c.type,O=c.stateNode;if(!(c.flags&128)&&(typeof P.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(ml===null||!ml.has(O)))){c.flags|=65536,t&=-t,c.lanes|=t;var K=Mk(c,h,t);v1(c,K);break e}}c=c.return}while(c!==null)}e2(n)}catch(Q){t=Q,ls===n&&n!==null&&(ls=n=n.return);continue}break}while(!0)}function Zk(){var e=e0.current;return e0.current=Qh,e===null?Qh:e}function $b(){(hs===0||hs===3||hs===2)&&(hs=4),js===null||!(cc&268435455)&&!(N0&268435455)||al(js,As)}function n0(e,t){var n=Wr;Wr|=2;var s=Zk();(js!==e||As!==t)&&(ua=null,nc(e,t));do try{k_();break}catch(a){Xk(e,a)}while(!0);if(hb(),Wr=n,e0.current=s,ls!==null)throw Error(ct(261));return js=null,As=0,hs}function k_(){for(;ls!==null;)Qk(ls)}function j_(){for(;ls!==null&&!GS();)Qk(ls)}function Qk(e){var t=r2(e.alternate,e,Ei);e.memoizedProps=e.pendingProps,t===null?e2(e):ls=t,_b.current=null}function e2(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=x_(n,t),n!==null){n.flags&=32767,ls=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{hs=6,ls=null;return}}else if(n=g_(n,t,Ei),n!==null){ls=n;return}if(t=t.sibling,t!==null){ls=t;return}ls=t=e}while(t!==null);hs===0&&(hs=5)}function Yl(e,t,n){var s=dn,a=Qi.transition;try{Qi.transition=null,dn=1,N_(e,t,n,s)}finally{Qi.transition=a,dn=s}return null}function N_(e,t,n,s){do Cd();while(cl!==null);if(Wr&6)throw Error(ct(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(ct(177));e.callbackNode=null,e.callbackPriority=0;var c=n.lanes|n.childLanes;if(i5(e,c),e===js&&(ls=js=null,As=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||th||(th=!0,n2(Lh,function(){return Cd(),null})),c=(n.flags&15990)!==0,n.subtreeFlags&15990||c){c=Qi.transition,Qi.transition=null;var d=dn;dn=1;var h=Wr;Wr|=4,_b.current=null,y_(e,n),qk(n,e),W5(lx),Uh=!!ax,lx=ax=null,e.current=n,v_(n),YS(),Wr=h,dn=d,Qi.transition=c}else e.current=n;if(th&&(th=!1,cl=e,r0=a),c=e.pendingLanes,c===0&&(ml=null),QS(n.stateNode),gi(e,ts()),t!==null)for(s=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],s(a.value,{componentStack:a.stack,digest:a.digest});if(t0)throw t0=!1,e=Cx,Cx=null,e;return r0&1&&e.tag!==0&&Cd(),c=e.pendingLanes,c&1?e===Ex?up++:(up=0,Ex=e):up=0,kl(),null}function Cd(){if(cl!==null){var e=Tz(r0),t=Qi.transition,n=dn;try{if(Qi.transition=null,dn=16>e?16:e,cl===null)var s=!1;else{if(e=cl,cl=null,r0=0,Wr&6)throw Error(ct(331));var a=Wr;for(Wr|=4,Gt=e.current;Gt!==null;){var c=Gt,d=c.child;if(Gt.flags&16){var h=c.deletions;if(h!==null){for(var g=0;g<h.length;g++){var x=h[g];for(Gt=x;Gt!==null;){var N=Gt;switch(N.tag){case 0:case 11:case 15:cp(8,N,c)}var C=N.child;if(C!==null)C.return=N,Gt=C;else for(;Gt!==null;){N=Gt;var A=N.sibling,_=N.return;if(Wk(N),N===x){Gt=null;break}if(A!==null){A.return=_,Gt=A;break}Gt=_}}}var R=c.alternate;if(R!==null){var $=R.child;if($!==null){R.child=null;do{var L=$.sibling;$.sibling=null,$=L}while($!==null)}}Gt=c}}if(c.subtreeFlags&2064&&d!==null)d.return=c,Gt=d;else e:for(;Gt!==null;){if(c=Gt,c.flags&2048)switch(c.tag){case 0:case 11:case 15:cp(9,c,c.return)}var S=c.sibling;if(S!==null){S.return=c.return,Gt=S;break e}Gt=c.return}}var P=e.current;for(Gt=P;Gt!==null;){d=Gt;var O=d.child;if(d.subtreeFlags&2064&&O!==null)O.return=d,Gt=O;else e:for(d=P;Gt!==null;){if(h=Gt,h.flags&2048)try{switch(h.tag){case 0:case 11:case 15:j0(9,h)}}catch(Q){Wn(h,h.return,Q)}if(h===d){Gt=null;break e}var K=h.sibling;if(K!==null){K.return=h.return,Gt=K;break e}Gt=h.return}}if(Wr=a,kl(),Vo&&typeof Vo.onPostCommitFiberRoot=="function")try{Vo.onPostCommitFiberRoot(g0,e)}catch{}s=!0}return s}finally{dn=n,Qi.transition=t}}return!1}function F1(e,t,n){t=Td(n,t),t=Tk(e,t,1),e=hl(e,t,1),t=Zs(),e!==null&&(Lp(e,1,t),gi(e,t))}function Wn(e,t,n){if(e.tag===3)F1(e,e,n);else for(;t!==null;){if(t.tag===3){F1(t,e,n);break}else if(t.tag===1){var s=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(ml===null||!ml.has(s))){e=Td(n,e),e=Mk(t,e,1),t=hl(t,e,1),e=Zs(),t!==null&&(Lp(t,1,e),gi(t,e));break}}t=t.return}}function S_(e,t,n){var s=e.pingCache;s!==null&&s.delete(t),t=Zs(),e.pingedLanes|=e.suspendedLanes&n,js===e&&(As&n)===n&&(hs===4||hs===3&&(As&130023424)===As&&500>ts()-Eb?nc(e,0):Cb|=n),gi(e,t)}function t2(e,t){t===0&&(e.mode&1?(t=Wf,Wf<<=1,!(Wf&130023424)&&(Wf=4194304)):t=1);var n=Zs();e=za(e,t),e!==null&&(Lp(e,t,n),gi(e,n))}function __(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),t2(e,n)}function C_(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(ct(314))}s!==null&&s.delete(t),t2(e,n)}var r2;r2=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||hi.current)fi=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return fi=!1,m_(e,t,n);fi=!!(e.flags&131072)}else fi=!1,An&&t.flags&1048576&&ok(t,Jh,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Eh(e,t),e=t.pendingProps;var a=Id(t,Bs.current);_d(t,n),a=zb(null,t,s,e,a,n);var c=kb();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,mi(s)?(c=!0,Wh(t)):c=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,xb(t),a.updater=k0,t.stateNode=a,a._reactInternals=t,xx(t,s,e,n),t=vx(null,t,s,!0,c,n)):(t.tag=0,An&&c&&db(t),Xs(null,t,a,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Eh(e,t),e=t.pendingProps,a=s._init,s=a(s._payload),t.type=s,a=t.tag=I_(s),e=bo(s,e),a){case 0:t=yx(null,t,s,e,n);break e;case 1:t=P1(null,t,s,e,n);break e;case 11:t=E1(null,t,s,e,n);break e;case 14:t=I1(null,t,s,bo(s.type,e),n);break e}throw Error(ct(306,s,""))}return t;case 0:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:bo(s,a),yx(e,t,s,a,n);case 1:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:bo(s,a),P1(e,t,s,a,n);case 3:e:{if(Dk(t),e===null)throw Error(ct(387));s=t.pendingProps,c=t.memoizedState,a=c.element,pk(e,t),Yh(t,s,null,n);var d=t.memoizedState;if(s=d.element,c.isDehydrated)if(c={element:s,isDehydrated:!1,cache:d.cache,pendingSuspenseBoundaries:d.pendingSuspenseBoundaries,transitions:d.transitions},t.updateQueue.baseState=c,t.memoizedState=c,t.flags&256){a=Td(Error(ct(423)),t),t=$1(e,t,s,n,a);break e}else if(s!==a){a=Td(Error(ct(424)),t),t=$1(e,t,s,n,a);break e}else for(Pi=fl(t.stateNode.containerInfo.firstChild),$i=t,An=!0,wo=null,n=dk(t,null,s,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Pd(),s===a){t=ka(e,t,n);break e}Xs(e,t,s,n)}t=t.child}return t;case 5:return fk(t),e===null&&hx(t),s=t.type,a=t.pendingProps,c=e!==null?e.memoizedProps:null,d=a.children,cx(s,a)?d=null:c!==null&&cx(s,c)&&(t.flags|=32),Lk(e,t),Xs(e,t,d,n),t.child;case 6:return e===null&&hx(t),null;case 13:return Uk(e,t,n);case 4:return bb(t,t.stateNode.containerInfo),s=t.pendingProps,e===null?t.child=$d(t,null,s,n):Xs(e,t,s,n),t.child;case 11:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:bo(s,a),E1(e,t,s,a,n);case 7:return Xs(e,t,t.pendingProps,n),t.child;case 8:return Xs(e,t,t.pendingProps.children,n),t.child;case 12:return Xs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,a=t.pendingProps,c=t.memoizedProps,d=a.value,wn(qh,s._currentValue),s._currentValue=d,c!==null)if(jo(c.value,d)){if(c.children===a.children&&!hi.current){t=ka(e,t,n);break e}}else for(c=t.child,c!==null&&(c.return=t);c!==null;){var h=c.dependencies;if(h!==null){d=c.child;for(var g=h.firstContext;g!==null;){if(g.context===s){if(c.tag===1){g=ya(-1,n&-n),g.tag=2;var x=c.updateQueue;if(x!==null){x=x.shared;var N=x.pending;N===null?g.next=g:(g.next=N.next,N.next=g),x.pending=g}}c.lanes|=n,g=c.alternate,g!==null&&(g.lanes|=n),mx(c.return,n,t),h.lanes|=n;break}g=g.next}}else if(c.tag===10)d=c.type===t.type?null:c.child;else if(c.tag===18){if(d=c.return,d===null)throw Error(ct(341));d.lanes|=n,h=d.alternate,h!==null&&(h.lanes|=n),mx(d,n,t),d=c.sibling}else d=c.child;if(d!==null)d.return=c;else for(d=c;d!==null;){if(d===t){d=null;break}if(c=d.sibling,c!==null){c.return=d.return,d=c;break}d=d.return}c=d}Xs(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,s=t.pendingProps.children,_d(t,n),a=eo(a),s=s(a),t.flags|=1,Xs(e,t,s,n),t.child;case 14:return s=t.type,a=bo(s,t.pendingProps),a=bo(s.type,a),I1(e,t,s,a,n);case 15:return Rk(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,a=t.pendingProps,a=t.elementType===s?a:bo(s,a),Eh(e,t),t.tag=1,mi(s)?(e=!0,Wh(t)):e=!1,_d(t,n),Ak(t,s,a),xx(t,s,a,n),vx(null,t,s,!0,e,n);case 19:return Fk(e,t,n);case 22:return Ok(e,t,n)}throw Error(ct(156,t.tag))};function n2(e,t){return Iz(e,t)}function E_(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zi(e,t,n,s){return new E_(e,t,n,s)}function Ab(e){return e=e.prototype,!(!e||!e.isReactComponent)}function I_(e){if(typeof e=="function")return Ab(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Zx)return 11;if(e===Qx)return 14}return 2}function xl(e,t){var n=e.alternate;return n===null?(n=Zi(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function $h(e,t,n,s,a,c){var d=2;if(s=e,typeof e=="function")Ab(e)&&(d=1);else if(typeof e=="string")d=5;else e:switch(e){case dd:return sc(n.children,a,c,t);case Xx:d=8,a|=8;break;case Fg:return e=Zi(12,n,t,a|2),e.elementType=Fg,e.lanes=c,e;case Bg:return e=Zi(13,n,t,a),e.elementType=Bg,e.lanes=c,e;case Hg:return e=Zi(19,n,t,a),e.elementType=Hg,e.lanes=c,e;case fz:return S0(n,a,c,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case uz:d=10;break e;case pz:d=9;break e;case Zx:d=11;break e;case Qx:d=14;break e;case sl:d=16,s=null;break e}throw Error(ct(130,e==null?e:typeof e,""))}return t=Zi(d,n,t,a),t.elementType=e,t.type=s,t.lanes=c,t}function sc(e,t,n,s){return e=Zi(7,e,s,t),e.lanes=n,e}function S0(e,t,n,s){return e=Zi(22,e,s,t),e.elementType=fz,e.lanes=n,e.stateNode={isHidden:!1},e}function pg(e,t,n){return e=Zi(6,e,null,t),e.lanes=n,e}function fg(e,t,n){return t=Zi(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function P_(e,t,n,s,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Jm(0),this.expirationTimes=Jm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jm(0),this.identifierPrefix=s,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Tb(e,t,n,s,a,c,d,h,g){return e=new P_(e,t,n,h,g),t===1?(t=1,c===!0&&(t|=8)):t=0,c=Zi(3,null,null,t),e.current=c,c.stateNode=e,c.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},xb(c),e}function $_(e,t,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:cd,key:s==null?null:""+s,children:e,containerInfo:t,implementation:n}}function s2(e){if(!e)return yl;e=e._reactInternals;e:{if(hc(e)!==e||e.tag!==1)throw Error(ct(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(mi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(ct(171))}if(e.tag===1){var n=e.type;if(mi(n))return sk(e,n,t)}return t}function i2(e,t,n,s,a,c,d,h,g){return e=Tb(n,s,!0,e,a,c,d,h,g),e.context=s2(null),n=e.current,s=Zs(),a=gl(n),c=ya(s,a),c.callback=t??null,hl(n,c,a),e.current.lanes=a,Lp(e,a,s),gi(e,s),e}function _0(e,t,n,s){var a=t.current,c=Zs(),d=gl(a);return n=s2(n),t.context===null?t.context=n:t.pendingContext=n,t=ya(c,d),t.payload={element:e},s=s===void 0?null:s,s!==null&&(t.callback=s),e=hl(a,t,d),e!==null&&(ko(e,a,d,c),Sh(e,a,d)),d}function s0(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function B1(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Mb(e,t){B1(e,t),(e=e.alternate)&&B1(e,t)}function A_(){return null}var o2=typeof reportError=="function"?reportError:function(e){console.error(e)};function Rb(e){this._internalRoot=e}C0.prototype.render=Rb.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(ct(409));_0(e,t,null,null)};C0.prototype.unmount=Rb.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;dc(function(){_0(null,e,null,null)}),t[wa]=null}};function C0(e){this._internalRoot=e}C0.prototype.unstable_scheduleHydration=function(e){if(e){var t=Oz();e={blockedOn:null,target:e,priority:t};for(var n=0;n<ol.length&&t!==0&&t<ol[n].priority;n++);ol.splice(n,0,e),n===0&&Dz(e)}};function Ob(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function E0(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function H1(){}function T_(e,t,n,s,a){if(a){if(typeof s=="function"){var c=s;s=function(){var x=s0(d);c.call(x)}}var d=i2(t,s,e,0,null,!1,!1,"",H1);return e._reactRootContainer=d,e[wa]=d.current,Sp(e.nodeType===8?e.parentNode:e),dc(),d}for(;a=e.lastChild;)e.removeChild(a);if(typeof s=="function"){var h=s;s=function(){var x=s0(g);h.call(x)}}var g=Tb(e,0,!1,null,null,!1,!1,"",H1);return e._reactRootContainer=g,e[wa]=g.current,Sp(e.nodeType===8?e.parentNode:e),dc(function(){_0(t,g,n,s)}),g}function I0(e,t,n,s,a){var c=n._reactRootContainer;if(c){var d=c;if(typeof a=="function"){var h=a;a=function(){var g=s0(d);h.call(g)}}_0(t,d,e,a)}else d=T_(n,t,e,a,s);return s0(d)}Mz=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Zu(t.pendingLanes);n!==0&&(rb(t,n|1),gi(t,ts()),!(Wr&6)&&(Md=ts()+500,kl()))}break;case 13:dc(function(){var s=za(e,1);if(s!==null){var a=Zs();ko(s,e,1,a)}}),Mb(e,1)}};nb=function(e){if(e.tag===13){var t=za(e,134217728);if(t!==null){var n=Zs();ko(t,e,134217728,n)}Mb(e,134217728)}};Rz=function(e){if(e.tag===13){var t=gl(e),n=za(e,t);if(n!==null){var s=Zs();ko(n,e,t,s)}Mb(e,t)}};Oz=function(){return dn};Lz=function(e,t){var n=dn;try{return dn=e,t()}finally{dn=n}};Qg=function(e,t,n){switch(t){case"input":if(Kg(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var a=v0(s);if(!a)throw Error(ct(90));mz(s),Kg(s,a)}}}break;case"textarea":xz(e,n);break;case"select":t=n.value,t!=null&&kd(e,!!n.multiple,t,!1)}};jz=Ib;Nz=dc;var M_={usingClientEntryPoint:!1,Events:[Up,hd,v0,zz,kz,Ib]},Ru={findFiberByHostInstance:ec,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},R_={bundleType:Ru.bundleType,version:Ru.version,rendererPackageName:Ru.rendererPackageName,rendererConfig:Ru.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ja.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Cz(e),e===null?null:e.stateNode},findFiberByHostInstance:Ru.findFiberByHostInstance||A_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var rh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rh.isDisabled&&rh.supportsFiber)try{g0=rh.inject(R_),Vo=rh}catch{}}Ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M_;Ti.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ob(t))throw Error(ct(200));return $_(e,t,null,n)};Ti.createRoot=function(e,t){if(!Ob(e))throw Error(ct(299));var n=!1,s="",a=o2;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Tb(e,1,!1,null,null,n,!1,s,a),e[wa]=t.current,Sp(e.nodeType===8?e.parentNode:e),new Rb(t)};Ti.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(ct(188)):(e=Object.keys(e).join(","),Error(ct(268,e)));return e=Cz(t),e=e===null?null:e.stateNode,e};Ti.flushSync=function(e){return dc(e)};Ti.hydrate=function(e,t,n){if(!E0(t))throw Error(ct(200));return I0(null,e,t,!0,n)};Ti.hydrateRoot=function(e,t,n){if(!Ob(e))throw Error(ct(405));var s=n!=null&&n.hydratedSources||null,a=!1,c="",d=o2;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),t=i2(t,null,e,1,n??null,a,!1,c,d),e[wa]=t.current,Sp(e),s)for(e=0;e<s.length;e++)n=s[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new C0(t)};Ti.render=function(e,t,n){if(!E0(t))throw Error(ct(200));return I0(null,e,t,!1,n)};Ti.unmountComponentAtNode=function(e){if(!E0(e))throw Error(ct(40));return e._reactRootContainer?(dc(function(){I0(null,null,e,!1,function(){e._reactRootContainer=null,e[wa]=null})}),!0):!1};Ti.unstable_batchedUpdates=Ib;Ti.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!E0(n))throw Error(ct(200));if(e==null||e._reactInternals===void 0)throw Error(ct(38));return I0(e,t,n,!1,s)};Ti.version="18.3.1-next-f1338f8080-20240426";function a2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a2)}catch(e){console.error(e)}}a2(),az.exports=Ti;var i0=az.exports,V1=i0;Dg.createRoot=V1.createRoot,Dg.hydrateRoot=V1.hydrateRoot;function Lb(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}let mc=Lb();function l2(e){mc=e}const c2=/[&<>"']/,O_=new RegExp(c2.source,"g"),d2=/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,L_=new RegExp(d2.source,"g"),D_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},W1=e=>D_[e];function Ii(e,t){if(t){if(c2.test(e))return e.replace(O_,W1)}else if(d2.test(e))return e.replace(L_,W1);return e}const U_=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig;function F_(e){return e.replace(U_,(t,n)=>(n=n.toLowerCase(),n==="colon"?":":n.charAt(0)==="#"?n.charAt(1)==="x"?String.fromCharCode(parseInt(n.substring(2),16)):String.fromCharCode(+n.substring(1)):""))}const B_=/(^|[^\[])\^/g;function hn(e,t){let n=typeof e=="string"?e:e.source;t=t||"";const s={replace:(a,c)=>{let d=typeof c=="string"?c:c.source;return d=d.replace(B_,"$1"),n=n.replace(a,d),s},getRegex:()=>new RegExp(n,t)};return s}function K1(e){try{e=encodeURI(e).replace(/%25/g,"%")}catch{return null}return e}const pp={exec:()=>null};function J1(e,t){const n=e.replace(/\|/g,(c,d,h)=>{let g=!1,x=d;for(;--x>=0&&h[x]==="\\";)g=!g;return g?"|":" |"}),s=n.split(/ \|/);let a=0;if(s[0].trim()||s.shift(),s.length>0&&!s[s.length-1].trim()&&s.pop(),t)if(s.length>t)s.splice(t);else for(;s.length<t;)s.push("");for(;a<s.length;a++)s[a]=s[a].trim().replace(/\\\|/g,"|");return s}function nh(e,t,n){const s=e.length;if(s===0)return"";let a=0;for(;a<s&&e.charAt(s-a-1)===t;)a++;return e.slice(0,s-a)}function H_(e,t){if(e.indexOf(t[1])===-1)return-1;let n=0;for(let s=0;s<e.length;s++)if(e[s]==="\\")s++;else if(e[s]===t[0])n++;else if(e[s]===t[1]&&(n--,n<0))return s;return-1}function q1(e,t,n,s){const a=t.href,c=t.title?Ii(t.title):null,d=e[1].replace(/\\([\[\]])/g,"$1");if(e[0].charAt(0)!=="!"){s.state.inLink=!0;const h={type:"link",raw:n,href:a,title:c,text:d,tokens:s.inlineTokens(d)};return s.state.inLink=!1,h}return{type:"image",raw:n,href:a,title:c,text:Ii(d)}}function V_(e,t){const n=e.match(/^(\s+)(?:```)/);if(n===null)return t;const s=n[1];return t.split(`
`).map(a=>{const c=a.match(/^\s+/);if(c===null)return a;const[d]=c;return d.length>=s.length?a.slice(s.length):a}).join(`
`)}class o0{constructor(t){Nn(this,"options");Nn(this,"rules");Nn(this,"lexer");this.options=t||mc}space(t){const n=this.rules.block.newline.exec(t);if(n&&n[0].length>0)return{type:"space",raw:n[0]}}code(t){const n=this.rules.block.code.exec(t);if(n){const s=n[0].replace(/^ {1,4}/gm,"");return{type:"code",raw:n[0],codeBlockStyle:"indented",text:this.options.pedantic?s:nh(s,`
`)}}}fences(t){const n=this.rules.block.fences.exec(t);if(n){const s=n[0],a=V_(s,n[3]||"");return{type:"code",raw:s,lang:n[2]?n[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):n[2],text:a}}}heading(t){const n=this.rules.block.heading.exec(t);if(n){let s=n[2].trim();if(/#$/.test(s)){const a=nh(s,"#");(this.options.pedantic||!a||/ $/.test(a))&&(s=a.trim())}return{type:"heading",raw:n[0],depth:n[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(t){const n=this.rules.block.hr.exec(t);if(n)return{type:"hr",raw:n[0]}}blockquote(t){const n=this.rules.block.blockquote.exec(t);if(n){let s=n[0].replace(/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,`
    $1`);s=nh(s.replace(/^ *>[ \t]?/gm,""),`
`);const a=this.lexer.state.top;this.lexer.state.top=!0;const c=this.lexer.blockTokens(s);return this.lexer.state.top=a,{type:"blockquote",raw:n[0],tokens:c,text:s}}}list(t){let n=this.rules.block.list.exec(t);if(n){let s=n[1].trim();const a=s.length>1,c={type:"list",raw:"",ordered:a,start:a?+s.slice(0,-1):"",loose:!1,items:[]};s=a?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=a?s:"[*+-]");const d=new RegExp(`^( {0,3}${s})((?:[	 ][^\\n]*)?(?:\\n|$))`);let h="",g="",x=!1;for(;t;){let N=!1;if(!(n=d.exec(t))||this.rules.block.hr.test(t))break;h=n[0],t=t.substring(h.length);let C=n[2].split(`
`,1)[0].replace(/^\t+/,S=>" ".repeat(3*S.length)),A=t.split(`
`,1)[0],_=0;this.options.pedantic?(_=2,g=C.trimStart()):(_=n[2].search(/[^ ]/),_=_>4?1:_,g=C.slice(_),_+=n[1].length);let R=!1;if(!C&&/^ *$/.test(A)&&(h+=A+`
`,t=t.substring(A.length+1),N=!0),!N){const S=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),P=new RegExp(`^ {0,${Math.min(3,_-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),O=new RegExp(`^ {0,${Math.min(3,_-1)}}(?:\`\`\`|~~~)`),K=new RegExp(`^ {0,${Math.min(3,_-1)}}#`);for(;t;){const Q=t.split(`
`,1)[0];if(A=Q,this.options.pedantic&&(A=A.replace(/^ {1,4}(?=( {4})*[^ ])/g,"  ")),O.test(A)||K.test(A)||S.test(A)||P.test(t))break;if(A.search(/[^ ]/)>=_||!A.trim())g+=`
`+A.slice(_);else{if(R||C.search(/[^ ]/)>=4||O.test(C)||K.test(C)||P.test(C))break;g+=`
`+A}!R&&!A.trim()&&(R=!0),h+=Q+`
`,t=t.substring(Q.length+1),C=A.slice(_)}}c.loose||(x?c.loose=!0:/\n *\n *$/.test(h)&&(x=!0));let $=null,L;this.options.gfm&&($=/^\[[ xX]\] /.exec(g),$&&(L=$[0]!=="[ ] ",g=g.replace(/^\[[ xX]\] +/,""))),c.items.push({type:"list_item",raw:h,task:!!$,checked:L,loose:!1,text:g,tokens:[]}),c.raw+=h}c.items[c.items.length-1].raw=h.trimEnd(),c.items[c.items.length-1].text=g.trimEnd(),c.raw=c.raw.trimEnd();for(let N=0;N<c.items.length;N++)if(this.lexer.state.top=!1,c.items[N].tokens=this.lexer.blockTokens(c.items[N].text,[]),!c.loose){const C=c.items[N].tokens.filter(_=>_.type==="space"),A=C.length>0&&C.some(_=>/\n.*\n/.test(_.raw));c.loose=A}if(c.loose)for(let N=0;N<c.items.length;N++)c.items[N].loose=!0;return c}}html(t){const n=this.rules.block.html.exec(t);if(n)return{type:"html",block:!0,raw:n[0],pre:n[1]==="pre"||n[1]==="script"||n[1]==="style",text:n[0]}}def(t){const n=this.rules.block.def.exec(t);if(n){const s=n[1].toLowerCase().replace(/\s+/g," "),a=n[2]?n[2].replace(/^<(.*)>$/,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",c=n[3]?n[3].substring(1,n[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):n[3];return{type:"def",tag:s,raw:n[0],href:a,title:c}}}table(t){const n=this.rules.block.table.exec(t);if(!n||!/[:|]/.test(n[2]))return;const s=J1(n[1]),a=n[2].replace(/^\||\| *$/g,"").split("|"),c=n[3]&&n[3].trim()?n[3].replace(/\n[ \t]*$/,"").split(`
`):[],d={type:"table",raw:n[0],header:[],align:[],rows:[]};if(s.length===a.length){for(const h of a)/^ *-+: *$/.test(h)?d.align.push("right"):/^ *:-+: *$/.test(h)?d.align.push("center"):/^ *:-+ *$/.test(h)?d.align.push("left"):d.align.push(null);for(const h of s)d.header.push({text:h,tokens:this.lexer.inline(h)});for(const h of c)d.rows.push(J1(h,d.header.length).map(g=>({text:g,tokens:this.lexer.inline(g)})));return d}}lheading(t){const n=this.rules.block.lheading.exec(t);if(n)return{type:"heading",raw:n[0],depth:n[2].charAt(0)==="="?1:2,text:n[1],tokens:this.lexer.inline(n[1])}}paragraph(t){const n=this.rules.block.paragraph.exec(t);if(n){const s=n[1].charAt(n[1].length-1)===`
`?n[1].slice(0,-1):n[1];return{type:"paragraph",raw:n[0],text:s,tokens:this.lexer.inline(s)}}}text(t){const n=this.rules.block.text.exec(t);if(n)return{type:"text",raw:n[0],text:n[0],tokens:this.lexer.inline(n[0])}}escape(t){const n=this.rules.inline.escape.exec(t);if(n)return{type:"escape",raw:n[0],text:Ii(n[1])}}tag(t){const n=this.rules.inline.tag.exec(t);if(n)return!this.lexer.state.inLink&&/^<a /i.test(n[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&/^<\/a>/i.test(n[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&/^<(pre|code|kbd|script)(\s|>)/i.test(n[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(n[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:n[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:n[0]}}link(t){const n=this.rules.inline.link.exec(t);if(n){const s=n[2].trim();if(!this.options.pedantic&&/^</.test(s)){if(!/>$/.test(s))return;const d=nh(s.slice(0,-1),"\\");if((s.length-d.length)%2===0)return}else{const d=H_(n[2],"()");if(d>-1){const g=(n[0].indexOf("!")===0?5:4)+n[1].length+d;n[2]=n[2].substring(0,d),n[0]=n[0].substring(0,g).trim(),n[3]=""}}let a=n[2],c="";if(this.options.pedantic){const d=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(a);d&&(a=d[1],c=d[3])}else c=n[3]?n[3].slice(1,-1):"";return a=a.trim(),/^</.test(a)&&(this.options.pedantic&&!/>$/.test(s)?a=a.slice(1):a=a.slice(1,-1)),q1(n,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:c&&c.replace(this.rules.inline.anyPunctuation,"$1")},n[0],this.lexer)}}reflink(t,n){let s;if((s=this.rules.inline.reflink.exec(t))||(s=this.rules.inline.nolink.exec(t))){const a=(s[2]||s[1]).replace(/\s+/g," "),c=n[a.toLowerCase()];if(!c){const d=s[0].charAt(0);return{type:"text",raw:d,text:d}}return q1(s,c,s[0],this.lexer)}}emStrong(t,n,s=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!a||a[3]&&s.match(/[\p{L}\p{N}]/u))return;if(!(a[1]||a[2]||"")||!s||this.rules.inline.punctuation.exec(s)){const d=[...a[0]].length-1;let h,g,x=d,N=0;const C=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(C.lastIndex=0,n=n.slice(-1*t.length+d);(a=C.exec(n))!=null;){if(h=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!h)continue;if(g=[...h].length,a[3]||a[4]){x+=g;continue}else if((a[5]||a[6])&&d%3&&!((d+g)%3)){N+=g;continue}if(x-=g,x>0)continue;g=Math.min(g,g+x+N);const A=[...a[0]][0].length,_=t.slice(0,d+a.index+A+g);if(Math.min(d,g)%2){const $=_.slice(1,-1);return{type:"em",raw:_,text:$,tokens:this.lexer.inlineTokens($)}}const R=_.slice(2,-2);return{type:"strong",raw:_,text:R,tokens:this.lexer.inlineTokens(R)}}}}codespan(t){const n=this.rules.inline.code.exec(t);if(n){let s=n[2].replace(/\n/g," ");const a=/[^ ]/.test(s),c=/^ /.test(s)&&/ $/.test(s);return a&&c&&(s=s.substring(1,s.length-1)),s=Ii(s,!0),{type:"codespan",raw:n[0],text:s}}}br(t){const n=this.rules.inline.br.exec(t);if(n)return{type:"br",raw:n[0]}}del(t){const n=this.rules.inline.del.exec(t);if(n)return{type:"del",raw:n[0],text:n[2],tokens:this.lexer.inlineTokens(n[2])}}autolink(t){const n=this.rules.inline.autolink.exec(t);if(n){let s,a;return n[2]==="@"?(s=Ii(n[1]),a="mailto:"+s):(s=Ii(n[1]),a=s),{type:"link",raw:n[0],text:s,href:a,tokens:[{type:"text",raw:s,text:s}]}}}url(t){var s;let n;if(n=this.rules.inline.url.exec(t)){let a,c;if(n[2]==="@")a=Ii(n[0]),c="mailto:"+a;else{let d;do d=n[0],n[0]=((s=this.rules.inline._backpedal.exec(n[0]))==null?void 0:s[0])??"";while(d!==n[0]);a=Ii(n[0]),n[1]==="www."?c="http://"+n[0]:c=n[0]}return{type:"link",raw:n[0],text:a,href:c,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){const n=this.rules.inline.text.exec(t);if(n){let s;return this.lexer.state.inRawBlock?s=n[0]:s=Ii(n[0]),{type:"text",raw:n[0],text:s}}}}const W_=/^(?: *(?:\n|$))+/,K_=/^( {4}[^\n]+(?:\n(?: *(?:\n|$))*)?)+/,J_=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Bp=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,q_=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,u2=/(?:[*+-]|\d{1,9}[.)])/,p2=hn(/^(?!bull |blockCode|fences|blockquote|heading|html)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html))+?)\n {0,3}(=+|-+) *(?:\n+|$)/).replace(/bull/g,u2).replace(/blockCode/g,/ {4}/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).getRegex(),Db=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,G_=/^[^\n]+/,Ub=/(?!\s*\])(?:\\.|[^\[\]\\])+/,Y_=hn(/^ {0,3}\[(label)\]: *(?:\n *)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n *)?| *\n *)(title))? *(?:\n+|$)/).replace("label",Ub).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),X_=hn(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,u2).getRegex(),P0="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Fb=/\x3C!--(?:-?>|[\s\S]*?(?:-->|$))/,Z_=hn("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n *)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n *)+\\n|$))","i").replace("comment",Fb).replace("tag",P0).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),f2=hn(Db).replace("hr",Bp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",P0).getRegex(),Q_=hn(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",f2).getRegex(),Bb={blockquote:Q_,code:K_,def:Y_,fences:J_,heading:q_,hr:Bp,html:Z_,lheading:p2,list:X_,newline:W_,paragraph:f2,table:pp,text:G_},G1=hn("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Bp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",P0).getRegex(),eC={...Bb,table:G1,paragraph:hn(Db).replace("hr",Bp).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",G1).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",P0).getRegex()},tC={...Bb,html:hn(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Fb).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:pp,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:hn(Db).replace("hr",Bp).replace("heading",` *#{1,6} *[^
]`).replace("lheading",p2).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},h2=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,rC=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,m2=/^( {2,}|\\)\n(?!\s*$)/,nC=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Hp="\\p{P}\\p{S}",sC=hn(/^((?![*_])[\spunctuation])/,"u").replace(/punctuation/g,Hp).getRegex(),iC=/\[[^[\]]*?\]\([^\(\)]*?\)|`[^`]*?`|<[^<>]*?>/g,oC=hn(/^(?:\*+(?:((?!\*)[punct])|[^\s*]))|^_+(?:((?!_)[punct])|([^\s_]))/,"u").replace(/punct/g,Hp).getRegex(),aC=hn("^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)[punct](\\*+)(?=[\\s]|$)|[^punct\\s](\\*+)(?!\\*)(?=[punct\\s]|$)|(?!\\*)[punct\\s](\\*+)(?=[^punct\\s])|[\\s](\\*+)(?!\\*)(?=[punct])|(?!\\*)[punct](\\*+)(?!\\*)(?=[punct])|[^punct\\s](\\*+)(?=[^punct\\s])","gu").replace(/punct/g,Hp).getRegex(),lC=hn("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)[punct](_+)(?=[\\s]|$)|[^punct\\s](_+)(?!_)(?=[punct\\s]|$)|(?!_)[punct\\s](_+)(?=[^punct\\s])|[\\s](_+)(?!_)(?=[punct])|(?!_)[punct](_+)(?!_)(?=[punct])","gu").replace(/punct/g,Hp).getRegex(),cC=hn(/\\([punct])/,"gu").replace(/punct/g,Hp).getRegex(),dC=hn(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),uC=hn(Fb).replace("(?:-->|$)","-->").getRegex(),pC=hn("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",uC).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),a0=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,fC=hn(/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/).replace("label",a0).replace("href",/<(?:\\.|[^\n<>\\])+>|[^\s\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),g2=hn(/^!?\[(label)\]\[(ref)\]/).replace("label",a0).replace("ref",Ub).getRegex(),x2=hn(/^!?\[(ref)\](?:\[\])?/).replace("ref",Ub).getRegex(),hC=hn("reflink|nolink(?!\\()","g").replace("reflink",g2).replace("nolink",x2).getRegex(),Hb={_backpedal:pp,anyPunctuation:cC,autolink:dC,blockSkip:iC,br:m2,code:rC,del:pp,emStrongLDelim:oC,emStrongRDelimAst:aC,emStrongRDelimUnd:lC,escape:h2,link:fC,nolink:x2,punctuation:sC,reflink:g2,reflinkSearch:hC,tag:pC,text:nC,url:pp},mC={...Hb,link:hn(/^!?\[(label)\]\((.*?)\)/).replace("label",a0).getRegex(),reflink:hn(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",a0).getRegex()},$x={...Hb,escape:hn(h2).replace("])","~|])").getRegex(),url:hn(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])([\s\S]*?[^\s~])\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},gC={...$x,br:hn(m2).replace("{2,}","*").getRegex(),text:hn($x.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},sh={normal:Bb,gfm:eC,pedantic:tC},Ou={normal:Hb,gfm:$x,breaks:gC,pedantic:mC};class Fo{constructor(t){Nn(this,"tokens");Nn(this,"options");Nn(this,"state");Nn(this,"tokenizer");Nn(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||mc,this.options.tokenizer=this.options.tokenizer||new o0,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={block:sh.normal,inline:Ou.normal};this.options.pedantic?(n.block=sh.pedantic,n.inline=Ou.pedantic):this.options.gfm&&(n.block=sh.gfm,this.options.breaks?n.inline=Ou.breaks:n.inline=Ou.gfm),this.tokenizer.rules=n}static get rules(){return{block:sh,inline:Ou}}static lex(t,n){return new Fo(n).lex(t)}static lexInline(t,n){return new Fo(n).inlineTokens(t)}lex(t){t=t.replace(/\r\n|\r/g,`
`),this.blockTokens(t,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){const s=this.inlineQueue[n];this.inlineTokens(s.src,s.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,n=[]){this.options.pedantic?t=t.replace(/\t/g,"    ").replace(/^ +$/gm,""):t=t.replace(/^( *)(\t+)/gm,(h,g,x)=>g+"    ".repeat(x.length));let s,a,c,d;for(;t;)if(!(this.options.extensions&&this.options.extensions.block&&this.options.extensions.block.some(h=>(s=h.call({lexer:this},t,n))?(t=t.substring(s.raw.length),n.push(s),!0):!1))){if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length),s.raw.length===1&&n.length>0?n[n.length-1].raw+=`
`:n.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length),a=n[n.length-1],a&&(a.type==="paragraph"||a.type==="text")?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue[this.inlineQueue.length-1].src=a.text):n.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length),a=n[n.length-1],a&&(a.type==="paragraph"||a.type==="text")?(a.raw+=`
`+s.raw,a.text+=`
`+s.raw,this.inlineQueue[this.inlineQueue.length-1].src=a.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title});continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),n.push(s);continue}if(c=t,this.options.extensions&&this.options.extensions.startBlock){let h=1/0;const g=t.slice(1);let x;this.options.extensions.startBlock.forEach(N=>{x=N.call({lexer:this},g),typeof x=="number"&&x>=0&&(h=Math.min(h,x))}),h<1/0&&h>=0&&(c=t.substring(0,h+1))}if(this.state.top&&(s=this.tokenizer.paragraph(c))){a=n[n.length-1],d&&a.type==="paragraph"?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):n.push(s),d=c.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length),a=n[n.length-1],a&&a.type==="text"?(a.raw+=`
`+s.raw,a.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue[this.inlineQueue.length-1].src=a.text):n.push(s);continue}if(t){const h="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return this.state.top=!0,n}inline(t,n=[]){return this.inlineQueue.push({src:t,tokens:n}),n}inlineTokens(t,n=[]){let s,a,c,d=t,h,g,x;if(this.tokens.links){const N=Object.keys(this.tokens.links);if(N.length>0)for(;(h=this.tokenizer.rules.inline.reflinkSearch.exec(d))!=null;)N.includes(h[0].slice(h[0].lastIndexOf("[")+1,-1))&&(d=d.slice(0,h.index)+"["+"a".repeat(h[0].length-2)+"]"+d.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(h=this.tokenizer.rules.inline.blockSkip.exec(d))!=null;)d=d.slice(0,h.index)+"["+"a".repeat(h[0].length-2)+"]"+d.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;(h=this.tokenizer.rules.inline.anyPunctuation.exec(d))!=null;)d=d.slice(0,h.index)+"++"+d.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;t;)if(g||(x=""),g=!1,!(this.options.extensions&&this.options.extensions.inline&&this.options.extensions.inline.some(N=>(s=N.call({lexer:this},t,n))?(t=t.substring(s.raw.length),n.push(s),!0):!1))){if(s=this.tokenizer.escape(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.tag(t)){t=t.substring(s.raw.length),a=n[n.length-1],a&&s.type==="text"&&a.type==="text"?(a.raw+=s.raw,a.text+=s.text):n.push(s);continue}if(s=this.tokenizer.link(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(s.raw.length),a=n[n.length-1],a&&s.type==="text"&&a.type==="text"?(a.raw+=s.raw,a.text+=s.text):n.push(s);continue}if(s=this.tokenizer.emStrong(t,d,x)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.codespan(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.br(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.del(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.autolink(t)){t=t.substring(s.raw.length),n.push(s);continue}if(!this.state.inLink&&(s=this.tokenizer.url(t))){t=t.substring(s.raw.length),n.push(s);continue}if(c=t,this.options.extensions&&this.options.extensions.startInline){let N=1/0;const C=t.slice(1);let A;this.options.extensions.startInline.forEach(_=>{A=_.call({lexer:this},C),typeof A=="number"&&A>=0&&(N=Math.min(N,A))}),N<1/0&&N>=0&&(c=t.substring(0,N+1))}if(s=this.tokenizer.inlineText(c)){t=t.substring(s.raw.length),s.raw.slice(-1)!=="_"&&(x=s.raw.slice(-1)),g=!0,a=n[n.length-1],a&&a.type==="text"?(a.raw+=s.raw,a.text+=s.text):n.push(s);continue}if(t){const N="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(N);break}else throw new Error(N)}}return n}}class l0{constructor(t){Nn(this,"options");this.options=t||mc}code(t,n,s){var c;const a=(c=(n||"").match(/^\S*/))==null?void 0:c[0];return t=t.replace(/\n$/,"")+`
`,a?'<pre><code class="language-'+Ii(a)+'">'+(s?t:Ii(t,!0))+`</code></pre>
`:"<pre><code>"+(s?t:Ii(t,!0))+`</code></pre>
`}blockquote(t){return`<blockquote>
${t}</blockquote>
`}html(t,n){return t}heading(t,n,s){return`<h${n}>${t}</h${n}>
`}hr(){return`<hr>
`}list(t,n,s){const a=n?"ol":"ul",c=n&&s!==1?' start="'+s+'"':"";return"<"+a+c+`>
`+t+"</"+a+`>
`}listitem(t,n,s){return`<li>${t}</li>
`}checkbox(t){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph(t){return`<p>${t}</p>
`}table(t,n){return n&&(n=`<tbody>${n}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+n+`</table>
`}tablerow(t){return`<tr>
${t}</tr>
`}tablecell(t,n){const s=n.header?"th":"td";return(n.align?`<${s} align="${n.align}">`:`<${s}>`)+t+`</${s}>
`}strong(t){return`<strong>${t}</strong>`}em(t){return`<em>${t}</em>`}codespan(t){return`<code>${t}</code>`}br(){return"<br>"}del(t){return`<del>${t}</del>`}link(t,n,s){const a=K1(t);if(a===null)return s;t=a;let c='<a href="'+t+'"';return n&&(c+=' title="'+n+'"'),c+=">"+s+"</a>",c}image(t,n,s){const a=K1(t);if(a===null)return s;t=a;let c=`<img src="${t}" alt="${s}"`;return n&&(c+=` title="${n}"`),c+=">",c}text(t){return t}}class Vb{strong(t){return t}em(t){return t}codespan(t){return t}del(t){return t}html(t){return t}text(t){return t}link(t,n,s){return""+s}image(t,n,s){return""+s}br(){return""}}class Bo{constructor(t){Nn(this,"options");Nn(this,"renderer");Nn(this,"textRenderer");this.options=t||mc,this.options.renderer=this.options.renderer||new l0,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new Vb}static parse(t,n){return new Bo(n).parse(t)}static parseInline(t,n){return new Bo(n).parseInline(t)}parse(t,n=!0){let s="";for(let a=0;a<t.length;a++){const c=t[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[c.type]){const d=c,h=this.options.extensions.renderers[d.type].call({parser:this},d);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type)){s+=h||"";continue}}switch(c.type){case"space":continue;case"hr":{s+=this.renderer.hr();continue}case"heading":{const d=c;s+=this.renderer.heading(this.parseInline(d.tokens),d.depth,F_(this.parseInline(d.tokens,this.textRenderer)));continue}case"code":{const d=c;s+=this.renderer.code(d.text,d.lang,!!d.escaped);continue}case"table":{const d=c;let h="",g="";for(let N=0;N<d.header.length;N++)g+=this.renderer.tablecell(this.parseInline(d.header[N].tokens),{header:!0,align:d.align[N]});h+=this.renderer.tablerow(g);let x="";for(let N=0;N<d.rows.length;N++){const C=d.rows[N];g="";for(let A=0;A<C.length;A++)g+=this.renderer.tablecell(this.parseInline(C[A].tokens),{header:!1,align:d.align[A]});x+=this.renderer.tablerow(g)}s+=this.renderer.table(h,x);continue}case"blockquote":{const d=c,h=this.parse(d.tokens);s+=this.renderer.blockquote(h);continue}case"list":{const d=c,h=d.ordered,g=d.start,x=d.loose;let N="";for(let C=0;C<d.items.length;C++){const A=d.items[C],_=A.checked,R=A.task;let $="";if(A.task){const L=this.renderer.checkbox(!!_);x?A.tokens.length>0&&A.tokens[0].type==="paragraph"?(A.tokens[0].text=L+" "+A.tokens[0].text,A.tokens[0].tokens&&A.tokens[0].tokens.length>0&&A.tokens[0].tokens[0].type==="text"&&(A.tokens[0].tokens[0].text=L+" "+A.tokens[0].tokens[0].text)):A.tokens.unshift({type:"text",text:L+" "}):$+=L+" "}$+=this.parse(A.tokens,x),N+=this.renderer.listitem($,R,!!_)}s+=this.renderer.list(N,h,g);continue}case"html":{const d=c;s+=this.renderer.html(d.text,d.block);continue}case"paragraph":{const d=c;s+=this.renderer.paragraph(this.parseInline(d.tokens));continue}case"text":{let d=c,h=d.tokens?this.parseInline(d.tokens):d.text;for(;a+1<t.length&&t[a+1].type==="text";)d=t[++a],h+=`
`+(d.tokens?this.parseInline(d.tokens):d.text);s+=n?this.renderer.paragraph(h):h;continue}default:{const d='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return s}parseInline(t,n){n=n||this.renderer;let s="";for(let a=0;a<t.length;a++){const c=t[a];if(this.options.extensions&&this.options.extensions.renderers&&this.options.extensions.renderers[c.type]){const d=this.options.extensions.renderers[c.type].call({parser:this},c);if(d!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(c.type)){s+=d||"";continue}}switch(c.type){case"escape":{const d=c;s+=n.text(d.text);break}case"html":{const d=c;s+=n.html(d.text);break}case"link":{const d=c;s+=n.link(d.href,d.title,this.parseInline(d.tokens,n));break}case"image":{const d=c;s+=n.image(d.href,d.title,d.text);break}case"strong":{const d=c;s+=n.strong(this.parseInline(d.tokens,n));break}case"em":{const d=c;s+=n.em(this.parseInline(d.tokens,n));break}case"codespan":{const d=c;s+=n.codespan(d.text);break}case"br":{s+=n.br();break}case"del":{const d=c;s+=n.del(this.parseInline(d.tokens,n));break}case"text":{const d=c;s+=n.text(d.text);break}default:{const d='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return s}}class fp{constructor(t){Nn(this,"options");this.options=t||mc}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}}Nn(fp,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"]));var pc,Ax,b2;class xC{constructor(...t){Mv(this,pc);Nn(this,"defaults",Lb());Nn(this,"options",this.setOptions);Nn(this,"parse",Df(this,pc,Ax).call(this,Fo.lex,Bo.parse));Nn(this,"parseInline",Df(this,pc,Ax).call(this,Fo.lexInline,Bo.parseInline));Nn(this,"Parser",Bo);Nn(this,"Renderer",l0);Nn(this,"TextRenderer",Vb);Nn(this,"Lexer",Fo);Nn(this,"Tokenizer",o0);Nn(this,"Hooks",fp);this.use(...t)}walkTokens(t,n){var a,c;let s=[];for(const d of t)switch(s=s.concat(n.call(this,d)),d.type){case"table":{const h=d;for(const g of h.header)s=s.concat(this.walkTokens(g.tokens,n));for(const g of h.rows)for(const x of g)s=s.concat(this.walkTokens(x.tokens,n));break}case"list":{const h=d;s=s.concat(this.walkTokens(h.items,n));break}default:{const h=d;(c=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&c[h.type]?this.defaults.extensions.childTokens[h.type].forEach(g=>{const x=h[g].flat(1/0);s=s.concat(this.walkTokens(x,n))}):h.tokens&&(s=s.concat(this.walkTokens(h.tokens,n)))}}return s}use(...t){const n=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(s=>{const a={...s};if(a.async=this.defaults.async||a.async||!1,s.extensions&&(s.extensions.forEach(c=>{if(!c.name)throw new Error("extension name required");if("renderer"in c){const d=n.renderers[c.name];d?n.renderers[c.name]=function(...h){let g=c.renderer.apply(this,h);return g===!1&&(g=d.apply(this,h)),g}:n.renderers[c.name]=c.renderer}if("tokenizer"in c){if(!c.level||c.level!=="block"&&c.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const d=n[c.level];d?d.unshift(c.tokenizer):n[c.level]=[c.tokenizer],c.start&&(c.level==="block"?n.startBlock?n.startBlock.push(c.start):n.startBlock=[c.start]:c.level==="inline"&&(n.startInline?n.startInline.push(c.start):n.startInline=[c.start]))}"childTokens"in c&&c.childTokens&&(n.childTokens[c.name]=c.childTokens)}),a.extensions=n),s.renderer){const c=this.defaults.renderer||new l0(this.defaults);for(const d in s.renderer){if(!(d in c))throw new Error(`renderer '${d}' does not exist`);if(d==="options")continue;const h=d,g=s.renderer[h],x=c[h];c[h]=(...N)=>{let C=g.apply(c,N);return C===!1&&(C=x.apply(c,N)),C||""}}a.renderer=c}if(s.tokenizer){const c=this.defaults.tokenizer||new o0(this.defaults);for(const d in s.tokenizer){if(!(d in c))throw new Error(`tokenizer '${d}' does not exist`);if(["options","rules","lexer"].includes(d))continue;const h=d,g=s.tokenizer[h],x=c[h];c[h]=(...N)=>{let C=g.apply(c,N);return C===!1&&(C=x.apply(c,N)),C}}a.tokenizer=c}if(s.hooks){const c=this.defaults.hooks||new fp;for(const d in s.hooks){if(!(d in c))throw new Error(`hook '${d}' does not exist`);if(d==="options")continue;const h=d,g=s.hooks[h],x=c[h];fp.passThroughHooks.has(d)?c[h]=N=>{if(this.defaults.async)return Promise.resolve(g.call(c,N)).then(A=>x.call(c,A));const C=g.call(c,N);return x.call(c,C)}:c[h]=(...N)=>{let C=g.apply(c,N);return C===!1&&(C=x.apply(c,N)),C}}a.hooks=c}if(s.walkTokens){const c=this.defaults.walkTokens,d=s.walkTokens;a.walkTokens=function(h){let g=[];return g.push(d.call(this,h)),c&&(g=g.concat(c.call(this,h))),g}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,n){return Fo.lex(t,n??this.defaults)}parser(t,n){return Bo.parse(t,n??this.defaults)}}pc=new WeakSet,Ax=function(t,n){return(s,a)=>{const c={...a},d={...this.defaults,...c};this.defaults.async===!0&&c.async===!1&&(d.silent||console.warn("marked(): The async option was set to true by an extension. The async: false option sent to parse will be ignored."),d.async=!0);const h=Df(this,pc,b2).call(this,!!d.silent,!!d.async);if(typeof s>"u"||s===null)return h(new Error("marked(): input parameter is undefined or null"));if(typeof s!="string")return h(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(s)+", string expected"));if(d.hooks&&(d.hooks.options=d),d.async)return Promise.resolve(d.hooks?d.hooks.preprocess(s):s).then(g=>t(g,d)).then(g=>d.hooks?d.hooks.processAllTokens(g):g).then(g=>d.walkTokens?Promise.all(this.walkTokens(g,d.walkTokens)).then(()=>g):g).then(g=>n(g,d)).then(g=>d.hooks?d.hooks.postprocess(g):g).catch(h);try{d.hooks&&(s=d.hooks.preprocess(s));let g=t(s,d);d.hooks&&(g=d.hooks.processAllTokens(g)),d.walkTokens&&this.walkTokens(g,d.walkTokens);let x=n(g,d);return d.hooks&&(x=d.hooks.postprocess(x)),x}catch(g){return h(g)}}},b2=function(t,n){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const a="<p>An error occurred:</p><pre>"+Ii(s.message+"",!0)+"</pre>";return n?Promise.resolve(a):a}if(n)return Promise.reject(s);throw s}};const uc=new xC;function cn(e,t){return uc.parse(e,t)}cn.options=cn.setOptions=function(e){return uc.setOptions(e),cn.defaults=uc.defaults,l2(cn.defaults),cn};cn.getDefaults=Lb;cn.defaults=mc;cn.use=function(...e){return uc.use(...e),cn.defaults=uc.defaults,l2(cn.defaults),cn};cn.walkTokens=function(e,t){return uc.walkTokens(e,t)};cn.parseInline=uc.parseInline;cn.Parser=Bo;cn.parser=Bo.parse;cn.Renderer=l0;cn.TextRenderer=Vb;cn.Lexer=Fo;cn.lexer=Fo.lex;cn.Tokenizer=o0;cn.Hooks=fp;cn.parse=cn;cn.options;cn.setOptions;cn.use;cn.walkTokens;cn.parseInline;Bo.parse;Fo.lex;/*! @license DOMPurify 3.3.1 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.1/LICENSE */const{entries:y2,setPrototypeOf:Y1,isFrozen:bC,getPrototypeOf:yC,getOwnPropertyDescriptor:vC}=Object;let{freeze:Qs,seal:ro,create:Tx}=Object,{apply:Mx,construct:Rx}=typeof Reflect<"u"&&Reflect;Qs||(Qs=function(t){return t});ro||(ro=function(t){return t});Mx||(Mx=function(t,n){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.apply(n,a)});Rx||(Rx=function(t){for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return new t(...s)});const ih=ei(Array.prototype.forEach),wC=ei(Array.prototype.lastIndexOf),X1=ei(Array.prototype.pop),Lu=ei(Array.prototype.push),zC=ei(Array.prototype.splice),Ah=ei(String.prototype.toLowerCase),hg=ei(String.prototype.toString),mg=ei(String.prototype.match),Du=ei(String.prototype.replace),kC=ei(String.prototype.indexOf),jC=ei(String.prototype.trim),go=ei(Object.prototype.hasOwnProperty),Ys=ei(RegExp.prototype.test),Uu=NC(TypeError);function ei(e){return function(t){t instanceof RegExp&&(t.lastIndex=0);for(var n=arguments.length,s=new Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return Mx(e,t,s)}}function NC(e){return function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return Rx(e,n)}}function Mr(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ah;Y1&&Y1(e,null);let s=t.length;for(;s--;){let a=t[s];if(typeof a=="string"){const c=n(a);c!==a&&(bC(t)||(t[s]=c),a=c)}e[a]=!0}return e}function SC(e){for(let t=0;t<e.length;t++)go(e,t)||(e[t]=null);return e}function Oo(e){const t=Tx(null);for(const[n,s]of y2(e))go(e,n)&&(Array.isArray(s)?t[n]=SC(s):s&&typeof s=="object"&&s.constructor===Object?t[n]=Oo(s):t[n]=s);return t}function Fu(e,t){for(;e!==null;){const s=vC(e,t);if(s){if(s.get)return ei(s.get);if(typeof s.value=="function")return ei(s.value)}e=yC(e)}function n(){return null}return n}const Z1=Qs(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),gg=Qs(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),xg=Qs(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),_C=Qs(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),bg=Qs(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),CC=Qs(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Q1=Qs(["#text"]),ew=Qs(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),yg=Qs(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),tw=Qs(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),oh=Qs(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),EC=ro(/\{\{[\w\W]*|[\w\W]*\}\}/gm),IC=ro(/<%[\w\W]*|[\w\W]*%>/gm),PC=ro(/\$\{[\w\W]*/gm),$C=ro(/^data-[\-\w.\u00B7-\uFFFF]+$/),AC=ro(/^aria-[\-\w]+$/),v2=ro(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),TC=ro(/^(?:\w+script|data):/i),MC=ro(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),w2=ro(/^html$/i),RC=ro(/^[a-z][.\w]*(-[.\w]+)+$/i);var rw=Object.freeze({__proto__:null,ARIA_ATTR:AC,ATTR_WHITESPACE:MC,CUSTOM_ELEMENT:RC,DATA_ATTR:$C,DOCTYPE_NAME:w2,ERB_EXPR:IC,IS_ALLOWED_URI:v2,IS_SCRIPT_OR_DATA:TC,MUSTACHE_EXPR:EC,TMPLIT_EXPR:PC});const Bu={element:1,text:3,progressingInstruction:7,comment:8,document:9},OC=function(){return typeof window>"u"?null:window},LC=function(t,n){if(typeof t!="object"||typeof t.createPolicy!="function")return null;let s=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(s=n.getAttribute(a));const c="dompurify"+(s?"#"+s:"");try{return t.createPolicy(c,{createHTML(d){return d},createScriptURL(d){return d}})}catch{return console.warn("TrustedTypes policy "+c+" could not be created."),null}},nw=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function z2(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:OC();const t=nr=>z2(nr);if(t.version="3.3.1",t.removed=[],!e||!e.document||e.document.nodeType!==Bu.document||!e.Element)return t.isSupported=!1,t;let{document:n}=e;const s=n,a=s.currentScript,{DocumentFragment:c,HTMLTemplateElement:d,Node:h,Element:g,NodeFilter:x,NamedNodeMap:N=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:C,DOMParser:A,trustedTypes:_}=e,R=g.prototype,$=Fu(R,"cloneNode"),L=Fu(R,"remove"),S=Fu(R,"nextSibling"),P=Fu(R,"childNodes"),O=Fu(R,"parentNode");if(typeof d=="function"){const nr=n.createElement("template");nr.content&&nr.content.ownerDocument&&(n=nr.content.ownerDocument)}let K,Q="";const{implementation:ue,createNodeIterator:oe,createDocumentFragment:we,getElementsByTagName:he}=n,{importNode:ze}=s;let ot=nw();t.isSupported=typeof y2=="function"&&typeof O=="function"&&ue&&ue.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:re,ERB_EXPR:Se,TMPLIT_EXPR:D,DATA_ATTR:Me,ARIA_ATTR:Ut,IS_SCRIPT_OR_DATA:je,ATTR_WHITESPACE:_e,CUSTOM_ELEMENT:be}=rw;let{IS_ALLOWED_URI:Xe}=rw,de=null;const fe=Mr({},[...Z1,...gg,...xg,...bg,...Q1]);let Ge=null;const gt=Mr({},[...ew,...yg,...tw,...oh]);let We=Object.seal(Tx(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ir=null,Qr=null;const br=Object.seal(Tx(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let $r=!0,mn=!0,Kr=!1,ns=!0,St=!1,E=!0,Ce=!1,Ee=!1,ee=!1,q=!1,le=!1,Fe=!1,Oe=!0,ke=!1;const at="user-content-";let _t=!0,tt=!1,Ye={},kr=null;const Ft=Mr({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let zn=null;const Ns=Mr({},["audio","video","img","source","image","track"]);let Ss=null;const Ms=Mr({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),sn="http://www.w3.org/1998/Math/MathML",Rs="http://www.w3.org/2000/svg",_s="http://www.w3.org/1999/xhtml";let Cn=_s,Ko=!1,No=null;const Dd=Mr({},[sn,Rs,_s],hg);let Na=Mr({},["mi","mo","mn","ms","mtext"]),Ri=Mr({},["annotation-xml"]);const Jo=Mr({},["title","style","font","a","script"]);let Oi=null;const A0=["application/xhtml+xml","text/html"],T0="text/html";let Dn=null,Sa=null;const cs=n.createElement("form"),gc=function(ce){return ce instanceof RegExp||ce instanceof Function},Ud=function(){let ce=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Sa&&Sa===ce)){if((!ce||typeof ce!="object")&&(ce={}),ce=Oo(ce),Oi=A0.indexOf(ce.PARSER_MEDIA_TYPE)===-1?T0:ce.PARSER_MEDIA_TYPE,Dn=Oi==="application/xhtml+xml"?hg:Ah,de=go(ce,"ALLOWED_TAGS")?Mr({},ce.ALLOWED_TAGS,Dn):fe,Ge=go(ce,"ALLOWED_ATTR")?Mr({},ce.ALLOWED_ATTR,Dn):gt,No=go(ce,"ALLOWED_NAMESPACES")?Mr({},ce.ALLOWED_NAMESPACES,hg):Dd,Ss=go(ce,"ADD_URI_SAFE_ATTR")?Mr(Oo(Ms),ce.ADD_URI_SAFE_ATTR,Dn):Ms,zn=go(ce,"ADD_DATA_URI_TAGS")?Mr(Oo(Ns),ce.ADD_DATA_URI_TAGS,Dn):Ns,kr=go(ce,"FORBID_CONTENTS")?Mr({},ce.FORBID_CONTENTS,Dn):Ft,Ir=go(ce,"FORBID_TAGS")?Mr({},ce.FORBID_TAGS,Dn):Oo({}),Qr=go(ce,"FORBID_ATTR")?Mr({},ce.FORBID_ATTR,Dn):Oo({}),Ye=go(ce,"USE_PROFILES")?ce.USE_PROFILES:!1,$r=ce.ALLOW_ARIA_ATTR!==!1,mn=ce.ALLOW_DATA_ATTR!==!1,Kr=ce.ALLOW_UNKNOWN_PROTOCOLS||!1,ns=ce.ALLOW_SELF_CLOSE_IN_ATTR!==!1,St=ce.SAFE_FOR_TEMPLATES||!1,E=ce.SAFE_FOR_XML!==!1,Ce=ce.WHOLE_DOCUMENT||!1,q=ce.RETURN_DOM||!1,le=ce.RETURN_DOM_FRAGMENT||!1,Fe=ce.RETURN_TRUSTED_TYPE||!1,ee=ce.FORCE_BODY||!1,Oe=ce.SANITIZE_DOM!==!1,ke=ce.SANITIZE_NAMED_PROPS||!1,_t=ce.KEEP_CONTENT!==!1,tt=ce.IN_PLACE||!1,Xe=ce.ALLOWED_URI_REGEXP||v2,Cn=ce.NAMESPACE||_s,Na=ce.MATHML_TEXT_INTEGRATION_POINTS||Na,Ri=ce.HTML_INTEGRATION_POINTS||Ri,We=ce.CUSTOM_ELEMENT_HANDLING||{},ce.CUSTOM_ELEMENT_HANDLING&&gc(ce.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(We.tagNameCheck=ce.CUSTOM_ELEMENT_HANDLING.tagNameCheck),ce.CUSTOM_ELEMENT_HANDLING&&gc(ce.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(We.attributeNameCheck=ce.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),ce.CUSTOM_ELEMENT_HANDLING&&typeof ce.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(We.allowCustomizedBuiltInElements=ce.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),St&&(mn=!1),le&&(q=!0),Ye&&(de=Mr({},Q1),Ge=[],Ye.html===!0&&(Mr(de,Z1),Mr(Ge,ew)),Ye.svg===!0&&(Mr(de,gg),Mr(Ge,yg),Mr(Ge,oh)),Ye.svgFilters===!0&&(Mr(de,xg),Mr(Ge,yg),Mr(Ge,oh)),Ye.mathMl===!0&&(Mr(de,bg),Mr(Ge,tw),Mr(Ge,oh))),ce.ADD_TAGS&&(typeof ce.ADD_TAGS=="function"?br.tagCheck=ce.ADD_TAGS:(de===fe&&(de=Oo(de)),Mr(de,ce.ADD_TAGS,Dn))),ce.ADD_ATTR&&(typeof ce.ADD_ATTR=="function"?br.attributeCheck=ce.ADD_ATTR:(Ge===gt&&(Ge=Oo(Ge)),Mr(Ge,ce.ADD_ATTR,Dn))),ce.ADD_URI_SAFE_ATTR&&Mr(Ss,ce.ADD_URI_SAFE_ATTR,Dn),ce.FORBID_CONTENTS&&(kr===Ft&&(kr=Oo(kr)),Mr(kr,ce.FORBID_CONTENTS,Dn)),ce.ADD_FORBID_CONTENTS&&(kr===Ft&&(kr=Oo(kr)),Mr(kr,ce.ADD_FORBID_CONTENTS,Dn)),_t&&(de["#text"]=!0),Ce&&Mr(de,["html","head","body"]),de.table&&(Mr(de,["tbody"]),delete Ir.tbody),ce.TRUSTED_TYPES_POLICY){if(typeof ce.TRUSTED_TYPES_POLICY.createHTML!="function")throw Uu('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof ce.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Uu('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');K=ce.TRUSTED_TYPES_POLICY,Q=K.createHTML("")}else K===void 0&&(K=LC(_,a)),K!==null&&typeof Q=="string"&&(Q=K.createHTML(""));Qs&&Qs(ce),Sa=ce}},xc=Mr({},[...gg,...xg,..._C]),Fd=Mr({},[...bg,...CC]),bc=function(ce){let dt=O(ce);(!dt||!dt.tagName)&&(dt={namespaceURI:Cn,tagName:"template"});const Yt=Ah(ce.tagName),bn=Ah(dt.tagName);return No[ce.namespaceURI]?ce.namespaceURI===Rs?dt.namespaceURI===_s?Yt==="svg":dt.namespaceURI===sn?Yt==="svg"&&(bn==="annotation-xml"||Na[bn]):!!xc[Yt]:ce.namespaceURI===sn?dt.namespaceURI===_s?Yt==="math":dt.namespaceURI===Rs?Yt==="math"&&Ri[bn]:!!Fd[Yt]:ce.namespaceURI===_s?dt.namespaceURI===Rs&&!Ri[bn]||dt.namespaceURI===sn&&!Na[bn]?!1:!Fd[Yt]&&(Jo[Yt]||!xc[Yt]):!!(Oi==="application/xhtml+xml"&&No[ce.namespaceURI]):!1},ds=function(ce){Lu(t.removed,{element:ce});try{O(ce).removeChild(ce)}catch{L(ce)}},xn=function(ce,dt){try{Lu(t.removed,{attribute:dt.getAttributeNode(ce),from:dt})}catch{Lu(t.removed,{attribute:null,from:dt})}if(dt.removeAttribute(ce),ce==="is")if(q||le)try{ds(dt)}catch{}else try{dt.setAttribute(ce,"")}catch{}},Vp=function(ce){let dt=null,Yt=null;if(ee)ce="<remove></remove>"+ce;else{const yn=mg(ce,/^[\r\n\t ]+/);Yt=yn&&yn[0]}Oi==="application/xhtml+xml"&&Cn===_s&&(ce='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+ce+"</body></html>");const bn=K?K.createHTML(ce):ce;if(Cn===_s)try{dt=new A().parseFromString(bn,Oi)}catch{}if(!dt||!dt.documentElement){dt=ue.createDocument(Cn,"template",null);try{dt.documentElement.innerHTML=Ko?Q:bn}catch{}}const ms=dt.body||dt.documentElement;return ce&&Yt&&ms.insertBefore(n.createTextNode(Yt),ms.childNodes[0]||null),Cn===_s?he.call(dt,Ce?"html":"body")[0]:Ce?dt.documentElement:ms},Li=function(ce){return oe.call(ce.ownerDocument||ce,ce,x.SHOW_ELEMENT|x.SHOW_COMMENT|x.SHOW_TEXT|x.SHOW_PROCESSING_INSTRUCTION|x.SHOW_CDATA_SECTION,null)},Bd=function(ce){return ce instanceof C&&(typeof ce.nodeName!="string"||typeof ce.textContent!="string"||typeof ce.removeChild!="function"||!(ce.attributes instanceof N)||typeof ce.removeAttribute!="function"||typeof ce.setAttribute!="function"||typeof ce.namespaceURI!="string"||typeof ce.insertBefore!="function"||typeof ce.hasChildNodes!="function")},yr=function(ce){return typeof h=="function"&&ce instanceof h};function no(nr,ce,dt){ih(nr,Yt=>{Yt.call(t,ce,dt,Sa)})}const Hs=function(ce){let dt=null;if(no(ot.beforeSanitizeElements,ce,null),Bd(ce))return ds(ce),!0;const Yt=Dn(ce.nodeName);if(no(ot.uponSanitizeElement,ce,{tagName:Yt,allowedTags:de}),E&&ce.hasChildNodes()&&!yr(ce.firstElementChild)&&Ys(/<[/\w!]/g,ce.innerHTML)&&Ys(/<[/\w!]/g,ce.textContent)||ce.nodeType===Bu.progressingInstruction||E&&ce.nodeType===Bu.comment&&Ys(/<[/\w]/g,ce.data))return ds(ce),!0;if(!(br.tagCheck instanceof Function&&br.tagCheck(Yt))&&(!de[Yt]||Ir[Yt])){if(!Ir[Yt]&&Vs(Yt)&&(We.tagNameCheck instanceof RegExp&&Ys(We.tagNameCheck,Yt)||We.tagNameCheck instanceof Function&&We.tagNameCheck(Yt)))return!1;if(_t&&!kr[Yt]){const bn=O(ce)||ce.parentNode,ms=P(ce)||ce.childNodes;if(ms&&bn){const yn=ms.length;for(let Tn=yn-1;Tn>=0;--Tn){const Kt=$(ms[Tn],!0);Kt.__removalCount=(ce.__removalCount||0)+1,bn.insertBefore(Kt,S(ce))}}}return ds(ce),!0}return ce instanceof g&&!bc(ce)||(Yt==="noscript"||Yt==="noembed"||Yt==="noframes")&&Ys(/<\/no(script|embed|frames)/i,ce.innerHTML)?(ds(ce),!0):(St&&ce.nodeType===Bu.text&&(dt=ce.textContent,ih([re,Se,D],bn=>{dt=Du(dt,bn," ")}),ce.textContent!==dt&&(Lu(t.removed,{element:ce.cloneNode()}),ce.textContent=dt)),no(ot.afterSanitizeElements,ce,null),!1)},yc=function(ce,dt,Yt){if(Oe&&(dt==="id"||dt==="name")&&(Yt in n||Yt in cs))return!1;if(!(mn&&!Qr[dt]&&Ys(Me,dt))){if(!($r&&Ys(Ut,dt))){if(!(br.attributeCheck instanceof Function&&br.attributeCheck(dt,ce))){if(!Ge[dt]||Qr[dt]){if(!(Vs(ce)&&(We.tagNameCheck instanceof RegExp&&Ys(We.tagNameCheck,ce)||We.tagNameCheck instanceof Function&&We.tagNameCheck(ce))&&(We.attributeNameCheck instanceof RegExp&&Ys(We.attributeNameCheck,dt)||We.attributeNameCheck instanceof Function&&We.attributeNameCheck(dt,ce))||dt==="is"&&We.allowCustomizedBuiltInElements&&(We.tagNameCheck instanceof RegExp&&Ys(We.tagNameCheck,Yt)||We.tagNameCheck instanceof Function&&We.tagNameCheck(Yt))))return!1}else if(!Ss[dt]){if(!Ys(Xe,Du(Yt,_e,""))){if(!((dt==="src"||dt==="xlink:href"||dt==="href")&&ce!=="script"&&kC(Yt,"data:")===0&&zn[ce])){if(!(Kr&&!Ys(je,Du(Yt,_e,"")))){if(Yt)return!1}}}}}}}return!0},Vs=function(ce){return ce!=="annotation-xml"&&mg(ce,be)},Hd=function(ce){no(ot.beforeSanitizeAttributes,ce,null);const{attributes:dt}=ce;if(!dt||Bd(ce))return;const Yt={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ge,forceKeepAttr:void 0};let bn=dt.length;for(;bn--;){const ms=dt[bn],{name:yn,namespaceURI:Tn,value:Kt}=ms,Br=Dn(yn),qo=Kt;let kn=yn==="value"?qo:jC(qo);if(Yt.attrName=Br,Yt.attrValue=kn,Yt.keepAttr=!0,Yt.forceKeepAttr=void 0,no(ot.uponSanitizeAttribute,ce,Yt),kn=Yt.attrValue,ke&&(Br==="id"||Br==="name")&&(xn(yn,ce),kn=at+kn),E&&Ys(/((--!?|])>)|<\/(style|title|textarea)/i,kn)){xn(yn,ce);continue}if(Br==="attributename"&&mg(kn,"href")){xn(yn,ce);continue}if(Yt.forceKeepAttr)continue;if(!Yt.keepAttr){xn(yn,ce);continue}if(!ns&&Ys(/\/>/i,kn)){xn(yn,ce);continue}St&&ih([re,Se,D],Wp=>{kn=Du(kn,Wp," ")});const Go=Dn(ce.nodeName);if(!yc(Go,Br,kn)){xn(yn,ce);continue}if(K&&typeof _=="object"&&typeof _.getAttributeType=="function"&&!Tn)switch(_.getAttributeType(Go,Br)){case"TrustedHTML":{kn=K.createHTML(kn);break}case"TrustedScriptURL":{kn=K.createScriptURL(kn);break}}if(kn!==qo)try{Tn?ce.setAttributeNS(Tn,yn,kn):ce.setAttribute(yn,kn),Bd(ce)?ds(ce):X1(t.removed)}catch{xn(yn,ce)}}no(ot.afterSanitizeAttributes,ce,null)},Os=function nr(ce){let dt=null;const Yt=Li(ce);for(no(ot.beforeSanitizeShadowDOM,ce,null);dt=Yt.nextNode();)no(ot.uponSanitizeShadowNode,dt,null),Hs(dt),Hd(dt),dt.content instanceof c&&nr(dt.content);no(ot.afterSanitizeShadowDOM,ce,null)};return t.sanitize=function(nr){let ce=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},dt=null,Yt=null,bn=null,ms=null;if(Ko=!nr,Ko&&(nr="\x3C!-->"),typeof nr!="string"&&!yr(nr))if(typeof nr.toString=="function"){if(nr=nr.toString(),typeof nr!="string")throw Uu("dirty is not a string, aborting")}else throw Uu("toString is not a function");if(!t.isSupported)return nr;if(Ee||Ud(ce),t.removed=[],typeof nr=="string"&&(tt=!1),tt){if(nr.nodeName){const Kt=Dn(nr.nodeName);if(!de[Kt]||Ir[Kt])throw Uu("root node is forbidden and cannot be sanitized in-place")}}else if(nr instanceof h)dt=Vp("\x3C!---->"),Yt=dt.ownerDocument.importNode(nr,!0),Yt.nodeType===Bu.element&&Yt.nodeName==="BODY"||Yt.nodeName==="HTML"?dt=Yt:dt.appendChild(Yt);else{if(!q&&!St&&!Ce&&nr.indexOf("<")===-1)return K&&Fe?K.createHTML(nr):nr;if(dt=Vp(nr),!dt)return q?null:Fe?Q:""}dt&&ee&&ds(dt.firstChild);const yn=Li(tt?nr:dt);for(;bn=yn.nextNode();)Hs(bn),Hd(bn),bn.content instanceof c&&Os(bn.content);if(tt)return nr;if(q){if(le)for(ms=we.call(dt.ownerDocument);dt.firstChild;)ms.appendChild(dt.firstChild);else ms=dt;return(Ge.shadowroot||Ge.shadowrootmode)&&(ms=ze.call(s,ms,!0)),ms}let Tn=Ce?dt.outerHTML:dt.innerHTML;return Ce&&de["!doctype"]&&dt.ownerDocument&&dt.ownerDocument.doctype&&dt.ownerDocument.doctype.name&&Ys(w2,dt.ownerDocument.doctype.name)&&(Tn="<!DOCTYPE "+dt.ownerDocument.doctype.name+`>
`+Tn),St&&ih([re,Se,D],Kt=>{Tn=Du(Tn,Kt," ")}),K&&Fe?K.createHTML(Tn):Tn},t.setConfig=function(){let nr=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ud(nr),Ee=!0},t.clearConfig=function(){Sa=null,Ee=!1},t.isValidAttribute=function(nr,ce,dt){Sa||Ud({});const Yt=Dn(nr),bn=Dn(ce);return yc(Yt,bn,dt)},t.addHook=function(nr,ce){typeof ce=="function"&&Lu(ot[nr],ce)},t.removeHook=function(nr,ce){if(ce!==void 0){const dt=wC(ot[nr],ce);return dt===-1?void 0:zC(ot[nr],dt,1)[0]}return X1(ot[nr])},t.removeHooks=function(nr){ot[nr]=[]},t.removeAllHooks=function(){ot=nw()},t}var DC=z2();/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var UC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FC=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Vt=(e,t)=>{const n=M.forwardRef(({color:s="currentColor",size:a=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:h="",children:g,...x},N)=>M.createElement("svg",{ref:N,...UC,width:a,height:a,stroke:s,strokeWidth:d?Number(c)*24/Number(a):c,className:["lucide",`lucide-${FC(e)}`,h].join(" "),...x},[...t.map(([C,A])=>M.createElement(C,A)),...Array.isArray(g)?g:[g]]));return n.displayName=`${e}`,n};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vg=Vt("ArrowRightSquare",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BC=Vt("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sw=Vt("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HC=Vt("Brush",[["path",{d:"m9.06 11.9 8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08",key:"1styjt"}],["path",{d:"M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z",key:"z0l1mu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iw=Vt("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ep=Vt("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VC=Vt("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xl=Vt("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zn=Vt("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WC=Vt("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zl=Vt("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wg=Vt("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ow=Vt("ChevronsUp",[["path",{d:"m17 11-5-5-5 5",key:"e8nh98"}],["path",{d:"m17 18-5-5-5 5",key:"2avn1x"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KC=Vt("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aw=Vt("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lw=Vt("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hu=Vt("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jl=Vt("CopyPlus",[["line",{x1:"15",x2:"15",y1:"12",y2:"18",key:"1p7wdc"}],["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aa=Vt("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k2=Vt("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cw=Vt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dw=Vt("FileAudio",[["path",{d:"M17.5 22h.5a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"rslqgf"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 19a2 2 0 1 1 4 0v1a2 2 0 1 1-4 0v-4a6 6 0 0 1 12 0v4a2 2 0 1 1-4 0v-1a2 2 0 1 1 4 0",key:"9f7x3i"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JC=Vt("FileImage",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"10",cy:"12",r:"2",key:"737tya"}],["path",{d:"m20 17-1.296-1.296a2.41 2.41 0 0 0-3.408 0L9 22",key:"wt3hpn"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qC=Vt("FileSearch",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"1vg67v"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["circle",{cx:"5",cy:"14",r:"3",key:"ufru5t"}],["path",{d:"m9 18-1.5-1.5",key:"1j6qii"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _i=Vt("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GC=Vt("FileVideo",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m10 11 5 3-5 3v-6Z",key:"7ntvm4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=Vt("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YC=Vt("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uw=Vt("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pw=Vt("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zc=Vt("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zg=Vt("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ah=Vt("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vu=Vt("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const la=Vt("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=Vt("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qc=Vt("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XC=Vt("Mic2",[["path",{d:"m12 8-9.04 9.06a2.82 2.82 0 1 0 3.98 3.98L16 12",key:"zoua8r"}],["circle",{cx:"17",cy:"7",r:"5",key:"1fomce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZC=Vt("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QC=Vt("MousePointer2",[["path",{d:"m4 4 7.07 17 2.51-7.39L21 11.07z",key:"1vqm48"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e3=Vt("PanelsTopLeft",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M9 21V9",key:"1oto5p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t3=Vt("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kg=Vt("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r3=Vt("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jg=Vt("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fw=Vt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ro=Vt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hp=Vt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n3=Vt("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s3=Vt("RotateCw",[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hw=Vt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ng=Vt("Scissors",[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mw=Vt("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i3=Vt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wu=Vt("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ox=Vt("Split",[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gw=Vt("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xw=Vt("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=Vt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o3=Vt("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a3=Vt("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sg=Vt("UploadCloud",[["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"M12 12v9",key:"192myk"}],["path",{d:"m16 16-4-4-4 4",key:"119tzi"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _g=Vt("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lh=Vt("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ch=Vt("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bw=Vt("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ui=Vt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dh=Vt("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function uh(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var j2={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(e,t){(function(n){e.exports=n()})(function(){return function n(s,a,c){function d(x,N){if(!a[x]){if(!s[x]){var C=typeof uh=="function"&&uh;if(!N&&C)return C(x,!0);if(h)return h(x,!0);var A=new Error("Cannot find module '"+x+"'");throw A.code="MODULE_NOT_FOUND",A}var _=a[x]={exports:{}};s[x][0].call(_.exports,function(R){var $=s[x][1][R];return d($||R)},_,_.exports,n,s,a,c)}return a[x].exports}for(var h=typeof uh=="function"&&uh,g=0;g<c.length;g++)d(c[g]);return d}({1:[function(n,s,a){var c=n("./utils"),d=n("./support"),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.encode=function(g){for(var x,N,C,A,_,R,$,L=[],S=0,P=g.length,O=P,K=c.getTypeOf(g)!=="string";S<g.length;)O=P-S,C=K?(x=g[S++],N=S<P?g[S++]:0,S<P?g[S++]:0):(x=g.charCodeAt(S++),N=S<P?g.charCodeAt(S++):0,S<P?g.charCodeAt(S++):0),A=x>>2,_=(3&x)<<4|N>>4,R=1<O?(15&N)<<2|C>>6:64,$=2<O?63&C:64,L.push(h.charAt(A)+h.charAt(_)+h.charAt(R)+h.charAt($));return L.join("")},a.decode=function(g){var x,N,C,A,_,R,$=0,L=0,S="data:";if(g.substr(0,S.length)===S)throw new Error("Invalid base64 input, it looks like a data url.");var P,O=3*(g=g.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(g.charAt(g.length-1)===h.charAt(64)&&O--,g.charAt(g.length-2)===h.charAt(64)&&O--,O%1!=0)throw new Error("Invalid base64 input, bad content length.");for(P=d.uint8array?new Uint8Array(0|O):new Array(0|O);$<g.length;)x=h.indexOf(g.charAt($++))<<2|(A=h.indexOf(g.charAt($++)))>>4,N=(15&A)<<4|(_=h.indexOf(g.charAt($++)))>>2,C=(3&_)<<6|(R=h.indexOf(g.charAt($++))),P[L++]=x,_!==64&&(P[L++]=N),R!==64&&(P[L++]=C);return P}},{"./support":30,"./utils":32}],2:[function(n,s,a){var c=n("./external"),d=n("./stream/DataWorker"),h=n("./stream/Crc32Probe"),g=n("./stream/DataLengthProbe");function x(N,C,A,_,R){this.compressedSize=N,this.uncompressedSize=C,this.crc32=A,this.compression=_,this.compressedContent=R}x.prototype={getContentWorker:function(){var N=new d(c.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new g("data_length")),C=this;return N.on("end",function(){if(this.streamInfo.data_length!==C.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),N},getCompressedWorker:function(){return new d(c.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},x.createWorkerFrom=function(N,C,A){return N.pipe(new h).pipe(new g("uncompressedSize")).pipe(C.compressWorker(A)).pipe(new g("compressedSize")).withStreamInfo("compression",C)},s.exports=x},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,s,a){var c=n("./stream/GenericWorker");a.STORE={magic:"\0\0",compressWorker:function(){return new c("STORE compression")},uncompressWorker:function(){return new c("STORE decompression")}},a.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,s,a){var c=n("./utils"),d=function(){for(var h,g=[],x=0;x<256;x++){h=x;for(var N=0;N<8;N++)h=1&h?3988292384^h>>>1:h>>>1;g[x]=h}return g}();s.exports=function(h,g){return h!==void 0&&h.length?c.getTypeOf(h)!=="string"?function(x,N,C,A){var _=d,R=A+C;x^=-1;for(var $=A;$<R;$++)x=x>>>8^_[255&(x^N[$])];return-1^x}(0|g,h,h.length,0):function(x,N,C,A){var _=d,R=A+C;x^=-1;for(var $=A;$<R;$++)x=x>>>8^_[255&(x^N.charCodeAt($))];return-1^x}(0|g,h,h.length,0):0}},{"./utils":32}],5:[function(n,s,a){a.base64=!1,a.binary=!1,a.dir=!1,a.createFolders=!0,a.date=null,a.compression=null,a.compressionOptions=null,a.comment=null,a.unixPermissions=null,a.dosPermissions=null},{}],6:[function(n,s,a){var c=null;c=typeof Promise<"u"?Promise:n("lie"),s.exports={Promise:c}},{lie:37}],7:[function(n,s,a){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",d=n("pako"),h=n("./utils"),g=n("./stream/GenericWorker"),x=c?"uint8array":"array";function N(C,A){g.call(this,"FlateWorker/"+C),this._pako=null,this._pakoAction=C,this._pakoOptions=A,this.meta={}}a.magic="\b\0",h.inherits(N,g),N.prototype.processChunk=function(C){this.meta=C.meta,this._pako===null&&this._createPako(),this._pako.push(h.transformTo(x,C.data),!1)},N.prototype.flush=function(){g.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},N.prototype.cleanUp=function(){g.prototype.cleanUp.call(this),this._pako=null},N.prototype._createPako=function(){this._pako=new d[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var C=this;this._pako.onData=function(A){C.push({data:A,meta:C.meta})}},a.compressWorker=function(C){return new N("Deflate",C)},a.uncompressWorker=function(){return new N("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,s,a){function c(_,R){var $,L="";for($=0;$<R;$++)L+=String.fromCharCode(255&_),_>>>=8;return L}function d(_,R,$,L,S,P){var O,K,Q=_.file,ue=_.compression,oe=P!==x.utf8encode,we=h.transformTo("string",P(Q.name)),he=h.transformTo("string",x.utf8encode(Q.name)),ze=Q.comment,ot=h.transformTo("string",P(ze)),re=h.transformTo("string",x.utf8encode(ze)),Se=he.length!==Q.name.length,D=re.length!==ze.length,Me="",Ut="",je="",_e=Q.dir,be=Q.date,Xe={crc32:0,compressedSize:0,uncompressedSize:0};R&&!$||(Xe.crc32=_.crc32,Xe.compressedSize=_.compressedSize,Xe.uncompressedSize=_.uncompressedSize);var de=0;R&&(de|=8),oe||!Se&&!D||(de|=2048);var fe=0,Ge=0;_e&&(fe|=16),S==="UNIX"?(Ge=798,fe|=function(We,Ir){var Qr=We;return We||(Qr=Ir?16893:33204),(65535&Qr)<<16}(Q.unixPermissions,_e)):(Ge=20,fe|=function(We){return 63&(We||0)}(Q.dosPermissions)),O=be.getUTCHours(),O<<=6,O|=be.getUTCMinutes(),O<<=5,O|=be.getUTCSeconds()/2,K=be.getUTCFullYear()-1980,K<<=4,K|=be.getUTCMonth()+1,K<<=5,K|=be.getUTCDate(),Se&&(Ut=c(1,1)+c(N(we),4)+he,Me+="up"+c(Ut.length,2)+Ut),D&&(je=c(1,1)+c(N(ot),4)+re,Me+="uc"+c(je.length,2)+je);var gt="";return gt+=`
\0`,gt+=c(de,2),gt+=ue.magic,gt+=c(O,2),gt+=c(K,2),gt+=c(Xe.crc32,4),gt+=c(Xe.compressedSize,4),gt+=c(Xe.uncompressedSize,4),gt+=c(we.length,2),gt+=c(Me.length,2),{fileRecord:C.LOCAL_FILE_HEADER+gt+we+Me,dirRecord:C.CENTRAL_FILE_HEADER+c(Ge,2)+gt+c(ot.length,2)+"\0\0\0\0"+c(fe,4)+c(L,4)+we+Me+ot}}var h=n("../utils"),g=n("../stream/GenericWorker"),x=n("../utf8"),N=n("../crc32"),C=n("../signature");function A(_,R,$,L){g.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=R,this.zipPlatform=$,this.encodeFileName=L,this.streamFiles=_,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}h.inherits(A,g),A.prototype.push=function(_){var R=_.meta.percent||0,$=this.entriesCount,L=this._sources.length;this.accumulate?this.contentBuffer.push(_):(this.bytesWritten+=_.data.length,g.prototype.push.call(this,{data:_.data,meta:{currentFile:this.currentFile,percent:$?(R+100*($-L-1))/$:100}}))},A.prototype.openedSource=function(_){this.currentSourceOffset=this.bytesWritten,this.currentFile=_.file.name;var R=this.streamFiles&&!_.file.dir;if(R){var $=d(_,R,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:$.fileRecord,meta:{percent:0}})}else this.accumulate=!0},A.prototype.closedSource=function(_){this.accumulate=!1;var R=this.streamFiles&&!_.file.dir,$=d(_,R,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push($.dirRecord),R)this.push({data:function(L){return C.DATA_DESCRIPTOR+c(L.crc32,4)+c(L.compressedSize,4)+c(L.uncompressedSize,4)}(_),meta:{percent:100}});else for(this.push({data:$.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},A.prototype.flush=function(){for(var _=this.bytesWritten,R=0;R<this.dirRecords.length;R++)this.push({data:this.dirRecords[R],meta:{percent:100}});var $=this.bytesWritten-_,L=function(S,P,O,K,Q){var ue=h.transformTo("string",Q(K));return C.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(S,2)+c(S,2)+c(P,4)+c(O,4)+c(ue.length,2)+ue}(this.dirRecords.length,$,_,this.zipComment,this.encodeFileName);this.push({data:L,meta:{percent:100}})},A.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},A.prototype.registerPrevious=function(_){this._sources.push(_);var R=this;return _.on("data",function($){R.processChunk($)}),_.on("end",function(){R.closedSource(R.previous.streamInfo),R._sources.length?R.prepareNextSource():R.end()}),_.on("error",function($){R.error($)}),this},A.prototype.resume=function(){return!!g.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},A.prototype.error=function(_){var R=this._sources;if(!g.prototype.error.call(this,_))return!1;for(var $=0;$<R.length;$++)try{R[$].error(_)}catch{}return!0},A.prototype.lock=function(){g.prototype.lock.call(this);for(var _=this._sources,R=0;R<_.length;R++)_[R].lock()},s.exports=A},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,s,a){var c=n("../compressions"),d=n("./ZipFileWorker");a.generateWorker=function(h,g,x){var N=new d(g.streamFiles,x,g.platform,g.encodeFileName),C=0;try{h.forEach(function(A,_){C++;var R=function(P,O){var K=P||O,Q=c[K];if(!Q)throw new Error(K+" is not a valid compression method !");return Q}(_.options.compression,g.compression),$=_.options.compressionOptions||g.compressionOptions||{},L=_.dir,S=_.date;_._compressWorker(R,$).withStreamInfo("file",{name:A,dir:L,date:S,comment:_.comment||"",unixPermissions:_.unixPermissions,dosPermissions:_.dosPermissions}).pipe(N)}),N.entriesCount=C}catch(A){N.error(A)}return N}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,s,a){function c(){if(!(this instanceof c))return new c;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var d=new c;for(var h in this)typeof this[h]!="function"&&(d[h]=this[h]);return d}}(c.prototype=n("./object")).loadAsync=n("./load"),c.support=n("./support"),c.defaults=n("./defaults"),c.version="3.10.1",c.loadAsync=function(d,h){return new c().loadAsync(d,h)},c.external=n("./external"),s.exports=c},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,s,a){var c=n("./utils"),d=n("./external"),h=n("./utf8"),g=n("./zipEntries"),x=n("./stream/Crc32Probe"),N=n("./nodejsUtils");function C(A){return new d.Promise(function(_,R){var $=A.decompressed.getContentWorker().pipe(new x);$.on("error",function(L){R(L)}).on("end",function(){$.streamInfo.crc32!==A.decompressed.crc32?R(new Error("Corrupted zip : CRC32 mismatch")):_()}).resume()})}s.exports=function(A,_){var R=this;return _=c.extend(_||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:h.utf8decode}),N.isNode&&N.isStream(A)?d.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):c.prepareContent("the loaded zip file",A,!0,_.optimizedBinaryString,_.base64).then(function($){var L=new g(_);return L.load($),L}).then(function($){var L=[d.Promise.resolve($)],S=$.files;if(_.checkCRC32)for(var P=0;P<S.length;P++)L.push(C(S[P]));return d.Promise.all(L)}).then(function($){for(var L=$.shift(),S=L.files,P=0;P<S.length;P++){var O=S[P],K=O.fileNameStr,Q=c.resolve(O.fileNameStr);R.file(Q,O.decompressed,{binary:!0,optimizedBinaryString:!0,date:O.date,dir:O.dir,comment:O.fileCommentStr.length?O.fileCommentStr:null,unixPermissions:O.unixPermissions,dosPermissions:O.dosPermissions,createFolders:_.createFolders}),O.dir||(R.file(Q).unsafeOriginalName=K)}return L.zipComment.length&&(R.comment=L.zipComment),R})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,s,a){var c=n("../utils"),d=n("../stream/GenericWorker");function h(g,x){d.call(this,"Nodejs stream input adapter for "+g),this._upstreamEnded=!1,this._bindStream(x)}c.inherits(h,d),h.prototype._bindStream=function(g){var x=this;(this._stream=g).pause(),g.on("data",function(N){x.push({data:N,meta:{percent:0}})}).on("error",function(N){x.isPaused?this.generatedError=N:x.error(N)}).on("end",function(){x.isPaused?x._upstreamEnded=!0:x.end()})},h.prototype.pause=function(){return!!d.prototype.pause.call(this)&&(this._stream.pause(),!0)},h.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=h},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,s,a){var c=n("readable-stream").Readable;function d(h,g,x){c.call(this,g),this._helper=h;var N=this;h.on("data",function(C,A){N.push(C)||N._helper.pause(),x&&x(A)}).on("error",function(C){N.emit("error",C)}).on("end",function(){N.push(null)})}n("../utils").inherits(d,c),d.prototype._read=function(){this._helper.resume()},s.exports=d},{"../utils":32,"readable-stream":16}],14:[function(n,s,a){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(c,d){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(c,d);if(typeof c=="number")throw new Error('The "data" argument must not be a number');return new Buffer(c,d)},allocBuffer:function(c){if(Buffer.alloc)return Buffer.alloc(c);var d=new Buffer(c);return d.fill(0),d},isBuffer:function(c){return Buffer.isBuffer(c)},isStream:function(c){return c&&typeof c.on=="function"&&typeof c.pause=="function"&&typeof c.resume=="function"}}},{}],15:[function(n,s,a){function c(Q,ue,oe){var we,he=h.getTypeOf(ue),ze=h.extend(oe||{},N);ze.date=ze.date||new Date,ze.compression!==null&&(ze.compression=ze.compression.toUpperCase()),typeof ze.unixPermissions=="string"&&(ze.unixPermissions=parseInt(ze.unixPermissions,8)),ze.unixPermissions&&16384&ze.unixPermissions&&(ze.dir=!0),ze.dosPermissions&&16&ze.dosPermissions&&(ze.dir=!0),ze.dir&&(Q=S(Q)),ze.createFolders&&(we=L(Q))&&P.call(this,we,!0);var ot=he==="string"&&ze.binary===!1&&ze.base64===!1;oe&&oe.binary!==void 0||(ze.binary=!ot),(ue instanceof C&&ue.uncompressedSize===0||ze.dir||!ue||ue.length===0)&&(ze.base64=!1,ze.binary=!0,ue="",ze.compression="STORE",he="string");var re=null;re=ue instanceof C||ue instanceof g?ue:R.isNode&&R.isStream(ue)?new $(Q,ue):h.prepareContent(Q,ue,ze.binary,ze.optimizedBinaryString,ze.base64);var Se=new A(Q,re,ze);this.files[Q]=Se}var d=n("./utf8"),h=n("./utils"),g=n("./stream/GenericWorker"),x=n("./stream/StreamHelper"),N=n("./defaults"),C=n("./compressedObject"),A=n("./zipObject"),_=n("./generate"),R=n("./nodejsUtils"),$=n("./nodejs/NodejsStreamInputAdapter"),L=function(Q){Q.slice(-1)==="/"&&(Q=Q.substring(0,Q.length-1));var ue=Q.lastIndexOf("/");return 0<ue?Q.substring(0,ue):""},S=function(Q){return Q.slice(-1)!=="/"&&(Q+="/"),Q},P=function(Q,ue){return ue=ue!==void 0?ue:N.createFolders,Q=S(Q),this.files[Q]||c.call(this,Q,null,{dir:!0,createFolders:ue}),this.files[Q]};function O(Q){return Object.prototype.toString.call(Q)==="[object RegExp]"}var K={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(Q){var ue,oe,we;for(ue in this.files)we=this.files[ue],(oe=ue.slice(this.root.length,ue.length))&&ue.slice(0,this.root.length)===this.root&&Q(oe,we)},filter:function(Q){var ue=[];return this.forEach(function(oe,we){Q(oe,we)&&ue.push(we)}),ue},file:function(Q,ue,oe){if(arguments.length!==1)return Q=this.root+Q,c.call(this,Q,ue,oe),this;if(O(Q)){var we=Q;return this.filter(function(ze,ot){return!ot.dir&&we.test(ze)})}var he=this.files[this.root+Q];return he&&!he.dir?he:null},folder:function(Q){if(!Q)return this;if(O(Q))return this.filter(function(he,ze){return ze.dir&&Q.test(he)});var ue=this.root+Q,oe=P.call(this,ue),we=this.clone();return we.root=oe.name,we},remove:function(Q){Q=this.root+Q;var ue=this.files[Q];if(ue||(Q.slice(-1)!=="/"&&(Q+="/"),ue=this.files[Q]),ue&&!ue.dir)delete this.files[Q];else for(var oe=this.filter(function(he,ze){return ze.name.slice(0,Q.length)===Q}),we=0;we<oe.length;we++)delete this.files[oe[we].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(Q){var ue,oe={};try{if((oe=h.extend(Q||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:d.utf8encode})).type=oe.type.toLowerCase(),oe.compression=oe.compression.toUpperCase(),oe.type==="binarystring"&&(oe.type="string"),!oe.type)throw new Error("No output type specified.");h.checkSupport(oe.type),oe.platform!=="darwin"&&oe.platform!=="freebsd"&&oe.platform!=="linux"&&oe.platform!=="sunos"||(oe.platform="UNIX"),oe.platform==="win32"&&(oe.platform="DOS");var we=oe.comment||this.comment||"";ue=_.generateWorker(this,oe,we)}catch(he){(ue=new g("error")).error(he)}return new x(ue,oe.type||"string",oe.mimeType)},generateAsync:function(Q,ue){return this.generateInternalStream(Q).accumulate(ue)},generateNodeStream:function(Q,ue){return(Q=Q||{}).type||(Q.type="nodebuffer"),this.generateInternalStream(Q).toNodejsStream(ue)}};s.exports=K},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,s,a){s.exports=n("stream")},{stream:void 0}],17:[function(n,s,a){var c=n("./DataReader");function d(h){c.call(this,h);for(var g=0;g<this.data.length;g++)h[g]=255&h[g]}n("../utils").inherits(d,c),d.prototype.byteAt=function(h){return this.data[this.zero+h]},d.prototype.lastIndexOfSignature=function(h){for(var g=h.charCodeAt(0),x=h.charCodeAt(1),N=h.charCodeAt(2),C=h.charCodeAt(3),A=this.length-4;0<=A;--A)if(this.data[A]===g&&this.data[A+1]===x&&this.data[A+2]===N&&this.data[A+3]===C)return A-this.zero;return-1},d.prototype.readAndCheckSignature=function(h){var g=h.charCodeAt(0),x=h.charCodeAt(1),N=h.charCodeAt(2),C=h.charCodeAt(3),A=this.readData(4);return g===A[0]&&x===A[1]&&N===A[2]&&C===A[3]},d.prototype.readData=function(h){if(this.checkOffset(h),h===0)return[];var g=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,g},s.exports=d},{"../utils":32,"./DataReader":18}],18:[function(n,s,a){var c=n("../utils");function d(h){this.data=h,this.length=h.length,this.index=0,this.zero=0}d.prototype={checkOffset:function(h){this.checkIndex(this.index+h)},checkIndex:function(h){if(this.length<this.zero+h||h<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+h+"). Corrupted zip ?")},setIndex:function(h){this.checkIndex(h),this.index=h},skip:function(h){this.setIndex(this.index+h)},byteAt:function(){},readInt:function(h){var g,x=0;for(this.checkOffset(h),g=this.index+h-1;g>=this.index;g--)x=(x<<8)+this.byteAt(g);return this.index+=h,x},readString:function(h){return c.transformTo("string",this.readData(h))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var h=this.readInt(4);return new Date(Date.UTC(1980+(h>>25&127),(h>>21&15)-1,h>>16&31,h>>11&31,h>>5&63,(31&h)<<1))}},s.exports=d},{"../utils":32}],19:[function(n,s,a){var c=n("./Uint8ArrayReader");function d(h){c.call(this,h)}n("../utils").inherits(d,c),d.prototype.readData=function(h){this.checkOffset(h);var g=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,g},s.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,s,a){var c=n("./DataReader");function d(h){c.call(this,h)}n("../utils").inherits(d,c),d.prototype.byteAt=function(h){return this.data.charCodeAt(this.zero+h)},d.prototype.lastIndexOfSignature=function(h){return this.data.lastIndexOf(h)-this.zero},d.prototype.readAndCheckSignature=function(h){return h===this.readData(4)},d.prototype.readData=function(h){this.checkOffset(h);var g=this.data.slice(this.zero+this.index,this.zero+this.index+h);return this.index+=h,g},s.exports=d},{"../utils":32,"./DataReader":18}],21:[function(n,s,a){var c=n("./ArrayReader");function d(h){c.call(this,h)}n("../utils").inherits(d,c),d.prototype.readData=function(h){if(this.checkOffset(h),h===0)return new Uint8Array(0);var g=this.data.subarray(this.zero+this.index,this.zero+this.index+h);return this.index+=h,g},s.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(n,s,a){var c=n("../utils"),d=n("../support"),h=n("./ArrayReader"),g=n("./StringReader"),x=n("./NodeBufferReader"),N=n("./Uint8ArrayReader");s.exports=function(C){var A=c.getTypeOf(C);return c.checkSupport(A),A!=="string"||d.uint8array?A==="nodebuffer"?new x(C):d.uint8array?new N(c.transformTo("uint8array",C)):new h(c.transformTo("array",C)):new g(C)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,s,a){a.LOCAL_FILE_HEADER="PK",a.CENTRAL_FILE_HEADER="PK",a.CENTRAL_DIRECTORY_END="PK",a.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",a.ZIP64_CENTRAL_DIRECTORY_END="PK",a.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,s,a){var c=n("./GenericWorker"),d=n("../utils");function h(g){c.call(this,"ConvertWorker to "+g),this.destType=g}d.inherits(h,c),h.prototype.processChunk=function(g){this.push({data:d.transformTo(this.destType,g.data),meta:g.meta})},s.exports=h},{"../utils":32,"./GenericWorker":28}],25:[function(n,s,a){var c=n("./GenericWorker"),d=n("../crc32");function h(){c.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(h,c),h.prototype.processChunk=function(g){this.streamInfo.crc32=d(g.data,this.streamInfo.crc32||0),this.push(g)},s.exports=h},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,s,a){var c=n("../utils"),d=n("./GenericWorker");function h(g){d.call(this,"DataLengthProbe for "+g),this.propName=g,this.withStreamInfo(g,0)}c.inherits(h,d),h.prototype.processChunk=function(g){if(g){var x=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=x+g.data.length}d.prototype.processChunk.call(this,g)},s.exports=h},{"../utils":32,"./GenericWorker":28}],27:[function(n,s,a){var c=n("../utils"),d=n("./GenericWorker");function h(g){d.call(this,"DataWorker");var x=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,g.then(function(N){x.dataIsReady=!0,x.data=N,x.max=N&&N.length||0,x.type=c.getTypeOf(N),x.isPaused||x._tickAndRepeat()},function(N){x.error(N)})}c.inherits(h,d),h.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this.data=null},h.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,c.delay(this._tickAndRepeat,[],this)),!0)},h.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(c.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},h.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var g=null,x=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":g=this.data.substring(this.index,x);break;case"uint8array":g=this.data.subarray(this.index,x);break;case"array":case"nodebuffer":g=this.data.slice(this.index,x)}return this.index=x,this.push({data:g,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=h},{"../utils":32,"./GenericWorker":28}],28:[function(n,s,a){function c(d){this.name=d||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}c.prototype={push:function(d){this.emit("data",d)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(d){this.emit("error",d)}return!0},error:function(d){return!this.isFinished&&(this.isPaused?this.generatedError=d:(this.isFinished=!0,this.emit("error",d),this.previous&&this.previous.error(d),this.cleanUp()),!0)},on:function(d,h){return this._listeners[d].push(h),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(d,h){if(this._listeners[d])for(var g=0;g<this._listeners[d].length;g++)this._listeners[d][g].call(this,h)},pipe:function(d){return d.registerPrevious(this)},registerPrevious:function(d){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=d.streamInfo,this.mergeStreamInfo(),this.previous=d;var h=this;return d.on("data",function(g){h.processChunk(g)}),d.on("end",function(){h.end()}),d.on("error",function(g){h.error(g)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var d=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),d=!0),this.previous&&this.previous.resume(),!d},flush:function(){},processChunk:function(d){this.push(d)},withStreamInfo:function(d,h){return this.extraStreamInfo[d]=h,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var d in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,d)&&(this.streamInfo[d]=this.extraStreamInfo[d])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var d="Worker "+this.name;return this.previous?this.previous+" -> "+d:d}},s.exports=c},{}],29:[function(n,s,a){var c=n("../utils"),d=n("./ConvertWorker"),h=n("./GenericWorker"),g=n("../base64"),x=n("../support"),N=n("../external"),C=null;if(x.nodestream)try{C=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function A(R,$){return new N.Promise(function(L,S){var P=[],O=R._internalType,K=R._outputType,Q=R._mimeType;R.on("data",function(ue,oe){P.push(ue),$&&$(oe)}).on("error",function(ue){P=[],S(ue)}).on("end",function(){try{var ue=function(oe,we,he){switch(oe){case"blob":return c.newBlob(c.transformTo("arraybuffer",we),he);case"base64":return g.encode(we);default:return c.transformTo(oe,we)}}(K,function(oe,we){var he,ze=0,ot=null,re=0;for(he=0;he<we.length;he++)re+=we[he].length;switch(oe){case"string":return we.join("");case"array":return Array.prototype.concat.apply([],we);case"uint8array":for(ot=new Uint8Array(re),he=0;he<we.length;he++)ot.set(we[he],ze),ze+=we[he].length;return ot;case"nodebuffer":return Buffer.concat(we);default:throw new Error("concat : unsupported type '"+oe+"'")}}(O,P),Q);L(ue)}catch(oe){S(oe)}P=[]}).resume()})}function _(R,$,L){var S=$;switch($){case"blob":case"arraybuffer":S="uint8array";break;case"base64":S="string"}try{this._internalType=S,this._outputType=$,this._mimeType=L,c.checkSupport(S),this._worker=R.pipe(new d(S)),R.lock()}catch(P){this._worker=new h("error"),this._worker.error(P)}}_.prototype={accumulate:function(R){return A(this,R)},on:function(R,$){var L=this;return R==="data"?this._worker.on(R,function(S){$.call(L,S.data,S.meta)}):this._worker.on(R,function(){c.delay($,arguments,L)}),this},resume:function(){return c.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(R){if(c.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new C(this,{objectMode:this._outputType!=="nodebuffer"},R)}},s.exports=_},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,s,a){if(a.base64=!0,a.array=!0,a.string=!0,a.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",a.nodebuffer=typeof Buffer<"u",a.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")a.blob=!1;else{var c=new ArrayBuffer(0);try{a.blob=new Blob([c],{type:"application/zip"}).size===0}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);d.append(c),a.blob=d.getBlob("application/zip").size===0}catch{a.blob=!1}}}try{a.nodestream=!!n("readable-stream").Readable}catch{a.nodestream=!1}},{"readable-stream":16}],31:[function(n,s,a){for(var c=n("./utils"),d=n("./support"),h=n("./nodejsUtils"),g=n("./stream/GenericWorker"),x=new Array(256),N=0;N<256;N++)x[N]=252<=N?6:248<=N?5:240<=N?4:224<=N?3:192<=N?2:1;x[254]=x[254]=1;function C(){g.call(this,"utf-8 decode"),this.leftOver=null}function A(){g.call(this,"utf-8 encode")}a.utf8encode=function(_){return d.nodebuffer?h.newBufferFrom(_,"utf-8"):function(R){var $,L,S,P,O,K=R.length,Q=0;for(P=0;P<K;P++)(64512&(L=R.charCodeAt(P)))==55296&&P+1<K&&(64512&(S=R.charCodeAt(P+1)))==56320&&(L=65536+(L-55296<<10)+(S-56320),P++),Q+=L<128?1:L<2048?2:L<65536?3:4;for($=d.uint8array?new Uint8Array(Q):new Array(Q),P=O=0;O<Q;P++)(64512&(L=R.charCodeAt(P)))==55296&&P+1<K&&(64512&(S=R.charCodeAt(P+1)))==56320&&(L=65536+(L-55296<<10)+(S-56320),P++),L<128?$[O++]=L:(L<2048?$[O++]=192|L>>>6:(L<65536?$[O++]=224|L>>>12:($[O++]=240|L>>>18,$[O++]=128|L>>>12&63),$[O++]=128|L>>>6&63),$[O++]=128|63&L);return $}(_)},a.utf8decode=function(_){return d.nodebuffer?c.transformTo("nodebuffer",_).toString("utf-8"):function(R){var $,L,S,P,O=R.length,K=new Array(2*O);for($=L=0;$<O;)if((S=R[$++])<128)K[L++]=S;else if(4<(P=x[S]))K[L++]=65533,$+=P-1;else{for(S&=P===2?31:P===3?15:7;1<P&&$<O;)S=S<<6|63&R[$++],P--;1<P?K[L++]=65533:S<65536?K[L++]=S:(S-=65536,K[L++]=55296|S>>10&1023,K[L++]=56320|1023&S)}return K.length!==L&&(K.subarray?K=K.subarray(0,L):K.length=L),c.applyFromCharCode(K)}(_=c.transformTo(d.uint8array?"uint8array":"array",_))},c.inherits(C,g),C.prototype.processChunk=function(_){var R=c.transformTo(d.uint8array?"uint8array":"array",_.data);if(this.leftOver&&this.leftOver.length){if(d.uint8array){var $=R;(R=new Uint8Array($.length+this.leftOver.length)).set(this.leftOver,0),R.set($,this.leftOver.length)}else R=this.leftOver.concat(R);this.leftOver=null}var L=function(P,O){var K;for((O=O||P.length)>P.length&&(O=P.length),K=O-1;0<=K&&(192&P[K])==128;)K--;return K<0||K===0?O:K+x[P[K]]>O?K:O}(R),S=R;L!==R.length&&(d.uint8array?(S=R.subarray(0,L),this.leftOver=R.subarray(L,R.length)):(S=R.slice(0,L),this.leftOver=R.slice(L,R.length))),this.push({data:a.utf8decode(S),meta:_.meta})},C.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:a.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},a.Utf8DecodeWorker=C,c.inherits(A,g),A.prototype.processChunk=function(_){this.push({data:a.utf8encode(_.data),meta:_.meta})},a.Utf8EncodeWorker=A},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,s,a){var c=n("./support"),d=n("./base64"),h=n("./nodejsUtils"),g=n("./external");function x($){return $}function N($,L){for(var S=0;S<$.length;++S)L[S]=255&$.charCodeAt(S);return L}n("setimmediate"),a.newBlob=function($,L){a.checkSupport("blob");try{return new Blob([$],{type:L})}catch{try{var S=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return S.append($),S.getBlob(L)}catch{throw new Error("Bug : can't construct the Blob.")}}};var C={stringifyByChunk:function($,L,S){var P=[],O=0,K=$.length;if(K<=S)return String.fromCharCode.apply(null,$);for(;O<K;)L==="array"||L==="nodebuffer"?P.push(String.fromCharCode.apply(null,$.slice(O,Math.min(O+S,K)))):P.push(String.fromCharCode.apply(null,$.subarray(O,Math.min(O+S,K)))),O+=S;return P.join("")},stringifyByChar:function($){for(var L="",S=0;S<$.length;S++)L+=String.fromCharCode($[S]);return L},applyCanBeUsed:{uint8array:function(){try{return c.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return c.nodebuffer&&String.fromCharCode.apply(null,h.allocBuffer(1)).length===1}catch{return!1}}()}};function A($){var L=65536,S=a.getTypeOf($),P=!0;if(S==="uint8array"?P=C.applyCanBeUsed.uint8array:S==="nodebuffer"&&(P=C.applyCanBeUsed.nodebuffer),P)for(;1<L;)try{return C.stringifyByChunk($,S,L)}catch{L=Math.floor(L/2)}return C.stringifyByChar($)}function _($,L){for(var S=0;S<$.length;S++)L[S]=$[S];return L}a.applyFromCharCode=A;var R={};R.string={string:x,array:function($){return N($,new Array($.length))},arraybuffer:function($){return R.string.uint8array($).buffer},uint8array:function($){return N($,new Uint8Array($.length))},nodebuffer:function($){return N($,h.allocBuffer($.length))}},R.array={string:A,array:x,arraybuffer:function($){return new Uint8Array($).buffer},uint8array:function($){return new Uint8Array($)},nodebuffer:function($){return h.newBufferFrom($)}},R.arraybuffer={string:function($){return A(new Uint8Array($))},array:function($){return _(new Uint8Array($),new Array($.byteLength))},arraybuffer:x,uint8array:function($){return new Uint8Array($)},nodebuffer:function($){return h.newBufferFrom(new Uint8Array($))}},R.uint8array={string:A,array:function($){return _($,new Array($.length))},arraybuffer:function($){return $.buffer},uint8array:x,nodebuffer:function($){return h.newBufferFrom($)}},R.nodebuffer={string:A,array:function($){return _($,new Array($.length))},arraybuffer:function($){return R.nodebuffer.uint8array($).buffer},uint8array:function($){return _($,new Uint8Array($.length))},nodebuffer:x},a.transformTo=function($,L){if(L=L||"",!$)return L;a.checkSupport($);var S=a.getTypeOf(L);return R[S][$](L)},a.resolve=function($){for(var L=$.split("/"),S=[],P=0;P<L.length;P++){var O=L[P];O==="."||O===""&&P!==0&&P!==L.length-1||(O===".."?S.pop():S.push(O))}return S.join("/")},a.getTypeOf=function($){return typeof $=="string"?"string":Object.prototype.toString.call($)==="[object Array]"?"array":c.nodebuffer&&h.isBuffer($)?"nodebuffer":c.uint8array&&$ instanceof Uint8Array?"uint8array":c.arraybuffer&&$ instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function($){if(!c[$.toLowerCase()])throw new Error($+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function($){var L,S,P="";for(S=0;S<($||"").length;S++)P+="\\x"+((L=$.charCodeAt(S))<16?"0":"")+L.toString(16).toUpperCase();return P},a.delay=function($,L,S){setImmediate(function(){$.apply(S||null,L||[])})},a.inherits=function($,L){function S(){}S.prototype=L.prototype,$.prototype=new S},a.extend=function(){var $,L,S={};for($=0;$<arguments.length;$++)for(L in arguments[$])Object.prototype.hasOwnProperty.call(arguments[$],L)&&S[L]===void 0&&(S[L]=arguments[$][L]);return S},a.prepareContent=function($,L,S,P,O){return g.Promise.resolve(L).then(function(K){return c.blob&&(K instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(K))!==-1)&&typeof FileReader<"u"?new g.Promise(function(Q,ue){var oe=new FileReader;oe.onload=function(we){Q(we.target.result)},oe.onerror=function(we){ue(we.target.error)},oe.readAsArrayBuffer(K)}):K}).then(function(K){var Q=a.getTypeOf(K);return Q?(Q==="arraybuffer"?K=a.transformTo("uint8array",K):Q==="string"&&(O?K=d.decode(K):S&&P!==!0&&(K=function(ue){return N(ue,c.uint8array?new Uint8Array(ue.length):new Array(ue.length))}(K))),K):g.Promise.reject(new Error("Can't read the data of '"+$+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,s,a){var c=n("./reader/readerFor"),d=n("./utils"),h=n("./signature"),g=n("./zipEntry"),x=n("./support");function N(C){this.files=[],this.loadOptions=C}N.prototype={checkSignature:function(C){if(!this.reader.readAndCheckSignature(C)){this.reader.index-=4;var A=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+d.pretty(A)+", expected "+d.pretty(C)+")")}},isSignature:function(C,A){var _=this.reader.index;this.reader.setIndex(C);var R=this.reader.readString(4)===A;return this.reader.setIndex(_),R},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var C=this.reader.readData(this.zipCommentLength),A=x.uint8array?"uint8array":"array",_=d.transformTo(A,C);this.zipComment=this.loadOptions.decodeFileName(_)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var C,A,_,R=this.zip64EndOfCentralSize-44;0<R;)C=this.reader.readInt(2),A=this.reader.readInt(4),_=this.reader.readData(A),this.zip64ExtensibleData[C]={id:C,length:A,value:_}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var C,A;for(C=0;C<this.files.length;C++)A=this.files[C],this.reader.setIndex(A.localHeaderOffset),this.checkSignature(h.LOCAL_FILE_HEADER),A.readLocalPart(this.reader),A.handleUTF8(),A.processAttributes()},readCentralDir:function(){var C;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(h.CENTRAL_FILE_HEADER);)(C=new g({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(C);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var C=this.reader.lastIndexOfSignature(h.CENTRAL_DIRECTORY_END);if(C<0)throw this.isSignature(0,h.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(C);var A=C;if(this.checkSignature(h.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===d.MAX_VALUE_16BITS||this.diskWithCentralDirStart===d.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===d.MAX_VALUE_16BITS||this.centralDirRecords===d.MAX_VALUE_16BITS||this.centralDirSize===d.MAX_VALUE_32BITS||this.centralDirOffset===d.MAX_VALUE_32BITS){if(this.zip64=!0,(C=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(C),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,h.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(h.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var _=this.centralDirOffset+this.centralDirSize;this.zip64&&(_+=20,_+=12+this.zip64EndOfCentralSize);var R=A-_;if(0<R)this.isSignature(A,h.CENTRAL_FILE_HEADER)||(this.reader.zero=R);else if(R<0)throw new Error("Corrupted zip: missing "+Math.abs(R)+" bytes.")},prepareReader:function(C){this.reader=c(C)},load:function(C){this.prepareReader(C),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=N},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,s,a){var c=n("./reader/readerFor"),d=n("./utils"),h=n("./compressedObject"),g=n("./crc32"),x=n("./utf8"),N=n("./compressions"),C=n("./support");function A(_,R){this.options=_,this.loadOptions=R}A.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(_){var R,$;if(_.skip(22),this.fileNameLength=_.readInt(2),$=_.readInt(2),this.fileName=_.readData(this.fileNameLength),_.skip($),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((R=function(L){for(var S in N)if(Object.prototype.hasOwnProperty.call(N,S)&&N[S].magic===L)return N[S];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+d.pretty(this.compressionMethod)+" unknown (inner file : "+d.transformTo("string",this.fileName)+")");this.decompressed=new h(this.compressedSize,this.uncompressedSize,this.crc32,R,_.readData(this.compressedSize))},readCentralPart:function(_){this.versionMadeBy=_.readInt(2),_.skip(2),this.bitFlag=_.readInt(2),this.compressionMethod=_.readString(2),this.date=_.readDate(),this.crc32=_.readInt(4),this.compressedSize=_.readInt(4),this.uncompressedSize=_.readInt(4);var R=_.readInt(2);if(this.extraFieldsLength=_.readInt(2),this.fileCommentLength=_.readInt(2),this.diskNumberStart=_.readInt(2),this.internalFileAttributes=_.readInt(2),this.externalFileAttributes=_.readInt(4),this.localHeaderOffset=_.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");_.skip(R),this.readExtraFields(_),this.parseZIP64ExtraField(_),this.fileComment=_.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var _=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),_==0&&(this.dosPermissions=63&this.externalFileAttributes),_==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var _=c(this.extraFields[1].value);this.uncompressedSize===d.MAX_VALUE_32BITS&&(this.uncompressedSize=_.readInt(8)),this.compressedSize===d.MAX_VALUE_32BITS&&(this.compressedSize=_.readInt(8)),this.localHeaderOffset===d.MAX_VALUE_32BITS&&(this.localHeaderOffset=_.readInt(8)),this.diskNumberStart===d.MAX_VALUE_32BITS&&(this.diskNumberStart=_.readInt(4))}},readExtraFields:function(_){var R,$,L,S=_.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});_.index+4<S;)R=_.readInt(2),$=_.readInt(2),L=_.readData($),this.extraFields[R]={id:R,length:$,value:L};_.setIndex(S)},handleUTF8:function(){var _=C.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=x.utf8decode(this.fileName),this.fileCommentStr=x.utf8decode(this.fileComment);else{var R=this.findExtraFieldUnicodePath();if(R!==null)this.fileNameStr=R;else{var $=d.transformTo(_,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName($)}var L=this.findExtraFieldUnicodeComment();if(L!==null)this.fileCommentStr=L;else{var S=d.transformTo(_,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(S)}}},findExtraFieldUnicodePath:function(){var _=this.extraFields[28789];if(_){var R=c(_.value);return R.readInt(1)!==1||g(this.fileName)!==R.readInt(4)?null:x.utf8decode(R.readData(_.length-5))}return null},findExtraFieldUnicodeComment:function(){var _=this.extraFields[25461];if(_){var R=c(_.value);return R.readInt(1)!==1||g(this.fileComment)!==R.readInt(4)?null:x.utf8decode(R.readData(_.length-5))}return null}},s.exports=A},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,s,a){function c(R,$,L){this.name=R,this.dir=L.dir,this.date=L.date,this.comment=L.comment,this.unixPermissions=L.unixPermissions,this.dosPermissions=L.dosPermissions,this._data=$,this._dataBinary=L.binary,this.options={compression:L.compression,compressionOptions:L.compressionOptions}}var d=n("./stream/StreamHelper"),h=n("./stream/DataWorker"),g=n("./utf8"),x=n("./compressedObject"),N=n("./stream/GenericWorker");c.prototype={internalStream:function(R){var $=null,L="string";try{if(!R)throw new Error("No output type specified.");var S=(L=R.toLowerCase())==="string"||L==="text";L!=="binarystring"&&L!=="text"||(L="string"),$=this._decompressWorker();var P=!this._dataBinary;P&&!S&&($=$.pipe(new g.Utf8EncodeWorker)),!P&&S&&($=$.pipe(new g.Utf8DecodeWorker))}catch(O){($=new N("error")).error(O)}return new d($,L,"")},async:function(R,$){return this.internalStream(R).accumulate($)},nodeStream:function(R,$){return this.internalStream(R||"nodebuffer").toNodejsStream($)},_compressWorker:function(R,$){if(this._data instanceof x&&this._data.compression.magic===R.magic)return this._data.getCompressedWorker();var L=this._decompressWorker();return this._dataBinary||(L=L.pipe(new g.Utf8EncodeWorker)),x.createWorkerFrom(L,R,$)},_decompressWorker:function(){return this._data instanceof x?this._data.getContentWorker():this._data instanceof N?this._data:new h(this._data)}};for(var C=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],A=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},_=0;_<C.length;_++)c.prototype[C[_]]=A;s.exports=c},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,s,a){(function(c){var d,h,g=c.MutationObserver||c.WebKitMutationObserver;if(g){var x=0,N=new g(R),C=c.document.createTextNode("");N.observe(C,{characterData:!0}),d=function(){C.data=x=++x%2}}else if(c.setImmediate||c.MessageChannel===void 0)d="document"in c&&"onreadystatechange"in c.document.createElement("script")?function(){var $=c.document.createElement("script");$.onreadystatechange=function(){R(),$.onreadystatechange=null,$.parentNode.removeChild($),$=null},c.document.documentElement.appendChild($)}:function(){setTimeout(R,0)};else{var A=new c.MessageChannel;A.port1.onmessage=R,d=function(){A.port2.postMessage(0)}}var _=[];function R(){var $,L;h=!0;for(var S=_.length;S;){for(L=_,_=[],$=-1;++$<S;)L[$]();S=_.length}h=!1}s.exports=function($){_.push($)!==1||h||d()}}).call(this,typeof ma<"u"?ma:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,s,a){var c=n("immediate");function d(){}var h={},g=["REJECTED"],x=["FULFILLED"],N=["PENDING"];function C(S){if(typeof S!="function")throw new TypeError("resolver must be a function");this.state=N,this.queue=[],this.outcome=void 0,S!==d&&$(this,S)}function A(S,P,O){this.promise=S,typeof P=="function"&&(this.onFulfilled=P,this.callFulfilled=this.otherCallFulfilled),typeof O=="function"&&(this.onRejected=O,this.callRejected=this.otherCallRejected)}function _(S,P,O){c(function(){var K;try{K=P(O)}catch(Q){return h.reject(S,Q)}K===S?h.reject(S,new TypeError("Cannot resolve promise with itself")):h.resolve(S,K)})}function R(S){var P=S&&S.then;if(S&&(typeof S=="object"||typeof S=="function")&&typeof P=="function")return function(){P.apply(S,arguments)}}function $(S,P){var O=!1;function K(oe){O||(O=!0,h.reject(S,oe))}function Q(oe){O||(O=!0,h.resolve(S,oe))}var ue=L(function(){P(Q,K)});ue.status==="error"&&K(ue.value)}function L(S,P){var O={};try{O.value=S(P),O.status="success"}catch(K){O.status="error",O.value=K}return O}(s.exports=C).prototype.finally=function(S){if(typeof S!="function")return this;var P=this.constructor;return this.then(function(O){return P.resolve(S()).then(function(){return O})},function(O){return P.resolve(S()).then(function(){throw O})})},C.prototype.catch=function(S){return this.then(null,S)},C.prototype.then=function(S,P){if(typeof S!="function"&&this.state===x||typeof P!="function"&&this.state===g)return this;var O=new this.constructor(d);return this.state!==N?_(O,this.state===x?S:P,this.outcome):this.queue.push(new A(O,S,P)),O},A.prototype.callFulfilled=function(S){h.resolve(this.promise,S)},A.prototype.otherCallFulfilled=function(S){_(this.promise,this.onFulfilled,S)},A.prototype.callRejected=function(S){h.reject(this.promise,S)},A.prototype.otherCallRejected=function(S){_(this.promise,this.onRejected,S)},h.resolve=function(S,P){var O=L(R,P);if(O.status==="error")return h.reject(S,O.value);var K=O.value;if(K)$(S,K);else{S.state=x,S.outcome=P;for(var Q=-1,ue=S.queue.length;++Q<ue;)S.queue[Q].callFulfilled(P)}return S},h.reject=function(S,P){S.state=g,S.outcome=P;for(var O=-1,K=S.queue.length;++O<K;)S.queue[O].callRejected(P);return S},C.resolve=function(S){return S instanceof this?S:h.resolve(new this(d),S)},C.reject=function(S){var P=new this(d);return h.reject(P,S)},C.all=function(S){var P=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var O=S.length,K=!1;if(!O)return this.resolve([]);for(var Q=new Array(O),ue=0,oe=-1,we=new this(d);++oe<O;)he(S[oe],oe);return we;function he(ze,ot){P.resolve(ze).then(function(re){Q[ot]=re,++ue!==O||K||(K=!0,h.resolve(we,Q))},function(re){K||(K=!0,h.reject(we,re))})}},C.race=function(S){var P=this;if(Object.prototype.toString.call(S)!=="[object Array]")return this.reject(new TypeError("must be an array"));var O=S.length,K=!1;if(!O)return this.resolve([]);for(var Q=-1,ue=new this(d);++Q<O;)oe=S[Q],P.resolve(oe).then(function(we){K||(K=!0,h.resolve(ue,we))},function(we){K||(K=!0,h.reject(ue,we))});var oe;return ue}},{immediate:36}],38:[function(n,s,a){var c={};(0,n("./lib/utils/common").assign)(c,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),s.exports=c},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,s,a){var c=n("./zlib/deflate"),d=n("./utils/common"),h=n("./utils/strings"),g=n("./zlib/messages"),x=n("./zlib/zstream"),N=Object.prototype.toString,C=0,A=-1,_=0,R=8;function $(S){if(!(this instanceof $))return new $(S);this.options=d.assign({level:A,method:R,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},S||{});var P=this.options;P.raw&&0<P.windowBits?P.windowBits=-P.windowBits:P.gzip&&0<P.windowBits&&P.windowBits<16&&(P.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new x,this.strm.avail_out=0;var O=c.deflateInit2(this.strm,P.level,P.method,P.windowBits,P.memLevel,P.strategy);if(O!==C)throw new Error(g[O]);if(P.header&&c.deflateSetHeader(this.strm,P.header),P.dictionary){var K;if(K=typeof P.dictionary=="string"?h.string2buf(P.dictionary):N.call(P.dictionary)==="[object ArrayBuffer]"?new Uint8Array(P.dictionary):P.dictionary,(O=c.deflateSetDictionary(this.strm,K))!==C)throw new Error(g[O]);this._dict_set=!0}}function L(S,P){var O=new $(P);if(O.push(S,!0),O.err)throw O.msg||g[O.err];return O.result}$.prototype.push=function(S,P){var O,K,Q=this.strm,ue=this.options.chunkSize;if(this.ended)return!1;K=P===~~P?P:P===!0?4:0,typeof S=="string"?Q.input=h.string2buf(S):N.call(S)==="[object ArrayBuffer]"?Q.input=new Uint8Array(S):Q.input=S,Q.next_in=0,Q.avail_in=Q.input.length;do{if(Q.avail_out===0&&(Q.output=new d.Buf8(ue),Q.next_out=0,Q.avail_out=ue),(O=c.deflate(Q,K))!==1&&O!==C)return this.onEnd(O),!(this.ended=!0);Q.avail_out!==0&&(Q.avail_in!==0||K!==4&&K!==2)||(this.options.to==="string"?this.onData(h.buf2binstring(d.shrinkBuf(Q.output,Q.next_out))):this.onData(d.shrinkBuf(Q.output,Q.next_out)))}while((0<Q.avail_in||Q.avail_out===0)&&O!==1);return K===4?(O=c.deflateEnd(this.strm),this.onEnd(O),this.ended=!0,O===C):K!==2||(this.onEnd(C),!(Q.avail_out=0))},$.prototype.onData=function(S){this.chunks.push(S)},$.prototype.onEnd=function(S){S===C&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=S,this.msg=this.strm.msg},a.Deflate=$,a.deflate=L,a.deflateRaw=function(S,P){return(P=P||{}).raw=!0,L(S,P)},a.gzip=function(S,P){return(P=P||{}).gzip=!0,L(S,P)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,s,a){var c=n("./zlib/inflate"),d=n("./utils/common"),h=n("./utils/strings"),g=n("./zlib/constants"),x=n("./zlib/messages"),N=n("./zlib/zstream"),C=n("./zlib/gzheader"),A=Object.prototype.toString;function _($){if(!(this instanceof _))return new _($);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},$||{});var L=this.options;L.raw&&0<=L.windowBits&&L.windowBits<16&&(L.windowBits=-L.windowBits,L.windowBits===0&&(L.windowBits=-15)),!(0<=L.windowBits&&L.windowBits<16)||$&&$.windowBits||(L.windowBits+=32),15<L.windowBits&&L.windowBits<48&&!(15&L.windowBits)&&(L.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new N,this.strm.avail_out=0;var S=c.inflateInit2(this.strm,L.windowBits);if(S!==g.Z_OK)throw new Error(x[S]);this.header=new C,c.inflateGetHeader(this.strm,this.header)}function R($,L){var S=new _(L);if(S.push($,!0),S.err)throw S.msg||x[S.err];return S.result}_.prototype.push=function($,L){var S,P,O,K,Q,ue,oe=this.strm,we=this.options.chunkSize,he=this.options.dictionary,ze=!1;if(this.ended)return!1;P=L===~~L?L:L===!0?g.Z_FINISH:g.Z_NO_FLUSH,typeof $=="string"?oe.input=h.binstring2buf($):A.call($)==="[object ArrayBuffer]"?oe.input=new Uint8Array($):oe.input=$,oe.next_in=0,oe.avail_in=oe.input.length;do{if(oe.avail_out===0&&(oe.output=new d.Buf8(we),oe.next_out=0,oe.avail_out=we),(S=c.inflate(oe,g.Z_NO_FLUSH))===g.Z_NEED_DICT&&he&&(ue=typeof he=="string"?h.string2buf(he):A.call(he)==="[object ArrayBuffer]"?new Uint8Array(he):he,S=c.inflateSetDictionary(this.strm,ue)),S===g.Z_BUF_ERROR&&ze===!0&&(S=g.Z_OK,ze=!1),S!==g.Z_STREAM_END&&S!==g.Z_OK)return this.onEnd(S),!(this.ended=!0);oe.next_out&&(oe.avail_out!==0&&S!==g.Z_STREAM_END&&(oe.avail_in!==0||P!==g.Z_FINISH&&P!==g.Z_SYNC_FLUSH)||(this.options.to==="string"?(O=h.utf8border(oe.output,oe.next_out),K=oe.next_out-O,Q=h.buf2string(oe.output,O),oe.next_out=K,oe.avail_out=we-K,K&&d.arraySet(oe.output,oe.output,O,K,0),this.onData(Q)):this.onData(d.shrinkBuf(oe.output,oe.next_out)))),oe.avail_in===0&&oe.avail_out===0&&(ze=!0)}while((0<oe.avail_in||oe.avail_out===0)&&S!==g.Z_STREAM_END);return S===g.Z_STREAM_END&&(P=g.Z_FINISH),P===g.Z_FINISH?(S=c.inflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===g.Z_OK):P!==g.Z_SYNC_FLUSH||(this.onEnd(g.Z_OK),!(oe.avail_out=0))},_.prototype.onData=function($){this.chunks.push($)},_.prototype.onEnd=function($){$===g.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=$,this.msg=this.strm.msg},a.Inflate=_,a.inflate=R,a.inflateRaw=function($,L){return(L=L||{}).raw=!0,R($,L)},a.ungzip=R},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,s,a){var c=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";a.assign=function(g){for(var x=Array.prototype.slice.call(arguments,1);x.length;){var N=x.shift();if(N){if(typeof N!="object")throw new TypeError(N+"must be non-object");for(var C in N)N.hasOwnProperty(C)&&(g[C]=N[C])}}return g},a.shrinkBuf=function(g,x){return g.length===x?g:g.subarray?g.subarray(0,x):(g.length=x,g)};var d={arraySet:function(g,x,N,C,A){if(x.subarray&&g.subarray)g.set(x.subarray(N,N+C),A);else for(var _=0;_<C;_++)g[A+_]=x[N+_]},flattenChunks:function(g){var x,N,C,A,_,R;for(x=C=0,N=g.length;x<N;x++)C+=g[x].length;for(R=new Uint8Array(C),x=A=0,N=g.length;x<N;x++)_=g[x],R.set(_,A),A+=_.length;return R}},h={arraySet:function(g,x,N,C,A){for(var _=0;_<C;_++)g[A+_]=x[N+_]},flattenChunks:function(g){return[].concat.apply([],g)}};a.setTyped=function(g){g?(a.Buf8=Uint8Array,a.Buf16=Uint16Array,a.Buf32=Int32Array,a.assign(a,d)):(a.Buf8=Array,a.Buf16=Array,a.Buf32=Array,a.assign(a,h))},a.setTyped(c)},{}],42:[function(n,s,a){var c=n("./common"),d=!0,h=!0;try{String.fromCharCode.apply(null,[0])}catch{d=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{h=!1}for(var g=new c.Buf8(256),x=0;x<256;x++)g[x]=252<=x?6:248<=x?5:240<=x?4:224<=x?3:192<=x?2:1;function N(C,A){if(A<65537&&(C.subarray&&h||!C.subarray&&d))return String.fromCharCode.apply(null,c.shrinkBuf(C,A));for(var _="",R=0;R<A;R++)_+=String.fromCharCode(C[R]);return _}g[254]=g[254]=1,a.string2buf=function(C){var A,_,R,$,L,S=C.length,P=0;for($=0;$<S;$++)(64512&(_=C.charCodeAt($)))==55296&&$+1<S&&(64512&(R=C.charCodeAt($+1)))==56320&&(_=65536+(_-55296<<10)+(R-56320),$++),P+=_<128?1:_<2048?2:_<65536?3:4;for(A=new c.Buf8(P),$=L=0;L<P;$++)(64512&(_=C.charCodeAt($)))==55296&&$+1<S&&(64512&(R=C.charCodeAt($+1)))==56320&&(_=65536+(_-55296<<10)+(R-56320),$++),_<128?A[L++]=_:(_<2048?A[L++]=192|_>>>6:(_<65536?A[L++]=224|_>>>12:(A[L++]=240|_>>>18,A[L++]=128|_>>>12&63),A[L++]=128|_>>>6&63),A[L++]=128|63&_);return A},a.buf2binstring=function(C){return N(C,C.length)},a.binstring2buf=function(C){for(var A=new c.Buf8(C.length),_=0,R=A.length;_<R;_++)A[_]=C.charCodeAt(_);return A},a.buf2string=function(C,A){var _,R,$,L,S=A||C.length,P=new Array(2*S);for(_=R=0;_<S;)if(($=C[_++])<128)P[R++]=$;else if(4<(L=g[$]))P[R++]=65533,_+=L-1;else{for($&=L===2?31:L===3?15:7;1<L&&_<S;)$=$<<6|63&C[_++],L--;1<L?P[R++]=65533:$<65536?P[R++]=$:($-=65536,P[R++]=55296|$>>10&1023,P[R++]=56320|1023&$)}return N(P,R)},a.utf8border=function(C,A){var _;for((A=A||C.length)>C.length&&(A=C.length),_=A-1;0<=_&&(192&C[_])==128;)_--;return _<0||_===0?A:_+g[C[_]]>A?_:A}},{"./common":41}],43:[function(n,s,a){s.exports=function(c,d,h,g){for(var x=65535&c|0,N=c>>>16&65535|0,C=0;h!==0;){for(h-=C=2e3<h?2e3:h;N=N+(x=x+d[g++]|0)|0,--C;);x%=65521,N%=65521}return x|N<<16|0}},{}],44:[function(n,s,a){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,s,a){var c=function(){for(var d,h=[],g=0;g<256;g++){d=g;for(var x=0;x<8;x++)d=1&d?3988292384^d>>>1:d>>>1;h[g]=d}return h}();s.exports=function(d,h,g,x){var N=c,C=x+g;d^=-1;for(var A=x;A<C;A++)d=d>>>8^N[255&(d^h[A])];return-1^d}},{}],46:[function(n,s,a){var c,d=n("../utils/common"),h=n("./trees"),g=n("./adler32"),x=n("./crc32"),N=n("./messages"),C=0,A=4,_=0,R=-2,$=-1,L=4,S=2,P=8,O=9,K=286,Q=30,ue=19,oe=2*K+1,we=15,he=3,ze=258,ot=ze+he+1,re=42,Se=113,D=1,Me=2,Ut=3,je=4;function _e(E,Ce){return E.msg=N[Ce],Ce}function be(E){return(E<<1)-(4<E?9:0)}function Xe(E){for(var Ce=E.length;0<=--Ce;)E[Ce]=0}function de(E){var Ce=E.state,Ee=Ce.pending;Ee>E.avail_out&&(Ee=E.avail_out),Ee!==0&&(d.arraySet(E.output,Ce.pending_buf,Ce.pending_out,Ee,E.next_out),E.next_out+=Ee,Ce.pending_out+=Ee,E.total_out+=Ee,E.avail_out-=Ee,Ce.pending-=Ee,Ce.pending===0&&(Ce.pending_out=0))}function fe(E,Ce){h._tr_flush_block(E,0<=E.block_start?E.block_start:-1,E.strstart-E.block_start,Ce),E.block_start=E.strstart,de(E.strm)}function Ge(E,Ce){E.pending_buf[E.pending++]=Ce}function gt(E,Ce){E.pending_buf[E.pending++]=Ce>>>8&255,E.pending_buf[E.pending++]=255&Ce}function We(E,Ce){var Ee,ee,q=E.max_chain_length,le=E.strstart,Fe=E.prev_length,Oe=E.nice_match,ke=E.strstart>E.w_size-ot?E.strstart-(E.w_size-ot):0,at=E.window,_t=E.w_mask,tt=E.prev,Ye=E.strstart+ze,kr=at[le+Fe-1],Ft=at[le+Fe];E.prev_length>=E.good_match&&(q>>=2),Oe>E.lookahead&&(Oe=E.lookahead);do if(at[(Ee=Ce)+Fe]===Ft&&at[Ee+Fe-1]===kr&&at[Ee]===at[le]&&at[++Ee]===at[le+1]){le+=2,Ee++;do;while(at[++le]===at[++Ee]&&at[++le]===at[++Ee]&&at[++le]===at[++Ee]&&at[++le]===at[++Ee]&&at[++le]===at[++Ee]&&at[++le]===at[++Ee]&&at[++le]===at[++Ee]&&at[++le]===at[++Ee]&&le<Ye);if(ee=ze-(Ye-le),le=Ye-ze,Fe<ee){if(E.match_start=Ce,Oe<=(Fe=ee))break;kr=at[le+Fe-1],Ft=at[le+Fe]}}while((Ce=tt[Ce&_t])>ke&&--q!=0);return Fe<=E.lookahead?Fe:E.lookahead}function Ir(E){var Ce,Ee,ee,q,le,Fe,Oe,ke,at,_t,tt=E.w_size;do{if(q=E.window_size-E.lookahead-E.strstart,E.strstart>=tt+(tt-ot)){for(d.arraySet(E.window,E.window,tt,tt,0),E.match_start-=tt,E.strstart-=tt,E.block_start-=tt,Ce=Ee=E.hash_size;ee=E.head[--Ce],E.head[Ce]=tt<=ee?ee-tt:0,--Ee;);for(Ce=Ee=tt;ee=E.prev[--Ce],E.prev[Ce]=tt<=ee?ee-tt:0,--Ee;);q+=tt}if(E.strm.avail_in===0)break;if(Fe=E.strm,Oe=E.window,ke=E.strstart+E.lookahead,at=q,_t=void 0,_t=Fe.avail_in,at<_t&&(_t=at),Ee=_t===0?0:(Fe.avail_in-=_t,d.arraySet(Oe,Fe.input,Fe.next_in,_t,ke),Fe.state.wrap===1?Fe.adler=g(Fe.adler,Oe,_t,ke):Fe.state.wrap===2&&(Fe.adler=x(Fe.adler,Oe,_t,ke)),Fe.next_in+=_t,Fe.total_in+=_t,_t),E.lookahead+=Ee,E.lookahead+E.insert>=he)for(le=E.strstart-E.insert,E.ins_h=E.window[le],E.ins_h=(E.ins_h<<E.hash_shift^E.window[le+1])&E.hash_mask;E.insert&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[le+he-1])&E.hash_mask,E.prev[le&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=le,le++,E.insert--,!(E.lookahead+E.insert<he)););}while(E.lookahead<ot&&E.strm.avail_in!==0)}function Qr(E,Ce){for(var Ee,ee;;){if(E.lookahead<ot){if(Ir(E),E.lookahead<ot&&Ce===C)return D;if(E.lookahead===0)break}if(Ee=0,E.lookahead>=he&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+he-1])&E.hash_mask,Ee=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),Ee!==0&&E.strstart-Ee<=E.w_size-ot&&(E.match_length=We(E,Ee)),E.match_length>=he)if(ee=h._tr_tally(E,E.strstart-E.match_start,E.match_length-he),E.lookahead-=E.match_length,E.match_length<=E.max_lazy_match&&E.lookahead>=he){for(E.match_length--;E.strstart++,E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+he-1])&E.hash_mask,Ee=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart,--E.match_length!=0;);E.strstart++}else E.strstart+=E.match_length,E.match_length=0,E.ins_h=E.window[E.strstart],E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+1])&E.hash_mask;else ee=h._tr_tally(E,0,E.window[E.strstart]),E.lookahead--,E.strstart++;if(ee&&(fe(E,!1),E.strm.avail_out===0))return D}return E.insert=E.strstart<he-1?E.strstart:he-1,Ce===A?(fe(E,!0),E.strm.avail_out===0?Ut:je):E.last_lit&&(fe(E,!1),E.strm.avail_out===0)?D:Me}function br(E,Ce){for(var Ee,ee,q;;){if(E.lookahead<ot){if(Ir(E),E.lookahead<ot&&Ce===C)return D;if(E.lookahead===0)break}if(Ee=0,E.lookahead>=he&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+he-1])&E.hash_mask,Ee=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),E.prev_length=E.match_length,E.prev_match=E.match_start,E.match_length=he-1,Ee!==0&&E.prev_length<E.max_lazy_match&&E.strstart-Ee<=E.w_size-ot&&(E.match_length=We(E,Ee),E.match_length<=5&&(E.strategy===1||E.match_length===he&&4096<E.strstart-E.match_start)&&(E.match_length=he-1)),E.prev_length>=he&&E.match_length<=E.prev_length){for(q=E.strstart+E.lookahead-he,ee=h._tr_tally(E,E.strstart-1-E.prev_match,E.prev_length-he),E.lookahead-=E.prev_length-1,E.prev_length-=2;++E.strstart<=q&&(E.ins_h=(E.ins_h<<E.hash_shift^E.window[E.strstart+he-1])&E.hash_mask,Ee=E.prev[E.strstart&E.w_mask]=E.head[E.ins_h],E.head[E.ins_h]=E.strstart),--E.prev_length!=0;);if(E.match_available=0,E.match_length=he-1,E.strstart++,ee&&(fe(E,!1),E.strm.avail_out===0))return D}else if(E.match_available){if((ee=h._tr_tally(E,0,E.window[E.strstart-1]))&&fe(E,!1),E.strstart++,E.lookahead--,E.strm.avail_out===0)return D}else E.match_available=1,E.strstart++,E.lookahead--}return E.match_available&&(ee=h._tr_tally(E,0,E.window[E.strstart-1]),E.match_available=0),E.insert=E.strstart<he-1?E.strstart:he-1,Ce===A?(fe(E,!0),E.strm.avail_out===0?Ut:je):E.last_lit&&(fe(E,!1),E.strm.avail_out===0)?D:Me}function $r(E,Ce,Ee,ee,q){this.good_length=E,this.max_lazy=Ce,this.nice_length=Ee,this.max_chain=ee,this.func=q}function mn(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*oe),this.dyn_dtree=new d.Buf16(2*(2*Q+1)),this.bl_tree=new d.Buf16(2*(2*ue+1)),Xe(this.dyn_ltree),Xe(this.dyn_dtree),Xe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16(we+1),this.heap=new d.Buf16(2*K+1),Xe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*K+1),Xe(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Kr(E){var Ce;return E&&E.state?(E.total_in=E.total_out=0,E.data_type=S,(Ce=E.state).pending=0,Ce.pending_out=0,Ce.wrap<0&&(Ce.wrap=-Ce.wrap),Ce.status=Ce.wrap?re:Se,E.adler=Ce.wrap===2?0:1,Ce.last_flush=C,h._tr_init(Ce),_):_e(E,R)}function ns(E){var Ce=Kr(E);return Ce===_&&function(Ee){Ee.window_size=2*Ee.w_size,Xe(Ee.head),Ee.max_lazy_match=c[Ee.level].max_lazy,Ee.good_match=c[Ee.level].good_length,Ee.nice_match=c[Ee.level].nice_length,Ee.max_chain_length=c[Ee.level].max_chain,Ee.strstart=0,Ee.block_start=0,Ee.lookahead=0,Ee.insert=0,Ee.match_length=Ee.prev_length=he-1,Ee.match_available=0,Ee.ins_h=0}(E.state),Ce}function St(E,Ce,Ee,ee,q,le){if(!E)return R;var Fe=1;if(Ce===$&&(Ce=6),ee<0?(Fe=0,ee=-ee):15<ee&&(Fe=2,ee-=16),q<1||O<q||Ee!==P||ee<8||15<ee||Ce<0||9<Ce||le<0||L<le)return _e(E,R);ee===8&&(ee=9);var Oe=new mn;return(E.state=Oe).strm=E,Oe.wrap=Fe,Oe.gzhead=null,Oe.w_bits=ee,Oe.w_size=1<<Oe.w_bits,Oe.w_mask=Oe.w_size-1,Oe.hash_bits=q+7,Oe.hash_size=1<<Oe.hash_bits,Oe.hash_mask=Oe.hash_size-1,Oe.hash_shift=~~((Oe.hash_bits+he-1)/he),Oe.window=new d.Buf8(2*Oe.w_size),Oe.head=new d.Buf16(Oe.hash_size),Oe.prev=new d.Buf16(Oe.w_size),Oe.lit_bufsize=1<<q+6,Oe.pending_buf_size=4*Oe.lit_bufsize,Oe.pending_buf=new d.Buf8(Oe.pending_buf_size),Oe.d_buf=1*Oe.lit_bufsize,Oe.l_buf=3*Oe.lit_bufsize,Oe.level=Ce,Oe.strategy=le,Oe.method=Ee,ns(E)}c=[new $r(0,0,0,0,function(E,Ce){var Ee=65535;for(Ee>E.pending_buf_size-5&&(Ee=E.pending_buf_size-5);;){if(E.lookahead<=1){if(Ir(E),E.lookahead===0&&Ce===C)return D;if(E.lookahead===0)break}E.strstart+=E.lookahead,E.lookahead=0;var ee=E.block_start+Ee;if((E.strstart===0||E.strstart>=ee)&&(E.lookahead=E.strstart-ee,E.strstart=ee,fe(E,!1),E.strm.avail_out===0)||E.strstart-E.block_start>=E.w_size-ot&&(fe(E,!1),E.strm.avail_out===0))return D}return E.insert=0,Ce===A?(fe(E,!0),E.strm.avail_out===0?Ut:je):(E.strstart>E.block_start&&(fe(E,!1),E.strm.avail_out),D)}),new $r(4,4,8,4,Qr),new $r(4,5,16,8,Qr),new $r(4,6,32,32,Qr),new $r(4,4,16,16,br),new $r(8,16,32,32,br),new $r(8,16,128,128,br),new $r(8,32,128,256,br),new $r(32,128,258,1024,br),new $r(32,258,258,4096,br)],a.deflateInit=function(E,Ce){return St(E,Ce,P,15,8,0)},a.deflateInit2=St,a.deflateReset=ns,a.deflateResetKeep=Kr,a.deflateSetHeader=function(E,Ce){return E&&E.state?E.state.wrap!==2?R:(E.state.gzhead=Ce,_):R},a.deflate=function(E,Ce){var Ee,ee,q,le;if(!E||!E.state||5<Ce||Ce<0)return E?_e(E,R):R;if(ee=E.state,!E.output||!E.input&&E.avail_in!==0||ee.status===666&&Ce!==A)return _e(E,E.avail_out===0?-5:R);if(ee.strm=E,Ee=ee.last_flush,ee.last_flush=Ce,ee.status===re)if(ee.wrap===2)E.adler=0,Ge(ee,31),Ge(ee,139),Ge(ee,8),ee.gzhead?(Ge(ee,(ee.gzhead.text?1:0)+(ee.gzhead.hcrc?2:0)+(ee.gzhead.extra?4:0)+(ee.gzhead.name?8:0)+(ee.gzhead.comment?16:0)),Ge(ee,255&ee.gzhead.time),Ge(ee,ee.gzhead.time>>8&255),Ge(ee,ee.gzhead.time>>16&255),Ge(ee,ee.gzhead.time>>24&255),Ge(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),Ge(ee,255&ee.gzhead.os),ee.gzhead.extra&&ee.gzhead.extra.length&&(Ge(ee,255&ee.gzhead.extra.length),Ge(ee,ee.gzhead.extra.length>>8&255)),ee.gzhead.hcrc&&(E.adler=x(E.adler,ee.pending_buf,ee.pending,0)),ee.gzindex=0,ee.status=69):(Ge(ee,0),Ge(ee,0),Ge(ee,0),Ge(ee,0),Ge(ee,0),Ge(ee,ee.level===9?2:2<=ee.strategy||ee.level<2?4:0),Ge(ee,3),ee.status=Se);else{var Fe=P+(ee.w_bits-8<<4)<<8;Fe|=(2<=ee.strategy||ee.level<2?0:ee.level<6?1:ee.level===6?2:3)<<6,ee.strstart!==0&&(Fe|=32),Fe+=31-Fe%31,ee.status=Se,gt(ee,Fe),ee.strstart!==0&&(gt(ee,E.adler>>>16),gt(ee,65535&E.adler)),E.adler=1}if(ee.status===69)if(ee.gzhead.extra){for(q=ee.pending;ee.gzindex<(65535&ee.gzhead.extra.length)&&(ee.pending!==ee.pending_buf_size||(ee.gzhead.hcrc&&ee.pending>q&&(E.adler=x(E.adler,ee.pending_buf,ee.pending-q,q)),de(E),q=ee.pending,ee.pending!==ee.pending_buf_size));)Ge(ee,255&ee.gzhead.extra[ee.gzindex]),ee.gzindex++;ee.gzhead.hcrc&&ee.pending>q&&(E.adler=x(E.adler,ee.pending_buf,ee.pending-q,q)),ee.gzindex===ee.gzhead.extra.length&&(ee.gzindex=0,ee.status=73)}else ee.status=73;if(ee.status===73)if(ee.gzhead.name){q=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>q&&(E.adler=x(E.adler,ee.pending_buf,ee.pending-q,q)),de(E),q=ee.pending,ee.pending===ee.pending_buf_size)){le=1;break}le=ee.gzindex<ee.gzhead.name.length?255&ee.gzhead.name.charCodeAt(ee.gzindex++):0,Ge(ee,le)}while(le!==0);ee.gzhead.hcrc&&ee.pending>q&&(E.adler=x(E.adler,ee.pending_buf,ee.pending-q,q)),le===0&&(ee.gzindex=0,ee.status=91)}else ee.status=91;if(ee.status===91)if(ee.gzhead.comment){q=ee.pending;do{if(ee.pending===ee.pending_buf_size&&(ee.gzhead.hcrc&&ee.pending>q&&(E.adler=x(E.adler,ee.pending_buf,ee.pending-q,q)),de(E),q=ee.pending,ee.pending===ee.pending_buf_size)){le=1;break}le=ee.gzindex<ee.gzhead.comment.length?255&ee.gzhead.comment.charCodeAt(ee.gzindex++):0,Ge(ee,le)}while(le!==0);ee.gzhead.hcrc&&ee.pending>q&&(E.adler=x(E.adler,ee.pending_buf,ee.pending-q,q)),le===0&&(ee.status=103)}else ee.status=103;if(ee.status===103&&(ee.gzhead.hcrc?(ee.pending+2>ee.pending_buf_size&&de(E),ee.pending+2<=ee.pending_buf_size&&(Ge(ee,255&E.adler),Ge(ee,E.adler>>8&255),E.adler=0,ee.status=Se)):ee.status=Se),ee.pending!==0){if(de(E),E.avail_out===0)return ee.last_flush=-1,_}else if(E.avail_in===0&&be(Ce)<=be(Ee)&&Ce!==A)return _e(E,-5);if(ee.status===666&&E.avail_in!==0)return _e(E,-5);if(E.avail_in!==0||ee.lookahead!==0||Ce!==C&&ee.status!==666){var Oe=ee.strategy===2?function(ke,at){for(var _t;;){if(ke.lookahead===0&&(Ir(ke),ke.lookahead===0)){if(at===C)return D;break}if(ke.match_length=0,_t=h._tr_tally(ke,0,ke.window[ke.strstart]),ke.lookahead--,ke.strstart++,_t&&(fe(ke,!1),ke.strm.avail_out===0))return D}return ke.insert=0,at===A?(fe(ke,!0),ke.strm.avail_out===0?Ut:je):ke.last_lit&&(fe(ke,!1),ke.strm.avail_out===0)?D:Me}(ee,Ce):ee.strategy===3?function(ke,at){for(var _t,tt,Ye,kr,Ft=ke.window;;){if(ke.lookahead<=ze){if(Ir(ke),ke.lookahead<=ze&&at===C)return D;if(ke.lookahead===0)break}if(ke.match_length=0,ke.lookahead>=he&&0<ke.strstart&&(tt=Ft[Ye=ke.strstart-1])===Ft[++Ye]&&tt===Ft[++Ye]&&tt===Ft[++Ye]){kr=ke.strstart+ze;do;while(tt===Ft[++Ye]&&tt===Ft[++Ye]&&tt===Ft[++Ye]&&tt===Ft[++Ye]&&tt===Ft[++Ye]&&tt===Ft[++Ye]&&tt===Ft[++Ye]&&tt===Ft[++Ye]&&Ye<kr);ke.match_length=ze-(kr-Ye),ke.match_length>ke.lookahead&&(ke.match_length=ke.lookahead)}if(ke.match_length>=he?(_t=h._tr_tally(ke,1,ke.match_length-he),ke.lookahead-=ke.match_length,ke.strstart+=ke.match_length,ke.match_length=0):(_t=h._tr_tally(ke,0,ke.window[ke.strstart]),ke.lookahead--,ke.strstart++),_t&&(fe(ke,!1),ke.strm.avail_out===0))return D}return ke.insert=0,at===A?(fe(ke,!0),ke.strm.avail_out===0?Ut:je):ke.last_lit&&(fe(ke,!1),ke.strm.avail_out===0)?D:Me}(ee,Ce):c[ee.level].func(ee,Ce);if(Oe!==Ut&&Oe!==je||(ee.status=666),Oe===D||Oe===Ut)return E.avail_out===0&&(ee.last_flush=-1),_;if(Oe===Me&&(Ce===1?h._tr_align(ee):Ce!==5&&(h._tr_stored_block(ee,0,0,!1),Ce===3&&(Xe(ee.head),ee.lookahead===0&&(ee.strstart=0,ee.block_start=0,ee.insert=0))),de(E),E.avail_out===0))return ee.last_flush=-1,_}return Ce!==A?_:ee.wrap<=0?1:(ee.wrap===2?(Ge(ee,255&E.adler),Ge(ee,E.adler>>8&255),Ge(ee,E.adler>>16&255),Ge(ee,E.adler>>24&255),Ge(ee,255&E.total_in),Ge(ee,E.total_in>>8&255),Ge(ee,E.total_in>>16&255),Ge(ee,E.total_in>>24&255)):(gt(ee,E.adler>>>16),gt(ee,65535&E.adler)),de(E),0<ee.wrap&&(ee.wrap=-ee.wrap),ee.pending!==0?_:1)},a.deflateEnd=function(E){var Ce;return E&&E.state?(Ce=E.state.status)!==re&&Ce!==69&&Ce!==73&&Ce!==91&&Ce!==103&&Ce!==Se&&Ce!==666?_e(E,R):(E.state=null,Ce===Se?_e(E,-3):_):R},a.deflateSetDictionary=function(E,Ce){var Ee,ee,q,le,Fe,Oe,ke,at,_t=Ce.length;if(!E||!E.state||(le=(Ee=E.state).wrap)===2||le===1&&Ee.status!==re||Ee.lookahead)return R;for(le===1&&(E.adler=g(E.adler,Ce,_t,0)),Ee.wrap=0,_t>=Ee.w_size&&(le===0&&(Xe(Ee.head),Ee.strstart=0,Ee.block_start=0,Ee.insert=0),at=new d.Buf8(Ee.w_size),d.arraySet(at,Ce,_t-Ee.w_size,Ee.w_size,0),Ce=at,_t=Ee.w_size),Fe=E.avail_in,Oe=E.next_in,ke=E.input,E.avail_in=_t,E.next_in=0,E.input=Ce,Ir(Ee);Ee.lookahead>=he;){for(ee=Ee.strstart,q=Ee.lookahead-(he-1);Ee.ins_h=(Ee.ins_h<<Ee.hash_shift^Ee.window[ee+he-1])&Ee.hash_mask,Ee.prev[ee&Ee.w_mask]=Ee.head[Ee.ins_h],Ee.head[Ee.ins_h]=ee,ee++,--q;);Ee.strstart=ee,Ee.lookahead=he-1,Ir(Ee)}return Ee.strstart+=Ee.lookahead,Ee.block_start=Ee.strstart,Ee.insert=Ee.lookahead,Ee.lookahead=0,Ee.match_length=Ee.prev_length=he-1,Ee.match_available=0,E.next_in=Oe,E.input=ke,E.avail_in=Fe,Ee.wrap=le,_},a.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,s,a){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,s,a){s.exports=function(c,d){var h,g,x,N,C,A,_,R,$,L,S,P,O,K,Q,ue,oe,we,he,ze,ot,re,Se,D,Me;h=c.state,g=c.next_in,D=c.input,x=g+(c.avail_in-5),N=c.next_out,Me=c.output,C=N-(d-c.avail_out),A=N+(c.avail_out-257),_=h.dmax,R=h.wsize,$=h.whave,L=h.wnext,S=h.window,P=h.hold,O=h.bits,K=h.lencode,Q=h.distcode,ue=(1<<h.lenbits)-1,oe=(1<<h.distbits)-1;e:do{O<15&&(P+=D[g++]<<O,O+=8,P+=D[g++]<<O,O+=8),we=K[P&ue];t:for(;;){if(P>>>=he=we>>>24,O-=he,(he=we>>>16&255)===0)Me[N++]=65535&we;else{if(!(16&he)){if(!(64&he)){we=K[(65535&we)+(P&(1<<he)-1)];continue t}if(32&he){h.mode=12;break e}c.msg="invalid literal/length code",h.mode=30;break e}ze=65535&we,(he&=15)&&(O<he&&(P+=D[g++]<<O,O+=8),ze+=P&(1<<he)-1,P>>>=he,O-=he),O<15&&(P+=D[g++]<<O,O+=8,P+=D[g++]<<O,O+=8),we=Q[P&oe];r:for(;;){if(P>>>=he=we>>>24,O-=he,!(16&(he=we>>>16&255))){if(!(64&he)){we=Q[(65535&we)+(P&(1<<he)-1)];continue r}c.msg="invalid distance code",h.mode=30;break e}if(ot=65535&we,O<(he&=15)&&(P+=D[g++]<<O,(O+=8)<he&&(P+=D[g++]<<O,O+=8)),_<(ot+=P&(1<<he)-1)){c.msg="invalid distance too far back",h.mode=30;break e}if(P>>>=he,O-=he,(he=N-C)<ot){if($<(he=ot-he)&&h.sane){c.msg="invalid distance too far back",h.mode=30;break e}if(Se=S,(re=0)===L){if(re+=R-he,he<ze){for(ze-=he;Me[N++]=S[re++],--he;);re=N-ot,Se=Me}}else if(L<he){if(re+=R+L-he,(he-=L)<ze){for(ze-=he;Me[N++]=S[re++],--he;);if(re=0,L<ze){for(ze-=he=L;Me[N++]=S[re++],--he;);re=N-ot,Se=Me}}}else if(re+=L-he,he<ze){for(ze-=he;Me[N++]=S[re++],--he;);re=N-ot,Se=Me}for(;2<ze;)Me[N++]=Se[re++],Me[N++]=Se[re++],Me[N++]=Se[re++],ze-=3;ze&&(Me[N++]=Se[re++],1<ze&&(Me[N++]=Se[re++]))}else{for(re=N-ot;Me[N++]=Me[re++],Me[N++]=Me[re++],Me[N++]=Me[re++],2<(ze-=3););ze&&(Me[N++]=Me[re++],1<ze&&(Me[N++]=Me[re++]))}break}}break}}while(g<x&&N<A);g-=ze=O>>3,P&=(1<<(O-=ze<<3))-1,c.next_in=g,c.next_out=N,c.avail_in=g<x?x-g+5:5-(g-x),c.avail_out=N<A?A-N+257:257-(N-A),h.hold=P,h.bits=O}},{}],49:[function(n,s,a){var c=n("../utils/common"),d=n("./adler32"),h=n("./crc32"),g=n("./inffast"),x=n("./inftrees"),N=1,C=2,A=0,_=-2,R=1,$=852,L=592;function S(re){return(re>>>24&255)+(re>>>8&65280)+((65280&re)<<8)+((255&re)<<24)}function P(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new c.Buf16(320),this.work=new c.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function O(re){var Se;return re&&re.state?(Se=re.state,re.total_in=re.total_out=Se.total=0,re.msg="",Se.wrap&&(re.adler=1&Se.wrap),Se.mode=R,Se.last=0,Se.havedict=0,Se.dmax=32768,Se.head=null,Se.hold=0,Se.bits=0,Se.lencode=Se.lendyn=new c.Buf32($),Se.distcode=Se.distdyn=new c.Buf32(L),Se.sane=1,Se.back=-1,A):_}function K(re){var Se;return re&&re.state?((Se=re.state).wsize=0,Se.whave=0,Se.wnext=0,O(re)):_}function Q(re,Se){var D,Me;return re&&re.state?(Me=re.state,Se<0?(D=0,Se=-Se):(D=1+(Se>>4),Se<48&&(Se&=15)),Se&&(Se<8||15<Se)?_:(Me.window!==null&&Me.wbits!==Se&&(Me.window=null),Me.wrap=D,Me.wbits=Se,K(re))):_}function ue(re,Se){var D,Me;return re?(Me=new P,(re.state=Me).window=null,(D=Q(re,Se))!==A&&(re.state=null),D):_}var oe,we,he=!0;function ze(re){if(he){var Se;for(oe=new c.Buf32(512),we=new c.Buf32(32),Se=0;Se<144;)re.lens[Se++]=8;for(;Se<256;)re.lens[Se++]=9;for(;Se<280;)re.lens[Se++]=7;for(;Se<288;)re.lens[Se++]=8;for(x(N,re.lens,0,288,oe,0,re.work,{bits:9}),Se=0;Se<32;)re.lens[Se++]=5;x(C,re.lens,0,32,we,0,re.work,{bits:5}),he=!1}re.lencode=oe,re.lenbits=9,re.distcode=we,re.distbits=5}function ot(re,Se,D,Me){var Ut,je=re.state;return je.window===null&&(je.wsize=1<<je.wbits,je.wnext=0,je.whave=0,je.window=new c.Buf8(je.wsize)),Me>=je.wsize?(c.arraySet(je.window,Se,D-je.wsize,je.wsize,0),je.wnext=0,je.whave=je.wsize):(Me<(Ut=je.wsize-je.wnext)&&(Ut=Me),c.arraySet(je.window,Se,D-Me,Ut,je.wnext),(Me-=Ut)?(c.arraySet(je.window,Se,D-Me,Me,0),je.wnext=Me,je.whave=je.wsize):(je.wnext+=Ut,je.wnext===je.wsize&&(je.wnext=0),je.whave<je.wsize&&(je.whave+=Ut))),0}a.inflateReset=K,a.inflateReset2=Q,a.inflateResetKeep=O,a.inflateInit=function(re){return ue(re,15)},a.inflateInit2=ue,a.inflate=function(re,Se){var D,Me,Ut,je,_e,be,Xe,de,fe,Ge,gt,We,Ir,Qr,br,$r,mn,Kr,ns,St,E,Ce,Ee,ee,q=0,le=new c.Buf8(4),Fe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!re||!re.state||!re.output||!re.input&&re.avail_in!==0)return _;(D=re.state).mode===12&&(D.mode=13),_e=re.next_out,Ut=re.output,Xe=re.avail_out,je=re.next_in,Me=re.input,be=re.avail_in,de=D.hold,fe=D.bits,Ge=be,gt=Xe,Ce=A;e:for(;;)switch(D.mode){case R:if(D.wrap===0){D.mode=13;break}for(;fe<16;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if(2&D.wrap&&de===35615){le[D.check=0]=255&de,le[1]=de>>>8&255,D.check=h(D.check,le,2,0),fe=de=0,D.mode=2;break}if(D.flags=0,D.head&&(D.head.done=!1),!(1&D.wrap)||(((255&de)<<8)+(de>>8))%31){re.msg="incorrect header check",D.mode=30;break}if((15&de)!=8){re.msg="unknown compression method",D.mode=30;break}if(fe-=4,E=8+(15&(de>>>=4)),D.wbits===0)D.wbits=E;else if(E>D.wbits){re.msg="invalid window size",D.mode=30;break}D.dmax=1<<E,re.adler=D.check=1,D.mode=512&de?10:12,fe=de=0;break;case 2:for(;fe<16;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if(D.flags=de,(255&D.flags)!=8){re.msg="unknown compression method",D.mode=30;break}if(57344&D.flags){re.msg="unknown header flags set",D.mode=30;break}D.head&&(D.head.text=de>>8&1),512&D.flags&&(le[0]=255&de,le[1]=de>>>8&255,D.check=h(D.check,le,2,0)),fe=de=0,D.mode=3;case 3:for(;fe<32;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}D.head&&(D.head.time=de),512&D.flags&&(le[0]=255&de,le[1]=de>>>8&255,le[2]=de>>>16&255,le[3]=de>>>24&255,D.check=h(D.check,le,4,0)),fe=de=0,D.mode=4;case 4:for(;fe<16;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}D.head&&(D.head.xflags=255&de,D.head.os=de>>8),512&D.flags&&(le[0]=255&de,le[1]=de>>>8&255,D.check=h(D.check,le,2,0)),fe=de=0,D.mode=5;case 5:if(1024&D.flags){for(;fe<16;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}D.length=de,D.head&&(D.head.extra_len=de),512&D.flags&&(le[0]=255&de,le[1]=de>>>8&255,D.check=h(D.check,le,2,0)),fe=de=0}else D.head&&(D.head.extra=null);D.mode=6;case 6:if(1024&D.flags&&(be<(We=D.length)&&(We=be),We&&(D.head&&(E=D.head.extra_len-D.length,D.head.extra||(D.head.extra=new Array(D.head.extra_len)),c.arraySet(D.head.extra,Me,je,We,E)),512&D.flags&&(D.check=h(D.check,Me,We,je)),be-=We,je+=We,D.length-=We),D.length))break e;D.length=0,D.mode=7;case 7:if(2048&D.flags){if(be===0)break e;for(We=0;E=Me[je+We++],D.head&&E&&D.length<65536&&(D.head.name+=String.fromCharCode(E)),E&&We<be;);if(512&D.flags&&(D.check=h(D.check,Me,We,je)),be-=We,je+=We,E)break e}else D.head&&(D.head.name=null);D.length=0,D.mode=8;case 8:if(4096&D.flags){if(be===0)break e;for(We=0;E=Me[je+We++],D.head&&E&&D.length<65536&&(D.head.comment+=String.fromCharCode(E)),E&&We<be;);if(512&D.flags&&(D.check=h(D.check,Me,We,je)),be-=We,je+=We,E)break e}else D.head&&(D.head.comment=null);D.mode=9;case 9:if(512&D.flags){for(;fe<16;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if(de!==(65535&D.check)){re.msg="header crc mismatch",D.mode=30;break}fe=de=0}D.head&&(D.head.hcrc=D.flags>>9&1,D.head.done=!0),re.adler=D.check=0,D.mode=12;break;case 10:for(;fe<32;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}re.adler=D.check=S(de),fe=de=0,D.mode=11;case 11:if(D.havedict===0)return re.next_out=_e,re.avail_out=Xe,re.next_in=je,re.avail_in=be,D.hold=de,D.bits=fe,2;re.adler=D.check=1,D.mode=12;case 12:if(Se===5||Se===6)break e;case 13:if(D.last){de>>>=7&fe,fe-=7&fe,D.mode=27;break}for(;fe<3;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}switch(D.last=1&de,fe-=1,3&(de>>>=1)){case 0:D.mode=14;break;case 1:if(ze(D),D.mode=20,Se!==6)break;de>>>=2,fe-=2;break e;case 2:D.mode=17;break;case 3:re.msg="invalid block type",D.mode=30}de>>>=2,fe-=2;break;case 14:for(de>>>=7&fe,fe-=7&fe;fe<32;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if((65535&de)!=(de>>>16^65535)){re.msg="invalid stored block lengths",D.mode=30;break}if(D.length=65535&de,fe=de=0,D.mode=15,Se===6)break e;case 15:D.mode=16;case 16:if(We=D.length){if(be<We&&(We=be),Xe<We&&(We=Xe),We===0)break e;c.arraySet(Ut,Me,je,We,_e),be-=We,je+=We,Xe-=We,_e+=We,D.length-=We;break}D.mode=12;break;case 17:for(;fe<14;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if(D.nlen=257+(31&de),de>>>=5,fe-=5,D.ndist=1+(31&de),de>>>=5,fe-=5,D.ncode=4+(15&de),de>>>=4,fe-=4,286<D.nlen||30<D.ndist){re.msg="too many length or distance symbols",D.mode=30;break}D.have=0,D.mode=18;case 18:for(;D.have<D.ncode;){for(;fe<3;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}D.lens[Fe[D.have++]]=7&de,de>>>=3,fe-=3}for(;D.have<19;)D.lens[Fe[D.have++]]=0;if(D.lencode=D.lendyn,D.lenbits=7,Ee={bits:D.lenbits},Ce=x(0,D.lens,0,19,D.lencode,0,D.work,Ee),D.lenbits=Ee.bits,Ce){re.msg="invalid code lengths set",D.mode=30;break}D.have=0,D.mode=19;case 19:for(;D.have<D.nlen+D.ndist;){for(;$r=(q=D.lencode[de&(1<<D.lenbits)-1])>>>16&255,mn=65535&q,!((br=q>>>24)<=fe);){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if(mn<16)de>>>=br,fe-=br,D.lens[D.have++]=mn;else{if(mn===16){for(ee=br+2;fe<ee;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if(de>>>=br,fe-=br,D.have===0){re.msg="invalid bit length repeat",D.mode=30;break}E=D.lens[D.have-1],We=3+(3&de),de>>>=2,fe-=2}else if(mn===17){for(ee=br+3;fe<ee;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}fe-=br,E=0,We=3+(7&(de>>>=br)),de>>>=3,fe-=3}else{for(ee=br+7;fe<ee;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}fe-=br,E=0,We=11+(127&(de>>>=br)),de>>>=7,fe-=7}if(D.have+We>D.nlen+D.ndist){re.msg="invalid bit length repeat",D.mode=30;break}for(;We--;)D.lens[D.have++]=E}}if(D.mode===30)break;if(D.lens[256]===0){re.msg="invalid code -- missing end-of-block",D.mode=30;break}if(D.lenbits=9,Ee={bits:D.lenbits},Ce=x(N,D.lens,0,D.nlen,D.lencode,0,D.work,Ee),D.lenbits=Ee.bits,Ce){re.msg="invalid literal/lengths set",D.mode=30;break}if(D.distbits=6,D.distcode=D.distdyn,Ee={bits:D.distbits},Ce=x(C,D.lens,D.nlen,D.ndist,D.distcode,0,D.work,Ee),D.distbits=Ee.bits,Ce){re.msg="invalid distances set",D.mode=30;break}if(D.mode=20,Se===6)break e;case 20:D.mode=21;case 21:if(6<=be&&258<=Xe){re.next_out=_e,re.avail_out=Xe,re.next_in=je,re.avail_in=be,D.hold=de,D.bits=fe,g(re,gt),_e=re.next_out,Ut=re.output,Xe=re.avail_out,je=re.next_in,Me=re.input,be=re.avail_in,de=D.hold,fe=D.bits,D.mode===12&&(D.back=-1);break}for(D.back=0;$r=(q=D.lencode[de&(1<<D.lenbits)-1])>>>16&255,mn=65535&q,!((br=q>>>24)<=fe);){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if($r&&!(240&$r)){for(Kr=br,ns=$r,St=mn;$r=(q=D.lencode[St+((de&(1<<Kr+ns)-1)>>Kr)])>>>16&255,mn=65535&q,!(Kr+(br=q>>>24)<=fe);){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}de>>>=Kr,fe-=Kr,D.back+=Kr}if(de>>>=br,fe-=br,D.back+=br,D.length=mn,$r===0){D.mode=26;break}if(32&$r){D.back=-1,D.mode=12;break}if(64&$r){re.msg="invalid literal/length code",D.mode=30;break}D.extra=15&$r,D.mode=22;case 22:if(D.extra){for(ee=D.extra;fe<ee;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}D.length+=de&(1<<D.extra)-1,de>>>=D.extra,fe-=D.extra,D.back+=D.extra}D.was=D.length,D.mode=23;case 23:for(;$r=(q=D.distcode[de&(1<<D.distbits)-1])>>>16&255,mn=65535&q,!((br=q>>>24)<=fe);){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if(!(240&$r)){for(Kr=br,ns=$r,St=mn;$r=(q=D.distcode[St+((de&(1<<Kr+ns)-1)>>Kr)])>>>16&255,mn=65535&q,!(Kr+(br=q>>>24)<=fe);){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}de>>>=Kr,fe-=Kr,D.back+=Kr}if(de>>>=br,fe-=br,D.back+=br,64&$r){re.msg="invalid distance code",D.mode=30;break}D.offset=mn,D.extra=15&$r,D.mode=24;case 24:if(D.extra){for(ee=D.extra;fe<ee;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}D.offset+=de&(1<<D.extra)-1,de>>>=D.extra,fe-=D.extra,D.back+=D.extra}if(D.offset>D.dmax){re.msg="invalid distance too far back",D.mode=30;break}D.mode=25;case 25:if(Xe===0)break e;if(We=gt-Xe,D.offset>We){if((We=D.offset-We)>D.whave&&D.sane){re.msg="invalid distance too far back",D.mode=30;break}Ir=We>D.wnext?(We-=D.wnext,D.wsize-We):D.wnext-We,We>D.length&&(We=D.length),Qr=D.window}else Qr=Ut,Ir=_e-D.offset,We=D.length;for(Xe<We&&(We=Xe),Xe-=We,D.length-=We;Ut[_e++]=Qr[Ir++],--We;);D.length===0&&(D.mode=21);break;case 26:if(Xe===0)break e;Ut[_e++]=D.length,Xe--,D.mode=21;break;case 27:if(D.wrap){for(;fe<32;){if(be===0)break e;be--,de|=Me[je++]<<fe,fe+=8}if(gt-=Xe,re.total_out+=gt,D.total+=gt,gt&&(re.adler=D.check=D.flags?h(D.check,Ut,gt,_e-gt):d(D.check,Ut,gt,_e-gt)),gt=Xe,(D.flags?de:S(de))!==D.check){re.msg="incorrect data check",D.mode=30;break}fe=de=0}D.mode=28;case 28:if(D.wrap&&D.flags){for(;fe<32;){if(be===0)break e;be--,de+=Me[je++]<<fe,fe+=8}if(de!==(4294967295&D.total)){re.msg="incorrect length check",D.mode=30;break}fe=de=0}D.mode=29;case 29:Ce=1;break e;case 30:Ce=-3;break e;case 31:return-4;case 32:default:return _}return re.next_out=_e,re.avail_out=Xe,re.next_in=je,re.avail_in=be,D.hold=de,D.bits=fe,(D.wsize||gt!==re.avail_out&&D.mode<30&&(D.mode<27||Se!==4))&&ot(re,re.output,re.next_out,gt-re.avail_out)?(D.mode=31,-4):(Ge-=re.avail_in,gt-=re.avail_out,re.total_in+=Ge,re.total_out+=gt,D.total+=gt,D.wrap&&gt&&(re.adler=D.check=D.flags?h(D.check,Ut,gt,re.next_out-gt):d(D.check,Ut,gt,re.next_out-gt)),re.data_type=D.bits+(D.last?64:0)+(D.mode===12?128:0)+(D.mode===20||D.mode===15?256:0),(Ge==0&&gt===0||Se===4)&&Ce===A&&(Ce=-5),Ce)},a.inflateEnd=function(re){if(!re||!re.state)return _;var Se=re.state;return Se.window&&(Se.window=null),re.state=null,A},a.inflateGetHeader=function(re,Se){var D;return re&&re.state&&2&(D=re.state).wrap?((D.head=Se).done=!1,A):_},a.inflateSetDictionary=function(re,Se){var D,Me=Se.length;return re&&re.state?(D=re.state).wrap!==0&&D.mode!==11?_:D.mode===11&&d(1,Se,Me,0)!==D.check?-3:ot(re,Se,Me,Me)?(D.mode=31,-4):(D.havedict=1,A):_},a.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,s,a){var c=n("../utils/common"),d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],h=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],x=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(N,C,A,_,R,$,L,S){var P,O,K,Q,ue,oe,we,he,ze,ot=S.bits,re=0,Se=0,D=0,Me=0,Ut=0,je=0,_e=0,be=0,Xe=0,de=0,fe=null,Ge=0,gt=new c.Buf16(16),We=new c.Buf16(16),Ir=null,Qr=0;for(re=0;re<=15;re++)gt[re]=0;for(Se=0;Se<_;Se++)gt[C[A+Se]]++;for(Ut=ot,Me=15;1<=Me&&gt[Me]===0;Me--);if(Me<Ut&&(Ut=Me),Me===0)return R[$++]=20971520,R[$++]=20971520,S.bits=1,0;for(D=1;D<Me&&gt[D]===0;D++);for(Ut<D&&(Ut=D),re=be=1;re<=15;re++)if(be<<=1,(be-=gt[re])<0)return-1;if(0<be&&(N===0||Me!==1))return-1;for(We[1]=0,re=1;re<15;re++)We[re+1]=We[re]+gt[re];for(Se=0;Se<_;Se++)C[A+Se]!==0&&(L[We[C[A+Se]]++]=Se);if(oe=N===0?(fe=Ir=L,19):N===1?(fe=d,Ge-=257,Ir=h,Qr-=257,256):(fe=g,Ir=x,-1),re=D,ue=$,_e=Se=de=0,K=-1,Q=(Xe=1<<(je=Ut))-1,N===1&&852<Xe||N===2&&592<Xe)return 1;for(;;){for(we=re-_e,ze=L[Se]<oe?(he=0,L[Se]):L[Se]>oe?(he=Ir[Qr+L[Se]],fe[Ge+L[Se]]):(he=96,0),P=1<<re-_e,D=O=1<<je;R[ue+(de>>_e)+(O-=P)]=we<<24|he<<16|ze|0,O!==0;);for(P=1<<re-1;de&P;)P>>=1;if(P!==0?(de&=P-1,de+=P):de=0,Se++,--gt[re]==0){if(re===Me)break;re=C[A+L[Se]]}if(Ut<re&&(de&Q)!==K){for(_e===0&&(_e=Ut),ue+=D,be=1<<(je=re-_e);je+_e<Me&&!((be-=gt[je+_e])<=0);)je++,be<<=1;if(Xe+=1<<je,N===1&&852<Xe||N===2&&592<Xe)return 1;R[K=de&Q]=Ut<<24|je<<16|ue-$|0}}return de!==0&&(R[ue+de]=re-_e<<24|64<<16|0),S.bits=Ut,0}},{"../utils/common":41}],51:[function(n,s,a){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,s,a){var c=n("../utils/common"),d=0,h=1;function g(q){for(var le=q.length;0<=--le;)q[le]=0}var x=0,N=29,C=256,A=C+1+N,_=30,R=19,$=2*A+1,L=15,S=16,P=7,O=256,K=16,Q=17,ue=18,oe=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],we=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],he=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],ze=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ot=new Array(2*(A+2));g(ot);var re=new Array(2*_);g(re);var Se=new Array(512);g(Se);var D=new Array(256);g(D);var Me=new Array(N);g(Me);var Ut,je,_e,be=new Array(_);function Xe(q,le,Fe,Oe,ke){this.static_tree=q,this.extra_bits=le,this.extra_base=Fe,this.elems=Oe,this.max_length=ke,this.has_stree=q&&q.length}function de(q,le){this.dyn_tree=q,this.max_code=0,this.stat_desc=le}function fe(q){return q<256?Se[q]:Se[256+(q>>>7)]}function Ge(q,le){q.pending_buf[q.pending++]=255&le,q.pending_buf[q.pending++]=le>>>8&255}function gt(q,le,Fe){q.bi_valid>S-Fe?(q.bi_buf|=le<<q.bi_valid&65535,Ge(q,q.bi_buf),q.bi_buf=le>>S-q.bi_valid,q.bi_valid+=Fe-S):(q.bi_buf|=le<<q.bi_valid&65535,q.bi_valid+=Fe)}function We(q,le,Fe){gt(q,Fe[2*le],Fe[2*le+1])}function Ir(q,le){for(var Fe=0;Fe|=1&q,q>>>=1,Fe<<=1,0<--le;);return Fe>>>1}function Qr(q,le,Fe){var Oe,ke,at=new Array(L+1),_t=0;for(Oe=1;Oe<=L;Oe++)at[Oe]=_t=_t+Fe[Oe-1]<<1;for(ke=0;ke<=le;ke++){var tt=q[2*ke+1];tt!==0&&(q[2*ke]=Ir(at[tt]++,tt))}}function br(q){var le;for(le=0;le<A;le++)q.dyn_ltree[2*le]=0;for(le=0;le<_;le++)q.dyn_dtree[2*le]=0;for(le=0;le<R;le++)q.bl_tree[2*le]=0;q.dyn_ltree[2*O]=1,q.opt_len=q.static_len=0,q.last_lit=q.matches=0}function $r(q){8<q.bi_valid?Ge(q,q.bi_buf):0<q.bi_valid&&(q.pending_buf[q.pending++]=q.bi_buf),q.bi_buf=0,q.bi_valid=0}function mn(q,le,Fe,Oe){var ke=2*le,at=2*Fe;return q[ke]<q[at]||q[ke]===q[at]&&Oe[le]<=Oe[Fe]}function Kr(q,le,Fe){for(var Oe=q.heap[Fe],ke=Fe<<1;ke<=q.heap_len&&(ke<q.heap_len&&mn(le,q.heap[ke+1],q.heap[ke],q.depth)&&ke++,!mn(le,Oe,q.heap[ke],q.depth));)q.heap[Fe]=q.heap[ke],Fe=ke,ke<<=1;q.heap[Fe]=Oe}function ns(q,le,Fe){var Oe,ke,at,_t,tt=0;if(q.last_lit!==0)for(;Oe=q.pending_buf[q.d_buf+2*tt]<<8|q.pending_buf[q.d_buf+2*tt+1],ke=q.pending_buf[q.l_buf+tt],tt++,Oe===0?We(q,ke,le):(We(q,(at=D[ke])+C+1,le),(_t=oe[at])!==0&&gt(q,ke-=Me[at],_t),We(q,at=fe(--Oe),Fe),(_t=we[at])!==0&&gt(q,Oe-=be[at],_t)),tt<q.last_lit;);We(q,O,le)}function St(q,le){var Fe,Oe,ke,at=le.dyn_tree,_t=le.stat_desc.static_tree,tt=le.stat_desc.has_stree,Ye=le.stat_desc.elems,kr=-1;for(q.heap_len=0,q.heap_max=$,Fe=0;Fe<Ye;Fe++)at[2*Fe]!==0?(q.heap[++q.heap_len]=kr=Fe,q.depth[Fe]=0):at[2*Fe+1]=0;for(;q.heap_len<2;)at[2*(ke=q.heap[++q.heap_len]=kr<2?++kr:0)]=1,q.depth[ke]=0,q.opt_len--,tt&&(q.static_len-=_t[2*ke+1]);for(le.max_code=kr,Fe=q.heap_len>>1;1<=Fe;Fe--)Kr(q,at,Fe);for(ke=Ye;Fe=q.heap[1],q.heap[1]=q.heap[q.heap_len--],Kr(q,at,1),Oe=q.heap[1],q.heap[--q.heap_max]=Fe,q.heap[--q.heap_max]=Oe,at[2*ke]=at[2*Fe]+at[2*Oe],q.depth[ke]=(q.depth[Fe]>=q.depth[Oe]?q.depth[Fe]:q.depth[Oe])+1,at[2*Fe+1]=at[2*Oe+1]=ke,q.heap[1]=ke++,Kr(q,at,1),2<=q.heap_len;);q.heap[--q.heap_max]=q.heap[1],function(Ft,zn){var Ns,Ss,Ms,sn,Rs,_s,Cn=zn.dyn_tree,Ko=zn.max_code,No=zn.stat_desc.static_tree,Dd=zn.stat_desc.has_stree,Na=zn.stat_desc.extra_bits,Ri=zn.stat_desc.extra_base,Jo=zn.stat_desc.max_length,Oi=0;for(sn=0;sn<=L;sn++)Ft.bl_count[sn]=0;for(Cn[2*Ft.heap[Ft.heap_max]+1]=0,Ns=Ft.heap_max+1;Ns<$;Ns++)Jo<(sn=Cn[2*Cn[2*(Ss=Ft.heap[Ns])+1]+1]+1)&&(sn=Jo,Oi++),Cn[2*Ss+1]=sn,Ko<Ss||(Ft.bl_count[sn]++,Rs=0,Ri<=Ss&&(Rs=Na[Ss-Ri]),_s=Cn[2*Ss],Ft.opt_len+=_s*(sn+Rs),Dd&&(Ft.static_len+=_s*(No[2*Ss+1]+Rs)));if(Oi!==0){do{for(sn=Jo-1;Ft.bl_count[sn]===0;)sn--;Ft.bl_count[sn]--,Ft.bl_count[sn+1]+=2,Ft.bl_count[Jo]--,Oi-=2}while(0<Oi);for(sn=Jo;sn!==0;sn--)for(Ss=Ft.bl_count[sn];Ss!==0;)Ko<(Ms=Ft.heap[--Ns])||(Cn[2*Ms+1]!==sn&&(Ft.opt_len+=(sn-Cn[2*Ms+1])*Cn[2*Ms],Cn[2*Ms+1]=sn),Ss--)}}(q,le),Qr(at,kr,q.bl_count)}function E(q,le,Fe){var Oe,ke,at=-1,_t=le[1],tt=0,Ye=7,kr=4;for(_t===0&&(Ye=138,kr=3),le[2*(Fe+1)+1]=65535,Oe=0;Oe<=Fe;Oe++)ke=_t,_t=le[2*(Oe+1)+1],++tt<Ye&&ke===_t||(tt<kr?q.bl_tree[2*ke]+=tt:ke!==0?(ke!==at&&q.bl_tree[2*ke]++,q.bl_tree[2*K]++):tt<=10?q.bl_tree[2*Q]++:q.bl_tree[2*ue]++,at=ke,kr=(tt=0)===_t?(Ye=138,3):ke===_t?(Ye=6,3):(Ye=7,4))}function Ce(q,le,Fe){var Oe,ke,at=-1,_t=le[1],tt=0,Ye=7,kr=4;for(_t===0&&(Ye=138,kr=3),Oe=0;Oe<=Fe;Oe++)if(ke=_t,_t=le[2*(Oe+1)+1],!(++tt<Ye&&ke===_t)){if(tt<kr)for(;We(q,ke,q.bl_tree),--tt!=0;);else ke!==0?(ke!==at&&(We(q,ke,q.bl_tree),tt--),We(q,K,q.bl_tree),gt(q,tt-3,2)):tt<=10?(We(q,Q,q.bl_tree),gt(q,tt-3,3)):(We(q,ue,q.bl_tree),gt(q,tt-11,7));at=ke,kr=(tt=0)===_t?(Ye=138,3):ke===_t?(Ye=6,3):(Ye=7,4)}}g(be);var Ee=!1;function ee(q,le,Fe,Oe){gt(q,(x<<1)+(Oe?1:0),3),function(ke,at,_t,tt){$r(ke),Ge(ke,_t),Ge(ke,~_t),c.arraySet(ke.pending_buf,ke.window,at,_t,ke.pending),ke.pending+=_t}(q,le,Fe)}a._tr_init=function(q){Ee||(function(){var le,Fe,Oe,ke,at,_t=new Array(L+1);for(ke=Oe=0;ke<N-1;ke++)for(Me[ke]=Oe,le=0;le<1<<oe[ke];le++)D[Oe++]=ke;for(D[Oe-1]=ke,ke=at=0;ke<16;ke++)for(be[ke]=at,le=0;le<1<<we[ke];le++)Se[at++]=ke;for(at>>=7;ke<_;ke++)for(be[ke]=at<<7,le=0;le<1<<we[ke]-7;le++)Se[256+at++]=ke;for(Fe=0;Fe<=L;Fe++)_t[Fe]=0;for(le=0;le<=143;)ot[2*le+1]=8,le++,_t[8]++;for(;le<=255;)ot[2*le+1]=9,le++,_t[9]++;for(;le<=279;)ot[2*le+1]=7,le++,_t[7]++;for(;le<=287;)ot[2*le+1]=8,le++,_t[8]++;for(Qr(ot,A+1,_t),le=0;le<_;le++)re[2*le+1]=5,re[2*le]=Ir(le,5);Ut=new Xe(ot,oe,C+1,A,L),je=new Xe(re,we,0,_,L),_e=new Xe(new Array(0),he,0,R,P)}(),Ee=!0),q.l_desc=new de(q.dyn_ltree,Ut),q.d_desc=new de(q.dyn_dtree,je),q.bl_desc=new de(q.bl_tree,_e),q.bi_buf=0,q.bi_valid=0,br(q)},a._tr_stored_block=ee,a._tr_flush_block=function(q,le,Fe,Oe){var ke,at,_t=0;0<q.level?(q.strm.data_type===2&&(q.strm.data_type=function(tt){var Ye,kr=4093624447;for(Ye=0;Ye<=31;Ye++,kr>>>=1)if(1&kr&&tt.dyn_ltree[2*Ye]!==0)return d;if(tt.dyn_ltree[18]!==0||tt.dyn_ltree[20]!==0||tt.dyn_ltree[26]!==0)return h;for(Ye=32;Ye<C;Ye++)if(tt.dyn_ltree[2*Ye]!==0)return h;return d}(q)),St(q,q.l_desc),St(q,q.d_desc),_t=function(tt){var Ye;for(E(tt,tt.dyn_ltree,tt.l_desc.max_code),E(tt,tt.dyn_dtree,tt.d_desc.max_code),St(tt,tt.bl_desc),Ye=R-1;3<=Ye&&tt.bl_tree[2*ze[Ye]+1]===0;Ye--);return tt.opt_len+=3*(Ye+1)+5+5+4,Ye}(q),ke=q.opt_len+3+7>>>3,(at=q.static_len+3+7>>>3)<=ke&&(ke=at)):ke=at=Fe+5,Fe+4<=ke&&le!==-1?ee(q,le,Fe,Oe):q.strategy===4||at===ke?(gt(q,2+(Oe?1:0),3),ns(q,ot,re)):(gt(q,4+(Oe?1:0),3),function(tt,Ye,kr,Ft){var zn;for(gt(tt,Ye-257,5),gt(tt,kr-1,5),gt(tt,Ft-4,4),zn=0;zn<Ft;zn++)gt(tt,tt.bl_tree[2*ze[zn]+1],3);Ce(tt,tt.dyn_ltree,Ye-1),Ce(tt,tt.dyn_dtree,kr-1)}(q,q.l_desc.max_code+1,q.d_desc.max_code+1,_t+1),ns(q,q.dyn_ltree,q.dyn_dtree)),br(q),Oe&&$r(q)},a._tr_tally=function(q,le,Fe){return q.pending_buf[q.d_buf+2*q.last_lit]=le>>>8&255,q.pending_buf[q.d_buf+2*q.last_lit+1]=255&le,q.pending_buf[q.l_buf+q.last_lit]=255&Fe,q.last_lit++,le===0?q.dyn_ltree[2*Fe]++:(q.matches++,le--,q.dyn_ltree[2*(D[Fe]+C+1)]++,q.dyn_dtree[2*fe(le)]++),q.last_lit===q.lit_bufsize-1},a._tr_align=function(q){gt(q,2,3),We(q,O,ot),function(le){le.bi_valid===16?(Ge(le,le.bi_buf),le.bi_buf=0,le.bi_valid=0):8<=le.bi_valid&&(le.pending_buf[le.pending++]=255&le.bi_buf,le.bi_buf>>=8,le.bi_valid-=8)}(q)}},{"../utils/common":41}],53:[function(n,s,a){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,s,a){(function(c){(function(d,h){if(!d.setImmediate){var g,x,N,C,A=1,_={},R=!1,$=d.document,L=Object.getPrototypeOf&&Object.getPrototypeOf(d);L=L&&L.setTimeout?L:d,g={}.toString.call(d.process)==="[object process]"?function(K){process.nextTick(function(){P(K)})}:function(){if(d.postMessage&&!d.importScripts){var K=!0,Q=d.onmessage;return d.onmessage=function(){K=!1},d.postMessage("","*"),d.onmessage=Q,K}}()?(C="setImmediate$"+Math.random()+"$",d.addEventListener?d.addEventListener("message",O,!1):d.attachEvent("onmessage",O),function(K){d.postMessage(C+K,"*")}):d.MessageChannel?((N=new MessageChannel).port1.onmessage=function(K){P(K.data)},function(K){N.port2.postMessage(K)}):$&&"onreadystatechange"in $.createElement("script")?(x=$.documentElement,function(K){var Q=$.createElement("script");Q.onreadystatechange=function(){P(K),Q.onreadystatechange=null,x.removeChild(Q),Q=null},x.appendChild(Q)}):function(K){setTimeout(P,0,K)},L.setImmediate=function(K){typeof K!="function"&&(K=new Function(""+K));for(var Q=new Array(arguments.length-1),ue=0;ue<Q.length;ue++)Q[ue]=arguments[ue+1];var oe={callback:K,args:Q};return _[A]=oe,g(A),A++},L.clearImmediate=S}function S(K){delete _[K]}function P(K){if(R)setTimeout(P,0,K);else{var Q=_[K];if(Q){R=!0;try{(function(ue){var oe=ue.callback,we=ue.args;switch(we.length){case 0:oe();break;case 1:oe(we[0]);break;case 2:oe(we[0],we[1]);break;case 3:oe(we[0],we[1],we[2]);break;default:oe.apply(h,we)}})(Q)}finally{S(K),R=!1}}}}function O(K){K.source===d&&typeof K.data=="string"&&K.data.indexOf(C)===0&&P(+K.data.slice(C.length))}})(typeof self>"u"?c===void 0?this:c:self)}).call(this,typeof ma<"u"?ma:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(j2);var l3=j2.exports;const ph=Gw(l3);var N2={exports:{}};(function(e,t){(function(n,s){s()})(ma,function(){function n(x,N){return typeof N>"u"?N={autoBom:!1}:typeof N!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),N={autoBom:!N}),N.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(x.type)?new Blob(["\uFEFF",x],{type:x.type}):x}function s(x,N,C){var A=new XMLHttpRequest;A.open("GET",x),A.responseType="blob",A.onload=function(){g(A.response,N,C)},A.onerror=function(){console.error("could not download file")},A.send()}function a(x){var N=new XMLHttpRequest;N.open("HEAD",x,!1);try{N.send()}catch{}return 200<=N.status&&299>=N.status}function c(x){try{x.dispatchEvent(new MouseEvent("click"))}catch{var N=document.createEvent("MouseEvents");N.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),x.dispatchEvent(N)}}var d=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ma=="object"&&ma.global===ma?ma:void 0,h=d.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=d.saveAs||(typeof window!="object"||window!==d?function(){}:"download"in HTMLAnchorElement.prototype&&!h?function(x,N,C){var A=d.URL||d.webkitURL,_=document.createElement("a");N=N||x.name||"download",_.download=N,_.rel="noopener",typeof x=="string"?(_.href=x,_.origin===location.origin?c(_):a(_.href)?s(x,N,C):c(_,_.target="_blank")):(_.href=A.createObjectURL(x),setTimeout(function(){A.revokeObjectURL(_.href)},4e4),setTimeout(function(){c(_)},0))}:"msSaveOrOpenBlob"in navigator?function(x,N,C){if(N=N||x.name||"download",typeof x!="string")navigator.msSaveOrOpenBlob(n(x,C),N);else if(a(x))s(x,N,C);else{var A=document.createElement("a");A.href=x,A.target="_blank",setTimeout(function(){c(A)})}}:function(x,N,C,A){if(A=A||open("","_blank"),A&&(A.document.title=A.document.body.innerText="downloading..."),typeof x=="string")return s(x,N,C);var _=x.type==="application/octet-stream",R=/constructor/i.test(d.HTMLElement)||d.safari,$=/CriOS\/[\d]+/.test(navigator.userAgent);if(($||_&&R||h)&&typeof FileReader<"u"){var L=new FileReader;L.onloadend=function(){var O=L.result;O=$?O:O.replace(/^data:[^;]*;/,"data:attachment/file;"),A?A.location.href=O:location=O,A=null},L.readAsDataURL(x)}else{var S=d.URL||d.webkitURL,P=S.createObjectURL(x);A?A.location=P:location.href=P,A=null,setTimeout(function(){S.revokeObjectURL(P)},4e4)}});d.saveAs=g.saveAs=g,e.exports=g})})(N2);var Cg=N2.exports;const zr=e=>typeof e=="string",Ku=()=>{let e,t;const n=new Promise((s,a)=>{e=s,t=a});return n.resolve=e,n.reject=t,n},yw=e=>e==null?"":""+e,c3=(e,t,n)=>{e.forEach(s=>{t[s]&&(n[s]=t[s])})},d3=/###/g,vw=e=>e&&e.indexOf("###")>-1?e.replace(d3,"."):e,ww=e=>!e||zr(e),mp=(e,t,n)=>{const s=zr(t)?t.split("."):t;let a=0;for(;a<s.length-1;){if(ww(e))return{};const c=vw(s[a]);!e[c]&&n&&(e[c]=new n),Object.prototype.hasOwnProperty.call(e,c)?e=e[c]:e={},++a}return ww(e)?{}:{obj:e,k:vw(s[a])}},zw=(e,t,n)=>{const{obj:s,k:a}=mp(e,t,Object);if(s!==void 0||t.length===1){s[a]=n;return}let c=t[t.length-1],d=t.slice(0,t.length-1),h=mp(e,d,Object);for(;h.obj===void 0&&d.length;)c=`${d[d.length-1]}.${c}`,d=d.slice(0,d.length-1),h=mp(e,d,Object),h!=null&&h.obj&&typeof h.obj[`${h.k}.${c}`]<"u"&&(h.obj=void 0);h.obj[`${h.k}.${c}`]=n},u3=(e,t,n,s)=>{const{obj:a,k:c}=mp(e,t,Object);a[c]=a[c]||[],a[c].push(n)},c0=(e,t)=>{const{obj:n,k:s}=mp(e,t);if(n&&Object.prototype.hasOwnProperty.call(n,s))return n[s]},p3=(e,t,n)=>{const s=c0(e,n);return s!==void 0?s:c0(t,n)},S2=(e,t,n)=>{for(const s in t)s!=="__proto__"&&s!=="constructor"&&(s in e?zr(e[s])||e[s]instanceof String||zr(t[s])||t[s]instanceof String?n&&(e[s]=t[s]):S2(e[s],t[s],n):e[s]=t[s]);return e},ed=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var f3={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const h3=e=>zr(e)?e.replace(/[&<>"'\/]/g,t=>f3[t]):e;class m3{constructor(t){this.capacity=t,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(t){const n=this.regExpMap.get(t);if(n!==void 0)return n;const s=new RegExp(t);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(t,s),this.regExpQueue.push(t),s}}const g3=[" ",",","?","!",";"],x3=new m3(20),b3=(e,t,n)=>{t=t||"",n=n||"";const s=g3.filter(d=>t.indexOf(d)<0&&n.indexOf(d)<0);if(s.length===0)return!0;const a=x3.getRegExp(`(${s.map(d=>d==="?"?"\\?":d).join("|")})`);let c=!a.test(e);if(!c){const d=e.indexOf(n);d>0&&!a.test(e.substring(0,d))&&(c=!0)}return c},Lx=(e,t,n=".")=>{if(!e)return;if(e[t])return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0;const s=t.split(n);let a=e;for(let c=0;c<s.length;){if(!a||typeof a!="object")return;let d,h="";for(let g=c;g<s.length;++g)if(g!==c&&(h+=n),h+=s[g],d=a[h],d!==void 0){if(["string","number","boolean"].indexOf(typeof d)>-1&&g<s.length-1)continue;c+=g-c+1;break}a=d}return a},Mp=e=>e==null?void 0:e.replace("_","-"),y3={type:"logger",log(e){this.output("log",e)},warn(e){this.output("warn",e)},error(e){this.output("error",e)},output(e,t){var n,s;(s=(n=console==null?void 0:console[e])==null?void 0:n.apply)==null||s.call(n,console,t)}};class d0{constructor(t,n={}){this.init(t,n)}init(t,n={}){this.prefix=n.prefix||"i18next:",this.logger=t||y3,this.options=n,this.debug=n.debug}log(...t){return this.forward(t,"log","",!0)}warn(...t){return this.forward(t,"warn","",!0)}error(...t){return this.forward(t,"error","")}deprecate(...t){return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}forward(t,n,s,a){return a&&!this.debug?null:(zr(t[0])&&(t[0]=`${s}${this.prefix} ${t[0]}`),this.logger[n](t))}create(t){return new d0(this.logger,{prefix:`${this.prefix}:${t}:`,...this.options})}clone(t){return t=t||this.options,t.prefix=t.prefix||this.prefix,new d0(this.logger,t)}}var Ho=new d0;class $0{constructor(){this.observers={}}on(t,n){return t.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const a=this.observers[s].get(n)||0;this.observers[s].set(n,a+1)}),this}off(t,n){if(this.observers[t]){if(!n){delete this.observers[t];return}this.observers[t].delete(n)}}emit(t,...n){this.observers[t]&&Array.from(this.observers[t].entries()).forEach(([a,c])=>{for(let d=0;d<c;d++)a(...n)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(([a,c])=>{for(let d=0;d<c;d++)a.apply(a,[t,...n])})}}class kw extends $0{constructor(t,n={ns:["translation"],defaultNS:"translation"}){super(),this.data=t||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(t){this.options.ns.indexOf(t)<0&&this.options.ns.push(t)}removeNamespaces(t){const n=this.options.ns.indexOf(t);n>-1&&this.options.ns.splice(n,1)}getResource(t,n,s,a={}){var x,N;const c=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,d=a.ignoreJSONStructure!==void 0?a.ignoreJSONStructure:this.options.ignoreJSONStructure;let h;t.indexOf(".")>-1?h=t.split("."):(h=[t,n],s&&(Array.isArray(s)?h.push(...s):zr(s)&&c?h.push(...s.split(c)):h.push(s)));const g=c0(this.data,h);return!g&&!n&&!s&&t.indexOf(".")>-1&&(t=h[0],n=h[1],s=h.slice(2).join(".")),g||!d||!zr(s)?g:Lx((N=(x=this.data)==null?void 0:x[t])==null?void 0:N[n],s,c)}addResource(t,n,s,a,c={silent:!1}){const d=c.keySeparator!==void 0?c.keySeparator:this.options.keySeparator;let h=[t,n];s&&(h=h.concat(d?s.split(d):s)),t.indexOf(".")>-1&&(h=t.split("."),a=n,n=h[1]),this.addNamespaces(n),zw(this.data,h,a),c.silent||this.emit("added",t,n,s,a)}addResources(t,n,s,a={silent:!1}){for(const c in s)(zr(s[c])||Array.isArray(s[c]))&&this.addResource(t,n,c,s[c],{silent:!0});a.silent||this.emit("added",t,n,s)}addResourceBundle(t,n,s,a,c,d={silent:!1,skipCopy:!1}){let h=[t,n];t.indexOf(".")>-1&&(h=t.split("."),a=s,s=n,n=h[1]),this.addNamespaces(n);let g=c0(this.data,h)||{};d.skipCopy||(s=JSON.parse(JSON.stringify(s))),a?S2(g,s,c):g={...g,...s},zw(this.data,h,g),d.silent||this.emit("added",t,n,s)}removeResourceBundle(t,n){this.hasResourceBundle(t,n)&&delete this.data[t][n],this.removeNamespaces(n),this.emit("removed",t,n)}hasResourceBundle(t,n){return this.getResource(t,n)!==void 0}getResourceBundle(t,n){return n||(n=this.options.defaultNS),this.getResource(t,n)}getDataByLanguage(t){return this.data[t]}hasLanguageSomeTranslations(t){const n=this.getDataByLanguage(t);return!!(n&&Object.keys(n)||[]).find(a=>n[a]&&Object.keys(n[a]).length>0)}toJSON(){return this.data}}var _2={processors:{},addPostProcessor(e){this.processors[e.name]=e},handle(e,t,n,s,a){return e.forEach(c=>{var d;t=((d=this.processors[c])==null?void 0:d.process(t,n,s,a))??t}),t}};const C2=Symbol("i18next/PATH_KEY");function v3(){const e=[],t=Object.create(null);let n;return t.get=(s,a)=>{var c;return(c=n==null?void 0:n.revoke)==null||c.call(n),a===C2?e:(e.push(a),n=Proxy.revocable(s,t),n.proxy)},Proxy.revocable(Object.create(null),t).proxy}function Dx(e,t){const{[C2]:n}=e(v3());return n.join((t==null?void 0:t.keySeparator)??".")}const jw={},Eg=e=>!zr(e)&&typeof e!="boolean"&&typeof e!="number";class u0 extends $0{constructor(t,n={}){super(),c3(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],t,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Ho.create("translator")}changeLanguage(t){t&&(this.language=t)}exists(t,n={interpolation:{}}){const s={...n};if(t==null)return!1;const a=this.resolve(t,s);if((a==null?void 0:a.res)===void 0)return!1;const c=Eg(a.res);return!(s.returnObjects===!1&&c)}extractFromKey(t,n){let s=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const a=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let c=n.ns||this.options.defaultNS||[];const d=s&&t.indexOf(s)>-1,h=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!b3(t,s,a);if(d&&!h){const g=t.match(this.interpolator.nestingRegexp);if(g&&g.length>0)return{key:t,namespaces:zr(c)?[c]:c};const x=t.split(s);(s!==a||s===a&&this.options.ns.indexOf(x[0])>-1)&&(c=x.shift()),t=x.join(a)}return{key:t,namespaces:zr(c)?[c]:c}}translate(t,n,s){let a=typeof n=="object"?{...n}:n;if(typeof a!="object"&&this.options.overloadTranslationOptionHandler&&(a=this.options.overloadTranslationOptionHandler(arguments)),typeof a=="object"&&(a={...a}),a||(a={}),t==null)return"";typeof t=="function"&&(t=Dx(t,{...this.options,...a})),Array.isArray(t)||(t=[String(t)]);const c=a.returnDetails!==void 0?a.returnDetails:this.options.returnDetails,d=a.keySeparator!==void 0?a.keySeparator:this.options.keySeparator,{key:h,namespaces:g}=this.extractFromKey(t[t.length-1],a),x=g[g.length-1];let N=a.nsSeparator!==void 0?a.nsSeparator:this.options.nsSeparator;N===void 0&&(N=":");const C=a.lng||this.language,A=a.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if((C==null?void 0:C.toLowerCase())==="cimode")return A?c?{res:`${x}${N}${h}`,usedKey:h,exactUsedKey:h,usedLng:C,usedNS:x,usedParams:this.getUsedParamsDetails(a)}:`${x}${N}${h}`:c?{res:h,usedKey:h,exactUsedKey:h,usedLng:C,usedNS:x,usedParams:this.getUsedParamsDetails(a)}:h;const _=this.resolve(t,a);let R=_==null?void 0:_.res;const $=(_==null?void 0:_.usedKey)||h,L=(_==null?void 0:_.exactUsedKey)||h,S=["[object Number]","[object Function]","[object RegExp]"],P=a.joinArrays!==void 0?a.joinArrays:this.options.joinArrays,O=!this.i18nFormat||this.i18nFormat.handleAsObject,K=a.count!==void 0&&!zr(a.count),Q=u0.hasDefaultValue(a),ue=K?this.pluralResolver.getSuffix(C,a.count,a):"",oe=a.ordinal&&K?this.pluralResolver.getSuffix(C,a.count,{ordinal:!1}):"",we=K&&!a.ordinal&&a.count===0,he=we&&a[`defaultValue${this.options.pluralSeparator}zero`]||a[`defaultValue${ue}`]||a[`defaultValue${oe}`]||a.defaultValue;let ze=R;O&&!R&&Q&&(ze=he);const ot=Eg(ze),re=Object.prototype.toString.apply(ze);if(O&&ze&&ot&&S.indexOf(re)<0&&!(zr(P)&&Array.isArray(ze))){if(!a.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const Se=this.options.returnedObjectHandler?this.options.returnedObjectHandler($,ze,{...a,ns:g}):`key '${h} (${this.language})' returned an object instead of string.`;return c?(_.res=Se,_.usedParams=this.getUsedParamsDetails(a),_):Se}if(d){const Se=Array.isArray(ze),D=Se?[]:{},Me=Se?L:$;for(const Ut in ze)if(Object.prototype.hasOwnProperty.call(ze,Ut)){const je=`${Me}${d}${Ut}`;Q&&!R?D[Ut]=this.translate(je,{...a,defaultValue:Eg(he)?he[Ut]:void 0,joinArrays:!1,ns:g}):D[Ut]=this.translate(je,{...a,joinArrays:!1,ns:g}),D[Ut]===je&&(D[Ut]=ze[Ut])}R=D}}else if(O&&zr(P)&&Array.isArray(R))R=R.join(P),R&&(R=this.extendTranslation(R,t,a,s));else{let Se=!1,D=!1;!this.isValidLookup(R)&&Q&&(Se=!0,R=he),this.isValidLookup(R)||(D=!0,R=h);const Ut=(a.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&D?void 0:R,je=Q&&he!==R&&this.options.updateMissing;if(D||Se||je){if(this.logger.log(je?"updateKey":"missingKey",C,x,h,je?he:R),d){const de=this.resolve(h,{...a,keySeparator:!1});de&&de.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let _e=[];const be=this.languageUtils.getFallbackCodes(this.options.fallbackLng,a.lng||this.language);if(this.options.saveMissingTo==="fallback"&&be&&be[0])for(let de=0;de<be.length;de++)_e.push(be[de]);else this.options.saveMissingTo==="all"?_e=this.languageUtils.toResolveHierarchy(a.lng||this.language):_e.push(a.lng||this.language);const Xe=(de,fe,Ge)=>{var We;const gt=Q&&Ge!==R?Ge:Ut;this.options.missingKeyHandler?this.options.missingKeyHandler(de,x,fe,gt,je,a):(We=this.backendConnector)!=null&&We.saveMissing&&this.backendConnector.saveMissing(de,x,fe,gt,je,a),this.emit("missingKey",de,x,fe,R)};this.options.saveMissing&&(this.options.saveMissingPlurals&&K?_e.forEach(de=>{const fe=this.pluralResolver.getSuffixes(de,a);we&&a[`defaultValue${this.options.pluralSeparator}zero`]&&fe.indexOf(`${this.options.pluralSeparator}zero`)<0&&fe.push(`${this.options.pluralSeparator}zero`),fe.forEach(Ge=>{Xe([de],h+Ge,a[`defaultValue${Ge}`]||he)})}):Xe(_e,h,he))}R=this.extendTranslation(R,t,a,_,s),D&&R===h&&this.options.appendNamespaceToMissingKey&&(R=`${x}${N}${h}`),(D||Se)&&this.options.parseMissingKeyHandler&&(R=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${x}${N}${h}`:h,Se?R:void 0,a))}return c?(_.res=R,_.usedParams=this.getUsedParamsDetails(a),_):R}extendTranslation(t,n,s,a,c){var g,x;if((g=this.i18nFormat)!=null&&g.parse)t=this.i18nFormat.parse(t,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||a.usedLng,a.usedNS,a.usedKey,{resolved:a});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const N=zr(t)&&(((x=s==null?void 0:s.interpolation)==null?void 0:x.skipOnVariables)!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let C;if(N){const _=t.match(this.interpolator.nestingRegexp);C=_&&_.length}let A=s.replace&&!zr(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(A={...this.options.interpolation.defaultVariables,...A}),t=this.interpolator.interpolate(t,A,s.lng||this.language||a.usedLng,s),N){const _=t.match(this.interpolator.nestingRegexp),R=_&&_.length;C<R&&(s.nest=!1)}!s.lng&&a&&a.res&&(s.lng=this.language||a.usedLng),s.nest!==!1&&(t=this.interpolator.nest(t,(..._)=>(c==null?void 0:c[0])===_[0]&&!s.context?(this.logger.warn(`It seems you are nesting recursively key: ${_[0]} in key: ${n[0]}`),null):this.translate(..._,n),s)),s.interpolation&&this.interpolator.reset()}const d=s.postProcess||this.options.postProcess,h=zr(d)?[d]:d;return t!=null&&(h!=null&&h.length)&&s.applyPostProcessor!==!1&&(t=_2.handle(h,t,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...a,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),t}resolve(t,n={}){let s,a,c,d,h;return zr(t)&&(t=[t]),t.forEach(g=>{if(this.isValidLookup(s))return;const x=this.extractFromKey(g,n),N=x.key;a=N;let C=x.namespaces;this.options.fallbackNS&&(C=C.concat(this.options.fallbackNS));const A=n.count!==void 0&&!zr(n.count),_=A&&!n.ordinal&&n.count===0,R=n.context!==void 0&&(zr(n.context)||typeof n.context=="number")&&n.context!=="",$=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);C.forEach(L=>{var S,P;this.isValidLookup(s)||(h=L,!jw[`${$[0]}-${L}`]&&((S=this.utils)!=null&&S.hasLoadedNamespace)&&!((P=this.utils)!=null&&P.hasLoadedNamespace(h))&&(jw[`${$[0]}-${L}`]=!0,this.logger.warn(`key "${a}" for languages "${$.join(", ")}" won't get resolved as namespace "${h}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),$.forEach(O=>{var ue;if(this.isValidLookup(s))return;d=O;const K=[N];if((ue=this.i18nFormat)!=null&&ue.addLookupKeys)this.i18nFormat.addLookupKeys(K,N,O,L,n);else{let oe;A&&(oe=this.pluralResolver.getSuffix(O,n.count,n));const we=`${this.options.pluralSeparator}zero`,he=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(A&&(n.ordinal&&oe.indexOf(he)===0&&K.push(N+oe.replace(he,this.options.pluralSeparator)),K.push(N+oe),_&&K.push(N+we)),R){const ze=`${N}${this.options.contextSeparator||"_"}${n.context}`;K.push(ze),A&&(n.ordinal&&oe.indexOf(he)===0&&K.push(ze+oe.replace(he,this.options.pluralSeparator)),K.push(ze+oe),_&&K.push(ze+we))}}let Q;for(;Q=K.pop();)this.isValidLookup(s)||(c=Q,s=this.getResource(O,L,Q,n))}))})}),{res:s,usedKey:a,exactUsedKey:c,usedLng:d,usedNS:h}}isValidLookup(t){return t!==void 0&&!(!this.options.returnNull&&t===null)&&!(!this.options.returnEmptyString&&t==="")}getResource(t,n,s,a={}){var c;return(c=this.i18nFormat)!=null&&c.getResource?this.i18nFormat.getResource(t,n,s,a):this.resourceStore.getResource(t,n,s,a)}getUsedParamsDetails(t={}){const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=t.replace&&!zr(t.replace);let a=s?t.replace:t;if(s&&typeof t.count<"u"&&(a.count=t.count),this.options.interpolation.defaultVariables&&(a={...this.options.interpolation.defaultVariables,...a}),!s){a={...a};for(const c of n)delete a[c]}return a}static hasDefaultValue(t){const n="defaultValue";for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&n===s.substring(0,n.length)&&t[s]!==void 0)return!0;return!1}}class Nw{constructor(t){this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ho.create("languageUtils")}getScriptPartFromCode(t){if(t=Mp(t),!t||t.indexOf("-")<0)return null;const n=t.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(t){if(t=Mp(t),!t||t.indexOf("-")<0)return t;const n=t.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(t){if(zr(t)&&t.indexOf("-")>-1){let n;try{n=Intl.getCanonicalLocales(t)[0]}catch{}return n&&this.options.lowerCaseLng&&(n=n.toLowerCase()),n||(this.options.lowerCaseLng?t.toLowerCase():t)}return this.options.cleanCode||this.options.lowerCaseLng?t.toLowerCase():t}isSupportedCode(t){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(t=this.getLanguagePartFromCode(t)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(t)>-1}getBestMatchFromCodes(t){if(!t)return null;let n;return t.forEach(s=>{if(n)return;const a=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(a))&&(n=a)}),!n&&this.options.supportedLngs&&t.forEach(s=>{if(n)return;const a=this.getScriptPartFromCode(s);if(this.isSupportedCode(a))return n=a;const c=this.getLanguagePartFromCode(s);if(this.isSupportedCode(c))return n=c;n=this.options.supportedLngs.find(d=>{if(d===c)return d;if(!(d.indexOf("-")<0&&c.indexOf("-")<0)&&(d.indexOf("-")>0&&c.indexOf("-")<0&&d.substring(0,d.indexOf("-"))===c||d.indexOf(c)===0&&c.length>1))return d})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(t,n){if(!t)return[];if(typeof t=="function"&&(t=t(n)),zr(t)&&(t=[t]),Array.isArray(t))return t;if(!n)return t.default||[];let s=t[n];return s||(s=t[this.getScriptPartFromCode(n)]),s||(s=t[this.formatLanguageCode(n)]),s||(s=t[this.getLanguagePartFromCode(n)]),s||(s=t.default),s||[]}toResolveHierarchy(t,n){const s=this.getFallbackCodes((n===!1?[]:n)||this.options.fallbackLng||[],t),a=[],c=d=>{d&&(this.isSupportedCode(d)?a.push(d):this.logger.warn(`rejecting language code not found in supportedLngs: ${d}`))};return zr(t)&&(t.indexOf("-")>-1||t.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&c(this.formatLanguageCode(t)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&c(this.getScriptPartFromCode(t)),this.options.load!=="currentOnly"&&c(this.getLanguagePartFromCode(t))):zr(t)&&c(this.formatLanguageCode(t)),s.forEach(d=>{a.indexOf(d)<0&&c(this.formatLanguageCode(d))}),a}}const Sw={zero:0,one:1,two:2,few:3,many:4,other:5},_w={select:e=>e===1?"one":"other",resolvedOptions:()=>({pluralCategories:["one","other"]})};class w3{constructor(t,n={}){this.languageUtils=t,this.options=n,this.logger=Ho.create("pluralResolver"),this.pluralRulesCache={}}clearCache(){this.pluralRulesCache={}}getRule(t,n={}){const s=Mp(t==="dev"?"en":t),a=n.ordinal?"ordinal":"cardinal",c=JSON.stringify({cleanedCode:s,type:a});if(c in this.pluralRulesCache)return this.pluralRulesCache[c];let d;try{d=new Intl.PluralRules(s,{type:a})}catch{if(!Intl)return this.logger.error("No Intl support, please use an Intl polyfill!"),_w;if(!t.match(/-|_/))return _w;const g=this.languageUtils.getLanguagePartFromCode(t);d=this.getRule(g,n)}return this.pluralRulesCache[c]=d,d}needsPlural(t,n={}){let s=this.getRule(t,n);return s||(s=this.getRule("dev",n)),(s==null?void 0:s.resolvedOptions().pluralCategories.length)>1}getPluralFormsOfKey(t,n,s={}){return this.getSuffixes(t,s).map(a=>`${n}${a}`)}getSuffixes(t,n={}){let s=this.getRule(t,n);return s||(s=this.getRule("dev",n)),s?s.resolvedOptions().pluralCategories.sort((a,c)=>Sw[a]-Sw[c]).map(a=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${a}`):[]}getSuffix(t,n,s={}){const a=this.getRule(t,s);return a?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${a.select(n)}`:(this.logger.warn(`no plural rule found for: ${t}`),this.getSuffix("dev",n,s))}}const Cw=(e,t,n,s=".",a=!0)=>{let c=p3(e,t,n);return!c&&a&&zr(n)&&(c=Lx(e,n,s),c===void 0&&(c=Lx(t,n,s))),c},Ig=e=>e.replace(/\$/g,"$$$$");class Ew{constructor(t={}){var n;this.logger=Ho.create("interpolator"),this.options=t,this.format=((n=t==null?void 0:t.interpolation)==null?void 0:n.format)||(s=>s),this.init(t)}init(t={}){t.interpolation||(t.interpolation={escapeValue:!0});const{escape:n,escapeValue:s,useRawValueToEscape:a,prefix:c,prefixEscaped:d,suffix:h,suffixEscaped:g,formatSeparator:x,unescapeSuffix:N,unescapePrefix:C,nestingPrefix:A,nestingPrefixEscaped:_,nestingSuffix:R,nestingSuffixEscaped:$,nestingOptionsSeparator:L,maxReplaces:S,alwaysFormat:P}=t.interpolation;this.escape=n!==void 0?n:h3,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=a!==void 0?a:!1,this.prefix=c?ed(c):d||"{{",this.suffix=h?ed(h):g||"}}",this.formatSeparator=x||",",this.unescapePrefix=N?"":C||"-",this.unescapeSuffix=this.unescapePrefix?"":N||"",this.nestingPrefix=A?ed(A):_||ed("$t("),this.nestingSuffix=R?ed(R):$||ed(")"),this.nestingOptionsSeparator=L||",",this.maxReplaces=S||1e3,this.alwaysFormat=P!==void 0?P:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const t=(n,s)=>(n==null?void 0:n.source)===s?(n.lastIndex=0,n):new RegExp(s,"g");this.regexp=t(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=t(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=t(this.nestingRegexp,`${this.nestingPrefix}((?:[^()"']+|"[^"]*"|'[^']*'|\\((?:[^()]|"[^"]*"|'[^']*')*\\))*?)${this.nestingSuffix}`)}interpolate(t,n,s,a){var _;let c,d,h;const g=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},x=R=>{if(R.indexOf(this.formatSeparator)<0){const P=Cw(n,g,R,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(P,void 0,s,{...a,...n,interpolationkey:R}):P}const $=R.split(this.formatSeparator),L=$.shift().trim(),S=$.join(this.formatSeparator).trim();return this.format(Cw(n,g,L,this.options.keySeparator,this.options.ignoreJSONStructure),S,s,{...a,...n,interpolationkey:L})};this.resetRegExp();const N=(a==null?void 0:a.missingInterpolationHandler)||this.options.missingInterpolationHandler,C=((_=a==null?void 0:a.interpolation)==null?void 0:_.skipOnVariables)!==void 0?a.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:R=>Ig(R)},{regex:this.regexp,safeValue:R=>this.escapeValue?Ig(this.escape(R)):Ig(R)}].forEach(R=>{for(h=0;c=R.regex.exec(t);){const $=c[1].trim();if(d=x($),d===void 0)if(typeof N=="function"){const S=N(t,c,a);d=zr(S)?S:""}else if(a&&Object.prototype.hasOwnProperty.call(a,$))d="";else if(C){d=c[0];continue}else this.logger.warn(`missed to pass in variable ${$} for interpolating ${t}`),d="";else!zr(d)&&!this.useRawValueToEscape&&(d=yw(d));const L=R.safeValue(d);if(t=t.replace(c[0],L),C?(R.regex.lastIndex+=d.length,R.regex.lastIndex-=c[0].length):R.regex.lastIndex=0,h++,h>=this.maxReplaces)break}}),t}nest(t,n,s={}){let a,c,d;const h=(g,x)=>{const N=this.nestingOptionsSeparator;if(g.indexOf(N)<0)return g;const C=g.split(new RegExp(`${N}[ ]*{`));let A=`{${C[1]}`;g=C[0],A=this.interpolate(A,d);const _=A.match(/'/g),R=A.match(/"/g);(((_==null?void 0:_.length)??0)%2===0&&!R||R.length%2!==0)&&(A=A.replace(/'/g,'"'));try{d=JSON.parse(A),x&&(d={...x,...d})}catch($){return this.logger.warn(`failed parsing options string in nesting for key ${g}`,$),`${g}${N}${A}`}return d.defaultValue&&d.defaultValue.indexOf(this.prefix)>-1&&delete d.defaultValue,g};for(;a=this.nestingRegexp.exec(t);){let g=[];d={...s},d=d.replace&&!zr(d.replace)?d.replace:d,d.applyPostProcessor=!1,delete d.defaultValue;const x=/{.*}/.test(a[1])?a[1].lastIndexOf("}")+1:a[1].indexOf(this.formatSeparator);if(x!==-1&&(g=a[1].slice(x).split(this.formatSeparator).map(N=>N.trim()).filter(Boolean),a[1]=a[1].slice(0,x)),c=n(h.call(this,a[1].trim(),d),d),c&&a[0]===t&&!zr(c))return c;zr(c)||(c=yw(c)),c||(this.logger.warn(`missed to resolve ${a[1]} for nesting ${t}`),c=""),g.length&&(c=g.reduce((N,C)=>this.format(N,C,s.lng,{...s,interpolationkey:a[1].trim()}),c.trim())),t=t.replace(a[0],c),this.regexp.lastIndex=0}return t}}const z3=e=>{let t=e.toLowerCase().trim();const n={};if(e.indexOf("(")>-1){const s=e.split("(");t=s[0].toLowerCase().trim();const a=s[1].substring(0,s[1].length-1);t==="currency"&&a.indexOf(":")<0?n.currency||(n.currency=a.trim()):t==="relativetime"&&a.indexOf(":")<0?n.range||(n.range=a.trim()):a.split(";").forEach(d=>{if(d){const[h,...g]=d.split(":"),x=g.join(":").trim().replace(/^'+|'+$/g,""),N=h.trim();n[N]||(n[N]=x),x==="false"&&(n[N]=!1),x==="true"&&(n[N]=!0),isNaN(x)||(n[N]=parseInt(x,10))}})}return{formatName:t,formatOptions:n}},Iw=e=>{const t={};return(n,s,a)=>{let c=a;a&&a.interpolationkey&&a.formatParams&&a.formatParams[a.interpolationkey]&&a[a.interpolationkey]&&(c={...c,[a.interpolationkey]:void 0});const d=s+JSON.stringify(c);let h=t[d];return h||(h=e(Mp(s),a),t[d]=h),h(n)}},k3=e=>(t,n,s)=>e(Mp(n),s)(t);class j3{constructor(t={}){this.logger=Ho.create("formatter"),this.options=t,this.init(t)}init(t,n={interpolation:{}}){this.formatSeparator=n.interpolation.formatSeparator||",";const s=n.cacheInBuiltFormats?Iw:k3;this.formats={number:s((a,c)=>{const d=new Intl.NumberFormat(a,{...c});return h=>d.format(h)}),currency:s((a,c)=>{const d=new Intl.NumberFormat(a,{...c,style:"currency"});return h=>d.format(h)}),datetime:s((a,c)=>{const d=new Intl.DateTimeFormat(a,{...c});return h=>d.format(h)}),relativetime:s((a,c)=>{const d=new Intl.RelativeTimeFormat(a,{...c});return h=>d.format(h,c.range||"day")}),list:s((a,c)=>{const d=new Intl.ListFormat(a,{...c});return h=>d.format(h)})}}add(t,n){this.formats[t.toLowerCase().trim()]=n}addCached(t,n){this.formats[t.toLowerCase().trim()]=Iw(n)}format(t,n,s,a={}){const c=n.split(this.formatSeparator);if(c.length>1&&c[0].indexOf("(")>1&&c[0].indexOf(")")<0&&c.find(h=>h.indexOf(")")>-1)){const h=c.findIndex(g=>g.indexOf(")")>-1);c[0]=[c[0],...c.splice(1,h)].join(this.formatSeparator)}return c.reduce((h,g)=>{var C;const{formatName:x,formatOptions:N}=z3(g);if(this.formats[x]){let A=h;try{const _=((C=a==null?void 0:a.formatParams)==null?void 0:C[a.interpolationkey])||{},R=_.locale||_.lng||a.locale||a.lng||s;A=this.formats[x](h,R,{...N,...a,..._})}catch(_){this.logger.warn(_)}return A}else this.logger.warn(`there was no format function for ${x}`);return h},t)}}const N3=(e,t)=>{e.pending[t]!==void 0&&(delete e.pending[t],e.pendingCount--)};class S3 extends $0{constructor(t,n,s,a={}){var c,d;super(),this.backend=t,this.store=n,this.services=s,this.languageUtils=s.languageUtils,this.options=a,this.logger=Ho.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=a.maxParallelReads||10,this.readingCalls=0,this.maxRetries=a.maxRetries>=0?a.maxRetries:5,this.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,this.state={},this.queue=[],(d=(c=this.backend)==null?void 0:c.init)==null||d.call(c,s,a.backend,a)}queueLoad(t,n,s,a){const c={},d={},h={},g={};return t.forEach(x=>{let N=!0;n.forEach(C=>{const A=`${x}|${C}`;!s.reload&&this.store.hasResourceBundle(x,C)?this.state[A]=2:this.state[A]<0||(this.state[A]===1?d[A]===void 0&&(d[A]=!0):(this.state[A]=1,N=!1,d[A]===void 0&&(d[A]=!0),c[A]===void 0&&(c[A]=!0),g[C]===void 0&&(g[C]=!0)))}),N||(h[x]=!0)}),(Object.keys(c).length||Object.keys(d).length)&&this.queue.push({pending:d,pendingCount:Object.keys(d).length,loaded:{},errors:[],callback:a}),{toLoad:Object.keys(c),pending:Object.keys(d),toLoadLanguages:Object.keys(h),toLoadNamespaces:Object.keys(g)}}loaded(t,n,s){const a=t.split("|"),c=a[0],d=a[1];n&&this.emit("failedLoading",c,d,n),!n&&s&&this.store.addResourceBundle(c,d,s,void 0,void 0,{skipCopy:!0}),this.state[t]=n?-1:2,n&&s&&(this.state[t]=0);const h={};this.queue.forEach(g=>{u3(g.loaded,[c],d),N3(g,t),n&&g.errors.push(n),g.pendingCount===0&&!g.done&&(Object.keys(g.loaded).forEach(x=>{h[x]||(h[x]={});const N=g.loaded[x];N.length&&N.forEach(C=>{h[x][C]===void 0&&(h[x][C]=!0)})}),g.done=!0,g.errors.length?g.callback(g.errors):g.callback())}),this.emit("loaded",h),this.queue=this.queue.filter(g=>!g.done)}read(t,n,s,a=0,c=this.retryTimeout,d){if(!t.length)return d(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:t,ns:n,fcName:s,tried:a,wait:c,callback:d});return}this.readingCalls++;const h=(x,N)=>{if(this.readingCalls--,this.waitingReads.length>0){const C=this.waitingReads.shift();this.read(C.lng,C.ns,C.fcName,C.tried,C.wait,C.callback)}if(x&&N&&a<this.maxRetries){setTimeout(()=>{this.read.call(this,t,n,s,a+1,c*2,d)},c);return}d(x,N)},g=this.backend[s].bind(this.backend);if(g.length===2){try{const x=g(t,n);x&&typeof x.then=="function"?x.then(N=>h(null,N)).catch(h):h(null,x)}catch(x){h(x)}return}return g(t,n,h)}prepareLoading(t,n,s={},a){if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),a&&a();zr(t)&&(t=this.languageUtils.toResolveHierarchy(t)),zr(n)&&(n=[n]);const c=this.queueLoad(t,n,s,a);if(!c.toLoad.length)return c.pending.length||a(),null;c.toLoad.forEach(d=>{this.loadOne(d)})}load(t,n,s){this.prepareLoading(t,n,{},s)}reload(t,n,s){this.prepareLoading(t,n,{reload:!0},s)}loadOne(t,n=""){const s=t.split("|"),a=s[0],c=s[1];this.read(a,c,"read",void 0,void 0,(d,h)=>{d&&this.logger.warn(`${n}loading namespace ${c} for language ${a} failed`,d),!d&&h&&this.logger.log(`${n}loaded namespace ${c} for language ${a}`,h),this.loaded(t,d,h)})}saveMissing(t,n,s,a,c,d={},h=()=>{}){var g,x,N,C,A;if((x=(g=this.services)==null?void 0:g.utils)!=null&&x.hasLoadedNamespace&&!((C=(N=this.services)==null?void 0:N.utils)!=null&&C.hasLoadedNamespace(n))){this.logger.warn(`did not save key "${s}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if((A=this.backend)!=null&&A.create){const _={...d,isUpdate:c},R=this.backend.create.bind(this.backend);if(R.length<6)try{let $;R.length===5?$=R(t,n,s,a,_):$=R(t,n,s,a),$&&typeof $.then=="function"?$.then(L=>h(null,L)).catch(h):h(null,$)}catch($){h($)}else R(t,n,s,a,h,_)}!t||!t[0]||this.store.addResource(t[0],n,s,a)}}}const Pg=()=>({debug:!1,initAsync:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:e=>{let t={};if(typeof e[1]=="object"&&(t=e[1]),zr(e[1])&&(t.defaultValue=e[1]),zr(e[2])&&(t.tDescription=e[2]),typeof e[2]=="object"||typeof e[3]=="object"){const n=e[3]||e[2];Object.keys(n).forEach(s=>{t[s]=n[s]})}return t},interpolation:{escapeValue:!0,format:e=>e,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0},cacheInBuiltFormats:!0}),Pw=e=>{var t,n;return zr(e.ns)&&(e.ns=[e.ns]),zr(e.fallbackLng)&&(e.fallbackLng=[e.fallbackLng]),zr(e.fallbackNS)&&(e.fallbackNS=[e.fallbackNS]),((n=(t=e.supportedLngs)==null?void 0:t.indexOf)==null?void 0:n.call(t,"cimode"))<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),typeof e.initImmediate=="boolean"&&(e.initAsync=e.initImmediate),e},fh=()=>{},_3=e=>{Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach(n=>{typeof e[n]=="function"&&(e[n]=e[n].bind(e))})};class gp extends $0{constructor(t={},n){if(super(),this.options=Pw(t),this.services={},this.logger=Ho,this.modules={external:[]},_3(this),n&&!this.isInitialized&&!t.isClone){if(!this.options.initAsync)return this.init(t,n),this;setTimeout(()=>{this.init(t,n)},0)}}init(t={},n){this.isInitializing=!0,typeof t=="function"&&(n=t,t={}),t.defaultNS==null&&t.ns&&(zr(t.ns)?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));const s=Pg();this.options={...s,...this.options,...Pw(t)},this.options.interpolation={...s.interpolation,...this.options.interpolation},t.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=t.keySeparator),t.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=t.nsSeparator),typeof this.options.overloadTranslationOptionHandler!="function"&&(this.options.overloadTranslationOptionHandler=s.overloadTranslationOptionHandler),this.options.debug===!0&&typeof console<"u"&&console.warn("i18next is maintained with support from locize.com  consider powering your project with managed localization (AI, CDN, integrations): https://locize.com");const a=x=>x?typeof x=="function"?new x:x:null;if(!this.options.isClone){this.modules.logger?Ho.init(a(this.modules.logger),this.options):Ho.init(null,this.options);let x;this.modules.formatter?x=this.modules.formatter:x=j3;const N=new Nw(this.options);this.store=new kw(this.options.resources,this.options);const C=this.services;C.logger=Ho,C.resourceStore=this.store,C.languageUtils=N,C.pluralResolver=new w3(N,{prepend:this.options.pluralSeparator,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),this.options.interpolation.format&&this.options.interpolation.format!==s.interpolation.format&&this.logger.deprecate("init: you are still using the legacy format function, please use the new approach: https://www.i18next.com/translation-function/formatting"),x&&(!this.options.interpolation.format||this.options.interpolation.format===s.interpolation.format)&&(C.formatter=a(x),C.formatter.init&&C.formatter.init(C,this.options),this.options.interpolation.format=C.formatter.format.bind(C.formatter)),C.interpolator=new Ew(this.options),C.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},C.backendConnector=new S3(a(this.modules.backend),C.resourceStore,C,this.options),C.backendConnector.on("*",(_,...R)=>{this.emit(_,...R)}),this.modules.languageDetector&&(C.languageDetector=a(this.modules.languageDetector),C.languageDetector.init&&C.languageDetector.init(C,this.options.detection,this.options)),this.modules.i18nFormat&&(C.i18nFormat=a(this.modules.i18nFormat),C.i18nFormat.init&&C.i18nFormat.init(this)),this.translator=new u0(this.services,this.options),this.translator.on("*",(_,...R)=>{this.emit(_,...R)}),this.modules.external.forEach(_=>{_.init&&_.init(this)})}if(this.format=this.options.interpolation.format,n||(n=fh),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const x=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);x.length>0&&x[0]!=="dev"&&(this.options.lng=x[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(x=>{this[x]=(...N)=>this.store[x](...N)}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(x=>{this[x]=(...N)=>(this.store[x](...N),this)});const h=Ku(),g=()=>{const x=(N,C)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),h.resolve(C),n(N,C)};if(this.languages&&!this.isInitialized)return x(null,this.t.bind(this));this.changeLanguage(this.options.lng,x)};return this.options.resources||!this.options.initAsync?g():setTimeout(g,0),h}loadResources(t,n=fh){var c,d;let s=n;const a=zr(t)?t:this.language;if(typeof t=="function"&&(s=t),!this.options.resources||this.options.partialBundledLanguages){if((a==null?void 0:a.toLowerCase())==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const h=[],g=x=>{if(!x||x==="cimode")return;this.services.languageUtils.toResolveHierarchy(x).forEach(C=>{C!=="cimode"&&h.indexOf(C)<0&&h.push(C)})};a?g(a):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(N=>g(N)),(d=(c=this.options.preload)==null?void 0:c.forEach)==null||d.call(c,x=>g(x)),this.services.backendConnector.load(h,this.options.ns,x=>{!x&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(x)})}else s(null)}reloadResources(t,n,s){const a=Ku();return typeof t=="function"&&(s=t,t=void 0),typeof n=="function"&&(s=n,n=void 0),t||(t=this.languages),n||(n=this.options.ns),s||(s=fh),this.services.backendConnector.reload(t,n,c=>{a.resolve(),s(c)}),a}use(t){if(!t)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!t.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return t.type==="backend"&&(this.modules.backend=t),(t.type==="logger"||t.log&&t.warn&&t.error)&&(this.modules.logger=t),t.type==="languageDetector"&&(this.modules.languageDetector=t),t.type==="i18nFormat"&&(this.modules.i18nFormat=t),t.type==="postProcessor"&&_2.addPostProcessor(t),t.type==="formatter"&&(this.modules.formatter=t),t.type==="3rdParty"&&this.modules.external.push(t),this}setResolvedLanguage(t){if(!(!t||!this.languages)&&!(["cimode","dev"].indexOf(t)>-1)){for(let n=0;n<this.languages.length;n++){const s=this.languages[n];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}!this.resolvedLanguage&&this.languages.indexOf(t)<0&&this.store.hasLanguageSomeTranslations(t)&&(this.resolvedLanguage=t,this.languages.unshift(t))}}changeLanguage(t,n){this.isLanguageChangingTo=t;const s=Ku();this.emit("languageChanging",t);const a=h=>{this.language=h,this.languages=this.services.languageUtils.toResolveHierarchy(h),this.resolvedLanguage=void 0,this.setResolvedLanguage(h)},c=(h,g)=>{g?this.isLanguageChangingTo===t&&(a(g),this.translator.changeLanguage(g),this.isLanguageChangingTo=void 0,this.emit("languageChanged",g),this.logger.log("languageChanged",g)):this.isLanguageChangingTo=void 0,s.resolve((...x)=>this.t(...x)),n&&n(h,(...x)=>this.t(...x))},d=h=>{var N,C;!t&&!h&&this.services.languageDetector&&(h=[]);const g=zr(h)?h:h&&h[0],x=this.store.hasLanguageSomeTranslations(g)?g:this.services.languageUtils.getBestMatchFromCodes(zr(h)?[h]:h);x&&(this.language||a(x),this.translator.language||this.translator.changeLanguage(x),(C=(N=this.services.languageDetector)==null?void 0:N.cacheUserLanguage)==null||C.call(N,x)),this.loadResources(x,A=>{c(A,x)})};return!t&&this.services.languageDetector&&!this.services.languageDetector.async?d(this.services.languageDetector.detect()):!t&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(d):this.services.languageDetector.detect(d):d(t),s}getFixedT(t,n,s){const a=(c,d,...h)=>{let g;typeof d!="object"?g=this.options.overloadTranslationOptionHandler([c,d].concat(h)):g={...d},g.lng=g.lng||a.lng,g.lngs=g.lngs||a.lngs,g.ns=g.ns||a.ns,g.keyPrefix!==""&&(g.keyPrefix=g.keyPrefix||s||a.keyPrefix);const x=this.options.keySeparator||".";let N;return g.keyPrefix&&Array.isArray(c)?N=c.map(C=>(typeof C=="function"&&(C=Dx(C,{...this.options,...d})),`${g.keyPrefix}${x}${C}`)):(typeof c=="function"&&(c=Dx(c,{...this.options,...d})),N=g.keyPrefix?`${g.keyPrefix}${x}${c}`:c),this.t(N,g)};return zr(t)?a.lng=t:a.lngs=t,a.ns=n,a.keyPrefix=s,a}t(...t){var n;return(n=this.translator)==null?void 0:n.translate(...t)}exists(...t){var n;return(n=this.translator)==null?void 0:n.exists(...t)}setDefaultNamespace(t){this.options.defaultNS=t}hasLoadedNamespace(t,n={}){if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=n.lng||this.resolvedLanguage||this.languages[0],a=this.options?this.options.fallbackLng:!1,c=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const d=(h,g)=>{const x=this.services.backendConnector.state[`${h}|${g}`];return x===-1||x===0||x===2};if(n.precheck){const h=n.precheck(this,d);if(h!==void 0)return h}return!!(this.hasResourceBundle(s,t)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||d(s,t)&&(!a||d(c,t)))}loadNamespaces(t,n){const s=Ku();return this.options.ns?(zr(t)&&(t=[t]),t.forEach(a=>{this.options.ns.indexOf(a)<0&&this.options.ns.push(a)}),this.loadResources(a=>{s.resolve(),n&&n(a)}),s):(n&&n(),Promise.resolve())}loadLanguages(t,n){const s=Ku();zr(t)&&(t=[t]);const a=this.options.preload||[],c=t.filter(d=>a.indexOf(d)<0&&this.services.languageUtils.isSupportedCode(d));return c.length?(this.options.preload=a.concat(c),this.loadResources(d=>{s.resolve(),n&&n(d)}),s):(n&&n(),Promise.resolve())}dir(t){var a,c;if(t||(t=this.resolvedLanguage||(((a=this.languages)==null?void 0:a.length)>0?this.languages[0]:this.language)),!t)return"rtl";try{const d=new Intl.Locale(t);if(d&&d.getTextInfo){const h=d.getTextInfo();if(h&&h.direction)return h.direction}}catch{}const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=((c=this.services)==null?void 0:c.languageUtils)||new Nw(Pg());return t.toLowerCase().indexOf("-latn")>1?"ltr":n.indexOf(s.getLanguagePartFromCode(t))>-1||t.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(t={},n){const s=new gp(t,n);return s.createInstance=gp.createInstance,s}cloneInstance(t={},n=fh){const s=t.forkResourceStore;s&&delete t.forkResourceStore;const a={...this.options,...t,isClone:!0},c=new gp(a);if((t.debug!==void 0||t.prefix!==void 0)&&(c.logger=c.logger.clone(t)),["store","services","language"].forEach(h=>{c[h]=this[h]}),c.services={...this.services},c.services.utils={hasLoadedNamespace:c.hasLoadedNamespace.bind(c)},s){const h=Object.keys(this.store.data).reduce((g,x)=>(g[x]={...this.store.data[x]},g[x]=Object.keys(g[x]).reduce((N,C)=>(N[C]={...g[x][C]},N),g[x]),g),{});c.store=new kw(h,a),c.services.resourceStore=c.store}if(t.interpolation){const g={...Pg().interpolation,...this.options.interpolation,...t.interpolation},x={...a,interpolation:g};c.services.interpolator=new Ew(x)}return c.translator=new u0(c.services,a),c.translator.on("*",(h,...g)=>{c.emit(h,...g)}),c.init(a,n),c.translator.options=a,c.translator.backendConnector.services.utils={hasLoadedNamespace:c.hasLoadedNamespace.bind(c)},c}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const rs=gp.createInstance();rs.createInstance;rs.dir;rs.init;rs.loadResources;rs.reloadResources;rs.use;rs.changeLanguage;rs.getFixedT;rs.t;rs.exists;rs.setDefaultNamespace;rs.hasLoadedNamespace;rs.loadNamespaces;rs.loadLanguages;const C3=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,E3={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},I3=e=>E3[e],P3=e=>e.replace(C3,I3);let $w={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:P3,transDefaultProps:void 0};const $3=(e={})=>{$w={...$w,...e}},A3={type:"3rdParty",init(e){$3(e.options.react)}},T3="Clear",M3="Download",R3="Enable",O3="Reset",L3="Solarized",D3={" {count} ":" {{count}} Models","   ":"  Time ","()":"(Regenerate)","+ ":"+ Add Parameter","+ ":"+ Add Model","+ ":"+ Add Blank Shot","2D":"2D Anime","360":"360-degree full body showcase","3D":"3D Anime","AI ":"AI Chat","AI ":"AI Analysis Result","AI ...":"AI is analyzing the video...","AI ":"AI Image","AI ":"AI Image only supports image input","AI ":"AI Video","AI ":"AI returned invalid format","API Key 401":"API Key invalid or unauthorized (401), please check configuration","API Key ":"API Key not configured","API Model":"API Model","API RUNTIME MANAGEMENT":"API RUNTIME MANAGEMENT","API TYPE":"API TYPE","API and Model List":"API and Model List","API  Task ID":"API did not return Task ID","API ":"API Settings","API ":"API Runtime Management","API  JSON ":"API returned non-JSON format data","API ":"API Configuration Backup","API ":"API configuration imported successfully!","API":"API model:","API{api.modelName || api.id}":"API Model: {api.modelName || api.id}","Add Model":"Add Model","Blob ":"Blob has expired","Bright Light":"Bright Light",Clear:T3,"Dark Night":"Dark Night",Download:M3,Enable:R3,"GLOBAL API KEY  KEY":"GLOBAL API KEY (Optional, global default)","JSON ":"Invalid JSON format, please check before saving",LLM:"LLM Split","LLM: ":"LLM Split: Chat model in bottom left corner","Manage your third-party model interfaces.":"Manage your third-party model interfaces.","Midjourney ":"Midjourney English Prompt","Midjourney ":"Midjourney polling timeout","Model Library":"Model Library","ModelScope ":"Recommended for ModelScope","ModelScope ":"ModelScope polling timeout","ModelScope ":"ModelScope returned empty","PIL PNG  JPG ":"PIL not installed, Convert unavailable","PNG  JPG":"Convert PNG to JPG (Save Space)","Python ":"Python example",Reset:O3,Solarized:L3,"Sora 2 ":"Sora 2 synced","Sora ":"Sora Character Library","Sora ":"Sora polling timeout","Tapnow ":"Tapnow failed to start","V3.5.20-1  500ms  ( 100ms)":"V3.5.20-1 should be 500ms interval (was 100ms)","Veo ":"Veo polling timeout","[]":"[Fill in your story description here]",base64:"Base64 decode result is empty",oref:"oref Input",sref:"sref Input","{count} ":"{count} Models",'{{type}} "{{name}}" ':'{{type}} "{{name}}" Created Successfully!',"":"Storyboard","":"Character Sheet",:"Previous Frame"," ()":"Previous ()",:"Previous scene description",:"Upload File",":":"Last saved:",:"Move Up",:"Next Frame"," ()":"Next ()",:"Next scene description",:"Move Down",:"Download",:"Download failed",":":"Download failed:","":"Download failed, please retry",:"Download started",:"Download selected",:"Don't use model library",:"Not set",:"Unselect",:"items",:"files",:"projects","...":"ing...",:"Chinese",:"Generate prompts for selected keyframes",:"Theme",:"Previous Session",:"9-Grid Storyboard Script",:"Event handling performance",:"Bright Light",:"For selection only",:"Import script from upstream text node","...":"Task created, waiting for processing...","60s":"Task timeout (60s)",:"Optimization checklist",:"Low Angle",'\n JSON : [{"prompt": "1"}, {"prompt": "2"}, ...]\n JSON':`You are a storyboard script analysis expert. Please split the user provided script into shots, and generate a concise visual description prompt for each shot.
Output format as JSON array: [{"prompt": "Visual description of shot 1"}, {"prompt": "Visual description of shot 2"}, ...]
Output only JSON, no other content.`,"":"You are a scene description optimization expert. Please analyze the following prompt, keep only scene features (environment, buildings, backgrounds), and remove all characters, dialogue, and actions. Output scene features only.","":"You are a prompt optimization expert. Please analyze the following prompt, keep only character features (appearance, clothing, posture), and remove plot, action, dialogue, and background. Output character features only, in the following format:","AI":"You are a multimodal AI assistant that needs to provide continuous answers based on the entire conversation context.","JSON":"You are a film storyboard prompt optimization expert. Please expand details, camera language, and atmosphere while maintaining the original meaning. Output a prompt without explanations or JSON.","//JSON":"You are a prompt cleaning assistant. Please remove invalid/conflicting/sensitive words, keep core semantics more refined. Output a prompt without explanations or JSON."," AI ":"Use AI to intelligently split script"," http://127.0.0.1:9527/proxy":"Use http://127.0.0.1:9527/proxy"," {proxy}":"Use {proxy}",": https://your-domain.com/sora/v1/characters":"e.g.: https://your-domain.com/sora/v1/characters",": size/quality":"e.g.: size/quality","gemini-3-pro-image-preview":"e.g.: gemini-3-pro-image-preview","openai.image / jimeng.video":"e.g. openai.image / jimeng.video","":"e.g.: banana","1024x1024,2K,low,high":"e.g.: 1024x1024,2K,low,high","16:9 / ":"e.g.: 16:9 / Landscape","16:9 / ":"e.g.: 16:9 / Portrait","16:9,9:16":"e.g.: 16:9,9:16","1:1 / ":"e.g.: 1:1 / Portrait","1:1 / ":"e.g.: 1:1 / HD","1:1,16:9":"e.g.: 1:1,16:9","1K,2K,4K":"e.g.: 1K,2K,4K","5s / ":"e.g.: 5s / Fast","5s,10s":"e.g.: 5s,10s","720P,1080P":"e.g.: 720P,1080P",:"Save","/":"Save/Done","...":"Saving...",:"Save to Local",:"Save History Assets",":":"Save failed:",:"Save Template","Zip":"Save asset bundle (Zip)",:"Save Project","/":"Save history images/videos to file when saving project (increases file size).",:"Rename",:"Modify Override",:"Stop",:"Stop Generation",:"Allow Output"," API Key Key":"Global API Key (optional, global default key)",:"Global Queue",:"Fullscreen",:"All Ratios",:"Select All","/":"Select All/Unlock","/":"Select All/Unlock (Grayed items won't be batch generated)",:"Expand All",:"Collapse All",:"All Assets",:"Rebuild All Thumbnails",:"Close",:"Hide banner and disable cache when off",:"Disable Local Cache",:"Other Settings",:"Memory usage",:"Realistic",:"Warm/Cool Contrast",:"Resolution",":":"Split failed:","9":"Split failed: Unable to generate 9 images","/":"Switch Chinese/English",:"Toggle Theme",:"Switch to Image Generation Mode",:"Switch to Video Generation Mode",:"Switch language","...":"Creating...",:"Create Scene","...":"Creating Scene...",:"Creation Failed"," ":"Creation failed: Original task expired or inaccessible. Please try to get the video download link and use",:"Create Character","...":"Creating Character...",:"Delete",:"Delete Provider",:"Delete Parameter",:"Delete This Frame",:"Delete Character",:"Delete Shot",:"To",:"Refresh",:"Refresh Status","":"Refresh Cache (Re-download to new path)",:"Load Project",API:"Jimeng API proxy service missing required modules",:"Jimeng Chinese Prompt",:"Jimeng img2img uses local files","()+++()...":"Jimeng prompt: Must include camera movement. Format: (camera description)+subject+environment+style. e.g.: (rapid dolly out), a young man with black hair sitting on a virtual throne, wearing a black coat...",:"History",:"All history thumbnails rebuilt",:"History",:"Original task expired or inaccessible",:"Original",:"Original task status check timeout","ZOOM":"Original task timeout, cannot perform ZOOM operation",:"Params",:"Parameter Value"," size / quality / model":"Parameter Name (e.g. size/quality/model)",:"Parameter Error",:"Send",:"Send to Chat",:"Send to Canvas","...":"Send message...",:"Cancel",:"Deselect All",:"Cancel Edit",:"Cancel Output",:"Deselect",:"Variable Examples",": {{prompt}}, {{duration:number}}, {{image:blob}}, {{size}}":"Variable Examples: {{prompt}}, {{duration:number}}, {{image:blob}}, {{size}}",:"Drag images to insert",:"Startup timeout",:"Enable","FormDataURL":"Forces Jimeng img2img to use local files (FormData); URL images auto-downloaded.",:"Enable Local Cache",:"Re-download when caching",JSON:"Response is not valid JSON format",:"Response parser"," 1 ":"Image 1 Input"," 2 ":"Image 2 Input","":"ImageImage","":"ImageVideo","":"ImageVideo",:"Image Comparison",:"Image comparison only supports image input",:"Image","API":"Image upload failed, cannot expand. Please check network connection and API configuration.",:"Image Save Path",:"Image Resolution",:"Image loading failed",:"Image loading timeout","":"Image processing failed, please check image URL or CORS settings","":"Image processing failed: Unable to get image data","":"Image data format error: All image data is invalid",:"Image Ratio",:"Image Input",:"Image Preview",:"Image-to-image requires a prompt",:"Insert new shot here",:"Scene",:"Scene Name",:"Scene Description",:"Basic Settings",:"Enhance Scene Description",:"Enhance Character Description",:"Copy",:"Copy failed",:"Copy Link",:"Copy error details",:"Appearance Keywords",:"Multi-Image Reference Toggle",":":"Failed:"," Key Key":"If you don't want to fill in Key for each model, you can fill in a global Key here",:"Subfolder",:"Complete",:"Finish Editing",:"Timer density test",:"Laboratory Features",:"Import"," API Keys":"Import API Keys",":":"Import failed:",:"Import Workflow"," API Keys":"Export API Keys"," KeyProvider  ( Key)":"Includes: Global Key, Provider config, Model library, All model configs (including Keys)"," KeyProvider  Key":"Export includes: Global Key, Provider Config, Model Library, All Model Configs (Incl. Keys)","/":"Bundle history images/videos and project files on export for offline recovery.",:"Novel Input",:"Last Frame",:"Last Frame Input",:"Inpainting",:"Expand",:"Expand Send To",:"Expand Subdirectory",:"Expand All",:"Expand Prompt",:"Expand Script Input",:"Expand Video",:"Expand Output Preview",:"Workflow","":"Workflow saved successfully!",:"No node data in workflow file",":":"Saved:","":"Already saved, not saved again",:"Enabled",:"Enhanced prompt",:"Copied to clipboard",":":"Copied character tag:",:"Ready",:"Manually terminated","":"9-Grid storyboard prompt generated!","":"HD upscale prompt generated!","":"Cache refresh triggered, will rewrite to local cache path",:"Mask area set",:"Filtered prompt",:"Local Service Connected",:"Selected"," {{count}} ":"Selected {{count}} items",":":"Selected keyframes:",:"Mask area linked",:"Age range or age"," (0=)":"Concurrency (0=All)",:"Parallel","":"An error occurred during startup. Black screen protection enabled.",:"Ignore existing files if enabled",:"Start",:"Start fully automatic video analysis",:"Start Generate",:"Async Mode","Blob URL":"Reference image expired (Blob URL), please re-add image to canvas",:"frames",:"keyframes",:"Current storyboard only supports image reference"," ":"Current shot has content, overwrite? Click",:"Current Frame",:"Current scene description",:"Current node only supports image reference",:"Files to Save",:"Gender",:"Performance Mode","":"Performance mode off (click to enable)",":":"Total duration:",:"Total"," />500MB Chrome  Edge  ":"Your browser doesn't support streaming large files. If project contains many images/videos (>500MB), Chrome or Edge is recommended. Continue with traditional save? (May cause memory overflow)"," ":"Your browser doesn't support streaming large files. Continue with traditional save?",:"Mood Board"," Ctrl+V ":"Or Ctrl+V to paste",:"Or send from history to preview here",:"Or drag and drop image here","\\n\\n {{count}} \\n\\n \\n \\n\\n":"All shots generated.\\n\\nAbout to regenerate {{count}} unlocked (unchecked) shots.\\n\\n Continuing will overwrite existing outputs (assets viewable on left)\\n Locked (checked) shots will remain unchanged\\n\\nContinue?"," ":"All shots are locked (grayed items checked), cannot regenerate. Please uncheck shots to regenerate.",":":"Package failed:","":"Packaging failed, please check console","":"Packaging complete, downloaded",:"Open Character Library",:"Batches",:"Batch",:"Batch Download","/":"Batch download selected image/video nodes",:"Batch Delete",:"Batch Manage",:"Batch Asset Manager",:"Cannot find associated video node",:"Collapse",:"Collapse All",:"Collapse Prompt","...":"Extracting...",:"Frame Thumbnails","...":"Splitting...",:"Drag to move window",:"Queued",:"API and Model List",:"API Type",:"API Config","":"API: ","":"Describe main action, e.g.: Character suddenly stands from throne, cape flying","...":"Extracted narration...",:"Extract Characters and Scenes",:"Prompt",:"Prompt cannot be empty","ID":"Tip: Mapping prompt name is for display only, Model ID is for actual call; empty list uses default limits.","":"Tip: Click Refresh Cache after changing path",:"Insert Character"," (Ctrl+Z)":"Undo (Ctrl+Z)","/":"Undo/Redo Steps"," MP4/WEBM Ctrl+V ":"Supports MP4/WEBM (Drag/Ctrl+V not supported)",:"Collapse",:"Collapse Video",:"Collapse Output Preview","":"TextImage","":"TextVideo","":"TextVideo",":":"File name:",:"Text",:"Text Node",:"New Chat","":"New empty project (clear current content)",:"New Character",:"News",:"Method",:"None",:"Cannot group keyframes","":"Cannot load video preview, please check URL validity or CORS restrictions"," ( Chrome DevTools Protocol)":"Unavailable (requires Chrome DevTools Protocol)",:"Cannot read video duration",:"Daylight",:"Duration"," 1-3 ":"Time range must be between 1-3 seconds"," 1-3 ":"Time Range (seconds, 1-3s interval)",:"Mapped prompt name","":"Display Name (Show Only)",:"Show Settings","":"Normal mode (click for Ultra)",:"Smart Storyboard",:"Smart Storyboard",:"Smart Extract",":":"Smart extraction failed:",:"Pause list cleared",:"Pending","==":"Pending=Select all output, Reselect=Deselect all","":"No shots yet, please add or sync analysis results",:"No files to save","''":"No characters yet, click 'New Character' to start",:"Low Light",:"Change",:"Change Video",:"Final request preview","":"Some shots are generating, please wait until complete.",:"Server Address",:"Disabled",:"Untitled Scenes",:"Untitled Project"," (: #1 )":"No storyboard markers found in text (e.g.: #1 shot content). Please check upstream node text format.",:"Not Referenced"," Sora 2 ":"Sora 2 model configuration not found"," Sora 2  Sora 2  Sora 2 Pro":"Sora 2 model not found, please configure Sora 2 or Sora 2 Pro in settings first"," project.json":"project.json not found",URL:"Video URL not found",:"Selected node not found",": #1  #2 ":"No valid storyboard detected. Use format: #1 description #2 description",:"Unknown Error",URL:"Cannot find image URL in response",ZOOMID:"ZOOM task ID not obtained",ID:"Task ID not obtained",:"No custom params set",:"Disconnected",:"Local",:"Local Proxy",:"Local Service Address",:"Local service address is empty",:"Local service connected",:"Local service connection failed",:"Local cache disabled",:"Local cache connected"," - ":"Local cache connected - Images will be read from local first",:"Local cache disconnected",:"Local cache index updated",:"Local cache index update failed",:"Local Cache Settings",:"Current Session","":"Ultra mode (click to disable)",:"Ultra Mode",:"Ultra Fast"," ()":"View Large (Double-click also works)",:"View Request Preview",": #1  #2  ...":"Format: #1 First shot description #2 Second shot description ...",' {{count}} \n\n\n\n\n  "1"  "ok" = \n  "2"  "skip" = \n  = ':`Detected {{count}} shots generating.

Tasks may be stuck or waiting.

Please select action:
 Enter "1" or "ok" = Force stop and restart
 Enter "2" or "skip" = Skip these shots, continue others
 Cancel or leave empty = Abort`,:"Model","ID":"Model ID (System Call)",:"Model Library","":"Model library:","":"Model Lib: None",:"Model API Configuration"," JSON ":"Model did not return valid JSON format",:"Invalid model configuration",:"Packaging...","...":"Generating image...",:"Per Batch",:"Atmosphere Keywords",:"No valid resources to download",:"No resources to download",:"No files to save",:"No available image URL",:"No images to rebuild",:"No shots to generate",:"Light",:"Test",:"Test complete",:"Browse","":"Browser cannot read local path, please enter manually",:"Dark",:"Add Provider",:"Add Parameter",:"Add Model",:"Add Blank Shot",:"Clear Cache",:"Clear",:"Clear All Thumbnails",:"Clear All Shots",:"Clear Queue",:"Clear Paused",:"Clear Blacklist",:"Clear Cache",:"Comic","''":"Click 'Start Extract' to begin analysis","":'Click "Start Extraction" to begin analysis',"":'Click "Auto Extract" to generate thumbnails',:"Click to edit project name",:"Click or Drag Video Here",:"Circuit Breaker",:"Circuit breaker reset",": 30":"Status code: 30",:"Environment Description",:"Generated","\n":"Generation History","\\n":"Generation History",_:"Generation History","...":"Generating...",:"Generation History",:"Generated Image",:"Generate Image",:"Create Image-to-Image Node",:"Generate Scene Image",:"Generate Scene Video",:"Generate Video",:"Generate Character Image",:"Generate Character Video","":"Connects to local backend for large file saving/processing.",:"Time","...":"Scene description...",:"Language"," (34010105)":"Login expired (34010105)",:"OK","":"Clear all queued tasks?","":"Remove this task from queue?","":"Remove this queued task?","":"Stop all generation for this node and clear queue?","":"Stop all generation and clear queue?","":"Stop this generation task?","":"Delete this shot?","":"Clear all frame thumbnails?","":"Clear all shots?",:"Confirm",:"Example Prompt",:"Seconds",": ":"Seconds (Interval: "," (1006)":"Credits exhausted (1006)"," (402)":"Credits exhausted (402)",:"Remove Task",:"Remove from Queue",:"Rule Split",": #1 #2 ":"Program split: #1 #2 or newline"," 2 ":"First image is the first frame, second is the last frame (max 2)",:"Narration for first second",:"Narration for third second",:"Narration for second second",:"Waiting","...":"Waiting to generate prompt...",:"Manage","":"Manage your third-party model interfaces.",:"Pipeline",ID:"System Model ID","ID":"System Call Model ID: ",:"Stop Task",:"Terminate All","":"Unified maintenance of model capabilities and limits; vendor models can be referenced directly.",:"Cache fetch failed",": ":"Cache fetch failed: Empty file",": ":"Cache fetch failed: Empty URL",:"Edit",:"Edit Request",:"Edit Project Name",:"Edit Preview",:"Thumbnail",:"Thumbnail updated",:"Script",:"Auto"," ()":"Auto Save (New Images)","":"Auto Save (New Images)",:"Auto Extract","2fps":"Auto Extract (2fps)","":"Auto arrange nodes (align, arrange, remove stacking)"," LLM  Prompt":"Custom LLM Split Prompt",:"Custom Params","":"Custom name (e.g.: Soft Light Portrait)",:"Selfie",:"Nodes",:"English",:"Mask conversion failed",:"Override same-name parameter",:"Video",:"Video Save Path",:"Video Resolution",:"Video loading failed","":"Video loading failed, please check format or CORS settings",:"Video Scene Description",:"Video frame extraction failed"," / ":"Video Analysis / Prompt Inference","":"Video analysis node has no results, please run analysis first",:"Video Duration",:"Video Ratio",URL:"Video node has no video URL"," AI":"Video conversion failed, cannot send to AI"," / ":"Video Input / Keyframe Organization",:"Video Preview",:"Character",:"Character & Scene Extraction",:"Character Name",:"Character appearance and personality description",:"Characters",:"Character Description",:"Parse failed or no valid result","/":"Parse failed: No usable character/scene data obtained"," (401)":"Authentication failed (401)","":"Max undo steps (paste images, delete nodes, etc.)"," (403)":"Access denied (403)","(Dolly Zoom Out) (Orbit)":"Describe camera movement, e.g.: rapid dolly zoom out, or orbit shot",:"Language"," API  Key":"Please configure Key in API settings first",:"Please select keyframes in video input node first"," API Key":"Please configure API Key in settings first",:"Please split script first",:"Please enter storyboard script first",:"Please enter novel content first",:"Please enter novel content or connect novel input node",:"Please enter prompt first",:"Please enter prompt or add reference image",:"Please enter prompt or select image",:"Please connect a video input node with video first",:"Please connect a video analysis node first",:"Please connect a video input node first",:"Please connect video input node and select keyframes first",AI:"Please select an AI Image node first",:"Please select an image node first",:"Please select a shot in storyboard first",:"Please select one first",'""':'Please select an "Image Input" node first',:"Please select an image model first",:"Please select a video model first",:"Please select analysis model first",:"Please select LLM first",:"Please select model first",:"Please select image or video nodes to download first",:"Please select nodes to save first"," API Key":"Please configure API Key first"," Midjourney API":"Please configure Midjourney API first"," Midjourney API Key":"Please configure Midjourney API Key first","JSON":"Please analyze this video. Output analysis report strictly in JSON format.","''":"Please select analysis model in 'Extract Characters and Scenes' node",:"Please enter scene name",:"Please enter character name"," (JSON / Raw)":"Body (JSON / Raw)",:"Request body must be an object",:"Body Type","JSON / Raw":"Body (JSON / Raw)"," (JSON)":"Headers (JSON)",:"Request headers must be an object","JSON":"Headers (JSON)",:"Request Template"," JSON ":"Request template JSON format invalid",:"Request template is empty",:"Request template saved",:"Request override updated","120":"Request timeout (120s), video analysis may take longer, please retry later","":"Request timeout, please check network or retry later",:"Request Path"," JSON ":"Request preview JSON invalid",:"Request preview must be an object","JSON":"Request preview (JSON)",:"Please fill in scene description or prompt",:"Please select at least two nodes for auto arrange",:"Please enter name and prompt content",:"Please enter prompt or connect reference image",:"Please enter local service address"," URL":"Please enter video URL",:"Please connect a video input node","AIgen-image":"Please select an AI Image node (gen-image)",:"Please select video from history","":"Please select image generation node to upscale."," Chat  Key":"Please configure Chat model Key",:"Cyberpunk","":"Cyberpunk, cold, high-tech","ms":"Timeout (ms)"," Provider":"Follow Provider",:"Path updated","":"Path update failed, please confirm allowed directory","//":"Identity/Occupation/Setting",:"Rounds",:"Input","...":"Enter image generation prompt...","...":"Enter scene name...","10,000...":"Enter novel content (max 10,000 characters)...","...":"Enter prompt...","...":"Enter prompt content...","...":"Enter text content..."," LLM  Prompt...":"Enter custom LLM split prompt..."," URL...":"Enter video URL...","...":"Enter video generation prompt...","/...":"Enter character/scene description prompt...","...":"Enter character name...",:"Output",:"Run"," {running}   {pending}":"Running {{running}}  Pending {{pending}}","":"Response empty, please retry"," id  username":"Response data missing id or username"," ":"This is not a valid workflow file. Please use"," AI  / AI  ":"Connect AI Image / AI Video node",'\n\n1. API \n   -  API  "/sora" \n   -  Sora \n\n2.  (CORS)\n   - ':`Connection failed. Possible reasons:

1. Incorrect API address
   - Check if '/sora' prefix is redundant
   - Verify exact path with provider

2. CORS restrictions
   - Check network connection`,"":"Connection failed, please check local service address",:"Exit Fullscreen",:"Selected node has no image content",:"Selected project has no valid assets",:"Selected item has no local cache to clear",:"Select","...":"Select video from history...",:"Select Image",:"Select Last Frame",:"Select First Frame"," (Ctrl+Shift+Z)":"Redo (Ctrl+Shift+Z)",:"Rebuild Thumbnails",:"Reload",:"Regenerate",:"Reset",:"Reset Circuit Breaker",:"Reselect",1:"Shot 1 scene description",2:"Shot 2 scene description",:"Hide Settings",:"Hide Request Preview",":  Line 2511":"Manual check required: see source Line 2511",":  Line 3569-3570":"Manual check required: see source Line 3569-3570",":  Line 51-60":"Manual check required: see source Line 51-60",:"items","":"Project saved successfully!",:"Project Name","":"Project packaged and saved!",:"Preview"," JSON ":"Preview JSON must be an object",:"Preview Original",:"Preview parameters updated",:"Preview Image",:"Preview Window",:"Style Keywords",:"First/Last Frame",:"First Frame",:"First Frame Input",:"HD Upscale"," =  =  (60)  = 1006":"Blacklist = Credits depleted, Paused = Temporary error (auto-resume after 60 mins), Circuit Brk = Short-term 1006 error protection"," =  = 60 = 1006":"Blacklist = Credits depleted, Paused = Temporary error (60m auto-resume), Circuit Breaker = Short-term 1006 protection",:"Blacklist cleared"," history":"Default use history"},U3=()=>"zh",F3={zh:{translation:{}},en:{translation:D3}};rs.use(A3).init({resources:F3,lng:U3(),fallbackLng:"zh",interpolation:{escapeValue:!1},returnEmptyString:!1});(function(){const e=console.error,t=console.warn,n=console.log,s=a=>{for(let c of a){let d="";if(typeof c=="string"?d=c:c&&typeof c=="object"?c.message?d=c.message:c.toString?d=c.toString():d=JSON.stringify(c):c!=null&&(d=String(c)),d.includes("Unable to preventDefault inside passive event listener")||d.includes("passive event listener invocation")||d.includes("preventDefault")&&d.includes("passive"))return!0}return!1};console.error=function(...a){s(a)||e.apply(console,a)},console.warn=function(...a){s(a)||t.apply(console,a)},console.log=function(...a){s(a)||n.apply(console,a)}})();const td={x:0,y:0,zoom:1},j=rs.t.bind(rs),B3=({canvasRef:e,isDrawing:t})=>{const[n,s]=M.useState(""),a=M.useRef(null),c=M.useCallback(()=>{e.current&&s(e.current.toDataURL())},[e]);return M.useEffect(()=>{e.current&&c()},[e,c]),M.useEffect(()=>{if(!t){c();return}const d=()=>{c(),t&&(a.current=requestAnimationFrame(d))};return a.current=requestAnimationFrame(d),()=>{a.current&&cancelAnimationFrame(a.current)}},[t,c]),n?i.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{background:"rgba(255, 0, 0, 0.3)",mixBlendMode:"multiply",WebkitMaskImage:`url(${n})`,maskImage:`url(${n})`,WebkitMaskSize:"100% 100%",maskSize:"100% 100%",WebkitMaskRepeat:"no-repeat",maskRepeat:"no-repeat"}}):null},as=(()=>{const e="tapnow_images_db",n="images";let s=null,a=null;const c=new Map,d=()=>a||(a=new Promise((_,R)=>{if(!window.indexedDB){console.warn("[LocalImageManager] IndexedDB not supported, falling back to memory"),_(null);return}const $=indexedDB.open(e,1);$.onerror=L=>{console.error("[LocalImageManager] IndexedDB init failed:",L.target.error),_(null)},$.onsuccess=L=>{s=L.target.result,console.log("[LocalImageManager] IndexedDB initialized"),_(s)},$.onupgradeneeded=L=>{const S=L.target.result;S.objectStoreNames.contains(n)||(S.createObjectStore(n,{keyPath:"id"}).createIndex("timestamp","timestamp",{unique:!1}),console.log("[LocalImageManager] Object store created"))}}),a),h=()=>`img_${Date.now()}_${Math.random().toString(36).substring(2,9)}`;return{saveImage:async(_,R=null)=>{const $=await d();if(!$)return null;const L=R||h();return new Promise((S,P)=>{var O;try{let K;if(typeof _=="string"&&_.startsWith("data:")){const he=_.split(","),ze=((O=he[0].match(/:(.*?);/))==null?void 0:O[1])||"image/png",ot=atob(he[1]),re=new Uint8Array(ot.length);for(let Se=0;Se<ot.length;Se++)re[Se]=ot.charCodeAt(Se);K=new Blob([re],{type:ze})}else if(_ instanceof Blob)K=_;else{console.warn("[LocalImageManager] Invalid data type for saveImage"),S(null);return}const ue=$.transaction([n],"readwrite").objectStore(n),oe={id:L,blob:K,timestamp:Date.now(),size:K.size},we=ue.put(oe);we.onsuccess=()=>{S(L)},we.onerror=he=>{console.error("[LocalImageManager] Save failed:",he.target.error),S(null)}}catch(K){console.error("[LocalImageManager] Save error:",K),S(null)}})},getImage:async _=>{if(c.has(_))return c.get(_);const R=await d();return R?new Promise($=>{try{const P=R.transaction([n],"readonly").objectStore(n).get(_);P.onsuccess=()=>{const O=P.result;if(O&&O.blob){const K=new FileReader;K.onloadend=()=>{const Q=K.result;c.set(_,Q),$(Q)},K.onerror=()=>{console.error("[LocalImageManager] Failed to convert blob to base64"),$(null)},K.readAsDataURL(O.blob)}else $(null)},P.onerror=()=>$(null)}catch(L){console.error("[LocalImageManager] Get error:",L),$(null)}}):null},deleteImage:async _=>{const R=await d();if(!R)return!1;if(c.has(_)){const $=c.get(_);$&&$.startsWith("blob:")&&URL.revokeObjectURL($),c.delete(_)}return new Promise($=>{const P=R.transaction([n],"readwrite").objectStore(n).delete(_);P.onsuccess=()=>$(!0),P.onerror=()=>$(!1)})},getStats:async()=>{const _=await d();return _?new Promise(R=>{const S=_.transaction([n],"readonly").objectStore(n).getAll();S.onsuccess=()=>{const P=S.result||[],O=P.reduce((K,Q)=>K+(Q.size||0),0);R({count:P.length,totalSize:O})},S.onerror=()=>R({count:0,totalSize:0})}):{count:0,totalSize:0}},isImageId:_=>typeof _=="string"&&_.startsWith("img_"),initDB:d}})();window.LocalImageManager=as;const yo=e=>!e||typeof e!="string"||!e.startsWith("data:")?e:e.replace(/\s+/g,""),H3=e=>{if(!e)return"";let t=e.replace(/\s+/g,"");if(/%[0-9A-Fa-f]{2}/.test(t))try{t=decodeURIComponent(t)}catch{}t=t.replace(/-/g,"+").replace(/_/g,"/"),t=t.replace(/[^A-Za-z0-9+/=]/g,"");const n=t.length%4;return n&&(t+="=".repeat(4-n)),t},Ql=e=>{const n=yo(e).match(/^data:([^;,]+)(;base64)?,(.*)$/i);if(!n)return null;const s=n[1]||"application/octet-stream",a=!!n[2];let c=n[3]||"";if(!a)try{return new Blob([decodeURIComponent(c)],{type:s})}catch{return new Blob([c],{type:s})}c=H3(c);let d="";try{d=atob(c)}catch{return null}const h=new Uint8Array(d.length);for(let g=0;g<d.length;g++)h[g]=d.charCodeAt(g);return new Blob([h],{type:s})},V3=(e,t)=>{if(!e||!t||t<=0)return e||"";const n=new TextEncoder;let s=0,a="";for(const c of e){const d=n.encode(c).length;if(s+d>t)break;a+=c,s+=d}return a.length<e.length?`${a}...`:a},nn=({src:e,className:t,alt:n,onError:s,onLoad:a,...c})=>{const[d,h]=M.useState(null),[g,x]=M.useState(!1),[N,C]=M.useState(!1),A=M.useRef(null);return M.useEffect(()=>{var _;if(x(!1),!e||e.startsWith("blob:")||e.startsWith("http://")||e.startsWith("https://")){h(e),C(!1);return}if(as.isImageId(e)){C(!0),(async()=>{try{const $=await as.getImage(e);if($)A.current=$,h($);else{const L=O2(e);L?(A.current=L,h(L)):(console.warn(`[LazyBase64Image] Image not found in IDB: ${e}`),x(!0))}}catch($){console.error("[LazyBase64Image] IDB resolve failed:",$),x(!0)}C(!1)})();return}if(e.startsWith("data:")){const R=yo(e);if(typeof window<"u"&&((_=window.location)==null?void 0:_.protocol)==="file:"){A.current=R,h(R),C(!1);return}(async()=>{try{const S=Ql(R);if(!S){x(!0),h(null);return}const P=URL.createObjectURL(S);A.current=P,h(P)}catch(S){console.warn("Base64Blob",S),x(!0),h(null)}})()}else h(e);return()=>{A.current&&A.current.startsWith("blob:")&&(URL.revokeObjectURL(A.current),A.current=null)}},[e]),N||g&&!d||!d||as.isImageId(d)?null:i.jsx("img",{src:d,className:t,alt:n,onError:s,onLoad:a,...c})},pa=({src:e,className:t,onError:n,onLoadedMetadata:s,...a})=>{const[c,d]=M.useState("");return M.useEffect(()=>{let h=!0;return e?as.isImageId(e)?((async()=>{const g=await as.getImage(e);if(h)if(g)d(g);else{const x=O2(e);d(x||"")}})(),()=>{h=!1}):(d(e),()=>{h=!1}):(d(""),()=>{h=!1})},[e]),c?i.jsx("video",{src:c,className:t,onError:n,onLoadedMetadata:s,...a}):null},W3=M.memo(({item:e,idx:t,imgUrl:n,displayImgUrl:s,theme:a,canDrag:c,lightboxItem:d,onImageClick:h,onImageContextMenu:g,onCacheMissing:x,handleDragStart:N,language:C})=>{const[A,_]=M.useState(!1);M.useEffect(()=>{_(!1)},[s]);const R=e.selectedMjImageIndex===t&&d&&d.id===e.id,$=a==="dark"?"text-zinc-500":"text-[#616161]";return i.jsxs("div",{onClick:L=>h&&h(L,e,n,t),onContextMenu:L=>g&&g(L,e,n,t),onDragStart:L=>{c&&(L.stopPropagation(),N(L,n))},draggable:c,className:`relative w-full h-full cursor-pointer border-2 transition-all overflow-hidden ${R?"border-blue-500 scale-95":"border-transparent hover:border-blue-500/50"}`,children:[i.jsx(nn,{src:s,loading:"lazy",className:"w-full h-full object-contain",alt:"",onLoad:()=>_(!0),onError:L=>{_(!1),console.error(` ${t+1} `),x&&x(e.id,s),L.target.style.display="none"}}),!A&&i.jsxs("div",{className:`absolute inset-0 flex items-center justify-center text-[12px] ${$} pointer-events-none select-none`,style:{fontFamily:'"Microsoft YaHei","","KaiTi","",serif'},children:[j(""),t+1]}),R&&i.jsx("div",{className:"absolute top-1 right-1 w-3 h-3 bg-blue-500 rounded-full flex items-center justify-center z-10",children:i.jsx("svg",{className:"w-2 h-2 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:i.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]})}),rd=({label:e,values:t,onChange:n,placeholder:s,addLabel:a="+",formatItem:c=R=>R,disabled:d=!1,inputDisabled:h=!1,theme:g="dark",allowAll:x=!1,allowAllLabel:N="",onToggleAll:C=null,normalizeItem:A=R=>R,maxItems:_=1/0})=>{const[R,$]=M.useState(""),L=Array.isArray(t)?t:[],S=d||h,P=Number.isFinite(_)?_:1/0,O=L.length>=P,K=()=>{if(S||O)return;const ue=R.trim();if(!ue)return;const oe=ue.split(",").map(he=>he.trim()).filter(Boolean);if(oe.length===0)return;const we=[...L];oe.forEach(he=>{const ze=A(he);we.length>=P||ze&&!we.includes(ze)&&we.push(ze)}),n(we),$("")},Q=ue=>{S||n(L.filter(oe=>oe!==ue))};return i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${g==="dark"?"text-zinc-500":"text-zinc-600"}`,children:e}),Number.isFinite(P)&&P!==1/0&&i.jsxs("span",{className:`text-[9px] ${g==="dark"?"text-zinc-600":"text-zinc-500"}`,children:["(",L.length,"/",P,")"]})]}),N&&i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${g==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:!!x,onChange:ue=>C&&C(ue.target.checked),disabled:d}),i.jsx("span",{children:N})]})]}),i.jsx("div",{className:"flex flex-wrap gap-1 min-h-[18px]",children:L.length>0?L.map(ue=>i.jsxs("span",{className:`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] ${g==="dark"?"bg-zinc-800 text-zinc-300":"bg-zinc-100 text-zinc-600"}`,children:[c(ue),!S&&i.jsx("button",{onClick:()=>Q(ue),className:`${g==="dark"?"text-zinc-500 hover:text-red-400":"text-zinc-400 hover:text-red-500"}`,children:"x"})]},ue)):i.jsx("span",{className:`text-[9px] ${g==="dark"?"text-zinc-600":"text-zinc-400"}`,children:""})}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("input",{type:"text",value:R,onChange:ue=>$(ue.target.value),onKeyDown:ue=>{ue.key==="Enter"&&(ue.preventDefault(),K())},placeholder:s,disabled:S,className:`flex-1 rounded px-2 py-1 text-[10px] outline-none border ${g==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`}),i.jsx("button",{onClick:K,disabled:S||!R.trim()||O,className:`px-2 py-1 rounded text-[10px] ${S||!R.trim()||O?g==="dark"?"bg-zinc-800 text-zinc-600 cursor-not-allowed":"bg-zinc-100 text-zinc-400 cursor-not-allowed":g==="dark"?"bg-zinc-700 text-zinc-200 hover:bg-zinc-600":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"}`,children:a})]})]})},K3=({visible:e,progress:t,status:n,type:s})=>e?i.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/40 backdrop-blur-[2px] animate-in fade-in duration-300 pointer-events-none select-none",children:i.jsxs("div",{className:"relative bg-[#09090b]/90 border border-white/10 rounded-2xl p-8 shadow-2xl flex flex-col items-center min-w-[300px] backdrop-blur-xl",children:[i.jsx("div",{className:"absolute -top-10 left-1/2 -translate-x-1/2 w-20 h-20 bg-blue-500/20 blur-[50px] rounded-full pointer-events-none"}),i.jsxs("div",{className:"flex flex-col items-center gap-1 mb-6 z-10",children:[i.jsx("span",{className:"font-mono text-[10px] tracking-[0.3em] uppercase text-zinc-500",children:s==="import"?"DATA INGESTION":"SYSTEM ARCHIVING"}),i.jsxs("div",{className:"text-4xl font-bold text-zinc-200 tracking-tighter font-sans",children:[t.toFixed(0),i.jsx("span",{className:"text-sm text-zinc-500 ml-1",children:"%"})]})]}),i.jsx("div",{className:"relative w-full h-[2px] bg-zinc-800 rounded-full overflow-hidden mb-4",children:i.jsx("div",{className:"absolute top-0 left-0 h-full bg-white shadow-[0_0_10px_rgba(255,255,255,0.5)] transition-all duration-100 ease-linear",style:{width:`${t}%`}})}),i.jsx("span",{className:"text-[10px] font-mono text-zinc-400 tracking-widest uppercase animate-pulse",children:n})]})}):null,Aw=M.memo(({item:e,theme:t,lightboxItem:n,onDelete:s,onClick:a,onContextMenu:c,onImageClick:d,onImageContextMenu:h,onRefresh:g,onRebuildThumbnail:x,performanceMode:N,localServerUrl:C,localCacheActive:A,onCacheMissing:_,getHistoryMeta:R,isSelected:$,onSelect:L,providers:S,defaultProviders:P,historyLocalCacheMap:O,resolveHistoryUrl:K,isLocalCacheUrlAvailable:Q,language:ue})=>{var mn,Kr,ns;const oe=Array.isArray(e.mjImages)&&e.mjImages.length>1?e.mjImages:Array.isArray(e.output_images)&&e.output_images.length>1?e.output_images:null,we=e.url||e.originalUrl||e.mjOriginalUrl||(oe&&oe.length>0?oe[0]:null),ze=(A&&we?O&&O.has(we)?O.get(we):e.localCacheMap?e.localCacheMap[we]:null:null)||e.localCacheUrl||(e.localCacheMap?Object.values(e.localCacheMap)[0]:null),ot=!!(A&&ze&&(!Q||Q(ze))),re=e.thumbnailUrl||null,Se=e.status==="completed"&&(e.type==="image"||oe&&oe.length>0),D=R?R(e):null,Me=D==null?void 0:D.modelLabel,Ut=(()=>{var E,Ce;if(Me)return Me;const St=((E=e.apiConfig)==null?void 0:E.modelId)||((Ce=e.apiConfig)==null?void 0:Ce.model)||e.model||e.modelName||"";return e.modelName&&e.provider&&e.modelName.toLowerCase()===e.provider.toLowerCase()?St:e.modelName||St})(),je=V3(Ut,15),_e=e.provider||((mn=e.apiConfig)==null?void 0:mn.provider)||"",be=St=>ot?ze:N!=="off"&&re?re:St,Xe=St=>{const E=be(St);return K?K(e,E):E},[de,fe]=M.useState(null),Ge=(St=null)=>K?K(e,St):St?A&&e.localCacheMap&&e.localCacheMap[St]?e.localCacheMap[St]:St:e.localCacheUrl||(e.localCacheMap?Object.values(e.localCacheMap)[0]:"")||e.originalUrl||e.mjOriginalUrl||e.url||"",gt=(St=null)=>{if(St)return Ge(St);if(oe&&oe.length>0){const E=e.selectedMjImageIndex??0,Ce=oe[E]||oe[0];if(Ce)return Ge(Ce)}return Ge()},We=(St,E=null)=>{const Ce=gt(E);if(!Ce)return;const Ee={source:"history",itemId:e.id,url:Ce,originalUrl:e.originalUrl||e.mjOriginalUrl||e.url||Ce,mjOriginalUrl:e.mjOriginalUrl||e.originalUrl||e.url||Ce,selectedIndex:e.selectedMjImageIndex??0};St.dataTransfer.effectAllowed="copy",St.dataTransfer.setData("application/x-tapnow-history",JSON.stringify(Ee)),St.dataTransfer.setData("text/uri-list",Ce),St.dataTransfer.setData("text/plain",Ce)};M.useEffect(()=>{const St=e.url||e.originalUrl||e.mjOriginalUrl,E=ot?ze:St,Ce=K?K(e,E):E;fe(Ce)},[e.url,e.originalUrl,e.mjOriginalUrl,ot,ze,K]),M.useEffect(()=>{!A||!ze||!_||Q&&!Q(ze)&&_(e.id,ze)},[A,ze,e.id,_,Q]);const Ir=(D==null?void 0:D.ratioLabel)??(e.ratio||e.mjRatio),Qr=(D==null?void 0:D.resolutionLabel)??(e.resolution||(e.width&&e.height?`${e.width}x${e.height}`:null)),br=(D==null?void 0:D.durationLabel)??(e.type==="video"&&e.duration?`${e.duration}s`:null),$r=(D==null?void 0:D.customParamLabels)||[];return i.jsxs("div",{className:`group rounded-lg overflow-hidden border relative cursor-pointer transition-colors ${$?"border-blue-500 ring-2 ring-blue-500/30":t==="dark"?"bg-zinc-900 border-zinc-800 hover:border-blue-500/50":"bg-white border-zinc-200 hover:border-blue-500/50"}`,style:{contentVisibility:"auto",containIntrinsicSize:"1px 300px"},onClick:a,onContextMenu:c,draggable:Se,onDragStart:Se?St=>We(St):void 0,children:[ot&&i.jsx("div",{className:"absolute top-1 left-1 z-10 px-1 py-0.5 rounded text-[8px] bg-black/60 text-green-300",children:j("")}),!ot&&N!=="off"&&re&&i.jsx("div",{className:`absolute top-1 left-1 z-10 px-1 py-0.5 rounded text-[8px] bg-black/60 ${N==="ultra"?"text-orange-400":"text-zinc-400"}`,children:j(N==="ultra"?"":"")}),L&&i.jsx("button",{onClick:St=>{St.stopPropagation(),St.preventDefault(),L(e.id)},className:`absolute bottom-2 right-2 z-20 w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${$?"bg-green-500 border-green-400 opacity-100":"border-white/60 bg-black/50 opacity-100 hover:bg-black/70"}`,title:j($?"":""),children:$&&i.jsx(ep,{size:16,className:"text-white"})}),i.jsxs("div",{className:`${t==="dark"?"bg-black":"bg-[#fafafa]"} relative ${oe&&oe.length>1||e.mjNeedsSplit&&((ns=(Kr=e.apiConfig)==null?void 0:Kr.modelId)!=null&&ns.includes("mj"))?(()=>{const St=e.mjRatio||"1:1";return St==="16:9"?"aspect-video":St==="9:16"?"aspect-[9/16]":St==="4:3"?"aspect-[4/3]":St==="3:4"?"aspect-[3/4]":St==="21:9"?"aspect-[21/9]":"aspect-square"})():"aspect-video"}`,children:[e.status==="completed"?oe&&oe.length>1?i.jsx("div",{className:`w-full h-full grid gap-0.5 p-0.5 ${oe.length===4?"grid-cols-2 grid-rows-2":"grid-cols-2"}`,children:oe.map((St,E)=>{e.mjImageInfo&&e.mjImageInfo[E];const Ee=(A&&e.localCacheMap?e.localCacheMap[St]:null)||(N!=="off"&&e.mjThumbnails&&e.mjThumbnails[E]?e.mjThumbnails[E]:St),ee=K?K(e,Ee):Ee;return i.jsx(W3,{item:e,idx:E,imgUrl:St,displayImgUrl:ee,theme:t,canDrag:Se,lightboxItem:n,language:ue,onImageClick:d,onImageContextMenu:h,onCacheMissing:_,handleDragStart:We},E)})}):e.type==="image"?i.jsx(nn,{src:Xe(e.url||e.originalUrl||e.mjOriginalUrl),loading:"lazy",className:"w-full h-full object-cover",alt:e.prompt||"",onError:St=>{const E=e.url||e.originalUrl||e.mjOriginalUrl,Ce=Xe(E);console.error(":",Ce||E),_&&_(e.id,Ce||E),St.target.style.display="none"}}):i.jsx(pa,{src:de||e.url||e.originalUrl,className:"w-full h-full object-cover",muted:!0,loop:!0,playsInline:!0,preload:"metadata",onError:()=>{const St=e.url||e.originalUrl||e.mjOriginalUrl;ot&&St&&de===ze?(fe(St),_&&_(e.id,ze)):console.error(":",St)}}):i.jsx("div",{className:"w-full h-full flex items-center justify-center",children:i.jsx(la,{className:"animate-spin text-zinc-600"})}),i.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-1 ${t==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:i.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${e.progress}%`}})})]}),i.jsxs("div",{className:`px-3 py-2 text-[11px] ${t==="solarized"?"bg-[#eee8d5]":""}`,children:[i.jsxs("div",{className:"flex justify-between items-start gap-2",children:[i.jsx("span",{className:`line-clamp-2 ${t==="dark"?"text-zinc-300":t==="solarized"?"text-black":"text-zinc-700"}`,children:e.prompt||"Untitled"}),i.jsxs("div",{className:`shrink-0 ml-1 ${e.type==="image"?"flex flex-col items-center gap-1":"flex items-center gap-1"}`,children:[e.type==="video"&&(e.status==="generating"||e.status==="failed")&&i.jsx("button",{onClick:St=>{St.stopPropagation(),g&&g(e)},className:`shrink-0 p-0.5 ${t==="dark"?"text-zinc-500 hover:text-white":t==="solarized"?"text-black hover:text-zinc-700":"text-zinc-400 hover:text-zinc-900"}`,title:j(""),children:i.jsx(hp,{size:12})}),i.jsx("button",{onClick:St=>{St.stopPropagation(),s&&s(e.id)},className:`shrink-0 p-0.5 ${t==="dark"?"text-zinc-500 hover:text-red-500":t==="solarized"?"text-black hover:text-red-600":"text-zinc-400 hover:text-red-500"}`,title:j(""),children:i.jsx(Is,{size:12})}),e.type==="image"&&i.jsx("button",{onClick:St=>{St.stopPropagation(),x&&x(e)},className:`shrink-0 p-0.5 rounded ${t==="dark"?"text-blue-300 hover:text-blue-200 hover:bg-blue-500/20":"text-blue-500 hover:text-blue-600 hover:bg-blue-100"}`,title:j(""),children:i.jsx(hp,{size:12})})]})]}),e.status==="failed"&&e.errorMsg&&i.jsx("p",{className:"text-[9px] text-red-500 mt-1 break-words whitespace-pre-wrap",children:e.errorMsg.split(`
`).map((St,E)=>i.jsxs("span",{children:[St,E<e.errorMsg.split(`
`).length-1&&i.jsx("br",{})]},E))}),e.status==="generating"&&i.jsx("p",{className:"text-[9px] text-blue-500 mt-1",children:e.errorMsg||"..."}),i.jsx("div",{className:"h-1.5"}),i.jsxs("div",{className:"flex flex-col w-full",children:[i.jsx("span",{className:t==="dark"?"text-zinc-500":t==="solarized"?"text-black":"text-zinc-400",children:(()=>{const St=e.hasInputImages===!0,E=e.type==="video";return[E?St?"":"":St?"":"",Ir,Qr,E&&br?br:null,...$r].filter(Boolean).join("  ")})()}),i.jsxs("span",{className:t==="dark"?"text-zinc-500":t==="solarized"?"text-black":"text-zinc-400",children:[e.time,"  ",i.jsx("span",{title:_e||Ut,children:je}),typeof e.durationMs=="number"&&e.durationMs>0&&i.jsxs(i.Fragment,{children:["  ",j("")," ",(e.durationMs/1e3).toFixed(1),"s"]})]})]})]})]})},(e,t)=>{var n,s;return e.item===t.item&&e.theme===t.theme&&((n=e.lightboxItem)==null?void 0:n.id)===((s=t.lightboxItem)==null?void 0:s.id)&&e.isSelected===t.isSelected&&e.performanceMode===t.performanceMode&&e.localCacheActive===t.localCacheActive&&e.getHistoryMeta===t.getHistoryMeta&&e.historyLocalCacheMap===t.historyLocalCacheMap&&e.resolveHistoryUrl===t.resolveHistoryUrl&&e.isLocalCacheUrlAvailable===t.isLocalCacheUrlAvailable}),J3=({nodeId:e,imageUrl:t,imageDimensions:n,isActive:s,onClose:a,onSave:c,theme:d,view:h,maskContent:g,onUpdateNode:x})=>{const N=M.useRef(null),C=M.useRef(null),A=M.useRef(null),[_,R]=M.useState(30),[$,L]=M.useState(!1),[S,P]=M.useState([]),[O,K]=M.useState(-1),Q=10,[ue,oe]=M.useState(n);M.useEffect(()=>{n!=null&&n.w&&(n!=null&&n.h)&&oe(n)},[n]),M.useEffect(()=>{if(!s||!t||n!=null&&n.w&&(n!=null&&n.h))return;let je=!1;return os(t).then(_e=>{je||_e!=null&&_e.w&&(_e!=null&&_e.h)&&(oe(_e),x&&x(e,{dimensions:_e}))}).catch(()=>{}),()=>{je=!0}},[s,t,n,e,x]),M.useEffect(()=>{if(!s||!N.current||!ue)return;const je=N.current,_e=je.getContext("2d");if(C.current=_e,je.width=ue.w,je.height=ue.h,_e.clearRect(0,0,je.width,je.height),g){const be=new Image;be.onload=()=>{_e.drawImage(be,0,0),we()},be.src=g}else we()},[s,ue,e,g]);const we=()=>{if(!N.current||!C.current)return;const je=N.current,be=C.current.getImageData(0,0,je.width,je.height),Xe=S.slice(0,O+1);Xe.push(be),Xe.length>Q&&Xe.shift(),P(Xe),K(Xe.length-1)},he=je=>{if(!N.current)return null;const _e=N.current,be=_e.getBoundingClientRect(),Xe=je.clientX-be.left,de=je.clientY-be.top,fe=_e.width/be.width,Ge=_e.height/be.height;return{x:Math.round(Xe*fe),y:Math.round(de*Ge)}},ze=je=>{if(!$||!N.current||!C.current)return;const _e=he(je);if(!_e)return;const be=C.current;be.globalCompositeOperation="source-over",be.strokeStyle="#FFFFFF",be.fillStyle="#FFFFFF",be.lineWidth=_,be.lineCap="round",be.lineJoin="round",A.current?(be.beginPath(),be.moveTo(A.current.x,A.current.y),be.lineTo(_e.x,_e.y),be.stroke()):(be.beginPath(),be.arc(_e.x,_e.y,_/2,0,Math.PI*2),be.fill()),A.current=_e},ot=je=>{je.button===0&&(je.preventDefault(),je.stopPropagation(),A.current=null,L(!0),we(),ze(je))},re=je=>{$&&(je.preventDefault(),je.stopPropagation(),ze(je))},Se=je=>{$&&(je.preventDefault(),je.stopPropagation(),L(!1),A.current=null,we())},D=()=>{if(O<=0||!N.current||!C.current)return;const je=O-1;K(je),C.current.putImageData(S[je],0,0)},Me=()=>{if(!N.current||!C.current)return;C.current.clearRect(0,0,N.current.width,N.current.height),we()},Ut=()=>{if(!N.current)return;const _e=N.current.toDataURL("image/png");x&&x(e,{maskContent:_e,isMasking:!1}),c&&c(_e),a&&a()};return M.useEffect(()=>{if(!s)return;const je=_e=>{(_e.ctrlKey||_e.metaKey)&&_e.key==="z"&&!_e.shiftKey&&(_e.preventDefault(),D())};return window.addEventListener("keydown",je),()=>window.removeEventListener("keydown",je)},[s,O,S]),!s||!t||!ue?null:i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"absolute inset-0 z-50 pointer-events-auto",style:{mixBlendMode:"normal"},onMouseDown:je=>je.stopPropagation(),onMouseMove:je=>je.stopPropagation(),onMouseUp:je=>je.stopPropagation(),children:[i.jsx("canvas",{ref:N,className:"absolute inset-0 w-full h-full",style:{opacity:.5,mixBlendMode:"multiply",cursor:"crosshair",pointerEvents:"auto",imageRendering:"auto"},onMouseDown:ot,onMouseMove:re,onMouseUp:Se,onMouseLeave:Se}),i.jsx(B3,{canvasRef:N,isDrawing:$})]}),i0.createPortal(i.jsxs("div",{className:`fixed bottom-4 left-1/2 -translate-x-1/2 flex flex-row items-center gap-4 p-2 rounded-full border backdrop-blur-md shadow-xl z-[9999] ${d==="dark"?"bg-zinc-900/90 border-zinc-700 text-zinc-200":"bg-white/90 border-zinc-300 text-zinc-800"}`,onMouseDown:je=>je.stopPropagation(),children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:""}),i.jsx("input",{type:"range",min:"10",max:"150",value:_,onChange:je=>R(Number(je.target.value)),className:"w-20",onMouseDown:je=>je.stopPropagation()}),i.jsxs("span",{className:"text-[10px] w-8 text-right whitespace-nowrap",children:[_,"px"]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:D,disabled:O<=0,className:`p-1.5 rounded-full transition-colors ${d==="dark"?"hover:bg-zinc-800 disabled:opacity-50 disabled:cursor-not-allowed":"hover:bg-zinc-100 disabled:opacity-50 disabled:cursor-not-allowed"}`,title:j(" (Ctrl+Z)"),children:i.jsx(o3,{size:14})}),i.jsx("button",{onClick:Me,className:`p-1.5 rounded-full transition-colors ${d==="dark"?"hover:bg-zinc-800":"hover:bg-zinc-100"}`,title:j(""),children:i.jsx(k2,{size:14})}),i.jsx("button",{onClick:Ut,className:"p-1.5 rounded-full bg-blue-600 hover:bg-blue-500 text-white transition-colors",title:j("/"),children:i.jsx(Xl,{size:14})})]})]}),document.body)]})},q3=`
        /*  */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        :root {
            --canvas-grid-color: rgba(0, 0, 0, 0.05);
        }
        .theme-dark {
            --canvas-grid-color: rgba(255, 255, 255, 0.06);
        }
        .theme-solarized {
            --canvas-grid-color: #eee8d5;
        }
        
        /*  */
        #canvas-bg {
            transform: translateZ(0);
            backface-visibility: hidden;
            perspective: 1000px;
            background-image: radial-gradient(var(--canvas-grid-color) 1px, transparent 1px);
            background-size: 24px 24px;
            background-position: 0 0;
        }
        .theme-solarized #canvas-bg {
            box-shadow: inset 0 0 0 1px #eee8d5;
        }

        .theme-solarized button[class*="bg-blue-"],
        .theme-solarized button[class*="bg-green-"] {
            background-color: #616161 !important;
            border-color: #616161 !important;
            color: #fdf6e3 !important;
        }
        .theme-solarized button[class*="bg-blue-"]:hover,
        .theme-solarized button[class*="bg-green-"]:hover {
            background-color: #4b4b4b !important;
        }
        
        /*  */
        #canvas-bg > div[style*="transform"] {
            transform: translateZ(0);
            will-change: transform;
        }
        
        /*  */
        .node-wrapper {
            transform: translateZ(0);
            backface-visibility: hidden;
            contain: layout style;
            will-change: transform, left, top;
        }
        
        /*  -  */
        .node-wrapper img,
        .node-wrapper video {
            image-rendering: auto;
            image-rendering: -webkit-optimize-contrast;
            transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            pointer-events: none;
        }
        
        /*  */
        svg {
            shape-rendering: geometricPrecision;
            text-rendering: optimizeLegibility;
        }
        
        /*  */
        .perf-mode .node-wrapper {
            box-shadow: none !important;
            backdrop-filter: none !important;
            border-radius: 0 !important;
            transition: none !important;
        }
        .perf-mode .connection-group {
            opacity: 1 !important;
        }
        
        /*  */
        .interacting .node-wrapper img {
            image-rendering: pixelated;
        }
        .interacting .connection-group {
            display: none;
            pointer-events: none;
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .theme-dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 2px; }
        .theme-dark .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #52525b; }
        .theme-light .custom-scrollbar::-webkit-scrollbar-thumb { background: #d4d4d8; border-radius: 2px; }
        .theme-light .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }
        .theme-solarized .custom-scrollbar::-webkit-scrollbar-thumb { background: #c9c2a8; border-radius: 2px; }
        .theme-solarized .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #b9b091; }
        .theme-solarized button[class*="bg-blue-"],
        .theme-solarized button[class*="bg-green-"],
        .theme-solarized button[class*="from-blue-"],
        .theme-solarized button[class*="from-green-"],
        .theme-solarized button[class*="to-emerald-"],
        .theme-solarized button[class*="to-indigo-"] {
            background-image: none !important;
            background-color: #616161 !important;
            border-color: #525252 !important;
            color: #fdf6e3 !important;
        }
        .theme-solarized button[class*="bg-blue-"]:hover,
        .theme-solarized button[class*="bg-green-"]:hover,
        .theme-solarized button[class*="from-blue-"]:hover,
        .theme-solarized button[class*="from-green-"]:hover,
        .theme-solarized button[class*="to-emerald-"]:hover,
        .theme-solarized button[class*="to-indigo-"]:hover {
            background-color: #555555 !important;
        }
        .theme-solarized [class*="hover:bg-zinc-100"]:hover {
            background-color: #fdf6e3 !important;
        }
        .theme-solarized [class*="hover:bg-zinc-200"]:hover {
            background-color: #eee8d5 !important;
        }
        .resize-handle { cursor: nwse-resize; opacity: 0; transition: opacity 0.2s; }
        .node-wrapper:hover .resize-handle { opacity: 1; }
        
        /*  */
        .connector { position: absolute; top: 50%; transform: translateY(-50%); width: 0.9rem; height: 0.9rem; background-color: #27272a; border: 1px solid #71717a; color: #a1a1aa; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: crosshair; transition: all 0.2s; z-index: 30; opacity: 0; pointer-events: auto; }
        .node-wrapper:hover .connector { opacity: 1; }
        .connector:hover, .connector.active { background-color: #d4d4d8; border-color: #fff; transform: translateY(-50%) scale(1.2); opacity: 1; color: #000; }
        .connector-right { right: -0.45rem; }
        
        /*  */
        .input-point { position: absolute; top: 50%; transform: translateY(-50%); left: -0.25rem; width: 0.5rem; height: 0.5rem; background-color: #52525b; border-radius: 50%; border: 1px solid #18181b; transition: all 0.2s; z-index: 20; cursor: crosshair; }
        .node-wrapper:hover .input-point { background-color: #a1a1aa; }
        .input-point.connected { background-color: #60a5fa; box-shadow: 0 0 6px #60a5fa; }
        .input-point.active { background-color: #60a5fa; border-color: #fff; transform: translateY(-50%) scale(1.3); box-shadow: 0 0 8px #60a5fa; }

        /* Lightbox & Overlay */
        .lightbox-overlay { background-color: rgba(0, 0, 0, 0.95); backdrop-filter: blur(5px); }
        
        /* Stack Items */
        .thumb-stack-item {
             transition: transform 0.2s, z-index 0.2s;
        }
        .thumb-stack-item:hover {
            transform: scale(1.1) translateY(-2px);
            z-index: 10 !important;
            border-color: #60a5fa;
        }

        /*  */
        .connection-delete {
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: auto; /*  */
        }
        /*  */
        .connection-group:hover .connection-delete {
            opacity: 1;
        }

        /*  */
        .drop-zone {
            border: 2px dashed transparent;
            transition: all 0.3s;
        }
        .drop-zone.drag-over {
            border-color: #60a5fa;
            background-color: rgba(96, 165, 250, 0.1);
        }

        /* Markdown Styles for Chat */
        .markdown-body { font-size: 13px; line-height: 1.5; color: #e4e4e7; word-wrap: break-word; user-select: text !important; cursor: text; }
        .markdown-body * { user-select: text !important; cursor: text; }
        .markdown-body pre { background: #27272a; padding: 10px; border-radius: 6px; overflow-x: auto; margin: 8px 0; white-space: pre-wrap; word-wrap: break-word; user-select: text !important; cursor: text; }
        .markdown-body code { font-family: monospace; background: #3f3f46; padding: 2px 4px; border-radius: 4px; font-size: 12px; user-select: text !important; cursor: text; }
        .markdown-body pre code { background: transparent; padding: 0; color: #a1a1aa; user-select: text !important; cursor: text; }
        .markdown-body p { margin-bottom: 8px; user-select: text !important; cursor: text; }
        .markdown-body ul, .markdown-body ol { margin-left: 20px; margin-bottom: 8px; list-style: disc; user-select: text !important; cursor: text; }
        .markdown-body li { user-select: text !important; cursor: text; }
        .markdown-body video { max-width: 100%; border-radius: 0.5rem; margin-top: 0.5rem; }
        .markdown-body table { border-collapse: collapse; width: 100%; margin: 12px 0; }
        .markdown-body table th, .markdown-body table td { border: 1px solid #3f3f46; padding: 8px 12px; text-align: left; }
        .markdown-body table th { background-color: #3f3f46; font-weight: 600; }
        .markdown-body table tr:nth-child(even) { background-color: #27272a; }
        .theme-light .markdown-body table th, .theme-light .markdown-body table td { border-color: #d4d4d8; }
        .theme-light .markdown-body table th { background-color: #e4e4e7; }
        .theme-light .markdown-body table tr:nth-child(even) { background-color: #f4f4f5; }
        .theme-light .markdown-body { color: #18181b; }
        .theme-light .markdown-body pre { background: #f4f4f5; color: #18181b; }
        .theme-light .markdown-body code { background: #e4e4e7; color: #18181b; }
        .theme-light .markdown-body pre code { color: #18181b; }
        .theme-solarized .markdown-body table th, .theme-solarized .markdown-body table td { border-color: #d7cfb2; }
        .theme-solarized .markdown-body table th { background-color: #ddddc1; }
        .theme-solarized .markdown-body table tr:nth-child(even) { background-color: #eee8d5; }
        .theme-solarized .markdown-body { color: #586e75; }
        .theme-solarized .markdown-body pre { background: #ddddc1; color: #586e75; }
        .theme-solarized .markdown-body code { background: #ddddc1; color: #586e75; }
        .theme-solarized .markdown-body pre code { color: #586e75; }
        `,G3=4e3,Y3=4e3,Ps="https://ai.comfly.chat",X3="http://localhost:5100",tp={openai:{key:"",url:Ps,apiType:"openai",useProxy:!1,forceAsync:!1},google:{key:"",url:Ps,apiType:"openai",useProxy:!1,forceAsync:!1},deepseek:{key:"",url:Ps,apiType:"openai",useProxy:!1,forceAsync:!1},midjourney:{key:"",url:"https://api.midjourney.com",apiType:"openai",useProxy:!1,forceAsync:!1},jimeng:{key:"",url:X3,apiType:"openai",useProxy:!1,forceAsync:!1},grok:{key:"",url:"https://ai.t8star.cn",apiType:"openai",useProxy:!1,forceAsync:!1},yunwu:{key:"",url:"https://yunwu.ai",apiType:"gemini",useProxy:!1,forceAsync:!1}},Ux=[{id:"gpt-5.1",provider:"openai",type:"Chat"},{id:"gpt-5.2",provider:"openai",type:"Chat"},{id:"gpt-4o",provider:"openai",type:"Chat"},{id:"deepseek-v3-1-250821",provider:"deepseek",type:"Chat"},{id:"gemini-3-pro-preview",provider:"google",type:"Chat"},{id:"MJ V6",provider:"midjourney",type:"Image"},{id:"gpt-4o-image",provider:"openai",type:"Image"},{id:"gemini-3-pro-image-preview",provider:"yunwu",type:"Image"},{id:"jimeng-4.5",provider:"jimeng",type:"Image"},{id:"jimeng-4.1",provider:"jimeng",type:"Image"},{id:"jimeng-4.0",provider:"jimeng",type:"Image"},{id:"jimeng-3.1",provider:"jimeng",type:"Image"},{id:"jimeng-3.0",provider:"jimeng",type:"Image"},{id:"jimeng-2.1",provider:"jimeng",type:"Image"},{id:"jimeng-xl-pro",provider:"jimeng",type:"Image"},{id:"nanobananapro",provider:"jimeng",type:"Image"},{id:"nanobanana",provider:"jimeng",type:"Image"},{id:"sora-2",provider:"openai",type:"Video",durations:["5s","10s"]},{id:"sora-2-pro",provider:"openai",type:"Video",durations:["15s","25s"]},{id:"jimeng-video-3.5-pro",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-veo3",provider:"jimeng",type:"Video",durations:["8s"]},{id:"jimeng-video-veo3.1",provider:"jimeng",type:"Video",durations:["8s"]},{id:"jimeng-video-sora2",provider:"jimeng",type:"Video",durations:["4s","8s","12s"]},{id:"jimeng-video-3.0-pro",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-3.0",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-3.0-fast",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-2.0-pro",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"jimeng-video-2.0",provider:"jimeng",type:"Video",durations:["5s","10s"]},{id:"grok-video-3",provider:"grok",type:"Video",durations:["8s","5s"]}],p0=["Auto","1:1","16:9","9:16","4:3","3:4","21:9","3:2","2:3"],Z3=["3:2","2:3","1:1"],E2=["1080P","720P"],Tw="tapnow_prompt_library",Mw="3x3 gridKeep character strictly consistent9Character Sheet",Rw="UpscaleSharpeningDenoisingBest quality, 8k, masterpiece, highres, ultra detailed, sharp focus, image restoration, upscale, faithful to original.",Ow=`you are a veteran Hollywood storyboard artist with years of experience. You have the ability to accurately analyze character features and scene characteristics based on images. Provide me with the most suitable camera angles and storyboards. Strictly base this on the uploaded character and scene images, while maintaining a consistent visual style.

MANDATORY LAYOUT: Create a precise 3x3 GRID containing exactly 9 distinct panels.

- The output image MUST be a single image divided into a 3 (rows) by 3 (columns) matrix.
- There must be EXACTLY 3 horizontal rows and 3 vertical columns.
- Each panel must be completely separated by a thin, distinct, solid black line.
- DO NOT create a collage. DO NOT overlap images. DO NOT create random sizes. 
- The grid structure must be perfectly aligned for slicing.

Subject Content: "[]"

Styling Instructions:
- Each panel shows the SAME subject/scene from a DIFFERENT angle (e.g., Front, Side, Back, Action, Close-up).
- Maintain perfect consistency of the character/object across all panels.
- Cinematic lighting, high fidelity, 8k resolution.

Negative Constraints:
- No text, no captions, no UI elements.
- No watermarks.
- No broken grid lines.`,Lw=`(strictly mimic source image art style:1.5), (same visual style:1.4),
score_9, score_8_up, masterpiece, best quality, (character sheet:1.4), (reference sheet:1.3), (consistent art style:1.3), matching visual style, 

[Structure & General Annotations]:
multiple views, full body central figure, clean background, 
(heavy annotation:1.4), (text labels with arrows:1.3), handwriting, data readout,

[SPECIAL CHARACTER DESCRIPTION AREA]:
(prominent character profile text box:1.6), (dedicated biography section:1.5), large descriptive text block,
[],

[Clothing Breakdown]:
(clothing breakdown:1.5), (outfit decomposition:1.4), garment analysis, (floating apparel:1.3), 
displaying outerwear, displaying upper body garment, displaying lower body garment, 

[Footwear Focus]:
(detailed footwear display:1.5), (floating shoes:1.4), shoe design breakdown, focus on shoes, 

[Inventory & Details]:
(inventory knolling:1.2), open container, personal accessories, organized items display, expression panels`,Dw=`# Directive: Create a "Rich Narrative Mood Board" (8-Grid Layout)

## 1. PROJECT INPUT 

**A. [Story & Concept / ]**
> []

**B. [Key Symbols /  (Optional)]**
> []

**C. [Color Preferences /  (Optional)]**
> []

**D. [Reference Images / ]**
> (See attached images / )

---

## 2. Role Definition
Act as a **Senior Art Director**. Synthesize the Input above into a single, cohesive, high-density **Visual Mood Board** using a complex **8-Panel Asymmetrical Grid Layout**.

## 3. Layout Mapping (Strict Adherence)
You must design a visual composition that tells the story through **8 distinct panels** within one image. **Do not** generate random grids. Map the content exactly as follows:

* **Panel 1 (The World):** A wide, cinematic establishing shot of the environment (based on Input A).
* **Panel 2 (The Protagonist):** A portrait close-up (based on reference images), focusing on micro-expressions.
* **Panel 3 (The Metaphor):** An **abstract symbolic object** representing the core theme (based on Input B).
* **Panel 4 (The Palette):** A graphical **Color Palette Strip** showcasing 5 specific colors extracted from the scene.
* **Panel 5 (The Texture):** Extreme macro close-up of a material surface (e.g., rust, skin, fabric) to add tactile richness.
* **Panel 6 (The Motion):** A motion-blurred or long-exposure shot representing time/chaos.
* **Panel 7 (The Detail):** A focused shot of a specific prop or accessory relevant to the plot.
* **Panel 8 (The AI Art Interpretation - CRITICAL):** This is your **free creative space**. Generate an artistic, surreal, or abstract re-interpretation of the story's emotion. **Do not just copy the inputs.** Create a "Vibe Image" (e.g., Double Exposure, Oil Painting style, or abstract geometry) that captures the *soul* of the narrative.

## 4. Execution Requirements
* **Composition Style:** High-end Editorial / Magazine Layout. Clean, thin white borders.
* **Visual Unity:** All panels must share the same lighting conditions and color grading logic (Unified Aesthetic).
* **Task:** Provide the **Final English Image Prompt** that explicitly describes this 8-grid layout, ensuring Panel 8 stands out as an artistic variation.`,Fx=["gemini-image","qwen-image","doubao-seedream","jimeng","hailuo-02","kling-v1-6","wan-2.5"],Q3={enabled:!0,requestIdPaths:["requestId","request_id"],pollIntervalMs:3e3,maxAttempts:300,statusRequest:{endpoint:"/w/v1/webapp/task/openapi/detail",method:"GET",headers:{Authorization:"Bearer {{provider.key}}"},query:{requestId:"{{requestId}}"},bodyType:"json",body:{}},statusPath:"data.status",successValues:["Success"],failureValues:["Failed","Canceled"],outputsRequest:{endpoint:"/w/v1/webapp/task/openapi/outputs",method:"GET",headers:{Authorization:"Bearer {{provider.key}}"},query:{requestId:"{{requestId}}"},bodyType:"json",body:{}},outputsPath:"data.outputs",outputsUrlField:"object_url",errorPath:"message"},eE=JSON.stringify(Q3,null,2),tE=()=>({enabled:!1,requestIdPaths:["requestId","request_id"],pollIntervalMs:3e3,maxAttempts:300,statusRequest:{endpoint:"",method:"GET",headers:{},query:{},bodyType:"json",body:{}},statusPath:"",successValues:[],failureValues:[],outputsRequest:{endpoint:"",method:"GET",headers:{},query:{},bodyType:"json",body:{}},outputsPath:"",outputsUrlField:"",errorPath:""}),rE=[...Ux.filter(e=>!Fx.includes(e.id)).filter(e=>!["Tongyi-MAI/Z-Image-Turbo"].includes(e.id)).map(e=>{var c;const t=e.type==="Video",n=t&&/veo3\.1/i.test(e.id),s=t&&/sora-2/i.test(e.id),a={id:e.id,displayName:e.id,modelName:e.id,type:e.type||"Chat",ratioLimits:null,resolutionLimits:null,durations:Array.isArray(e.durations)?e.durations:null,videoResolutions:t?[...E2]:null,supportsFirstLastFrame:n,supportsHD:s,apiType:((c=tp[e.provider])==null?void 0:c.apiType)||"openai",customParams:[],asyncConfig:null};return{...a,requestTemplate:xo(a),requestOverrideEnabled:!1,requestOverridePatch:null}})],nE=e=>e&&e.includes("grok")?Z3:p0,Bx=["Auto","1K","2K","4K"],xp=e=>{const t=String(e||"").trim();if(!t)return null;const n=t.toUpperCase();if(n==="AUTO")return"Auto";if(n==="1K"||n==="2K"||n==="4K")return n;const s=t.match(/^(\d+)\s*[xX]\s*(\d+)$/);if(s)return`${s[1]}x${s[2]}`;const a=n.match(/^(\d+)K$/);return a?`${a[1]}K`:t},Ju=e=>{const t=xp(e);return t||"2K"},Wb=e=>{const t=String(e||"").trim();return/^\d+\s*[xX]\s*\d+$/.test(t)},ca=e=>{const t=String(e||"").trim();if(!t)return"720P";if(t==="")return"Auto";const n=t.toUpperCase();return n==="AUTO"?"Auto":(n.endsWith("P")||n.endsWith("K"),n)},I2=e=>{const t=ca(e);return!t||t==="Auto"?"":t.toLowerCase()},P2=e=>e==null?"":String(e).replace(/[(][^)]*[)]/g,"").replace(/\s+/g,"").trim(),hh=(e,t={})=>{const n=t.defaultRatio?String(t.defaultRatio):"1:1",s=Array.isArray(t.allowedRatios)?new Set(t.allowedRatios.map(h=>String(h).toLowerCase())):null,a=P2(e);if(!a)return n;if(a.toLowerCase()==="auto")return s&&s.has("auto")?"auto":n;const d=a.match(/^(\d+):(\d+)$/);if(d){const h=parseInt(d[1],10),g=parseInt(d[2],10);if(Number.isFinite(h)&&Number.isFinite(g)&&h>0&&g>0){const x=`${h}:${g}`;return s&&!s.has(x.toLowerCase())?n:x}}return s&&!s.has(a.toLowerCase())?n:a},Uw=e=>{if(!e)return!1;const t=String(e).toLowerCase();return!t||t.includes("sora2")||t.includes("veo3")||t.includes("3.5")||t.includes("3.0-pro")||t.includes("3.5-pro")||t.includes("2.0")?!1:t.includes("vgfm_3.0_fast")||t.includes("vgfm_3.0")&&!t.includes("_pro")?!0:t.includes("video-3.0-fast")||t.includes("video-3.0")},mh=(e,{allowExplicit:t=!1}={})=>{const n=I2(P2(e));if(!n||n==="auto")return"";if(n==="720p"||n==="1080p")return n;if(n==="2k"||n==="4k")return"1080p";const s=n.replace(/[^0-9x]/g,"");if(/^\d+x\d+$/.test(s)){if(!t){const[a,c]=s.split("x").map(h=>parseInt(h,10)),d=Math.max(a||0,c||0);return d?d<=1280?"720p":"1080p":""}return s}return""},od=(e,t=8)=>{if(e==null)return t;const n=String(e).trim().replace(/[^\d]/g,""),s=parseInt(n,10);return Number.isFinite(s)?s:t},gh=(e,t=[])=>{const n=t&&t.length>0?t[0]:5,s=od(e,n);return!t||t.length===0||t.includes(s)?s:n},zs=e=>e==="Image"||e==="ChatImage",Ci=e=>e==="Chat"||e==="ChatImage",qu=30,sE=30,$2=e=>{if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([n,s])=>{const a=String(n||"").trim(),c=typeof s=="string"?s.trim():"";a&&c&&(t[a]=c)}),t},es=e=>$2(e),nl=e=>{if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([n,s])=>{const a=xp(n),c=typeof s=="string"?s.trim():"";a&&c&&(t[a]=c)}),t},da=e=>Array.isArray(e)?e.map((t,n)=>{if(!t)return null;const s=String(t.id||"").trim()||`param-${Date.now()}-${Math.random().toString(36).slice(2,6)}-${n}`,a=(t==null?void 0:t.name)??(t==null?void 0:t.label)??(t==null?void 0:t.displayName)??(t==null?void 0:t.paramName)??(t==null?void 0:t.key),c=a!=null?String(a).trim():"",d=Array.isArray(t.values)?t.values.map(x=>String(x).trim()).filter(Boolean):[],h=$2(t.valueNotes||t.valueLabels||t.notes),g=typeof t.notesEnabled=="boolean"?t.notesEnabled:Object.keys(h).length>0;return{id:s,name:c,values:d,override:!!t.override,notesEnabled:g,valueNotes:h}}).filter(Boolean):[],Fw=(e,t=[])=>{if(!e||!Array.isArray(t)||t.length===0)return null;const n=String(e).toLowerCase();let s=null;if(n.includes("imagea")?s=0:n.includes("imageb")?s=1:n.includes("imagec")?s=2:n.includes("imaged")&&(s=3),s===null){const a=n.match(/image(?:_|-)?(\d+)/);if(a){const c=parseInt(a[1],10);Number.isFinite(c)&&c>0&&(s=c-1)}}return s===null?null:t[s]||null};function iE(e){const t=e||"Chat";let n="/v1/images/generations";t==="Video"&&(n="/v1/videos/generations"),(t==="Chat"||t==="ChatImage")&&(n="/v1/chat/completions");let s={model:"{{modelName}}",prompt:"{{prompt}}"};return t==="Video"?s={model:"{{modelName}}",prompt:"{{prompt}}",duration:"{{duration:number}}",ratio:"{{ratio}}",resolution:"{{resolution}}"}:t==="Chat"||t==="ChatImage"?s={model:"{{modelName}}",messages:[{role:"user",content:"{{prompt}}"}],stream:!1}:s={model:"{{modelName}}",prompt:"{{prompt}}",n:1,size:"{{size}}"},{enabled:!1,endpoint:n,method:"POST",bodyType:"json",headers:{"Content-Type":"application/json"},query:{},files:{},timeoutMs:null,responseParser:"",body:s}}function oE(e){const t=String(e||"").toLowerCase();return t?t.includes("jimeng")||t.includes("dreamina"):!1}function aE(){return{enabled:!0,endpoint:"/v1/videos/generations",method:"POST",bodyType:"auto",headers:{"Content-Type":"application/json"},query:{},files:{image_file_1:"{{firstFrame:blob}}",image_file_2:"{{lastFrame:blob}}"},timeoutMs:null,responseParser:"jimeng.video",body:{model:"{{modelName}}",prompt:"{{prompt}}",duration:"{{jimengDuration:number}}",ratio:"{{jimengRatio}}",resolution:"{{jimengResolution}}"}}}function xo(e){const t=(e==null?void 0:e.type)||"Chat",n=(e==null?void 0:e.id)||(e==null?void 0:e.modelName)||"";return t==="Video"&&oE(n)?aE():iE(t)}const ad=(e,t)=>{if(!e||!t)return"";const n=e.id&&t[e.id];if(n!=null&&n!=="")return n;const s=e.name&&t[e.name];return s!=null&&s!==""?s:""},Qn=(e,t,n)=>{if(!e)return"";if(!t)return e;const s=n==null?void 0:n[e];return s?`${e}(${s})`:e},xh=(e,t,n)=>e?t&&(n==null?void 0:n[e])||e:"",Bw=(e,t)=>Qn(t,!!(e!=null&&e.notesEnabled),(e==null?void 0:e.valueNotes)||{}),lE=e=>{if(!e)return!1;const t=String((e==null?void 0:e.name)||"");return t.toLowerCase().includes("input")||t.includes("")?!0:(Array.isArray(e==null?void 0:e.values)?e.values:[]).some(a=>{const c=String(a||"");return c.toLowerCase().includes("input")||c.includes("")})},Hw=(e,t,n)=>{if(!e||!Array.isArray(t)||t.length===0)return e;const s=typeof FormData<"u"&&e instanceof FormData;return t.forEach(a=>{const c=String((a==null?void 0:a.name)||"").trim();if(!c)return;const d=ad(a,n);if(!(d===""||d===void 0||d===null)){if(s){(a.override||!e.has(c))&&e.set(c,d);return}(a.override||e[c]===void 0)&&(e[c]=d)}}),e},cE=(e,t)=>{if(!e||!Array.isArray(t)||t.length===0)return e;const n={...e};return t.forEach(s=>{const a=String((s==null?void 0:s.name)||"").trim();if(!a)return;const c=Array.isArray(s.values)&&s.values.length>0?s.values[0]:"";c!==""&&(s.override||n[a]===void 0)&&(n[a]=c)}),n},fa=e=>!e||typeof e!="object"||Array.isArray(e)?null:{...e},dE=(e,t)=>{if(e===t)return!0;if(typeof e=="object"||typeof t=="object")try{return JSON.stringify(e)===JSON.stringify(t)}catch{return!1}return!1},Vw=(e,t)=>{if(!e||!t||typeof t!="object")return null;const n={},s=new Set(Object.keys(e));return Object.keys(t).forEach(a=>{const c=t[a],d=e[a];dE(d,c)||(n[a]=c),s.delete(a)}),s.forEach(a=>{n[a]=null}),Object.keys(n).length>0?n:null},$g=(e,t)=>{if(!e||!t||typeof t!="object")return e;const n=typeof FormData<"u"&&e instanceof FormData;return Object.entries(t).forEach(([s,a])=>{if(s){if(a===null){n?e.delete(s):delete e[s];return}if(n){const c=typeof a=="string"?a:JSON.stringify(a);e.set(s,c);return}e[s]=a}}),e},Gi=e=>!e||typeof e!="object"?null:{enabled:e.enabled!==!1,endpoint:typeof e.endpoint=="string"?e.endpoint.trim():"",method:(e.method||"POST").toString().toUpperCase(),bodyType:(e.bodyType||"json").toString().toLowerCase(),headers:e.headers&&typeof e.headers=="object"&&!Array.isArray(e.headers)?{...e.headers}:{},query:e.query&&typeof e.query=="object"&&!Array.isArray(e.query)?{...e.query}:{},files:e.files&&typeof e.files=="object"&&!Array.isArray(e.files)?{...e.files}:{},timeoutMs:Number.isFinite(e.timeoutMs)?Number(e.timeoutMs):null,responseParser:typeof e.responseParser=="string"?e.responseParser.trim():"",body:e.body&&typeof e.body=="object"&&!Array.isArray(e.body)?e.body:e.body??{}},Ag=e=>{if(Array.isArray(e))return e.map(t=>String(t||"").trim()).filter(Boolean);if(typeof e=="string"){const t=e.trim();return t?[t]:[]}return[]},Ww=e=>!e||typeof e!="object"?null:Gi({...e,enabled:!0}),rp=e=>{if(!e||typeof e!="object")return null;const t={enabled:e.enabled===!0,requestIdPaths:Ag(e.requestIdPaths||e.requestIdPath||e.requestId),pollIntervalMs:Number.isFinite(Number(e.pollIntervalMs))?Number(e.pollIntervalMs):3e3,maxAttempts:Number.isFinite(Number(e.maxAttempts))?Number(e.maxAttempts):300,statusRequest:Ww(e.statusRequest||e.status||e.pollRequest),statusPath:typeof e.statusPath=="string"?e.statusPath.trim():"",successValues:Ag(e.successValues||e.successStatuses||e.successStatus||e.success),failureValues:Ag(e.failureValues||e.failureStatuses||e.failureStatus||e.failure),outputsRequest:Ww(e.outputsRequest||e.outputs||e.resultRequest),outputsPath:typeof e.outputsPath=="string"?e.outputsPath.trim():"",outputsUrlField:typeof e.outputsUrlField=="string"?e.outputsUrlField.trim():"",errorPath:typeof e.errorPath=="string"?e.errorPath.trim():""};return t.requestIdPaths.length||(t.requestIdPaths=["requestId","request_id","data.requestId","data.request_id"]),t.successValues=t.successValues.length?t.successValues.map(n=>n.toUpperCase()):["SUCCESS","SUCCEED","COMPLETED","FINISHED","DONE"],t.failureValues=t.failureValues.length?t.failureValues.map(n=>n.toUpperCase()):["FAILED","ERROR","CANCELLED","CANCELED","FAILURE"],t},Kw=(e,t=0)=>{if(!e||typeof e!="object")return null;const s=String(e.id||e.modelName||e.displayName||"").trim()||`library-${Date.now()}-${Math.random().toString(36).slice(2,6)}-${t}`;return{id:s,displayName:e.displayName||e.modelName||s,modelName:e.modelName||e.displayName||s,type:e.type||"Chat",apiType:e.apiType||"openai",ratioLimits:Array.isArray(e.ratioLimits)?e.ratioLimits:null,ratioNotes:es(e.ratioNotes),ratioNotesEnabled:!!e.ratioNotesEnabled,resolutionLimits:Array.isArray(e.resolutionLimits)?e.resolutionLimits:null,resolutionNotes:nl(e.resolutionNotes),resolutionNotesEnabled:!!e.resolutionNotesEnabled,durations:Array.isArray(e.durations)?e.durations:null,durationNotes:es(e.durationNotes),durationNotesEnabled:!!e.durationNotesEnabled,videoResolutions:Array.isArray(e.videoResolutions)?e.videoResolutions:null,videoResolutionNotes:es(e.videoResolutionNotes),videoResolutionNotesEnabled:!!e.videoResolutionNotesEnabled,supportsFirstLastFrame:!!e.supportsFirstLastFrame,supportsHD:!!e.supportsHD,customParams:da(e.customParams),asyncConfig:rp(e.asyncConfig),previewOverrideEnabled:!!e.previewOverrideEnabled,previewOverridePatch:fa(e.previewOverridePatch),requestTemplate:Gi(e.requestTemplate||xo(e)),requestOverrideEnabled:!!e.requestOverrideEnabled,requestOverridePatch:Lo(e.requestOverridePatch),responseParser:e.responseParser||""}},Lo=e=>fa(e),uE=/\{\{\s*([a-zA-Z0-9_.-]+)(?::([a-zA-Z0-9_-]+))?\s*\}\}/g,nd=(e,t)=>{if(!(!e||!t))return t.split(".").reduce((n,s)=>n&&n[s]!==void 0?n[s]:void 0,e)},Jw=(e,t,n={})=>{if(t==="number"){if(e==null||e===""||typeof e=="number"&&Number.isFinite(e))return e;const s=parseFloat(String(e).replace(/[^\d.-]/g,""));return Number.isFinite(s)?s:e}return t==="string"?e==null?"":String(e):t==="blob"&&n.bodyType==="json"&&n.fallbackBlobAsDataUrl?n.fallbackBlobAsDataUrl:e},Th=(e,t)=>{if(!e||!t)return;const s=String(t).replace(/\[(\d+)\]/g,".$1").replace(/^\./,"").split(".").filter(Boolean);let a=e;for(const c of s){if(a==null)return;a=a[c]}return a},pE=(e,t)=>{if(!(!t||t.length===0))for(const n of t){const s=Th(e,n);if(s!=null&&s!=="")return s}},fE=e=>e==null?"":String(e).trim().toUpperCase(),hE=(e,t)=>{const n=[],s=a=>{if(a&&typeof a=="string"){const c=a.trim();c&&n.push(c)}};return Array.isArray(e)?e.forEach(a=>{if(a){if(typeof a=="string"){s(a);return}if(typeof a=="object"){if(t&&a[t]){s(a[t]);return}s(a.url||a.image_url||a.imageUrl||a.object_url||a.objectUrl||a.path)}}}):e&&typeof e=="object"?t&&e[t]?s(e[t]):s(e.url||e.image_url||e.imageUrl||e.object_url||e.objectUrl||e.path):typeof e=="string"&&s(e),n},A2=(e,t,n={})=>{if(typeof e!="string")return e;const a=e.trim().match(/^{{\s*([a-zA-Z0-9_.-]+)(?::([a-zA-Z0-9_-]+))?\s*}}$/);if(a){const[,c,d]=a,h=d==="blob"?nd(t,`${c}DataUrl`)||nd(t,`${c}DataURL`):void 0,g=nd(t,d==="blob"?`${c}Blob`:c);return Jw(g,d,{bodyType:n.bodyType,fallbackBlobAsDataUrl:h})}return e.replace(uE,(c,d,h,g)=>{const x=h==="blob"?nd(t,`${d}DataUrl`)||nd(t,`${d}DataURL`):void 0,N=nd(t,h==="blob"?`${d}Blob`:d),C=Jw(N,h,{bodyType:n.bodyType,fallbackBlobAsDataUrl:x});if(C==null){if(n.bodyType==="raw"){const A=e[g-1],_=e[g+c.length];return A==='"'&&_==='"'?"":"null"}return""}if(typeof C=="object")try{return JSON.stringify(C)}catch{return""}return String(C)})},wd=(e,t,n={})=>{if(Array.isArray(e))return e.map(s=>wd(s,t,n));if(e&&typeof e=="object"&&!(e instanceof Blob)&&!(e instanceof File)){const s={};return Object.entries(e).forEach(([a,c])=>{s[a]=wd(c,t,n)}),s}return typeof e=="string"?A2(e,t,n):e},mE=(e,t)=>{if(!e||!t||typeof t!="object")return e;const n=Object.entries(t).filter(([x,N])=>x);if(n.length===0)return e;const s=/^https?:/i.test(e),a=s?void 0:"http://placeholder";let c;try{c=new URL(e,a)}catch{return e}if(n.forEach(([x,N])=>{if(!(N==null||N==="")){if(Array.isArray(N)){N.forEach(C=>{C==null||C===""||c.searchParams.append(x,String(C))});return}c.searchParams.set(x,String(N))}}),s)return c.toString();const d=c.pathname||"",h=c.search||"",g=c.hash||"";return`${d}${h}${g}`},zd=e=>{if(Array.isArray(e))return e.map(t=>zd(t)).filter(t=>t!=null);if(e&&typeof e=="object"&&!(e instanceof Blob)&&!(e instanceof File)){const t={};return Object.entries(e).forEach(([n,s])=>{if(!n)return;const a=zd(s);a!=null&&(t[n]=a)}),t}return e},f0=e=>e?e instanceof Blob||e instanceof File||typeof e=="string"&&e.startsWith("data:")?!0:Array.isArray(e)?e.some(t=>f0(t)):typeof e=="object"?Object.values(e).some(t=>f0(t)):!1:!1,sd=(e,t,n={})=>{if(!e)return null;const s=(e.bodyType||"json").toString().toLowerCase(),a=(e.method||"POST").toString().toUpperCase(),c=R=>({resolvedEndpoint:A2(e.endpoint||"",t,{bodyType:R}),headers:zd(wd(e.headers||{},t,{bodyType:R})),resolvedQuery:zd(wd(e.query||{},t,{bodyType:R})),resolvedBody:zd(wd(e.body||{},t,{bodyType:R})),resolvedFiles:zd(wd(e.files||{},t,{bodyType:R}))}),d=s==="auto"?"multipart":s;let{resolvedEndpoint:h,headers:g,resolvedQuery:x,resolvedBody:N,resolvedFiles:C}=c(d),A=s==="auto"?f0(N)||f0(C)?"multipart":"json":s;s==="auto"&&A==="json"&&({resolvedEndpoint:h,headers:g,resolvedQuery:x,resolvedBody:N,resolvedFiles:C}=c("json"));let _=N;if(A==="multipart"){const R=new FormData;Object.entries(N||{}).forEach(([$,L])=>{if(!(L==null||$==="")){if(Array.isArray(L)){L.forEach(S=>{S!=null&&(S instanceof Blob||S instanceof File?R.append($,S,S.name||"file"):typeof S=="object"?R.append($,JSON.stringify(S)):R.append($,String(S)))});return}L instanceof Blob||L instanceof File?R.append($,L,L.name||"file"):typeof L=="object"?R.append($,JSON.stringify(L)):R.append($,String(L))}}),Object.entries(C||{}).forEach(([$,L])=>{if(!$||L===void 0||L===null)return;const S=P=>{if(P){if(P instanceof Blob||P instanceof File){R.append($,P,P.name||"file");return}if(typeof P=="string"&&P.startsWith("data:"))try{const O=Ql(P);R.append($,O,"file")}catch{}}};if(Array.isArray(L)){L.forEach(S);return}S(L)}),_=R}else A==="raw"&&typeof _!="string"&&(_=JSON.stringify(_??{}));return{url:mE(h,x),method:a,headers:g,body:_,bodyType:A,timeoutMs:Number.isFinite(e.timeoutMs)?Number(e.timeoutMs):null,responseParser:e.responseParser||""}},Tg=(e,t)=>{if(!e||!t||typeof t!="object")return e;const n={...e};return Object.entries(t).forEach(([s,a])=>{s&&(a===null?delete n[s]:n[s]=a)}),n},Mg=e=>{if(typeof FormData>"u"||e instanceof FormData)return e;const t=new FormData;return(e&&typeof e=="object"?Object.entries(e):[]).forEach(([s,a])=>{if(!(a==null||s==="")){if(Array.isArray(a)){a.forEach(c=>{c!=null&&(c instanceof Blob||c instanceof File?t.append(s,c,c.name||"file"):typeof c=="object"?t.append(s,JSON.stringify(c)):t.append(s,String(c)))});return}a instanceof Blob||a instanceof File?t.append(s,a,a.name||"file"):typeof a=="object"?t.append(s,JSON.stringify(a)):t.append(s,String(a))}}),t},Rg=e=>{if(!e)return null;const t={...e};if(e.body instanceof FormData){const n={};e.body.forEach((s,a)=>{n[a]||(n[a]=[]),s instanceof Blob||s instanceof File?n[a].push("[Blob]"):n[a].push(s)}),t.body=n}return t},gE=e=>e?e.type==="Video"?"/v1/videos/generations":e.type==="Chat"||e.type==="ChatImage"?"/v1/chat/completions":"/v1/images/generations":"/v1/images/generations",xE=(e,t)=>{const n=JSON.stringify(t||{},null,2);return["import requests, json",'BASE_URL = "https://api.example.com"','API_KEY = "YOUR_API_KEY"',`url = f"{BASE_URL}${e}"`,'headers = {"Authorization": f"Bearer {API_KEY}", "Content-Type": "application/json"}',`payload = json.loads('''${n}''')`,"resp = requests.post(url, headers=headers, json=payload)","print(resp.json())"].join(`
`)},bE=e=>e&&e.includes("jimeng-4.5")?["2K","4K"]:Bx,Og=[{label:"MJ V7",value:"--v 7"},{label:"MJ V6.1",value:"--v 6.1"},{label:"MJ V6",value:"--v 6"},{label:"MJ V5.2",value:"--v 5.2"},{label:"MJ V5.1",value:"--v 5.1"},{label:"Niji V6",value:"--niji 6"},{label:"Niji V5",value:"--niji 5"},{label:"Niji V4",value:"--niji 4"}],T2=(e,t)=>{let n=1024,s=1024;if(Wb(t)){const g=String(t).trim().split(/[xX]/),x=parseInt(g[0],10),N=parseInt(g[1],10);if(Number.isFinite(x)&&Number.isFinite(N)){const C=Math.max(16,Math.round(x/16)*16),A=Math.max(16,Math.round(N/16)*16);return{str:`${C}x${A}`,w:C,h:A}}}if(t==="1080P")n=1920,s=1080;else if(t==="720P")n=1280,s=720;else if(t==="2K")n=2048,s=2048;else if(t==="4K")n=3840,s=2160;else if(typeof t=="string"){const g=t.toUpperCase().match(/^(\d+)K$/);if(g){const x=parseInt(g[1],10)*1024;n=x,s=x}}if(e==="Auto")return{str:`${n}x${s}`,w:n,h:s};const[a,c]=e.split(":").map(Number);if(!a||!c)return{str:"1024x1024",w:1024,h:1024};let d,h;return Math.abs(a-c)<.1?(d=n,h=s):a>c?(d=t==="Auto"||t==="1K"?1280:n,h=Math.round(d*(c/a))):(h=t==="Auto"||t==="1K"?1280:n,d=Math.round(h*(a/c))),d=Math.round(d/16)*16,h=Math.round(h/16)*16,{str:`${d}x${h}`,w:d,h}},yE=(e,t,n)=>{const{str:s,w:a,h:c}=T2(t,n);return Wb(n)?{sizeStr:s,w:a,h:c}:e.includes("minimax")?{sizeStr:n==="4K"?"1080p":"720p",w:a,h:c}:e.includes("jimeng")||e.includes("veo")?{sizeStr:t,w:a,h:c}:e.includes("grok")?{sizeStr:t,w:a,h:c}:{sizeStr:s,w:a,h:c}},ql="tapnow_autosave",M2="tapnow_autosave_meta",vE="tapnow_autosave_db",vl="autosave",Hx="tapnow_asset_bundle_meta";let ld=null;const R2=()=>{if(ld)return ld;try{const e=localStorage.getItem(Hx);return ld=e?JSON.parse(e):null,ld}catch{return ld=null,null}},Lg=e=>{try{if(ld=e||null,!e){localStorage.removeItem(Hx);return}localStorage.setItem(Hx,JSON.stringify(e))}catch{}},O2=e=>{if(!e)return"";const t=R2();return!t||!t.idToOriginal?"":t.idToOriginal[e]||""},Kb="latest",Jb=()=>typeof indexedDB>"u"?Promise.reject(new Error("IndexedDB not available")):new Promise((e,t)=>{const n=indexedDB.open(vE,1);n.onupgradeneeded=()=>{const s=n.result;s.objectStoreNames.contains(vl)||s.createObjectStore(vl)},n.onsuccess=()=>e(n.result),n.onerror=()=>t(n.error||new Error("IndexedDB open failed"))}),wE=async()=>{try{const e=await Jb();return await new Promise(t=>{const n=e.transaction(vl,"readonly"),a=n.objectStore(vl).get(Kb);a.onsuccess=()=>t(a.result||null),a.onerror=()=>t(null),n.oncomplete=()=>e.close(),n.onerror=()=>e.close()})}catch{return null}},qw=async e=>{const t=await Jb();return await new Promise((n,s)=>{const a=t.transaction(vl,"readwrite"),d=a.objectStore(vl).put(e,Kb);d.onsuccess=()=>n(!0),d.onerror=()=>s(d.error||new Error("IndexedDB write failed")),a.oncomplete=()=>t.close(),a.onerror=()=>t.close()})},bh=()=>{try{const e=localStorage.getItem(M2);return e?JSON.parse(e):null}catch{return null}},Gu=e=>{try{localStorage.setItem(M2,JSON.stringify(e))}catch{}},os=e=>new Promise((t,n)=>{const s=new Image;s.onload=()=>t({w:s.naturalWidth,h:s.naturalHeight}),s.onerror=()=>n(new Error("Failed to load image")),s.src=e}),ur=e=>{if(!e)return!1;if(e.startsWith("data:video")||e.includes("force_video_display=true"))return!0;const t=e.split(".").pop().split("?")[0].toLowerCase();return["mp4","webm","ogg","mov"].includes(t)},zE=e=>{if(!e||typeof e!="string")return"";const n=e.split("?")[0].split("#")[0].split(".").pop().toLowerCase();return{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",bmp:"image/bmp",svg:"image/svg+xml",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",mov:"video/quicktime"}[n]||""},id=e=>new Promise((t,n)=>{const s=document.createElement("video");s.preload="metadata",s.muted=!0,s.playsInline=!0,s.onloadedmetadata=()=>{t({duration:Number(s.duration)||0,w:s.videoWidth||0,h:s.videoHeight||0})},s.onerror=()=>n(new Error("")),s.src=e}),kE=(e,{fps:t=2}={})=>new Promise((n,s)=>{const a=document.createElement("video"),c=document.createElement("canvas"),d=c.getContext("2d");a.muted=!0,a.playsInline=!0,a.crossOrigin="anonymous",a.src=e;const h=[],g=()=>s(new Error(""));a.onerror=g,a.onloadedmetadata=()=>{const x=Number(a.duration)||0;if(!x||!isFinite(x)){s(new Error(""));return}c.width=a.videoWidth||1280,c.height=a.videoHeight||720;const N=1/Math.max(.1,t);let C=0;const A=()=>{d.drawImage(a,0,0,c.width,c.height),h.push({time:Number(C.toFixed(2)),url:c.toDataURL("image/jpeg",.82)}),C+=N,C<=x?a.currentTime=Math.min(C,x):n(h)};a.onseeked=A,a.currentTime=0}}),jE=ic.memo(({img1:e,img2:t,theme:n="dark",language:s})=>{const[a,c]=M.useState(50),d=M.useRef(null),[h,g]=M.useState(!1),x=M.useRef(),N=n==="solarized",C=n==="dark",A=M.useCallback(L=>{d.current&&(x.current||(x.current=requestAnimationFrame(()=>{if(!d.current)return;const S=d.current.getBoundingClientRect(),P=L.touches?L.touches[0].clientX:L.clientX,O=Math.max(0,Math.min(P-S.left,S.width));c(O/S.width*100),x.current=null})))},[]);M.useEffect(()=>()=>{x.current&&cancelAnimationFrame(x.current)},[]);const _=L=>!L||typeof L!="string"?L:L.startsWith("data:")?yo(L):L,R=_(e),$=_(t||e);return R?i.jsxs("div",{ref:d,className:`relative w-full h-full cursor-col-resize overflow-hidden group rounded-lg select-none shadow-2xl border ${C?"border-zinc-800 bg-[#09090b]":N?"border-[#eee8d5] bg-[#eee8d5]":"border-zinc-200 bg-zinc-100"}`,onMouseMove:A,onTouchMove:A,onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:[i.jsx("div",{className:"absolute inset-0 opacity-20 pointer-events-none",style:{backgroundImage:`conic-gradient(${C?"#333":N?"#c9c2a8":"#bbb"} 90deg, transparent 90deg), conic-gradient(transparent 90deg, ${C?"#333":N?"#c9c2a8":"#bbb"} 90deg)`,backgroundSize:"20px 20px",backgroundPosition:"0 0, 10px 10px"}}),i.jsx(nn,{src:R,loading:"lazy",decoding:"async",className:"absolute inset-0 w-full h-full object-contain pointer-events-none select-none",draggable:!1}),i.jsx("div",{className:"absolute inset-0 w-full h-full overflow-hidden pointer-events-none select-none",style:{clipPath:`inset(0 0 0 ${a}%)`},children:i.jsx(nn,{src:$,loading:"lazy",decoding:"async",className:"absolute inset-0 w-full h-full object-contain",draggable:!1})}),i.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white/80 shadow-[0_0_10px_rgba(0,0,0,0.5)] pointer-events-none",style:{left:`${a}%`},children:i.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-6 h-6 bg-white rounded-full shadow-lg flex items-center justify-center text-black",children:i.jsx(Ox,{size:12,className:"rotate-90"})})}),i.jsx("div",{className:`absolute bottom-2 left-2 bg-black/70 text-white text-[10px] font-medium px-2 py-0.5 rounded border border-white/10 transition-opacity duration-200 pointer-events-none ${h?"opacity-100":"opacity-60"}`,children:j("")}),i.jsx("div",{className:`absolute bottom-2 right-2 bg-blue-600/80 text-white text-[10px] font-medium px-2 py-0.5 rounded border border-white/10 transition-opacity duration-200 pointer-events-none ${h?"opacity-100":"opacity-60"}`,children:j("")})]}):i.jsxs("div",{className:`w-full h-full flex flex-col items-center justify-center rounded-lg border border-dashed pointer-events-none ${C?"text-zinc-500 bg-zinc-900/50 border-zinc-800":N?"text-zinc-600 bg-[#eee8d5] border-[#d7cfb2]":"text-zinc-500 bg-zinc-100 border-zinc-200"}`,children:[i.jsx(Ox,{size:24,className:"mb-2 opacity-50"}),i.jsx("span",{className:"text-xs font-medium",children:""})]})}),yh=ic.memo(({children:e,onClick:t,className:n="",variant:s="primary",icon:a,disabled:c=!1,title:d=""})=>{const h="flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 font-medium text-xs select-none disabled:opacity-50 disabled:cursor-not-allowed",g={primary:"bg-blue-600 hover:bg-blue-500 text-white shadow-lg shadow-blue-900/20 active:scale-95",secondary:"bg-zinc-800 hover:bg-zinc-700 text-zinc-300 border border-zinc-700 active:scale-95",ghost:"bg-transparent hover:bg-zinc-800 text-zinc-400 hover:text-white",danger:"bg-red-900/30 hover:bg-red-800 text-red-200 border border-red-800 active:scale-95"};return i.jsxs("button",{onClick:t,disabled:c,className:`${h} ${g[s]} ${n}`,title:d,children:[a&&i.jsx(a,{size:14,className:e?"mr-1.5":""}),e]})}),vh=(e,t)=>{let n;return function(...a){const c=()=>{clearTimeout(n),e(...a)};clearTimeout(n),n=setTimeout(c,t)}},NE=({isOpen:e,onClose:t,title:n,children:s,theme:a="dark"})=>{if(!e)return null;const c=a==="dark",d=a==="solarized";return i.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm",onMouseDown:t,children:i.jsxs("div",{className:`rounded-xl shadow-2xl w-[680px] max-w-[90vw] overflow-hidden animate-in fade-in zoom-in-95 duration-200 flex flex-col max-h-[85vh] border ${c?"bg-[#09090b] border-zinc-800":d?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:h=>h.stopPropagation(),onClick:h=>h.stopPropagation(),children:[i.jsxs("div",{className:`flex items-center justify-between p-5 border-b shrink-0 ${c?"border-zinc-800/50":d?"border-[#d7cfb2]":"border-zinc-200"}`,children:[i.jsx("h3",{className:`font-bold text-lg ${c?"text-white":"text-zinc-900"}`,children:n}),i.jsx("button",{onClick:t,className:c?"text-zinc-500 hover:text-white":d?"text-zinc-600 hover:text-zinc-900":"text-zinc-500 hover:text-zinc-900",children:i.jsx(ui,{size:20})})]}),i.jsx("div",{className:`p-0 overflow-y-auto custom-scrollbar flex-1 ${c?"bg-[#09090b]":d?"bg-[#eee8d5]":"bg-white"}`,children:s})]})})},SE=({item:e,onClose:t,onNavigate:n,onShotNavigate:s,onHistoryNavigate:a})=>{var R;if(!e)return null;const c=M.useRef(e);M.useEffect(()=>{c.current=e},[e]);const d=($,L={})=>{const S=c.current||e;console.log("[Lightbox]",$,{id:S==null?void 0:S.id,type:S==null?void 0:S.type,url:S==null?void 0:S.url,mjCount:Array.isArray(S==null?void 0:S.mjImages)?S.mjImages.length:0,...L})};M.useEffect(()=>{e&&d("open")},[e]);const h=e.type==="video"||e.url&&ur(e.url),g=M.useMemo(()=>{const $=[],L=S=>{S&&!$.includes(S)&&$.push(S)};return L(e.url),h||L(e.thumbnailUrl),L(e.originalUrl),L(e.mjOriginalUrl),$},[e,h]),[x,N]=M.useState(0);M.useEffect(()=>{N(0)},[e,g.length]);const C=g[x]||e.url,A=()=>{d("media_error",{index:x,total:g.length}),N($=>$<g.length-1?$+1:$)},_=($="manual")=>{d("close",{reason:$}),t&&t()};return M.useEffect(()=>{if(!e)return;const $=L=>{const S=c.current;if(S&&!(L.target.tagName==="INPUT"||L.target.tagName==="TEXTAREA"))if(L.key==="ArrowLeft"||L.key==="Left"){if(!S.mjImages||S.mjImages.length<=1)return;L.preventDefault(),L.stopPropagation();const P=S.selectedMjImageIndex!==void 0?S.selectedMjImageIndex:0,O=P>0?P-1:S.mjImages.length-1;O>=0&&O<S.mjImages.length&&n&&(d("navigate_left",{from:P,to:O,total:S.mjImages.length}),c.current={...S,selectedMjImageIndex:O,url:S.mjImages[O]},n(O))}else if(L.key==="ArrowRight"||L.key==="Right"){if(!S.mjImages||S.mjImages.length<=1)return;L.preventDefault(),L.stopPropagation();const P=S.selectedMjImageIndex!==void 0?S.selectedMjImageIndex:0,O=P<S.mjImages.length-1?P+1:0;O>=0&&O<S.mjImages.length&&n&&(d("navigate_right",{from:P,to:O,total:S.mjImages.length}),c.current={...S,selectedMjImageIndex:O,url:S.mjImages[O]},n(O))}else if(L.key==="ArrowUp"||L.key==="Up")if(L.preventDefault(),L.stopPropagation(),S.storyboardContext&&s){const{shotIndex:P,allShots:O}=S.storyboardContext;P>0&&(d("shot_up",{from:P,to:P-1,total:O.length}),s(P-1,O))}else a&&(d("history_up"),a(-1));else if(L.key==="ArrowDown"||L.key==="Down")if(L.preventDefault(),L.stopPropagation(),S.storyboardContext&&s){const{shotIndex:P,allShots:O}=S.storyboardContext;P<O.length-1&&(d("shot_down",{from:P,to:P+1,total:O.length}),s(P+1,O))}else a&&(d("history_down"),a(1));else(L.key==="Escape"||L.key==="Esc")&&(L.preventDefault(),L.stopPropagation(),_("esc"))};return window.addEventListener("keydown",$),()=>{window.removeEventListener("keydown",$)}},[e,n,s,a]),i.jsxs("div",{className:"fixed inset-0 z-[200] lightbox-overlay flex flex-col items-center justify-center animate-in fade-in duration-200",onClick:()=>_("overlay"),children:[i.jsx("button",{className:"absolute top-4 right-4 text-white/70 hover:text-white p-2 bg-black/50 rounded-full transition-colors",onClick:()=>_("button"),children:i.jsx(ui,{size:24})}),i.jsxs("div",{className:"max-w-[90vw] max-h-[85vh] relative",onClick:$=>$.stopPropagation(),children:[e.type==="image"?i.jsx(nn,{src:C,alt:e.prompt,className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain",onError:A}):i.jsx(pa,{src:C,controls:!0,autoPlay:!0,className:"max-w-full max-h-[85vh] rounded-lg shadow-2xl",poster:e.thumbnailUrl||void 0,onError:A}),i.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 bg-black/60 backdrop-blur-md px-6 py-3 rounded-full text-white text-sm font-medium border border-white/10 text-center shadow-2xl",children:[i.jsx("div",{className:"line-clamp-1 max-w-xl",children:e.prompt}),i.jsxs("div",{className:"text-[10px] text-zinc-400 mt-1",children:[e.width,"x",e.height,"  ",e.id,e.mjImages&&e.mjImages.length>1&&i.jsxs("span",{className:"ml-2",children:["(",(e.selectedMjImageIndex!==void 0?e.selectedMjImageIndex:0)+1,"/",e.mjImages.length,")"]}),e.storyboardContext&&i.jsxs("span",{className:"ml-2 text-blue-400",children:["Shot ",e.storyboardContext.shotIndex+1,"/",((R=e.storyboardContext.allShots)==null?void 0:R.length)||1]})]})]}),e.mjImages&&e.mjImages.length>1&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white p-3 bg-black/50 rounded-full transition-colors",onClick:$=>{$.stopPropagation();const L=e.selectedMjImageIndex!==void 0?e.selectedMjImageIndex:0,S=L>0?L-1:e.mjImages.length-1;n&&n(S)},title:j(" ()"),children:i.jsx(WC,{size:24})}),i.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 text-white/70 hover:text-white p-3 bg-black/50 rounded-full transition-colors",onClick:$=>{$.stopPropagation();const L=e.selectedMjImageIndex!==void 0?e.selectedMjImageIndex:0,S=L<e.mjImages.length-1?L+1:0;n&&n(S)},title:j(" ()"),children:i.jsx(Zl,{size:24})})]})]})]})};function _E(){var _v,Cv;const[e,t]=M.useState(()=>{try{return localStorage.getItem("tapnow_theme")||"dark"}catch{return"dark"}}),[n,s]=M.useState("zh");M.useEffect(()=>{rs.language!==n&&rs.changeLanguage(n)},[n]);const[a,c]=M.useState([]),d=M.useCallback((r,o="info",l=3e3)=>{const u=Date.now();c(p=>[...p,{id:u,message:r,type:o}]),setTimeout(()=>{c(p=>p.filter(f=>f.id!==u))},l)},[]);M.useEffect(()=>{const r=document.createElement("style");return r.innerText=q3,document.head.appendChild(r),()=>{document.head.removeChild(r)}},[]),M.useEffect(()=>{window.__APP_BOOTED__=!0,window.__APP_BOOT_TIMER__&&(clearTimeout(window.__APP_BOOT_TIMER__),window.__APP_BOOT_TIMER__=null)},[]),M.useEffect(()=>{try{localStorage.setItem("tapnow_theme",e)}catch{}const r=document.documentElement;r.classList.remove("theme-dark","theme-light","theme-solarized"),e==="dark"?(r.classList.add("theme-dark"),document.body.style.backgroundColor="#09090b"):e==="solarized"?(r.classList.add("theme-solarized"),document.body.style.backgroundColor="#fdf6e3"):(r.classList.add("theme-light"),document.body.style.backgroundColor="#f4f4f5")},[e]);const h=M.useRef(!1);M.useEffect(()=>{const r=bh();h.current=(r==null?void 0:r.storage)==="idb"},[]),M.useEffect(()=>{const r=R2();if(!r)return;const o=r.idToOriginal||{},l=r.pathToOriginal||{},p={...r.pathToId||{}};if(Object.entries(o).forEach(([f,m])=>{f&&m&&Kd.current.set(f,m)}),Object.entries(l).forEach(([f,m])=>{f&&m&&Yo.current.set(f,m)}),Object.keys(p).length===0&&Object.keys(o).length>0&&Object.keys(l).length>0){const f=new Map(Object.entries(o).map(([m,y])=>[y,m]));Object.entries(l).forEach(([m,y])=>{if(!m||!y)return;const b=f.get(y);b&&(p[m]=b)})}Object.entries(p).forEach(([f,m])=>{f&&m&&Wd.current.set(f,m)}),(Object.keys(o).length>0||Object.keys(l).length>0||Object.keys(p).length>0)&&U0(!0)},[]),M.useEffect(()=>{const r=setInterval(()=>{(async()=>{const l=Date.now(),p={nodes:await du(qs.current),connections:Bc.current,timestamp:l},f=JSON.stringify(p);try{await qw(f),h.current=!0,Gu({timestamp:l,storage:"idb"});try{localStorage.removeItem(ql)}catch{}console.log("[AutoSave]  IndexedDB",new Date().toLocaleTimeString())}catch{try{if(f.length>4194304)throw new Error("payload too large");localStorage.setItem(ql,f),h.current=!1,Gu({timestamp:l,storage:"local"}),console.log("[AutoSave] IndexedDB ",new Date().toLocaleTimeString())}catch(y){console.warn("[AutoSave] :",y.message||y)}}})()},6e4);return()=>clearInterval(r)},[]),M.useEffect(()=>{const r=o=>{if(qs.current&&qs.current.length>0)return o.preventDefault(),o.returnValue="",o.returnValue};return window.addEventListener("beforeunload",r),()=>window.removeEventListener("beforeunload",r)},[]);const[g,x]=M.useState(()=>{try{const r=bh();if((r==null?void 0:r.storage)==="idb")return[];const o=localStorage.getItem(ql);if(o)return JSON.parse(o).nodes||[];const l=localStorage.getItem("tapnow_nodes");return l?JSON.parse(l):[]}catch{return[]}}),[N,C]=M.useState(()=>{try{const r=bh();if((r==null?void 0:r.storage)==="idb")return[];const o=localStorage.getItem(ql);if(o)return JSON.parse(o).connections||[];const l=localStorage.getItem("tapnow_connections");return l?JSON.parse(l):[]}catch{return[]}});M.useEffect(()=>{const r=bh();if((r==null?void 0:r.storage)!=="idb")return;let o=!1;return(async()=>{const u=await wE();if(!(!u||o))try{const p=JSON.parse(u);Array.isArray(p.nodes)&&x(p.nodes),Array.isArray(p.connections)&&C(p.connections)}catch{}})(),()=>{o=!0}},[]);const[A,_]=M.useState(()=>{const r=localStorage.getItem("tapnow_max_undo_steps");return r?Math.min(30,Math.max(1,parseInt(r)||5)):5}),[R,$]=M.useState([]),[L,S]=M.useState([]),P=M.useRef(!1),[O,K]=M.useState(null),[Q,ue]=M.useState(null),[oe,we]=M.useState(null),[he,ze]=M.useState([]),[ot,re]=M.useState([]),Se=M.useRef(new Map),D=M.useRef(new Map),[Me,Ut]=M.useState(()=>{try{return localStorage.getItem("tapnow_batch_queue_mode")||"parallel"}catch{return"parallel"}}),[je,_e]=M.useState(0),[be,Xe]=M.useState(()=>parseInt(localStorage.getItem("tapnow_batch_concurrency")||"1")),de=M.useRef(new Set),fe=M.useRef("idle");M.useEffect(()=>{localStorage.setItem("tapnow_batch_concurrency",be)},[be]),M.useEffect(()=>{localStorage.setItem("tapnow_batch_queue_mode",Me)},[Me]);const Ge=M.useCallback(()=>{P.current||($(r=>[...r,{nodes:JSON.parse(JSON.stringify(g)),connections:JSON.parse(JSON.stringify(N))}].slice(-A)),S([]))},[g,N]),gt=M.useRef(Ge);M.useEffect(()=>{gt.current=Ge},[Ge]),M.useEffect(()=>{if(he.length===0){fe.current="idle",de.current.clear();return}let r=0;const o=[],l=Date.now(),u=6e4;if(g.forEach(b=>{var w;(w=b.settings)!=null&&w.shots&&b.settings.shots.forEach(v=>{v.status==="generating"&&(r++,v.generationStartTime&&l-v.generationStartTime>u&&o.push({nodeId:b.id,shotId:v.id}));const z=`${b.id}:${v.id}`;de.current.has(z)&&(v.status==="generating"||v.status==="done"||v.status==="failed")&&de.current.delete(z)})}),o.length>0&&(console.warn(`[Batch] ${o.length} tasks timed out (>${u/1e3}s). Auto-marking as failed.`),o.forEach(({nodeId:b,shotId:w})=>{ar(b,w,{status:"failed",errorMsg:"60s"},{onlyIfStatus:"generating"})}),r-=o.length),r+de.current.size>0){fe.current="running";return}if(fe.current==="running"){fe.current="cooling",setTimeout(()=>{fe.current="idle",_e(b=>b+1)},1e3);return}if(fe.current==="cooling")return;const f=be===0?he.length:be,m=he.slice(0,f),y=he.slice(f);m.length>0&&(ze(y),fe.current="running",m.forEach(b=>{var z,k;de.current.add(`${b.nodeId}:${b.shotId}`);const w=g.find(T=>T.id===b.nodeId),v=(k=(z=w==null?void 0:w.settings)==null?void 0:z.shots)==null?void 0:k.find(T=>T.id===b.shotId);v&&(b.mode==="image"?mv(b.nodeId,v):hv(b.nodeId,v))}))},[he,g,be,je]),M.useEffect(()=>{if(he.length===0)return;const r=setInterval(()=>{_e(o=>o+1)},5e3);return()=>clearInterval(r)},[he.length>0]);const We=M.useCallback((r=!1)=>{ze([]),de.current.clear(),fe.current="idle",D.current.clear(),r&&x(o=>o.map(l=>{var m;if(l.type!=="storyboard-node")return l;const u=((m=l.settings)==null?void 0:m.shots)||[];let p=!1;const f=u.map(y=>y.status==="generating"?(p=!0,{...y,status:"failed",errorMsg:""}):y);return p?{...l,settings:{...l.settings,shots:f}}:l}))},[ze,x]),Ir=M.useCallback((r,o)=>{ze(l=>l.filter(u=>!(u.nodeId===r&&u.shotId===o))),de.current.delete(`${r}:${o}`),ar(r,o,{status:"draft",errorMsg:""})},[ze]),Qr=M.useCallback((r,o)=>{ar(r,o,{status:"failed",errorMsg:""})},[]),br=M.useCallback(r=>{ze(o=>o.filter(l=>l.batchId!==r?!0:(de.current.delete(`${l.nodeId}:${l.shotId}`),D.current.delete(`${l.nodeId}:${l.shotId}`),ar(l.nodeId,l.shotId,{status:"draft",errorMsg:""}),!1)))},[ze]),$r=M.useCallback((r,o=!1)=>{ze(l=>l.filter(u=>u.nodeId!==r?!0:(de.current.delete(`${u.nodeId}:${u.shotId}`),D.current.delete(`${u.nodeId}:${u.shotId}`),!1))),o&&x(l=>l.map(u=>{var y;if(u.id!==r||u.type!=="storyboard-node")return u;const p=((y=u.settings)==null?void 0:y.shots)||[];let f=!1;const m=p.map(b=>b.status==="generating"?(f=!0,{...b,status:"failed",errorMsg:""}):b);return f?{...u,settings:{...u.settings,shots:m}}:u}))},[ze,x]),mn=M.useMemo(()=>he.map((r,o)=>{var m,y;const l=g.find(b=>b.id===r.nodeId),u=((m=l==null?void 0:l.settings)==null?void 0:m.shots)||[],p=u.findIndex(b=>b.id===r.shotId),f=p>=0?u[p]:null;return{...r,order:o+1,projectTitle:((y=l==null?void 0:l.settings)==null?void 0:y.projectTitle)||"",sceneIndex:(f==null?void 0:f.scene_index)||(p>=0?p+1:"?"),taskIndex:r.taskIndex,batchId:r.batchId,batchOrder:r.batchOrder,batchConcurrency:r.batchConcurrency}}),[he,g]),Kr=M.useMemo(()=>{const r=[];return g.forEach(o=>{var u;if(o.type!=="storyboard-node")return;(((u=o.settings)==null?void 0:u.shots)||[]).forEach((p,f)=>{var y;if(p.status!=="generating")return;const m=D.current.get(`${o.id}:${p.id}`)||{};r.push({nodeId:o.id,shotId:p.id,projectTitle:((y=o.settings)==null?void 0:y.projectTitle)||"",sceneIndex:p.scene_index||f+1,batchId:m.batchId,batchOrder:m.batchOrder,taskIndex:m.taskIndex})})}),r},[g]);M.useEffect(()=>{const r=new Set;if(he.forEach(o=>{r.add(`${o.nodeId}:${o.shotId}`)}),g.forEach(o=>{var u;if(o.type!=="storyboard-node")return;(((u=o.settings)==null?void 0:u.shots)||[]).forEach(p=>{p.status==="generating"&&r.add(`${o.id}:${p.id}`)})}),r.size===0){D.current.clear(),re([]);return}D.current.forEach((o,l)=>{r.has(l)||D.current.delete(l)}),re(o=>o.filter(l=>l.shotIds.some(u=>r.has(`${l.nodeId}:${u}`))))},[he,g]);const ns=M.useCallback(()=>{if(R.length===0)return;P.current=!0;const r=R[R.length-1];S(o=>[...o,{nodes:JSON.parse(JSON.stringify(g)),connections:JSON.parse(JSON.stringify(N))}]),x(r.nodes),C(r.connections),$(o=>o.slice(0,-1)),setTimeout(()=>{P.current=!1},100)},[R,g,N]),St=M.useCallback(()=>{if(L.length===0)return;P.current=!0;const r=L[L.length-1];$(o=>[...o,{nodes:JSON.parse(JSON.stringify(g)),connections:JSON.parse(JSON.stringify(N))}]),x(r.nodes),C(r.connections),S(o=>o.slice(0,-1)),setTimeout(()=>{P.current=!1},100)},[L,g,N]);M.useEffect(()=>{const r=o=>{(o.ctrlKey||o.metaKey)&&o.key==="z"&&(o.shiftKey?(o.preventDefault(),St()):(o.preventDefault(),ns()))};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[ns,St]);const[E,Ce]=M.useState(()=>({...td})),Ee=r=>{if(!r||typeof r!="object")return{...td};const o=Number.isFinite(r.x)?r.x:td.x,l=Number.isFinite(r.y)?r.y:td.y,u=Number.isFinite(r.zoom)&&r.zoom>0?r.zoom:td.zoom;return{x:o,y:l,zoom:u}},ee=M.useRef({x:0,y:0,zoom:1});M.useRef(null),M.useRef(new Map),M.useRef(new Map);const[q,le]=M.useState(null),Fe=(r,o={})=>({...tp[r]||{key:"",url:Ps,apiType:"openai",useProxy:!1,forceAsync:!1},...o,enabled:(o==null?void 0:o.enabled)!==!1}),[Oe,ke]=M.useState(()=>{const r=localStorage.getItem("tapnow_model_library");if(r)try{const o=JSON.parse(r);if(Array.isArray(o))return o.map(l=>({id:l.id,displayName:l.displayName||l.modelName||l.id,modelName:l.modelName||l.displayName||l.id,type:l.type||"Chat",apiType:l.apiType||"openai",ratioLimits:Array.isArray(l.ratioLimits)?l.ratioLimits:null,ratioNotes:es(l.ratioNotes),ratioNotesEnabled:!!l.ratioNotesEnabled,resolutionLimits:Array.isArray(l.resolutionLimits)?l.resolutionLimits:null,resolutionNotes:nl(l.resolutionNotes),resolutionNotesEnabled:!!l.resolutionNotesEnabled,durations:Array.isArray(l.durations)?l.durations:null,durationNotes:es(l.durationNotes),durationNotesEnabled:!!l.durationNotesEnabled,videoResolutions:Array.isArray(l.videoResolutions)?l.videoResolutions:null,videoResolutionNotes:es(l.videoResolutionNotes),videoResolutionNotesEnabled:!!l.videoResolutionNotesEnabled,supportsFirstLastFrame:!!l.supportsFirstLastFrame,supportsHD:!!l.supportsHD,customParams:da(l.customParams),asyncConfig:l.asyncConfig&&typeof l.asyncConfig=="object"?l.asyncConfig:null,previewOverrideEnabled:!!l.previewOverrideEnabled,previewOverridePatch:fa(l.previewOverridePatch),requestTemplate:Gi(l.requestTemplate||xo(l)),requestOverrideEnabled:!!l.requestOverrideEnabled,requestOverridePatch:Lo(l.requestOverridePatch)})).filter(l=>l.id)}catch(o){console.error(" modelLibrary :",o)}return rE.map(o=>({...o}))}),at=M.useRef(!1),[_t,tt]=M.useState(()=>{const r=localStorage.getItem("tapnow_model_library_collapsed");if(r)try{const o=JSON.parse(r);if(Array.isArray(o))return at.current=!0,new Set(o.filter(Boolean))}catch(o){console.warn(":",o)}return new Set});M.useEffect(()=>{try{localStorage.setItem("tapnow_model_library",JSON.stringify(Oe))}catch(r){console.error(" modelLibrary :",r)}},[Oe]),M.useEffect(()=>{Oe.length&&tt(r=>{const o=new Set,l=at.current;return Oe.forEach(u=>{r.has(u.id)?o.add(u.id):l||o.add(u.id)}),at.current=!0,o})},[Oe]),M.useEffect(()=>{try{const r=Array.from(_t);localStorage.setItem("tapnow_model_library_collapsed",JSON.stringify(r))}catch(r){console.error(":",r)}},[_t]);const[Ye,kr]=M.useState(()=>{const r=localStorage.getItem("tapnow_api_configs");if(r)try{let o=JSON.parse(r);o=o.map(p=>{const f={...p,id:p.id||p.modelName,provider:p.provider,type:p.type||"Chat",modelName:p.modelName||p.id,displayName:p.displayName||p.modelName||p.id,...p.durations?{durations:p.durations}:{}},{key:m,url:y,isCustom:b,...w}=f;return w}),o=o.filter(p=>!Fx.includes(p.id));const l=new Set(o.map(p=>p.id).filter(Boolean));return Ux.filter(p=>Ci(p.type)).forEach(p=>{l.has(p.id)||(o.push(p),l.add(p.id))}),o=o.map(p=>p._uid?p:{...p,_uid:`uid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}),o}catch(o){console.error("[V3.6.0]  apiConfigs :",o)}return Ux.map(o=>({...o,_uid:`uid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}))}),[Ft,zn]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_providers");if(r){const o=JSON.parse(r);return Object.fromEntries(Object.entries(o).map(([l,u])=>[l,Fe(l,u)]))}}catch(r){console.error(" providers :",r)}return Object.fromEntries(Object.entries(tp).map(([r,o])=>[r,Fe(r,o)]))});M.useEffect(()=>{try{localStorage.setItem("tapnow_providers",JSON.stringify(Ft))}catch(r){console.error(" providers :",r)}},[Ft]),M.useCallback(r=>{const o=Ye.find(u=>u.id===r);if(!o)return{key:"",url:Ps,id:r};const l=Ft[o.provider]||{};return{...o,modelName:o.id,key:l.key||"",url:l.url||Ps}},[Ye,Ft]);const[Ns,Ss]=M.useState(()=>localStorage.getItem("tapnow_global_key")||""),[Ms,sn]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_api_blacklist");if(!r)return{};const o=JSON.parse(r),l=new Date().toDateString();return o.date!==l?{}:o.blacklist||{}}catch{return{}}});M.useEffect(()=>{try{localStorage.setItem("tapnow_api_blacklist",JSON.stringify({date:new Date().toDateString(),blacklist:Ms}))}catch{}},[Ms]);const Rs=M.useRef(Ms);M.useEffect(()=>{Rs.current=Ms},[Ms]);const _s=(r,o)=>{if(!r)return;const l={date:new Date().toDateString(),reason:o,timestamp:Date.now()},u=Rs.current||{};Rs.current={...u,[r]:l},sn(p=>({...p,[r]:l}))},[Cn,Ko]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_api_suspend");if(!r)return{};const o=JSON.parse(r),l=Date.now();return Object.fromEntries(Object.entries(o).filter(([,u])=>l-u.timestamp<60*60*1e3))}catch{return{}}});M.useEffect(()=>{try{localStorage.setItem("tapnow_api_suspend",JSON.stringify(Cn))}catch{}},[Cn]);const No=M.useRef(Cn);M.useEffect(()=>{No.current=Cn},[Cn]);const Dd=(r,o,l=60*60*1e3)=>{if(!r)return;const u={reason:o,timestamp:Date.now(),ttl:l};No.current={...No.current,[r]:u},Ko(p=>({...p,[r]:u}))},Na=r=>{var l;const o=(l=No.current)==null?void 0:l[r];return o?Date.now()-o.timestamp<(o.ttl||60*60*1e3):!1},Ri=M.useRef([]),Jo=2*60*1e3,Oi=10,A0=()=>{const r=Date.now(),o=Ri.current.filter(l=>r-l<Jo);return Ri.current=o,o.length>=Oi},T0=()=>{Ri.current.push(Date.now())},[Dn,Sa]=M.useState(()=>{const r=localStorage.getItem("tapnow_jimeng_use_local_file");return r!==null?r==="true":!0}),[cs,gc]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_nodes");return!r||JSON.parse(r).length===0?(localStorage.removeItem("tapnow_project_name"),""):localStorage.getItem("tapnow_project_name")||""}catch{return""}}),[Ud,xc]=M.useState(!1),Fd=M.useRef(null),[bc,ds]=M.useState({visible:!1,progress:0,status:"",type:"import"}),[xn,Vp]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_history_performance_mode");return r!==null?r==="true"?"normal":r==="false"?"off":r||"off":localStorage.getItem("tapnow_performance_mode")||"off"}catch{return"off"}}),[Li,Bd]=M.useState(()=>{try{return localStorage.getItem("tapnow_global_performance_mode")||"off"}catch{return"off"}}),[yr,no]=M.useState(()=>localStorage.getItem("tapnow_local_server_url")||"http://127.0.0.1:9527"),[Hs,yc]=M.useState(!1),[Vs,Hd]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_local_cache_enabled");if(r!==null)return r==="true";const o=localStorage.getItem("tapnow_show_local_cache_banner");return o===null?!0:o==="true"}catch{return!0}}),[Os,nr]=M.useState(()=>{try{return localStorage.getItem("tapnow_cache_redownload_on_enable")==="true"}catch{return!1}}),[ce,dt]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_save_history_assets");return r===null?!0:r==="true"}catch{return!0}}),[Yt,bn]=M.useState(0),[ms,yn]=M.useState(!1),Tn=M.useRef(null),Kt=Vs&&Hs,[Br,qo]=M.useState({savePath:"",imageSavePath:"",videoSavePath:"",convertPngToJpg:!0,jpgQuality:95,pilAvailable:!1}),kn=M.useRef(new Map),Go=M.useRef(new Set),Wp=M.useRef(new Map),so=M.useRef(new Map),qb=M.useRef({savePath:"",imageSavePath:"",videoSavePath:""}),M0=M.useRef(new Map),Gb=M.useRef(new Map),R0=M.useRef(!1),O0=M.useRef(!1),jl=M.useRef(new Set),Di=M.useRef(!1),[Kp,Vd]=M.useState(0),Yo=M.useRef(new Map),Wd=M.useRef(new Map),L0=M.useRef(new Map),Kd=M.useRef(new Map),D0=M.useRef(new Set),[AE,U0]=M.useState(!1),_a=M.useRef(new Map),Nl=M.useCallback(r=>r?String(r).replace(/\\/g,"/").replace(/^\/+/,""):"",[]),Ca=M.useCallback(r=>{if(!r)return"";const o=(yr||"").replace(/\/+$/,"");if(!o||!r.startsWith(o))return"";const u=r.slice(o.length).match(/^\/file\/(.+)/);if(!u)return"";try{return Nl(decodeURIComponent(u[1]))}catch{return Nl(u[1])}},[yr,Nl]),Sl=M.useCallback(r=>{if(!r)return!1;const o=String(r),l=(yr||"").trim().replace(/\/+$/,"");if(l&&o.startsWith(`${l}/file/`))return!0;try{const u=new URL(o);if((u.hostname==="127.0.0.1"||u.hostname==="localhost")&&u.pathname.startsWith("/file/"))return!0}catch{}return!1},[yr]),gs=M.useCallback(r=>{if(!r)return!1;const o=Ca(r);return!o||!Di.current?!1:jl.current.has(o)},[Ca,Kp]),F0=M.useCallback((r={})=>{Yo.current.clear(),Wd.current.clear(),L0.current.clear(),Kd.current.clear(),D0.current.forEach(o=>{if(o&&o.startsWith("blob:"))try{URL.revokeObjectURL(o)}catch{}}),D0.current.clear(),_a.current.clear(),r.keepStorage||Lg(null),r.keepActive||U0(!1)},[]),F2=M.useCallback(()=>{const r=Object.fromEntries(Kd.current),o=Object.fromEntries(Yo.current),l=Object.fromEntries(Wd.current);if(Object.keys(r).length===0&&Object.keys(o).length===0&&Object.keys(l).length===0){Lg(null);return}Lg({idToOriginal:r,pathToOriginal:o,pathToId:l,updatedAt:Date.now()})},[]),vc=M.useCallback(r=>{if(!r||typeof r!="string"||!r.startsWith("asset://"))return r;const o=r.replace(/^asset:\/\//,"");return o&&(Wd.current.get(o)||Yo.current.get(o))||r},[]),Ea=M.useCallback(r=>{if(!r||typeof r!="string")return"";if(as.isImageId(r))return Kd.current.get(r)||"";if(r.startsWith("asset://")){const o=r.replace(/^asset:\/\//,"");return Yo.current.get(o)||""}return r.startsWith("blob:")&&L0.current.get(r)||""},[]),Jd=M.useCallback(async r=>{if(!r||typeof r!="string")return r;let o=r;if(o.startsWith("asset://")&&(o=vc(o)),as.isImageId(o)){const l=await as.getImage(o);return l||Ea(o)||o}return o},[vc,Ea]),Xo=M.useCallback(async r=>!r||typeof r!="string"?"":(as.isImageId(r)||r.startsWith("asset://"))&&await Jd(r)||r,[Jd]),Jp=M.useCallback((r,o=[],l=!1)=>{const u=(yr||"").trim().replace(/\/+$/,"");if(!u||!r||!Di.current)return"";const p=[l?"history":".tapnow_cache/history",l?".tapnow_cache/history":"history"],f=[];p.forEach(m=>{o.forEach(y=>{f.push(`${m}/${r}${y}`)})});for(const m of f){const y=Nl(m);if(jl.current.has(y))return`${u}/file/${y}`}return""},[yr,Nl,Kp]),Ia=M.useCallback(async(r={})=>{var u;if(!Kt)return;const o=(yr||"").replace(/\/+$/,"");if(!o)return;const l=r.silent===!0;try{const p=await fetch(`${o}/list-files`);if(!p.ok)throw new Error(`HTTP ${p.status}`);const f=await p.json(),m=Array.isArray(f==null?void 0:f.files)?f.files:Array.isArray((u=f==null?void 0:f.data)==null?void 0:u.files)?f.data.files:[],y=new Set;m.forEach(b=>{const w=Nl((b==null?void 0:b.rel_path)||(b==null?void 0:b.relPath)||(b==null?void 0:b.path)||"");w&&y.add(w)}),jl.current=y,Di.current=!0,Vd(b=>b+1),l||d("","success",1500)}catch{Di.current=!1,l||d("","warning",1500)}},[Kt,yr,Nl,d]);M.useEffect(()=>{localStorage.setItem("tapnow_performance_mode",xn),localStorage.setItem("tapnow_history_performance_mode",xn)},[xn]),M.useEffect(()=>{localStorage.setItem("tapnow_save_history_assets",String(ce))},[ce]),M.useEffect(()=>{localStorage.setItem("tapnow_global_performance_mode",Li)},[Li]),M.useEffect(()=>{localStorage.setItem("tapnow_local_server_url",yr)},[yr]),M.useEffect(()=>{try{localStorage.setItem("tapnow_local_cache_enabled",String(Vs))}catch{}},[Vs]),M.useEffect(()=>{try{localStorage.setItem("tapnow_cache_redownload_on_enable",String(Os))}catch{}},[Os]),M.useEffect(()=>{if(!Kt){Di.current=!1;return}Ia({silent:!0})},[Kt,yr,Br.savePath,Br.imageSavePath,Br.videoSavePath,Yt,Ia]);const io=(r,o={})=>{const l=o.allowLocalCache??Kt;if(!r)return"";const u=[];l&&(r.localCacheUrl&&u.push(r.localCacheUrl),r.localCacheMap&&typeof r.localCacheMap=="object"&&u.push(...Object.values(r.localCacheMap))),r.localCacheMap&&typeof r.localCacheMap=="object"&&u.push(...Object.keys(r.localCacheMap)),Array.isArray(r.mjImages)&&u.push(...r.mjImages),Array.isArray(r.output_images)&&u.push(...r.output_images),r.originalUrl&&u.push(r.originalUrl),r.mjOriginalUrl&&u.push(r.mjOriginalUrl),r.url&&u.push(r.url);for(const p of u)if(typeof p=="string"&&p&&!p.startsWith("blob:")){if(!l&&Sl(p))continue;return p}return""},Kn=(r,o="",l={})=>{const u=l.allowLocalCache??Kt;if(!r||typeof r!="string")return r;if(!u&&Sl(r))return o||"";if(as.isImageId(r))return r;if(r.startsWith("asset://")){const p=vc(r);return p&&p!==r?p:Ea(r)||r}return r.startsWith("blob:")?o||"":r},B2=r=>{const o=io(r,{allowLocalCache:Kt}),l={...r};if(l.url=Kn(l.url,o,{allowLocalCache:Kt}),l.originalUrl=Kn(l.originalUrl,o,{allowLocalCache:Kt}),l.mjOriginalUrl=Kn(l.mjOriginalUrl,o,{allowLocalCache:Kt}),Array.isArray(l.output_images)&&(l.output_images=l.output_images.map(u=>Kn(u,o,{allowLocalCache:Kt})).filter(Boolean)),Array.isArray(l.mjImages)){const u=l.mjImages.map(p=>Kn(p,o,{allowLocalCache:Kt})).filter(Boolean);u.length===0&&l.mjOriginalUrl?(l.mjImages=null,l.mjNeedsSplit=!0):l.mjImages=u}if(Array.isArray(l.mjImages)&&l.mjImages.length>1&&(!Array.isArray(l.output_images)||l.output_images.length<l.mjImages.length)&&(l.output_images=[...l.mjImages]),(!Array.isArray(l.output_images)||l.output_images.length<2)&&l.localCacheMap&&typeof l.localCacheMap=="object"){const u=Object.keys(l.localCacheMap).filter(Boolean);u.length>1&&(l.output_images=u.slice(0,12))}return Array.isArray(l.mjThumbnails)&&(l.mjThumbnails=l.mjThumbnails.map(u=>Kn(u,o,{allowLocalCache:Kt})).filter(Boolean)),l.thumbnailUrl&&(l.thumbnailUrl=Kn(l.thumbnailUrl,o,{allowLocalCache:Kt})),l},[Bt,Rt]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_history");return r?JSON.parse(r).map(l=>{var p,f;const u=B2(l);return u.mjNeedsSplit&&u.mjOriginalUrl&&((f=(p=u.apiConfig)==null?void 0:p.modelId)!=null&&f.includes("mj"))?{...u,url:u.mjOriginalUrl,mjImages:null,mjNeedsSplit:!0}:u}):[]}catch(r){return console.error(":",r),[]}}),[_l]=M.useState(()=>Date.now()),[qd,xs]=M.useState({active:!1,current:0,total:0,filename:""}),[Ws,Gd]=M.useState(new Set),[TE,ME]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_auto_save_config");return r?JSON.parse(r):{enabled:!1,interval:5,folderPath:""}}catch{return{enabled:!1,interval:5,folderPath:""}}}),[RE,OE]=M.useState(!1),[Jn,Pa]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_chat_sessions");return r?JSON.parse(r):[{id:"default",title:j(""),messages:[]}]}catch{return[{id:"default",title:j(""),messages:[]}]}}),[$a,wc]=M.useState("default"),[zc,B0]=M.useState(""),[Yd,So]=M.useState(!1),[H2,V2]=M.useState(400),[kc,Ui]=M.useState([]),[ni,W2]=M.useState(()=>{try{return localStorage.getItem("tapnow_chat_model")||"gemini-3-pro"}catch{return"gemini-3-pro"}}),[Yb,Xb]=M.useState(!1),[qp,Gp]=M.useState(null),[Yp,Zb]=M.useState(!1);M.useEffect(()=>{try{localStorage.setItem("tapnow_chat_model",ni)}catch{}},[ni]);const[Aa,gn]=M.useState(null),Xp=M.useRef(Aa);M.useEffect(()=>{Xp.current=Aa},[Aa]);const[Xd,Qb]=M.useState(()=>{try{const r=localStorage.getItem(Tw),o=r?JSON.parse(r):[],l=[{id:"grid-default",name:j(""),prompt:Mw},{id:"upscale-default",name:j(""),prompt:Rw},{id:"moodboard-default",name:j(""),prompt:Dw},{id:"storyboard-default",name:j(""),prompt:Ow},{id:"character-sheet-default",name:j(""),prompt:Lw}],u=new Set((o||[]).map(f=>f.id)),p=[...o];return l.forEach(f=>{const m=p.some(y=>y.name===f.name);!u.has(f.id)&&!m&&p.unshift(f)}),p}catch{return[{id:"grid-default",name:j(""),prompt:Mw},{id:"upscale-default",name:j(""),prompt:Rw},{id:"moodboard-default",name:j(""),prompt:Dw},{id:"storyboard-default",name:j(""),prompt:Ow},{id:"character-sheet-default",name:j(""),prompt:Lw}]}}),[Zp,H0]=M.useState({name:"",prompt:""}),[ey,K2]=M.useState(!1),[V0,J2]=M.useState(!1);M.useEffect(()=>{try{localStorage.setItem(Tw,JSON.stringify(Xd))}catch{}},[Xd]);const[jc,Zd]=M.useState(!1),[W0,Qd]=M.useState(!1),[si,eu]=M.useState(null),[Nc,Qp]=M.useState(null),[En,Sc]=M.useState(null),[Jr,ii]=M.useState(null),[oi,ai]=M.useState(null),[K0,xi]=M.useState({x:0,y:0}),[_c,Ta]=M.useState(null),[LE,ty]=M.useState(!1),[ry,J0]=M.useState({});M.useEffect(()=>{const r=setInterval(()=>{const o=Date.now(),l={};let u=!1;qs.current&&qs.current.forEach(p=>{var f;p.type==="storyboard-node"&&((f=p.settings)!=null&&f.shots)&&p.settings.shots.forEach(m=>{if(m.status==="generating"&&m.generationStartTime){const y=(o-m.generationStartTime)/1e3;l[`${p.id}-${m.id}`]=`${y.toFixed(1)}s`,u=!0}})}),u&&J0(l)},100);return()=>clearInterval(r)},[]);const[Ma,q0]=M.useState(!1),[oo,G0]=M.useState(null),[en,ss]=M.useState(new Set),Zo=M.useRef(!1),[bs,Cc]=M.useState({x:0,y:0,worldX:0,worldY:0,visible:!1}),[q2,Ra]=M.useState(!1),[Y0,X0]=M.useState({visible:!1,x:0,y:0}),[Ks,Fi]=M.useState({visible:!1,x:0,y:0,worldX:0,worldY:0,item:null}),[Z0,ao]=M.useState(!1),[G2,ny]=M.useState(!1),[Y2,sy]=M.useState(!1),Q0=M.useRef({target:null,at:0}),tu=M.useCallback(r=>{Q0.current={target:r,at:Date.now()}},[]),Cl=M.useRef(null),em=M.useCallback(()=>{Cl.current&&(clearTimeout(Cl.current),Cl.current=null),ao(!0)},[]),iy=M.useCallback(()=>{Cl.current&&clearTimeout(Cl.current),Cl.current=setTimeout(()=>{ao(!1),Cl.current=null},1e3)},[]),[Js,ru]=M.useState({nodeId:null,shotId:null}),[Oa,tm]=M.useState({visible:!1,x:0,y:0,nodeId:null,frame:null}),[La,oy]=M.useState({visible:!1,x:0,y:0,item:null}),[nu,ay]=M.useState({visible:!1,x:0,y:0,nodeId:null}),[X2,bi]=M.useState(!1),[ef,ly]=M.useState("providers"),[Z2,cy]=M.useState(()=>new Set),[Q2,tf]=M.useState(()=>new Set),[ej,dy]=M.useState(()=>new Set),[tj,Ec]=M.useState(()=>new Set),[rj,El]=M.useState(()=>({})),[nj,Ic]=M.useState(()=>new Set),[sj,Il]=M.useState(()=>({})),[ij,_o]=M.useState(()=>({})),[oj,rm]=M.useState(()=>({})),[aj,lj]=M.useState(()=>new Set),[uy,cj]=M.useState(()=>({})),[py,dj]=M.useState(()=>({})),[Pc,rf]=M.useState(!1),[fy,uj]=M.useState(!1),[hy,pj]=M.useState(!1),[nm,Pl]=M.useState(-1),[$c,Co]=M.useState(null),[my,Ac]=M.useState(!1),[qr,$l]=M.useState(()=>{try{const r=localStorage.getItem("tapnow_characters");return r?JSON.parse(r):[]}catch(r){return console.error(":",r),[]}}),[fj,su]=M.useState(!1),[Qo,nf]=M.useState("url"),[Tc,sf]=M.useState(""),[Mc,of]=M.useState(""),[Rc,gy]=M.useState(1),[Oc,xy]=M.useState(3),[iu,ou]=M.useState(""),[sm,Lc]=M.useState(!1),[by,au]=M.useState(null),[yy,af]=M.useState({}),[hj,lf]=M.useState(!1),[us,Al]=M.useState(new Set),[vy,im]=M.useState(!1),[mj,gj]=M.useState("select"),[Re,Er]=M.useState(null),[un,qn]=M.useState(null),[lu,om]=M.useState({}),[Dc,cf]=M.useState(null),[xj,am]=M.useState(null),[wy,lm]=M.useState(null),[cm,cu]=M.useState({}),[zy,bj]=M.useState({}),[Da,dm]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_image_model")||"nano-banana"}catch{return"nano-banana"}}),[Tl,um]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_video_model")||"sora-2"}catch{return"sora-2"}}),[ea,yj]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_ratio")||"1:1"}catch{return"1:1"}}),[Ml,vj]=M.useState(()=>{try{return Ju(localStorage.getItem("tapnow_last_image_res")||"2K")}catch{return"2K"}}),[Rl,ky]=M.useState(()=>{try{return ca(localStorage.getItem("tapnow_last_video_res")||"720P")}catch{return"720P"}}),[wj,zj]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_segment_duration")||"3"}catch{return"3"}}),[kj,jj]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_analyze_model")||"gemini-3-pro"}catch{return"gemini-3-pro"}}),[Ua,pm]=M.useState(()=>{try{return localStorage.getItem("tapnow_last_extract_model")||""}catch{return""}});M.useEffect(()=>{const r=(yr||"").replace(/\/+$/,"");if(!r){yc(!1);return}const o=async()=>{try{const u=await fetch(`${r}/ping`,{method:"GET"});if(u.ok){const p=await u.json(),f=p.image_save_path_raw??p.image_save_path??"",m=p.video_save_path_raw??p.video_save_path??"";yc(!0),qo(y=>({...y,savePath:Cs(p.save_path||y.savePath||""),imageSavePath:Cs(f||""),videoSavePath:Cs(m||""),convertPngToJpg:p.convert_png_to_jpg!==!1,jpgQuality:p.jpg_quality||y.jpgQuality,pilAvailable:p.pil_available||!1}));return}}catch{}yc(!1)};o();const l=setInterval(o,3e4);return()=>clearInterval(l)},[yr]),M.useEffect(()=>{if(Tn.current&&(clearTimeout(Tn.current),Tn.current=null),!Vs){yn(!1);return}if(Hs){yn(!0);return}return yn(!0),Tn.current=setTimeout(()=>{yn(!1),Tn.current=null},18e4),()=>{Tn.current&&(clearTimeout(Tn.current),Tn.current=null)}},[Vs,Hs]),M.useEffect(()=>{x(r=>r.map(o=>{var u,p;if(o.type!=="local-save"||(u=o.settings)!=null&&u.serverUrl)return o;const l=Hs?"connected":"disconnected";return((p=o.settings)==null?void 0:p.serverStatus)===l?o:{...o,settings:{...o.settings,serverStatus:l}}}))},[Hs]);const Ls=M.useCallback(r=>r?r.replace(/[<>:"/\\|?*\x00-\x1F]/g,"_").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").slice(0,120):"",[]),Cs=M.useCallback(r=>r?/^[a-zA-Z]:/.test(r)?r.replace(/\//g,"\\").replace(/\\+/g,"\\").trim():r.trim():"",[]),ta=M.useCallback(r=>{if(!r)return null;try{const l=r.split("?")[0].split("/"),p=l[l.length-1].replace(/\.[^.]+$/,"");return Ls(p||"")||null}catch{return null}},[Ls]),ra=M.useCallback((r,o="")=>{if(!r||!r.startsWith("data:"))return o;const l=r.match(/^data:([^;]+);/i);if(!l)return o;const u=l[1].toLowerCase();return{"image/jpeg":".jpg","image/jpg":".jpg","image/png":".png","image/webp":".webp","image/gif":".gif","video/mp4":".mp4","video/webm":".webm","video/quicktime":".mov"}[u]||o},[]),Fa=M.useCallback((r,o="image/png")=>{var u;if(!r||typeof r!="string")return o;const l=r.trim();if(!l)return o;if(l.startsWith("data:")){const p=l.match(/^data:([^;]+);/i);return((u=p==null?void 0:p[1])==null?void 0:u.toLowerCase())||o}return l.startsWith("/9j/")?"image/jpeg":l.startsWith("iVBORw0KGgo")?"image/png":l.startsWith("R0lGOD")?"image/gif":l.startsWith("UklGR")&&l.toUpperCase().includes("WEBP")?"image/webp":o},[]),lo=M.useCallback((r,o="")=>{if(!r)return o;const u=r.split("?")[0].split("#")[0].match(/\.([a-zA-Z0-9]+)$/);if(!u)return o;const p=`.${u[1].toLowerCase()}`;return p===".jpeg"?".jpg":p},[]),jy=M.useCallback(r=>{let o=0;for(let l=0;l<r.length;l++)o=(o<<5)-o+r.charCodeAt(l),o|=0;return Math.abs(o).toString(36)},[]),yi=M.useCallback((r,o)=>{const l=Ls(o||"");if(!r)return l||`cache_${Date.now()}`;const u=jy(r);if(l)return`${l}_${u}`;const p=ta(r);return p?`${p}_${u}`:`cache_${u}`},[ta,Ls,jy]),Nj=M.useCallback((r,o=!1)=>{if(!r||typeof r!="string"||r.startsWith("data:")||r.startsWith("blob:")||!/^https?:/i.test(r)||!o)return r;const l=(yr||"").trim().replace(/\/+$/,"");return!l||r.startsWith(l)?r:`${l}/proxy?url=${encodeURIComponent(r)}`},[yr]),Un=async(r,o={})=>{if(!r)throw new Error("Invalid URL");const l=o.preferLocal!==!1&&Kt,u=(o.proxyBaseUrl||yr||"").trim().replace(/\/+$/,"");let p=String(r);p=await Jd(p);const f=async v=>{const z=await fetch(v);if(!z.ok)throw new Error(`HTTP ${z.status}`);return await z.blob()};if(p.startsWith("data:")){const v=yo(p),z=Ql(v);if(!z)throw new Error("Invalid base64 payload");return z}if(p.startsWith("blob:"))try{return await f(p)}catch{throw new Error("Blob ")}let m=p;const y=l&&vn&&vn.has(p)?vn.get(p):null;if(y&&(!Sl(y)||gs(y)))try{if(y.startsWith("data:")){const z=yo(y),k=Ql(z);if(k)return k}else return y.startsWith("blob:")?await f(y):await f(y)}catch{}if(m=p,m.startsWith("data:")){const v=yo(m),z=Ql(v);if(!z)throw new Error("Invalid base64 payload");return z}if(m.startsWith("blob:"))try{return await f(m)}catch{throw new Error("Blob ")}const b=o.useProxy===!0;let w=m;if(b&&(u?w=m.startsWith(u)?m:`${u}/proxy?url=${encodeURIComponent(m)}`:w=Nj(m,!0)),!w)throw new Error("Invalid URL");return await f(w)},fm=M.useCallback(async r=>{if(!r)return r;const o=(r.type||"").toLowerCase();if(o.includes("png")||o.includes("jpeg")||o.includes("jpg")||typeof createImageBitmap>"u")return r;try{const l=await createImageBitmap(r),u=document.createElement("canvas");u.width=l.width||0,u.height=l.height||0;const p=u.getContext("2d");return p?(p.drawImage(l,0,0),await new Promise(m=>u.toBlob(m,"image/png"))||r):r}catch{return r}},[]),In=async(r,o={})=>{let l=r;if(l&&typeof l=="string"&&(l=await Jd(l)),l&&l.startsWith("data:")){const p=yo(l),f=Ql(p);if(!f)throw new Error("Invalid base64 payload");return(await Eo(f)).split(",")[1]||""}const u=await Un(l,o);return new Promise((p,f)=>{const m=new FileReader;m.onloadend=()=>{const y=m.result;p(y.split(",")[1])},m.onerror=f,m.readAsDataURL(u)})},Eo=r=>new Promise((o,l)=>{const u=new FileReader;u.onloadend=()=>o(u.result),u.onerror=l,u.readAsDataURL(r)}),Ny=M.useCallback(async r=>{if(!r||typeof r!="string")return r;if(r.startsWith("asset://")){const l=vc(r);return l&&l!==r?l:Ea(r)||r}if(!r.startsWith("blob:"))return r;if(_a.current.has(r))return _a.current.get(r);const o=Ea(r);if(o)return _a.current.set(r,o),o;try{const l=await Un(r);if(l&&l.type&&l.type.startsWith("image/")){try{const p=await as.saveImage(l);if(p)return _a.current.set(r,p),p}catch{}const u=await Eo(l);return _a.current.set(r,u),u}if(l&&l.type&&l.type.startsWith("video/")&&l.size<=8*1024*1024){const u=await Eo(l);return _a.current.set(r,u),u}}catch{}return _a.current.set(r,r),r},[Un,Ea,vc]),du=M.useCallback(async r=>{if(r==null)return r;if(typeof r=="string")return await Ny(r);if(Array.isArray(r)){const o=[];for(let l=0;l<r.length;l++)o[l]=await du(r[l]);return o}if(typeof r=="object"){const o={},l=Object.entries(r);for(let u=0;u<l.length;u++){const[p,f]=l[u];o[p]=await du(f)}return o}return r},[Ny]),Sy=M.useCallback(async(r={})=>{const o=Array.isArray(r.nodes)?r.nodes:qs.current||[],l=Array.isArray(r.connections)?r.connections:Bc.current||[],u=Date.now(),f={nodes:await du(o),connections:l,timestamp:u},m=JSON.stringify(f);try{await qw(m),h.current=!0,Gu({timestamp:u,storage:"idb"});try{localStorage.removeItem(ql)}catch{}console.log("[AutoSave]  IndexedDB",new Date().toLocaleTimeString())}catch{try{if(m.length>4*1024*1024)throw new Error("payload too large");localStorage.setItem(ql,m),h.current=!1,Gu({timestamp:u,storage:"local"}),console.log("[AutoSave] ",new Date().toLocaleTimeString())}catch(b){console.warn("[AutoSave] :",b.message||b)}}},[du]),Uc=M.useCallback(async(r,o="normal",l={})=>{const u=o==="ultra"?{maxSize:80,jpegQuality:.3}:{maxSize:150,jpegQuality:.6};let p=r;if(!p)return null;try{as.isImageId(p)&&(p=await as.getImage(p))}catch{return null}if(!p)return null;try{const f=await Un(p,{useProxy:l.useProxy,preferLocal:l.preferLocal});if(!f)return null;const m=URL.createObjectURL(f);return await new Promise(y=>{const b=new Image;b.onload=()=>{const w=document.createElement("canvas");let v=b.naturalWidth,z=b.naturalHeight;v>z?v>u.maxSize&&(z=z*u.maxSize/v,v=u.maxSize):z>u.maxSize&&(v=v*u.maxSize/z,z=u.maxSize),w.width=v,w.height=z,w.getContext("2d").drawImage(b,0,0,v,z);const T=w.toDataURL("image/jpeg",u.jpegQuality);URL.revokeObjectURL(m),y(T)},b.onerror=()=>{URL.revokeObjectURL(m),y(null)},b.src=m})}catch{return null}},[Un]),Sj=5*60*1e3,df=M.useCallback(r=>{if(!r)return"";try{return new URL(r).origin||r}catch{return r}},[]),uf=M.useCallback(r=>{if(!r)return!1;const o=df(r),l=M0.current.get(o);return l&&Date.now()-l<Sj},[df]),pf=M.useCallback(r=>{if(!r)return;const o=df(r);M0.current.set(o,Date.now())},[df]);M.useCallback((r,o=6e4)=>{if(!r)return!1;const l=Date.now(),u=Gb.current.get(r)||0;return l-u<o?!1:(Gb.current.set(r,l),!0)},[]);const Bi=M.useCallback(async(r,o={})=>{const l=o.useProxy===!0,u=o.proxyBaseUrl,p=o.preferLocal===!0;if(!r)throw new Error(": ");try{const f=await Un(r,{useProxy:l,preferLocal:p,proxyBaseUrl:u});if(!f||f.size===0)throw new Error(": ");return{blob:f,source:r}}catch(f){throw f||new Error("")}},[Un]),ff=M.useCallback(async(r,o,l="history",u={})=>{if(!Kt)return null;const p=(yr||"").replace(/\/+$/,"");if(!p)return null;const f=u.useProxy===!0;try{const y=(u!=null&&u.forceId?Ls(r||""):"")||yi(o,r);let b=o;if(o.startsWith("data:"))b=yo(o);else{if(!f&&uf(o))return null;const{blob:z}=await Bi(o,{useProxy:f});b=await new Promise(k=>{const T=new FileReader;T.onloadend=()=>k(T.result),T.readAsDataURL(z)})}const w=ra(b,lo(o,".jpg")),v=await fetch(`${p}/save-cache`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:y,content:b,category:l,ext:w,type:"image"})});if(v.ok){const z=await v.json();if(z.success){const k=Ca(z.url);return k&&(jl.current.add(k),Di.current=!0,Vd(T=>T+1)),{url:z.url,path:z.path}}}}catch(m){o&&!o.startsWith("data:")&&!f&&pf(o),console.warn("[] :",m)}return null},[Kt,yr,yi,ra,lo,Ls,uf,Bi,pf,Ca]),_y=M.useCallback(async(r,o,l="history",u={})=>{if(!Kt)return null;const p=(yr||"").replace(/\/+$/,"");if(!p)return null;const f=u.useProxy===!0;try{const m=yi(o,r);if(!f&&uf(o))return null;const{blob:y}=await Bi(o,{useProxy:f}),b=await new Promise(z=>{const k=new FileReader;k.onloadend=()=>z(k.result),k.readAsDataURL(y)}),w=ra(b,lo(o,".mp4")),v=await fetch(`${p}/save-cache`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:m,content:b,category:l,ext:w,type:"video"})});if(v.ok){const z=await v.json();if(z.success){const k=Ca(z.url);return k&&(jl.current.add(k),Di.current=!0,Vd(T=>T+1)),{url:z.url,path:z.path}}}}catch(m){f||pf(o),console.warn("[] :",m)}return null},[Kt,yr,yi,ra,lo,uf,Bi,pf,Ca]),Fc=M.useCallback(async(r,o={})=>{const l=o.silent===!0,u=(yr||"").replace(/\/+$/,"");if(!u)return l||d("","error"),!1;const p={...r};p.save_path&&(p.save_path=Cs(p.save_path)),p.image_save_path&&(p.image_save_path=Cs(p.image_save_path)),p.video_save_path&&(p.video_save_path=Cs(p.video_save_path));try{const f=await fetch(`${u}/config`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!f.ok){const v=await f.text();throw new Error(v||"")}const m=await f.json(),y=(m==null?void 0:m.config)||{},b=y.image_save_path_raw,w=y.video_save_path_raw;return qo(v=>({...v,savePath:Cs(y.save_path??p.save_path??v.savePath??""),imageSavePath:Cs(b!==void 0?b:y.image_save_path??p.image_save_path??v.imageSavePath??""),videoSavePath:Cs(w!==void 0?w:y.video_save_path??p.video_save_path??v.videoSavePath??""),convertPngToJpg:(y.convert_png_to_jpg??p.convert_png_to_jpg)!==void 0?(y.convert_png_to_jpg??p.convert_png_to_jpg)!==!1:v.convertPngToJpg,jpgQuality:y.jpg_quality??p.jpg_quality??v.jpgQuality,pilAvailable:y.pil_available??v.pilAvailable})),l||d((m==null?void 0:m.message)||"","success",2e3),!0}catch(f){return l||d(`: ${f.message||""}`,"error",2e3),!1}},[yr,d,Cs]),Ba=M.useCallback((r={})=>{const o=!!r.silent,l=r.reset!==!1;Go.current=new Set,kn.current=new Map,Wp.current=new Map,so.current=new Map,M0.current=new Map,jl.current=new Set,Di.current=!1,Vd(u=>u+1),l&&(Rt(u=>u.map(p=>({...p,localCacheUrl:null,localFilePath:null,localCacheMap:null}))),$l(u=>u.map(p=>({...p,localCacheUrl:null,localFilePath:null})))),bn(u=>u+1),o||d("","success"),Ia({silent:!0})},[d,Ia]);M.useEffect(()=>{Kt&&Ba({silent:!0,reset:Os})},[Kt,Ba,Os]);const ps=M.useCallback(r=>{var u,p,f,m,y;if(typeof(r==null?void 0:r.useProxy)=="boolean")return r.useProxy;if(typeof((u=r==null?void 0:r.apiConfig)==null?void 0:u.useProxy)=="boolean")return r.apiConfig.useProxy;let o=String((r==null?void 0:r.provider)||((p=r==null?void 0:r.apiConfig)==null?void 0:p.provider)||"").trim();if(!o){const b=String((r==null?void 0:r.model)||(r==null?void 0:r.modelName)||((f=r==null?void 0:r.apiConfig)==null?void 0:f.modelId)||"").trim();if(b){const w=Ye.find(v=>(v==null?void 0:v.id)===b||(v==null?void 0:v.modelName)===b||(v==null?void 0:v.displayName)===b);o=String((w==null?void 0:w.provider)||"").trim()}}if(!o)return!1;if((m=Ft[o])!=null&&m.useProxy)return!0;const l=o.toLowerCase();return!!(l&&((y=Ft[l])!=null&&y.useProxy))},[Ft,Ye]),vn=M.useMemo(()=>{const r=new Map;return Bt.forEach(o=>{o&&(o.localCacheMap&&Object.entries(o.localCacheMap).forEach(([l,u])=>{l&&u&&r.set(l,u)}),o.localCacheUrl&&([o.url,o.originalUrl,o.mjOriginalUrl].filter(Boolean).forEach(u=>r.set(u,o.localCacheUrl)),(!o.localCacheMap||Object.keys(o.localCacheMap).length===0)&&(Array.isArray(o.mjImages)&&o.mjImages.length===1&&r.set(o.mjImages[0],o.localCacheUrl),Array.isArray(o.output_images)&&o.output_images.length===1&&r.set(o.output_images[0],o.localCacheUrl))))}),r},[Bt]),hm=M.useMemo(()=>{const r=new Map;return Bt.forEach(o=>{if(!o)return;const l=ps(o);[o.url,o.originalUrl,o.mjOriginalUrl,...Array.isArray(o.mjImages)?o.mjImages:[],...Array.isArray(o.output_images)?o.output_images:[]].filter(Boolean).forEach(p=>{typeof p=="string"&&/^https?:/i.test(p)&&r.set(p,l)})}),r},[Bt,ps]),Gn=M.useCallback((r,o=!1)=>{if(!r)return!!o;const l=String(r);if(l.startsWith("data:")||l.startsWith("blob:"))return!1;const u=(yr||"").trim();if(u&&l.startsWith(u))return!1;if(Kt&&vn.has(l)){const p=vn.get(l);if(p&&gs(p))return!1}return hm.has(l)?!!hm.get(l):!!o},[hm,vn,yr,Kt,gs]);M.useEffect(()=>{const r={savePath:Br.savePath||"",imageSavePath:Br.imageSavePath||"",videoSavePath:Br.videoSavePath||""},o=qb.current,l=o.savePath!==r.savePath||o.imageSavePath!==r.imageSavePath||o.videoSavePath!==r.videoSavePath;qb.current=r,!(!Vs||!l)&&(!o.savePath&&!o.imageSavePath&&!o.videoSavePath||Ba({silent:!0,reset:Os}))},[Br.savePath,Br.imageSavePath,Br.videoSavePath,Vs,Ba,Os]);const Cy=M.useCallback((r,o)=>{if(r){if(o){for(const[u,p]of so.current.entries())p===o&&so.current.delete(u);const l=Ca(o);l&&(jl.current.delete(l),Vd(u=>u+1))}Rt(l=>l.map(u=>{if(u.id!==r)return u;if(!o)return{...u,localCacheUrl:null,localFilePath:null,localCacheMap:null};let p=u.localCacheMap?{...u.localCacheMap}:null;p&&Object.entries(p).forEach(([y,b])=>{(b===o||y===o)&&delete p[y]});const f=p?Object.keys(p):[],m=u.localCacheUrl===o?f.length>0?p[f[0]]:null:u.localCacheUrl;return{...u,localCacheUrl:m||null,localFilePath:m?u.localFilePath:null,localCacheMap:f.length>0?p:null}}))}},[]),Hi=r=>{if(!r||typeof r!="string")return r;if(r.startsWith("asset://")){const o=vc(r);return o&&o!==r?o:Ea(r)||r}return r.startsWith("data:")?yo(r):r},Ar=M.useCallback((r,o=null)=>{if(!r)return"";if(o){if(Kt&&vn&&vn.has(o)){const f=vn.get(o);if(f&&gs(f))return f}if(Kt&&r.localCacheMap&&r.localCacheMap[o]){const f=r.localCacheMap[o];if(f&&gs(f))return f}const p=Kn(o,"",{allowLocalCache:Kt});if(!p||p.startsWith("blob:")){const f=io(r,{allowLocalCache:Kt});return Hi(f||"")}if(!Kt&&Sl(p)){const f=io(r,{allowLocalCache:!1});return Hi(f||"")}return Hi(p)}const l=Kt?r.localCacheUrl||(r.localCacheMap?Object.values(r.localCacheMap)[0]:null):null;if(l&&gs(l))return Hi(l);const u=io(r,{allowLocalCache:Kt});return Hi(u||"")},[Kt,vn,gs,Kp,Kn,io,Sl]);M.useCallback((r,o=null)=>{if(!r)return"";if(o){if(Kt&&vn&&vn.has(o)){const f=vn.get(o);if(f&&gs(f))return f}if(Kt&&r.localCacheMap&&r.localCacheMap[o]){const f=r.localCacheMap[o];if(f&&gs(f))return f}if(xn!=="off"&&r.mjImages&&r.mjThumbnails){const f=r.mjImages.indexOf(o);if(f>=0&&r.mjThumbnails[f])return r.mjThumbnails[f]}const p=Kn(o,"",{allowLocalCache:Kt});if(!p||p.startsWith("blob:")){const f=io(r,{allowLocalCache:Kt})||Kn(r.thumbnailUrl,"",{allowLocalCache:Kt});return Hi(f||"")}if(!Kt&&Sl(p)){const f=io(r,{allowLocalCache:!1})||Kn(r.thumbnailUrl,"",{allowLocalCache:!1});return Hi(f||"")}return Hi(p)}const l=Kt?r.localCacheUrl||(r.localCacheMap?Object.values(r.localCacheMap)[0]:null):null;if(xn==="off"){if(l&&gs(l))return Hi(l);const p=io(r,{allowLocalCache:Kt});return Hi(p||"")}if(l&&gs(l))return Hi(l);const u=Kn(r.thumbnailUrl,"",{allowLocalCache:Kt})||io(r,{allowLocalCache:Kt});return Hi(u||"")},[Kt,xn,vn,gs,Kp,Kn,io,Sl]);const mm=M.useCallback(r=>r?Array.isArray(r.mjImages)&&r.mjImages.length>1?r.mjImages:Array.isArray(r.output_images)&&r.output_images.length>1?r.output_images:null:null,[]),hf=M.useCallback(async(r,o={})=>{if(!r)return;const l=r.mjImages&&r.mjImages.length>0?r.mjImages:[r.url||r.originalUrl||r.mjOriginalUrl].filter(Boolean);if(l.length===0){d("","warning");return}const u=ps(r),p=xn==="ultra"?"ultra":"normal";if(l.forEach(f=>{f&&kn.current.delete(f);const m=Ar(r,f);m&&kn.current.delete(m)}),l.length>1){const f=await Promise.all(l.map(async m=>{const y=Ar(r,m);if(!y)return null;const b=Gn(y,u);return await Uc(y,p,{useProxy:b})}));Rt(m=>m.map(y=>y.id===r.id?{...y,mjThumbnails:f}:y))}else{const f=Ar(r,l[0]),m=f?Gn(f,u):!1,y=f?await Uc(f,p,{useProxy:m}):null;Rt(b=>b.map(w=>w.id===r.id?{...w,thumbnailUrl:y||null}:w))}o.silent||d("","success")},[Uc,xn,Ar,d,ps,Gn]),_j=M.useCallback(async()=>{const r=Bt.filter(o=>o.type==="image"&&(o.mjImages&&o.mjImages.length>0||o.url||o.originalUrl||o.mjOriginalUrl));if(r.length===0){d("","warning");return}d(` ${r.length} `,"success");for(const o of r)await hf(o,{silent:!0});d("","success")},[Bt,hf,d]),Ey=M.useCallback(async(r,o)=>{const l=(yr||"").replace(/\/+$/,"");if(l)try{const p=await fetch(`${l}/pick-path`);if(p.ok){const f=await p.json();if(f!=null&&f.path){const m=Cs(f.path);if(await Fc({[o]:m},{silent:!0})){d("","success",2e3),Ba({silent:!0});return}d("","error",2e3);return}}}catch{}const u=document.createElement("input");u.type="file",u.setAttribute("webkitdirectory",""),u.setAttribute("directory",""),u.multiple=!0,u.onchange=async()=>{const p=u.files&&u.files[0];if(!p)return;const f=p.path||"";if(!f){d("","warning",3e3);return}const m=f.replace(/[\\/][^\\/]+$/,""),y=Cs(m);await Fc({[o]:y},{silent:!0})?(d("","success",2e3),Ba({silent:!0})):d("","error",2e3)},u.click()},[yr,Cs,Fc,d,Ba]);M.useEffect(()=>{if(xn==="off")return;const o=setTimeout(async()=>{const l=xn==="ultra"?"ultra":"normal",p=Bt.filter(f=>f.status==="completed"&&f.type==="image"&&(f.url||f.originalUrl||f.mjOriginalUrl)&&!f.thumbnailUrl).slice(0,5);if(p.length!==0)for(const f of p)try{const m=f.url||f.originalUrl||f.mjOriginalUrl;if(!m)continue;let y=kn.current.get(m);if(!y){const w=Gn(m,!1);y=await Uc(m,l,{useProxy:w}),y&&kn.current.set(m,y)}let b=null;f.mjImages&&f.mjImages.length>0&&(b=await Promise.all(f.mjImages.map(async w=>{if(!w)return null;const v=kn.current.get(w);if(v)return v;const z=Gn(w,!1),k=await Uc(w,l,{useProxy:z});return k&&kn.current.set(w,k),k}))),(y||b)&&Rt(w=>w.map(v=>v.id===f.id?{...v,thumbnailUrl:y||v.thumbnailUrl,mjThumbnails:b||v.mjThumbnails}:v))}catch(m){console.warn("[] :",m)}},100);return()=>clearTimeout(o)},[xn,Bt,Uc]),M.useEffect(()=>{if(!Kt)return;const o=setTimeout(async()=>{for(const l of qr)if(!l.localCacheUrl&&!(!l.profile_picture_url||l.profile_picture_url.startsWith("blob:")))try{const u=await ff(l.id,l.profile_picture_url,"characters");u&&$l(p=>p.map(f=>f.id===l.id?{...f,localCacheUrl:u.url,localFilePath:u.path}:f))}catch(u){console.warn("[] :",l.username,u)}},2e3);return()=>clearTimeout(o)},[qr,Kt,ff]),M.useEffect(()=>{if(!Kt)return;const r=async()=>{if(R0.current)return;R0.current=!0;const l={total:Bt.length,processed:0,skippedStatus:0,skippedVideo:0,skippedEmpty:0,saved:0,failed:0,proxy:0,direct:0};try{const u=!!(Br.imageSavePath||Br.videoSavePath),p=u?"/file/history/":"/file/.tapnow_cache/history/",f=(yr||"").trim().replace(/\/+$/,"");Di.current||await Ia({silent:!0});for(const m of Bt){const y=m==null?void 0:m.status;if(!(!y||["completed","complete","success","done"].includes(y))){l.skippedStatus++;continue}const w=(m==null?void 0:m.url)||(m==null?void 0:m.originalUrl)||(m==null?void 0:m.mjOriginalUrl)||"";if((m==null?void 0:m.type)==="video"||ur(w)){l.skippedVideo++;continue}const z=ps(m);let k=m.localCacheUrl||null,T=m.localFilePath||null,I=m.localCacheMap?{...m.localCacheMap}:{},F=!1;const B=k||(Object.keys(I).length>0?Object.values(I)[0]:null);B&&Di.current&&!gs(B)&&(I&&Object.keys(I).length>0&&Object.entries(I).forEach(([Y,ne])=>{so.current.get(Y)===ne&&so.current.delete(Y)}),k=null,T=null,I={},F=!0,Go.current.delete(m.id));const U=m.mjImages&&m.mjImages.length>0?m.mjImages:m.output_images&&m.output_images.length>0?m.output_images:[m.url||m.originalUrl||m.mjOriginalUrl].filter(Boolean),W=[...new Set(U.filter(Boolean))];if(W.length===0){l.skippedEmpty++;continue}const X=W.reduce((Y,ne)=>I[ne]?Y+1:Y,0);if(Go.current.has(m.id)&&X>=W.length)continue;if(Go.current.add(m.id),l.processed++,!Os&&k){let Y=!1;if(W.forEach(ne=>{ne&&(I[ne]||(I[ne]=k,Y=!0))}),Y||k!==m.localCacheUrl){const ne=Object.keys(I).length>0?I:null;Rt(ie=>ie.map(Z=>Z.id===m.id?{...Z,localCacheUrl:k||null,localFilePath:T||null,localCacheMap:ne}:Z))}continue}for(let Y=0;Y<W.length;Y++){const ne=W[Y];if(!ne||ne.startsWith("blob:")||ne.includes("..."))continue;const ie=W.length>1?`${m.id}-${Y}`:`${m.id}`,Z=yi(ne,ie),te=Ls(Z)||Z;if(I[ne]&&te&&!String(I[ne]).includes(te)&&(delete I[ne],F=!0),!Os){const pe=vn&&vn.get(ne);if(pe){I[ne]||(I[ne]=pe,F=!0),k||(k=pe);continue}if(f&&te){const Te=Jp(te,[".jpg",".png",".webp"],u);if(Te){I[ne]||(I[ne]=Te,F=!0),k||(k=Te);continue}}if(so.current.has(ne)){const Te=so.current.get(ne);if(Te&&te&&!String(Te).includes(te))so.current.delete(ne);else{Te&&!I[ne]&&(I[ne]=Te,F=!0),!k&&Te&&(k=Te);continue}}}try{const pe=Gn(ne,z);pe?l.proxy++:l.direct++;const Te=await ff(Z,ne,"history",{forceId:!0,useProxy:pe});Te?(so.current.set(ne,Te.url),I[ne]=Te.url,F=!0,k||(k=Te.url,T=Te.path),l.saved++):l.failed++}catch(pe){console.warn("[] :",m.id,pe),l.failed++}}const J=W[0];if(J){const Y=I[J]||null;Y?k=Y:(k=null,T=null)}if(F||k!==m.localCacheUrl){const Y=Object.keys(I).length>0?I:null;Rt(ne=>ne.map(ie=>ie.id===m.id?{...ie,localCacheUrl:k||null,localFilePath:T||null,localCacheMap:Y}:ie))}}}finally{R0.current=!1}};r();const o=setTimeout(r,3e3);return()=>clearTimeout(o)},[Bt,Kt,Br.imageSavePath,Br.videoSavePath,yr,ff,Ls,yi,ps,Gn,Yt,vn,Os,Ia,Jp,gs]),M.useEffect(()=>{if(!Kt)return;const r=async()=>{if(O0.current)return;O0.current=!0;const l={total:Bt.length,processed:0,skippedStatus:0,skippedNonVideo:0,skippedEmpty:0,saved:0,failed:0,proxy:0,direct:0};try{const u=(yr||"").trim().replace(/\/+$/,""),p=Br.videoSavePath||Br.savePath||"",f=!!(p&&!String(p).includes(".tapnow_cache")),m=f?"/file/history/":"/file/.tapnow_cache/history/";Di.current||await Ia({silent:!0});for(const y of Bt){const b=y==null?void 0:y.status;if(!(!b||["completed","complete","success","done"].includes(b))){l.skippedStatus++;continue}const v=(y==null?void 0:y.url)||(y==null?void 0:y.originalUrl)||"";if(!((y==null?void 0:y.type)==="video"||ur(v))){l.skippedNonVideo++;continue}const k=ps(y);let T=y.localCacheUrl||null;if(!(T&&!Os&&(Di.current&&!gs(T)&&(T=null,Rt(I=>I.map(F=>F.id===y.id?{...F,localCacheUrl:null,localFilePath:null}:F))),T))&&!Go.current.has(y.id)&&(Go.current.add(y.id),!(v&&(v.includes("localhost:")||v.includes("127.0.0.1:"))))){if(!v||v.startsWith("blob:")||v.includes("...")){l.skippedEmpty++;continue}if(l.processed++,!Os){const I=vn&&vn.get(v);if(I){Rt(F=>F.map(B=>B.id===y.id?{...B,localCacheUrl:I}:B));continue}if(u){const F=yi(v,y.id),B=Ls(F)||F;if(B){const U=Jp(B,[".mp4",".webm",".mov"],f);if(U){Rt(W=>W.map(X=>X.id===y.id?{...X,localCacheUrl:U}:X));continue}}}}try{const I=Gn(v,k);I?l.proxy++:l.direct++;const F=await _y(y.id,v,"history",{useProxy:I});F?(Rt(B=>B.map(U=>U.id===y.id?{...U,localCacheUrl:F.url,localFilePath:F.path}:U)),l.saved++):l.failed++}catch(I){console.warn("[] :",y.id,I),l.failed++}}}}finally{O0.current=!1}};r();const o=setTimeout(r,5e3);return()=>clearTimeout(o)},[Bt,Kt,Br.videoSavePath,Br.savePath,yr,_y,ps,Gn,Yt,vn,Os,Ls,yi,Ia,Jp,gs]);const Io=M.useRef(null),uu=M.useRef({x:0,y:0}),Iy=M.useRef(null),Cj=M.useRef(null),qs=M.useRef(g),Po=M.useRef(q),vi=M.useRef(en),Bc=M.useRef(N),mf=M.useRef({}),na=M.useRef(null),Hc=M.useRef(!1),sa=M.useRef(null),$o=M.useRef(null),Ha=M.useRef(null),pu=M.useRef(null);M.useEffect(()=>{localStorage.setItem("tapnow_api_configs",JSON.stringify(Ye))},[Ye]);const gm=M.useCallback(r=>{Ge(),x(o=>o.filter(l=>l.id!==r)),C(o=>o.filter(l=>l.from!==r&&l.to!==r)),q===r&&le(null)},[q,Ge]),Je=M.useCallback((r,o)=>{x(l=>l.map(u=>u.id===r?{...u,settings:{...u.settings,...o}}:u))},[]),Vc=(r,o)=>{if(!o)return;const l=new FileReader;l.onload=async u=>{const p=u.target.result;let f={duration:0,w:0,h:0};try{f=await id(p)}catch(m){console.warn("",m)}x(m=>m.map(y=>y.id===r?{...y,content:p,videoMeta:f,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:o.name}:y))},l.readAsDataURL(o)};M.useEffect(()=>{const r=o=>{if(!(o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable)&&(o.key==="Delete"||o.key==="Del")){o.preventDefault(),o.stopPropagation();const l=Po.current,u=vi.current;if(l)gm(l),le(null);else if(u&&u.size>0){gt.current&&gt.current();const p=new Set(u);x(f=>f.filter(m=>!p.has(m.id))),C(f=>f.filter(m=>!p.has(m.from)&&!p.has(m.to))),ss(new Set)}}};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}},[]);const Py=M.useMemo(()=>vh(r=>{try{localStorage.setItem("tapnow_characters",JSON.stringify(r))}catch(o){console.error(":",o)}},500),[]);M.useEffect(()=>{Py(qr)},[qr,Py]);const xm=M.useMemo(()=>{const r=Bt.filter(l=>(l.startTime||0)>=_l),o=Bt.filter(l=>(l.startTime||0)<_l);return[...r,...o]},[Bt,_l]),gf=M.useCallback(r=>{if(!r)return!1;const o=r==null?void 0:r.status;return!(o&&!["completed","complete","success","done"].includes(o))},[]),Ao=M.useMemo(()=>xm.filter(gf),[xm,gf]),xf=M.useCallback(r=>r?Ao.findIndex(o=>(o==null?void 0:o.id)===r):-1,[Ao]),Ej=M.useCallback((r,o,l)=>{if(!Array.isArray(r)||r.length===0)return-1;const u=l<0?-1:1;let p=o;for(;;){if(p+=u,p<0||p>=r.length)return-1;const f=r[p];if(gf(f))return p}},[gf]);M.useEffect(()=>{au(null)},[Tc,Mc,Qo]),M.useEffect(()=>{if(!Pc){Pl(-1),Co(null);return}const r=o=>{if(o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||Aa||Ao.length===0)return;let l=$c?xf($c):-1;if(l<0&&(l=0),!(l<0))if(o.key==="ArrowUp"||o.key==="Up"){o.preventDefault(),o.stopPropagation();const u=Math.max(0,l-1);if(u===l)return;const p=Ao[u],f=Ar(p);f&&gn({...p,url:f,storyboardContext:null}),Co((p==null?void 0:p.id)||null),Pl(u)}else if(o.key==="ArrowDown"||o.key==="Down"){o.preventDefault(),o.stopPropagation();const u=Math.min(Ao.length-1,l+1);if(u===l)return;const p=Ao[u],f=Ar(p);f&&gn({...p,url:f,storyboardContext:null}),Co((p==null?void 0:p.id)||null),Pl(u)}else(o.key==="Escape"||o.key==="Esc")&&(o.preventDefault(),o.stopPropagation(),rf(!1))};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[Pc,Ao,Aa,Ar,$c,nm,xf]),M.useEffect(()=>{var o;if(!Pc)return;if(Ao.length===0){Pl(-1),Co(null);return}const r=$c?xf($c):-1;if(r>=0){r!==nm&&Pl(r);return}Pl(0),Co(((o=Ao[0])==null?void 0:o.id)||null)},[Pc,Ao,$c,nm,xf]);const $y=80,li=r=>r&&(r.startsWith("data:")&&r.length>5e3?`${r.substring(0,100)}...`:r),Ij=(r,o=8)=>{if(!r||typeof r!="object")return null;const l=Object.entries(r).filter(([p,f])=>p&&f);if(l.length===0)return null;const u={};return l.slice(0,o).forEach(([p,f])=>{u[p]=f}),u},bm=r=>{const o={...r},l=io(o,{allowLocalCache:!1});if(o.url&&(o.url=li(Kn(o.url,l,{allowLocalCache:!1}))),o.originalUrl&&(o.originalUrl=li(Kn(o.originalUrl,l,{allowLocalCache:!1}))),o.mjOriginalUrl&&(o.mjOriginalUrl=li(Kn(o.mjOriginalUrl,l,{allowLocalCache:!1}))),Array.isArray(o.output_images)&&(o.output_images=o.output_images.slice(0,12).map(u=>li(Kn(u,l,{allowLocalCache:!1}))).filter(Boolean)),Array.isArray(o.mjImages)){const u=o.mjImages.map(p=>Kn(p,l,{allowLocalCache:!1})).filter(Boolean);u.length===0&&o.mjOriginalUrl?(o.mjImages=null,o.mjNeedsSplit=!0):o.mjImages=u.slice(0,12).map(li)}return Array.isArray(o.mjImages)&&o.mjImages.length>1&&(!Array.isArray(o.output_images)||o.output_images.length<o.mjImages.length)&&(o.output_images=o.mjImages.slice(0,12)),Array.isArray(o.mjThumbnails)&&(o.mjThumbnails=o.mjThumbnails.map(u=>Kn(u,l,{allowLocalCache:!1})).filter(Boolean).map(li)),o.thumbnailUrl&&(o.thumbnailUrl=li(Kn(o.thumbnailUrl,l,{allowLocalCache:!1}))),delete o.mjImageInfo,o.localCacheMap=Ij(o.localCacheMap),o.localCacheUrl=o.localCacheUrl||null,o.localFilePath=o.localFilePath||null,delete o.apiConfig,o},fu=M.useMemo(()=>vh(r=>{try{localStorage.setItem("tapnow_history",JSON.stringify(r))}catch(o){console.error(":",o);try{const l=r.map(u=>{var p;return{id:u.id,type:u.type,url:li(u.url),prompt:((p=u.prompt)==null?void 0:p.substring(0,200))||"",time:u.time,status:u.status,modelName:u.modelName,width:u.width,height:u.height,ratio:u.ratio,mjImages:Array.isArray(u.mjImages)?u.mjImages.slice(0,8).map(li):u.mjImages,selectedMjImageIndex:u.selectedMjImageIndex,mjRatio:u.mjRatio,mjNeedsSplit:u.mjNeedsSplit}});localStorage.setItem("tapnow_history",JSON.stringify(l))}catch(l){console.error(":",l);try{const u=r.map(p=>{var f;return{id:p.id,type:p.type,url:li(p.url),prompt:((f=p.prompt)==null?void 0:f.substring(0,100))||"",time:p.time,status:p.status,modelName:p.modelName}});fu(u)}catch(u){console.error(":",u)}}}},1e3),[]),Ay=(r=[])=>{try{const o=r.slice(0,$y).map(l=>bm(l));return localStorage.setItem("tapnow_history",JSON.stringify(o)),!0}catch(o){console.error(":",o);try{const l=r.map(u=>{var p;return{id:u.id,type:u.type,url:li(u.url),prompt:((p=u.prompt)==null?void 0:p.substring(0,200))||"",time:u.time,status:u.status,modelName:u.modelName,width:u.width,height:u.height,ratio:u.ratio,output_images:Array.isArray(u.output_images)?u.output_images.slice(0,8).map(li):u.output_images,mjImages:Array.isArray(u.mjImages)?u.mjImages.slice(0,8).map(li):u.mjImages,selectedMjImageIndex:u.selectedMjImageIndex,mjRatio:u.mjRatio,mjNeedsSplit:u.mjNeedsSplit}});return localStorage.setItem("tapnow_history",JSON.stringify(l)),!0}catch(l){return console.error(":",l),!1}}},Ty=M.useMemo(()=>vh(r=>{localStorage.setItem("tapnow_global_key",r)},1e3),[]);M.useEffect(()=>{Ty(Ns)},[Ns,Ty]),M.useEffect(()=>{try{const r=Bt.slice(0,$y).map(o=>{var p,f,m,y;const l=bm(o),u=((f=(p=o.apiConfig)==null?void 0:p.modelId)==null?void 0:f.includes("mj"))||((y=(m=o.modelName)==null?void 0:m.toLowerCase())==null?void 0:y.includes("midjourney"));return o.mjImages&&o.mjImages.length===4&&u&&(l.mjImages=null,l.mjNeedsSplit=!0,l.mjOriginalUrl=li(o.mjOriginalUrl||o.url)),l});fu(r)}catch(r){console.error(":",r);try{const o=Bt.slice(0,20).map(l=>bm(l));fu(o)}catch(o){console.error(":",o);try{const l=Bt.slice(0,10).map(u=>{var p;return{id:u.id,type:u.type,prompt:(p=u.prompt)==null?void 0:p.substring(0,100),time:u.time,status:u.status,modelName:u.modelName}});fu(l)}catch(l){console.error(":",l)}}}},[Bt,fu]);const My=M.useMemo(()=>vh(r=>{try{localStorage.setItem("tapnow_chat_sessions",JSON.stringify(r))}catch{}},1e3),[]);M.useEffect(()=>{My(Jn)},[Jn,My]),M.useEffect(()=>{qs.current=g,Po.current=q,vi.current=en,Bc.current=N,Zo.current=Ma},[g,q,en,N,Ma]);const Xt=M.useMemo(()=>{const r=new Map;return g.forEach(o=>{r.set(o.id,o)}),r},[g]),hu=M.useMemo(()=>{const r=new Map;return Oe.forEach(o=>{o!=null&&o.id&&r.set(o.id,{...o,displayName:o.displayName||o.modelName||o.id,modelName:o.modelName||o.displayName||o.id,type:o.type||"Chat",apiType:o.apiType||"openai",ratioLimits:Array.isArray(o.ratioLimits)?o.ratioLimits:null,ratioNotes:es(o.ratioNotes),ratioNotesEnabled:!!o.ratioNotesEnabled,resolutionLimits:Array.isArray(o.resolutionLimits)?o.resolutionLimits:null,resolutionNotes:nl(o.resolutionNotes),resolutionNotesEnabled:!!o.resolutionNotesEnabled,durations:Array.isArray(o.durations)?o.durations:null,durationNotes:es(o.durationNotes),durationNotesEnabled:!!o.durationNotesEnabled,videoResolutions:Array.isArray(o.videoResolutions)?o.videoResolutions:null,videoResolutionNotes:es(o.videoResolutionNotes),videoResolutionNotesEnabled:!!o.videoResolutionNotesEnabled,supportsFirstLastFrame:!!o.supportsFirstLastFrame,supportsHD:!!o.supportsHD,customParams:da(o.customParams),asyncConfig:rp(o.asyncConfig),previewOverrideEnabled:!!o.previewOverrideEnabled,previewOverridePatch:fa(o.previewOverridePatch),requestTemplate:Gi(o.requestTemplate||xo(o)),requestOverrideEnabled:!!o.requestOverrideEnabled,requestOverridePatch:Lo(o.requestOverridePatch)})}),r},[Oe]),ym=Oe.some(r=>!_t.has(r.id)),Wc=M.useCallback(r=>{if(!r)return null;const l=(r.libraryId?hu.get(r.libraryId):null)||null;return{...r,modelName:(l==null?void 0:l.modelName)||r.modelName||r.id,displayName:(l==null?void 0:l.displayName)||r.displayName||r.id,type:(l==null?void 0:l.type)||r.type||"Chat",apiType:(l==null?void 0:l.apiType)||r.apiType,ratioLimits:l?l.ratioLimits:r.ratioLimits||null,ratioNotes:es(l?l.ratioNotes:r.ratioNotes),ratioNotesEnabled:l?!!l.ratioNotesEnabled:!!r.ratioNotesEnabled,resolutionLimits:l?l.resolutionLimits:r.resolutionLimits||null,resolutionNotes:nl(l?l.resolutionNotes:r.resolutionNotes),resolutionNotesEnabled:l?!!l.resolutionNotesEnabled:!!r.resolutionNotesEnabled,durations:l?l.durations:r.durations||null,durationNotes:es(l?l.durationNotes:r.durationNotes),durationNotesEnabled:l?!!l.durationNotesEnabled:!!r.durationNotesEnabled,videoResolutions:l?l.videoResolutions:r.videoResolutions||null,videoResolutionNotes:es(l?l.videoResolutionNotes:r.videoResolutionNotes),videoResolutionNotesEnabled:l?!!l.videoResolutionNotesEnabled:!!r.videoResolutionNotesEnabled,supportsFirstLastFrame:l?!!l.supportsFirstLastFrame:!!r.supportsFirstLastFrame,supportsHD:l?!!l.supportsHD:!!r.supportsHD,customParams:da(l?l.customParams:r.customParams),asyncConfig:rp((l==null?void 0:l.asyncConfig)||r.asyncConfig),previewOverrideEnabled:l?!!l.previewOverrideEnabled:!!r.previewOverrideEnabled,previewOverridePatch:fa((l==null?void 0:l.previewOverridePatch)||r.previewOverridePatch),requestTemplate:Gi((l==null?void 0:l.requestTemplate)||r.requestTemplate),requestOverrideEnabled:l?!!l.requestOverrideEnabled:!!r.requestOverrideEnabled,requestOverridePatch:Lo((l==null?void 0:l.requestOverridePatch)||r.requestOverridePatch)}},[hu]),Va=M.useMemo(()=>{const r=new Map;return Ye.forEach(o=>{const l=Wc(o);l!=null&&l._uid&&r.set(l._uid,l)}),r},[Ye,Wc]),bf=M.useMemo(()=>{const r=new Map;return Ye.forEach(o=>{const l=Wc(o);l!=null&&l.id&&(r.has(l.id)||r.set(l.id,[]),r.get(l.id).push(l))}),r},[Ye,Wc]),sr=M.useCallback(r=>{if(!r)return null;const o=Va.get(r);if(o)return o;const l=bf.get(r);return!l||l.length===0?null:l.length===1?l[0]:l.find(p=>!p.libraryId)||l[0]},[Va,bf]),rr=M.useCallback(r=>{var u,p;if(!r)return"";if(Va.has(r))return r;const o=bf.get(r);if(!o||o.length===0)return r;if(o.length===1)return((u=o[0])==null?void 0:u._uid)||r;const l=o.find(f=>!f.libraryId);return(l==null?void 0:l._uid)||((p=o[0])==null?void 0:p._uid)||r},[Va,bf]);M.useEffect(()=>{Ye.length&&x(r=>{let o=!1;const l=r.map(u=>{if(!u.settings)return u;let p=u.settings,f=!1;const m=y=>{if(!(p!=null&&p[y]))return;const b=rr(p[y]);b&&b!==p[y]&&(f||(p={...p}),p[y]=b,f=!0)};if(m("model"),m("chatModel"),m("imageModel"),Array.isArray(p.shots)){let y=!1;const b=p.shots.map(w=>{if(!(w!=null&&w.model))return w;const v=rr(w.model);return v&&v!==w.model?(y=!0,{...w,model:v}):w});y&&(f||(p={...p}),p.shots=b,f=!0)}return f?(o=!0,{...u,settings:p}):u});return o?l:r})},[Ye.length,rr,x]);const wi=M.useCallback(r=>{const o=sr(r);if(!o)return{key:Ns,url:Ps.replace(/\/+$/,""),modelName:r,displayName:r,apiType:"openai",useProxy:!1,forceAsync:!1};const l=Ft[o.provider],u=(l==null?void 0:l.key)||Ns,p=((l==null?void 0:l.url)||Ps).replace(/\/+$/,"");return{key:u,url:p,modelName:o.modelName,displayName:o.displayName,provider:o.provider,type:o.type,apiType:o.apiType||(l==null?void 0:l.apiType)||"openai",useProxy:!!(l!=null&&l.useProxy),forceAsync:!!(l!=null&&l.forceAsync)}},[sr,Ft,Ns]),vm=M.useCallback((r,o)=>{if(!r)return r;const l=Ft[o];if(!(l!=null&&l.useProxy))return r;const u=(yr||"").trim().replace(/\/+$/,"");return u?`${u}/proxy?url=${encodeURIComponent(r)}`:r},[Ft,yr]);M.useCallback(r=>{if(!r)return"";const o=sr(r);return(o==null?void 0:o.displayName)||(o==null?void 0:o.modelName)||(o==null?void 0:o.id)||r},[sr]);const To=M.useCallback(r=>{if(!r)return"";const o=sr(r),u=(o==null?void 0:o.provider)||""||"",p=(o==null?void 0:o.modelName)||(o==null?void 0:o.displayName)||(o==null?void 0:o.id)||r;return u?`${u} / ${p}`:p},[sr]),Ry=M.useCallback(r=>{var T,I,F,B;if(!r)return null;const o=((T=r==null?void 0:r.apiConfig)==null?void 0:T.modelId)||((I=r==null?void 0:r.apiConfig)==null?void 0:I.id)||(r==null?void 0:r.modelName)||(r==null?void 0:r.modelId),l=o?sr(o):null,u=r.ratio||r.mjRatio||"",p=u?xh(u,!!(l!=null&&l.ratioNotesEnabled),(l==null?void 0:l.ratioNotes)||{}):"",f=r.type==="video",m=r.resolution||(r.width&&r.height?`${r.width}x${r.height}`:"");let y=m;if(m){const U=f?!!(l!=null&&l.videoResolutionNotesEnabled):!!(l!=null&&l.resolutionNotesEnabled),W=f?(l==null?void 0:l.videoResolutionNotes)||{}:(l==null?void 0:l.resolutionNotes)||{},J=(f?ca(m):xp(m))||m;y=xh(J,U,W)}let b="";if(f&&r.duration){const U=String(r.duration).endsWith("s")?String(r.duration):`${r.duration}s`;b=xh(U,!!(l!=null&&l.durationNotesEnabled),(l==null?void 0:l.durationNotes)||{})}const w=[];r.customParams&&Array.isArray(l==null?void 0:l.customParams)&&l.customParams.forEach(U=>{const W=ad(U,r.customParams);if(W===""||W===void 0||W===null)return;const X=typeof W=="string"?W.trim():String(W),J=(U==null?void 0:U.valueNotes)||{},Y=U!=null&&U.notesEnabled&&(J[X]||J[String(X)])||null;if(Y){w.push(Y);return}const ne=xh(X,!!(U!=null&&U.notesEnabled),J),ie=(U==null?void 0:U.name)||(U==null?void 0:U.label)||(U==null?void 0:U.displayName)||(U==null?void 0:U.paramName)||(U==null?void 0:U.key)||(U==null?void 0:U.id)||"",Z=String(ie||"").trim();!Z||/^param-/.test(Z)?w.push(ne):w.push(`${Z}:${ne}`)}),w.length===0&&r.customParams&&typeof r.customParams=="object"&&!Array.isArray(r.customParams)&&Object.entries(r.customParams).forEach(([U,W])=>{U&&(W===""||W===void 0||W===null||(/^param-/.test(String(U))?w.push(String(W)):w.push(`${U}:${W}`)))});const v=r.modelName||((F=r.apiConfig)==null?void 0:F.modelId)||((B=r.apiConfig)==null?void 0:B.model)||r.model||"",z=(l==null?void 0:l.displayName)||(l==null?void 0:l.modelName)||(l==null?void 0:l.id)||"";let k=z||v;if(!k||/^uid-/.test(k)){const U=r.modelName&&!/^uid-/.test(r.modelName)?r.modelName:"";k=(l==null?void 0:l.modelName)||(l==null?void 0:l.id)||U||v||""}return/^uid-/.test(k)&&(k=""),r.modelName&&r.provider&&r.modelName.toLowerCase()===r.provider.toLowerCase()&&(k=z||(l==null?void 0:l.modelName)||(l==null?void 0:l.id)||v),{ratioLabel:p,resolutionLabel:y,durationLabel:b,customParamLabels:w,modelLabel:k}},[sr]),Oy=M.useCallback((r,o,l)=>{const u=sr(r),p=Array.isArray(u==null?void 0:u.customParams)?u.customParams:[];if(!p.length)return null;const f=o||{};return i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("div",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),p.map(m=>{const y=m.id||m.name,b=ad(m,f),w=Array.isArray(m.values)?m.values:[],v=lE(m),z=w.filter(T=>!/^(input|)$/i.test(String(T||"").trim())),k=(m==null?void 0:m.name)||(m==null?void 0:m.label)||(m==null?void 0:m.displayName)||(m==null?void 0:m.paramName)||(m==null?void 0:m.key)||(m==null?void 0:m.id)||"";return i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[10px] min-w-[70px] max-w-[140px] flex-shrink-0 truncate ${e==="dark"?"text-zinc-400":"text-zinc-700"}`,title:k,children:k}),v?i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"text",value:b||"",onChange:T=>{const I=T.target.value,F={...f};I?F[y]=I:delete F[y],l(F)},placeholder:j(""),list:z.length>0?`param-suggest-${y}`:void 0,className:`flex-1 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:T=>T.stopPropagation()}),z.length>0&&i.jsx("datalist",{id:`param-suggest-${y}`,children:z.map(T=>i.jsx("option",{value:T},T))})]}):w.length>0?i.jsxs("select",{value:b||"",onChange:T=>{const I=T.target.value,F={...f};I?F[y]=I:delete F[y],l(F)},className:`flex-1 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:T=>T.stopPropagation(),children:[i.jsx("option",{value:"",children:j("")}),w.map(T=>i.jsx("option",{value:T,children:Bw(m,T)},T))]}):i.jsx("input",{type:"text",value:b||"",onChange:T=>{const I=T.target.value,F={...f};I?F[y]=I:delete F[y],l(F)},placeholder:j(": size/quality"),className:`flex-1 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:T=>T.stopPropagation()}),m.override&&i.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-emerald-500/15 text-emerald-600 border border-emerald-500/30",children:""})]},y)})]})},[sr,e]),ys=M.useMemo(()=>{const r={};return Object.entries(Ft).forEach(([o])=>{r[o]={name:o,models:[]}}),Ye.forEach(o=>{if(Fx.includes(o.id))return;const l=Wc(o);if(!l)return;const u=l.provider||"Other";r[u]||(r[u]={name:u,models:[]}),r[u].models.push(l)}),r},[Ye,Ft,Wc]),wm=M.useCallback(r=>{if(!r)return p0;const o=sr(r);if(o!=null&&o.ratioLimits&&Array.isArray(o.ratioLimits)&&o.ratioLimits.length>0){const u=o.ratioLimits.map(p=>String(p));return u.includes("Auto")?u:["Auto",...u]}const l=(o==null?void 0:o.id)||r;return nE(l)},[sr]),zm=M.useCallback(r=>{if(!r)return Bx;const o=sr(r);if(o!=null&&o.resolutionLimits&&Array.isArray(o.resolutionLimits)&&o.resolutionLimits.length>0){const u=o.resolutionLimits.map(f=>xp(f)).filter(Boolean),p=u.includes("Auto")?u:["Auto",...u];return Array.from(new Set(p))}const l=(o==null?void 0:o.id)||r;return bE(l)},[sr]),km=M.useCallback(r=>{const o=r?sr(r):null,u=(Array.isArray(o==null?void 0:o.videoResolutions)&&o.videoResolutions.length>0?o.videoResolutions:E2).map(f=>ca(f)).filter(Boolean),p=u.includes("Auto")?u:["Auto",...u];return Array.from(new Set(p))},[sr]),co=M.useMemo(()=>{const r=new Map;return Bt.forEach(o=>{r.set(o.id,o)}),r},[Bt]),yf=M.useMemo(()=>{if(!Io.current)return g;const r=Io.current.getBoundingClientRect(),o=200,l=ee.current,u=(-l.x-o)/l.zoom,p=(r.width-l.x+o)/l.zoom,f=(-l.y-o)/l.zoom,m=(r.height-l.y+o)/l.zoom;return g.filter(y=>{const b=y.x+(y.width||0),w=y.y+(y.height||0);return y.x<p&&b>u&&y.y<m&&w>f})},[g,E.x,E.y,E.zoom]);M.useCallback(r=>r>=.8?"high":r>=.4?"medium":"low",[]),M.useEffect(()=>{ee.current=E},[E]);const Wa=M.useMemo(()=>{const r={to:new Map,from:new Map};return N.forEach(o=>{r.to.has(o.to)||r.to.set(o.to,[]),r.to.get(o.to).push(o),r.from.has(o.from)||r.from.set(o.from,[]),r.from.get(o.from).push(o)}),r},[N]),jm=M.useCallback(r=>{const o=[],l=new Set,u=Wa.to.get(r)||[],p=(m,y="image",b={})=>{if(!m)return;const w=`${y}:${m}`;l.has(w)||(l.add(w),o.push({url:m,type:y,...b}))},f=(m={},y=null,b=null)=>{var w;if(y){const v=y.provider||((w=y.apiConfig)==null?void 0:w.provider)||m.provider,z=ps(y);return{...m,provider:v,apiConfig:y.apiConfig||m.apiConfig,useProxy:z}}if(b){const v=sr(b),z=(v==null?void 0:v.provider)||m.provider,k=z?ps({provider:z}):!1;return{...m,provider:z,apiConfig:v?{modelId:v.id,provider:v.provider}:m.apiConfig,useProxy:k}}return m};return u.forEach(m=>{var b,w,v,z,k;const y=Xt.get(m.from);if(y){if(y.type==="gen-image"||y.type==="gen-video"){const T=Bt.find(B=>B.sourceNodeId===y.id&&B.status==="completed");if(!T)return;const I=T.prompt||((b=y.settings)==null?void 0:b.prompt)||((w=y.settings)==null?void 0:w.videoPrompt)||"",F=f({},T);if(T.mjImages&&T.mjImages.length>0)T.mjImages.forEach(B=>p(B,T.type||"image",{prompt:I,originalUrl:T.mjOriginalUrl||T.originalUrl||B,...F}));else if(T.output_images&&T.output_images.length>0)T.output_images.forEach(B=>p(B,T.type||"image",{prompt:I,originalUrl:T.originalUrl||B,...F}));else{const B=T.url||T.originalUrl||T.mjOriginalUrl;B&&p(B,T.type||(y.type==="gen-video"?"video":"image"),{prompt:I,originalUrl:T.originalUrl||B,...F})}return}if(y.type==="storyboard-node"){const T=((v=y.settings)==null?void 0:v.shots)||[],I=((z=y.settings)==null?void 0:z.mode)||"video",F=((k=y.settings)==null?void 0:k.projectTitle)||"";T.forEach(B=>{if(!B.outputEnabled)return;const U=f({},null,B.model);if(I==="image")if(B.output_images&&B.output_images.length>0)B.output_images.forEach(W=>{p(W,"image",{prompt:B.prompt||B.description||"",projectTitle:F,originalUrl:W,...U})});else{const W=B.selectedImageIndex??-1;W>=0&&B.output_images&&B.output_images[W]&&p(B.output_images[W],"image",{prompt:B.prompt||B.description||"",projectTitle:F,originalUrl:B.output_images[W],...U})}else{const W=B.output_url||B.image_url;W&&p(W,ur(W)?"video":"image",{prompt:B.prompt||B.description||"",projectTitle:F,originalUrl:W,...U})}});return}if(y.type==="video-input"){const T=y.selectedKeyframes&&y.selectedKeyframes.length>0?y.selectedKeyframes.map(I=>I.url):[];T.length>0?T.forEach(I=>p(I,"image",{name:y.videoFileName||"",originalUrl:I})):y.frames&&y.frames.length>0&&p(y.frames[0].url,"image",{name:y.videoFileName||"",originalUrl:y.frames[0].url});return}if(y.type==="input-image"||y.type==="preview"){y.content&&p(y.content,ur(y.content)?"video":"image",{name:y.title||"",originalUrl:y.content}),y.previewMjImages&&y.previewMjImages.forEach(T=>p(T,"image",{name:y.title||"",originalUrl:T}));return}}}),o},[Wa,Xt,Bt,ps,sr]);M.useEffect(()=>{const r=setInterval(()=>{const o=Date.now(),l=Bt.filter(p=>p.sourceNodeId&&p.status==="generating"&&p.startTime),u={};l.forEach(p=>{const f=Math.floor((o-p.startTime)/100);u[p.sourceNodeId]=f/10}),bj(u)},500);return()=>clearInterval(r)},[Bt]);const vf=M.useRef(new Set);M.useEffect(()=>{Bt.forEach(r=>{var o,l;if(r.mjNeedsSplit&&r.mjOriginalUrl&&((l=(o=r.apiConfig)==null?void 0:o.modelId)!=null&&l.includes("mj"))&&r.status==="completed"){if(vf.current.has(r.id))return;vf.current.add(r.id),setTimeout(()=>{let u=r.mjRatio||"1:1";if(r.prompt&&r.prompt.includes("--ar ")){const p=r.prompt.match(/--ar\s+([\d:]+)/);p&&p[1]&&(u=p[1])}nv(r.mjOriginalUrl,u).then(p=>{const f=p.map(b=>typeof b=="string"?b:b.url),m=p[0],y=typeof m=="string"?m:m.url;Rt(b=>b.map(w=>w.id===r.id?{...w,mjImages:f,url:y,selectedMjImageIndex:0,mjRatio:u,mjNeedsSplit:!1,mjImageInfo:p.map(v=>typeof v=="string"?null:{width:v.width,height:v.height,ratio:v.ratio})}:w)),vf.current.delete(r.id)}).catch(p=>{console.error("Midjourney: :",p),vf.current.delete(r.id),Rt(f=>f.map(m=>m.id===r.id?{...m,mjNeedsSplit:!0}:m))})},500)}})},[Bt]);const Ly=M.useCallback(async(r=[],o={})=>{const l=o.useProxyResolver,u=o.proxyBaseUrl,p=[],f=new Map,m=new Set;for(let y=0;y<r.length;y++){const b=r[y],w=b==null?void 0:b.url;if(w&&!m.has(w)){m.add(w);try{let v=w;const z=typeof l=="function"?!!l(b):!1,k=Gn(w,z);if(!w.startsWith("data:")){const{blob:Y}=await Bi(w,{useProxy:k,proxyBaseUrl:u,preferLocal:!0});v=await new Promise(ne=>{const ie=new FileReader;ie.onloadend=()=>ne(ie.result),ie.readAsDataURL(Y)})}const T=b.type==="video"||w.startsWith("data:video")||ur(w),I=ra(v,T?".mp4":".png"),B=[b.projectTitle||(cs&&cs!==""?cs:""),b.prompt].filter(Boolean).join("-")||ta(w)||b.name||"tapnow";let U=Ls(B)||"tapnow";U=U.slice(0,80);const W=(f.get(U)||0)+1;f.set(U,W);const X=b.dedupeKey||b.originalUrl||w,J=ta(X)||X;p.push({filename:`${U}-${W}${I}`,content:v,sourceUrl:w,dedupeKey:J,scopedKey:b.scopedKey||"",type:T?"video":"image"})}catch(v){console.warn("[] :",v)}}}return p},[Bi,ra,ta,Ls,cs,Gn]),wf=M.useCallback(r=>{var l;return(((l=r==null?void 0:r.settings)==null?void 0:l.serverUrl)||yr||"").trim().replace(/\/+$/,"")},[yr]),Nm=M.useCallback(async(r,o,l={})=>{var W,X,J,Y,ne;const u=l.silent===!0,p=wf(r);if(!p){u||d("","error");return}const f=((W=r.settings)==null?void 0:W.lastSavedUrls)||[],m=(((X=r.settings)==null?void 0:X.subfolder)||"").trim(),y=`${p}::${m}`,b=o.map(ie=>{if(!ie)return ie;const Z=ie.dedupeKey||ie.originalUrl||ie.url,te=Z?ta(Z)||Z:"",pe=te?`${y}::${te}`:"",Te=!m&&te&&f.includes(te),Qe=pe&&f.includes(pe)||Te;return{...ie,dedupeKey:te,scopedKey:pe,isDuplicate:Qe}}),w=b.filter(ie=>(ie==null?void 0:ie.url)&&ie.scopedKey&&!ie.isDuplicate),v=b.filter(ie=>(ie==null?void 0:ie.url)&&ie.scopedKey&&ie.isDuplicate).length;if(w.length===0){u||d("","success");return}const z=await Ly(w,{useProxyResolver:ps,proxyBaseUrl:p});if(z.length===0){u||d("","warning");return}let k;try{k=await fetch(`${p}/save-batch`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:z,subfolder:((J=r.settings)==null?void 0:J.subfolder)||""})})}catch(ie){throw u||d("","error"),ie}if(!k.ok){const ie=await k.text();throw new Error(ie||"")}const T=await k.json(),I=T.results||[],F=I.map((ie,Z)=>{var te,pe;return ie!=null&&ie.success?((te=z[Z])==null?void 0:te.scopedKey)||((pe=w[Z])==null?void 0:pe.scopedKey):null}).filter(Boolean),B=Array.from(new Set([...((Y=r.settings)==null?void 0:Y.lastSavedUrls)||[],...F]));Je(r.id,{lastSavedUrls:B,lastSaved:new Date().toLocaleString(),savedFiles:[...((ne=r.settings)==null?void 0:ne.savedFiles)||[],...I.map(ie=>ie.path).filter(Boolean)]});const U=I.filter(ie=>ie.success).length;if(!u){const ie=v>0?` ${v} `:"";d(T.message||` ${U} ${ie}`,"success")}},[Ly,ta,ps,wf,d]),Pj=M.useCallback(async(r,o)=>{const l=(o||yr||"").trim().replace(/\/+$/,"");if(!l){d("","warning");return}Je(r,{serverStatus:"checking"});try{if((await fetch(`${l}/ping`,{method:"GET"})).ok){Je(r,{serverStatus:"connected"}),d("","success");return}}catch{}Je(r,{serverStatus:"disconnected"}),d("","error")},[yr,d,Je]),Sm=M.useRef(new Set);M.useEffect(()=>{const r=g.filter(o=>{var l;return o.type==="local-save"&&((l=o.settings)==null?void 0:l.autoSave)});r.length!==0&&r.forEach(async o=>{var w,v;const l=wf(o);if(!l)return;const u=jm(o.id);if(u.length===0)return;const p=((w=o.settings)==null?void 0:w.lastSavedUrls)||[],f=(((v=o.settings)==null?void 0:v.subfolder)||"").trim(),m=`${l}::${f}`,y=u.filter(z=>{const k=(z==null?void 0:z.originalUrl)||(z==null?void 0:z.url),T=k?ta(k)||k:"",I=T?`${m}::${T}`:"",F=!f&&T&&p.includes(T),B=I&&p.includes(I)||F;return I&&!B});if(y.length===0)return;const b=`${o.id}-${y.map(z=>z.url).join("|")}`;Sm.current.has(b)||(Sm.current.add(b),setTimeout(async()=>{try{await Nm(o,y,{silent:!0})}catch(z){console.error(":",z)}finally{Sm.current.delete(b)}},1e3))})},[g,Bt,jm,Nm,wf,ta]);const $j=r=>{r.preventDefault(),Dy(!0)},[zf,Dy]=M.useState(!1),kf=M.useCallback(r=>{if(!zf)return;const o=window.innerWidth-r.clientX;V2(Math.max(300,Math.min(o,800)))},[zf]),jf=M.useCallback(()=>{Dy(!1)},[]);M.useEffect(()=>{const r=console.error,o=console.warn,l=u=>{const p=u.map(f=>typeof f=="string"?f:f&&f.toString?f.toString():"").join(" ");return p.includes("Unable to preventDefault")||p.includes("passive event listener")||p.includes("preventDefault")&&p.includes("passive")};return console.error=function(...u){l(u)||r.apply(console,u)},console.warn=function(...u){l(u)||o.apply(console,u)},()=>{console.error=r,console.warn=o}},[]),M.useEffect(()=>{const r=l=>{if(l.ctrlKey)try{l.cancelable&&(l.preventDefault(),l.stopPropagation())}catch{}},o={passive:!1,capture:!0};return window.addEventListener("wheel",r,o),document.addEventListener("wheel",r,o),window.addEventListener("mousewheel",r,o),document.addEventListener("mousewheel",r,o),()=>{window.removeEventListener("wheel",r,o),document.removeEventListener("wheel",r,o),window.removeEventListener("mousewheel",r,o),document.removeEventListener("mousewheel",r,o)}},[]),M.useEffect(()=>{const r=Io.current;if(!r)return;const o=l=>{if(l.ctrlKey){try{l.cancelable&&(l.preventDefault(),l.stopPropagation())}catch{}return}const u=l.target;let p=!1,f=null;if(u.tagName==="TEXTAREA"&&u.scrollHeight>u.clientHeight){try{l.cancelable&&l.preventDefault()}catch{}const v=u.scrollHeight-u.clientHeight,z=u.scrollTop,k=Math.max(0,Math.min(v,z+l.deltaY));u.scrollTop=k;return}let m=u;for(;m&&m!==r;){if(m.classList){const v=m.classList.contains("flex")&&m.classList.contains("flex-col")&&m.classList.contains("h-full")&&m.classList.contains("rounded-xl")&&m.classList.contains("overflow-hidden");if(m.classList.contains("video-input-container")||m.classList.contains("video-analyze-container")||v){if(p=!0,v)f=m.querySelector(".flex-1.overflow-y-auto.custom-scrollbar"),f||(f=m.querySelector(".flex-1.overflow-y-auto"));else if(f=m.querySelector('.overflow-y-auto, .custom-scrollbar, [class*="overflow-y"]'),!f){const T=window.getComputedStyle(m);(T.overflowY==="auto"||T.overflowY==="scroll"||m.classList.contains("custom-scrollbar"))&&(f=m)}break}const z=m.closest(".video-input-container, .video-analyze-container");if(z){if(p=!0,f=z.querySelector('.overflow-y-auto, .custom-scrollbar, [class*="overflow-y"]'),!f){const T=window.getComputedStyle(z);(T.overflowY==="auto"||T.overflowY==="scroll")&&(f=z)}break}const k=m.closest(".flex.flex-col.h-full.rounded-xl.overflow-hidden");if(k){p=!0,f=k.querySelector(".flex-1.overflow-y-auto.custom-scrollbar"),f||(f=k.querySelector(".flex-1.overflow-y-auto"));break}}m=m.parentElement}if(p&&f){try{l.cancelable&&(l.preventDefault(),l.stopPropagation())}catch{}const v=f.scrollHeight-f.clientHeight,z=f.scrollTop,k=Math.max(0,Math.min(v,z+l.deltaY));f.scrollTop=k;return}try{l.cancelable&&l.preventDefault()}catch{}const y=r.getBoundingClientRect(),b=l.clientX-y.left,w=l.clientY-y.top;Ce(v=>{const z=l.deltaY>0?.9:1.1;let k=Math.min(Math.max(v.zoom*z,.2),3);const T=k/v.zoom;return{zoom:k,x:b-(b-v.x)*T,y:w-(w-v.y)*T}})};return r.addEventListener("wheel",o,{passive:!1}),()=>{r.removeEventListener("wheel",o)}},[E]),M.useEffect(()=>(zf?(window.addEventListener("mousemove",kf),window.addEventListener("mouseup",jf)):(window.removeEventListener("mousemove",kf),window.removeEventListener("mouseup",jf)),()=>{window.removeEventListener("mousemove",kf),window.removeEventListener("mouseup",jf)}),[zf,kf,jf]);const Hr=M.useCallback((r,o)=>{var f;const l=(f=Io.current)==null?void 0:f.getBoundingClientRect(),u=l?r-l.left:r,p=l?o-l.top:o;return{x:(u-E.x)/E.zoom,y:(p-E.y)/E.zoom}},[E]),Aj=r=>{var o;if((r.button===0||r.button===1)&&r.currentTarget.id==="canvas-bg"){const l=r.target;if(l&&(l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.tagName==="SELECT"||l.tagName==="BUTTON"||l.isContentEditable||l.closest('input, textarea, select, button, [contenteditable="true"]')))return;const u=window.getSelection();if(u&&u.toString().length>0&&u.removeAllRanges(),r.button===0&&(r.ctrlKey||r.metaKey)){r.preventDefault(),q0(!0),Zo.current=!0,Zd(!1);const p=(o=Io.current)==null?void 0:o.getBoundingClientRect(),f=r.clientX-((p==null?void 0:p.left)||0),m=r.clientY-((p==null?void 0:p.top)||0);G0({startX:f,startY:m,endX:f,endY:m}),ss(new Set),le(null);return}Zo.current||(Zd(!0),Hc.current=!0,Qd(!1),uu.current={x:r.clientX,y:r.clientY})}},Nf=M.useRef(null),Vi=M.useRef(null),Ka=M.useRef(null),mu=M.useCallback(()=>{if(Ka.current){const l=Ka.current,u=new Map(l.map(({nodeId:p})=>[p,!0]));x(p=>{if(p.length>50&&l.length>10){const f=new Map;p.forEach((b,w)=>{u.has(b.id)&&f.set(b.id,w)});const m=[...p];let y=!1;return l.forEach(({nodeId:b,updater:w})=>{const v=f.get(b);if(v!==void 0){const z=w(m[v]);z!==m[v]&&(m[v]=z,y=!0)}}),y?m:p}else{const f=[...p];let m=!1;return l.forEach(({nodeId:y,updater:b})=>{const w=f.findIndex(v=>v.id===y);if(w!==-1){const v=b(f[w]);v!==f[w]&&(f[w]=v,m=!0)}}),m?f:p}}),Ka.current=null,Vi.current=null;return}if(!Nf.current){Vi.current=null;return}const{nodeId:r,updater:o}=Nf.current;x(l=>{const u=l.findIndex(m=>m.id===r);if(u===-1)return l;const p=o(l[u]);if(p===l[u])return l;const f=[...l];return f[u]=p,f}),Nf.current=null,Vi.current=null},[]),_m=M.useCallback((r,o)=>{Nf.current={nodeId:r,updater:o},Vi.current||(Vi.current=requestAnimationFrame(mu))},[mu]),Uy=M.useCallback(r=>{if(Ka.current&&Vi.current){const o=Ka.current,l=new Map;o.forEach(({nodeId:u,updater:p})=>{l.set(u,p)}),r.forEach(({nodeId:u,updater:p})=>{l.set(u,p)}),Ka.current=Array.from(l.entries()).map(([u,p])=>({nodeId:u,updater:p}))}else Ka.current=r;Vi.current||(Vi.current=requestAnimationFrame(mu))},[mu]);M.useEffect(()=>()=>{Vi.current&&cancelAnimationFrame(Vi.current),sa.current&&cancelAnimationFrame(sa.current)},[]);const gu=M.useRef(null),Sf=M.useRef(null),Fy=M.useCallback(r=>{var p;const{clientX:o,clientY:l}=r,u=Hr(o,l);if(xi(u),Ma||Zo.current){Ma||q0(!0);const f=(p=Io.current)==null?void 0:p.getBoundingClientRect(),m=o-((f==null?void 0:f.left)||0),y=l-((f==null?void 0:f.top)||0);G0(b=>b?{...b,endX:m,endY:y}:null),Sf.current={endX:m,endY:y,rect:f},gu.current||(gu.current=requestAnimationFrame(()=>{if(!Sf.current){gu.current=null;return}const{endX:b,endY:w,rect:v}=Sf.current,z=oo;if(!z){gu.current=null;return}const k=Math.min(z.startX,b),T=Math.min(z.startY,w),I=Math.max(z.startX,b),F=Math.max(z.startY,w),B=Hr(k+((v==null?void 0:v.left)||0),T+((v==null?void 0:v.top)||0)),U=Hr(I+((v==null?void 0:v.left)||0),F+((v==null?void 0:v.top)||0)),W=qs.current,X=new Set;W.forEach(J=>{const Y=J.x+(J.width||260),ne=J.y+(J.height||200);J.x<U.x&&Y>B.x&&J.y<U.y&&ne>B.y&&X.add(J.id)}),ss(X),Sf.current=null,gu.current=null}));return}if((jc||Hc.current)&&!Zo.current){Qd(!0);const f=o-uu.current.x,m=l-uu.current.y;if(Math.abs(f)<1&&Math.abs(m)<1)return;$o.current?($o.current.dx+=f,$o.current.dy+=m):$o.current={dx:f,dy:m},sa.current||(sa.current=requestAnimationFrame(()=>{if(!$o.current){sa.current=null;return}const{dx:y,dy:b}=$o.current;Ce(w=>{const v=Math.max(.2,Math.min(3,w.zoom)),z=v<.5||v>2.5?1e3:100;return{...w,zoom:v,x:Math.round((w.x+y)*z)/z,y:Math.round((w.y+b)*z)/z}}),$o.current=null,sa.current=null})),uu.current={x:o,y:l};return}if(Nc)_m(Nc,f=>({...f,width:Math.max(250,u.x-f.x),height:Math.max(250,u.y-f.y)}));else if(si){const f=Math.max(.2,Math.min(3,E.zoom)),m=r.movementX/f,y=r.movementY/f,b=f<.5||f>2.5?.5:1;if(Math.abs(m)<b&&Math.abs(y)<b)return;const w=vi.current;if(w&&w.size>1&&w.has(si)){const v=qs.current,z=Math.max(.2,Math.min(3,E.zoom));(!Ha.current||pu.current!==null&&Math.abs(pu.current-z)>.01)&&(Ha.current={mouseX:o,mouseY:l,nodes:new Map(Array.from(w).map(F=>{const B=v.find(U=>U.id===F);return B?[F,{x:B.x,y:B.y}]:null}).filter(Boolean))}),pu.current=z;const k=(o-Ha.current.mouseX)/z,T=(l-Ha.current.mouseY)/z,I=Array.from(Ha.current.nodes.entries()).map(([F,B])=>({nodeId:F,updater:U=>({...U,x:B.x+k,y:B.y+T})}));Uy(I)}else Ha.current=null,_m(si,v=>({...v,x:v.x+m,y:v.y+y}))}},[jc,Ma,oo,si,Nc,Hr,E.zoom,_m,Uy]),By=()=>{if(sa.current&&(cancelAnimationFrame(sa.current),sa.current=null),$o.current){const{dx:r,dy:o}=$o.current;Ce(l=>{const u=Math.max(.2,Math.min(3,l.zoom)),p=u<.5||u>2.5?1e3:100;return{...l,zoom:u,x:Math.round((l.x+r)*p)/p,y:Math.round((l.y+o)*p)/p}}),$o.current=null}if(Ka.current&&Vi.current&&(cancelAnimationFrame(Vi.current),mu()),Ma||Zo.current){if(q0(!1),Zo.current=!1,G0(null),en.size===1){const r=Array.from(en)[0];le(r)}else en.size===0&&le(null);Qd(!1),Zd(!1),Hc.current=!1,Ha.current=null,pu.current=null;return}(jc||Hc.current)&&(Zd(!1),Hc.current=!1,Qd(!1),!En&&!Jr&&!si&&!Nc&&(le(null),ss(new Set),Cc(r=>({...r,visible:!1})),Er(null),Fi(r=>({...r,visible:!1})))),!En&&!Jr&&(eu(null),Qp(null),Ha.current=null,pu.current=null),Qd(!1),Zo.current=!1,uu.current={x:0,y:0}};M.useEffect(()=>{if(!(jc||Hc.current||W0||si||Nc||Ma||Zo.current||En||Jr))return;const o=u=>{u.movementX===void 0&&(u.movementX=0),u.movementY===void 0&&(u.movementY=0),Fy(u)},l=()=>{By()};return window.addEventListener("pointermove",o,{passive:!1}),window.addEventListener("pointerup",l,{passive:!1}),()=>{window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",l)}},[jc,W0,si,Nc,Ma,En,Jr,Fy,By]);const zi=M.useCallback((r,o,l="default")=>{if(o.stopPropagation(),En&&En!==r)N.some(p=>p.from===En&&p.to===r&&(p.inputType||"default")===l)||(l!=="default"&&C(p=>p.filter(f=>!(f.to===r&&(f.inputType||"default")===l))),C(p=>[...p,{id:`conn-${Date.now()}`,from:En,to:r,inputType:l!=="default"?l:void 0}]));else if(Jr&&Jr!==r){const u=oi||l;N.some(f=>f.from===r&&f.to===Jr&&(f.inputType||"default")===u)||(u!=="default"&&C(f=>f.filter(m=>!(m.to===Jr&&(m.inputType||"default")===u))),C(f=>[...f,{id:`conn-${Date.now()}`,from:r,to:Jr,inputType:u!=="default"?u:void 0}]))}Sc(null),ii(null),ai(null),Ta(null),Zd(!1),eu(null),Qp(null)},[En,Jr,oi,N]),Tj=r=>{if(En){const o=Hr(r.clientX,r.clientY);Cc({visible:!0,x:r.clientX,y:r.clientY,worldX:o.x,worldY:o.y,sourceNodeId:En}),Ra(!1),Sc(null)}else if(Jr){const o=Hr(r.clientX,r.clientY);Cc({visible:!0,x:r.clientX,y:r.clientY,worldX:o.x,worldY:o.y,targetNodeId:Jr,inputType:oi}),Ra(!1),ii(null),ai(null)}},Mj=r=>{if(r.currentTarget.id==="canvas-bg"){const o=Hr(r.clientX,r.clientY);Cc({visible:!0,x:r.clientX,y:r.clientY,worldX:o.x,worldY:o.y,sourceNodeId:void 0}),Ra(!1)}},Rj=r=>{r.preventDefault(),r.stopPropagation(),(en.size>0||q)&&X0({visible:!0,x:r.clientX,y:r.clientY})},Hy=M.useMemo(()=>{const r=new Map,o=l=>!l||!Kt||!vn?l:vn.get(l)||l;return N.forEach(l=>{var m,y;const u=l.inputType||"default";r.has(l.to)||r.set(l.to,new Map);const p=r.get(l.to);p.has(u)||p.set(u,[]);const f=Xt.get(l.from);if(f){let b=[];if(f.type==="video-input"){const w=f.selectedKeyframes&&f.selectedKeyframes.length>0?f.selectedKeyframes.map(v=>v.url):[];w.length>0?b=w.map(o):f.frames&&f.frames.length>0&&(b=[o(f.frames[0].url)])}else if(f.type==="input-image"||f.type==="gen-image"||f.type==="preview")f.content&&b.push(o(f.content)),f.previewMjImages&&b.push(...f.previewMjImages.map(o));else if(f.type==="storyboard-node"){const w=((m=f.settings)==null?void 0:m.shots)||[],v=((y=f.settings)==null?void 0:y.mode)||"video";w.forEach(z=>{if(z.outputEnabled)if(v==="image"){const k=z.selectedImageIndex??-1;k>=0&&z.output_images&&z.output_images.length>0&&z.output_images[k]&&b.push(o(z.output_images[k]))}else z.output_url?b.push(o(z.output_url)):z.image_url&&b.push(o(z.image_url))})}b.length>0&&p.get(u).push(...b)}}),r},[N,Xt,g,Js,Kt,vn]),Vy=M.useCallback((r,o="default")=>{const l=Hy.get(r);return l?l.get(o)||[]:[]},[Hy]),Wy=M.useMemo(()=>{const r=new Map;return N.forEach(o=>{var l,u,p;if(!r.has(o.to)){const f=Xt.get(o.from);if(f){if(f.type==="video-input")r.set(o.to,f);else if(f.type==="input-image"){const m={...f,type:"input-image-as-video",videoFileName:"",videoMeta:{duration:0},frames:f.content?[{time:0,url:f.content}]:[],selectedKeyframes:f.content?[{time:0,url:f.content}]:[],isImageInput:!0};r.set(o.to,m)}else if(f.type==="storyboard-node"){const m=((l=f.settings)==null?void 0:l.shots)||[],y=((u=f.settings)==null?void 0:u.mode)||"video",b=((p=f.settings)==null?void 0:p.projectTitle)||"",w=[];m.forEach((z,k)=>{if(!z.outputEnabled)return;let T=null,I=z.image_filename||`${k+1}`;if(y==="image"){const F=z.selectedImageIndex??-1;F>=0&&z.output_images&&z.output_images[F]&&(T=z.output_images[F])}else T=z.output_url||z.image_url;T&&w.push({time:k,url:T,filename:I})});const v={...f,type:"storyboard-as-video",videoFileName:b,videoMeta:{duration:m.length},frames:w,selectedKeyframes:w,isStoryboardInput:!0};r.set(o.to,v)}}}}),r},[N,Xt]),xu=M.useCallback(r=>Wy.get(r)||null,[Wy]),Oj=M.useCallback(r=>{for(const o of N)if(o.to===r){const l=Xt.get(o.from);if(l&&l.type==="video-analyze")return l}return null},[N,Xt]),bu=M.useCallback(r=>{const o=[];return N.forEach(l=>{var u;if(l.to===r){const p=Xt.get(l.from);if(p&&p.type==="text-node"){const f=((u=p.settings)==null?void 0:u.text)||"";f&&o.push(f)}}}),o},[N,Xt]),Ky=M.useMemo(()=>{const r=new Map;return N.forEach(o=>{const l=o.inputType||"default",u=`${o.to}:${l}`;if(!r.has(u)){const p=Xt.get(o.from);if(p){let f=null;if(p.type==="video-input"){const m=p.selectedKeyframes&&p.selectedKeyframes.length>0?p.selectedKeyframes[0].url:null;m?f=m:p.frames&&p.frames[0]&&(f=p.frames[0].url)}else p.type==="input-image"&&p.content&&(f=p.content);f&&r.set(u,f)}}}),r},[N,Xt,g]),Wi=M.useCallback((r,o)=>{const l=`${r}:${o||"default"}`;return Ky.get(l)||null},[Ky]),Ki=(r,o,l="image",u=null,p=null,f=null)=>{if(!o&&(!p||p.length===0))return;let m=u;if(!m){const b=co.get(r);m=b==null?void 0:b.sourceNodeId}if(!m){console.warn("[Tapnow] updatePreviewFromTask:  sourceNodeId for taskId:",r);return}setTimeout(()=>{var w;const b=Xt.get(m);if(b&&(b.type==="gen-image"||b.type==="gen-video")){const v=N.filter(z=>z.to===m);for(const z of v){const k=Xt.get(z.from),T=k&&k.type==="storyboard-node"?k:null;if(T&&((w=T.settings)!=null&&w.shots)){const I=T.settings.shots.find(F=>F.status==="generating");if(I){const F=o||(p&&p.length>0?p[0]:null);if(F){ar(T.id,I.id,{image_url:F,image_filename:f||I.image_filename,status:"done"});break}}}}}},0);const y=Bc.current;x(b=>{const w=y.filter(v=>v.from===m).map(v=>v.to);return w.length?b.map(v=>w.includes(v.id)&&v.type==="preview"?{...v,content:o||(p&&p.length>0?p[0]:o),previewType:l,previewMjImages:p,previewFilename:f||v.previewFilename||""}:v):b})},Jy=r=>{Rt(o=>{const l=o.filter(u=>u.id!==r);try{localStorage.setItem("tapnow_history",JSON.stringify(l))}catch(u){console.error(":",u)}return l}),Ks.item&&Ks.item.id===r&&Fi({visible:!1,x:0,y:0,item:null})},Lj=()=>{const r=`model-${Date.now()}`,o={id:r,displayName:r,modelName:r,type:"Image",ratioLimits:null,ratioNotes:{},ratioNotesEnabled:!1,resolutionLimits:null,resolutionNotes:{},resolutionNotesEnabled:!1,durations:null,durationNotes:{},durationNotesEnabled:!1,videoResolutions:null,videoResolutionNotes:{},videoResolutionNotesEnabled:!1,supportsFirstLastFrame:!1,supportsHD:!1,apiType:"openai",customParams:[],asyncConfig:null,previewOverrideEnabled:!1,previewOverridePatch:null,requestOverrideEnabled:!1,requestOverridePatch:null},l={...o,requestTemplate:xo(o)};ke(u=>[...u,l]),tf(u=>{const p=new Set(u);return p.add(r),p}),tt(u=>{const p=new Set(u);return p.add(r),p})},Dj=r=>{const o=Oe.find(b=>b.id===r);if(!o)return;const l=`${o.id}-copy`;let u=l,p=1;for(;Oe.some(b=>b.id===u);)u=`${l}-${p++}`;const f=JSON.parse(JSON.stringify(o)),m=f.displayName||f.modelName||f.id||u,y={...f,id:u,displayName:`${m}`,modelName:f.modelName||f.id||u,customParams:da(f.customParams),requestTemplate:Gi(f.requestTemplate||xo(f)),previewOverridePatch:fa(f.previewOverridePatch),requestOverridePatch:Lo(f.requestOverridePatch)};ke(b=>[...b,y]),tf(b=>{const w=new Set(b);return w.add(u),w}),tt(b=>{const w=new Set(b);return w.delete(u),w})},vs=M.useCallback((r,o)=>{const l=`${r}:${o}`;return!!uy[l]},[uy]),Kc=M.useCallback((r,o)=>{const l=`${r}:${o}`;cj(u=>({...u,[l]:!u[l]}))},[Ca]),qy=M.useCallback((r,o)=>{const l=`${r}:${o}`;return!!py[l]},[py]),_f=M.useCallback((r,o)=>{const l=`${r}:${o}`;dj(u=>({...u,[l]:!u[l]}))},[]),Uj=r=>{r&&ke(o=>o.map(l=>{if(l.id!==r)return l;const u=Array.isArray(l.customParams)?[...l.customParams]:[];return u.length>=qu?(d(` ${qu} `,"warning",2e3),l):(u.push({id:`param-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,name:"",values:[],override:!1,notesEnabled:!1,valueNotes:{}}),{...l,customParams:u})}))},yu=(r,o,l)=>{!r||!o||ke(u=>u.map(p=>{if(p.id!==r)return p;const f=Array.isArray(p.customParams)?p.customParams.map(m=>m.id===o?{...m,...l}:m):[];return{...p,customParams:f}}))},Fj=(r,o)=>{!r||!o||ke(l=>l.map(u=>{if(u.id!==r)return u;const p=Array.isArray(u.customParams)?u.customParams.filter(f=>f.id!==o):[];return{...u,customParams:p}}))},Gr=(r,o)=>{r&&ke(l=>l.map(u=>u.id===r?{...u,...o}:u))},Bj=r=>{r&&(ke(o=>o.filter(l=>l.id!==r)),kr(o=>o.map(l=>l.libraryId===r?{...l,libraryId:null}:l)),tf(o=>{const l=new Set(o);return l.delete(r),l}),tt(o=>{const l=new Set(o);return l.delete(r),l}),dy(o=>{const l=new Set(o);return l.delete(r),l}),Ec(o=>{if(!o.has(r))return o;const l=new Set(o);return l.delete(r),l}),El(o=>{if(!o[r])return o;const{[r]:l,...u}=o;return u}),Ic(o=>{if(!o.has(r))return o;const l=new Set(o);return l.delete(r),l}),Il(o=>{if(!o[r])return o;const{[r]:l,...u}=o;return u}),_o(o=>{if(!o[r])return o;const{[r]:l,...u}=o;return u}))},Gy=M.useCallback((r,o)=>{r&&cy(l=>{const u=new Set(l);return o?u.add(r):u.delete(r),u})},[]),Hj=M.useCallback((r,o)=>{r&&(tf(l=>{const u=new Set(l);return o?u.add(r):u.delete(r),u}),o&&tt(l=>{const u=new Set(l);return u.delete(r),u}))},[]),Vj=M.useCallback(r=>{r&&tt(o=>{const l=new Set(o);return l.has(r)?l.delete(r):l.add(r),l})},[]),Yy=M.useCallback(r=>{r&&(dy(o=>{const l=new Set(o);return l.has(r)?l.delete(r):l.add(r),l}),Ec(o=>{if(!o.has(r))return o;const l=new Set(o);return l.delete(r),l}),El(o=>{if(!o[r])return o;const{[r]:l,...u}=o;return u}),Ic(o=>{if(!o.has(r))return o;const l=new Set(o);return l.delete(r),l}),Il(o=>{if(!o[r])return o;const{[r]:l,...u}=o;return u}))},[]),Wj=M.useCallback(r=>{r&&lj(o=>{const l=new Set(o);return l.has(r)?l.delete(r):l.add(r),l})},[]),Cf=(r,o)=>kr(l=>l.map(u=>u._uid===r?{...u,...o}:u)),Kj=r=>{kr(o=>o.filter(l=>l._uid!==r)),cy(o=>{const l=new Set(o);return l.delete(r),l})},Jj=async r=>{const o=sr(r),l=(o==null?void 0:o._uid)||r;lm(l),cu(f=>({...f,[l]:"idle"}));const{key:u,url:p}=wi(r);if(!u){cu(f=>({...f,[l]:"error"})),lm(null);return}try{(await fetch(`${p}/v1/models`,{method:"GET",headers:{Authorization:`Bearer ${u}`}})).ok?cu(m=>({...m,[l]:"success"})):cu(m=>({...m,[l]:"error"}))}catch{cu(f=>({...f,[l]:"error"}))}lm(null)},uo=r=>{if(!r)return"bg-zinc-600";const o=cm[r];if(o==="success")return"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.8)]";if(o==="error")return"bg-red-500";const{key:l}=wi(r);return l?"bg-zinc-400":"bg-zinc-700"},Jc=M.useMemo(()=>Jn.find(r=>r.id===$a)||Jn[0],[Jn,$a]),qj=()=>{var r;(r=Iy.current)==null||r.scrollIntoView({behavior:"smooth"})};M.useEffect(()=>{qj()},[Jc==null?void 0:Jc.messages,Yd]);const Gj=()=>{const r=`chat-${Date.now()}`,o={id:r,title:j(""),messages:[]};Pa(l=>[o,...l]),wc(r)},Yj=(r,o)=>{r.stopPropagation();const l=Jn.filter(u=>u.id!==o);if(l.length===0){const u={id:"default",title:j(""),messages:[]};Pa([u]),wc("default")}else Pa(l),$a===o&&wc(l[0].id)},Xy=M.useCallback(r=>{Array.from(r||[]).forEach(l=>{const u=new FileReader;u.onload=p=>{var I;const f=p.target.result,m=((I=l.name.split(".").pop())==null?void 0:I.toLowerCase())||"",y=l.type.startsWith("image/"),b=l.type.startsWith("video/"),w=l.type.startsWith("audio/"),v=l.type==="application/pdf"||m==="pdf",z=["doc","docx"].includes(m)||l.type.includes("word"),k=["xls","xlsx"].includes(m)||l.type.includes("excel")||l.type.includes("spreadsheet"),T=["js","jsx","ts","tsx","py","java","cpp","c","html","css","json","xml","yaml","yml","md","txt","sh","bash"].includes(m);Ui(F=>[...F,{name:l.name,type:l.type,content:f,isImage:y,isVideo:b,isAudio:w,isPDF:v,isDoc:z,isExcel:k,isCode:T,fileExt:m}])},l.type.startsWith("image/")||l.type.startsWith("video/")||l.type.startsWith("audio/")||l.type==="application/pdf"?u.readAsDataURL(l):l.name.match(/\.(txt|md|js|jsx|ts|tsx|py|html|css|json|csv|xml|yaml|yml|sh|bash|java|cpp|c)$/i)?u.readAsText(l):u.readAsDataURL(l)})},[Ui]),Xj=r=>{Xy(r.target.files),r.target.value=""},Zj=r=>{Ui(o=>o.filter((l,u)=>u!==r))},Qj=r=>{if(!r||typeof r!="string")return[];const o=new Set;return(r.match(/!\[[^\]]*]\(([^)]+)\)/g)||[]).forEach(f=>{const m=f.match(/\(([^)]+)\)/);m!=null&&m[1]&&o.add(m[1].trim())}),(r.match(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g)||[]).forEach(f=>o.add(f)),(r.match(/https?:\/\/[^\s)]+/g)||[]).forEach(f=>{const m=f.replace(/[),.]+$/,"");m.match(/\.(png|jpg|jpeg|webp|gif|bmp|svg)(\?|#|$)/i)&&o.add(m)}),Array.from(o)},Zy=(r,o)=>{var m,y,b,w,v,z,k;const l=new Set,u=(T,I="image/png")=>{if(T){if(typeof T=="string"){const F=T.trim();if(!F)return;if(F.startsWith("data:image/")){l.add(F);return}if(F.startsWith("http://")||F.startsWith("https://")){l.add(F);return}if(/^[A-Za-z0-9+/=]+$/.test(F)&&F.length>64){const U=Fa(F,I);l.add(`data:${U};base64,${F}`)}return}if(typeof T=="object"){const F=T.url||T.image_url||T.imageUrl||T.file_uri||T.fileUri||T.uri;if(F){l.add(F);return}const B=T.data||T.base64||T.b64;if(B){const U=Fa(B,T.mime_type||T.mimeType||I);l.add(`data:${U};base64,${B}`)}}}};return[(y=(m=r==null?void 0:r.choices)==null?void 0:m[0])==null?void 0:y.message,(v=(w=(b=r==null?void 0:r.data)==null?void 0:b.choices)==null?void 0:w[0])==null?void 0:v.message].forEach(T=>{if(!T)return;const I=T.content;Array.isArray(I)&&I.forEach(F=>{var B;if(F&&(F.type==="image_url"&&u(((B=F.image_url)==null?void 0:B.url)||F.image_url||F.imageUrl),F.type==="image"&&u(F.image||F.image_url||F.imageUrl),F.inline_data||F.inlineData)){const U=F.inline_data||F.inlineData;U!=null&&U.data&&u(U.data,U.mime_type||U.mimeType||"image/png")}})}),[r==null?void 0:r.images,r==null?void 0:r.output_images,(z=r==null?void 0:r.data)==null?void 0:z.output_images,(k=r==null?void 0:r.data)==null?void 0:k.images].forEach(T=>{Array.isArray(T)&&T.forEach(I=>u((I==null?void 0:I.url)||(I==null?void 0:I.image_url)||(I==null?void 0:I.imageUrl)||I))}),Qj(o).forEach(T=>l.add(T)),Array.from(l)},Qy=async()=>{var T,I,F,B,U,W,X,J,Y,ne,ie;if(!zc.trim()&&kc.length===0||Yp)return;const r=sr(ni),{key:o,url:l,modelName:u}=wi(ni);if(!o){alert(j(" API  Key")),bi(!0);return}const p=$a||((T=Jn[0])==null?void 0:T.id),f=Jn.find(Z=>Z.id===p)||Jn[0],m=(f==null?void 0:f.messages)||[];f&&f.id!==$a&&wc(f.id),Zb(!0);const y={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:"user",content:zc,files:[...kc],timestamp:Date.now(),modelId:ni};Pa(Z=>Z.map(te=>te.id===p?{...te,messages:[...te.messages,y],title:te.messages.length===0?zc.slice(0,20):te.title}:te)),B0(""),Ui([]);const b=[...m,y],w=20,v=b.length>w?b.slice(-w):b;let z=[{role:"system",content:j("AI")},...v.map(Z=>({role:Z.role,content:Z.content}))];const k=[];y.content&&k.push({type:"text",text:y.content}),y.files.forEach(Z=>{const te=((r==null?void 0:r.modelName)??"").toLowerCase().includes("gemini");Z.isImage?k.push({type:"image_url",image_url:{url:Z.content}}):Z.isVideo?te?k.push({type:"image_url",image_url:{url:Z.content}}):k.push({type:"text",text:`
[User attached video: ${Z.name}]
`}):Z.isAudio?k.push({type:"text",text:`
[User attached audio: ${Z.name}]
`}):Z.isPDF||Z.isDoc||Z.isExcel?k.push({type:"text",text:`
[User attached document: ${Z.name} (${Z.isPDF?"PDF":Z.isDoc?"Word":"Excel"})]
`}):Z.isCode||Z.content&&typeof Z.content=="string"&&Z.content.length<5e4?k.push({type:"text",text:`
[File: ${Z.name}]
\`\`\`${Z.fileExt||"text"}
${Z.content}
\`\`\`
`}):k.push({type:"text",text:`
[User attached file: ${Z.name}]
`})}),z.push({role:"user",content:k});try{const Z=await fetch(`${l}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({model:u||ni,messages:z,stream:!1})});if(!Z.ok){const Le=await Z.text();throw new Error(Le||`API Error: ${Z.status}`)}const te=await Z.json();let pe=null;const Te=((F=(I=te==null?void 0:te.choices)==null?void 0:I[0])==null?void 0:F.message)||((W=(U=(B=te==null?void 0:te.data)==null?void 0:B.choices)==null?void 0:U[0])==null?void 0:W.message);(Te==null?void 0:Te.content)!==void 0?Array.isArray(Te.content)?pe=Te.content.map(Le=>typeof(Le==null?void 0:Le.text)=="string"?Le.text:"").filter(Boolean).join(`
`):pe=Te.content:te.content?pe=te.content:te.text?pe=te.text:te.message?pe=typeof te.message=="string"?te.message:te.message.content:te.result?pe=typeof te.result=="string"?te.result:te.result.content:(X=te.data)!=null&&X.content?pe=te.data.content:(J=te.data)!=null&&J.text?pe=te.data.text:(Y=te.data)!=null&&Y.message?pe=typeof te.data.message=="string"?te.data.message:te.data.message.content:(ne=te.data)!=null&&ne.result&&(pe=typeof te.data.result=="string"?te.data.result:te.data.result.content),pe&&typeof pe!="string"&&(pe=JSON.stringify(pe)),(!pe||pe.trim()==="")&&(console.error("[] API :",te),pe="No response");const Qe={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:"assistant",content:pe,timestamp:Date.now(),modelId:ni};Pa(Le=>Le.map(it=>it.id===$a?{...it,messages:[...it.messages,Qe]}:it));const Be=Zy(te,pe);if(Be.length>0){const Le=Date.now(),it=Be[0],ut=(r==null?void 0:r.displayName)||u||ni,xt=typeof(r==null?void 0:r.useProxy)=="boolean"?r.useProxy:!!(r!=null&&r.provider&&((ie=Ft==null?void 0:Ft[r.provider])!=null&&ie.useProxy));Rt(Zt=>[{id:`chat-${Le}-${Math.random().toString(36).slice(2,8)}`,type:"image",url:it,prompt:y.content||"Chat Image",time:new Date(Le).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"completed",progress:100,modelName:ut,apiConfig:{modelId:ni,baseUrl:l,apiKey:o,provider:r==null?void 0:r.provider,useProxy:xt},provider:r==null?void 0:r.provider,useProxy:xt,startTime:Le,durationMs:0,output_images:Be,mjImages:Be.length>1?Be:null,selectedMjImageIndex:0},...Zt])}}catch(Z){console.error("Chat Error",Z);const te={id:`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,role:"assistant",content:`Error: ${Z.message}`,isError:!0,timestamp:Date.now()};Pa(pe=>pe.map(Te=>Te.id===$a?{...Te,messages:[...Te.messages,te]}:Te))}finally{Zb(!1)}},ev=async(r,o=2048,l=8)=>new Promise((u,p)=>{const f=new Image;f.crossOrigin="anonymous",f.onload=()=>{var B,U;const m=f.width,y=f.height;let b=m,w=y;if(m>o||y>o){const W=o/Math.max(m,y);b=Math.floor(m*W),w=Math.floor(y*W)}const v=document.createElement("canvas");v.width=b,v.height=w;const z=v.getContext("2d");z.imageSmoothingEnabled=!0,z.imageSmoothingQuality="high",z.drawImage(f,0,0,b,w);let k=.92,T=v.toDataURL("image/jpeg",k);(((B=T.split(",")[1])==null?void 0:B.length)||0)*3/4/(1024*1024)>l&&(k=.75,T=v.toDataURL("image/jpeg",k),(U=T.split(",")[1])!=null&&U.length),u(T)},f.onerror=m=>{console.error("Midjourney: ",m),u(r)},f.src=r}),eN=async(r,o,l)=>{try{const p=(await Promise.all(r.map(async(v,z)=>{if(v.startsWith("data:"))try{return await ev(v,2048,8)}catch(k){return console.error(`Midjourney: [${z}]`,k),v}else try{const k=Gn(v,!1),T=await Un(v,{useProxy:k}),I=await Eo(T);return await ev(I,2048,8)}catch(k){throw console.error(`Midjourney: [${z}]URL`,k),k}}))).map((v,z)=>{let k=v;if(typeof k!="string")throw new Error(`base64[${z}]`);k.includes(",")?k=k.split(",")[1]:k.startsWith("data:")&&(k=k.replace(/^data:[^;]*;base64,?/i,""));const T=k.length;k=k.replace(/[^A-Za-z0-9+/=]/g,"");const I=k.length;if(!k||k.length<100)throw new Error(`base64[${z}]: ${(k==null?void 0:k.length)||0}`);const F=/^[A-Za-z0-9+/]+={0,2}$/;if(!F.test(k))throw console.error(`Midjourney: base64[${z}]: ${k.length}, 50: ${k.substring(0,50)}`),new Error(`invalid_base64_format: base64[${z}]`);const B=k.length%4;if(B!==0&&(k=k.replace(/=+$/,""),k+="=".repeat(4-B),!F.test(k)))throw console.error(`Midjourney: base64[${z}]: ${k.length}`),new Error(`invalid_base64_format: base64[${z}]`);try{const W=atob(k);if(!W||W.length===0)throw new Error("base64")}catch(W){throw console.error(`Midjourney: base64[${z}]:`,W),new Error(`invalid_base64_format: base64[${z}]`)}return`data:image/jpeg;base64,${k}`}),f=`${o}/mj/submit/upload-discord-images`;p.forEach((v,z)=>{if(!v||typeof v!="string")throw new Error(`base64[${z}]`);if(!v.startsWith("data:image/"))throw new Error(`base64[${z}]data URL`);let k="";if(v.includes(","))k=v.split(",")[1];else throw new Error(`base64[${z}]data URL`);if(!k||k.length<100)throw new Error(`base64[${z}]`);if(!/^[A-Za-z0-9+/]+={0,2}$/.test(k))throw console.error(`Midjourney: base64[${z}]`),new Error(`base64[${z}]`);if(k.length%4!==0)throw new Error(`base64[${z}]4: ${k.length}`);try{atob(k)}catch(I){throw new Error(`base64[${z}]: ${I.message}`)}});const y=JSON.stringify({base64Array:p}),b=await fetch(f,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:y});if(!b.ok){let v="";try{v=await b.text();try{const z=JSON.parse(v);throw new Error(`: ${b.status} - ${z.description||z.message||v}`)}catch{throw new Error(`: ${b.status} - ${v}`)}}catch(z){throw new Error(`: ${b.status} - ${z.message||v}`)}}const w=await b.json();if(w.code===1&&w.result&&Array.isArray(w.result))return w.result;{const v=w.description||w.message||"";throw console.error("Midjourney: :",w),new Error(v)}}catch(u){throw console.error("Midjourney: :",u),u}},Cm=async(r,o=1920,l=1920)=>new Promise((u,p)=>{const f=new Image;if(f.crossOrigin="anonymous",f.onload=()=>{const m=f.width,y=f.height;if(m<=o&&y<=l){r.startsWith("data:")?u(r):In(r).then(T=>{u(`data:image/png;base64,${T}`)}).catch(p);return}let b=m,w=y;if(m>o||y>l){const T=Math.min(o/m,l/y);b=Math.round(m*T),w=Math.round(y*T),b=b%2===0?b:b-1,w=w%2===0?w:w-1}const v=document.createElement("canvas");v.width=b,v.height=w;const z=v.getContext("2d");z.imageSmoothingEnabled=!0,z.imageSmoothingQuality="high",z.drawImage(f,0,0,b,w);const k=v.toDataURL("image/png",.95);u(k)},f.onerror=m=>{console.error("Veo: ",m),p(new Error(""))},r.startsWith("data:"))f.src=r;else if(r.startsWith("blob:"))f.src=r;else{const m=Gn(r,!1);Un(r,{useProxy:m}).then(y=>{const b=URL.createObjectURL(y);f.src=b}).catch(p)}}),Em=M.useCallback(r=>{C(o=>o.filter(u=>u.id!==r))},[]),Ja=(r,o)=>r?as.isImageId(r)||r.startsWith("asset://")||r.startsWith("blob:")?r:o==="video"&&!ur(r)?r+(r.includes("?")?"&":"?")+"force_video_display=true":r:"",qa=r=>{const o=r.dataTransfer.getData("application/x-tapnow-history");if(!o)return null;try{return JSON.parse(o)}catch(l){return console.warn("[Drag] Failed to parse history payload",l),null}},tN=M.useCallback(r=>{if(!r)return;const{_uid:o,key:l,url:u,isCustom:p,...f}=r,m={...f},y=m.id||m.modelName||"model",b=String(y).replace(/[^\w.-]+/g,"_"),w=new Blob([JSON.stringify(m,null,2)],{type:"application/json"}),v=`tapnow-model-${b}.json`,z=document.createElement("a");z.href=URL.createObjectURL(w),z.download=v,z.click(),URL.revokeObjectURL(z.href)},[]),rN=M.useCallback(r=>{if(!r)return;const o=Kw(r);if(!o)return;const l=String(o.id||"model").replace(/[^\w.-]+/g,"_"),u=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),p=`tapnow-model-library-${l}.json`,f=document.createElement("a");f.href=URL.createObjectURL(u),f.download=p,f.click(),URL.revokeObjectURL(f.href),d("","success",2e3)},[d]),nN=M.useCallback(r=>{const o=document.createElement("input");o.type="file",o.accept=".json",o.onchange=async l=>{var p;const u=(p=l.target.files)==null?void 0:p[0];if(u)try{const f=await u.text(),m=JSON.parse(f),b=(Array.isArray(m)?m:Array.isArray(m==null?void 0:m.models)?m.models:[m]).map(w=>{if(!w||typeof w!="object")return null;const v={...w};delete v._uid,delete v.key,delete v.url,delete v.isCustom;const z=v.id||v.modelName;return z?{...v,id:z,provider:r||v.provider,type:v.type||"Chat",modelName:v.modelName||z,displayName:v.displayName||v.modelName||z,customParams:da(v.customParams),_uid:`uid-${Date.now()}-${Math.random().toString(36).slice(2,9)}`}:null}).filter(Boolean);if(b.length===0){d("","warning",2e3);return}kr(w=>[...w,...b]),d(` ${b.length} `,"success",3e3)}catch(f){d(`: ${f.message}`,"error",3e3)}},o.click()},[d]),sN=M.useCallback(()=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async o=>{var u;const l=(u=o.target.files)==null?void 0:u[0];if(l)try{const p=await l.text(),f=JSON.parse(p),y=(Array.isArray(f)?f:Array.isArray(f==null?void 0:f.modelLibrary)?f.modelLibrary:[f]).map((b,w)=>Kw(b,w)).filter(Boolean);if(y.length===0){d("","warning",2e3);return}ke(b=>{const w=new Set(b.map(z=>z.id)),v=[...b];return y.forEach(z=>{let k=z.id;w.has(k)&&(k=`${k}-${Math.random().toString(36).slice(2,6)}`),w.add(k),v.push({...z,id:k})}),v}),d("","success",2e3)}catch{d("JSON ","error",2e3)}},r.click()},[d]),Ef=M.useCallback((r,o=null)=>{if(!r)return"";const l=o||r.url||r.originalUrl||r.mjOriginalUrl||"";if(!l)return"";const u=r.itemId?co.get(r.itemId):null;return u?Ar(u,l):l},[co,Ar]),iN=M.useCallback(r=>{if(!r||!Array.isArray(r.mjImages)||r.mjImages.length===0)return null;const o=r.itemId?co.get(r.itemId):null;return o?r.mjImages.map(l=>Ar(o,l)):r.mjImages},[co,Ar]),Ga=r=>{const l=(r.dataTransfer.getData("text/uri-list")||"").split(`
`).find(f=>f&&!f.startsWith("#"))||"",u=r.dataTransfer.getData("text/plain")||"",p=(l||u).trim();return p&&/^(https?:|data:image\/|data:video\/|blob:|file:)/i.test(p)?p:""},oN=async(r,o)=>{o.preventDefault(),o.stopPropagation(),o.currentTarget.classList.remove("drag-over");const l=qa(o);if(l){const m=Ja(Ef(l),l.type);if(m){const y=l.type==="video"||ur(m);let b=null;if(!y)try{const w=await Xo(m);b=await os(w)}catch{}Ge(),x(w=>w.map(v=>v.id===r?{...v,content:m,dimensions:y?null:b}:v));return}}const u=Ga(o);if(u){const m=ur(u);let y=null;if(!m)try{const b=await Xo(u);y=await os(b)}catch{}Ge(),x(b=>b.map(w=>w.id===r?{...w,content:u,dimensions:m?null:y}:w));return}const f=Array.from(o.dataTransfer.files).filter(m=>m.type.startsWith("image/"));if(f.length>0){const m=f[0],y=new FileReader;y.onload=async b=>{const w=b.target.result;let v={w:0,h:0};try{v=await os(w)}catch{}Ge(),x(z=>z.map(k=>k.id===r?{...k,content:w,dimensions:v}:k))},y.readAsDataURL(m)}},tv=M.useCallback(async(r,o)=>{var f;const l=Xt.get(r);if(!l)return;const u=Array.from(o||[]).filter(m=>m.type.startsWith("image/"));if(u.length===0)return;const p=await Promise.all(u.map(m=>new Promise(y=>{const b=new FileReader;b.onloadend=()=>y(b.result),b.readAsDataURL(m)})));Je(r,{referenceImages:[...((f=l.settings)==null?void 0:f.referenceImages)||[],...p]})},[Xt,Je]),aN=(r,o)=>{var l,u;o.preventDefault(),o.stopPropagation(),o.currentTarget.classList.remove("drag-over"),(u=(l=o.dataTransfer)==null?void 0:l.files)!=null&&u.length&&tv(r,o.dataTransfer.files)},rv=(r,o)=>{const l=o.target.files;l&&l.length>0&&tv(r,l),o.target.value=""},Im=r=>{r.preventDefault(),r.stopPropagation(),r.currentTarget.classList.add("drag-over")},Pm=r=>{r.preventDefault(),r.stopPropagation(),r.currentTarget.classList.remove("drag-over")},lN=(r,o)=>{o.preventDefault(),o.stopPropagation();const l=qa(o);let u="",p=null,f="image";if(l){if(u=Ja(Ef(l),l.type),l.mjImages&&l.mjImages.length>1){p=iN(l);const m=l.selectedIndex??0;u=(p&&p[m]?p[m]:p?p[0]:"")||u}(l.type==="video"||ur(u))&&(f="video")}if(!u){const m=Ga(o);m&&(u=m,f=ur(m)?"video":"image")}u&&x(m=>m.map(y=>y.id===r?{...y,content:u,previewType:f,previewMjImages:p}:y))},Ol=r=>{r.preventDefault(),r.stopPropagation()},cN=async r=>{if(r.preventDefault(),r.stopPropagation(),r.currentTarget.id!=="canvas-bg")return;const o=qa(r);let l="",u=!1;if(o&&(l=Ja(Ef(o),o.type),u=o.type==="video"||ur(l)),!l){const m=Ga(r);m&&(l=m,u=ur(m))}if(!l)return;const p=Hr(r.clientX,r.clientY);if(u){is("video-input",p.x,p.y,null,l);return}let f;try{const m=await os(l);m!=null&&m.w&&(m!=null&&m.h)&&(f={w:m.w,h:m.h})}catch{}is("input-image",p.x,p.y,null,l,f)},dN=r=>{var u,p;r.preventDefault(),r.stopPropagation();const o=qa(r);if(o){const f=Ja(Ef(o),o.type);if(f){const m=o.type==="video"||ur(f),y=!m,b=y?"png":"mp4",w=y?"image/png":"video/mp4";Ui(v=>[...v,{name:`Generated-${o.itemId||Date.now()}.${b}`,type:w,content:f,isImage:y,isVideo:m,isAudio:!1,fromHistory:!0,fileExt:b}]),So(!0)}return}const l=Ga(r);if(l){const f=ur(l),m=!f,y=m?"png":"mp4",b=m?"image/png":"video/mp4";Ui(w=>[...w,{name:`Dropped-${Date.now()}.${y}`,type:b,content:l,isImage:m,isVideo:f,isAudio:!1,fromHistory:!1,fileExt:y}]),So(!0);return}(p=(u=r.dataTransfer)==null?void 0:u.files)!=null&&p.length&&(Xy(r.dataTransfer.files),So(!0))};M.useEffect(()=>{const r=async u=>{const p=u.target;if(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable){const w=window.getSelection();if(w&&w.toString().trim())return;u.preventDefault();return}const m=Po.current,y=vi.current,b=m?[m]:y&&y.size>0?Array.from(y):[];if(b.length>0){u.preventDefault(),u.stopPropagation();const w=qs.current.filter(k=>b.includes(k.id)),z=Bc.current.filter(k=>b.includes(k.from)||b.includes(k.to)).filter(k=>b.includes(k.from)&&b.includes(k.to));na.current={nodes:w.map(k=>({...k})),connections:z.map(k=>({...k})),timestamp:Date.now()}}},o=async u=>{const p=u.target;if(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable)return;const m=Po.current;let y=null;if(m&&(y=qs.current.find(b=>b.id===m)),y&&(y.type==="input-image"||y.type==="video-input")){const b=Array.from(u.clipboardData.items),w=b.find(z=>z.type.startsWith("image/")),v=b.find(z=>z.type.startsWith("video/"));if(w&&y.type==="input-image"){u.preventDefault();const z=w.getAsFile();if(z){const k=new FileReader;k.onload=async T=>{const I=T.target.result;let F={w:0,h:0};try{F=await os(I)}catch{}Ge(),x(B=>B.map(U=>U.id===y.id?{...U,content:I,dimensions:F}:U))},k.readAsDataURL(z)}return}else if(v&&y.type==="video-input"){u.preventDefault();const z=v.getAsFile();z&&Vc(y.id,z);return}}if(na.current&&na.current.nodes&&na.current.nodes.length>0){u.preventDefault(),u.stopPropagation();const b=na.current,w=Io.current;let v=0,z=0;if(w){const te=w.getBoundingClientRect(),pe=(te.left+te.width/2-E.x)/E.zoom,Te=(te.top+te.height/2-E.y)/E.zoom;v=pe,z=Te}const k=b.nodes;if(k.length===0)return;const T=Math.min(...k.map(te=>te.x||0)),I=Math.min(...k.map(te=>te.y||0)),F=Math.max(...k.map(te=>(te.x||0)+(te.width||0))),B=Math.max(...k.map(te=>(te.y||0)+(te.height||0))),U=(T+F)/2,W=(I+B)/2,X=v-U,J=z-W,Y=new Map,ne=Date.now();b.nodes.forEach((te,pe)=>{const Te=`node-${ne}-${pe}-${Math.random().toString(36).substr(2,9)}`;Y.set(te.id,Te)});const ie=b.nodes.map(te=>({...te,id:Y.get(te.id),x:te.x+X,y:te.y+J})),Z=(b.connections||[]).filter(te=>te&&Y.has(te.from)&&Y.has(te.to)).map((te,pe)=>({...te,id:`conn-${ne}-${pe}-${Math.random().toString(36).substr(2,9)}`,from:Y.get(te.from),to:Y.get(te.to)}));Ge(),x(te=>[...te,...ie]),C(te=>[...te,...Z]),ie.length===1?(le(ie[0].id),ss(new Set([ie[0].id]))):ie.length>1&&(le(null),ss(new Set(ie.map(te=>te.id))))}},l=u=>{const p=u.target;if(!(p.tagName==="INPUT"||p.tagName==="TEXTAREA"||p.isContentEditable)&&(u.ctrlKey||u.metaKey)&&u.key==="v"){const m=Po.current;if(m){const y=qs.current.find(b=>b.id===m);if(y&&(y.type==="input-image"||y.type==="video-input"))return}if(na.current&&na.current.nodes&&na.current.nodes.length>0){u.preventDefault(),u.stopPropagation();const y=na.current,b=Io.current;let w=0,v=0;if(b){const Z=b.getBoundingClientRect(),te=(Z.left+Z.width/2-E.x)/E.zoom,pe=(Z.top+Z.height/2-E.y)/E.zoom;w=te,v=pe}const z=y.nodes;if(z.length===0)return;const k=Math.min(...z.map(Z=>Z.x||0)),T=Math.min(...z.map(Z=>Z.y||0)),I=Math.max(...z.map(Z=>(Z.x||0)+(Z.width||0))),F=Math.max(...z.map(Z=>(Z.y||0)+(Z.height||0))),B=(k+I)/2,U=(T+F)/2,W=w-B,X=v-U,J=new Map,Y=Date.now();y.nodes.forEach((Z,te)=>{const pe=`node-${Y}-${te}-${Math.random().toString(36).substr(2,9)}`;J.set(Z.id,pe)});const ne=y.nodes.map(Z=>({...Z,id:J.get(Z.id),x:Z.x+W,y:Z.y+X})),ie=(y.connections||[]).filter(Z=>Z&&J.has(Z.from)&&J.has(Z.to)).map((Z,te)=>({...Z,id:`conn-${Y}-${te}-${Math.random().toString(36).substr(2,9)}`,from:J.get(Z.from),to:J.get(Z.to)}));Ge(),x(Z=>[...Z,...ne]),C(Z=>[...Z,...ie]),ne.length===1?(le(ne[0].id),ss(new Set([ne[0].id]))):ne.length>1&&(le(null),ss(new Set(ne.map(Z=>Z.id))))}}};return window.addEventListener("copy",r),window.addEventListener("paste",o),window.addEventListener("keydown",l),()=>{window.removeEventListener("copy",r),window.removeEventListener("paste",o),window.removeEventListener("keydown",l)}},[Je,Vc,x,C,le,ss,E]);const Ya=async(r,o,l,u,p,f,m=0)=>{if(m>90){Rt(v=>v.map(z=>z.id===o?{...z,status:"failed",errorMsg:"Veo "}:z));const w=tn.current.get(o);w&&(ar(w.nodeId,w.shotId,{status:"draft"}),tn.current.delete(o));return}fetch(`${l}/v2/videos/generations/${r}`,{method:"GET",headers:{Authorization:`Bearer ${u}`}}).then(async w=>{var B,U,W,X,J,Y,ne,ie;const v=await w.text();let z;try{z=JSON.parse(v)}catch{setTimeout(()=>Ya(r,o,l,u,p,f,m+1),4e3);return}const k=((B=z==null?void 0:z.data)==null?void 0:B.status)||(z==null?void 0:z.status)||((U=z==null?void 0:z.data)==null?void 0:U.task_status),T=((W=z==null?void 0:z.data)==null?void 0:W.progress)||(z==null?void 0:z.progress)||"0%",I=((X=z==null?void 0:z.data)==null?void 0:X.fail_reason)||(z==null?void 0:z.fail_reason)||"";if(k==="SUCCESS"||k==="succeeded"||k==="FINISHED"||k==="completed"){const Z=((J=z==null?void 0:z.data)==null?void 0:J.output)||(z==null?void 0:z.output)||((Y=z==null?void 0:z.data)==null?void 0:Y.video_url)||(z==null?void 0:z.video_url)||((ie=(ne=z==null?void 0:z.data)==null?void 0:ne.data)==null?void 0:ie.output);if(!Z){console.warn("[Tapnow] Veo: URL",z),Rt(pe=>pe.map(Te=>Te.id===o?{...Te,status:"failed",errorMsg:"URL"}:Te));return}const te=Date.now();Rt(pe=>{const Te=pe.find(xt=>xt.id===o),Qe=Te==null?void 0:Te.sourceNodeId,Be=Te==null?void 0:Te.ratio,Le=te-((Te==null?void 0:Te.startTime)||te);let it=p,ut=f;return(async()=>{try{const xt=await id(Z);if(xt&&xt.w>0&&xt.h>0){const Zt=xt.w,Nt=xt.h;if(Be==="16:9"){const er=Zt/Nt,pr=16/9;Math.abs(er-pr)>.1?(console.warn(`[Tapnow] Veo:  ${er.toFixed(2)}  16:9 (${pr.toFixed(2)})`),console.warn(`[Tapnow] Veo: : ${Zt}x${Nt}, : 16:9`),console.warn(`[Tapnow] Veo:  16:9 : ${p}x${Math.round(p/(16/9))}`),it=p,ut=Math.round(p/(16/9))):(it=Zt,ut=Nt)}else if(Be==="9:16"){const er=Zt/Nt,pr=9/16;Math.abs(er-pr)>.1?(console.warn(`[Tapnow] Veo:  ${er.toFixed(2)}  9:16 (${pr.toFixed(2)})`),console.warn(`[Tapnow] Veo: : ${Zt}x${Nt}, : 9:16`),console.warn(`[Tapnow] Veo:  9:16 : ${Math.round(f*(9/16))}x${f}`),it=Math.round(f*(9/16)),ut=f):(it=Zt,ut=Nt)}else it=Zt,ut=Nt;Rt(er=>er.map(pr=>pr.id===o?{...pr,status:"completed",progress:100,url:Z,width:it,height:ut,durationMs:Le,ratio:Be||pr.ratio}:pr));const Ot=tn.current.get(o);Ot?(ar(Ot.nodeId,Ot.shotId,{video_url:Z,status:"done",durationCost:Le/1e3}),tn.current.delete(o)):Qe&&setTimeout(()=>{Ki(o,Z,"video",Qe)},0)}}catch(xt){console.warn("[Tapnow] Veo: ",xt);let Zt=p,Nt=f;if(Be==="16:9"){const er=Zt/Nt;Math.abs(er-16/9)>.1&&(Nt=Math.round(Zt/(16/9)))}else if(Be==="9:16"){const er=Zt/Nt;Math.abs(er-9/16)>.1&&(Zt=Math.round(Nt*(9/16)))}Rt(er=>er.map(pr=>pr.id===o?{...pr,status:"completed",progress:100,url:Z,width:Zt,height:Nt,durationMs:Le,ratio:Be||pr.ratio}:pr));const Ot=tn.current.get(o);Ot?(ar(Ot.nodeId,Ot.shotId,{video_url:Z,status:"done",durationCost:Le/1e3}),tn.current.delete(o)):Qe&&setTimeout(()=>{Ki(o,Z,"video",Qe)},0)}})(),pe});return}if(k==="FAILED"||k==="ERROR"||k==="CANCELLED"){let Z=`: ${k}`;if(I)try{const pe=typeof I=="string"?JSON.parse(I):I;Z=(pe==null?void 0:pe.message)||(pe==null?void 0:pe.code)||I}catch{Z=I||Z}console.error("[Tapnow] Veo: ",{status:k,failReason:I,errorMsg:Z}),Rt(pe=>pe.map(Te=>Te.id===o?{...Te,status:"failed",errorMsg:Z}:Te));const te=tn.current.get(o);if(te){const pe=co.get(o),Te=pe?Date.now()-pe.startTime:0;ar(te.nodeId,te.shotId,{status:"failed",errorMsg:Z,durationCost:Te/1e3}),tn.current.delete(o)}return}if(k==="NOT_START"||k==="PENDING"||k==="QUEUED"){const Z=parseInt(T)||0;Rt(te=>te.map(pe=>pe.id===o?{...pe,status:"generating",progress:Math.max(5,Z),errorMsg:k==="NOT_START"?"...":void 0}:pe)),setTimeout(()=>Ya(r,o,l,u,p,f,m+1),4e3);return}const F=parseInt(T)||Math.min(95,m*2+10);Rt(Z=>Z.map(te=>te.id===o?{...te,status:"generating",progress:F}:te)),setTimeout(()=>Ya(r,o,l,u,p,f,m+1),4e3)}).catch(w=>setTimeout(()=>Ya(r,o,l,u,p,f,m+1),4e3))},Ll=(r,o,l,u,p,f,m="",y=0)=>{if(!r||r==="null"||r==="undefined"){console.error(`[Poll Error] Invalid JobId: ${r} for task ${o}`),Rt(z=>z.map(k=>k.id===o?{...k,status:"failed",errorMsg:"Task failed: No Job ID returned",durationMs:Date.now()-(k.startTime||Date.now())}:k));return}const b=m==="sora-2-pro"?360:80,w=5e3;if(y>b){Rt(k=>k.map(T=>T.id===o?{...T,status:"failed",errorMsg:"Sora "}:T));const z=tn.current.get(o);z&&(ar(z.nodeId,z.shotId,{status:"draft"}),tn.current.delete(o));return}const v=m!=null&&m.includes("grok")?`${l}/v2/videos/generations/${encodeURIComponent(r)}`:`${l}/v1/videos/${encodeURIComponent(r)}`;fetch(v,{method:"GET",headers:{Authorization:`Bearer ${u}`}}).then(z=>{if(!z.ok)throw new Error(`HTTP ${z.status}: ${z.statusText}`);return z.text()}).then(z=>{var I,F,B,U,W;let k;try{k=JSON.parse(z)}catch(X){console.error("[Tapnow] Sora/Grok Poll JSON :",X,z),setTimeout(()=>Ll(r,o,l,u,p,f,m,y+1),w);return}const T=((I=k==null?void 0:k.data)==null?void 0:I.status)||(k==null?void 0:k.status)||((F=k==null?void 0:k.data)==null?void 0:F.task_status)||(k==null?void 0:k.task_status);if(T==="SUCCESS"||T==="succeeded"||T==="FINISHED"||T==="completed"){const X=((B=k==null?void 0:k.data)==null?void 0:B.output)||(k==null?void 0:k.output)||((U=k==null?void 0:k.data)==null?void 0:U.video_url)||((W=k==null?void 0:k.data)==null?void 0:W.url)||(k==null?void 0:k.video_url)||(k==null?void 0:k.url);if(!X){Rt(ie=>ie.map(Z=>Z.id===o?{...Z,status:"failed",errorMsg:"URL"}:Z));return}const J=Date.now(),Y=co.get(o);Y==null||Y.sourceNodeId;const ne=J-((Y==null?void 0:Y.startTime)||J);Rt(ie=>{const Z=ie.map(pe=>pe.id===o?{...pe,status:"completed",progress:100,url:X,width:p,height:f,durationMs:ne}:pe),te=tn.current.get(o);if(te)ar(te.nodeId,te.shotId,{video_url:X,status:"done",durationCost:ne/1e3}),tn.current.delete(o);else{const pe=Z.find(Te=>Te.id===o);pe!=null&&pe.sourceNodeId?setTimeout(()=>{Ki(o,X,"video",pe.sourceNodeId)},0):console.warn("[Tapnow] Sora:  sourceNodeId",{taskId:o,updatedItem:pe})}return Z});return}if(T==="FAILED"||T==="ERROR"||T==="CANCELLED"){Rt(ie=>ie.map(Z=>Z.id===o?{...Z,status:"failed",errorMsg:`: ${T}`}:Z));const X=Date.now(),J=co.get(o),Y=X-((J==null?void 0:J.startTime)||X),ne=tn.current.get(o);ne&&(ar(ne.nodeId,ne.shotId,{status:"failed",errorMsg:`: ${T}`,durationCost:Y/1e3}),tn.current.delete(o));return}Rt(X=>X.map(J=>J.id===o?{...J,status:"generating",progress:Math.min(95,(J.progress||10)+2)}:J)),setTimeout(()=>Ll(r,o,l,u,p,f,m,y+1),w)}).catch(z=>{console.error("[Tapnow] Sora/Grok Poll :",z),y<b-5?setTimeout(()=>Ll(r,o,l,u,p,f,m,y+1),w):Rt(k=>k.map(T=>T.id===o?{...T,status:"failed",errorMsg:`: ${z.message||""}`}:T))})},nv=async(r,o="1:1")=>new Promise((l,u)=>{const p=new Image;p.crossOrigin="anonymous";const f=setTimeout(()=>{u(new Error(""))},3e4);p.onload=()=>{clearTimeout(f);try{const m=document.createElement("canvas"),y=m.getContext("2d"),b=Math.floor(p.width/2),w=Math.floor(p.height/2),v=b/w,z=[];for(let k=0;k<2;k++)for(let T=0;T<2;T++){const I=Math.max(0,Math.min(T*b,p.width-b)),F=Math.max(0,Math.min(k*w,p.height-w)),B=Math.min(b,p.width-I),U=Math.min(w,p.height-F);m.width=B,m.height=U,y.fillStyle="#ffffff",y.fillRect(0,0,B,U),y.drawImage(p,I,F,B,U,0,0,B,U);const W=m.toDataURL("image/png");z.push({url:W,width:B,height:U,ratio:v})}l(z)}catch(m){console.error("Midjourney: :",m),u(m)}},p.onerror=m=>{clearTimeout(f),console.error("Midjourney: Failed to load image for splitting:",m),u(new Error(""))},p.src=r}),If=(r,o,l,u,p,f,m,y=0,b=!1)=>{const w=b?160:300,v=5e3;if(y>w){const T=b?800:1500;Rt(I=>I.map(F=>F.id===r?{...F,status:"failed",errorMsg:`${T}`}:F));return}const k=`${l.replace(/\/+$/,"")}/v1/images/tasks/${o}`;fetch(k,{method:"GET",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}).then(T=>T.text()).then(T=>{var Y,ne,ie,Z,te,pe,Te,Qe,Be;let I;try{I=JSON.parse(T)}catch(Le){console.error("[Async Image] Failed to parse response:",Le),setTimeout(()=>If(r,o,l,u,p,f,m,y+1,b),delayMs);return}const F=(((Y=I==null?void 0:I.data)==null?void 0:Y.status)||(I==null?void 0:I.status)||"").toUpperCase();console.log("[Async Image] :",F,":",{hasData:!!(I!=null&&I.data),hasDataData:!!((ne=I==null?void 0:I.data)!=null&&ne.data),hasDataStatus:!!((ie=I==null?void 0:I.data)!=null&&ie.status),hasStatus:!!(I!=null&&I.status),dataKeys:I?Object.keys(I):[]});let B=[];if((Z=I==null?void 0:I.data)!=null&&Z.data&&Array.isArray(I.data.data)&&I.data.data.length>0?B=I.data.data:(te=I==null?void 0:I.data)!=null&&te.images&&Array.isArray(I.data.images)&&I.data.images.length>0?B=I.data.images:I!=null&&I.images&&Array.isArray(I.images)&&I.images.length>0?B=I.images:I!=null&&I.data&&Array.isArray(I.data)&&I.data.length>0&&(B=I.data),B.length===0){if((pe=I==null?void 0:I.data)!=null&&pe.data&&Array.isArray(I.data.data)&&I.data.data.length>0){const Le=I.data.data[0];if(Le!=null&&Le.revised_prompt){const it=Le.revised_prompt.match(/!\[.*?\]\((https?:\/\/[^\s\)]+)\)/);it&&it[1]&&(B=[{url:it[1]}])}}if(B.length===0&&((Te=I==null?void 0:I.data)!=null&&Te.revised_prompt)){const Le=I.data.revised_prompt.match(/!\[.*?\]\((https?:\/\/[^\s\)]+)\)/);Le&&Le[1]&&(B=[{url:Le[1]}])}if(B.length===0&&((Qe=I==null?void 0:I.data)!=null&&Qe.data)&&Array.isArray(I.data.data)&&I.data.data.length>0){const Le=I.data.data.filter(it=>(it==null?void 0:it.url)||(it==null?void 0:it.image_url)||(it==null?void 0:it.imageUrl));Le.length>0&&(B=Le)}if(B.length===0&&(F==="COMPLETED"||F==="SUCCESS"||F==="FINISHED"||F==="DONE")){const Le=(ut,xt=0,Zt=new WeakSet)=>{if(xt>5||!ut||typeof ut!="object"||Zt.has(ut))return null;Zt.add(ut);const Nt=["url","image_url","imageUrl","image","src","link","href"];for(const Ot of Nt)if(ut[Ot]&&typeof ut[Ot]=="string"&&ut[Ot].startsWith("http"))return ut[Ot];if(Array.isArray(ut)&&ut.length>0){const Ot=Le(ut[0],xt+1,Zt);if(Ot)return Ot}for(const Ot in ut)if(ut.hasOwnProperty(Ot)&&!Nt.includes(Ot)){const er=Le(ut[Ot],xt+1,Zt);if(er)return er}return null},it=Le(I);it?B=[{url:it}]:console.warn("[Async Image] URL:",JSON.stringify(I,null,2).substring(0,500))}}const U=(I==null?void 0:I.message)||(I==null?void 0:I.error)||(I==null?void 0:I.fail_reason)||"";Rt(Le=>{const it=Le.map(xt=>{var Zt,Nt,Ot,er,pr,H,ve,qe,Ze,vt,Mt,Et;if(xt.id===r)if(F==="COMPLETED"||F==="SUCCESS"||F==="FINISHED"||F==="DONE"){const Lt=xt.sourceNodeId||m;if(B&&B.length>0){const wt=B.map(G=>typeof G=="string"?G:(G==null?void 0:G.url)||(G==null?void 0:G.image_url)||(G==null?void 0:G.imageUrl)||"").filter(Boolean);if(wt.length>0){const G=wt[0];if(tn.current.has(r)){const lt=tn.current.get(r);lt&&lt.isImageMode?(ar(lt.nodeId,lt.shotId,{output_images:wt,output_url:G,selectedImageIndex:0,outputEnabled:!1,status:"done",durationCost:me?me/1e3:0}),tn.current.delete(r)):console.warn("[V3.7.30 Async Debug] ")}let me=null;const $e=((Zt=I==null?void 0:I.data)==null?void 0:Zt.duration)||((Nt=I==null?void 0:I.data)==null?void 0:Nt.cost_time)||((Ot=I==null?void 0:I.data)==null?void 0:Ot.elapsed_time)||((er=I==null?void 0:I.data)==null?void 0:er.time_cost)||((pr=I==null?void 0:I.data)==null?void 0:pr.spent_time)||(I==null?void 0:I.duration)||(I==null?void 0:I.cost_time)||(I==null?void 0:I.elapsed_time)||(I==null?void 0:I.time_cost)||(I==null?void 0:I.spent_time);if($e!=null){if(typeof $e=="number")me=$e<1e4?$e*1e3:$e;else if(typeof $e=="string"){const lt=$e.match(/(\d+\.?\d*)\s*(s|ms||)/i);if(lt){const ir=parseFloat(lt[1]),Ht=lt[2].toLowerCase();me=Ht==="s"||Ht===""?ir*1e3:ir}else{const ir=parseFloat($e);isNaN(ir)||(me=ir<1e4?ir*1e3:ir)}}}if(me===null){const lt=Date.now();me=lt-(xt.startTime||lt)}console.log("[Async Image] UI:",{taskId:r,url:G,sourceNodeId:Lt,imageCount:wt.length,durationMs:me,backendDuration:$e,frontendCalculated:me===null?null:Date.now()-(xt.startTime||Date.now())});const jt=Lt||xt.sourceNodeId;return console.log("[Async Image] ",{taskId:r,url:G,sourceNodeId:jt,savedSourceNodeId:Lt,hItemSourceNodeId:xt.sourceNodeId,imageCount:wt.length}),requestAnimationFrame(()=>{Ki(r,G,"image",jt,wt.length>1?wt:null)}),{...xt,status:"completed",progress:100,url:G,width:p,height:f,durationMs:me,errorMsg:null,sourceNodeId:Lt||xt.sourceNodeId,output_images:wt,...wt.length>1?{mjImages:wt,selectedMjImageIndex:0}:{}}}else console.error("[Async Image] URL:",B)}else{console.error("[Async Image] :",{status:F,hasData:!!(I!=null&&I.data),hasDataData:!!((H=I==null?void 0:I.data)!=null&&H.data),fullData:JSON.stringify(I,null,2).substring(0,1e3)});const wt=(me,$e=0)=>{if($e>5||!me||typeof me!="object")return null;if(me.url&&typeof me.url=="string"&&me.url.startsWith("http"))return me.url;if(me.image_url&&typeof me.image_url=="string"&&me.image_url.startsWith("http"))return me.image_url;if(me.imageUrl&&typeof me.imageUrl=="string"&&me.imageUrl.startsWith("http"))return me.imageUrl;for(const jt in me)if(me.hasOwnProperty(jt)){const lt=wt(me[jt],$e+1);if(lt)return lt}return null},G=wt(I);if(G){let me=null;const $e=((ve=I==null?void 0:I.data)==null?void 0:ve.duration)||((qe=I==null?void 0:I.data)==null?void 0:qe.cost_time)||((Ze=I==null?void 0:I.data)==null?void 0:Ze.elapsed_time)||((vt=I==null?void 0:I.data)==null?void 0:vt.time_cost)||((Mt=I==null?void 0:I.data)==null?void 0:Mt.spent_time)||(I==null?void 0:I.duration)||(I==null?void 0:I.cost_time)||(I==null?void 0:I.elapsed_time)||(I==null?void 0:I.time_cost)||(I==null?void 0:I.spent_time);if($e!=null){if(typeof $e=="number")me=$e<1e4?$e*1e3:$e;else if(typeof $e=="string"){const lt=$e.match(/(\d+\.?\d*)\s*(s|ms||)/i);if(lt){const ir=parseFloat(lt[1]),Ht=lt[2].toLowerCase();me=Ht==="s"||Ht===""?ir*1e3:ir}else{const ir=parseFloat($e);isNaN(ir)||(me=ir<1e4?ir*1e3:ir)}}}if(me===null){const lt=Date.now();me=lt-(xt.startTime||lt)}const jt=Lt||xt.sourceNodeId;return console.log("[Async Image] ",{taskId:r,url:G,sourceNodeId:jt,savedSourceNodeId:Lt,hItemSourceNodeId:xt.sourceNodeId}),requestAnimationFrame(()=>{Ki(r,G,"image",jt,null)}),{...xt,status:"completed",progress:100,url:G,width:p,height:f,durationMs:me,errorMsg:null,sourceNodeId:Lt||xt.sourceNodeId,output_images:[G]}}}return{...xt,status:"failed",errorMsg:U||""}}else if(F==="FAILED"||F==="ERROR"||F==="CANCELLED"||F==="FAILURE"){if(tn.current.has(r)){const Lt=tn.current.get(r),wt=Date.now(),G=wt-(xt.startTime||wt);ar(Lt.nodeId,Lt.shotId,{status:"failed",errorMsg:U||`: ${F}`,durationCost:G/1e3}),tn.current.delete(r)}return{...xt,status:"failed",errorMsg:U||`: ${F}`}}else if(F==="PENDING"||F==="PROCESSING"||F==="GENERATING"||F==="IN_PROGRESS"||F==="RUNNING"){let Lt=10+y*2;if((Et=I==null?void 0:I.data)!=null&&Et.progress){const wt=String(I.data.progress);wt.includes("%")?Lt=parseInt(wt.replace("%",""),10)||Lt:typeof I.data.progress=="number"&&(Lt=I.data.progress)}else if(I!=null&&I.progress){const wt=String(I.progress);wt.includes("%")?Lt=parseInt(wt.replace("%",""),10)||Lt:typeof I.progress=="number"&&(Lt=I.progress)}return Lt=Math.min(95,Math.max(10,Lt)),{...xt,status:"generating",progress:Lt,errorMsg:null}}else{const Lt=Math.min(90,10+y*1.5);return{...xt,status:"generating",progress:Lt,errorMsg:null}}return xt}),ut=it.find(xt=>xt.id===r);return ut!=null&&ut.progress,it});const W=(((Be=I==null?void 0:I.data)==null?void 0:Be.status)||(I==null?void 0:I.status)||"").toUpperCase();!(W==="COMPLETED"||W==="SUCCESS"||W==="FINISHED"||W==="DONE")&&!(W==="FAILED"||W==="ERROR"||W==="CANCELLED"||W==="FAILURE")&&Rt(Le=>{const it=Le.find(Zt=>Zt.id===r),ut=(it==null?void 0:it.progress)||10;let xt=v;return ut>=90?xt=1e3:ut>=70?xt=2e3:ut>=50?xt=3e3:y>50&&!b&&(xt=1e4),setTimeout(()=>{If(r,o,l,u,p,f,m,y+1,b)},xt),Le})}).catch(T=>{console.error("[Async Image] Poll error:",T),setTimeout(()=>If(r,o,l,u,p,f,m,y+1,b),v)})},sv=(r,o,l)=>{var v,z;if(!r||!r.endpoint)return null;const u=sd(r,o,{bodyType:r.bodyType});if(!u||!u.url)return null;const p=(((v=o==null?void 0:o.provider)==null?void 0:v.baseUrl)||"").replace(/\/+$/,"");let f=u.url;/^https?:/i.test(f)||(f=`${p}${f.startsWith("/")?"":"/"}${f}`),f=vm(f,l);const m=u.headers&&typeof u.headers=="object"?{...u.headers}:{};(z=o==null?void 0:o.provider)!=null&&z.key&&!m.Authorization&&!m.authorization&&(m.Authorization=`Bearer ${o.provider.key}`);const y=(u.method||r.method||"GET").toString().toUpperCase();let b=u.body,w=(u.bodyType||r.bodyType||"json").toString().toLowerCase();return w==="multipart"?(b=Mg(b),delete m["Content-Type"],delete m["content-type"]):w==="raw"?typeof b!="string"&&(b=JSON.stringify(b??{})):w==="json"&&(!(b instanceof FormData)&&typeof b!="string"&&(b=JSON.stringify(b??{})),!m["Content-Type"]&&!m["content-type"]&&(m["Content-Type"]="application/json")),(y==="GET"||y==="HEAD")&&(b=void 0),{url:f,method:y,headers:m,body:b}},Pf=(r,o,l,u,p,f,m,y,b=0)=>{var T;const w=Number.isFinite(l==null?void 0:l.maxAttempts)?l.maxAttempts:300,v=Number.isFinite(l==null?void 0:l.pollIntervalMs)?l.pollIntervalMs:3e3;if(b>w){Rt(I=>I.map(F=>F.id===r?{...F,status:"failed",errorMsg:""}:F));return}if(!((T=l==null?void 0:l.statusRequest)!=null&&T.endpoint)){Rt(I=>I.map(F=>F.id===r?{...F,status:"failed",errorMsg:""}:F));return}const z={...u,requestId:o},k=sv(l.statusRequest,z,y);if(!k){Rt(I=>I.map(F=>F.id===r?{...F,status:"failed",errorMsg:""}:F));return}fetch(k.url,{method:k.method,headers:k.headers,body:k.body}).then(I=>I.text()).then(async I=>{var Y;let F;try{F=I?JSON.parse(I):{}}catch(ne){console.warn("[Async Task] ",ne),setTimeout(()=>Pf(r,o,l,u,p,f,m,y,b+1),v);return}const B=Th(F,l.statusPath),U=fE(B),W=l.successValues.includes(U),X=l.failureValues.includes(U),J=l.errorPath&&Th(F,l.errorPath)||"";if(W){let ne=F;if((Y=l.outputsRequest)!=null&&Y.endpoint){const te=sv(l.outputsRequest,z,y);if(!te)throw new Error("");const Te=await(await fetch(te.url,{method:te.method,headers:te.headers,body:te.body})).text();ne=Te?JSON.parse(Te):{}}const ie=l.outputsPath?Th(ne,l.outputsPath):ne,Z=hE(ie,l.outputsUrlField);if(Z.length===0)throw new Error("");Rt(te=>te.map(Te=>{if(Te.id!==r)return Te;const Qe=tn.current.get(r),Be=!!Qe,Le=Date.now(),it=Le-(Te.startTime||Le);Be&&Qe.isImageMode&&(ar(Qe.nodeId,Qe.shotId,{output_images:Z,output_url:Z[0],selectedImageIndex:0,outputEnabled:!1,status:"done",durationCost:it/1e3}),tn.current.delete(r));const ut={...Te,status:"completed",progress:100,url:Z[0],width:p,height:f,durationMs:it,output_images:Z,mjImages:Z.length>1?Z:null,selectedMjImageIndex:0};return ut.sourceNodeId&&!Be&&setTimeout(()=>{Ki(r,Z[0],"image",ut.sourceNodeId,ut.mjImages)},0),ut}));return}if(X){Rt(ne=>ne.map(ie=>ie.id===r?{...ie,status:"failed",errorMsg:J||`: ${U||"FAILED"}`}:ie));return}Rt(ne=>ne.map(ie=>{if(ie.id!==r)return ie;const Z=Math.min(95,Math.max(10,10+b*2));return{...ie,status:"generating",progress:Z,errorMsg:null}})),setTimeout(()=>Pf(r,o,l,u,p,f,m,y,b+1),v)}).catch(I=>{console.error("[Async Task] Poll error:",I),setTimeout(()=>Pf(r,o,l,u,p,f,m,y,b+1),v)})},$f=(r,o,l,u,p,f,m,y,b,w=0)=>{if(w>300){Rt(B=>B.map(U=>U.id===r?{...U,status:"failed",errorMsg:"ModelScope "}:U));return}const T=`${l.replace(/\/+$/,"")}/v1/tasks/${o}`,I={Authorization:`Bearer ${u}`,"Content-Type":"application/json"};b&&(I["X-ModelScope-Task-Type"]="image_generation");const F=b?vm(T,y):T;fetch(F,{method:"GET",headers:I}).then(B=>B.text()).then(B=>{var Te,Qe,Be,Le,it,ut,xt,Zt,Nt,Ot;let U;try{U=JSON.parse(B)}catch(er){console.error("[ModelScope] Failed to parse response:",er),setTimeout(()=>$f(r,o,l,u,p,f,m,y,b,w+1),5e3);return}const W=(U==null?void 0:U.task_status)||((Te=U==null?void 0:U.data)==null?void 0:Te.task_status)||((Qe=U==null?void 0:U.output)==null?void 0:Qe.task_status)||(U==null?void 0:U.status)||((Be=U==null?void 0:U.data)==null?void 0:Be.status)||"",X=String(W).toUpperCase(),J=(U==null?void 0:U.output_images)||((Le=U==null?void 0:U.output)==null?void 0:Le.output_images)||((it=U==null?void 0:U.data)==null?void 0:it.output_images)||((ut=U==null?void 0:U.output)==null?void 0:ut.images)||((Zt=(xt=U==null?void 0:U.data)==null?void 0:xt.output)==null?void 0:Zt.output_images)||[],Y=Array.isArray(J)?J.map(er=>typeof er=="string"?er:(er==null?void 0:er.url)||(er==null?void 0:er.image_url)||(er==null?void 0:er.imageUrl)||(er==null?void 0:er.path)||"").filter(Boolean):[],ne=(U==null?void 0:U.message)||(U==null?void 0:U.error)||((Nt=U==null?void 0:U.data)==null?void 0:Nt.message)||((Ot=U==null?void 0:U.output)==null?void 0:Ot.error)||"",ie=new Set(["SUCCEED","SUCCESS","COMPLETED","FINISHED","DONE"]),Z=new Set(["FAILED","ERROR","CANCELLED","FAILURE"]),te=ie.has(X),pe=Z.has(X);Rt(er=>er.map(pr=>{if(pr.id!==r)return pr;const H=tn.current.get(r),ve=!!H;if(te){if(Y.length===0)return{...pr,status:"failed",errorMsg:"ModelScope "};const Ze=Y[0],vt=Date.now(),Mt=vt-(pr.startTime||vt);ve&&(H.isImageMode?(ar(H.nodeId,H.shotId,{output_images:Y,output_url:Ze,selectedImageIndex:0,outputEnabled:!1,status:"done",durationCost:Mt/1e3}),tn.current.delete(r)):console.warn("[ModelScope] "));const Et={...pr,status:"completed",progress:100,url:Ze,width:p,height:f,durationMs:Mt,output_images:Y,selectedMjImageIndex:0};return Et.sourceNodeId&&!ve&&setTimeout(()=>{Ki(r,Ze,"image",Et.sourceNodeId,Y)},0),Et}if(pe)return ve&&H.isImageMode&&(ar(H.nodeId,H.shotId,{status:"failed",errorMsg:ne||`: ${X||"FAILED"}`,durationCost:(Date.now()-(pr.startTime||Date.now()))/1e3}),tn.current.delete(r)),{...pr,status:"failed",errorMsg:ne||`: ${X||"FAILED"}`};const qe=Math.min(95,Math.max(10,10+w*2));return{...pr,status:"generating",progress:qe,errorMsg:null}})),!te&&!pe&&setTimeout(()=>$f(r,o,l,u,p,f,m,y,b,w+1),5e3)}).catch(B=>{console.error("[ModelScope] Poll error:",B),setTimeout(()=>$f(r,o,l,u,p,f,m,y,b,w+1),5e3)})},Af=(r,o,l,u,p="fast",f,m,y=0)=>{if(y>120){Rt(v=>v.map(z=>z.id===o?{...z,status:"failed",errorMsg:"Midjourney "}:z));return}fetch(`${l}/${p}/mj/task/${r}/fetch`,{method:"GET",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}).then(v=>v.text()).then(v=>{let z;try{z=JSON.parse(v)}catch(W){console.error("Midjourney: Failed to parse response:",W),setTimeout(()=>Af(r,o,l,u,p,f,m,y+1),5e3);return}const k=(z==null?void 0:z.status)||"",T=(z==null?void 0:z.progress)||"0%",I=(z==null?void 0:z.imageUrl)||"",F=(z==null?void 0:z.failReason)||"",B=(z==null?void 0:z.buttons)||[];let U=0;typeof T=="string"&&T.includes("%")?U=parseInt(T.replace("%",""),10)||0:typeof T=="number"&&(U=T),Rt(W=>W.map(X=>{var J,Y,ne,ie,Z,te,pe;if(X.id===o){let Te=X.status,Qe=X.errorMsg,Be=U;if(k==="SUCCESS"||k==="FINISHED"){if(Te="completed",Be=100,Qe=null,I&&((Y=(J=X.apiConfig)==null?void 0:J.modelId)!=null&&Y.includes("mj"))&&((ne=X.apiConfig)==null?void 0:ne.modelId)!=="mj-zoom"){let it="1:1";if(X.prompt&&X.prompt.includes("--ar ")){const Nt=X.prompt.match(/--ar\s+([\d:]+)/);Nt&&Nt[1]&&(it=Nt[1])}Rt(Nt=>Nt.map(Ot=>Ot.id===o?{...Ot,url:I,mjRatio:it,mjOriginalUrl:I,mjNeedsSplit:!0}:Ot));const ut=X.sourceNodeId;ut?setTimeout(()=>{Ki(o,I,"image",ut)},0):console.warn("[Tapnow] Midjourney:  sourceNodeId",{taskId:o,hItem:X}),setTimeout(()=>{nv(I,it).then(Nt=>{const Ot=Nt.map(H=>typeof H=="string"?H:H.url),er=Nt[0],pr=typeof er=="string"?er:er.url;Rt(H=>H.map(ve=>ve.id===o?{...ve,mjImages:Ot,url:pr,selectedMjImageIndex:0,mjRatio:it,mjOriginalUrl:I,mjNeedsSplit:!1,mjImageInfo:Nt.map(qe=>typeof qe=="string"?null:{width:qe.width,height:qe.height,ratio:qe.ratio})}:ve))}).catch(Nt=>{console.error("Midjourney: Failed to split image:",Nt),Rt(Ot=>Ot.map(er=>er.id===o?{...er,url:I,mjRatio:it,mjOriginalUrl:I,mjNeedsSplit:!0}:er))})},300);const xt=Date.now(),Zt=xt-(X.startTime||xt);return{...X,status:Te,progress:Be,errorMsg:Qe,url:I,width:f,height:m,mjButtons:B,mjOriginalUrl:I,durationMs:Zt}}}else k==="FAILURE"||k==="ERROR"||k==="CANCELLED"?(Te="failed",Qe=F||`: ${k}`):k==="NOT_START"||k==="SUBMITTED"||k==="IN_PROGRESS"||k==="MODAL"?(Te="generating",Qe=null,Be===0&&(Be=5)):(Te="generating",Qe=null,Be=Math.min(95,(X.progress||5)+2));const Le={...X,status:Te,progress:Be,errorMsg:Qe,url:I||X.url,width:f,height:m,mjButtons:B};if((k==="SUCCESS"||k==="FINISHED")&&I&&(!((Z=(ie=X.apiConfig)==null?void 0:ie.modelId)!=null&&Z.includes("mj"))||((te=X.apiConfig)==null?void 0:te.modelId)==="mj-zoom")){X.sourceNodeId?((pe=X.apiConfig)==null?void 0:pe.modelId)==="mj-zoom"?x(xt=>xt.map(Zt=>Zt.id===X.sourceNodeId&&Zt.type==="expand-image"?{...Zt,content:I}:Zt)):Ki(o,I,"image",X.sourceNodeId):console.warn("[Tapnow] :  sourceNodeId",{taskId:o,hItem:X});const it=Date.now(),ut=it-(X.startTime||it);Le.durationMs=ut}return Le}return X})),!(k==="SUCCESS"||k==="FINISHED")&&(k==="FAILURE"||k==="ERROR"||k==="CANCELLED"||setTimeout(()=>Af(r,o,l,u,p,f,m,y+1),5e3))}).catch(v=>{console.error(`[Tapnow] Midjourney Poll Fetch Error for task ${o}:`,v),Rt(z=>z.map(k=>k.id===o?{...k,status:"failed",errorMsg:`: ${v.message}`}:k)),y<3&&setTimeout(()=>Af(r,o,l,u,p,f,m,y+1),5e3)})},uN=async r=>{if(!r)return null;try{const o=new Image;o.crossOrigin="anonymous",await new Promise((p,f)=>{o.onload=p,o.onerror=f,o.src=r});const l=document.createElement("canvas");l.width=o.width,l.height=o.height;const u=l.getContext("2d");return u.fillStyle="#000000",u.fillRect(0,0,l.width,l.height),u.globalCompositeOperation="destination-out",u.drawImage(o,0,0),new Promise((p,f)=>{l.toBlob(m=>{m?p(m):f(new Error(""))},"image/png")})}catch(o){return console.error("[Inpainting] :",o),null}},Dl=async(r,o,l,u,p={})=>{var it,ut,xt,Zt,Nt,Ot,er,pr,H,ve,qe,Ze,vt,Mt,Et,Lt,wt,G,me,$e,jt,lt,ir,Ht,ae,He,Pe,bt,rt,It,nt,Pt,$t,or,Ur,Yr,jr,pn,yt,dr,vr,V,ft,pt,zt,mt,Jt,fr,cr,Ne,Qt,Pr,_r,xe,Ke,kt,qt,At,Lr,hr,gr,Fn,Dr,fn,mr,Tr,Nr,on,Bn,an,ci,Ji,Ev,Iv,Pv,$v;let f=[];const m=Array.isArray(l)?l:l?[l]:[];if(m.length>0)try{f=await Promise.all(m.map(async ye=>{const tr=await Jd(ye);if(tr&&tr!==ye)return tr;if(as.isImageId(ye)){const Xr=Ea(ye);if(Xr)return Xr;console.warn(`[startGeneration] Failed to resolve IDB image: ${ye}`)}return ye}))}catch(ye){console.error("[startGeneration] Error resolving images:",ye),f=m}const y=f,b=y.length>0?y[0]:void 0;if(!r&&!b){alert(j(""));return}let w=null;u&&u.startsWith("storyboard-")&&u.includes("-shot-")?w=null:w=g.find(ye=>ye.id===u);let v=null,z=w==null?void 0:w.maskContent;if(!z){let ye=N.find(tr=>tr.to===u&&(!tr.inputType||tr.inputType==="default"));if(ye||(ye=N.find(tr=>tr.to===u)),ye){const tr=Xt.get(ye.from);tr&&tr.maskContent&&(z=tr.maskContent)}}z&&(v=await uN(z),v||console.warn("[Inpainting] "));const k=p.model||((it=w==null?void 0:w.settings)==null?void 0:it.model)||(o==="image"?"nano-banana":"sora-2"),T=p.customParams||((ut=w==null?void 0:w.settings)==null?void 0:ut.customParams)||null,I=wi(k);let F=I.key,B=F;if(F&&F.includes(",")){const ye=F.split(",").map(Ve=>Ve.trim()).filter(Ve=>Ve),tr=Rs.current||{},Xr=ye.filter(Ve=>!tr[Ve]);Xr.length>0?B=Xr[Math.floor(Math.random()*Xr.length)]:ye.length>0&&(B=ye[Math.floor(Math.random()*ye.length)],console.warn(` [Load Balancing] All ${ye.length} keys are blacklisted, using random selection`))}B&&console.log(`[API Select] Using Key ending in ...${B.slice(-4)}`);let U=I.url,W=U;if(U.includes(",")){const ye=U.split(",").map(tr=>tr.trim()).filter(tr=>tr);ye.length>0&&(W=ye[Math.floor(Math.random()*ye.length)])}if(!B){alert(j(" API Key")),bi(!0);return}r&&(k.includes("sora")||k==="sora-2"||k==="sora-2-pro")&&(r=r.replace(/@([a-zA-Z0-9_\.]+)(?![a-zA-Z0-9_\.])/g,(ye,tr)=>`@{${tr}}`),r=r.replace(/@\{([^\}]+)\}/g,(ye,tr)=>` @{${tr}} `).replace(/\s{2,}/g," ").trim());let X=p.ratio||((xt=w==null?void 0:w.settings)==null?void 0:xt.ratio)||(k.includes("grok")?"3:2":"1:1"),J=p.resolution||((Zt=w==null?void 0:w.settings)==null?void 0:Zt.resolution)||(o==="video"?"720P":"2K"),Y=J;o==="image"&&(J=Ju(J),Y=J),o==="video"&&(J=ca(J),Y=J==="Auto"?"720P":J);let{sizeStr:ne,w:ie,h:Z}=yE(k,X,Y);if(J==="Auto"&&X==="Auto"&&b)try{const ye=await os(b),tr=Math.round(ye.w/64)*64,Xr=Math.round(ye.h/64)*64;ie=tr,Z=Xr,ne=`${tr}x${Xr}`}catch(ye){console.error("Auto Res Error",ye)}else if(!ie||!Z){const ye=T2(X,J);ie=ye.w,Z=ye.h,ne=ye.str}if(b&&X==="Auto"&&["1K","2K","4K"].includes(J))try{const ye=await os(b),tr=J==="4K"?4096:J==="2K"?2048:1024,Xr=Math.max(ye.w,ye.h)||1,Ve=tr/Xr;let Sr=Math.round(ye.w*Ve/16)*16,wr=Math.round(ye.h*Ve/16)*16;Sr=Math.max(16,Sr),wr=Math.max(16,wr),ie=Sr,Z=wr,ne=`${Sr}x${wr}`}catch(ye){console.error("Auto+K Upscale Error",ye)}let te=p.duration?String(p.duration).replace("s",""):((Ot=(Nt=w==null?void 0:w.settings)==null?void 0:Nt.duration)==null?void 0:Ot.replace("s",""))||"5";if(k.includes("veo")&&(te="8"),o==="video"){const ye=sr(k),tr=Array.isArray(ye==null?void 0:ye.durations)?ye.durations:null,Xr=tr?tr.map(wr=>String(wr||"").replace(/[^\d]/g,"")).filter(Boolean):null,Ve=(ye==null?void 0:ye.provider)==="jimeng"||k.includes("jimeng")||((ye==null?void 0:ye.modelName)??"").includes("jimeng"),Sr=Ve&&(k.includes("sora2")||((ye==null?void 0:ye.modelName)??"").includes("sora2"));if(Ve){const wr=Xr&&Xr.length>0?Xr:Sr?["4","8","12"]:["5","10"];wr.includes(String(te))||(te=wr[0]||te)}}const pe=p._existingTaskId||`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,Te=()=>{const ye=sr(k);return k.includes("jimeng")?k:(ye==null?void 0:ye.displayName)||(ye==null?void 0:ye.modelName)||(ye==null?void 0:ye.id)||k},Qe=Date.now(),Be=(w==null?void 0:w.id)||u||null,Le=!!I.useProxy;if(p._isRetry||Rt(ye=>[{id:pe,type:o,url:"",prompt:r||(b?`Img2${o==="image"?"Img":"Vid"}`:"Untitled"),time:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),status:"generating",progress:5,modelName:Te(),width:ie,height:Z,remoteTaskId:null,apiConfig:{modelId:k,baseUrl:W,apiKey:B,provider:I.provider,useProxy:Le},provider:I.provider,useProxy:Le,sourceNodeId:Be,startTime:Qe,durationMs:null,ratio:X,resolution:J,duration:o==="video"?te:null,hasInputImages:y.length>0,customParams:T||null},...ye]),Be&&Be.startsWith("storyboard-")&&Be.includes("-shot-")){const ye=Be.split("-shot-");if(ye.length===2){const tr=ye[1],Xr=ye[0].startsWith("storyboard-img-"),Ve=Xr?ye[0].replace("storyboard-img-",""):ye[0].replace("storyboard-","");tn.current.set(pe,{nodeId:Ve,shotId:tr,isImageMode:Xr})}}p._isRetry||requestAnimationFrame(()=>{setTimeout(()=>{rf(!0)},0)});try{if(o==="image"){let ye=`${W}/v1/images/generations`,tr,Xr=!1;const Ve=sr(k),Sr=Array.isArray(Ve==null?void 0:Ve.customParams)?Ve.customParams:[],wr=Ve==null?void 0:Ve.provider,ia=I.apiType||((er=Ft[wr])==null?void 0:er.apiType)||"openai",oa=!!I.useProxy,Rf=!!I.forceAsync,Hn=Gi(Ve==null?void 0:Ve.requestTemplate),Lm=!!(Ve!=null&&Ve.requestOverrideEnabled),Nu=Lo(Ve==null?void 0:Ve.requestOverridePatch),ki=!!(Hn!=null&&Hn.enabled),ji=ia==="modelscope",po=ia==="gemini",fo=(Ve==null?void 0:Ve.type)==="ChatImage",Vl=ji?Rf:!1,ws=ge=>Gn(ge,oa),jn=rp(Ve==null?void 0:Ve.asyncConfig),Dm=(k.includes("banana")||k.includes("edit")||k.includes("qwen"))&&!(k.includes("nano-banana-2")||((Ve==null?void 0:Ve.modelName)??"").includes("nano-banana-2")),Of=k.includes("gpt")||((Ve==null?void 0:Ve.modelName)??"").includes("gpt-image")||((Ve==null?void 0:Ve.provider)??"").toLowerCase().includes("gpt-4o image"),Wl=k.includes("flux")||((Ve==null?void 0:Ve.modelName)??"").includes("flux-kontext"),Ni=((Ve==null?void 0:Ve.modelName)??"").includes("nano-banana-2")||k.includes("nano-banana-2"),Si=!ki&&(k.includes("mj")||((Ve==null?void 0:Ve.provider)??"").toLowerCase().includes("midjourney")),di=k.includes("jimeng")||((Ve==null?void 0:Ve.modelName)??"").includes("jimeng")||(Ve==null?void 0:Ve.provider)==="jimeng",Gc=()=>{var ge;return k.includes("jimeng-4.5")?"jimeng-4.5":k.includes("jimeng-4.1")?"jimeng-4.1":k.includes("jimeng-4.0")?"jimeng-4.0":k.includes("jimeng-3.1")?"jimeng-3.1":k.includes("jimeng-3.0")?"jimeng-3.0":(ge=Ve==null?void 0:Ve.modelName)!=null&&ge.includes("jimeng")?Ve.modelName:"jimeng-4.5"},lr=(()=>{if(Ni)return J==="4K"?"4K":J==="2K"?"2K":"1K"})(),Su=Wb(J),Mn=X==="Auto"||Su?void 0:X;if(fo){ye="/v1/chat/completions";const ge=[];r&&ge.push({type:"text",text:r}),(y.length>0?y:b?[b]:[]).forEach(De=>{De&&ge.push({type:"image_url",image_url:{url:De}})}),ge.length===0&&ge.push({type:"text",text:j("")}),tr={model:(Ve==null?void 0:Ve.modelName)||k,messages:[{role:"user",content:ge}],stream:!1}}else if(ji){const ge=(Ve==null?void 0:Ve.modelName)||"Tongyi-MAI/Z-Image-Turbo";ye=`${W}/v1/images/generations`,tr={model:ge,prompt:r||"",n:1,size:ne,...Vl?{async_mode:!0}:{}},Mn&&(tr.aspect_ratio=Mn)}else if(po){const ge=(Ve==null?void 0:Ve.modelName)||"gemini-3-pro-image-preview",Ae=[];r&&Ae.push({text:r});const De=y.length>0?y:b?[b]:[],et=st=>{if(!st)return"image/png";if(st.startsWith("data:")){const Tt=st.match(/^data:([^;]+);/i);if(Tt&&Tt[1])return Tt[1]}const Wt=lo(st,".png");return Wt===".jpg"||Wt===".jpeg"?"image/jpeg":Wt===".webp"?"image/webp":Wt===".gif"?"image/gif":"image/png"};for(const st of De){const Wt=await In(st,{useProxy:ws(st)}),Tt=et(st);Ae.push({inline_data:{mime_type:Tt,data:Wt}})}const ht={};Mn&&(ht.aspectRatio=Mn),J&&J!=="Auto"&&(ht.imageSize=J),tr={contents:[{role:"user",parts:Ae}],generationConfig:{responseModalities:["TEXT","IMAGE"],...Object.keys(ht).length>0?{imageConfig:ht}:{}}};const Ie=B?`?key=${encodeURIComponent(B)}`:"";ye=`${W}/v1beta/models/${ge}:generateContent${Ie}`}else if(y.length>0&&Dm){ye=`${W}/v1/images/edits`,Xr=!0;const ge=new FormData;ge.append("model",(Ve==null?void 0:Ve.modelName)||"nano-banana"),ge.append("prompt",r||"enhance"),ge.append("n","1"),ge.append("size",ne),Mn&&ge.append("aspect_ratio",Mn),lr&&ge.append("image_size",lr);const Ae=y.map(et=>Un(et,{useProxy:ws(et)}));(await Promise.all(Ae)).forEach((et,ht)=>{ge.append("image",et,`input_${ht}.png`)}),v&&ge.append("mask",v,"mask.png"),tr=ge}else if(Wl){ye=`${W}/v1/images/edits`,Xr=!0;const ge=new FormData;ge.append("model",(Ve==null?void 0:Ve.modelName)||"flux-kontext-pro"),ge.append("prompt",r||""),Mn&&ge.append("aspect_ratio",Mn),ne&&ge.append("size",ne);const Ae=y.length>0?y:b?[b]:[];if(Ae.length>0){const De=Ae.map(ht=>Un(ht,{useProxy:ws(ht)}));(await Promise.all(De)).forEach((ht,Ie)=>ge.append("image",ht,`flux_ref_${Ie}.png`))}v&&ge.append("mask",v,"mask.png"),tr=ge}else if(Of){let ge=r||"";const Ae={model:(Ve==null?void 0:Ve.modelName)||"gpt-4o-image",prompt:ge,n:1,size:ne,response_format:"url"};if(Mn&&(Ae.aspect_ratio=Mn),y.length>0){const De=y.map(ht=>In(ht,{useProxy:ws(ht)})),et=await Promise.all(De);Ae.image=et.map(ht=>`data:image/png;base64,${ht}`)}tr=Ae}else if(Ni)if(y.length>0){ye=`${W}/v1/images/edits?async=true`,Xr=!0;const Ae=new FormData;Ae.append("model",(Ve==null?void 0:Ve.modelName)||"nano-banana-2"),Ae.append("prompt",r||""),Ae.append("response_format","url"),Mn&&Ae.append("aspect_ratio",Mn),lr&&Ae.append("image_size",lr);const De=y.map(ht=>Un(ht,{useProxy:ws(ht)}));(await Promise.all(De)).forEach((ht,Ie)=>{Ae.append("image",ht,`input_${Ie}.png`)}),v&&Ae.append("mask",v,"mask.png"),tr=Ae}else{ye=`${W}/v1/images/generations?async=true`;const Ae={model:(Ve==null?void 0:Ve.modelName)||"nano-banana-2",prompt:r||"",response_format:"url",...Mn?{aspect_ratio:Mn}:{},...lr?{image_size:lr}:{}};if(b){const De=b.trim();if(De.startsWith("http"))Ae.image=[De];else if(De.startsWith("data:"))Ae.image=[De];else{const et=await In(De,{useProxy:ws(De)});Ae.image=[`data:image/png;base64,${et}`]}}tr=Ae}else if(Si){const ge=((pr=w==null?void 0:w.settings)==null?void 0:pr.mjMode)||"fast",Ae=((H=w==null?void 0:w.settings)==null?void 0:H.mjVersion)||"--v 7";let De=r||"";X&&X!=="Auto"&&(De.includes("--ar ")||(De=`${De} --ar ${X}`.trim()));const et=Wi(u,"oref"),ht=Wi(u,"sref"),Ie=[],st=new Map;let Wt=null,Tt=null,Ue=[];const Cr=et||((ve=w==null?void 0:w.settings)==null?void 0:ve.mjOref)&&w.settings.mjOref.trim();if(Cr&&Cr.trim()){let ln=Cr.trim();ln.startsWith("http")?Wt=ln:ln.startsWith("data:")?(Ie.push(ln),st.set("oref",Ie.length-1)):Wt=ln}const xr=ht||((qe=w==null?void 0:w.settings)==null?void 0:qe.mjSref)&&w.settings.mjSref.trim();if(xr&&xr.trim()){let ln=xr.trim();ln.startsWith("http")?Tt=ln:ln.startsWith("data:")?(Ie.push(ln),st.set("sref",Ie.length-1)):Tt=ln}if(y.length>0)for(const ln of y)!(et&&ln===et)&&!(ht&&ln===ht)&&(ln.startsWith("http")?Ue.push(ln):ln.startsWith("data:")?(Ie.push(ln),st.set(`default_${Ue.length}`,Ie.length-1),Ue.push(null)):Ue.push(ln));if(Ie.length>0)try{const ln=await eN(Ie,W,B);st.has("oref")&&(Wt=ln[st.get("oref")]),st.has("sref")&&(Tt=ln[st.get("sref")]);for(let qi=0;qi<Ue.length;qi++)if(Ue[qi]===null){const Kl=`default_${qi}`;st.has(Kl)&&(Ue[qi]=ln[st.get(Kl)])}}catch(ln){Rt(qi=>qi.map(Kl=>Kl.id===pe?{...Kl,status:"failed",progress:0,errorMsg:`: ${ln.message}`}:Kl));return}Ue=Ue.filter(ln=>ln!==null);let Vr="";Ue.length>0&&(Vr=Ue.join(" ")+" "),Vr+=De.trim(),!Vr.includes("--v ")&&!Vr.includes("--niji ")&&(Vr=`${Vr} ${Ae}`.trim()),X&&X!=="Auto"&&!Vr.includes("--ar ")&&(Vr=`${Vr} --ar ${X}`.trim()),Wt&&!Vr.includes("--oref ")&&(Vr=`${Vr} --oref ${Wt}`.trim()),(Ze=w==null?void 0:w.settings)!=null&&Ze.mjOw&&w.settings.mjOw>0&&!Vr.includes("--ow ")&&(Vr=`${Vr} --ow ${Math.min(1e3,Math.max(1,w.settings.mjOw))}`.trim()),Tt&&!Vr.includes("--sref ")&&(Vr=`${Vr} --sref ${Tt}`.trim()),ye=`${W}/${ge}/mj/submit/imagine`,tr={prompt:Vr,base64Array:[]};const Gs=await fetch(ye,{method:"POST",headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"},body:JSON.stringify(tr)}),el=await Gs.text();if(!Gs.ok)throw new Error(el||`Midjourney API error: ${Gs.status}`);let Cu=JSON.parse(el);if(Cu.code!==1&&Cu.code!==22)throw new Error(Cu.description||`Midjourney: code ${Cu.code}`);const Fm=Cu.result;if(!Fm)throw new Error("ID");Rt(ln=>ln.map(qi=>qi.id===pe?{...qi,remoteTaskId:Fm,status:"generating",progress:5}:qi)),Af(Fm,pe,W,B,ge,ie,Z);return}else if(di)if(y.length>0){if(ye=`${W}/v1/images/compositions`,!r||r.trim()==="")throw new Error("");let ge=X,Ae="2k";if(X==="Auto"&&b)try{const st=await os(b),Wt=[{name:"1:1",value:1},{name:"4:3",value:4/3},{name:"3:4",value:3/4},{name:"16:9",value:16/9},{name:"9:16",value:9/16},{name:"3:2",value:3/2},{name:"2:3",value:2/3},{name:"21:9",value:21/9}],Tt=st.w/st.h;let Ue=Wt[0],Cr=Math.abs(Tt-Ue.value);for(const xr of Wt){const Vr=Math.abs(Tt-xr.value);Vr<Cr&&(Cr=Vr,Ue=xr)}if(ge=Ue.name,J==="Auto"){const xr=Math.max(st.w,st.h);Ae=xr<=1024?"1k":xr<=2048?"2k":"4k"}}catch{ge="1:1"}else ge=X==="Auto"?"1:1":X;J!=="Auto"&&(J==="1K"?Ae="1k":J==="2K"?Ae="2k":J==="4K"&&(Ae="4k"));const De=v?await Eo(v):null,et=y.map(async st=>{try{return await fN(st,{useProxy:ws(st)})}catch(Wt){throw st.startsWith("blob:")?(console.error("[Jimeng] Blob URL :",Wt),new Error("Blob URL")):new Error(`: ${Wt.message}`)}}),ht=await Promise.all(et);tr={model:Gc(),prompt:r.trim(),images:ht,ratio:ge,resolution:Ae,response_format:"url"},De&&(tr.mask=De)}else{ye=`${W}/v1/images/generations`;const ge=X==="Auto"?"1:1":X;let Ae="2k";if(J==="1K"?Ae="1k":J==="2K"?Ae="2k":J==="4K"&&(Ae="4k"),!r||r.trim()==="")throw new Error("");tr={model:Gc(),prompt:r.trim(),ratio:ge,resolution:Ae,response_format:"url"}}else tr={model:(Ve==null?void 0:Ve.modelName)||k,prompt:r,n:1,size:ne,response_format:"url"};tr=Hw(tr,Sr,T),Ve!=null&&Ve.previewOverrideEnabled&&Ve.previewOverridePatch&&(tr=$g(tr,Ve.previewOverridePatch));const _u=()=>{var et;const ge={modelName:(Ve==null?void 0:Ve.modelName)||k,prompt:r||"",ratio:X,resolution:J,size:ne,duration:o==="video"?te:void 0,durationNumber:od(te,5),seed:(et=w==null?void 0:w.settings)==null?void 0:et.seed,n:1,provider:{key:B,baseUrl:W,id:I.provider,useProxy:oa}},De=(y.length>0?y:b?[b]:[]).filter(Boolean);return De.length>0&&(ge.imageUrl=De[0],ge.imageUrls=De,ge.imagesUrl=De,ge.imagesUrls=De,De.forEach((ht,Ie)=>{const st=Ie+1;ge[`imageUrl${st}`]=ht,ge[`image${st}Url`]=ht})),v&&(ge.maskBlob=v),Sr.length>0&&T&&Sr.forEach(ht=>{const Ie=String((ht==null?void 0:ht.name)||"").trim();if(!Ie)return;const st=ad(ht,T);if(st===""||st===void 0||st===null){const Wt=Fw(Ie,De);Wt&&(ge[Ie]=Wt);return}ge[Ie]=st}),ge};let Vn=null;if(Hn!=null&&Hn.enabled){const ge=async()=>{var Wt;const Ae={modelName:(Ve==null?void 0:Ve.modelName)||k,prompt:r||"",ratio:X,resolution:J,size:ne,duration:o==="video"?te:void 0,durationNumber:od(te,5),seed:(Wt=w==null?void 0:w.settings)==null?void 0:Wt.seed,n:1,provider:{key:B,baseUrl:W,id:I.provider,useProxy:oa}},et=(y.length>0?y:b?[b]:[]).filter(Boolean);if(et.length>0&&(Ae.imageUrl=et[0],Ae.imageUrls=et,Ae.imagesUrl=et,Ae.imagesUrls=et,et.forEach((Tt,Ue)=>{const Cr=Ue+1;Ae[`imageUrl${Cr}`]=Tt,Ae[`image${Cr}Url`]=Tt})),v){Ae.maskBlob=v;try{Ae.maskDataUrl=await Eo(v),Ae.maskDataURL=Ae.maskDataUrl}catch{}}const ht=JSON.stringify(Hn||{}),Ie=((Hn==null?void 0:Hn.bodyType)||"").toLowerCase()==="multipart"||/:blob\s*}}/.test(ht),st=/:blob\s*}}/.test(ht);if(Ie&&et.length>0){const Tt=await Promise.all(et.map(Ue=>Un(Ue,{useProxy:ws(Ue)})));Ae.imageBlob=Tt[0],Ae.imageBlobs=Tt,Ae.imagesBlob=Tt,Tt.forEach((Ue,Cr)=>{const xr=Cr+1;Ae[`imageBlob${xr}`]=Ue,Ae[`image${xr}Blob`]=Ue})}if(st&&et.length>0){const Tt=await Promise.all(et.map(async Ue=>{if(!Ue)return"";if(Ue.startsWith("data:"))return Ue;const Cr=await In(Ue,{useProxy:ws(Ue)}),xr=lo(Ue,".png");return`data:${xr===".jpg"||xr===".jpeg"?"image/jpeg":xr===".webp"?"image/webp":"image/png"};base64,${Cr}`}));Ae.imageDataUrl=Tt[0],Ae.imageDataURL=Tt[0],Ae.imageDataUrls=Tt,Ae.imagesDataUrl=Tt,Ae.imagesDataURL=Tt,Tt.forEach((Ue,Cr)=>{const xr=Cr+1;Ae[`imageDataUrl${xr}`]=Ue,Ae[`imageDataURL${xr}`]=Ue,Ae[`image${xr}DataUrl`]=Ue,Ae[`image${xr}DataURL`]=Ue})}return Sr.length>0&&T&&Sr.forEach(Tt=>{const Ue=String((Tt==null?void 0:Tt.name)||"").trim();if(!Ue)return;const Cr=ad(Tt,T);if(Cr===""||Cr===void 0||Cr===null){const xr=Fw(Ue,et);xr&&(Ae[Ue]=xr);return}Ae[Ue]=Cr}),Ae};try{const Ae=await ge(),De=sd(Hn,Ae,{bodyType:Hn.bodyType});De&&De.url&&(Vn=Lm&&Nu?Tg({...De},Nu):De)}catch(Ae){console.warn("[RequestTemplate] :",Ae),Vn=null}}const Av=async(ge,Ae)=>{const De=(Vn==null?void 0:Vn.url)||ye,et=((Vn==null?void 0:Vn.method)||"POST").toString().toUpperCase();let ht=((Vn==null?void 0:Vn.bodyType)||(Xr?"multipart":"json")).toString().toLowerCase();const Ie=Vn!=null&&Vn.headers&&typeof Vn.headers=="object"?{...Vn.headers}:{};let st=Vn&&Vn.body!==void 0?Vn.body:tr;st instanceof FormData&&(ht="multipart"),ge&&!Ie.Authorization&&!Ie.authorization&&(Ie.Authorization=`Bearer ${ge}`),ht==="json"&&!Ie["Content-Type"]&&!Ie["content-type"]&&(Ie["Content-Type"]="application/json"),ji&&oa&&Vl&&(Ie["X-ModelScope-Async-Mode"]="true");let Wt;De.startsWith("http")?Ae!==W&&De.includes(W)?Wt=De.replace(W,Ae):Wt=De:Wt=`${Ae.replace(/\/+$/,"")}${De.startsWith("/")?De:"/"+De}`,ht==="multipart"?(st=Mg(st),delete Ie["Content-Type"],delete Ie["content-type"]):ht==="raw"?typeof st!="string"&&(st=JSON.stringify(st??{})):ht==="json"&&!(st instanceof FormData)&&typeof st!="string"&&(st=JSON.stringify(st??{}));const Tt=vm(Wt,wr);return await fetch(Tt,{method:et,headers:Ie,body:st})},Qa=F&&F.includes(",")?F.split(",").map(ge=>ge.trim()).filter(ge=>ge):[F||Ns],Yc=U.includes(",")?U.split(",").map(ge=>ge.trim()).filter(ge=>ge):[(U||Ps).replace(/\/+$/,"")],Lf=ge=>{for(let Ae=ge.length-1;Ae>0;Ae--){const De=Math.floor(Math.random()*(Ae+1));[ge[Ae],ge[De]]=[ge[De],ge[Ae]]}return ge};Qa.length>1&&Lf(Qa),Yc.length>1&&Lf(Yc);let Es,se,Dt,Ct,Yn=!1;const rn=Rs.current||{},Pn=[];for(const ge of Qa)if(!rn[ge]&&!Na(ge))for(const Ae of Yc)Pn.push({key:ge,url:Ae});if(Pn.length===0&&Qa.length>0){console.warn("[Blacklist] All specified keys are blacklisted. Trying anyway with all available keys to avoid total failure.");for(const ge of Qa)for(const Ae of Yc)Pn.push({key:ge,url:Ae})}Pn.length>1&&Lf(Pn);for(const ge of Pn)try{if(Es=await Av(ge.key,ge.url),Es.status===401||Es.status===402||Es.status===403){const De=Es.status===402?" (402)":Es.status===401?" (401)":" (403)";console.warn(`[API Failover] Key ending in ...${ge.key.slice(-4)} failed with status ${Es.status}. Trying next...`),_s(ge.key,De),Ct=new Error(`API returned ${Es.status}: ${De}`);continue}Dt=await Es.text();try{se=JSON.parse(Dt)}catch{}let Ae=se==null?void 0:se.code;if(se!=null&&se.message&&typeof se.message=="string"){const De=se.message.match(/:\s*(\d+)/);De&&(Ae=parseInt(De[1],10))}if(di&&se&&se.code,di&&(Ae===1e3||se!=null&&se.message&&se.message.toLowerCase().includes("invalid parameter")))throw console.error(` [API Fatal]  (1000): ${se.message}`),new Error(`: ${se.message||"Invalid parameter"} ( 1000)`);if(di&&(Ae===34010105||se!=null&&se.message&&se.message.includes("34010105"))){console.warn(` [API Suspend] Key ending in ...${ge.key.slice(-4)}  (34010105) 60 `),Dd(ge.key," (34010105)",60*60*1e3),Ct=new Error(":  session ( 34010105)");continue}if(di&&Ae===1006){if(T0(),A0())throw new Error(" : ");const De=" (1006)";console.warn(` [API Blacklist] Key ending in ...${ge.key.slice(-4)}  (1006)`),_s(ge.key,De),Ct=new Error(`Jimeng Error: ${se.message||"Not enough credits"}`);continue}Yn=!0;break}catch(Ae){if(Ae.message.includes(j(""))||Ae.message.includes(j("")))throw Ae;console.warn(`[API Failover] Network/Parse request failed for ...${ge.key.slice(-4)}. Error: ${Ae.message}`),Ct=Ae}if(!Yn||!Es&&!Dt){const ge=Ct?Ct.message:"All API combinations failed.";throw new Error(ge)}if(!se&&Dt)try{se=JSON.parse(Dt)}catch{throw new Error(`: ${Dt.substring(0,100)}`)}if(!Es.ok){let ge=(se==null?void 0:se.message)||((vt=se==null?void 0:se.error)==null?void 0:vt.message)||Dt;throw Of&&Es.status===500&&(ge=`GPT - 4o (500): ${((Mt=se==null?void 0:se.error)==null?void 0:Mt.message)||(se==null?void 0:se.error)||(se==null?void 0:se.message)||Dt} 


1.API Key 
2.(${(Ve==null?void 0:Ve.modelName)||"gpt-4o-image"}) 
3.
4.`,Rt(De=>De.map(et=>et.id===pe?{...et,status:"failed",progress:0,errorMsg:ge}:et))),new Error(ge)}if(di&&(se==null?void 0:se.code)!==void 0&&se.code!==0&&se.code!==1&&se.code!==200)throw new Error(se.message||`API: ${se.code} `);if(Ni&&(se!=null&&se.task_id||typeof(se==null?void 0:se.data)=="string"&&se.data.startsWith("task-"))){const ge=se.task_id||se.data;Rt(Ae=>Ae.map(De=>De.id===pe?{...De,status:"generating",progress:10,remoteTaskId:ge}:De)),If(pe,ge,W,B,ie,Z,Be,0,!0);return}if(jn!=null&&jn.enabled){const ge=pE(se,jn.requestIdPaths);if(ge){const Ae=_u();Ae.requestId=ge,Rt(De=>De.map(et=>et.id===pe?{...et,status:"generating",progress:10,remoteTaskId:ge}:et)),Pf(pe,ge,jn,Ae,ie,Z,Be,wr,0);return}}let Fr=[];if(fo){let ge=null;const Ae=((Lt=(Et=se==null?void 0:se.choices)==null?void 0:Et[0])==null?void 0:Lt.message)||((me=(G=(wt=se==null?void 0:se.data)==null?void 0:wt.choices)==null?void 0:G[0])==null?void 0:me.message);(Ae==null?void 0:Ae.content)!==void 0?Array.isArray(Ae.content)?ge=Ae.content.map(De=>typeof(De==null?void 0:De.text)=="string"?De.text:"").filter(Boolean).join(`
`):ge=Ae.content:se!=null&&se.content?ge=se.content:se!=null&&se.text?ge=se.text:se!=null&&se.message?ge=typeof se.message=="string"?se.message:se.message.content:se!=null&&se.result?ge=typeof se.result=="string"?se.result:se.result.content:($e=se==null?void 0:se.data)!=null&&$e.content?ge=se.data.content:(jt=se==null?void 0:se.data)!=null&&jt.text?ge=se.data.text:(lt=se==null?void 0:se.data)!=null&&lt.message?ge=typeof se.data.message=="string"?se.data.message:se.data.message.content:(ir=se==null?void 0:se.data)!=null&&ir.result&&(ge=typeof se.data.result=="string"?se.data.result:se.data.result.content),ge&&typeof ge!="string"&&(ge=JSON.stringify(ge)),Fr=Zy(se,ge||"")}else if(ji){const ge=(se==null?void 0:se.task_id)||(se==null?void 0:se.taskId)||((Ht=se==null?void 0:se.data)==null?void 0:Ht.task_id)||((ae=se==null?void 0:se.output)==null?void 0:ae.task_id)||((He=se==null?void 0:se.output)==null?void 0:He.taskId),Ae=(se==null?void 0:se.output_images)||((Pe=se==null?void 0:se.output)==null?void 0:Pe.output_images)||((bt=se==null?void 0:se.data)==null?void 0:bt.output_images)||((rt=se==null?void 0:se.output)==null?void 0:rt.images)||((nt=(It=se==null?void 0:se.data)==null?void 0:It.output)==null?void 0:nt.output_images)||[];if(Fr=Array.isArray(Ae)?Ae.map(De=>typeof De=="string"?De:(De==null?void 0:De.url)||(De==null?void 0:De.image_url)||(De==null?void 0:De.imageUrl)||(De==null?void 0:De.path)||"").filter(Boolean):[],ge&&Fr.length===0){Rt(De=>De.map(et=>et.id===pe?{...et,status:"generating",progress:10,remoteTaskId:ge}:et)),$f(pe,ge,W,B,ie,Z,Be,wr,oa,0);return}}else if(po){const ge=new Set,Ae=(Ie,st="image/png")=>{if(Ie){if(typeof Ie=="string"){const Wt=Ie.trim();if(!Wt)return;if(Wt.startsWith("data:")||Wt.startsWith("http://")||Wt.startsWith("https://")){ge.add(Wt);return}if(/^[A-Za-z0-9+/=]+$/.test(Wt)&&Wt.length>64){const Ue=Fa(Wt,st);ge.add(`data:${Ue};base64,${Wt}`)}return}if(typeof Ie=="object"){const Wt=Ie.url||Ie.image_url||Ie.imageUrl||Ie.file_uri||Ie.fileUri||Ie.uri;if(Wt){ge.add(Wt);return}const Tt=Ie.data||Ie.base64||Ie.b64;if(Tt){const Ue=Fa(Tt,Ie.mime_type||Ie.mimeType||st);ge.add(`data:${Ue};base64,${Tt}`)}}}},De=Ie=>{if(!Ie||typeof Ie!="string")return;(Ie.match(/data:image\/[^;]+;base64,[A-Za-z0-9+/=]+/g)||[]).forEach(Tt=>ge.add(Tt)),(Ie.match(/https?:\/\/[^\s)]+/g)||[]).forEach(Tt=>{Tt.match(/\.(png|jpg|jpeg|webp|gif)(\?|#|$)/i)&&ge.add(Tt)})};[se==null?void 0:se.candidates,(Pt=se==null?void 0:se.data)==null?void 0:Pt.candidates,($t=se==null?void 0:se.response)==null?void 0:$t.candidates,(or=se==null?void 0:se.result)==null?void 0:or.candidates,(Yr=(Ur=se==null?void 0:se.data)==null?void 0:Ur.result)==null?void 0:Yr.candidates,(jr=se==null?void 0:se.output)==null?void 0:jr.candidates].forEach(Ie=>{Array.isArray(Ie)&&Ie.forEach(st=>{var Tt;(Array.isArray((Tt=st==null?void 0:st.content)==null?void 0:Tt.parts)?st.content.parts:Array.isArray(st==null?void 0:st.parts)?st.parts:[]).forEach(Ue=>{const Cr=(Ue==null?void 0:Ue.inline_data)||(Ue==null?void 0:Ue.inlineData);if(Cr!=null&&Cr.data){const Vr=Cr.mime_type||Cr.mimeType||"image/png",Gs=Cr.data,el=Gs.startsWith("data:")?Gs:`data:${Vr};base64,${Gs}`;ge.add(el)}const xr=(Ue==null?void 0:Ue.file_data)||(Ue==null?void 0:Ue.fileData);if(xr){const Vr=xr.file_uri||xr.fileUri||xr.uri;Vr&&ge.add(Vr)}Ue!=null&&Ue.data&&Ae(Ue.data,(Ue==null?void 0:Ue.mime_type)||(Ue==null?void 0:Ue.mimeType)||"image/png"),(Ue!=null&&Ue.image_url||Ue!=null&&Ue.imageUrl)&&Ae(Ue.image_url||Ue.imageUrl),Ue!=null&&Ue.text&&De(Ue.text)})})}),[se==null?void 0:se.images,se==null?void 0:se.image,(pn=se==null?void 0:se.data)==null?void 0:pn.images,(yt=se==null?void 0:se.data)==null?void 0:yt.image,(dr=se==null?void 0:se.result)==null?void 0:dr.images,(vr=se==null?void 0:se.result)==null?void 0:vr.image,(V=se==null?void 0:se.result)==null?void 0:V.output_images,(pt=(ft=se==null?void 0:se.result)==null?void 0:ft.output)==null?void 0:pt.output_images,(mt=(zt=se==null?void 0:se.data)==null?void 0:zt.result)==null?void 0:mt.images,(fr=(Jt=se==null?void 0:se.data)==null?void 0:Jt.result)==null?void 0:fr.output_images,(Qt=(Ne=(cr=se==null?void 0:se.data)==null?void 0:cr.result)==null?void 0:Ne.output)==null?void 0:Qt.output_images,se==null?void 0:se.output_images,(Pr=se==null?void 0:se.output)==null?void 0:Pr.images,(_r=se==null?void 0:se.output)==null?void 0:_r.output_images,(xe=se==null?void 0:se.data)==null?void 0:xe.output_images,(kt=(Ke=se==null?void 0:se.data)==null?void 0:Ke.output)==null?void 0:kt.output_images].forEach(Ie=>{Array.isArray(Ie)?Ie.forEach(st=>Ae(st)):Ie&&Ae(Ie)}),Fr=Array.from(ge).filter(Boolean)}if(Fr.length===0&&(se!=null&&se.data&&Array.isArray(se.data)?Fr=se.data.map(ge=>typeof ge=="string"?ge:ge?ge.url||ge.image_url||ge.imageUrl||(ge.b64_json?`data:${Fa(ge.b64_json)};base64,${ge.b64_json}`:null)||(ge.base64?`data:${Fa(ge.base64)};base64,${ge.base64}`:null):null).filter(ge=>typeof ge=="string"):(qt=se==null?void 0:se.data)!=null&&qt.data&&Array.isArray(se.data.data)&&(Fr=se.data.data.map(ge=>typeof ge=="string"?ge:ge?ge.url||ge.image_url||ge.imageUrl||(ge.b64_json?`data:${Fa(ge.b64_json)};base64,${ge.b64_json}`:null)||(ge.base64?`data:${Fa(ge.base64)};base64,${ge.base64}`:null):null).filter(Boolean))),Fr.length===0)throw console.warn("[Image Parse] URL",{keys:se&&typeof se=="object"?Object.keys(se):[],data:se}),new Error("URL");const $n=Fr[0],Xn=Date.now()-Qe,Zr=tn.current.get(pe);Zr&&(Zr.isImageMode?ar(Zr.nodeId,Zr.shotId,{output_images:Fr,output_url:Fr[0],selectedImageIndex:0,outputEnabled:!1,status:"done"}):console.warn("[V3.7.30 Debug] "),tn.current.delete(pe)),Rt(ge=>ge.map(De=>{if(De.id===pe){const et={...De,status:"completed",progress:100,url:$n,width:ie,height:Z,durationMs:Xn,output_images:Fr,mjImages:Fr.length>1?Fr:null,selectedMjImageIndex:0};return et.sourceNodeId&&!Zr&&setTimeout(()=>{Ki(pe,$n,"image",et.sourceNodeId,et.mjImages)},0),et}return De}));return}if(o==="video"){const ye=sr(k),tr=Array.isArray(ye==null?void 0:ye.customParams)?ye.customParams:[],Xr=(ye==null?void 0:ye.provider)||I.provider,Ve=(ye==null?void 0:ye.modelName)||"",Sr=Xr==="jimeng"||k.includes("jimeng")||Ve.includes("jimeng")||k.includes("dreamina")||Ve.includes("dreamina"),wr=Sr&&(k.includes("sora2")||Ve.includes("sora2")),ia=!Sr&&(k.includes("sora")||Ve.includes("sora")),oa=Xr==="grok"||k.includes("grok")||Ve.includes("grok"),Rf=!!I.useProxy,Hn=Gi(ye==null?void 0:ye.requestTemplate),Lm=!!(ye!=null&&ye.requestOverrideEnabled),Nu=Lo(ye==null?void 0:ye.requestOverridePatch),ki=Dt=>Gn(Dt,Rf),ji=Dt=>{const Ct=Hw(Dt,tr,T);return ye!=null&&ye.previewOverrideEnabled&&ye.previewOverridePatch&&$g(Ct,ye.previewOverridePatch),Ct};if(k.includes("veo")){const Dt=`${W}/v2/videos/generations`,Ct=Xt.get(u),rn=!!(ye!=null&&ye.supportsFirstLastFrame)&&!!((At=Ct==null?void 0:Ct.settings)!=null&&At.useFirstLastFrame||(Lr=Ct==null?void 0:Ct.settings)!=null&&Lr.veoFramesMode),Pn=rn?Wi(u,"veo_start"):null,Fr=rn?Wi(u,"veo_end"):null,$n=[Pn,Fr].filter(Boolean),Rr=($n.length>0?$n:y).slice(0,2),Xn=$n.length>0?$n[0]:b;let Zr=[];if(Rr&&Rr.length>0)Zr=await Promise.all(Rr.filter(et=>et&&typeof et=="string"&&et.trim().length>0).map(async et=>{const ht=et.trim();if(ht.startsWith("http://")||ht.startsWith("https://"))try{const Ie=await os(ht);return Ie.w>1920||Ie.h>1920?await Cm(ht,1920,1920):ht}catch(Ie){return console.warn("Veo: URL",Ie),ht}try{const Ie=await os(ht);return Ie.w>1920||Ie.h>1920?await Cm(ht,1920,1920):ht.startsWith("data:")?ht:ht.startsWith("blob:")?`data:image/png;base64,${await In(ht,{useProxy:ki(ht)})}`:ht.length>100&&!ht.includes("://")&&!ht.startsWith("data:")?`data:image/png;base64,${ht}`:`data:image/png;base64,${await In(ht,{useProxy:ki(ht)})}`}catch(Ie){throw console.error("Veo: Failed to process image:",Ie),new Error(`: ${ht.substring(0,50)}...`)}}));else if(Xn){const et=Xn.trim();try{const ht=await os(et);ht.w>1920||ht.h>1920?Zr=[await Cm(et,1920,1920)]:et.startsWith("http://")||et.startsWith("https://")?Zr=[et]:et.startsWith("data:")?Zr=[et]:et.startsWith("blob:")?Zr=[`data:image/png;base64,${await In(et,{useProxy:ki(et)})}`]:et.length>100&&!et.includes("://")&&!et.startsWith("data:")?Zr=[`data:image/png;base64,${et}`]:Zr=[`data:image/png;base64,${await In(et,{useProxy:ki(et)})}`]}catch(ht){throw console.error("Veo: Failed to process source image:",ht),new Error(`: ${ht.message} `)}}if(Zr.length===0&&((Rr==null?void 0:Rr.length)>0||Xn))throw console.error("Veo: images ",{effectiveConnectedImages:Rr,effectiveSourceImage:Xn}),new Error("");const ge=Zr.filter((et,ht)=>!et||typeof et!="string"?(console.warn(`Veo:  ${ht}: `),!1):et==="base64_data"||et.trim()==="base64_data"?(console.warn(`Veo:  ${ht}: base64_data`),!1):!0);if(ge.length===0&&((Rr==null?void 0:Rr.length)>0||Xn))throw console.error("Veo: ",{images:Zr,effectiveConnectedImages:Rr,effectiveSourceImage:Xn}),new Error("");let Ae=null;if(X&&X!=="Auto")if(X==="16:9"||X==="9:16")Ae=X;else{const et=ie/Z;Math.abs(et-16/9)<Math.abs(et-9/16)?Ae="16:9":Ae="9:16"}const De={model:(ye==null?void 0:ye.modelName)||"veo3.1",prompt:r,enhance_prompt:!1,images:ge.length>0?ge:[],...Ae?{aspect_ratio:Ae}:{}};ji(De),console.log("Veo: ",{endpoint:Dt,model:De.model,prompt:((hr=De.prompt)==null?void 0:hr.substring(0,50))+"...",imagesCount:De.images.length,firstImageType:De.images[0]?De.images[0].startsWith("http")?"HTTP URL":De.images[0].startsWith("data:")?"Data URL":"Unknown":"empty",firstImagePreview:De.images[0]?De.images[0].startsWith("http")?De.images[0].substring(0,80):De.images[0].substring(0,100):"empty",aspect_ratio:De.aspect_ratio,payloadSize:JSON.stringify(De).length});try{const et=await fetch(Dt,{method:"POST",headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"},body:JSON.stringify(De)}),ht=await et.text();if(!et.ok)throw console.error("Veo: ",{status:et.status,text:ht}),new Error(ht||`Veo error: ${et.status} `);const Ie=JSON.parse(ht),st=((gr=Ie==null?void 0:Ie.data)==null?void 0:gr.id)||(Ie==null?void 0:Ie.id)||(Ie==null?void 0:Ie.task_id)||((Fn=Ie==null?void 0:Ie.data)==null?void 0:Fn.task_id);if(!st)throw console.error("Veo:  JobId",Ie),new Error("Veo No JobId");Rt(Wt=>Wt.map(Tt=>Tt.id===pe?{...Tt,status:"generating",progress:10}:Tt)),Ya(st,pe,W,B,ie,Z);return}catch(et){throw console.error("Veo: ",et),Rt(ht=>ht.map(Ie=>Ie.id===pe?{...Ie,status:"failed",errorMsg:et.message||""}:Ie)),et}}let po="",fo;const Vl={Authorization:`Bearer ${B}`},ws=(()=>{if(te==null)return 8;const Dt=String(te).trim().replace(/[^\d]/g,""),Ct=parseInt(Dt,10);return Number.isFinite(Ct)&&Ct>0?Ct:8})();if(oa){const Dt=`${W}/v2/videos/generations`,Ct=parseInt(te,10),Yn=X&&X!=="Auto"?X:"3:2",rn=J&&J!=="Auto"?J:"1080P",Pn={model:(ye==null?void 0:ye.modelName)||"grok-video-3",prompt:r,ratio:Yn,resolution:rn};if(Number.isFinite(Ct)&&Ct>0&&(Pn.duration=Ct),b)try{let Zr="";if(b.startsWith("data:"))Zr=b;else{const ge=await Un(b,{useProxy:ki(b)});Zr=await new Promise((Ae,De)=>{const et=new FileReader;et.onloadend=()=>Ae(et.result),et.onerror=De,et.readAsDataURL(ge)})}Pn.images=[Zr]}catch(Zr){console.error("Grok Image Conversion Failed:",Zr),alert(j(""));return}ji(Pn);const Fr=await fetch(Dt,{method:"POST",headers:{Authorization:`Bearer ${B}`,"Content-Type":"application/json"},body:JSON.stringify(Pn)}),$n=await Fr.text();if(!Fr.ok)throw console.error("[Grok API Error]",$n),new Error($n||`Grok API error: ${Fr.status} `);let Rr;try{Rr=JSON.parse($n)}catch{throw new Error("API  JSON ")}const Xn=((Dr=Rr==null?void 0:Rr.data)==null?void 0:Dr.id)||(Rr==null?void 0:Rr.id)||(Rr==null?void 0:Rr.task_id);if(!Xn)throw console.error("Grok No Task ID:",Rr),new Error("API  Task ID");Rt(Zr=>Zr.map(ge=>ge.id===pe?{...ge,status:"generating",progress:10,remoteTaskId:Xn}:ge)),Ll(Xn,pe,W,B,ie,Z,k);return}if(Sr){po=`${W}/v1/videos/generations`;const Dt=Array.isArray(ye==null?void 0:ye.durations)?ye.durations.map(Ie=>od(Ie,ws)).filter(Ie=>Number.isFinite(Ie)):wr?[4,8,12]:[5,10],Ct=gh(ws,Dt),Yn=wr?{defaultRatio:"auto",allowedRatios:["16:9","9:16","auto"]}:{defaultRatio:"1:1"},rn=hh(X,Yn),Pn=(ye==null?void 0:ye.modelName)||k||"jimeng-video-3.0",Fr=Uw(Pn),$n=Fr?mh(J):"",Xn=!!(ye!=null&&ye.supportsFirstLastFrame)&&!!((fn=w==null?void 0:w.settings)!=null&&fn.useFirstLastFrame||(mr=w==null?void 0:w.settings)!=null&&mr.veoFramesMode),Zr=Xn?Wi(u,"veo_start"):null,ge=Xn?Wi(u,"veo_end"):null,Ae=[Zr,ge].filter(Boolean),De=y.filter(Boolean),ht=(Ae.length>0?Ae:De).slice(0,wr?1:2);if(!r||!r.trim())throw new Error("");if(ht.length>0){const Ie=new FormData;Ie.append("model",Pn),Ie.append("prompt",r),Ie.append("duration",String(Ct)),Ie.append("ratio",rn),Fr&&$n&&Ie.append("resolution",$n);const st=await Promise.all(ht.map(async Cr=>{const xr=await Un(Cr,{useProxy:ki(Cr)});return await fm(xr)}));st[0]&&Ie.append("image_file_1",st[0],"first.png"),st[1]&&Ie.append("image_file_2",st[1],"last.png"),ji(Ie),wr&&(Ie.delete("image_file_2"),Ie.delete("image_file_3"));const Wt=gh(Ie.get("duration"),Dt);Wt&&Ie.set("duration",String(Wt));const Tt=hh(Ie.get("ratio")||rn||Yn.defaultRatio,Yn);wr&&Tt==="auto"?Ie.delete("ratio"):Ie.set("ratio",Tt);const Ue=Fr?mh(Ie.get("resolution")||$n):"";Fr&&Ue?Ie.set("resolution",Ue):Ie.delete("resolution"),console.log("[Jimeng Video] request",{model:Pn,mode:"image",images:ht.length,duration:Ie.get("duration"),ratio:Ie.get("ratio")||"auto",resolution:Ie.get("resolution")||"n/a"}),fo=Ie}else{Vl["Content-Type"]="application/json";const Ie={model:Pn,prompt:r,duration:Ct};wr&&rn==="auto"||(Ie.ratio=rn),Fr&&$n&&(Ie.resolution=$n),ji(Ie);const st=gh(Ie.duration,Dt);st&&(Ie.duration=st);const Wt=hh(Ie.ratio||rn||Yn.defaultRatio,Yn);wr&&Wt==="auto"?delete Ie.ratio:Ie.ratio=Wt;const Tt=Fr?mh(Ie.resolution||$n):"";Fr&&Tt?Ie.resolution=Tt:delete Ie.resolution,console.log("[Jimeng Video] request",{model:Pn,mode:"text",images:0,duration:Ie.duration,ratio:Ie.ratio||"auto",resolution:Ie.resolution||"n/a"}),fo=JSON.stringify(Ie)}}else if(b){const Dt=new FormData,Ct=await Un(b,{useProxy:ki(b)});if(ia){po=`${W}/v1/videos/generations`;let Yn=r.replace(/@\{([^\}]+)\}/g,(rn,Pn)=>`@${Pn} `);Dt.append("model",(ye==null?void 0:ye.modelName)||"sora-2"),Dt.append("prompt",Yn),Dt.append("seconds",te),Dt.append("size",ne),ye!=null&&ye.supportsHD&&(p.isHD||(Tr=w==null?void 0:w.settings)!=null&&Tr.isHD)&&Dt.append("quality","hd"),Dt.append("input_reference",Ct,"ref.png"),Dt.append("image",Ct,"ref.png")}else oa?(po=`${W}/v1/videos/generations`,Dt.append("model",(ye==null?void 0:ye.modelName)||"grok-video-3"),Dt.append("prompt",r),Dt.append("aspect_ratio",X),Dt.append("duration",ws),Dt.append("image",Ct,"input.png")):(po=`${W}/v1/videos/generations`,Dt.append("model",ye==null?void 0:ye.modelName),Dt.append("prompt",r),Dt.append("image",Ct,"input.png"),Dt.append("size",ne));ji(Dt),fo=Dt}else if(Vl["Content-Type"]="application/json",ia){delete Vl["Content-Type"],po=`${W}/v1/videos/generations`;const Dt=new FormData;let Ct=r.replace(/@\{([^\}]+)\}/g,(Yn,rn)=>`@${rn} `);Dt.append("model",(ye==null?void 0:ye.modelName)||"sora-2"),Dt.append("prompt",Ct),Dt.append("seconds",te),Dt.append("size",ne),ye!=null&&ye.supportsHD&&(p.isHD||(Nr=w==null?void 0:w.settings)!=null&&Nr.isHD)&&Dt.append("quality","hd"),ji(Dt),fo=Dt}else if(oa){po=`${W}/v1/videos/generations`;const Dt={model:(ye==null?void 0:ye.modelName)||"grok-video-3",prompt:r,aspect_ratio:X,duration:ws};ji(Dt),fo=JSON.stringify(Dt)}else{po=`${W}/v1/videos/generations`;const Dt={model:ye==null?void 0:ye.modelName,prompt:r,resolution:ne};ji(Dt),fo=JSON.stringify(Dt)}let jn=null;if(Hn!=null&&Hn.enabled){const Dt=async()=>{var et,ht,Ie;const Ct={modelName:(ye==null?void 0:ye.modelName)||k,prompt:r||"",ratio:X,resolution:J,size:ne,duration:ws,durationNumber:ws,seed:(et=w==null?void 0:w.settings)==null?void 0:et.seed,provider:{key:B,baseUrl:W,id:I.provider,useProxy:Rf}};if(Sr){const st=Array.isArray(ye==null?void 0:ye.durations)?ye.durations.map(el=>od(el,ws)).filter(el=>Number.isFinite(el)):wr?[4,8,12]:[5,10],Wt=wr?{defaultRatio:"auto",allowedRatios:["16:9","9:16","auto"]}:{defaultRatio:"1:1"},Tt=gh(ws,st),Ue=hh(X,Wt),Cr=wr&&Ue==="auto"?void 0:Ue,xr=Uw((ye==null?void 0:ye.modelName)||k||""),Vr=xr?mh(J):"",Gs=xr&&Vr?Vr:void 0;Ct.jimengDuration=Tt,Ct.jimengRatio=Cr,Ct.jimengResolution=Gs}const rn=(y.length>0?y:b?[b]:[]).filter(Boolean),Fr=!!(ye!=null&&ye.supportsFirstLastFrame)&&!!((ht=w==null?void 0:w.settings)!=null&&ht.useFirstLastFrame||(Ie=w==null?void 0:w.settings)!=null&&Ie.veoFramesMode),$n=Fr?Wi(u,"veo_start"):null,Rr=Fr?Wi(u,"veo_end"):null,Xn=$n||rn[0]||null,Zr=Rr||rn[1]||null;rn.length>0&&(Ct.imageUrl=rn[0],Ct.imageUrls=rn,Ct.imagesUrl=rn,Ct.imagesUrls=rn),Ct.firstFrameUrl=Xn,Ct.lastFrameUrl=Zr;const ge=JSON.stringify(Hn||{}),Ae=((Hn==null?void 0:Hn.bodyType)||"").toLowerCase()==="multipart"||/:blob\s*}}/.test(ge),De=/:blob\s*}}/.test(ge);if(Ae&&rn.length>0){const st=new Map,Wt=await Promise.all(rn.map(async Ue=>{const Cr=await Un(Ue,{useProxy:ki(Ue)}),xr=Sr?await fm(Cr):Cr;return st.set(Ue,xr),xr})),Tt=async Ue=>{if(!Ue)return null;if(st.has(Ue))return st.get(Ue);const Cr=await Un(Ue,{useProxy:ki(Ue)}),xr=Sr?await fm(Cr):Cr;return st.set(Ue,xr),xr};Ct.imageBlob=Wt[0],Ct.imageBlobs=Wt,Ct.imagesBlob=Wt,Ct.firstFrameBlob=await Tt(Xn),Ct.lastFrameBlob=await Tt(Zr)}if(De&&rn.length>0){const st=new Map,Wt=await Promise.all(rn.map(async Ue=>{if(!Ue)return"";if(Ue.startsWith("data:"))return Ue;const Cr=await In(Ue,{useProxy:ki(Ue)}),xr=lo(Ue,".png"),Gs=`data:${xr===".jpg"||xr===".jpeg"?"image/jpeg":xr===".webp"?"image/webp":"image/png"};base64,${Cr}`;return st.set(Ue,Gs),Gs}));Ct.imageDataUrl=Wt[0],Ct.imageDataURL=Wt[0],Ct.imageDataUrls=Wt,Ct.imagesDataUrl=Wt,Ct.imagesDataURL=Wt;const Tt=async Ue=>{if(!Ue)return"";if(st.has(Ue))return st.get(Ue);if(Ue.startsWith("data:"))return Ue;const Cr=await In(Ue,{useProxy:ki(Ue)}),xr=lo(Ue,".png"),Gs=`data:${xr===".jpg"||xr===".jpeg"?"image/jpeg":xr===".webp"?"image/webp":"image/png"};base64,${Cr}`;return st.set(Ue,Gs),Gs};Ct.firstFrameDataUrl=await Tt(Xn),Ct.firstFrameDataURL=Ct.firstFrameDataUrl,Ct.lastFrameDataUrl=await Tt(Zr),Ct.lastFrameDataURL=Ct.lastFrameDataUrl}return tr.length>0&&T&&tr.forEach(st=>{const Wt=String((st==null?void 0:st.name)||"").trim();if(!Wt)return;const Tt=ad(st,T);Tt===""||Tt===void 0||Tt===null||(Ct[Wt]=Tt)}),Ct};try{const Ct=await Dt(),Yn=sd(Hn,Ct,{bodyType:Hn.bodyType});Yn&&Yn.url&&(jn=Lm&&Nu?Tg({...Yn},Nu):Yn)}catch(Ct){console.warn("[RequestTemplate] :",Ct),jn=null}}const Dm=(jn==null?void 0:jn.url)||po,Of=((jn==null?void 0:jn.method)||"POST").toString().toUpperCase();let Wl=((jn==null?void 0:jn.bodyType)||(fo instanceof FormData?"multipart":"json")).toString().toLowerCase();const Ni=jn!=null&&jn.headers&&typeof jn.headers=="object"?{...jn.headers}:{...Vl};let Si=jn&&jn.body!==void 0?jn.body:fo;Si instanceof FormData&&(Wl="multipart"),B&&!Ni.Authorization&&!Ni.authorization&&(Ni.Authorization=`Bearer ${B}`),Wl==="json"&&!Ni["Content-Type"]&&!Ni["content-type"]&&(Ni["Content-Type"]="application/json"),Wl==="multipart"?(Si=Mg(Si),delete Ni["Content-Type"],delete Ni["content-type"]):Wl==="raw"?typeof Si!="string"&&(Si=JSON.stringify(Si??{})):Wl==="json"&&!(Si instanceof FormData)&&typeof Si!="string"&&(Si=JSON.stringify(Si??{}));let di=Dm;di.startsWith("http")||(di=`${W.replace(/\/+$/,"")}${di.startsWith("/")?di:"/"+di}`);const Gc=await fetch(di,{method:Of,headers:Ni,body:Si}),Um=await Gc.text();if(!Gc.ok)throw new Error(Um||`Video API error: ${Gc.status} `);const lr=JSON.parse(Um),Su=(lr==null?void 0:lr.code)||((on=lr==null?void 0:lr.data)==null?void 0:on.code),Mn=(lr==null?void 0:lr.message)||((Bn=lr==null?void 0:lr.data)==null?void 0:Bn.message)||"";let _u=Su;const Vn=Mn.match(/[:]\s*(\d+)/);if(Vn&&(_u=parseInt(Vn[1],10)),_u===1e3)throw console.error(` [Video API]  (1000): ${Mn}`),new Error(`: ${Mn||"Invalid parameter"} ( 1000)`);const Qa=_u===1006,Yc=Su===-2001&&Mn.includes("34010105");if(Su===-2008||Mn.includes("2060")){let Dt=" ";throw Mn.includes(": 30")&&(Dt+="\\n\\n \\n \\n \\n \\n "),Mn.includes("2060")&&(Dt+="\\n\\n: 2060 ()"),new Error(Dt)}if(Qa||Yc){const Dt=Qa?" (1006)":" (34010105)";console.warn(` [Video API] Key ending in ...${B.slice(-4)} failed: ${Dt}. Adding to blacklist.`),_s(B,Dt);const Ct=new Error(`RETRY_WITH_NEW_KEY: ${Mn}`);throw Ct.shouldRetry=!0,Ct}const Es=(lr==null?void 0:lr.video_url)||(lr==null?void 0:lr.url)||((an=lr==null?void 0:lr.data)==null?void 0:an.video_url)||((ci=lr==null?void 0:lr.data)==null?void 0:ci.url)||Array.isArray(lr==null?void 0:lr.data)&&((Ji=lr.data[0])==null?void 0:Ji.url);if(Es){const Dt=Date.now(),Ct=co.get(pe),Yn=Ct==null?void 0:Ct.sourceNodeId,rn=Dt-((Ct==null?void 0:Ct.startTime)||Dt);Rt(Pn=>{const Fr=Pn.map(Rr=>Rr.id===pe?{...Rr,status:"completed",progress:100,url:Es,width:ie,height:Z,durationMs:rn}:Rr),$n=tn.current.get(pe);if($n)ar($n.nodeId,$n.shotId,{video_url:Es,status:"done",durationCost:rn/1e3}),tn.current.delete(pe);else{const Rr=Fr.find(Xn=>Xn.id===pe);Rr!=null&&Rr.sourceNodeId?setTimeout(()=>{Ki(pe,Es,"video",Rr.sourceNodeId)},0):console.warn("[Tapnow] :  sourceNodeId",{taskId:pe,updatedItem:Rr})}return Fr});return}const se=((Ev=lr==null?void 0:lr.data)==null?void 0:Ev.id)||(lr==null?void 0:lr.id)||(lr==null?void 0:lr.task_id)||((Iv=lr==null?void 0:lr.data)==null?void 0:Iv.task_id)||(lr==null?void 0:lr.job_id)||((Pv=lr==null?void 0:lr.data)==null?void 0:Pv.job_id);if(!se)throw new Error(`No Task/Job ID returned. Response: ${JSON.stringify(lr).substring(0,200)}`);k.includes("veo")?Ya(se,pe,W,B,ie,Z):Ll(se,pe,W,B,ie,Z,k)}}catch(ye){if(ye.shouldRetry)return Dl(r,o,l,u,{...p,_isRetry:!0,_existingTaskId:pe});console.error("[CONSOLE_ERROR]",ye);const tr=Date.now(),Xr=Bt.find(wr=>wr.id===pe),Ve=Xr!=null&&Xr.startTime?tr-Xr.startTime:0;let Sr=(ye==null?void 0:ye.message)||"";try{if(typeof Sr=="string"&&Sr.trim().startsWith("{")){const wr=JSON.parse(Sr);($v=wr==null?void 0:wr.error)!=null&&$v.message?Sr=wr.error.message:wr!=null&&wr.error?Sr=typeof wr.error=="string"?wr.error:JSON.stringify(wr.error):wr!=null&&wr.message&&(Sr=wr.message)}(Sr.includes("Cannot find module")||Sr.includes("octetstream")||Sr.includes("MODULE_NOT_FOUND"))&&(!Sr.includes("API")&&!Sr.includes("")?Sr=` API

${Sr.replace(/[:].*?[:]/g,"").trim()} 

 
1.jimeng - api.exe
2.Dockerdocker pull ghcr.io / iptag / jimeng - api: latest`:Sr.includes("")||(Sr=Sr+`

 
1. jimeng-api.exe
2. Dockerdocker pull ghcr.io/iptag/jimeng-api:latest`))}catch{(Sr.includes("Cannot find module")||Sr.includes("octetstream")||Sr.includes("MODULE_NOT_FOUND"))&&!Sr.includes("API")&&!Sr.includes("")&&(Sr=` API

 
1.jimeng - api.exe
2.Dockerdocker pull ghcr.io / iptag / jimeng - api: latest`)}Rt(wr=>wr.map(ia=>ia.id===pe?{...ia,status:"failed",errorMsg:Sr,durationMs:Ve}:ia))}},pN=()=>{t(r=>r==="dark"?"light":r==="light"?"solarized":"dark")},fN=async(r,o={})=>{if(!r||r.startsWith("data:"))return r;const u=(Kt?vn.get(r)||(so.current.has(r)?so.current.get(r):null):null)||r,p=Gn(u,o.useProxy===!0),f=await Un(u,{useProxy:p});return await Eo(f)},hN=async()=>{const r=qs.current,o=Po.current,l=vi.current,u=r.filter(p=>(o===p.id||l&&l.has(p.id))&&(p.type==="input-image"||p.type==="video-input"||p.type==="preview")&&p.content);if(u.length===0){alert(j(""));return}for(const p of u)try{const f=p.content;if(!f||typeof f!="string"&&!f.startsWith("data:")){console.warn(` ${p.id} URL: `,f);continue}const m=Gn(f,!1),y=await Un(f,{useProxy:m}),b=URL.createObjectURL(y),w=document.createElement("a");w.href=b;let v=".png";p.type==="preview"?p.previewType==="video"?v=".mp4":v=ur(f)?".mp4":".png":p.type==="video-input"?v=".mp4":v=ur(f)?".mp4":".png";const z=`${p.id}${v} `;w.download=z,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(b),await new Promise(k=>setTimeout(k,100))}catch(f){console.error(` ${p.id} : `,f)}},qc=()=>{const r=new Date;return new Date(r.getTime()+8*60*60*1e3).toISOString()},Ul=()=>{const r=new Date,o=new Date(r.getTime()+8*60*60*1e3),l=o.getUTCFullYear(),u=String(o.getUTCMonth()+1).padStart(2,"0"),p=String(o.getUTCDate()).padStart(2,"0"),f=String(o.getUTCHours()).padStart(2,"0"),m=String(o.getUTCMinutes()).padStart(2,"0"),y=String(o.getUTCSeconds()).padStart(2,"0");return`${l} -${u} -${p}T${f} -${m} -${y} `},mN=r=>!r||typeof r!="string"?!1:r.startsWith("data:image/")||r.startsWith("data:video/")||r.startsWith("blob:")?!0:/\.(png|jpg|jpeg|webp|gif|mp4|webm|mov)(\?|$)/i.test(r),Xa=(r,o)=>{if(r){if(typeof r=="string"){mN(r)&&o.add(r);return}if(Array.isArray(r)){r.forEach(l=>Xa(l,o));return}typeof r=="object"&&Object.values(r).forEach(l=>Xa(l,o))}},$m=(r,o)=>{if(!r)return r;if(typeof r=="string"){const l=o.get(r);return l?`asset://${l}`:r}if(Array.isArray(r))return r.map(l=>$m(l,o));if(typeof r=="object"){const l={};return Object.entries(r).forEach(([u,p])=>{l[u]=$m(p,o)}),l}return r},gN=async(r,o={})=>{const l=new ph,u=new Map,p={},f="assets",m=typeof o.onProgress=="function"?o.onProgress:null,y=new Set,b=J=>{!J||typeof J!="string"||y.add(J)};Bt.forEach(J=>{J&&(Array.isArray(J.mjImages)&&J.mjImages.forEach(b),Array.isArray(J.output_images)&&J.output_images.forEach(b),[J.url,J.originalUrl,J.mjOriginalUrl,J.thumbnailUrl,J.localCacheUrl].forEach(b),J.localCacheMap&&Object.keys(J.localCacheMap).forEach(b))}),Xa(g,y),Xa(qr,y),Xa(Jn,y);const w=Math.max(y.size,1);let v=0;const z=new Set,k=()=>{m&&m({current:v,total:w,filename:o.filename||""})};k();let T=0;const I=async(J,Y,ne={})=>{if(!J||u.has(J)||z.has(J))return;z.add(J),v=z.size,k();const ie=Y||J;try{let Z;if(ie.startsWith("data:"))Z=Ql(ie);else{const{blob:it}=await Bi(ie,{useProxy:ne.useProxy===!0,preferLocal:!0});Z=it}if(!Z||Z.size===0)return;const te=lo(ie,""),Te=(ie.startsWith("data:")?ra(ie,""):"")||te||(Z.type?`.${Z.type.split("/")[1]}`:"")||(ne.type==="video"?".mp4":".png"),Be=`${Ls(ne.cacheId||yi(J,ne.itemId||"asset"))||`asset_${T++}`}${ne.suffix||""}${Te}`,Le=`${f}/${Be}`;l.file(Le,Z),u.set(J,Le),p[J]=Le,Y&&Y!==J&&(u.set(Y,Le),p[Y]=Le)}catch(Z){console.warn(":",J,Z)}};for(const J of Bt){if(!J)continue;const Y=ps(J),ne=async(Z,te="")=>{if(Array.isArray(Z))for(let pe=0;pe<Z.length;pe++){const Te=Z[pe];if(!Te||typeof Te!="string")continue;const Qe=Ar(J,Te)||Te,Be=Gn(Qe,Y);await I(Te,Qe,{useProxy:Be,itemId:J.id,cacheId:yi(Te,J.id),suffix:te?`${te}${pe+1}`:`_${pe+1}`,type:J.type})}};await ne(J.mjImages,"_mj_"),await ne(J.output_images,"_out_");const ie=[J.url,J.originalUrl,J.mjOriginalUrl,J.thumbnailUrl,J.localCacheUrl].filter(Boolean);for(const Z of ie){const te=Ar(J,Z)||Z,pe=Gn(te,Y);await I(Z,te,{useProxy:pe,itemId:J.id,cacheId:yi(Z,J.id),type:J.type})}if(J.localCacheMap)for(const[Z,te]of Object.entries(J.localCacheMap)){const pe=Gn(te,Y);await I(Z,te,{useProxy:pe,itemId:J.id,cacheId:yi(Z,J.id),type:J.type})}}const F=new Set;Xa(g,F),Xa(qr,F),Xa(Jn,F);for(const J of F)J&&await I(J,J,{useProxy:!1,cacheId:yi(J,"node"),type:ur(J)?"video":"image"});const B=$m(r,u);B.assetBundle=!0,B.assetManifest=p,l.file("project.json",JSON.stringify(B,(J,Y)=>Y===void 0?null:Y,2)),l.file("manifest.json",JSON.stringify({assets:p},null,2));const U=await l.generateAsync({type:"blob"}),W=Ul(),X=`${cs||""}_${W}.zip`;if(o.handle){const J=await o.handle.createWritable();await J.write(U),await J.close()}else Cg.saveAs(U,X);return X},iv=M.useCallback(async()=>{try{localStorage.removeItem(ql)}catch{}try{Gu(null)}catch{}try{const r=await Jb();await new Promise(o=>{const l=r.transaction(vl,"readwrite"),p=l.objectStore(vl).delete(Kb);p.onsuccess=()=>o(!0),p.onerror=()=>o(!1),l.oncomplete=()=>r.close(),l.onerror=()=>r.close()})}catch{}},[]),ov=M.useCallback(async(r={})=>{x([]),C([]),Rt([]),Gd(new Set),le(null),ss(new Set),$([]),S([]),gn(null),gc(""),Ce({...td}),Pa([{id:"default",title:j(""),messages:[]}]),wc("default"),B0(""),Ui([]),$l([]),ze([]),re([]),r.keepAssetBundle||F0(),r.keepAutoSave||await iv();try{localStorage.removeItem("tapnow_project_name")}catch{}},[F0,iv]),Am=async()=>{const r=ce;if(r){const u=async(p,f,m)=>{xs({active:!0,current:0,total:1,filename:f});try{await gN(p,{handle:m,filename:f,onProgress:({current:y,total:b,filename:w})=>{xs({active:!0,current:y,total:Math.max(b||0,1),filename:w||f})}})}finally{xs(y=>({...y,active:!1}))}};try{if(window.showSaveFilePicker){const y=Ul(),b=`${cs||""}_${y}.zip`,w=await window.showSaveFilePicker({suggestedName:b,types:[{description:"Tapnow Bundle",accept:{"application/zip":[".zip"]}}]}),v={version:"2.5.7",projectName:cs,theme:e,nodes:g,connections:N,view:E,history:Bt,chatSessions:Jn,characterLibrary:qr,modelLibrary:Oe,timestamp:qc()};await u(v,b,w),alert(j(""));return}const p=Ul(),f=`${cs||""}_${p}.zip`,m={version:"2.5.7",projectName:cs,theme:e,nodes:g,connections:N,view:E,history:Bt,chatSessions:Jn,characterLibrary:qr,modelLibrary:Oe,timestamp:qc()};await u(m,f),alert(j(""));return}catch(p){console.error(":",p),alert(`: ${p.message||p}`);return}}const o=async(u,p,f=!1)=>{if(!u||typeof u!="string")return u;if(u.startsWith("data:"))return yo(u);if(!f&&!r)return u;try{const m=ps(p),y=Gn(u,m),{blob:b}=await Bi(u,{useProxy:y,preferLocal:!0});if(!b)return u;const w=await Eo(b);return yo(w)}catch(m){return console.error(":",m),u}},l=async u=>{const p={...u};if(p.url&&typeof p.url=="string"){const f=p.url.startsWith("blob:");p.url=await o(p.url,p,f)}if(p.mjOriginalUrl&&typeof p.mjOriginalUrl=="string"){const f=p.mjOriginalUrl.startsWith("blob:");p.mjOriginalUrl=await o(p.mjOriginalUrl,p,f)}if(p.originalUrl&&typeof p.originalUrl=="string"){const f=p.originalUrl.startsWith("blob:");p.originalUrl=await o(p.originalUrl,p,f)}if(p.thumbnailUrl&&typeof p.thumbnailUrl=="string"){const f=p.thumbnailUrl.startsWith("blob:");p.thumbnailUrl=await o(p.thumbnailUrl,p,f)}if(Array.isArray(p.mjImages))for(let f=0;f<p.mjImages.length;f++){const m=p.mjImages[f];if(m&&typeof m=="string"){const y=m.startsWith("blob:");p.mjImages[f]=await o(m,p,y)}}if(Array.isArray(p.output_images))for(let f=0;f<p.output_images.length;f++){const m=p.output_images[f];if(m&&typeof m=="string"){const y=m.startsWith("blob:");p.output_images[f]=await o(m,p,y)}}return p};try{if(!window.showSaveFilePicker){if(!confirm(`

/>500MB Chrome  Edge 

`))return;const v=(Z,te)=>te===void 0?null:te,z=JSON.parse(JSON.stringify(g,v)),k=async Z=>{if(Z==null)return Z;if(typeof Z=="string"&&Z.startsWith("blob:"))try{const te=await Un(Z);return await Eo(te)}catch(te){return console.error(" Blob URL :",te),Z}if(Array.isArray(Z))return await Promise.all(Z.map(te=>k(te)));if(typeof Z=="object"){const te={};for(const pe in Z)Z.hasOwnProperty(pe)&&(te[pe]=await k(Z[pe]));return te}return Z},T=await k(z),I=JSON.parse(JSON.stringify(qr,v)),F=await k(I),B=r?await Promise.all(Bt.map(Z=>l(Z))):Bt,U={version:"2.5.7",projectName:cs,theme:e,nodes:T,connections:N,view:E,history:B,chatSessions:Jn,characterLibrary:F,modelLibrary:Oe,timestamp:qc()},W=JSON.stringify(U,v,2),X=new Blob([W],{type:"application/json"}),J=URL.createObjectURL(X),Y=document.createElement("a");Y.href=J;const ne=Ul(),ie=`${cs||""}_${ne}.json`;Y.download=ie,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(J),alert(j(""));return}const u=Ul(),f=await(await window.showSaveFilePicker({suggestedName:`${cs||""}_${u}.json`,types:[{description:"JSON File",accept:{"application/json":[".json"]}}]})).createWritable(),m=(w,v)=>v===void 0?null:v,y=async w=>{const v={...w};if(v.content&&typeof v.content=="string"&&v.content.startsWith("blob:"))try{const z=await In(v.content),k=ur(v.content)?"video/mp4":"image/png";v.content=`data:${k};base64,${z}`}catch(z){console.error(" content :",z)}if(v.maskContent&&typeof v.maskContent=="string"&&v.maskContent.startsWith("blob:"))try{const z=await In(v.maskContent);v.maskContent=`data:image/png;base64,${z}`}catch(z){console.error(" maskContent :",z)}if(Array.isArray(v.selectedKeyframes))for(let z=0;z<v.selectedKeyframes.length;z++){const k=v.selectedKeyframes[z];if(k&&k.url&&typeof k.url=="string"&&k.url.startsWith("blob:"))try{const T=await In(k.url);k.url=`data:image/png;base64,${T}`}catch(T){console.error(":",T)}}if(Array.isArray(v.frames))for(let z=0;z<v.frames.length;z++){const k=v.frames[z];if(k&&k.url&&typeof k.url=="string"&&k.url.startsWith("blob:"))try{const T=await In(k.url);k.url=`data:image/png;base64,${T}`}catch(T){console.error(":",T)}}if(Array.isArray(v.previewMjImages))for(let z=0;z<v.previewMjImages.length;z++){const k=v.previewMjImages[z];if(k&&typeof k=="string"&&k.startsWith("blob:"))try{const T=await In(k);v.previewMjImages[z]=`data:image/png;base64,${T}`}catch(T){console.error(" previewMjImages :",T)}}return v},b=async w=>{const v={...w};if(v.avatar&&typeof v.avatar=="string"&&v.avatar.startsWith("blob:"))try{const z=await In(v.avatar);v.avatar=`data:image/png;base64,${z}`}catch(z){console.error(" avatar :",z)}if(v.profile_picture_url&&typeof v.profile_picture_url=="string"&&v.profile_picture_url.startsWith("blob:"))try{const z=await In(v.profile_picture_url);v.profile_picture_url=`data:image/png;base64,${z}`}catch(z){console.error(" profile_picture_url :",z)}return v};await f.write(`{
    
  "version": "2.5.7", 
  "projectName": ${JSON.stringify(cs||"")}, 
  "theme": ${JSON.stringify(e||"dark")}, 
  "nodes": [
`);for(let w=0;w<g.length;w++){const v=g[w],z=await y(v),k=JSON.stringify(z,m,2),T=w===0?k.split(`
`).join(`
    `):"    "+k.split(`
`).join(`
    `);await f.write(T),w<g.length-1?await f.write(`,
`):await f.write(`
`)}await f.write(`  ], 
  "connections": ${JSON.stringify(N,m,2)}, 
  "view": ${JSON.stringify(E,m,2)}, 
  "history": [
`);for(let w=0;w<Bt.length;w++){const v=Bt[w],z=await l(v),k=JSON.stringify(z,m,2),T=w===0?k.split(`
`).join(`
    `):"    "+k.split(`
`).join(`
    `);await f.write(T),w<Bt.length-1?await f.write(`,
`):await f.write(`
`)}await f.write(`  ], 
  "chatSessions": ${JSON.stringify(Jn,m,2)}, 
  "characterLibrary": [
`);for(let w=0;w<qr.length;w++){const v=qr[w],z=await b(v),k=JSON.stringify(z,m,2),T=w===0?k.split(`
`).join(`
    `):"    "+k.split(`
`).join(`
    `);await f.write(T),w<qr.length-1?await f.write(`,
`):await f.write(`
`)}await f.write(`  ], 
  "modelLibrary": [
`);for(let w=0;w<Oe.length;w++){const v=Oe[w],z=JSON.stringify(v,m,2),k=w===0?z.split(`
`).join(`
    `):"    "+z.split(`
`).join(`
    `);await f.write(k),w<Oe.length-1?await f.write(`,
`):await f.write(`
`)}await f.write(`  ], 
  "timestamp": ${JSON.stringify(qc())} 

} `),await f.close(),alert(j(""))}catch(u){if(console.error(":",u),u.name==="AbortError")return;alert(": "+(u.message||""))}},av=M.useCallback(async()=>{(((g==null?void 0:g.length)||0)>0||((N==null?void 0:N.length)||0)>0||((Bt==null?void 0:Bt.length)||0)>0||((Jn==null?void 0:Jn.length)||0)>1||((qr==null?void 0:qr.length)||0)>0)&&confirm(`

`)&&await Am(),await ov()},[g,N,Bt,Jn,qr,Am,ov]),xN=async()=>{try{X0({visible:!1,x:0,y:0});const r=en.size>0?en:q?new Set([q]):new Set;if(r.size===0){alert(j(""));return}const o=g.filter(b=>r.has(b.id)),l=N.filter(b=>r.has(b.from)&&r.has(b.to));if(!window.showSaveFilePicker){if(!confirm(`

`))return;const w=(X,J)=>J===void 0?null:J,v=JSON.parse(JSON.stringify(o,w)),z=async X=>{if(X==null)return X;if(typeof X=="string"&&X.startsWith("blob:"))try{const J=await Un(X);return await Eo(J)}catch(J){return console.error(" Blob URL :",J),X}if(Array.isArray(X))return await Promise.all(X.map(J=>z(J)));if(typeof X=="object"){const J={};for(const Y in X)X.hasOwnProperty(Y)&&(J[Y]=await z(X[Y]));return J}return X},T={version:"3.7.36c",type:"workflow",nodes:await z(v),connections:l,timestamp:qc()},I=JSON.stringify(T,w,2),F=new Blob([I],{type:"application/json"}),B=URL.createObjectURL(F),U=document.createElement("a");U.href=B;const W=Ul();U.download=`_${W}.json`,document.body.appendChild(U),U.click(),document.body.removeChild(U),URL.revokeObjectURL(B),alert(j(""));return}const u=Ul(),f=await(await window.showSaveFilePicker({suggestedName:`_${u}.json`,types:[{description:"JSON File",accept:{"application/json":[".json"]}}]})).createWritable(),m=(b,w)=>w===void 0?null:w,y=async b=>{const w={...b};if(w.content&&typeof w.content=="string"&&w.content.startsWith("blob:"))try{const v=await In(w.content),z=ur(w.content)?"video/mp4":"image/png";w.content=`data:${z};base64,${v}`}catch(v){console.error(" content :",v)}if(w.maskContent&&typeof w.maskContent=="string"&&w.maskContent.startsWith("blob:"))try{const v=await In(w.maskContent);w.maskContent=`data:image/png;base64,${v}`}catch(v){console.error(" maskContent :",v)}if(Array.isArray(w.selectedKeyframes))for(let v=0;v<w.selectedKeyframes.length;v++){const z=w.selectedKeyframes[v];if(z&&z.url&&typeof z.url=="string"&&z.url.startsWith("blob:"))try{const k=await In(z.url);z.url=`data:image/png;base64,${k}`}catch(k){console.error(":",k)}}if(Array.isArray(w.frames))for(let v=0;v<w.frames.length;v++){const z=w.frames[v];if(z&&z.url&&typeof z.url=="string"&&z.url.startsWith("blob:"))try{const k=await In(z.url);z.url=`data:image/png;base64,${k}`}catch(k){console.error(":",k)}}if(Array.isArray(w.previewMjImages))for(let v=0;v<w.previewMjImages.length;v++){const z=w.previewMjImages[v];if(z&&typeof z=="string"&&z.startsWith("blob:"))try{const k=await In(z);w.previewMjImages[v]=`data:image/png;base64,${k}`}catch(k){console.error(":",k)}}return w};await f.write(`{
  "version": "3.7.36c",
  "type": "workflow",
  "nodes": [
`);for(let b=0;b<o.length;b++){const w=await y(o[b]),z=JSON.stringify(w,m,4).split(`
`).map(k=>"    "+k).join(`
`);await f.write(z),b<o.length-1?await f.write(`,
`):await f.write(`
`)}await f.write(`  ],
  "connections": ${JSON.stringify(l,m,2)},
  "timestamp": ${JSON.stringify(qc())}
}`),await f.close(),alert(j(""))}catch(r){if(console.error(":",r),r.name==="AbortError")return;alert(": "+(r.message||""))}},bN=async()=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async o=>{const l=o.target.files[0];if(l)try{const u=await l.text(),p=JSON.parse(u);if(p.type!=="workflow"){alert(`

""`);return}if(!p.nodes||p.nodes.length===0){alert(j(""));return}let f=[];const m=(yr||"http://127.0.0.1:9527").replace(/\/+$/,"");try{if(m){const U=await fetch(`${m}/list-files`);if(U.ok){const W=await U.json();W.success&&W.files&&(f=W.files,console.log(`[]  ${f.length} `))}}}catch{console.log("[] ")}const y=U=>{if(!f.length||!U)return null;try{const W=U.split(",")[1];if(!W)return null;const X=Math.floor(W.length*.75),J=X*.05,Y=f.find(ne=>Math.abs(ne.size-X)<J);if(Y)return`${m}/file/${encodeURIComponent(Y.rel_path)}`}catch{}return null},b=async U=>{const W=[U];for(;W.length>0;){const X=W.pop();if(!(!X||typeof X!="object"))for(const J in X){const Y=X[J];if(typeof Y=="string"&&(Y.startsWith("data:image/")||Y.startsWith("data:video/")))try{const ne=y(Y);if(ne&&(await fetch(ne,{method:"HEAD"})).ok){X[J]=ne;continue}const Z=await(await fetch(Y)).blob();X[J]=URL.createObjectURL(Z)}catch{}else typeof Y=="object"&&Y!==null&&W.push(Y)}}return U},w=new Map;p.nodes.forEach(U=>{w.set(U.id,`node-${Date.now()}-${Math.random().toString(36).substr(2,9)}`)});const v=Io.current;let z=100,k=100;if(v){const U=v.getBoundingClientRect(),W=U.width/2,X=U.height/2,J=Hr(W+U.left,X+U.top);z=J.x,k=J.y}let T=1/0,I=1/0;p.nodes.forEach(U=>{U.x<T&&(T=U.x),U.y<I&&(I=U.y)});const F=[];for(const U of p.nodes){const W=await b({...U});W.id=w.get(U.id),W.x=U.x-T+z,W.y=U.y-I+k,F.push(W)}const B=(p.connections||[]).map(U=>({...U,from:w.get(U.from),to:w.get(U.to)})).filter(U=>U.from&&U.to);x(U=>[...U,...F]),C(U=>[...U,...B]),ss(new Set(F.map(U=>U.id))),alert(`

 ${F.length}  ${B.length} `)}catch(u){console.error(":",u),alert(": "+(u.message||"JSON"))}},r.click()},lv=r=>{var l,u,p,f,m;if(!r||typeof r!="object")return;if(gc(r.projectName||""),Ce(Ee(r.view)),((l=r.connections)==null?void 0:l.length)>0&&C(r.connections),((u=r.chatSessions)==null?void 0:u.length)>0&&Pa(r.chatSessions),((p=r.characterLibrary)==null?void 0:p.length)>0&&$l(r.characterLibrary),r.modelLibraryLoaded||Array.isArray(r.modelLibrary)&&r.modelLibrary.length>0){const y=(r.modelLibrary||[]).map(b=>({id:b.id,displayName:b.displayName||b.modelName||b.id,modelName:b.modelName||b.displayName||b.id,type:b.type||"Chat",apiType:b.apiType||"openai",ratioLimits:Array.isArray(b.ratioLimits)?b.ratioLimits:null,ratioNotes:es(b.ratioNotes),ratioNotesEnabled:!!b.ratioNotesEnabled,resolutionLimits:Array.isArray(b.resolutionLimits)?b.resolutionLimits:null,resolutionNotes:nl(b.resolutionNotes),resolutionNotesEnabled:!!b.resolutionNotesEnabled,durations:Array.isArray(b.durations)?b.durations:null,durationNotes:es(b.durationNotes),durationNotesEnabled:!!b.durationNotesEnabled,videoResolutions:Array.isArray(b.videoResolutions)?b.videoResolutions:null,videoResolutionNotes:es(b.videoResolutionNotes),videoResolutionNotesEnabled:!!b.videoResolutionNotesEnabled,supportsFirstLastFrame:!!b.supportsFirstLastFrame,supportsHD:!!b.supportsHD,customParams:da(b.customParams),asyncConfig:b.asyncConfig&&typeof b.asyncConfig=="object"?b.asyncConfig:null,requestTemplate:Gi(b.requestTemplate||xo(b)),requestOverrideEnabled:!!b.requestOverrideEnabled,requestOverridePatch:Lo(b.requestOverridePatch),previewOverrideEnabled:!!b.previewOverrideEnabled,previewOverridePatch:fa(b.previewOverridePatch)})).filter(b=>b.id);ke(y)}["dark","light","solarized"].includes(r.theme)&&t(r.theme),((f=r.nodes)==null?void 0:f.length)>0&&x(r.nodes),((m=r.history)==null?void 0:m.length)>0&&Rt(r.history)},yN=async r=>{var o;ds({visible:!0,progress:0,status:"READING BUNDLE...",type:"import"});try{F0({keepStorage:!0,keepActive:!0});const l=await ph.loadAsync(r),u=(o=l.file(/project\.json$/i))==null?void 0:o[0];if(!u)throw new Error(" project.json");const p=await u.async("string"),f=JSON.parse(p||"{}"),m=l.file(/^assets\//),y=f.assetManifest||{},b=new Map;Object.entries(y).forEach(([k,T])=>{T&&b.set(T,k)}),Yo.current.clear(),b.forEach((k,T)=>Yo.current.set(T,k));const w=new Map;for(const k of m){const T=await k.async("blob"),I=k.name,F=b.get(I)||"",B=zE(I),U=(T==null?void 0:T.type)&&T.type.startsWith("image/")||B.startsWith("image/"),W=(T==null?void 0:T.type)&&T.type.startsWith("video/")||B.startsWith("video/"),X=T&&!T.type&&B?new Blob([T],{type:B}):T;if(U||W)try{const Y=await as.saveImage(X);if(Y){w.set(I,Y),Wd.current.set(I,Y),F&&Kd.current.set(Y,F);continue}}catch{}const J=URL.createObjectURL(X);w.set(I,J),D0.current.add(J),F&&L0.current.set(J,F)}U0(!0),F2();const v=k=>{if(!k)return k;if(typeof k=="string"){if(k.startsWith("asset://")){const I=k.replace("asset://",""),F=w.get(I);return F||Yo.current.get(I)||k}const T=y[k];if(T){const I=w.get(T);if(I)return I;const F=Yo.current.get(T);if(F)return F}return k}if(Array.isArray(k))return k.map(v);if(typeof k=="object"){const T={};return Object.entries(k).forEach(([I,F])=>{T[I]=v(F)}),T}return k},z=v(f);setTimeout(()=>{var k;lv(z),ds(T=>({...T,visible:!1})),alert(`
${((k=z.nodes)==null?void 0:k.length)||0} `),Sy({nodes:z.nodes||[],connections:z.connections||[]}).catch(T=>{console.warn("[AutoSave] :",T)}),Array.isArray(z.history)&&Ay(z.history)},100)}catch(l){console.error(":",l),ds(u=>({...u,visible:!1})),alert(`: ${l.message||l} `)}},vN=()=>{const r=document.createElement("input");r.type="file",r.accept=".json,.zip",r.onchange=async o=>{const l=o.target.files[0];if(!l)return;if(ds({visible:!0,progress:0,status:"INITIALIZING...",type:"import"}),l.name&&l.name.toLowerCase().endsWith(".zip")){await yN(l);return}let u=[];const p=(yr||"http://127.0.0.1:9527").replace(/\/+$/,"");try{if(p){const F=await fetch(`${p}/list-files`);if(F.ok){const B=await F.json();B.success&&B.files&&(u=B.files,console.log(`[]  ${u.length} `))}}}catch{console.log("[] ")}const f=F=>{if(!u.length||!F)return null;try{const B=F.split(",")[1];if(!B)return null;const U=Math.floor(B.length*.75),W=U*.05,X=u.find(J=>Math.abs(J.size-U)<W);if(X)return`${p}/file/${encodeURIComponent(X.rel_path)}`}catch{}return null},m={nodes:[],history:[],connections:[],chatSessions:[],characterLibrary:[],projectName:"",view:null,theme:"",modelLibrary:[],modelLibraryLoaded:!1};let y=null,b="",w="",v=0,z=!1,k=0;const T=l.size,I=async F=>{const B=[F];for(;B.length>0;){const U=B.pop();if(!(!U||typeof U!="object"))for(const W in U){const X=U[W];if(typeof X=="string"&&(X.startsWith("data:image/")||X.startsWith("data:video/")))try{const J=f(X);if(J&&(await fetch(J,{method:"HEAD"})).ok){U[W]=J;continue}const ne=await(await fetch(X)).blob();U[W]=URL.createObjectURL(ne)}catch{}else typeof X=="object"&&X!==null&&B.push(X)}}return F};try{const B=l.stream().pipeThrough(new TextDecoderStream).getReader();for(;;){const{value:U,done:W}=await B.read();if(W)break;if(k+=U.length,Math.random()>.95){const X=Math.min(99,k/T*100);ds(J=>({...J,progress:X,status:`PROCESSING ${(k/1024/1024).toFixed(0)} MB`}))}for(b+=U;;){const X=b.indexOf(`
`);if(X===-1)break;const J=b.substring(0,X);b=b.substring(X+1);const Y=J.trim();if(Y){if(Y.includes('"nodes": [')){y="nodes";continue}if(Y.includes('"history": [')){y="history";continue}if(Y.includes('"connections": [')){y="connections";continue}if(Y.includes('"chatSessions": [')){y="chatSessions";continue}if(Y.includes('"characterLibrary": [')){y="characterLibrary";continue}if(Y.includes('"modelLibrary": [')){y="modelLibrary",m.modelLibraryLoaded=!0;continue}if((Y==="],"||Y==="]")&&v===0){y=null,w="",z=!1;continue}if(!y){if(Y.startsWith('"projectName":'))try{const ne=Y.match(/"projectName":\s*(.+)/);ne&&(m.projectName=JSON.parse(ne[1].replace(/,$/,"")))}catch{}if(Y.startsWith('"theme":'))try{const ne=Y.match(/"theme":\s*(.+)/);ne&&(m.theme=JSON.parse(ne[1].replace(/,$/,"")))}catch{}if(Y.startsWith('"view":'))try{const ne=Y.match(/"view":\s*(.+)/);ne&&ne[1].endsWith("}")&&(m.view=JSON.parse(ne[1].replace(/,$/,"")))}catch{}continue}if(y){for(let ne of J)ne==="{"&&(v++,z=!0),ne==="}"&&v--;if(w+=J+`
`,z&&v===0){let ne=w.trim();ne.endsWith(",")&&(ne=ne.slice(0,-1));try{const ie=JSON.parse(ne);(y==="nodes"||y==="history"||y==="characterLibrary")&&await I(ie),y==="nodes"&&ie.id?(ie.settings||(ie.settings={}),m.nodes.push(ie)):y==="history"?m.history.push(ie):y==="connections"?m.connections.push(ie):y==="chatSessions"?m.chatSessions.push(ie):y==="characterLibrary"?m.characterLibrary.push(ie):y==="modelLibrary"&&m.modelLibrary.push(ie)}catch{}w="",z=!1}}}}}ds(U=>({...U,progress:100,status:"FINALIZING..."})),setTimeout(()=>{lv(m),ds(U=>({...U,visible:!1})),alert(`
${m.nodes.length} `),Sy({nodes:m.nodes,connections:m.connections}).catch(U=>{console.warn("[AutoSave] :",U)}),Array.isArray(m.history)&&Ay(m.history)},200)}catch(F){console.error(":",F),ds(B=>({...B,visible:!1})),alert(`: ${F.message} `)}},r.click()},is=(r,o,l,u,p=void 0,f=void 0,m=void 0,y=void 0)=>{Ge();const b=r==="gen-video"?{w:380,h:420}:r==="gen-image"?{w:440,h:340}:r==="video-input"?{w:580,h:460}:r==="video-analyze"?{w:480,h:500}:r==="storyboard-node"?{w:720,h:500}:r==="image-compare"?{w:400,h:300}:r==="preview"?{w:320,h:260}:r==="text-node"?{w:280,h:200}:r==="novel-input"?{w:400,h:500}:r==="extract-characters-scenes"?{w:400,h:500}:r==="character-description"||r==="scene-description"?{w:400,h:400}:r==="create-character"||r==="create-scene"?{w:350,h:300}:r==="generate-character-video"||r==="generate-scene-video"?{w:400,h:450}:r==="generate-character-image"||r==="generate-scene-image"?{w:400,h:450}:r==="local-save"?{w:320,h:380}:{w:260,h:260},w={id:`node - ${Date.now()} `,type:r,x:o-b.w/2,y:l-b.h/2,width:b.w,height:b.h,content:p,...f?{dimensions:f}:{},settings:r==="gen-image"?{model:rr(Da),ratio:ea,resolution:Ml,prompt:""}:r==="gen-video"?{model:rr(Tl),duration:"5s",ratio:ea,resolution:Rl,videoPrompt:""}:r==="video-analyze"?{model:rr(kj),segmentDuration:parseInt(wj),analysisMode:"manual",voiceoverResults:[],analysisResults:[]}:r==="storyboard-node"?{projectTitle:j(""),shots:[]}:r==="text-node"?{text:p||""}:r==="novel-input"?{content:""}:r==="extract-characters-scenes"?{model:rr(Ua||""),analysisResults:null,lastAnalyzed:null,isAnalyzing:!1,progress:0,errorMsg:null}:r==="character-description"||r==="scene-description"?{characterId:"",characterName:"",role:"",age:"",gender:"",sceneId:"",sceneName:"",description:"",prompt:"",mode:"video",style:"none",imageModel:rr(Da),imageRatio:ea||"16:9",imageResolution:Ml,referenceImages:[],chatModel:rr(Ua||""),isEnhancing:!1}:r==="create-character"||r==="create-scene"?{name:"",startSecond:1,endSecond:3,isCreating:!1,createProgress:0,createError:null}:r==="generate-character-video"||r==="generate-scene-video"?{model:rr(Tl),duration:"15s",ratio:ea||"16:9",resolution:Rl,videoPrompt:"",referenceImages:[],sourceType:"",sourceId:"",isGenerating:!1,progress:0,error:null}:r==="generate-character-image"||r==="generate-scene-image"?{model:rr(Da),ratio:ea||"16:9",resolution:Ml,prompt:"",referenceImages:[],chatModel:rr(Ua||""),imageUrls:[],selectedImageIndex:null,isGenerating:!1,progress:0,error:null}:r==="local-save"?{serverUrl:yr,savePath:"",subfolder:"",autoSave:!1,serverStatus:Hs?"connected":"disconnected",lastSaved:null,savedFiles:[],lastSavedUrls:[]}:{}};return x(v=>[...v,w]),u&&C(v=>[...v,{id:`conn - ${Date.now()} `,from:u,to:w.id}]),m&&C(v=>y&&y!=="default"?[...v.filter(k=>!(k.to===m&&(k.inputType||"default")===y)),{id:`conn - ${Date.now()} `,from:w.id,to:m,inputType:y!=="default"?y:void 0}]:[...v,{id:`conn - ${Date.now()} `,from:w.id,to:m}]),Cc(v=>({...v,visible:!1})),Ra(!1),Sc(null),ii(null),ai(null),w},wN=r=>{if(!r)return"";if(typeof r=="number")return`${r}`;const o=String(r).trim();return o?o.includes("")||o.includes("")?o:`${o}`:""},zN=[{value:"none",label:""},{value:"2d-anime",label:j("2D")},{value:"3d-anime",label:j("3D")},{value:"realistic",label:j("")},{value:"selfie",label:j("")},{value:"news",label:j("")},{value:"manga",label:j("")}],kN=M.useCallback(r=>{switch(r){case"2d-anime":return"2D";case"3d-anime":return"3D";case"realistic":return"";case"selfie":return"";case"news":return"";case"manga":return"";default:return""}},[]),cv=r=>{if(!r)return"";let o=r.replace(/360/g,"");return["",""].forEach(u=>{const p=o.indexOf(u);p!==-1&&(o=o.slice(0,p))}),o},dv=r=>r&&(r.includes("360")?r:`${r}360`),Fl=M.useCallback((r,o="video")=>{const l=(r==null?void 0:r.name)||(r==null?void 0:r.characterName)||"",u=((r==null?void 0:r.role)||(r==null?void 0:r.identity)||(r==null?void 0:r.profession)||"").trim(),p=((r==null?void 0:r.description)||(r==null?void 0:r.appearance)||"").trim(),f=wN(r==null?void 0:r.age),m=r!=null&&r.gender?String(r.gender).trim():"",y=`${f}${m}`.trim()||"",b=[u,p].filter(Boolean).join(""),w=b?`${b}`:"",v=u||p?`${u||p}`:"",z=`${l}${y}${w}`,k=`${z}${l}${v}`;return o==="video"?`${k}360`:z},[]),vu=M.useCallback(r=>{const o=(r==null?void 0:r.location)||(r==null?void 0:r.name)||(r==null?void 0:r.sceneName)||"",l=(r==null?void 0:r.description)||"";return o?`${o}${l}`:l},[]),uv=async(r,o)=>{var F,B,U,W,X,J;const l=Xt.get(r);if(!l||l.type!=="character-description"&&l.type!=="scene-description")return;const u=rr(((F=l.settings)==null?void 0:F.chatModel)||Ua||"");if(!u){d("","warning",3e3),Er({nodeId:r,type:"desc-model"});return}const p=wi(u);if(!p.key){d(" API Key","error",4e3),bi(!0);return}const f=(((B=l.settings)==null?void 0:B.prompt)||"").trim();if(!f){d("","warning",3e3);return}const m=sr(u),y=(p.url||Ps).replace(/\/+$/,""),b=(m==null?void 0:m.modelName)||u,w=l.type==="character-description",v='"[]"',z="";let k="",T=f,I=.7;w&&o==="filter"?(k=v,I=.3):!w&&o==="enhance"?(k=z,I=.3):k=o==="enhance"?"JSON":"//JSON",Je(r,{isEnhancing:!0});try{const Y=await fetch(`${y}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${p.key}`,"Content-Type":"application/json"},body:JSON.stringify({model:b,messages:[{role:"system",content:k},{role:"user",content:T}],temperature:I})});if(!Y.ok){let te="";try{const pe=await Y.json();te=((U=pe==null?void 0:pe.error)==null?void 0:U.message)||(pe==null?void 0:pe.message)||""}catch{}throw new Error(`API Error: ${Y.status}${te?` - ${te}`:""}`)}const ne=await Y.json(),Z=(((J=(X=(W=ne.choices)==null?void 0:W[0])==null?void 0:X.message)==null?void 0:J.content)||ne.content||"").replace(/```[\s\S]*?```/g,"").trim();Z?(Je(r,{prompt:Z}),d(o==="enhance"?"":"","success",2e3)):d("","warning",3e3)}catch(Y){console.error("[]",Y),d(`: ${Y.message||""}`,"error",4e3)}finally{Je(r,{isEnhancing:!1})}},jN=M.useCallback((r,o)=>{var U,W,X,J;const l=Xt.get(r);if(!l)return;const u=Array.isArray(o==null?void 0:o.characters)?o.characters:[],p=Array.isArray(o==null?void 0:o.scenes)?o.scenes:[];if(u.length===0&&p.length===0)return;Ge();const f=l.x+l.width+100,m=l.y,y=450,b=Date.now(),w=rr(Tl)||rr((U=Ye.find(Y=>Y.type==="Video"&&(Y.id==="sora-2"||Y.id==="sora-2-pro")))==null?void 0:U.id)||rr((W=Ye.find(Y=>Y.type==="Video"))==null?void 0:W.id)||"",v=rr(Da)||rr((X=Ye.find(Y=>zs(Y.type)))==null?void 0:X.id)||"",z=rr(Ua)||rr((J=Ye.find(Y=>Ci(Y.type)))==null?void 0:J.id)||"",k=ea||"16:9",T=Rl||"720p",I=Ml||"2K",F=[],B=[];if(u.length>0&&u.forEach((Y,ne)=>{const ie=`node - char-desc - ${b} - ${ne}`,Z=`node - char-video - ${b} - ${ne}`,te=`node - char-create - ${b} - ${ne}`,pe=Fl(Y,"video");F.push({id:ie,type:"character-description",x:f,y:m+ne*y,width:400,height:400,settings:{characterId:(Y==null?void 0:Y.id)||"",characterName:(Y==null?void 0:Y.name)||"",role:(Y==null?void 0:Y.role)||"",age:(Y==null?void 0:Y.age)||"",gender:(Y==null?void 0:Y.gender)||"",description:(Y==null?void 0:Y.description)||"",prompt:pe,mode:"video",imageModel:v,imageRatio:k,imageResolution:I,referenceImages:[],chatModel:z}}),F.push({id:Z,type:"generate-character-video",x:f+420,y:m+ne*y,width:400,height:450,settings:{model:w,duration:"15s",ratio:k,resolution:T,videoPrompt:pe,referenceImages:[],sourceType:"character-description",sourceId:ie}}),F.push({id:te,type:"create-character",x:f+840,y:m+ne*y,width:350,height:300,settings:{name:(Y==null?void 0:Y.name)||"",startSecond:1,endSecond:3}}),B.push({id:`conn - char-desc - ${b} - ${ne}`,from:r,to:ie},{id:`conn - char-video - ${b} - ${ne}`,from:ie,to:Z},{id:`conn - char-create - ${b} - ${ne}`,from:Z,to:te})}),p.length>0){const Y=u.length;p.forEach((ne,ie)=>{const Z=Y+ie,te=`node - scene-desc - ${b} - ${ie}`,pe=`node - scene-video - ${b} - ${ie}`,Te=`node - scene-create - ${b} - ${ie}`,Qe=vu(ne),Be=(ne==null?void 0:ne.location)||(ne==null?void 0:ne.name)||(ne==null?void 0:ne.sceneName)||"";F.push({id:te,type:"scene-description",x:f,y:m+Z*y,width:400,height:400,settings:{sceneId:(ne==null?void 0:ne.id)||"",sceneName:Be,description:(ne==null?void 0:ne.description)||"",prompt:Qe,mode:"video",style:(ne==null?void 0:ne.style)||"",imageModel:v,imageRatio:k,imageResolution:I,referenceImages:[],chatModel:z}}),F.push({id:pe,type:"generate-scene-video",x:f+420,y:m+Z*y,width:400,height:450,settings:{model:w,duration:"15s",ratio:k,resolution:T,videoPrompt:Qe,referenceImages:[],sourceType:"scene-description",sourceId:te}}),F.push({id:Te,type:"create-scene",x:f+840,y:m+Z*y,width:350,height:300,settings:{name:Be,startSecond:1,endSecond:3}}),B.push({id:`conn - scene-desc - ${b} - ${ie}`,from:r,to:te},{id:`conn - scene-video - ${b} - ${ie}`,from:te,to:pe},{id:`conn - scene-create - ${b} - ${ie}`,from:pe,to:Te})})}F.length>0&&x(Y=>[...Y,...F]),B.length>0&&C(Y=>[...Y,...B])},[Xt,Ye,Tl,Da,Ua,ea,Rl,Ml,Fl,vu]),NN=r=>{var U,W,X,J,Y,ne,ie,Z,te,pe,Te,Qe,Be,Le,it,ut,xt,Zt;const o=Xt.get(r);if(!o)return;const l=o.type==="character-description",u=l?"generate-character-image":"generate-scene-image";if(N.find(Nt=>{var Ot;return Nt.from===r&&((Ot=Xt.get(Nt.to))==null?void 0:Ot.type)===u}))return;const f={name:((U=o.settings)==null?void 0:U.characterName)||((W=o.settings)==null?void 0:W.name)||"",role:((X=o.settings)==null?void 0:X.role)||"",description:((J=o.settings)==null?void 0:J.description)||"",age:((Y=o.settings)==null?void 0:Y.age)||"",gender:((ne=o.settings)==null?void 0:ne.gender)||""},m={name:((ie=o.settings)==null?void 0:ie.sceneName)||((Z=o.settings)==null?void 0:Z.location)||"",location:((te=o.settings)==null?void 0:te.sceneName)||((pe=o.settings)==null?void 0:pe.location)||"",description:((Te=o.settings)==null?void 0:Te.description)||""},y=l?Fl(f,"image"):vu(m),b=o.x+o.width+200,w=o.y+o.height/2,v=is(u,b,w,r);if(!(v!=null&&v.id))return;const z=rr(((Qe=o.settings)==null?void 0:Qe.imageModel)||Da||((Be=Ye.find(Nt=>zs(Nt.type)))==null?void 0:Be.id)||""),k=((Le=o.settings)==null?void 0:Le.imageRatio)||ea||"16:9",T=((it=o.settings)==null?void 0:it.imageResolution)||Ml||"2K",I=rr(((ut=o.settings)==null?void 0:ut.chatModel)||Ua||""),F=((xt=o.settings)==null?void 0:xt.prompt)||y,B=l?cv(F):F;Je(v.id,{model:z,ratio:k,resolution:T,prompt:B,referenceImages:((Zt=o.settings)==null?void 0:Zt.referenceImages)||[],chatModel:I,sourceType:o.type,sourceId:o.id})},SN=r=>{var B,U,W,X,J,Y,ne,ie,Z,te,pe,Te,Qe,Be,Le,it;const o=Xt.get(r);if(!o)return;const l=o.type==="character-description",u=l?"generate-character-video":"generate-scene-video";if(N.find(ut=>{var xt;return ut.from===r&&((xt=Xt.get(ut.to))==null?void 0:xt.type)===u}))return;const f={name:((B=o.settings)==null?void 0:B.characterName)||((U=o.settings)==null?void 0:U.name)||"",role:((W=o.settings)==null?void 0:W.role)||"",description:((X=o.settings)==null?void 0:X.description)||"",age:((J=o.settings)==null?void 0:J.age)||"",gender:((Y=o.settings)==null?void 0:Y.gender)||""},m={name:((ne=o.settings)==null?void 0:ne.sceneName)||((ie=o.settings)==null?void 0:ie.location)||"",location:((Z=o.settings)==null?void 0:Z.sceneName)||((te=o.settings)==null?void 0:te.location)||"",description:((pe=o.settings)==null?void 0:pe.description)||""},y=l?Fl(f,"video"):vu(m),b=((Te=o.settings)==null?void 0:Te.prompt)||y,w=l?dv(b):b,v=o.x+o.width+200,z=o.y+o.height/2,k=is(u,v,z,r);if(!(k!=null&&k.id))return;const T=rr(Tl)||rr((Qe=Ye.find(ut=>ut.type==="Video"&&(ut.id==="sora-2"||ut.id==="sora-2-pro")))==null?void 0:Qe.id)||rr((Be=Ye.find(ut=>ut.type==="Video"))==null?void 0:Be.id)||"",I=((Le=o.settings)==null?void 0:Le.imageRatio)||ea||"16:9",F=Rl||"720p";Je(k.id,{model:T,duration:"15s",ratio:I,resolution:F,videoPrompt:w,referenceImages:((it=o.settings)==null?void 0:it.referenceImages)||[],sourceType:o.type,sourceId:o.id})},_N=M.useCallback(r=>{const o=[];for(const l of N)if(l.from===r){const u=Xt.get(l.to);u&&(u.type==="gen-image"||u.type==="gen-video")&&o.push(u)}return o},[N,Xt]),Bl=r=>{if(!r)return"5s";const o=sr(r);if(Array.isArray(o==null?void 0:o.durations)&&o.durations.length>0)return o.durations[0];const l=(o==null?void 0:o.id)||r;return l==="sora-2-pro"||l.includes("sora-2")||l==="sora-2"?"15s":l.includes("veo")||l==="google-veo3"||l.includes("grok")||l==="grok-3"?"8s":l.includes("jimeng-video-sora2")||l.includes("jimeng-sora2")?"4s":"5s"},wu=r=>{if(!r)return["5s","10s"];const o=sr(r);if(Array.isArray(o==null?void 0:o.durations)&&o.durations.length>0)return o.durations;const l=(o==null?void 0:o.id)||r;return l==="sora-2-pro"?["15s","25s"]:l.includes("sora-2")||l==="sora-2"?["5s","10s","15s"]:l.includes("veo")||l==="google-veo3"?["8s"]:l.includes("grok")||l==="grok-3"?["8s","5s"]:l.includes("jimeng-video-sora2")||l.includes("jimeng-sora2")?["4s","8s","12s"]:l.includes("jimeng")?["5s","10s"]:["5s","10s"]},pv=r=>{var y,b,w,v,z,k;const o=Xt.get(r);if(!o||o.type!=="storyboard-node")return;const l=((y=o.settings)==null?void 0:y.mode)||"video";let u,p,f;l==="image"?(u=rr(localStorage.getItem("tapnow_last_image_model")||((b=Ye.find(T=>zs(T.type)))==null?void 0:b.id)||""),p="1:1",f=void 0):(u=rr(Tl||localStorage.getItem("tapnow_last_video_model")||((w=Ye.find(T=>T.type==="Video"))==null?void 0:w.id)||""),p="16:9",f=Bl(u));const m={id:`shot-${Date.now()}`,scene_index:(((z=(v=o.settings)==null?void 0:v.shots)==null?void 0:z.length)||0)+1,time_range:"",image_url:"",description:"",prompt:"",camera:"",tags:[],status:"draft",model:u,ratio:p,duration:f,outputEnabled:!1,selectedImageIndex:-1};Je(r,{shots:[...((k=o.settings)==null?void 0:k.shots)||[],m]})},CN=(r,o)=>{var p;const l=Xt.get(r);if(!l||l.type!=="storyboard-node")return;const u=(((p=l.settings)==null?void 0:p.shots)||[]).filter(f=>f.id!==o);u.forEach((f,m)=>{f.scene_index=m+1}),Je(r,{shots:u})},ar=(r,o,l,u={})=>{let p=!1,f=l.status;if(x(m=>{var T,I,F;const y=m.find(B=>B.id===r);if(!y||y.type!=="storyboard-node")return console.warn("[updateShot] :",{nodeId:r,found:!!y,type:y==null?void 0:y.type}),m;if(u.onlyIfStatus){const B=(((T=y.settings)==null?void 0:T.shots)||[]).find(U=>U.id===o);if(B&&B.status!==u.onlyIfStatus)return console.warn(`[updateShot] : ${o},  ${B.status} !==  ${u.onlyIfStatus}`),m}const b=(((I=y.settings)==null?void 0:I.shots)||[]).find(B=>B.id===o),w={...l},v=Object.prototype.hasOwnProperty.call(w,"durationCost"),z=new Set(["done","completed","failed","error"]);if(w.status==="generating"&&!v&&(w.durationCost=0),w.status&&z.has(w.status)&&!v&&b!=null&&b.generationStartTime){const B=(Date.now()-b.generationStartTime)/1e3;w.durationCost=Number(B.toFixed(1))}p=!0,f=w.status;const k=(((F=y.settings)==null?void 0:F.shots)||[]).map(B=>B.id===o?{...B,...w}:B);return m.map(B=>B.id===r?{...B,settings:{...B.settings,shots:k}}:B)}),p&&f){const m=`${r}-${o}`;J0(f==="generating"?y=>({...y,[m]:"0.0s"}):y=>{if(!y[m])return y;const b={...y};return delete b[m],b})}if(l.video_url||l.output_url||l.output_images||l.image_url||l.lastFrame){const m=l.video_url||l.output_url||l.output_images&&l.output_images[0]||l.image_url||l.lastFrame,y=l.video_url?"video":"image",b=l.image_filename||"";setTimeout(()=>{Ki(`temp-${Date.now()}`,m,y,r,null,b)},50)}},EN=(r,o)=>{const l=Xt.get(r);if(!l||!o||o.length===0){console.warn("[] ");return}const u=o.map((b,w)=>{var B,U,W,X,J,Y,ne,ie,Z,te;const v=((B=b.keyframes)==null?void 0:B.find(pe=>pe.type==="current"))||((U=b.keyframes)==null?void 0:U[0]),z=(v==null?void 0:v.mj_prompt)||"",k=(v==null?void 0:v.jimeng_prompt)||"",T=(v==null?void 0:v.description)||((X=(W=b.keyframes)==null?void 0:W[0])==null?void 0:X.description)||"",I=[];(Y=(J=b.global_tags)==null?void 0:J.style)!=null&&Y[0]&&I.push(b.global_tags.style[0]),(ie=(ne=b.global_tags)==null?void 0:ne.camera)!=null&&ie[0]&&I.push(b.global_tags.camera[0]),v!=null&&v.description&&["","","","","","","","Dolly","Pan","Tilt","Zoom"].forEach(Te=>{T.includes(Te)&&I.push(Te)});const F=((te=(Z=b.global_tags)==null?void 0:Z.camera)==null?void 0:te[0])||I.find(pe=>["","","","","","Dolly","Pan","Tilt","Zoom"].some(Te=>pe.includes(Te)))||"";return{id:`shot - ${Date.now()} -${w} `,scene_index:w+1,time_range:b.time_range||"",image_url:"",description:T,prompt:z||k,camera:F,tags:I,status:"draft"}}),p=l.x+l.width+100,f=l.y,m=`node - storyboard - ${Date.now()} `,y={id:m,type:"storyboard-node",x:p,y:f,width:600,height:500,settings:{projectTitle:j("AI "),shots:u}};x(b=>[...b,y]),C(b=>[...b,{id:`conn - ${Date.now()} `,from:r,to:m}])},tn=M.useRef(new Map);M.useRef(null);const fv=async(r,o,l,u=null,p=null)=>{var f;try{const m=Ye.find(I=>I.type==="Video"&&(I.id==="sora-2"||I.id==="sora-2-pro"));if(!m){alert(j(" Sora 2  Sora 2  Sora 2 Pro")),Lc(!1);return}const b=wi(m.id).key;if(!b){alert(j(" API Key")),Lc(!1);return}if(l-o<1||l-o>3){alert(j(" 1-3 ")),Lc(!1);return}const w=`${o},${l} `;let v;p&&p.trim()?v=p.trim():v=`${(m.url||Ps).replace(/\/+$/,"")}/sora/v1/characters`;const z=u?{from_task:u,timestamps:w}:{url:r,timestamps:w};console.log("[Create Character] Request Details:",{endpoint:v,apiKey:b?`${b.substring(0,8)}...${b.substring(b.length-4)} `:"EMPTY",payload:z,fromTaskId:u,videoUrl:u?"N/A (using from_task)":r,customEndpoint:p||"N/A (using default)"});const k=await fetch(v,{method:"POST",headers:{Authorization:`Bearer ${b}`,"Content-Type":"application/json"},body:JSON.stringify(z)});if(!k.ok){const I=await k.text();console.error("[Create Character] API Error:",{status:k.status,statusText:k.statusText,errorText:I,endpoint:v});let F=null;try{F=JSON.parse(I)}catch{}throw k.status===500||F&&(F.code==="get_origin_task_failed"||(f=F.message)!=null&&f.includes("get_origin_task_failed"))?new Error("TASK_NOT_FOUND"):new Error(`API(${k.status}): ${I||k.statusText} `)}const T=await k.json();if(T.id&&T.username){const I={id:T.id,username:T.username,profile_picture_url:T.profile_picture_url||"",permalink:T.permalink||""},F=[...qr,I];$l(F),alert(` "${T.username}" `),su(!1),nf("url"),sf(""),of(""),gy(1),xy(3),ou("")}else throw new Error(" id  username")}catch(m){console.error("[Create Character] Failed:",m);let y=m.message;if(y==="TASK_NOT_FOUND"){alert(`

" URL"`);return}(y.includes("Failed to fetch")||m.name==="TypeError"||m.message.includes("NetworkError"))&&(y=`

1. API 
   -  API  "/sora" 
   -  Sora 

2.  (CORS)
   -  Allow CORS 

3. 
   - `),alert(`: ${y} `)}finally{Lc(!1)}},hv=(r,o)=>{var z,k;let l=o.prompt||"";if(!l&&o.description&&(l=o.description),o.tags&&o.tags.length>0){const T=o.tags.join(", ");l+=`, ${T} `}if(o.camera&&(l+=`, ${o.camera} camera movement`),!l){alert(j(""));return}const u=rr(o.model||((z=Ye.find(T=>T.type==="Video"&&T.id==="sora-2"))==null?void 0:z.id)||((k=Ye.find(T=>T.type==="Video"))==null?void 0:k.id)||""),p=sr(u);if(!p||p.type!=="Video"){alert(j(""));return}const f=[];o.image_url&&f.push(o.image_url),o.useFirstLastFrame&&o.lastFrame&&f.push(o.lastFrame),ar(r,o.id,{status:"generating",generationStartTime:Date.now()});let m=o.duration||Bl(u);const y=wu(u);y.includes(m)||(console.warn(`[V3.5.5] Duration "${m}" not valid for model "${u}", using "${y[0]}"`),m=y[0]);const b=String(m).endsWith("s")?m:`${m}s`,w={model:u,ratio:o.ratio||"16:9",duration:b,resolution:I2(o.resolution||"720p"),isHD:!!o.isHD,customParams:o.customParams||null},v=`storyboard-${r}-shot-${o.id}`;Dl(l,"video",f,v,w)},mv=(r,o)=>{var w;let l=o.prompt||"";if(!l&&o.description&&(l=o.description),o.tags&&o.tags.length>0){const v=o.tags.join(", ");l+=`, ${v} `}if(!l){alert(j(""));return}const u=rr(o.model||localStorage.getItem("tapnow_last_image_model")||((w=Ye.find(v=>zs(v.type)))==null?void 0:w.id)||""),p=sr(u);if(!p||!zs(p.type)){alert(j(""));return}if(!wi(u).key){alert(` "${u}"  API Key `),ar(r,o.id,{status:"failed",errorMsg:"API Key "}),bi(!0);return}const m=[];o.image_url&&m.push(o.image_url),o.referenceImages&&o.referenceImages.length>0&&m.push(...o.referenceImages),ar(r,o.id,{status:"generating",generationStartTime:Date.now()});const y={model:u,ratio:o.ratio||"1:1",resolution:Ju(o.resolution||"2K"),customParams:o.customParams||null},b=`storyboard-img-${r}-shot-${o.id}`;Dl(l,"image",m,b,y)},gv=async(r,o={})=>{var k,T,I,F,B,U,W,X;const l=Xt.get(r),u=o.inputText||"",p=o.modelId||"";let f=u||((k=l==null?void 0:l.settings)==null?void 0:k.content)||"";if(!f){const J=N.find(Y=>Y.to===r);if(J){const Y=Xt.get(J.from);Y&&(Y.type==="novel-input"||Y.type==="text-node")&&(f=((T=Y.settings)==null?void 0:T.content)||Y.content||"")}}if(!f||f.trim().length===0){d("","error");return}const m=rr(p||((I=l==null?void 0:l.settings)==null?void 0:I.model)||"");if(!m){d("","error");return}const y=sr(m);if(!y){d("","error");return}const b=wi(m),w=b.key;if(!w){d(" API Key","error"),bi(!0);return}((F=l==null?void 0:l.settings)==null?void 0:F.model)!==m&&Je(r,{model:m}),pm(m);try{localStorage.setItem("tapnow_last_extract_model",m)}catch{}Je(r,{isAnalyzing:!0,progress:5,errorMsg:null,analysisResults:null});let v=setInterval(()=>{x(J=>J.map(Y=>{var Z;if(Y.id!==r)return Y;const ne=((Z=Y.settings)==null?void 0:Z.progress)||0,ie=Math.min(ne+7,92);return{...Y,settings:{...Y.settings,progress:ie}}}))},500);const z=`


${f.substring(0,15e3)} ... ()

 JSON 
{
    "characters": [
        { "name": "", "role": "//", "age": "", "gender": "", "description": "", "appearance": "" }
    ],
    "scenes": [
        { "location": "", "description": "", "mood": "", "style": "" }
    ]
}
 JSON markdown `;try{const J=(b.url||Ps).replace(/\/+$/,""),Y=await fetch(`${J}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${w}`,"Content-Type":"application/json"},body:JSON.stringify({model:y.modelName||y.id||"gemini-1.5-pro-latest",messages:[{role:"system",content:"You are a helpful assistant that analyzes novels."},{role:"user",content:z}],temperature:.7})});if(!Y.ok){let Te="";try{const Qe=await Y.json();Te=((B=Qe==null?void 0:Qe.error)==null?void 0:B.message)||(Qe==null?void 0:Qe.message)||""}catch{}throw Y.status===401&&(d("API Key 401","error",5e3),bi(!0)),new Error(`API Error: ${Y.status}${Te?` - ${Te}`:""}`)}const ne=await Y.json(),ie=((X=(W=(U=ne.choices)==null?void 0:U[0])==null?void 0:W.message)==null?void 0:X.content)||ne.content||"";let Z=null;try{const Te=ie.replace(/```json/g,"").replace(/```/g,"").trim();Z=JSON.parse(Te)}catch(Te){console.warn("JSON Parse Error",Te)}const te=Array.isArray(Z==null?void 0:Z.characters)?Z.characters:[],pe=Array.isArray(Z==null?void 0:Z.scenes)?Z.scenes:[];Z&&(te.length>0||pe.length>0)?(Je(r,{analysisResults:{characters:te,scenes:pe},lastAnalyzed:Date.now(),errorMsg:null}),setTimeout(()=>{jN(r,{characters:te,scenes:pe})},200)):(Je(r,{analysisResults:null,lastAnalyzed:Date.now(),errorMsg:""}),d("/","warning"))}catch(J){console.error("Extraction Failed",J);let Y=(J==null?void 0:J.message)||"";((J==null?void 0:J.name)==="TypeError"||/Failed to fetch|NetworkError/i.test(Y))&&(Y="CORS API http/https CORS "),Je(r,{errorMsg:Y}),d(`: ${Y}`,"error",5e3)}finally{v&&clearInterval(v),x(J=>J.map(Y=>Y.id===r?{...Y,settings:{...Y.settings,isAnalyzing:!1,progress:100}}:Y)),setTimeout(()=>Je(r,{progress:0}),800)}},IN=r=>{var b,w,v,z;const o=Xt.get(r);if(!o)return;const l=((b=o.settings)==null?void 0:b.content)||"";if(!l||l.trim().length===0){d("","error");return}const u=N.find(k=>{var T;return k.from===r&&((T=Xt.get(k.to))==null?void 0:T.type)==="extract-characters-scenes"});let p=u==null?void 0:u.to,f=p?Xt.get(p):null;if(!p){const T=o.x+o.width+50+200,I=o.y+o.height/2,F=is("extract-characters-scenes",T,I,r);p=F==null?void 0:F.id,f=F||null}if(!p)return;const m=rr(((w=f==null?void 0:f.settings)==null?void 0:w.model)||((z=(v=Xt.get(p))==null?void 0:v.settings)==null?void 0:z.model)||Ua||"");if(!m){d("","warning",4e3),Er({nodeId:p,type:"extract-model"});return}if(!wi(m).key){d(" API Key","error"),bi(!0);return}Je(p,{model:m}),requestAnimationFrame(()=>{gv(p,{inputText:l,modelId:m})})},xv=(r,o)=>{var u;const l=(u=o.target.files)==null?void 0:u[0];if(l){const p=new FileReader;p.onload=async f=>{const m=f.target.result;let y={w:0,h:0};try{y=await os(m)}catch{}Ge(),x(b=>b.map(w=>w.id===r?{...w,content:m,dimensions:y}:w))},p.readAsDataURL(l)}},PN=(r,o)=>{if(!r||r.length===0)return[];const l=[...r].sort((m,y)=>m.time-y.time),u=[];let p=[],f=l[0].time;return l.forEach((m,y)=>{m.time-f>=o&&p.length>0?(u.push([...p]),p=[m],f=m.time):p.push(m)}),p.length>0&&u.push(p),u},$N=async r=>{var T,I,F,B,U,W,X,J,Y,ne,ie,Z,te,pe,Te;const o=Xt.get(r);if(!o||o.type!=="video-analyze")return;const l=xu(r);if(!l){alert(j(""));return}const u=l.selectedKeyframes||[];if(u.length===0){alert(j(""));return}const p=rr(((T=o.settings)==null?void 0:T.model)||"gemini-3-pro"),{key:f,url:m}=wi(p),y=sr(p);if(!f){alert(j(" API  Key")),bi(!0);return}const b=((I=o.settings)==null?void 0:I.segmentDuration)||3,w=PN(u,b);if(w.length===0){alert(j(""));return}x(Qe=>Qe.map(Be=>Be.id===r?{...Be,isGenerating:!0,analysisResults:[]}:Be));const v=[],z=l.videoFileName||"video.mp4";(F=l.videoMeta)!=null&&F.duration;const k=((B=o.settings)==null?void 0:B.analysisMode)||"manual";try{for(let Qe=0;Qe<w.length;Qe++){const Be=w[Qe],Le=`${Be[0].time.toFixed(1)}s-${Be[Be.length-1].time.toFixed(1)}s`,it=`AI

 JSON 
{
  "video_id": "${z}",
  "scene_index": ${Qe+1},
  "time_range": "${Le}",
  "keyframes": [
    {
      "type": "prev",
      "time": 5.2,
      "description": "",
      "mj_prompt": "Midjourney ",
      "jimeng_prompt": ""
    },
    {
      "type": "current",
      "time": 6.8,
      "description": "",
      "mj_prompt": "Midjourney ",
      "jimeng_prompt": ""
    },
    {
      "type": "next",
      "time": 8.7,
      "description": "",
      "mj_prompt": "Midjourney ",
      "jimeng_prompt": ""
    }
  ],
  "global_tags": {
    "style": ["", ""],
    "camera": ["", ""],
    "color": [""]
  }
}


1.  prev/current/next 
2. mj_prompt  Midjourney
3. jimeng_prompt AI
4. global_tags `,ut=[{type:"text",text:` ${Qe+1}${Le}`}],xt=15,Zt=Be.length>xt?Be.slice(0,xt):Be;Zt.forEach((Mt,Et)=>{ut.push({type:"image_url",image_url:{url:Mt.url}}),Et<Zt.length-1&&ut.push({type:"text",text:` ${Et+1}${Mt.time.toFixed(2)}s`})}),Be.length>xt&&ut.push({type:"text",text:` ${Be.length} API ${xt} `});const Nt=[{role:"system",content:it},{role:"user",content:ut}],Ot=new AbortController,er=setTimeout(()=>Ot.abort(),6e4);let pr;try{pr=await fetch(`${m}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({model:(y==null?void 0:y.id)||"gemini-3-pro",messages:Nt,stream:!1}),signal:Ot.signal})}catch(Mt){throw clearTimeout(er),Mt.name==="AbortError"?new Error(""):Mt.message&&Mt.message.includes("Failed to fetch")?new Error(` API  (${m})
1. API 
2. 
3. API `):new Error(`: ${Mt.message}`)}finally{clearTimeout(er)}if(!pr.ok){let Mt="";try{Mt=await pr.text()}catch{Mt=`HTTP ${pr.status}: ${pr.statusText}`}throw new Error(Mt||`API Error: ${pr.status}`)}const H=await pr.json();console.log("[] API :",{hasData:!!H,hasChoices:!!H.choices,choicesLength:(U=H.choices)==null?void 0:U.length,dataKeys:Object.keys(H||{}),model:(y==null?void 0:y.modelName)||(y==null?void 0:y.id)});let ve=null;if(H.choices&&H.choices.length>0?ve=(X=(W=H.choices[0])==null?void 0:W.message)==null?void 0:X.content:(J=H.data)!=null&&J.choices&&H.data.choices.length>0?ve=(ne=(Y=H.data.choices[0])==null?void 0:Y.message)==null?void 0:ne.content:H.content?ve=H.content:(ie=H.data)!=null&&ie.content?ve=H.data.content:H.text?ve=H.text:(Z=H.data)!=null&&Z.text?ve=H.data.text:H.message?ve=typeof H.message=="string"?H.message:H.message.content:(te=H.data)!=null&&te.message?ve=typeof H.data.message=="string"?H.data.message:H.data.message.content:H.result?ve=typeof H.result=="string"?H.result:H.result.content:(pe=H.data)!=null&&pe.result&&(ve=typeof H.data.result=="string"?H.data.result:H.data.result.content),!ve||ve.trim()===""||ve==="{}")throw console.error("[] API :",H),new Error(`API : ${JSON.stringify(H).substring(0,200)}`);let qe=ve.trim();qe.startsWith("```")&&(qe=qe.replace(/^```(?:json)?\n?/,"").replace(/\n?```$/,""));let Ze;try{Ze=JSON.parse(qe)}catch(Mt){console.error("[]  JSON :",Mt,"500:",qe.substring(0,500));try{qe=qe.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/.*/g,""),qe=qe.replace(/,(\s*[}\]])/g,"$1"),Ze=JSON.parse(qe)}catch(Et){console.error("[] JSON:",Et,":",qe),Ze={video_id:z,scene_index:Qe+1,time_range:Le,keyframes:Be.map((Lt,wt)=>({type:wt===0?"prev":wt===1?"current":"next",time:Lt.time,description:` ${Lt.time.toFixed(1)}s`,mj_prompt:"A detailed scene from the video",jimeng_prompt:""})),global_tags:{style:[],camera:[],color:[]}},console.warn("[] :",qe.substring(0,200))}}if(v.push(Ze),x(Mt=>Mt.map(Et=>{if(Et.id===r){const wt=[...Et.analysisResults||[],Ze];return{...Et,analysisResults:wt}}return Et})),!(k==="manual")){const Et={id:`analyze-${r}-${Qe}-${Date.now()}`,type:"analyze",prompt:` -  ${Qe+1}`,url:((Te=Be[0])==null?void 0:Te.url)||"",status:"completed",progress:100,modelName:(y==null?void 0:y.provider)||"Gemini 3 Pro",time:new Date().toLocaleString("zh-CN"),sourceNodeId:r,analysisResult:Ze,videoFileName:z,sceneIndex:Qe+1,timeRange:Le};Rt(Lt=>[Et,...Lt])}}x(Qe=>Qe.map(Be=>{if(Be.id===r){const Le=v.length>0?v:Be.analysisResults||[];return{...Be,isGenerating:!1,analysisResults:Le}}return Be}))}catch(Qe){console.error(":",Qe);const Be=Qe.message||"";x(Le=>Le.map(it=>it.id===r?{...it,isGenerating:!1,errorMsg:Be}:it))}},AN=async r=>{var y,b,w,v,z,k,T,I,F,B;const o=Xt.get(r);if(!o||o.type!=="video-analyze")return;const l=xu(r);if(!l||!l.content){alert(j(""));return}let u=l.content;if(u.startsWith("blob:"))try{const U=await fetch(u).then(W=>W.blob());u=await new Promise((W,X)=>{const J=new FileReader;J.onerror=()=>X(new Error("FileReader failed")),J.onloadend=()=>W(J.result),J.readAsDataURL(U)})}catch(U){console.error("Blob conversion failed",U),alert(j(" AI"));return}let p=Ye.find(U=>U.id==="gemini-3-pro"&&Ci(U.type));p||(p=Ye.find(U=>{var X;return(((X=U.id)==null?void 0:X.toLowerCase())||"").includes("gemini")&&Ci(U.type)})),p||(p=Ye.find(U=>Ci(U.type)));const{key:f,url:m}=wi((p==null?void 0:p.id)||"gemini-3-pro");if(!f){alert(j(" API  Key")),bi(!0);return}x(U=>U.map(W=>W.id===r?{...W,isGenerating:!0,settings:{...W.settings,voiceoverResults:[],analysisResults:[]}}:W));try{const U=`******AI**

1. ****

2. ****Voiceover

 **JSON **Markdown

{
  "voiceover_script": [
    { "time_range": "0s-3s", "text": "..." }
  ],
  "scenes": [
    {
      "scene_id": 1,
      "time_range": "0s-2.5s",
      "visual_analysis": {
        "camera_movement": "(Dolly Zoom Out) (Orbit)",
        "subject_dynamics": "",
        "atmosphere": ""
      },
      "prompts": {
        "jimeng_prompt": "()+++()...",
        "mj_prompt": "Midjourney Prompt: English description, include camera directives like 'dynamic angle', 'fast zoom out', 'cinematic lighting'..."
      }
    }
  ]
}

****
- ****
- ****""
- ****`,W=[{type:"text",text:j("JSON")},{type:"image_url",image_url:{url:u}}],X=[{role:"system",content:U},{role:"user",content:W}],J=new AbortController,Y=setTimeout(()=>J.abort(),12e4);let ne;try{ne=await fetch(`${m}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({model:(p==null?void 0:p.id)||"gemini-3-pro",messages:X,stream:!1}),signal:J.signal})}catch(Be){throw clearTimeout(Y),Be.name==="AbortError"?new Error("120"):Be.message&&Be.message.includes("Failed to fetch")?new Error(` API  (${m})
1. API 
2. 
3. API 
4.  API Key`):new Error(`: ${Be.message}`)}finally{clearTimeout(Y)}if(!ne.ok){let Be="";try{Be=await ne.text()}catch{Be=`HTTP ${ne.status}: ${ne.statusText}`}throw new Error(Be||`API Error: ${ne.status}`)}const ie=await ne.json();console.log("[AI] API :",{hasData:!!ie,hasChoices:!!ie.choices,choicesLength:(y=ie.choices)==null?void 0:y.length,dataKeys:Object.keys(ie||{}),model:(p==null?void 0:p.modelName)||(p==null?void 0:p.id)});let Z=null;if(ie.choices&&ie.choices.length>0?Z=(w=(b=ie.choices[0])==null?void 0:b.message)==null?void 0:w.content:(v=ie.data)!=null&&v.choices&&ie.data.choices.length>0?Z=(k=(z=ie.data.choices[0])==null?void 0:z.message)==null?void 0:k.content:ie.content?Z=ie.content:(T=ie.data)!=null&&T.content?Z=ie.data.content:ie.text?Z=ie.text:(I=ie.data)!=null&&I.text?Z=ie.data.text:ie.message?Z=typeof ie.message=="string"?ie.message:ie.message.content:(F=ie.data)!=null&&F.message?Z=typeof ie.data.message=="string"?ie.data.message:ie.data.message.content:ie.result?Z=typeof ie.result=="string"?ie.result:ie.result.content:(B=ie.data)!=null&&B.result&&(Z=typeof ie.data.result=="string"?ie.data.result:ie.data.result.content),!Z||Z.trim()===""||Z==="{}")throw console.error("[AI] API :",ie),new Error(`API : ${JSON.stringify(ie).substring(0,200)}`);let te=Z.trim();te.startsWith("```")&&(te=te.replace(/^```(?:json)?\n?/,"").replace(/\n?```$/,""));let pe;try{pe=JSON.parse(te)}catch(Be){console.error("[AI]  JSON :",Be,"500:",te.substring(0,500));try{te=te.replace(/\/\*[\s\S]*?\*\//g,"").replace(/\/\/.*/g,""),te=te.replace(/,(\s*[}\]])/g,"$1"),pe=JSON.parse(te)}catch(Le){throw console.error("[AI] JSON:",Le,":",te.substring(0,500)),new Error(` JSON : ${te.substring(0,200)}`)}}const Te=(pe.voiceover_script||[]).map((Be,Le)=>({time:Le,text:Be.text||""})),Qe=(pe.scenes||[]).map((Be,Le)=>{var it,ut,xt,Zt,Nt,Ot;return{scene_index:Be.scene_id||Le+1,time_range:Be.time_range||"",keyframes:[{type:"current",time:0,description:`${((it=Be.visual_analysis)==null?void 0:it.camera_movement)||""} ${((ut=Be.visual_analysis)==null?void 0:ut.subject_dynamics)||""}`.trim(),mj_prompt:((xt=Be.prompts)==null?void 0:xt.mj_prompt)||"",jimeng_prompt:((Zt=Be.prompts)==null?void 0:Zt.jimeng_prompt)||""}],global_tags:{style:(Nt=Be.visual_analysis)!=null&&Nt.atmosphere?[Be.visual_analysis.atmosphere]:[],camera:(Ot=Be.visual_analysis)!=null&&Ot.camera_movement?[Be.visual_analysis.camera_movement]:[],color:[]}}});x(Be=>Be.map(Le=>Le.id===r?{...Le,isGenerating:!1,settings:{...Le.settings,voiceoverResults:Te,analysisResults:Qe}}:Le)),Qe.length>0&&setTimeout(()=>{EN(r,Qe)},100)}catch(U){console.error("AI:",U);const W=U.message||"AI";x(X=>X.map(J=>J.id===r?{...J,isGenerating:!1,errorMsg:W}:J))}},TN=()=>{const r=Zp.name.trim(),o=Zp.prompt.trim();if(!r||!o){alert(j(""));return}Qb(l=>[{id:`custom-${Date.now()}`,name:r,prompt:o},...l]),H0({name:"",prompt:""})},MN=r=>{Qb(o=>o.filter(l=>l.id!==r))},RN=(r,o)=>{!r||!o||Je(r,{prompt:o})},ON=async r=>new Promise((o,l)=>{const u=new Image;u.crossOrigin="anonymous";const p=setTimeout(()=>{l(new Error(""))},3e4);u.onload=()=>{clearTimeout(p);try{const m=document.createElement("canvas").getContext("2d"),y=Math.floor(u.width/3),b=Math.floor(u.height/3),w=[],v=[];for(let z=0;z<3;z++)for(let k=0;k<3;k++){const T=Math.max(0,Math.min(k*y,u.width-y)),I=Math.max(0,Math.min(z*b,u.height-b)),F=Math.min(y,u.width-T),B=Math.min(b,u.height-I),U=document.createElement("canvas");U.width=F,U.height=B;const W=U.getContext("2d");W.fillStyle="#ffffff",W.fillRect(0,0,F,B),W.drawImage(u,T,I,F,B,0,0,F,B);try{const X=U.toDataURL("image/png");v.push(Promise.resolve({url:X,width:F,height:B}))}catch(X){console.error("Canvas toDataURL :",X)}}Promise.all(v).then(z=>{o(z)}).catch(z=>{l(z)})}catch(f){l(f)}},u.onerror=()=>{clearTimeout(p),l(new Error(""))},u.src=r}),zu=async(r,o={})=>{if(!r)return;const{originX:l,originY:u,cols:p=3,spacing:f=20,nodeWidth:m=260,nodeHeight:y=260,replaceSelected:b=!1}=o;try{const w=await ON(r);if(w.length!==9){alert(j("9"));return}const v=vi.current;if(b&&v&&v.size===9){const F=Array.from(v);x(B=>B.map(U=>{const W=F.indexOf(U.id);return W!==-1&&W<w.length?{...U,content:w[W].url,dimensions:{w:w[W].width,h:w[W].height}}:U}));return}const z=Hr(window.innerWidth/2,window.innerHeight/2),k=l!==void 0?l:z.x,T=u!==void 0?u:z.y,I=[];for(let F=0;F<w.length;F++){const B=Math.floor(F/p),U=F%p,W=k+U*(m+f),X=T+B*(y+f);I.push({id:`node-${Date.now()}-${F}`,type:"input-image",x:W,y:X,width:m,height:y,content:w[F].url,dimensions:{w:w[F].width,h:w[F].height}})}x(F=>[...F,...I])}catch(w){alert(": "+w.message)}},LN=()=>{const r=Po.current,o=vi.current;let l=[];if(r){const B=qs.current.find(U=>U.id===r);B&&(l=[B])}else o&&o.size>0&&(l=qs.current.filter(B=>o.has(B.id)));if(l.length<2){alert(j(""));return}const u=new Set(l.map(B=>B.id)),p={};l.forEach(B=>{p[B.id]={id:B.id,node:B,parents:[],children:[],level:0,rank:0}}),Bc.current.forEach(B=>{u.has(B.from)&&u.has(B.to)&&(p[B.from].children.push(B.to),p[B.to].parents.push(B.from))});let f=Object.values(p).filter(B=>B.parents.length===0);f.length===0&&l.length>0&&(f=[Object.values(p)[0]]),(()=>{const B=f.map(U=>({node:U,lvl:0}));for(;B.length>0;){const{node:U,lvl:W}=B.shift();W>=U.level&&(U.level=W,U.children.forEach(X=>{const J=p[X];J&&W<20&&B.push({node:J,lvl:W+1})}))}})();const y=Math.max(...Object.values(p).map(B=>B.level)),b=Array.from({length:y+1},()=>[]);Object.values(p).forEach(B=>{b[B.level].push(B)}),b.forEach(B=>{B.sort((U,W)=>U.node.y-W.node.y)});const w=3;for(let B=0;B<w;B++){for(let U=1;U<b.length;U++){const W=b[U];W.forEach(X=>{if(X.parents.length>0){let J=0;X.parents.forEach(Y=>{const ne=p[Y],ie=b[U-1].indexOf(ne);ie!==-1&&(J+=ie)}),X.barycenter=J/X.parents.length}else X.barycenter=b[U].indexOf(X)}),W.sort((X,J)=>(X.barycenter||0)-(J.barycenter||0))}for(let U=b.length-2;U>=0;U--){const W=b[U];W.forEach(X=>{if(X.children.length>0){let J=0;X.children.forEach(Y=>{const ne=p[Y],ie=b[U+1].indexOf(ne);ie!==-1&&(J+=ie)}),X.barycenter=J/X.children.length}else X.barycenter=b[U].indexOf(X)}),W.sort((X,J)=>(X.barycenter||0)-(J.barycenter||0))}}const v=Math.min(...l.map(B=>B.x)),z=Math.min(...l.map(B=>B.y)),k=150,T=40;let I=v;const F=new Map;b.forEach((B,U)=>{if(B.length===0)return;const W=Math.max(...B.map(J=>J.node.width||260));B.reduce((J,Y)=>J+(Y.node.height||200),0)+(B.length-1)*T;let X=z;B.forEach(J=>{F.set(J.id,{...J.node,x:I,y:X}),X+=(J.node.height||200)+T}),I+=W+k}),x(B=>B.map(U=>F.has(U.id)?F.get(U.id):U))},ku=M.useCallback((r,o,l=null)=>{const u=Xt.get(r);if(!u)return;const p=(u==null?void 0:u.frames)||[],f=(u==null?void 0:u.selectedKeyframes)||[],m=(o||[]).filter(Boolean);if(m.length===0)return;const y=m.map((T,I)=>({time:Date.now()+I,url:T,filename:""})),b=l!==null?l:p.length,w=[...p.slice(0,b),...y,...p.slice(b)],v=new Set([...f,...y]),z=w.map((T,I)=>({...T,time:I})),k=z.filter((T,I)=>v.has(w[I]));x(T=>T.map(I=>I.id===r?{...I,frames:z,selectedKeyframes:k}:I))},[Xt,x]),bv=async(r,o)=>{o.preventDefault(),o.stopPropagation(),o.currentTarget.classList.remove("drag-over");const l=qa(o);if(l){const y=Ja(l.url||l.originalUrl||l.mjOriginalUrl||"",l.type);if(y){if(l.type==="video"||ur(y)){let w={duration:0,w:0,h:0};try{const v=await Xo(y);w=await id(v)}catch{}Ge(),x(v=>v.map(z=>z.id===r?{...z,content:y,videoMeta:w,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:""}:z))}else ku(r,[y]);return}}const u=Ga(o);if(u){if(ur(u)){let y={duration:0,w:0,h:0};try{const b=await Xo(u);y=await id(b)}catch{}Ge(),x(b=>b.map(w=>w.id===r?{...w,content:u,videoMeta:y,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:""}:w))}else ku(r,[u]);return}const p=Array.from(o.dataTransfer.files),f=p.find(y=>y.type.startsWith("video/"));if(f){Vc(r,f);return}const m=p.filter(y=>y.type.startsWith("image/"));if(m.sort((y,b)=>y.name.localeCompare(b.name,void 0,{numeric:!0,sensitivity:"base"})),m.length>0){const y=Xt.get(r),b=(y==null?void 0:y.frames)||[],w=(y==null?void 0:y.selectedKeyframes)||[];let v=0;const z=[];m.forEach((k,T)=>{const I=new FileReader;I.onload=async F=>{const B=F.target.result,U=await as.saveImage(B);if(z[T]={time:b.length+T,url:U,filename:k.name},v++,v===m.length){const W=z.filter(Boolean);x(X=>X.map(J=>J.id===r?{...J,frames:[...b,...W],selectedKeyframes:[...w,...W]}:J))}},I.readAsDataURL(k)})}},DN=(r,o,l)=>{r.preventDefault(),r.stopPropagation();const u=r.currentTarget.getBoundingClientRect(),f=r.clientX-u.left>u.width/2?l+1:l;(Q!==f||O!==o)&&(ue(f),K(o))},UN=(r,o,l)=>{r.preventDefault(),r.stopPropagation(),r.target===r.currentTarget&&(Q!==l||O!==o)&&(ue(l),K(o))},FN=(r,o)=>{var z;o.preventDefault(),o.stopPropagation();let l=O===r&&Q!==null?Q:(((z=Xt.get(r))==null?void 0:z.frames)||[]).length;K(null),ue(null);const u=qa(o);if(u){const k=u.url||u.originalUrl||u.mjOriginalUrl||"";k&&!(u.type==="video"||ur(k))&&ku(r,[k],l);return}const p=Ga(o);if(p&&!ur(p)){ku(r,[p],l);return}const f=Array.from(o.dataTransfer.files).filter(k=>k.type.startsWith("image/"));if(f.length===0)return;f.sort((k,T)=>k.name.localeCompare(T.name,void 0,{numeric:!0,sensitivity:"base"}));const m=Xt.get(r),y=(m==null?void 0:m.frames)||[],b=(m==null?void 0:m.selectedKeyframes)||[];let w=0;const v=[];f.forEach((k,T)=>{const I=new FileReader;I.onload=async F=>{const B=F.target.result,U=await as.saveImage(B);let W=B;try{const X=await as.getImage(U);X&&(W=URL.createObjectURL(X))}catch(X){console.warn("[KeyframeOrganizer] Failed to create blob URL, using base64:",X)}if(v[T]={time:Date.now()+T,url:W,imgId:U,filename:k.name},w++,w===f.length){const X=v.filter(Boolean),J=[...y.slice(0,l),...X,...y.slice(l)],Y=new Set([...b,...X]),ne=J.map((Z,te)=>({...Z,time:te})),ie=ne.filter((Z,te)=>Y.has(J[te]));x(Z=>Z.map(te=>te.id===r?{...te,frames:ne,selectedKeyframes:ie}:te))}},I.readAsDataURL(k)})},BN=async(r,o=30)=>new Promise((l,u)=>{const p=document.createElement("video");p.crossOrigin="anonymous",p.src=r,p.muted=!0;const f=document.createElement("canvas"),m=f.getContext("2d",{willReadFrequently:!0}),y=[];let b=null;p.onloadeddata=async()=>{f.width=320,f.height=Math.floor(320*(p.videoHeight/p.videoWidth));const w=p.duration,v=2;p.currentTime=0;const z=async()=>{const k=p.currentTime;if(k>=w||Math.abs(k-w)<.01){if(y.length===0||parseFloat(y[y.length-1].time)<w-.5){const F=document.createElement("canvas");F.width=p.videoWidth,F.height=p.videoHeight;const B=F.getContext("2d");p.currentTime=Math.max(0,w-.1),await new Promise(U=>{const W=setTimeout(()=>U(),200);p.onseeked=()=>{clearTimeout(W),B.drawImage(p,0,0);const X=Math.max(0,w-.1);y.push({time:X.toFixed(2),image:F.toDataURL("image/jpeg",.8)}),U()}})}l(y.map(F=>({time:parseFloat(F.time),url:F.image})));return}m.drawImage(p,0,0,f.width,f.height);const T=m.getImageData(0,0,f.width,f.height).data;if(b){let F=0;for(let U=0;U<T.length;U+=4)F+=Math.abs(T[U]-b[U])+Math.abs(T[U+1]-b[U+1])+Math.abs(T[U+2]-b[U+2]);if(F/(T.length/4*3)>o){const U=document.createElement("canvas");U.width=p.videoWidth,U.height=p.videoHeight,U.getContext("2d").drawImage(p,0,0);const W=U.toDataURL("image/jpeg",.8),X=p.currentTime;y.push({time:X.toFixed(2),image:W}),b=null}else b=T}else{b=T;const F=p.currentTime,B=document.createElement("canvas");B.width=p.videoWidth,B.height=p.videoHeight,B.getContext("2d").drawImage(p,0,0),y.push({time:F.toFixed(2),image:B.toDataURL("image/jpeg",.8)})}const I=p.currentTime+1/v;if(I>=w){if(y.length===0||parseFloat(y[y.length-1].time)<w-.5){const F=document.createElement("canvas");F.width=p.videoWidth,F.height=p.videoHeight;const B=F.getContext("2d");p.currentTime=Math.max(0,w-.1),await new Promise(U=>{const W=setTimeout(()=>U(),200);p.onseeked=()=>{clearTimeout(W),B.drawImage(p,0,0);const X=Math.max(0,w-.1);y.push({time:X.toFixed(2),image:F.toDataURL("image/jpeg",.8)}),U()}})}l(y.map(F=>({time:parseFloat(F.time),url:F.image})));return}p.currentTime=I,await new Promise(F=>{const B=setTimeout(()=>F(),200);p.onseeked=()=>{clearTimeout(B),F()}}),z()};z()},p.onerror=w=>u(new Error(""))}),HN=async(r,o=2)=>{const l=Xt.get(r);if(l!=null&&l.content){x(u=>u.map(p=>p.id===r?{...p,extractingFrames:!0}:p));try{const u=await kE(l.content,{fps:o});x(p=>p.map(f=>f.id===r?{...f,frames:u,selectedKeyframes:[],extractingFrames:!1}:f))}catch(u){console.error("",u),x(p=>p.map(f=>f.id===r?{...f,extractingFrames:!1}:f))}}},VN=async(r,o=30)=>{const l=Xt.get(r);if(l!=null&&l.content){x(u=>u.map(p=>p.id===r?{...p,extractingFrames:!0}:p));try{const u=await BN(l.content,o);x(p=>p.map(f=>f.id===r?{...f,frames:u,selectedKeyframes:[],extractingFrames:!1}:f))}catch(u){console.error("",u),alert(`: ${u.message}`),x(p=>p.map(f=>f.id===r?{...f,extractingFrames:!1}:f))}}},WN=(r,o,l=0,u=null)=>{const p=!!(u!=null&&u.shiftKey);x(f=>f.map(m=>{if(m.id!==r)return m;const y=m.frames||[],b=k=>`${k.time}-${k.url}`,w=new Map(y.map(k=>[b(k),k]));let z=[...m.selectedKeyframes||[]];if(p&&mf.current[r]!==void 0&&mf.current[r]!==null&&y.length>0){const k=mf.current[r],T=Math.min(k,l),I=Math.max(k,l),F=y.slice(T,I+1),B=new Set(z.map(b));F.forEach(U=>B.add(b(U))),z=Array.from(B).map(U=>w.get(U)).filter(Boolean)}else z=z.some(T=>b(T)===b(o))?z.filter(T=>b(T)!==b(o)):[...z,o];return mf.current[r]=l,{...m,selectedKeyframes:z}}))},KN=(r,o,l)=>{r.preventDefault(),r.stopPropagation(),tm({visible:!0,x:r.clientX,y:r.clientY,nodeId:o,frame:l})},Tf=()=>{tm({visible:!1,x:0,y:0,nodeId:null,frame:null})},JN=()=>{const{frame:r}=Oa;if(!(r!=null&&r.url))return;const o={name:`Frame-${(r.time??0).toFixed(2)}s.png`,type:"image/png",content:r.url,isImage:!0,isVideo:!1,isAudio:!1,fromHistory:!0,fileExt:"png"};Ui(l=>[...l,o]),So(!0),Tf()},qN=async()=>{const{frame:r}=Oa;if(!(r!=null&&r.url))return;let o=r.url;if(o.startsWith("blob:"))try{o=`data:image/png;base64,${await In(o)}`}catch(v){console.error(" Blob URL  URL:",v)}let l;try{const v=await os(o);v!=null&&v.w&&(v!=null&&v.h)&&(l={w:v.w,h:v.h})}catch{}const u=g.filter(v=>v.type==="input-image");let p,f;if(u.length>0){const v=u[u.length-1];p=v.x-40,f=v.y+35}else{const v=Hr(window.innerWidth/2,window.innerHeight/2);p=v.x+50,f=v.y+50}let m=p,y=f;const b=(v,z)=>g.some(k=>Math.abs(k.x-v)<80&&Math.abs(k.y-z)<80);let w=0;for(;b(m,y)&&w<50;)m-=40,y+=35,w++;is("input-image",m,y,null,o,l),Tf()},GN=()=>{const{frame:r}=Oa;r!=null&&r.url&&(x(o=>{const l=Po.current,u=vi.current,p=o.filter(m=>m.type==="preview");if(!p.length)return o;let f=null;if(l){const m=p.find(y=>y.id===l);m&&(f=m.id)}if(!f&&u&&u.size>0){const m=p.find(y=>u.has(y.id));m&&(f=m.id)}return f||(f=p[p.length-1].id),o.map(m=>m.id===f?{...m,content:r.url,previewType:"image"}:m)}),Tf())},YN=()=>{const{frame:r}=Oa;if(!(r!=null&&r.url))return;const o=q,l=Xt.get(o);l&&l.type==="input-image"?x(u=>u.map(p=>p.id===o?{...p,content:r.url}:p)):alert(j('""')),Tf()},Mf=(r,o,l=null,u=null)=>{r.preventDefault(),r.stopPropagation();const p=l?Ar(o,l):Ar(o),f=u!==null?u:o.selectedMjImageIndex!==void 0?o.selectedMjImageIndex:null,m={...o,url:p,selectedMjImageIndex:f},y=Hr(r.clientX,r.clientY);Fi({visible:!0,x:r.clientX,y:r.clientY,worldX:y.x,worldY:y.y,item:m}),ao(!1)},yv=r=>{if(!Js.nodeId||!Js.shotId)return!1;const o=Ar(r);return o?r.type==="video"||ur(o)?(d("","warning"),!1):(ar(Js.nodeId,Js.shotId,{image_url:o,image_filename:""}),!0):!1},Tm=M.useCallback(r=>r==="video-input"?{w:580,h:460}:r==="input-image"?{w:260,h:260}:{w:260,h:260},[]),Za=M.useCallback(async(r,o,l)=>{if(!r||!o)return!1;const u=l?"video-input":"input-image",p=Tm(u),m=r.x-40-p.w/2,y=r.y+r.height/2;let b;if(!l)try{const v=await Xo(o);b=await os(v)}catch{}const w=is(u,m,y,null,o,b,r.id);if(l&&(w!=null&&w.id))try{const v=await Xo(o),z=await id(v);x(k=>k.map(T=>T.id===w.id?{...T,content:o,videoMeta:z,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:""}:T))}catch{}return!0},[is,Tm,Xo,x]),XN=async(r,o)=>{if(!r)return!1;const l=Ja(Ar(o),o.type);if(!l)return!1;if(r.type==="preview"){const u=mm(o),p=o.selectedMjImageIndex??0,f=u?u[p]||u[0]:l;return x(m=>m.map(y=>y.id===r.id?{...y,content:f,previewType:o.type==="video"||ur(f)?"video":"image",previewMjImages:u}:y)),!0}if(r.type==="input-image"){let u=null;if(!ur(l))try{const p=await Xo(l);u=await os(p)}catch{}return x(p=>p.map(f=>f.id===r.id?{...f,content:l,dimensions:ur(l)?null:u}:f)),!0}if(r.type==="video-input"){if(o.type==="video"||ur(l)){let u={duration:0,w:0,h:0};try{const p=await Xo(l);u=await id(p)}catch{}return x(p=>p.map(f=>f.id===r.id?{...f,content:l,videoMeta:u,frames:[],selectedKeyframes:[],extractingFrames:!1,videoFileName:""}:f)),!0}return ku(r.id,[l]),!0}if(r.type==="video-analyze"){const u=o.type==="video"||ur(l);return await Za(r,l,u)}if(r.type==="gen-image"||r.type==="gen-video"||r.type==="image-compare"){const u=o.type==="video"||ur(l);return u&&r.type==="gen-image"?(d("AI ","warning"),!1):u&&r.type==="image-compare"?(d("","warning"),!1):await Za(r,l,u)}return!1},ZN=async(r,o)=>{o.preventDefault(),o.stopPropagation();const l=Xt.get(r);if(!l)return;const u=qa(o);if(u){const b=Ja(u.url||u.originalUrl||u.mjOriginalUrl||"",u.type);if(b){const w=u.type==="video"||ur(b);await Za(l,b,w)}return}const p=Ga(o);if(p){await Za(l,p,ur(p));return}const f=Array.from(o.dataTransfer.files||[]),m=f.find(b=>b.type.startsWith("video/"));if(m){const b=Tm("video-input"),v=l.x-40-b.w/2,z=l.y+l.height/2,k=is("video-input",v,z,null,void 0,void 0,l.id);k!=null&&k.id&&Vc(k.id,m);return}const y=f.find(b=>b.type.startsWith("image/"));if(y){const b=new FileReader;b.onload=async w=>{const v=w.target.result;v&&await Za(l,v,!1)},b.readAsDataURL(y)}},Mm=async(r,o)=>{o.preventDefault(),o.stopPropagation();const l=Xt.get(r);if(!l)return;const u=qa(o);if(u){const b=Ja(u.url||u.originalUrl||u.mjOriginalUrl||"",u.type);if(b){if((u.type==="video"||ur(b))&&(l.type==="gen-image"||l.type==="image-compare"||l.type==="gen-video")){d("","warning");return}await Za(l,b,!1)}return}const p=Ga(o);if(p){if(ur(p)&&(l.type==="gen-image"||l.type==="image-compare"||l.type==="gen-video")){d("","warning");return}await Za(l,p,!1);return}const f=Array.from(o.dataTransfer.files||[]),m=f.find(b=>b.type.startsWith("image/"));if(m){const b=new FileReader;b.onload=async w=>{const v=w.target.result;v&&await Za(l,v,!1)},b.readAsDataURL(m);return}f.find(b=>b.type.startsWith("video/"))&&d("","warning")},vv=async()=>{const r=Ks.item,o=Ar(r,(r==null?void 0:r.url)||(r==null?void 0:r.originalUrl)||(r==null?void 0:r.mjOriginalUrl)||null);if(!o)return;let l=o;r.type==="video"&&!ur(l)&&(l+=(l.includes("?")?"&":"?")+"force_video_display=true");let u;if(r.type==="image")try{const z=await os(l);z!=null&&z.w&&(z!=null&&z.h)&&(u={w:z.w,h:z.h})}catch(z){console.error("SendHistoryToCanvas getImageDimensions error",z)}const p=g.filter(z=>z.type==="input-image");let f,m;if(p.length>0){const z=p[p.length-1];f=z.x-40,m=z.y+35}else{const z=Hr(window.innerWidth/2,window.innerHeight/2);f=z.x+50,m=z.y+50}let y=f,b=m;const w=(z,k)=>g.some(T=>Math.abs(T.x-z)<80&&Math.abs(T.y-k)<80);let v=0;for(;w(y,b)&&v<50;)y-=40,b+=35,v++;is("input-image",y,b,null,l,u),Fi({visible:!1,x:0,y:0,item:null}),ao(!1)},wv=()=>{const r=Ks.item,o=Ar(r,(r==null?void 0:r.url)||(r==null?void 0:r.originalUrl)||(r==null?void 0:r.mjOriginalUrl)||null);if(!r||!o)return;const l=r.type==="image",u=r.type==="video",p=l?"png":u?"mp4":"file",f=l?"image/png":u?"video/mp4":"application/octet-stream",m={name:`Generated-${r.id}.${p}`,type:f,content:o,isImage:l,isVideo:u,isAudio:!1,fromHistory:!0,fileExt:p};Ui(y=>[...y,m]),So(!0),Fi({visible:!1,x:0,y:0,item:null}),ao(!1)},QN=()=>{const r=Ks.item,o=Ar(r,(r==null?void 0:r.url)||(r==null?void 0:r.originalUrl)||(r==null?void 0:r.mjOriginalUrl)||null);if(!o)return;const l=r!=null&&r.mjImages&&r.mjImages.length>1?r.mjImages:null,u=(r==null?void 0:r.selectedMjImageIndex)??0,p=l&&(l[u]||l[0])||o;x(f=>{const m=f.filter(v=>v.type==="preview");if(!m.length)return f;const y=Po.current,b=vi.current;let w=null;if(y){const v=m.find(z=>z.id===y);v&&(w=v.id)}if(!w&&b&&b.size>0){const v=m.find(z=>b.has(z.id));v&&(w=v.id)}return w||(w=m[m.length-1].id),f.map(v=>v.id===w?{...v,content:p,previewType:r.type==="video"||ur(p)?"video":"image",previewMjImages:l}:v)}),Fi({visible:!1,x:0,y:0,item:null}),ao(!1)},eS=async()=>{const r=Ks.item;if(!r)return;const o=Q0.current.target==="chat"&&Date.now()-Q0.current.at<3e3;if(G2||Y2||o){wv();return}const l=Po.current||vi.current&&[...vi.current][0];if(l){const u=Xt.get(l);if(u){if(u.type==="storyboard-node"){if(Js.nodeId&&Js.shotId&&yv(r)){Fi({visible:!1,x:0,y:0,item:null}),ao(!1);return}d("","warning");return}if(await XN(u,r)){Fi({visible:!1,x:0,y:0,item:null}),ao(!1);return}}}if(Js.nodeId&&Js.shotId&&yv(r)){Fi({visible:!1,x:0,y:0,item:null}),ao(!1);return}vv()},Rm=async r=>{if(!r||r.length===0){console.warn("[V3.5.1 Debug] No items to download");return}const o=f=>(f==null?void 0:f.localCacheUrl)||(f==null?void 0:f.url)||(f==null?void 0:f.originalUrl)||(f==null?void 0:f.mjOriginalUrl);if(r.length===1){const f=r[0],m=o(f);if(!(f!=null&&f.mjImages)&&m){xs({active:!0,current:0,total:1});try{const b=m;let w="mp4";if(b.startsWith("data:image"))w="png";else if(b.startsWith("data:video"))w="mp4";else if(f.type==="video"||b.includes("/video/")||b.includes("video_mp4"))w="mp4";else if(f.type==="image")w="png";else{const T=b.split("?")[0].split("/").pop();if(T&&T.includes(".")){const I=T.split(".").pop();I&&I.length<=5&&/^[a-z0-9]+$/i.test(I)&&(w=I)}}const z=`${(f.prompt||"download").replace(/[\\/:*?"<>|]/g,"_").slice(0,50)}.${w}`;if(b.startsWith("data:")){const k=document.createElement("a");k.href=b,k.download=z,k.click()}else{const k=ps(f),{blob:T}=await Bi(b,{useProxy:k}),I=document.createElement("a");I.href=URL.createObjectURL(T),I.download=z,I.click()}xs({active:!1,current:1,total:1})}catch(b){console.error(":",b),xs({active:!1,current:0,total:0}),alert(": "+b.message)}return}}const l=new ph;let u=0;const p=r.length;xs({active:!0,current:0,total:p});try{for(const b of r){if(!b)continue;const w=[];if(b.mjImages&&b.mjImages.length>0)b.mjImages.forEach((v,z)=>{w.push({url:v,suffix:`_${z+1}`})});else{const v=o(b);v&&w.push({url:v,suffix:""})}for(const v of w)try{let z;if(v.url.startsWith("data:")){const U=v.url.split(","),W=U[0].match(/:(.*?);/)[1],X=atob(U[1]);let J=X.length;const Y=new Uint8Array(J);for(;J--;)Y[J]=X.charCodeAt(J);z=new Blob([Y],{type:W})}else{const U=ps(b);z=(await Bi(v.url,{useProxy:U})).blob}let k=z.type.split("/")[1]||"png";const T=o(b);if(T&&!T.startsWith("data:")){const U=T.split(".").pop().split("?")[0];U&&U.length<5&&(k=U)}const I=(b.prompt||"untitled").replace(/[\\/:*?"<>|]/g,"_").slice(0,40),F=b.id?`_${b.id.slice(-4)}`:"",B=`${I}${F}${v.suffix}.${k}`;l.file(B,z),u++}catch(z){console.error(` [${b.id}]:`,z)}xs(v=>({...v,current:v.current+1}))}if(u===0){xs({active:!1,current:0,total:0}),alert(j(""));return}const f=await l.generateAsync({type:"blob"}),m=new Date,y=`${m.getFullYear().toString().slice(2)}${(m.getMonth()+1).toString().padStart(2,"0")}${m.getDate().toString().padStart(2,"0")}-${m.getHours().toString().padStart(2,"0")}${m.getMinutes().toString().padStart(2,"0")}`;Cg.saveAs(f,`tapnow-assets-${y}.zip`),xs({active:!1,current:0,total:0})}catch(f){console.error(":",f),xs({active:!1,current:0,total:0}),alert(": "+f.message)}},tS=(r,o="all")=>{var z,k,T;const l=((z=r.settings)==null?void 0:z.mode)||"video",u=((k=r.settings)==null?void 0:k.shots)||[],p=((T=r.settings)==null?void 0:T.projectTitle)||"",f=Ls(p)||"",m=[],y=I=>{const F=(I.description||I.prompt||"").trim();return Ls(F)||""},b=(I,F,B,U)=>{if(!B)return;const W=B.startsWith("data:")?ra(B,".png")||".png":lo(B,".png")||".png",X=y(I),J=`${f}-${X}-${F}-${U}${W}`;m.push({url:B,filename:J})},w=(I,F,B)=>{if(!B)return;const U=B.startsWith("data:")?ra(B,".mp4")||".mp4":lo(B,".mp4")||".mp4",W=y(I),X=`${f}-${W}-${F}${U}`;m.push({url:B,filename:X})},v=o!=="all"&&u.some(I=>I.outputEnabled);return u.forEach((I,F)=>{var U;const B=I.scene_index||F+1;if(l==="image"){const W=(U=I.output_images)!=null&&U.length?I.output_images:I.output_url?[I.output_url]:[];if(W.length===0)return;if(o==="all"){W.forEach((Y,ne)=>b(I,B,Y,ne+1));return}const X=Number.isInteger(I.selectedImageIndex)?I.selectedImageIndex:-1,J=!!I.outputEnabled;if(v){if(!J)return;if(X>=0&&W[X]){b(I,B,W[X],X+1);return}W.forEach((Y,ne)=>b(I,B,Y,ne+1));return}X>=0&&W[X]&&b(I,B,W[X],X+1)}else{const W=I.video_url||I.output_url;if(!W)return;if(o==="all"){w(I,B,W);return}I.outputEnabled&&w(I,B,W)}}),m},zv=async(r,o="all")=>{var z;const l=tS(r,o);if(!l.length){alert(j(""));return}const u=new Date,p=`${u.getFullYear().toString().slice(2)}${String(u.getMonth()+1).padStart(2,"0")}${String(u.getDate()).padStart(2,"0")}-${String(u.getHours()).padStart(2,"0")}${String(u.getMinutes()).padStart(2,"0")}`,f=((z=r.settings)==null?void 0:z.projectTitle)||"",m=`${Ls(f)||""}-batch-${p}.zip`,y=async k=>{var I;if(k.startsWith("data:")){const F=k.split(","),B=((I=F[0].match(/:(.*?);/i))==null?void 0:I[1])||"application/octet-stream",U=atob(F[1]||""),W=new Uint8Array(U.length);for(let X=0;X<U.length;X++)W[X]=U.charCodeAt(X);return new Blob([W],{type:B})}const T=await fetch(k);if(!T.ok)throw new Error(`HTTP ${T.status}`);return await T.blob()};if(l.length===1){try{xs({active:!0,current:0,total:1});const k=await y(l[0].url),T=document.createElement("a");T.href=URL.createObjectURL(k),T.download=l[0].filename,T.click(),URL.revokeObjectURL(T.href),xs({active:!1,current:1,total:1})}catch(k){xs({active:!1,current:0,total:0}),alert(": "+k.message)}return}const b=new ph;xs({active:!0,current:0,total:l.length});let w=0;for(const k of l){try{const T=await y(k.url);b.file(k.filename,T),w+=1}catch(T){console.error(":",k.filename,T)}xs(T=>({...T,current:T.current+1}))}if(w===0){xs({active:!1,current:0,total:0}),alert(j(""));return}const v=await b.generateAsync({type:"blob"});Cg.saveAs(v,m),xs({active:!1,current:0,total:0})},ju=(r,o)=>{o!=null&&o.url&&(r.preventDefault(),r.stopPropagation(),oy({visible:!0,x:r.clientX,y:r.clientY,item:o}))},Hl=()=>oy({visible:!1,x:0,y:0,item:null}),rS=()=>{const r=La.item;if(!(r!=null&&r.url))return;const o=r.type!=="video",l=r.type==="video",u=o?"png":"mp4",p=o?"image/png":"video/mp4",f={name:`Preview-${Date.now()}.${u}`,type:p,content:r.url,isImage:o,isVideo:l,isAudio:!1,fileExt:u};Ui(m=>[...m,f]),So(!0),Hl()},nS=async()=>{const r=La.item;if(!(r!=null&&r.url))return;const o=Hr(window.innerWidth/2,window.innerHeight/2);let l={w:512,h:512};try{l=await os(r.url)}catch(u){console.warn("Preview dims fail",u)}is("input-image",o.x+50,o.y+50,null,r.url,l),Hl()},sS=(r,o)=>{r.preventDefault(),r.stopPropagation();const l=Xt.get(o);!l||!l.content||ay({visible:!0,x:r.clientX,y:r.clientY,nodeId:o})},Om=()=>{ay({visible:!1,x:0,y:0,nodeId:null})},iS=()=>{const r=nu.nodeId,o=Xt.get(r);if(!o||!o.content)return;const l=!ur(o.content),u=ur(o.content),p=l?"png":"mp4",f=l?"image/png":"video/mp4",m={name:`InputImage-${Date.now()}.${p}`,type:f,content:o.content,isImage:l,isVideo:u,isAudio:!1,fileExt:p};Ui(y=>[...y,m]),So(!0),Om()},kv=M.memo(({connections:r,nodesMap:o,connectionsByNode:l,connectingSource:u,connectingTarget:p,connectingInputType:f,mousePos:m,apiConfigsMap:y,selectedNodeId:b,onDisconnectConnection:w,visibleNodes:v})=>{const z=M.useMemo(()=>new Set(v.map(T=>T.id)),[v]),k=M.useMemo(()=>r.filter(T=>z.has(T.from)||z.has(T.to)),[r,z]);return i.jsx("div",{className:"absolute inset-0 pointer-events-none overflow-visible w-full h-full",children:i.jsxs("svg",{className:"absolute inset-0 overflow-visible w-full h-full pointer-events-none",children:[k.map(T=>{var Te;const I=o.get(T.from),F=o.get(T.to);if(!I||!F)return null;const B=b&&(I.id===b||F.id===b),U=B?1:.35,W=I.x+I.width-4,X=I.y+I.height/2,J=F.x+4;let Y=F.y+F.height/2;if(F.type==="image-compare"){const Be=(l.to.get(F.id)||[]).findIndex(Le=>Le.id===T.id);Be===0?Y=F.y+F.height*.33:Be>=1&&(Y=F.y+F.height*.66)}if(F.type==="gen-image"&&(T.inputType==="oref"||T.inputType==="sref")){const Qe=sr((Te=F.settings)==null?void 0:Te.model);if(Qe&&(Qe.id.includes("mj")||Qe.provider.toLowerCase().includes("midjourney"))){const qe=(l.to.get(F.id)||[]).some(vt=>!vt.inputType||vt.inputType==="default");let Ze=12;Ze+=24,qe&&(Ze+=68),Ze+=108,T.inputType==="oref"?Y=F.y+Ze+16*.5:T.inputType==="sref"&&(Y=F.y+Ze+16+6+28+6+16*.5)}}if(F.type==="gen-video"&&(T.inputType==="veo_start"||T.inputType==="veo_end")){const xt=Math.max(110,Math.min(180,F.height*.4)),Zt=8,Nt=12,Ot=14,er=12,pr=8,H=18,ve=8,Ze=(l.to.get(F.id)||[]).some(wt=>!wt.inputType||wt.inputType==="default");let vt=12;vt+=24,Ze&&(vt+=68),vt+=xt+Zt;const Et=vt+Nt+Ot+pr+er+pr+H*.5,Lt=Et+H+ve;Y=F.y+(T.inputType==="veo_start"?Et:Lt)}const ne=Math.abs(J-W),ie=W+ne*.5,Z=J-ne*.5,te=(W+J)/2,pe=(X+Y)/2;return i.jsxs("g",{className:"connection-group",style:{opacity:U},children:[i.jsx("path",{d:`M ${W} ${X} C ${ie} ${X}, ${Z} ${Y}, ${J} ${Y}`,stroke:"transparent",strokeWidth:"20",fill:"none",style:{pointerEvents:"stroke"}}),i.jsx("path",{d:`M ${W} ${X} C ${ie} ${X}, ${Z} ${Y}, ${J} ${Y}`,stroke:"#18181b",strokeWidth:"4",fill:"none"}),i.jsx("path",{d:`M ${W} ${X} C ${ie} ${X}, ${Z} ${Y}, ${J} ${Y}`,stroke:"#71717a",strokeWidth:"2",fill:"none"}),i.jsx("circle",{cx:W,cy:X,r:"2",fill:"#71717a"}),i.jsx("circle",{cx:J,cy:Y,r:"2",fill:"#71717a"}),i.jsxs("g",{className:"connection-delete cursor-pointer",style:{opacity:B?1:.35,pointerEvents:"auto",cursor:"pointer"},onClick:Qe=>{Qe.stopPropagation(),Qe.preventDefault(),w(T.id)},onMouseDown:Qe=>{Qe.stopPropagation(),Qe.preventDefault(),w(T.id)},children:[i.jsx("circle",{cx:te,cy:pe,r:"25",fill:"transparent",style:{pointerEvents:"auto",cursor:"pointer"},onClick:Qe=>{Qe.stopPropagation(),Qe.preventDefault(),w(T.id)},onMouseDown:Qe=>{Qe.stopPropagation(),Qe.preventDefault(),w(T.id)}}),i.jsx("circle",{cx:te,cy:pe,r:"12",fill:"#ef4444",opacity:"0.8",style:{pointerEvents:"none"}}),i.jsx("circle",{cx:te,cy:pe,r:"8",fill:"#ef4444",style:{pointerEvents:"none"}}),i.jsx(a3,{size:10,className:"text-white",x:te-5,y:pe-5,style:{pointerEvents:"none"}})]})]},T.id)}),u&&(()=>{const T=o.get(u);return T?i.jsx("path",{d:`M ${T.x+T.width-4} ${T.y+T.height/2} C ${T.x+T.width+100} ${T.y+T.height/2}, ${m.x-100} ${m.y}, ${m.x} ${m.y}`,stroke:"#60a5fa",strokeWidth:"2",fill:"none",strokeDasharray:"4,4"}):null})(),p&&(()=>{var B;const T=o.get(p);if(!T)return null;const I=T.x+4;let F=T.y+T.height/2;if(T.type==="gen-image"&&f){const U=sr((B=T.settings)==null?void 0:B.model);if(U&&(U.id.includes("mj")||U.provider.toLowerCase().includes("midjourney"))){const Le=(l.to.get(T.id)||[]).some(ut=>!ut.inputType||ut.inputType==="default");let it=12;it+=24,Le&&(it+=68),it+=108,f==="oref"?F=T.y+it+16*.5:f==="sref"&&(F=T.y+it+16+6+28+6+16*.5)}}else if(T.type==="gen-video"&&(f==="veo_start"||f==="veo_end")){const ne=Math.max(110,Math.min(180,T.height*.4)),ie=8,Z=12,te=14,pe=12,Te=8,Qe=18,Be=8,it=(l.to.get(T.id)||[]).some(Ot=>!Ot.inputType||Ot.inputType==="default");let ut=12;ut+=24,it&&(ut+=68),ut+=ne+ie;const Zt=ut+Z+te+Te+pe+Te+Qe*.5,Nt=Zt+Qe+Be;F=T.y+(f==="veo_start"?Zt:Nt)}else T.type==="image-compare"&&(F=T.y+T.height/2);return i.jsx("path",{d:`M ${I} ${F} C ${I-100} ${F}, ${m.x+100} ${m.y}, ${m.x} ${m.y}`,stroke:"#60a5fa",strokeWidth:"2",fill:"none",strokeDasharray:"4,4"})})()]})})},(r,o)=>r.connections===o.connections&&r.visibleNodes===o.visibleNodes&&r.selectedNodeId===o.selectedNodeId&&r.connectingSource===o.connectingSource&&r.connectingTarget===o.connectingTarget&&r.connectingInputType===o.connectingInputType&&r.mousePos.x===o.mousePos.x&&r.mousePos.y===o.mousePos.y);M.useCallback(()=>i.jsx(kv,{connections:N,nodesMap:Xt,connectionsByNode:Wa,connectingSource:En,connectingTarget:Jr,connectingInputType:oi,mousePos:K0,apiConfigsMap:Va,selectedNodeId:q,onDisconnectConnection:Em,visibleNodes:yf}),[N,Xt,Wa,En,Jr,oi,K0,Va,q,Em,yf]);const jv=M.useMemo(()=>{const r=new Map;return N.forEach(o=>{(!o.inputType||o.inputType==="default")&&r.set(o.to,!0)}),r},[N]),Nv=M.useCallback(r=>{const o=new Set,l=Wa.from.get(r)||[],u=Wa.to.get(r)||[];return l.forEach(p=>o.add(p.to)),u.forEach(p=>o.add(p.from)),o},[Wa]),Sv=M.useMemo(()=>{const r=new Map;if(q||en.size>0){const o=q||(en.size===1?Array.from(en)[0]:null);o&&r.set(o,Nv(o))}return r},[q,en,Nv]),oS=M.useCallback(r=>{var I,F,B,U,W,X,J,Y,ne,ie,Z,te,pe,Te,Qe,Be,Le,it,ut,xt,Zt,Nt,Ot,er,pr;const l=E.zoom<.4,u=q===r.id||en.has(r.id),p=Vy(r.id),f=_c===r.id,m=jv.get(r.id)||!1,y=si===r.id||si&&en.has(r.id),b=q||(en.size===1?Array.from(en)[0]:null),w=b?Sv.get(b):null,v=b&&b!==r.id&&w&&w.has(r.id),z=sr((I=r.settings)==null?void 0:I.model),k=z?(z.modelName||z.id||"").includes("nano-banana-2"):(((F=r.settings)==null?void 0:F.model)||"").includes("nano-banana-2"),T=r.type==="gen-image"||r.type==="gen-video"||r.type==="image-compare";return l?i.jsxs("div",{"data-node-id":r.id,className:`absolute node-wrapper flex flex-col ${u?"ring-1 ring-blue-500":e==="dark"?"border border-zinc-800":e==="solarized"?"border border-[#eee8d5]":"border border-zinc-200"} ${e==="dark"?"bg-[#18181b]":e==="solarized"?"bg-[#eee8d5]":"bg-white"}`,style:{left:r.x,top:r.y,width:r.width,height:r.height,cursor:si===r.id||si&&en.has(r.id)?"grabbing":"default",zIndex:y?50:10,border:`1px solid ${e==="dark"?"#3f3f46":e==="solarized"?"#eee8d5":"#e4e4e7"}`,background:e==="dark"?"#18181b":e==="solarized"?"#eee8d5":"#fff",boxShadow:"none",borderRadius:"0",transform:"translateZ(0)",backfaceVisibility:"hidden"},onDragOver:T?Ol:void 0,onDrop:T?H=>Mm(r.id,H):void 0,onMouseDownCapture:H=>{if(H.button!==0||H.target===H.currentTarget||!H.target.closest('input, textarea, select, button, a, [contenteditable="true"]'))return;if(H.nativeEvent&&(H.nativeEvent.__tapnowSelectionHandled=!0),H.ctrlKey||H.metaKey){ss(Ze=>{const vt=new Set(Ze);return vt.has(r.id)?vt.delete(r.id):vt.add(r.id),vt.size===1?le(Array.from(vt)[0]):le(null),vt});return}en.has(r.id)&&en.size>1?le(r.id):(le(r.id),ss(new Set([r.id])))},onMouseDown:H=>{var ve;(ve=H.nativeEvent)!=null&&ve.__tapnowSelectionHandled||H.button===0&&(H.stopPropagation(),tu("node"),H.ctrlKey||H.metaKey?ss(qe=>{const Ze=new Set(qe);return Ze.has(r.id)?Ze.delete(r.id):Ze.add(r.id),Ze.size===1?le(Array.from(Ze)[0]):le(null),Ze}):en.has(r.id)&&en.size>1?le(r.id):(le(r.id),ss(new Set([r.id]))),eu(r.id))},onMouseEnter:()=>{(En||Jr)&&Ta(r.id)},onMouseLeave:()=>{(En||Jr)&&_c===r.id&&Ta(null)},onMouseUp:H=>zi(r.id,H),children:[r.type==="input-image"&&r.content&&i.jsx("div",{className:"w-full h-full relative",children:ur(r.content)?i.jsx(pa,{src:r.content,className:"w-full h-full object-cover opacity-80",muted:!0,playsInline:!0}):i.jsx(nn,{src:r.content,className:"w-full h-full object-cover opacity-80",alt:""})}),r.type==="video-input"&&r.content&&i.jsx(pa,{src:r.content,className:"w-full h-full object-cover opacity-80",muted:!0,playsInline:!0}),!r.content&&i.jsx("div",{className:`p-2 font-bold text-sm truncate ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:r.type==="input-image"?"":r.type==="video-input"?"":r.type==="gen-image"||r.type==="gen-image"?"":r.type==="gen-video"?"":r.type==="text-node"?"":r.type==="preview"?"":r.type==="novel-input"?"":r.type==="extract-characters-scenes"?"":r.type==="character-description"?"":r.type==="scene-description"?"":r.type==="generate-character-video"?"":r.type==="generate-scene-video"?"":r.type==="generate-character-image"?"":r.type==="generate-scene-image"?"":r.type==="create-character"?"":r.type==="create-scene"?"":r.type==="save-to-local"||r.type==="local-save"?"":r.type||""}),r.type!=="input-image"&&r.type!=="video-input"&&r.type!=="video-analyze"&&r.type!=="preview"&&(r.type==="image-compare"?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"input-point",style:{top:"33%",left:"-0.25rem",width:"0.5rem",height:"0.5rem",backgroundColor:m?"#60a5fa":"#52525b",borderRadius:"50%",position:"absolute",zIndex:20,pointerEvents:"auto"},onMouseDown:H=>{H.stopPropagation(),H.preventDefault();const ve=Hr(H.clientX,H.clientY);xi(ve),ii(r.id),ai("default")},onMouseUp:H=>zi(r.id,H,"default")}),i.jsx("div",{className:"input-point",style:{top:"66%",left:"-0.25rem",width:"0.5rem",height:"0.5rem",backgroundColor:m?"#60a5fa":"#52525b",borderRadius:"50%",position:"absolute",zIndex:20,pointerEvents:"auto"},onMouseDown:H=>{H.stopPropagation(),H.preventDefault();const ve=Hr(H.clientX,H.clientY);xi(ve),ii(r.id),ai("default")},onMouseUp:H=>zi(r.id,H,"default")})]}):i.jsx("div",{className:"input-point",style:{top:"50%",left:"-0.25rem",width:"0.5rem",height:"0.5rem",backgroundColor:m?"#60a5fa":"#52525b",borderRadius:"50%",position:"absolute",zIndex:20,pointerEvents:"auto"},onMouseDown:H=>{H.stopPropagation(),H.preventDefault();const ve=Hr(H.clientX,H.clientY);xi(ve),ii(r.id),ai("default")},onMouseUp:H=>zi(r.id,H,"default")})),r.type!=="preview"&&i.jsx("div",{className:"connector connector-right",style:{position:"absolute",top:"50%",right:"-0.45rem",width:"0.9rem",height:"0.9rem",backgroundColor:En===r.id?"#d4d4d8":"#27272a",border:"1px solid #71717a",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"crosshair",zIndex:30,opacity:En===r.id?1:.5,pointerEvents:"auto"},onMouseDown:H=>{H.stopPropagation(),H.preventDefault();const ve=Hr(H.clientX,H.clientY);xi(ve),Sc(r.id)},children:i.jsx(Ro,{size:10})})]},r.id):i.jsxs("div",{"data-node-id":r.id,className:`absolute rounded-xl shadow-xl transition-shadow duration-150 group flex flex-col node-wrapper ${u?"ring-1 ring-blue-500 shadow-blue-500/20":v?"ring-2 ring-blue-300/60 shadow-blue-300/30":e==="dark"?"border border-zinc-800 shadow-black/40":e==="solarized"?"border border-[#eee8d5] shadow-black/10":"border border-zinc-200 shadow-black/10"} ${f&&(En&&En!==r.id||Jr&&Jr!==r.id)?"ring-2 ring-green-500/50":""} ${e==="dark"?"bg-[#18181b]":e==="solarized"?"bg-[#eee8d5]":"bg-white"}`,style:{left:r.x,top:r.y,width:r.width,height:r.height,cursor:si===r.id||si&&en.has(r.id)?"grabbing":"default",zIndex:y?50:10,WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",transform:"translateZ(0)",backfaceVisibility:"hidden"},onDragOver:T?Ol:void 0,onDrop:T?H=>Mm(r.id,H):void 0,onMouseDownCapture:H=>{if(H.button!==0||H.target===H.currentTarget||!H.target.closest('input, textarea, select, button, a, [contenteditable="true"]'))return;if(H.nativeEvent&&(H.nativeEvent.__tapnowSelectionHandled=!0),H.ctrlKey||H.metaKey){ss(Ze=>{const vt=new Set(Ze);return vt.has(r.id)?vt.delete(r.id):vt.add(r.id),vt.size===1?le(Array.from(vt)[0]):le(null),vt});return}en.has(r.id)&&en.size>1?le(r.id):(le(r.id),ss(new Set([r.id])))},onMouseDown:H=>{var ve;(ve=H.nativeEvent)!=null&&ve.__tapnowSelectionHandled||H.button===0&&(H.stopPropagation(),tu("node"),H.ctrlKey||H.metaKey?ss(qe=>{const Ze=new Set(qe);return Ze.has(r.id)?Ze.delete(r.id):Ze.add(r.id),Ze.size===1?le(Array.from(Ze)[0]):le(null),Ze}):en.has(r.id)&&en.size>1?le(r.id):(le(r.id),ss(new Set([r.id]))),eu(r.id),Er(null))},onMouseEnter:()=>{(En||Jr)&&Ta(r.id)},onMouseLeave:()=>{(En||Jr)&&_c===r.id&&Ta(null)},onMouseUp:H=>zi(r.id,H),onDoubleClick:H=>{H.stopPropagation(),(r.type==="input-image"||r.type==="video-input")&&r.content&&gn({url:r.content,type:ur(r.content)?"video":"image"})},children:[i.jsx("button",{onClick:H=>{H.stopPropagation(),gm(r.id)},className:`absolute -top-2.5 -right-2.5 z-50 p-1 rounded-full shadow border opacity-0 group-hover:opacity-100 transition-opacity scale-90 hover:scale-100 ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:text-red-500 hover:bg-zinc-700 border-zinc-700":"bg-zinc-100 text-zinc-500 hover:text-red-500 hover:bg-zinc-200 border-zinc-300"}`,onMouseDown:H=>H.stopPropagation(),children:i.jsx(ui,{size:12})}),i.jsx("div",{className:"absolute bottom-1 right-1 w-4 h-4 z-[100] resize-handle flex items-end justify-end p-0.5",onMouseDown:H=>{H.stopPropagation(),H.preventDefault(),Qp(r.id)},children:i.jsx("svg",{width:"6",height:"6",viewBox:"0 0 8 8",fill:"none",className:"text-zinc-600",children:i.jsx("path",{d:"M8 0L8 8L0 8",stroke:"currentColor",strokeWidth:"2"})})}),r.type!=="input-image"&&r.type!=="video-input"&&r.type!=="video-analyze"&&r.type!=="preview"&&(r.type==="image-compare"?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:`input-point ${Jr===r.id&&!oi?"active":""}`,style:{top:"33%"},title:j(" 1 "),onMouseDown:H=>{H.stopPropagation(),H.preventDefault();const ve=Hr(H.clientX,H.clientY);xi(ve),ii(r.id),ai("default")},onMouseUp:H=>zi(r.id,H,"default")}),i.jsx("div",{className:`input-point ${Jr===r.id&&!oi?"active":""}`,style:{top:"66%"},title:j(" 2 "),onMouseDown:H=>{H.stopPropagation(),H.preventDefault();const ve=Hr(H.clientX,H.clientY);xi(ve),ii(r.id),ai("default")},onMouseUp:H=>zi(r.id,H,"default")})]}):i.jsx("div",{className:`input-point ${m?"connected":""} ${Jr===r.id&&!oi?"active":""}`,title:j(""),onMouseDown:H=>{H.stopPropagation(),H.preventDefault();const ve=Hr(H.clientX,H.clientY);xi(ve),ii(r.id),ai("default")},onMouseUp:H=>zi(r.id,H,"default")})),r.type!=="preview"&&i.jsx("div",{className:`connector connector-right ${En===r.id?"active":""} ${Jr&&_c===r.id?"ring-2 ring-green-500/50":""}`,title:j(""),onMouseDown:H=>{H.stopPropagation(),H.preventDefault();const ve=Hr(H.clientX,H.clientY);xi(ve),Sc(r.id)},onMouseEnter:()=>{Jr&&Ta(r.id)},onMouseLeave:()=>{Jr&&_c===r.id&&Ta(null)},children:i.jsx(Ro,{size:10})}),i.jsxs("div",{className:`overflow-hidden rounded-xl flex-1 flex flex-col pointer-events-none h-full w-full relative ${e==="dark"?"bg-[#18181b]":e==="solarized"?"bg-[#eee8d5]":"bg-white"}`,children:[r.type==="novel-input"&&i.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:[i.jsxs("div",{className:"flex items-center gap-1.5 px-3 py-2 border-b text-xs font-semibold shrink-0",children:[i.jsx(_i,{size:12,className:"text-blue-500"}),i.jsx("span",{children:j("")})]}),i.jsxs("div",{className:"flex-1 flex flex-col gap-2 p-3 overflow-hidden min-h-0",children:[i.jsx("textarea",{value:((B=r.settings)==null?void 0:B.content)||"",onChange:H=>{const ve=H.target.value;ve.length<=1e4&&Je(r.id,{content:ve})},placeholder:j("10,000..."),maxLength:1e4,className:`w-full flex-1 resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"||e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:H=>H.stopPropagation()}),i.jsxs("div",{className:"text-right text-[10px] text-zinc-500 shrink-0",children:[(((U=r.settings)==null?void 0:U.content)||"").length,"/10,000"]}),i.jsxs("button",{className:"w-full py-2 rounded text-xs font-medium transition-colors flex items-center justify-center gap-1.5 bg-blue-600 hover:bg-blue-500 text-white shrink-0",onMouseDown:H=>H.stopPropagation(),onClick:H=>{H.stopPropagation(),IN(r.id)},children:[i.jsx(Wu,{size:12})," ",j("")]})]})]}),r.type==="extract-characters-scenes"&&i.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:[i.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b shrink-0",children:[i.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-semibold",children:[i.jsx(lh,{size:12,className:"text-purple-500"}),i.jsx("span",{children:j("")})]}),((W=r.settings)==null?void 0:W.analysisResults)&&i.jsx("span",{className:"text-[10px] opacity-70",children:(((X=r.settings.analysisResults.characters)==null?void 0:X.length)||0)+(((J=r.settings.analysisResults.scenes)==null?void 0:J.length)||0)})]}),i.jsxs("div",{className:"flex-1 flex flex-col p-3 overflow-hidden min-h-0",children:[i.jsx("div",{className:"flex flex-col gap-3",children:i.jsxs("div",{className:"flex flex-col gap-1.5",children:[i.jsx("label",{className:"text-[10px] font-medium opacity-70",children:""}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:H=>{H.stopPropagation(),Er((Re==null?void 0:Re.nodeId)===r.id&&Re.type==="extract-model"?null:{nodeId:r.id,type:"extract-model"})},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:H=>H.stopPropagation(),children:[i.jsx("span",{className:"truncate font-mono",children:To((Y=r.settings)==null?void 0:Y.model)}),i.jsx(Zn,{size:12,className:"opacity-50 shrink-0"})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="extract-model"&&i.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:H=>H.stopPropagation(),onMouseLeave:()=>qn(null),children:[i.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(ys).filter(([,H])=>H.models.some(ve=>Ci(ve.type))).map(([H,ve])=>i.jsx("button",{onMouseEnter:()=>qn(H),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${un===H?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:ve.name||H},H))}),i.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[un&&((ne=ys[un])==null?void 0:ne.models.filter(H=>Ci(H.type)).map(H=>{var Ze;const ve=H._uid||H.id,qe=rr((Ze=r.settings)==null?void 0:Ze.model);return i.jsxs("button",{onClick:()=>{Je(r.id,{model:ve}),pm(ve);try{localStorage.setItem("tapnow_last_extract_model",ve)}catch{}Er(null),qn(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${qe===ve?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[i.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:To(H._uid||H.id)}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(ve)}`})]},ve)})),!un&&i.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]})}),i.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar mt-2",children:[(()=>{var Ze;const H=(Ze=r.settings)==null?void 0:Ze.analysisResults;if(!H)return i.jsxs("div",{className:"flex flex-col items-center justify-center py-6 text-[11px] opacity-70",children:[i.jsx(bw,{size:18,className:"mb-1 opacity-70"}),i.jsx("span",{children:j("")})]});const ve=Array.isArray(H.characters)?H.characters:[],qe=Array.isArray(H.scenes)?H.scenes:[];return i.jsxs("div",{className:"flex flex-col gap-3",children:[ve.length>0&&i.jsxs("div",{children:[i.jsxs("div",{className:"text-[10px] font-medium mb-1 opacity-70",children:[" (",ve.length,")"]}),ve.map((vt,Mt)=>i.jsxs("div",{className:`p-2 rounded mb-1 ${e==="dark"?"bg-zinc-800":"bg-white border border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center gap-1 text-[11px]",children:[i.jsx("span",{className:`w-2 h-2 rounded-full shrink-0 ${Mt===0?"bg-red-500":Mt===1?"bg-purple-500":Mt===2?"bg-blue-500":"bg-zinc-400"}`}),i.jsx("span",{className:"font-medium",children:vt.name||""})]}),vt.description&&i.jsx("div",{className:"mt-1 text-[10px] opacity-70 leading-snug",children:vt.description})]},`${vt.name||"char"}-${Mt}`))]}),qe.length>0&&i.jsxs("div",{children:[i.jsxs("div",{className:"text-[10px] font-medium mb-1 opacity-70",children:[" (",qe.length,")"]}),qe.map((vt,Mt)=>i.jsxs("div",{className:`p-2 rounded mb-1 ${e==="dark"?"bg-zinc-800":"bg-white border border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center gap-1 text-[11px]",children:[i.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 shrink-0"}),i.jsx("span",{className:"font-medium",children:vt.location||vt.name||""})]}),vt.description&&i.jsx("div",{className:"mt-1 text-[10px] opacity-70 leading-snug",children:vt.description})]},`${vt.location||"scene"}-${Mt}`))]}),ve.length===0&&qe.length===0&&i.jsx("div",{className:"text-[11px] text-zinc-500",children:"/"})]})})(),((ie=r.settings)==null?void 0:ie.errorMsg)&&i.jsx("div",{className:"mt-2 text-[10px] text-red-500 break-words",children:r.settings.errorMsg})]}),((Z=r.settings)==null?void 0:Z.isAnalyzing)&&i.jsxs("div",{className:"mt-2",children:[i.jsx("div",{className:"text-[10px] mb-1 opacity-70",children:"..."}),i.jsx("div",{className:`w-full h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:i.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${((te=r.settings)==null?void 0:te.progress)||0}%`}})}),i.jsxs("div",{className:"text-[10px] mt-1 opacity-70",children:[((pe=r.settings)==null?void 0:pe.progress)||0,"%"]})]}),i.jsx("button",{className:`mt-2 w-full py-2 rounded text-xs font-medium transition-colors flex items-center justify-center gap-1.5 ${(Te=r.settings)!=null&&Te.isAnalyzing?"bg-zinc-700 text-zinc-400 cursor-not-allowed":"bg-purple-600 hover:bg-purple-500 text-white"}`,onMouseDown:H=>H.stopPropagation(),onClick:H=>{H.stopPropagation(),gv(r.id)},children:(Qe=r.settings)!=null&&Qe.isAnalyzing?i.jsxs(i.Fragment,{children:[i.jsx(la,{size:12,className:"animate-spin"}),"..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Wu,{size:12}),""]})})]})]}),(r.type==="character-description"||r.type==="scene-description")&&i.jsx("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:(()=>{var Lt,wt,G,me,$e,jt,lt,ir,Ht,ae,He,Pe,bt,rt,It,nt,Pt,$t,or,Ur,Yr,jr,pn;const H=r.type==="character-description",ve=H?"":"",qe=((Lt=r.settings)==null?void 0:Lt.mode)||"video",Ze={name:((wt=r.settings)==null?void 0:wt.characterName)||((G=r.settings)==null?void 0:G.name)||"",role:((me=r.settings)==null?void 0:me.role)||"",description:(($e=r.settings)==null?void 0:$e.description)||"",age:((jt=r.settings)==null?void 0:jt.age)||"",gender:((lt=r.settings)==null?void 0:lt.gender)||""},vt={name:((ir=r.settings)==null?void 0:ir.sceneName)||((Ht=r.settings)==null?void 0:Ht.location)||"",location:((ae=r.settings)==null?void 0:ae.sceneName)||((He=r.settings)==null?void 0:He.location)||"",description:((Pe=r.settings)==null?void 0:Pe.description)||""},Mt=H?Fl(Ze,qe):vu(vt),Et=((bt=r.settings)==null?void 0:bt.prompt)||Mt;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center justify-between px-3 py-2 border-b text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(_i,{size:12,className:H?"text-red-500":"text-green-500"}),i.jsx("span",{children:ve})]}),H?Ze.name?i.jsxs("div",{className:"text-[10px] text-zinc-500",children:[": ",Ze.name]}):null:vt.name?i.jsxs("div",{className:"text-[10px] text-zinc-500",children:[": ",vt.name]}):null]}),i.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-y-auto custom-scrollbar min-h-0",children:[i.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[i.jsx("button",{className:`px-2 py-1 rounded text-[10px] transition-colors ${qe==="video"?"bg-blue-500 text-white":e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,onMouseDown:yt=>yt.stopPropagation(),onClick:()=>{var vr;const yt=((vr=r.settings)==null?void 0:vr.prompt)||(H?Fl(Ze,"image"):Mt),dr=H?dv(yt):yt;Je(r.id,{mode:"video",prompt:dr}),setTimeout(()=>SN(r.id),0)},children:""}),i.jsx("button",{className:`px-2 py-1 rounded text-[10px] transition-colors ${qe==="image"?"bg-blue-500 text-white":e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,onMouseDown:yt=>yt.stopPropagation(),onClick:()=>{var vr;const yt=((vr=r.settings)==null?void 0:vr.prompt)||(H?Fl(Ze,"video"):Mt),dr=H?cv(yt):yt;Je(r.id,{mode:"image",prompt:dr}),setTimeout(()=>NN(r.id),0)},children:""}),i.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[i.jsx("button",{onClick:()=>uv(r.id,"enhance"),disabled:(rt=r.settings)==null?void 0:rt.isEnhancing,className:`px-2 py-1 rounded text-[10px] transition-colors ${(It=r.settings)!=null&&It.isEnhancing?e==="dark"?"bg-zinc-700 text-zinc-500 cursor-not-allowed":"bg-zinc-200 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-purple-600/80 text-white hover:bg-purple-500":"bg-purple-600 text-white hover:bg-purple-500"}`,children:H?"":""}),i.jsx("button",{onClick:()=>uv(r.id,"filter"),disabled:(nt=r.settings)==null?void 0:nt.isEnhancing,className:`px-2 py-1 rounded text-[10px] transition-colors ${(Pt=r.settings)!=null&&Pt.isEnhancing?e==="dark"?"bg-zinc-700 text-zinc-500 cursor-not-allowed":"bg-zinc-200 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"}`,children:""})]})]}),i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("div",{className:"flex items-center justify-between text-[10px] text-zinc-500",children:[i.jsx("span",{children:j("")}),(($t=r.settings)==null?void 0:$t.isEnhancing)&&i.jsxs("span",{className:"flex items-center gap-1 text-blue-400",children:[i.jsx(la,{size:10,className:"animate-spin"}),""]})]}),i.jsx("textarea",{value:Et,onChange:yt=>Je(r.id,{prompt:yt.target.value}),placeholder:j("/..."),className:`w-full h-28 resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:yt=>yt.stopPropagation()})]}),i.jsxs("div",{className:"flex flex-col gap-1.5",children:[i.jsx("label",{className:"text-[10px] font-medium opacity-70",children:"/"}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:yt=>{yt.stopPropagation(),Er((Re==null?void 0:Re.nodeId)===r.id&&Re.type==="desc-model"?null:{nodeId:r.id,type:"desc-model"})},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:yt=>yt.stopPropagation(),children:[i.jsx("span",{className:"truncate font-mono",children:To((or=r.settings)==null?void 0:or.chatModel)}),i.jsx(Zn,{size:12,className:"opacity-50 shrink-0"})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="desc-model"&&i.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:yt=>yt.stopPropagation(),onMouseLeave:()=>qn(null),children:[i.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(ys).filter(([,yt])=>yt.models.some(dr=>Ci(dr.type))).map(([yt,dr])=>i.jsx("button",{onMouseEnter:()=>qn(yt),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${un===yt?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:dr.name||yt},yt))}),i.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[un&&((Ur=ys[un])==null?void 0:Ur.models.filter(yt=>Ci(yt.type)).map(yt=>{var V;const dr=yt._uid||yt.id,vr=rr((V=r.settings)==null?void 0:V.chatModel);return i.jsxs("button",{onClick:()=>{Je(r.id,{chatModel:dr}),pm(dr);try{localStorage.setItem("tapnow_last_extract_model",dr)}catch{}Er(null),qn(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${vr===dr?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[i.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:To(yt._uid||yt.id)}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(dr)}`})]},dr)})),!un&&i.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]}),i.jsxs("div",{className:"flex flex-col gap-1.5",children:[i.jsx("label",{className:"text-[10px] font-medium opacity-70",children:""}),i.jsx("select",{value:((Yr=r.settings)==null?void 0:Yr.style)||"none",onChange:yt=>{var pt;const dr=yt.target.value,vr=kN(dr),V=((pt=r.settings)==null?void 0:pt.prompt)||Mt,ft=V.includes("")?V.replace(/^[^]+/,`${vr}`):`${vr}${V}`;Je(r.id,{style:dr,prompt:ft})},className:`w-full text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:yt=>yt.stopPropagation(),children:zN.map(yt=>i.jsx("option",{value:yt.value,children:yt.label},yt.value))})]}),i.jsxs("div",{className:"flex flex-col gap-1.5",children:[i.jsx("label",{className:"text-[10px] font-medium opacity-70",children:""}),i.jsx("div",{className:`rounded-lg border-2 border-dashed p-2 transition-colors drop-zone ${e==="dark"?"border-zinc-700 bg-zinc-800/60":"border-zinc-300 bg-white"}`,onDrop:yt=>aN(r.id,yt),onDragOver:Im,onDragLeave:Pm,onMouseDown:yt=>yt.stopPropagation(),children:((pn=(jr=r.settings)==null?void 0:jr.referenceImages)==null?void 0:pn.length)>0?i.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[r.settings.referenceImages.map((yt,dr)=>i.jsxs("div",{className:"relative aspect-square rounded overflow-hidden",children:[i.jsx(nn,{src:yt,className:"w-full h-full object-cover"}),i.jsx("button",{onClick:vr=>{vr.stopPropagation();const V=[...r.settings.referenceImages];V.splice(dr,1),Je(r.id,{referenceImages:V})},className:"absolute top-1 right-1 p-1 rounded-full bg-black/60 text-white hover:bg-red-500",title:j(""),children:i.jsx(ui,{size:10})})]},`${r.id}-ref-${dr}`)),i.jsxs("label",{className:"aspect-square rounded border border-dashed border-zinc-500/60 flex items-center justify-center text-[10px] text-zinc-400 cursor-pointer hover:border-blue-400 hover:text-blue-400",children:["+ ",i.jsx("input",{type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:yt=>rv(r.id,yt)})]})]}):i.jsxs("label",{className:"flex flex-col items-center justify-center gap-1 text-[10px] text-zinc-500 cursor-pointer",children:[i.jsx(rl,{size:16}),"",i.jsx("input",{type:"file",className:"hidden",accept:"image/*",multiple:!0,onChange:yt=>rv(r.id,yt)})]})})]})]})]})})()}),(r.type==="generate-character-video"||r.type==="generate-scene-video")&&i.jsx("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:(()=>{var pn,yt,dr,vr,V,ft,pt,zt,mt,Jt,fr,cr;const H=r.type==="generate-character-video",ve=H?"character-description":"scene-description",qe=H?"generate-character-image":"generate-scene-image",Ze=N.filter(Ne=>Ne.to===r.id).map(Ne=>Xt.get(Ne.from)).find(Ne=>(Ne==null?void 0:Ne.type)===ve),vt=N.filter(Ne=>Ne.to===r.id).map(Ne=>Xt.get(Ne.from)).find(Ne=>(Ne==null?void 0:Ne.type)===qe),Mt=Bt.find(Ne=>Ne.sourceNodeId===r.id&&Ne.status==="completed"),Et=Bt.find(Ne=>Ne.sourceNodeId===r.id&&Ne.status==="generating"),Lt=Bt.find(Ne=>Ne.sourceNodeId===r.id&&Ne.status==="failed"),wt=Ar(Mt),G=vt?Bt.find(Ne=>Ne.sourceNodeId===vt.id&&Ne.status==="completed"):null,me=(pn=G==null?void 0:G.output_images)!=null&&pn.length?G.output_images:(yt=G==null?void 0:G.mjImages)!=null&&yt.length?G.mjImages:[],$e=Ar(G),jt=me.length>0?me:$e?[$e]:[],lt=(dr=vt==null?void 0:vt.settings)==null?void 0:dr.selectedImageIndex,ir=lt!=null&&jt[lt]?jt[lt]:null,Ht=((vr=r.settings)==null?void 0:vr.videoPrompt)||((V=Ze==null?void 0:Ze.settings)==null?void 0:V.prompt)||"",ae=zy[r.id]||0,He=Mt!=null&&Mt.durationMs?(Mt.durationMs/1e3).toFixed(1):null,Pe=!!Et,bt=rr(Tl)||rr((ft=Ye.find(Ne=>Ne.type==="Video"&&(Ne.id==="sora-2"||Ne.id==="sora-2-pro")))==null?void 0:ft.id)||rr((pt=Ye.find(Ne=>Ne.type==="Video"))==null?void 0:pt.id)||"",rt=rr(((zt=r.settings)==null?void 0:zt.model)||bt),It=wu(rt),nt=(mt=r.settings)==null?void 0:mt.duration,Pt=It.includes(nt)?nt:It[0]||"5s";It.length>0&&nt&&!It.includes(nt)&&setTimeout(()=>{Je(r.id,{duration:It[0]||"5s"})},0);const $t=km(rt),or=sr(rt),Ur=ca(((Jt=r.settings)==null?void 0:Jt.resolution)||Rl||"720P"),Yr=$t.find(Ne=>Ne!=="Auto")||"720P",jr=$t.includes(Ur)?Ur:Yr;return jr!==Ur&&setTimeout(()=>{Je(r.id,{resolution:jr})},0),i.jsxs(i.Fragment,{children:[(Pe||He)&&i.jsx("div",{className:`m-3 mb-0 px-2 py-1 rounded text-[10px] font-mono text-center ${e==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-50 text-blue-600 border border-blue-200"}`,children:Pe?i.jsxs("span",{children:["? ",ae.toFixed(1),"s"]}):i.jsxs("span",{children:["? ",j("")," ",He,"s"]})}),i.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-2 border-b text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[i.jsx(GC,{size:12,className:"text-green-500"}),i.jsx("span",{children:j(H?"":"")})]}),i.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-y-auto min-h-0",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:Ne=>{Ne.stopPropagation(),Er((Re==null?void 0:Re.nodeId)===r.id&&Re.type==="role-video-model"?null:{nodeId:r.id,type:"role-video-model"})},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:Ne=>Ne.stopPropagation(),children:[i.jsx("span",{className:"truncate font-mono",children:To(rt)}),i.jsx(Zn,{size:12,className:"opacity-50 shrink-0"})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="role-video-model"&&i.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:Ne=>Ne.stopPropagation(),onMouseLeave:()=>qn(null),children:[i.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(ys).filter(([,Ne])=>Ne.models.some(Qt=>Qt.type==="Video")).map(([Ne,Qt])=>i.jsx("button",{onMouseEnter:()=>qn(Ne),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${un===Ne?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:Qt.name||Ne},Ne))}),i.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[un&&((fr=ys[un])==null?void 0:fr.models.filter(Ne=>Ne.type==="Video").map(Ne=>{var _r;const Qt=Ne._uid||Ne.id,Pr=rr((_r=r.settings)==null?void 0:_r.model);return i.jsxs("button",{onClick:()=>{Je(r.id,{model:Qt}),um(Qt);try{localStorage.setItem("tapnow_last_video_model",Qt)}catch{}Er(null),qn(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${Pr===Qt?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[i.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:To(Ne._uid||Ne.id)}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(Qt)}`})]},Qt)})),!un&&i.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),i.jsx("select",{value:Pt,onChange:Ne=>Je(r.id,{duration:Ne.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:Ne=>Ne.stopPropagation(),children:(It.length>0?It:["5s","10s","15s"]).map(Ne=>i.jsx("option",{value:Ne,children:Qn(Ne,!!(or!=null&&or.durationNotesEnabled),(or==null?void 0:or.durationNotes)||{})},Ne))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),i.jsx("select",{value:((cr=r.settings)==null?void 0:cr.ratio)||"16:9",onChange:Ne=>Je(r.id,{ratio:Ne.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:Ne=>Ne.stopPropagation(),children:wm(rt).map(Ne=>i.jsx("option",{value:Ne,children:Ne==="Auto"?"Auto":Qn(Ne,!!(or!=null&&or.ratioNotesEnabled),(or==null?void 0:or.ratioNotes)||{})},Ne))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:j("")}),i.jsx("select",{value:jr,onChange:Ne=>{const Qt=Ne.target.value;if(Je(r.id,{resolution:Qt}),Qt!=="Auto"){ky(Qt);try{localStorage.setItem("tapnow_last_video_res",Qt)}catch{}}},className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:Ne=>Ne.stopPropagation(),children:$t.map(Ne=>i.jsx("option",{value:Ne,children:Ne==="Auto"?"":Qn(Ne,!!(or!=null&&or.videoResolutionNotesEnabled),(or==null?void 0:or.videoResolutionNotes)||{})},Ne))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:j("")}),i.jsx("textarea",{value:Ht,onChange:Ne=>Je(r.id,{videoPrompt:Ne.target.value}),placeholder:j("..."),className:`w-full h-20 resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:Ne=>Ne.stopPropagation()})]}),wt?i.jsx("div",{className:"relative w-full aspect-video bg-black rounded-lg overflow-hidden cursor-pointer",onDoubleClick:Ne=>{Ne.preventDefault(),Ne.stopPropagation(),gn({id:`preview-video-${r.id}`,url:wt,type:"video"}),setLightboxOpen(!0)},onContextMenu:Ne=>{Ne.preventDefault(),Ne.stopPropagation();const Qt=Hr(Ne.clientX,Ne.clientY);is("video-input",Qt.x,Qt.y,null,wt,{w:400,h:300})},onMouseDown:Ne=>Ne.stopPropagation(),children:i.jsx(pa,{src:wt,controls:!0,className:"w-full h-full object-contain",onMouseDown:Ne=>Ne.stopPropagation()})}):i.jsx("div",{className:`w-full aspect-video rounded border-2 border-dashed flex items-center justify-center ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,children:i.jsx("span",{className:`text-sm ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""})}),Et&&i.jsxs("div",{className:"mb-2",children:[i.jsx("div",{className:"text-[10px] mb-1 text-zinc-500",children:"..."}),i.jsx("div",{className:`w-full h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:i.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${Et.progress||0}%`}})}),i.jsxs("div",{className:"text-[10px] text-zinc-500 mt-1",children:[Et.progress||0,"%"]})]}),(Lt==null?void 0:Lt.errorMsg)&&i.jsx("div",{className:"text-[10px] text-red-500",children:Lt.errorMsg})]}),i.jsx("div",{className:"px-3 py-2 border-t shrink-0",children:i.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-colors ${Et?"bg-zinc-400 cursor-not-allowed text-white":e==="dark"?"bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white":"bg-green-600 hover:bg-green-500 text-white"}`,disabled:!!Et,onMouseDown:Ne=>Ne.stopPropagation(),onClick:()=>{var _r,xe,Ke;const Ne=Ht,Qt=((_r=r.settings)==null?void 0:_r.referenceImages)||((xe=Ze==null?void 0:Ze.settings)==null?void 0:xe.referenceImages)||[],Pr=ir?[ir]:Qt;if(!Ne&&Pr.length===0){alert(j(""));return}if(!rt){alert(j(""));return}Dl(Ne||"","video",Pr,r.id,{model:rt,ratio:((Ke=r.settings)==null?void 0:Ke.ratio)||"16:9",duration:Pt,resolution:jr})},children:Et?"...":""})})]})})()}),(r.type==="generate-character-image"||r.type==="generate-scene-image")&&i.jsx("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:(()=>{var G,me,$e,jt,lt,ir,Ht,ae,He;const H=r.type==="generate-scene-image",ve=Bt.find(Pe=>Pe.sourceNodeId===r.id&&Pe.status==="completed"),qe=Bt.find(Pe=>Pe.sourceNodeId===r.id&&Pe.status==="generating"),Ze=Bt.find(Pe=>Pe.sourceNodeId===r.id&&Pe.status==="failed"),vt=Ar(ve),Mt=(G=ve==null?void 0:ve.output_images)!=null&&G.length?ve.output_images:(me=ve==null?void 0:ve.mjImages)!=null&&me.length?ve.mjImages:vt?[vt]:[],Et=(($e=r.settings)==null?void 0:$e.selectedImageIndex)??null,Lt=rr(Da)||rr((jt=Ye.find(Pe=>zs(Pe.type)))==null?void 0:jt.id)||"",wt=rr(((lt=r.settings)==null?void 0:lt.model)||Lt);return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-2 border-b text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[i.jsx(_i,{size:12,className:"text-blue-500"}),i.jsx("span",{children:j(H?"":"")})]}),i.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-y-auto min-h-0",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:Pe=>{Pe.stopPropagation(),Er((Re==null?void 0:Re.nodeId)===r.id&&Re.type==="role-image-model"?null:{nodeId:r.id,type:"role-image-model"})},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:Pe=>Pe.stopPropagation(),children:[i.jsx("span",{className:"truncate font-mono",children:To(wt)}),i.jsx(Zn,{size:12,className:"opacity-50 shrink-0"})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="role-image-model"&&i.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:Pe=>Pe.stopPropagation(),onMouseLeave:()=>qn(null),children:[i.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(ys).filter(([,Pe])=>Pe.models.some(bt=>zs(bt.type))).map(([Pe,bt])=>i.jsx("button",{onMouseEnter:()=>qn(Pe),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${un===Pe?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:bt.name||Pe},Pe))}),i.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[un&&((ir=ys[un])==null?void 0:ir.models.filter(Pe=>zs(Pe.type)).map(Pe=>{var It;const bt=Pe._uid||Pe.id,rt=rr((It=r.settings)==null?void 0:It.model);return i.jsxs("button",{onClick:()=>{Je(r.id,{model:bt}),dm(bt);try{localStorage.setItem("tapnow_last_image_model",bt)}catch{}Er(null),qn(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${rt===bt?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[i.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:To(Pe._uid||Pe.id)}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(bt)}`})]},bt)})),!un&&i.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:""}),i.jsxs("select",{value:((Ht=r.settings)==null?void 0:Ht.ratio)||"16:9",onChange:Pe=>Je(r.id,{ratio:Pe.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:Pe=>Pe.stopPropagation(),children:[i.jsx("option",{value:"16:9",children:"16:9"}),i.jsx("option",{value:"9:16",children:"9:16"}),i.jsx("option",{value:"1:1",children:"1:1"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:j("")}),i.jsxs("select",{value:((ae=r.settings)==null?void 0:ae.resolution)||"2K",onChange:Pe=>Je(r.id,{resolution:Pe.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:Pe=>Pe.stopPropagation(),children:[i.jsx("option",{value:"1K",children:"1K"}),i.jsx("option",{value:"2K",children:"2K"}),i.jsx("option",{value:"4K",children:"4K"}),i.jsx("option",{value:"Auto",children:"Auto"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:j("")}),i.jsx("textarea",{value:((He=r.settings)==null?void 0:He.prompt)||"",onChange:Pe=>Je(r.id,{prompt:Pe.target.value}),placeholder:j("..."),className:`w-full h-20 resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:Pe=>Pe.stopPropagation()})]}),Mt.length>0?i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Mt.map((Pe,bt)=>i.jsxs("div",{className:`relative aspect-square bg-black rounded-lg overflow-hidden cursor-pointer transition-all ${Et===bt?"ring-2 ring-blue-500 ring-offset-2":"hover:ring-1 hover:ring-zinc-400"}`,onClick:rt=>{rt.stopPropagation();const It=Et===bt?null:bt;Je(r.id,{selectedImageIndex:It})},onDoubleClick:rt=>{rt.preventDefault(),rt.stopPropagation(),gn({id:`preview-${r.id}-${bt}`,url:Pe,type:"image",mjImages:Mt,selectedMjImageIndex:bt}),setLightboxOpen(!0)},onContextMenu:rt=>{rt.preventDefault(),rt.stopPropagation();const It=Hr(rt.clientX,rt.clientY);is("input-image",It.x,It.y,null,Pe,{w:400,h:300})},onMouseDown:rt=>rt.stopPropagation(),children:[i.jsx(nn,{src:Pe,className:"w-full h-full object-contain"}),i.jsxs("div",{className:"absolute top-1 left-1 bg-black/50 text-white text-[10px] px-1 py-0.5 rounded",children:[bt+1,"/",Mt.length]}),Et===bt&&i.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white text-[10px] px-1 py-0.5 rounded",children:j("")})]},`${Pe}-${bt}`))}):i.jsx("div",{className:`w-full h-28 rounded border-2 border-dashed flex items-center justify-center ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,children:i.jsx("span",{className:`text-sm ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""})}),qe&&i.jsxs("div",{className:"mb-2",children:[i.jsx("div",{className:"text-[10px] mb-1 text-zinc-500",children:j("...")}),i.jsx("div",{className:`w-full h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:i.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${qe.progress||0}%`}})}),i.jsxs("div",{className:"text-[10px] text-zinc-500 mt-1",children:[qe.progress||0,"%"]})]}),(Ze==null?void 0:Ze.errorMsg)&&i.jsx("div",{className:"text-[10px] text-red-500",children:Ze.errorMsg})]}),i.jsx("div",{className:"px-3 py-2 border-t shrink-0",children:i.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-colors ${qe?"bg-zinc-400 cursor-not-allowed text-white":e==="dark"?"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,disabled:!!qe,onMouseDown:Pe=>Pe.stopPropagation(),onClick:()=>{var rt,It,nt,Pt,$t,or,Ur;const Pe=((rt=r.settings)==null?void 0:rt.prompt)||"",bt=rr(((It=r.settings)==null?void 0:It.model)||Da||((nt=Ye.find(Yr=>zs(Yr.type)))==null?void 0:nt.id)||"");if(!Pe&&(!((Pt=r.settings)!=null&&Pt.referenceImages)||r.settings.referenceImages.length===0)){alert(j(""));return}if(!bt){alert(j(""));return}Dl(Pe,"image",(($t=r.settings)==null?void 0:$t.referenceImages)||[],r.id,{model:bt,ratio:((or=r.settings)==null?void 0:or.ratio)||"16:9",resolution:((Ur=r.settings)==null?void 0:Ur.resolution)||Ml||"2K"})},children:qe?"...":""})})]})})()}),(r.type==="create-character"||r.type==="create-scene")&&i.jsx("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:(()=>{var vt,Mt,Et,Lt,wt,G,me,$e,jt;const H=r.type==="create-character",ve=H?"":"",qe=Number.isFinite((vt=r.settings)==null?void 0:vt.startSecond)?r.settings.startSecond:1,Ze=Number.isFinite((Mt=r.settings)==null?void 0:Mt.endSecond)?r.settings.endSecond:3;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-2 border-b text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[i.jsx(_g,{size:12,className:H?"text-blue-500":"text-green-500"}),i.jsx("span",{children:ve})]}),i.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-y-auto min-h-0",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:H?"":""}),i.jsx("input",{type:"text",value:((Et=r.settings)==null?void 0:Et.name)||"",onChange:lt=>Je(r.id,{name:lt.target.value}),className:`w-full px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,placeholder:H?"...":"...",onMouseDown:lt=>lt.stopPropagation()})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:j(" 1-3 ")}),i.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[i.jsx("input",{type:"number",min:"0",step:"0.1",value:qe,onChange:lt=>Je(r.id,{startSecond:parseFloat(lt.target.value)||0}),className:`w-20 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:lt=>lt.stopPropagation()}),i.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""}),i.jsx("input",{type:"number",min:"0",step:"0.1",value:Ze,onChange:lt=>Je(r.id,{endSecond:parseFloat(lt.target.value)||0}),className:`w-20 px-2 py-1 rounded text-xs border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:lt=>lt.stopPropagation()}),i.jsxs("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:[": ",(Ze-qe).toFixed(1),"s"]})]})]})]}),((Lt=r.settings)==null?void 0:Lt.isCreating)&&i.jsxs("div",{className:"px-3 py-2 border-t shrink-0",children:[i.jsx("div",{className:"flex items-center gap-2 mb-2",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsxs("span",{className:"text-[10px] text-zinc-500",children:[ve,"..."]}),i.jsxs("span",{className:"text-[10px] text-zinc-500",children:[((wt=r.settings)==null?void 0:wt.createProgress)||0,"%"]})]}),i.jsx("div",{className:`w-full h-1.5 rounded-full overflow-hidden ${e==="dark"?"bg-zinc-800":"bg-zinc-200"}`,children:i.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${((G=r.settings)==null?void 0:G.createProgress)||0}%`}})})]})}),((me=r.settings)==null?void 0:me.createError)&&i.jsx("div",{className:"text-[10px] text-red-500 mt-1",children:r.settings.createError})]}),i.jsx("div",{className:"px-3 py-2 border-t shrink-0",children:i.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-colors ${($e=r.settings)!=null&&$e.isCreating?"bg-zinc-400 cursor-not-allowed text-white":e==="dark"?"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,onMouseDown:lt=>lt.stopPropagation(),type:"button",disabled:(jt=r.settings)==null?void 0:jt.isCreating,onClick:async()=>{var It,nt;const lt=((It=r.settings)==null?void 0:It.name)||"";if(!lt||lt.trim().length===0){alert(`${H?"":""}`);return}const ir=qe??1,Ht=Ze??3;if(Ht-ir<1||Ht-ir>3){alert(j(" 1-3 "));return}const ae=H?"generate-character-video":"generate-scene-video",He=N.filter(Pt=>Pt.to===r.id).map(Pt=>Xt.get(Pt.from)).find(Pt=>(Pt==null?void 0:Pt.type)===ae);if(!He){alert(j(""));return}const Pe=Bt.find(Pt=>Pt.sourceNodeId===He.id&&Pt.status==="completed"),bt=(Pe==null?void 0:Pe.localCacheUrl)||(Pe==null?void 0:Pe.url)||(Pe==null?void 0:Pe.originalUrl)||He.content||"";if(!bt){alert(j("URL"));return}const rt=(Pe==null?void 0:Pe.remoteTaskId)||null;Je(r.id,{isCreating:!0,createProgress:10,createError:null});try{const Pt=Ye.find(V=>V.type==="Video"&&(V.id==="sora-2"||V.id==="sora-2-pro"));if(!Pt){Je(r.id,{isCreating:!1,createError:" Sora 2 "}),alert(j(" Sora 2  Sora 2  Sora 2 Pro"));return}const $t=wi(Pt.id),or=$t.key;if(!or){Je(r.id,{isCreating:!1,createError:" API Key"}),alert(j(" API Key")),bi(!0);return}Je(r.id,{createProgress:40});const Ur=($t.url||Ps).replace(/\/+$/,""),Yr=iu&&iu.trim()?iu.trim():`${Ur}/sora/v1/characters`,jr=`${ir},${Ht}`,pn=rt?{from_task:rt,timestamps:jr}:{url:bt,timestamps:jr};Je(r.id,{createProgress:70});const yt=await fetch(Yr,{method:"POST",headers:{Authorization:`Bearer ${or}`,"Content-Type":"application/json"},body:JSON.stringify(pn)});if(Je(r.id,{createProgress:90}),!yt.ok){const V=await yt.text();let ft=null;try{ft=JSON.parse(V)}catch{}throw yt.status===500||ft&&(ft.code==="get_origin_task_failed"||(nt=ft.message)!=null&&nt.includes("get_origin_task_failed"))?new Error("TASK_NOT_FOUND"):new Error(`API (${yt.status}): ${V||yt.statusText}`)}const dr=await yt.json();if(!(dr!=null&&dr.id)||!(dr!=null&&dr.username))throw new Error(" id  username");const vr={id:dr.id,username:dr.username,profile_picture_url:dr.profile_picture_url||"",permalink:dr.permalink||""};$l(V=>[...V,vr]),setTimeout(()=>{Je(r.id,{isCreating:!1,createProgress:0,createError:null,characterId:dr.id,characterUsername:dr.username}),alert(`${H?"":""} "${dr.username}" `)},300)}catch(Pt){let $t=Pt.message||"";$t==="TASK_NOT_FOUND"?$t="":($t.includes("Failed to fetch")||Pt.name==="TypeError"||Pt.message.includes("NetworkError"))&&($t=`

1. API 
   -  API  "/sora" 
   -  Sora 

2.  (CORS)
   -  Allow CORS 

3. 
   - `),Je(r.id,{isCreating:!1,createProgress:0,createError:$t}),alert(`${H?"":""}: ${$t}`)}},children:H?"":""})})]})})()}),r.type==="local-save"&&(()=>{var Mt,Et,Lt,wt,G,me,$e,jt,lt,ir;const H=jm(r.id),ve=H.length,qe=!!((Mt=r.settings)!=null&&Mt.isSaving),vt=(((Et=r.settings)==null?void 0:Et.serverUrl)||"").trim()?((Lt=r.settings)==null?void 0:Lt.serverStatus)==="connected":Hs;return i.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:[i.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b shrink-0",children:[i.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-semibold",children:[i.jsx(YC,{size:12,className:"text-green-500"}),i.jsx("span",{children:j("")})]}),i.jsx("div",{className:`w-2 h-2 rounded-full ${vt?"bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]":"bg-red-500"}`,title:vt?"":""})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto p-3 custom-scrollbar flex flex-col gap-3",children:[i.jsxs("div",{className:"flex flex-col gap-1.5",children:[i.jsx("label",{className:"text-[10px] font-medium opacity-70",children:j("")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"text",value:((wt=r.settings)==null?void 0:wt.serverUrl)??"",onChange:Ht=>Je(r.id,{serverUrl:Ht.target.value}),placeholder:yr||"http://127.0.0.1:9527",className:`flex-1 text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:Ht=>Ht.stopPropagation()}),i.jsx("button",{className:`px-2 py-1 text-[10px] rounded border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-blue-500":"bg-white border-zinc-300 text-zinc-700 hover:border-blue-500"}`,onMouseDown:Ht=>Ht.stopPropagation(),onClick:()=>{var Ht;return Pj(r.id,((Ht=r.settings)==null?void 0:Ht.serverUrl)||"")},children:j("")})]})]}),i.jsxs("div",{className:"flex flex-col gap-1.5",children:[i.jsx("label",{className:"text-[10px] font-medium opacity-70",children:j("")}),i.jsx("input",{type:"text",value:((G=r.settings)==null?void 0:G.subfolder)||"",onChange:Ht=>Je(r.id,{subfolder:Ht.target.value}),placeholder:"v1_characters",className:`w-full text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:Ht=>Ht.stopPropagation()})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("label",{className:"text-[10px] font-medium opacity-70",children:j(" ()")}),i.jsx("button",{className:`w-10 h-5 rounded-full relative transition-colors ${(me=r.settings)!=null&&me.autoSave?"bg-green-600":e==="solarized"?"bg-zinc-300":"bg-zinc-600"}`,onClick:()=>{var Ht;return Je(r.id,{autoSave:!((Ht=r.settings)!=null&&Ht.autoSave)})},onMouseDown:Ht=>Ht.stopPropagation(),children:i.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${($e=r.settings)!=null&&$e.autoSave?"left-6":"left-1"}`})})]}),i.jsxs("div",{className:"flex items-center justify-between text-[10px] text-zinc-500 mt-1",children:[i.jsx("span",{children:j("")}),i.jsx("span",{children:ve})]}),ve>0?i.jsx("div",{className:"grid grid-cols-4 gap-2",children:H.slice(0,4).map((Ht,ae)=>{const He=Ht.type==="video"||ur(Ht.url)||Ht.url.startsWith("data:video");return i.jsx("div",{className:"relative aspect-square rounded-lg overflow-hidden bg-black/40 border border-zinc-700/40",children:He?i.jsx("div",{className:"w-full h-full flex items-center justify-center text-[10px] text-zinc-300",children:i.jsx(ch,{size:14,className:"text-purple-300"})}):i.jsx(nn,{src:Ht.url,className:"w-full h-full object-cover"})},`${Ht.url}-${ae}`)})}):i.jsx("div",{className:"text-[10px] text-zinc-500",children:j("")}),i.jsxs("div",{className:"mt-auto border-t pt-2 border-zinc-700/50",children:[i.jsxs("div",{className:"text-[10px] text-zinc-500 flex justify-between",children:[i.jsx("span",{children:j(":")}),i.jsx("span",{children:(jt=r.settings)!=null&&jt.lastSaved?r.settings.lastSaved.split(" ")[1]:j("")})]}),i.jsxs("div",{className:"text-[10px] text-zinc-500 flex justify-between mt-1",children:[i.jsx("span",{children:j(":")}),i.jsxs("span",{children:[((ir=(lt=r.settings)==null?void 0:lt.savedFiles)==null?void 0:ir.length)||0," ",j("")]})]})]}),i.jsx("button",{className:`w-full py-2 rounded text-xs font-medium transition-colors ${qe?"bg-zinc-600 cursor-not-allowed text-white":"bg-green-600 hover:bg-green-500 text-white"}`,disabled:qe||ve===0,onMouseDown:Ht=>Ht.stopPropagation(),onClick:async()=>{if(ve===0){d("","warning");return}Je(r.id,{isSaving:!0});try{await Nm(r,H)}catch(Ht){d(`: ${Ht.message||""}`,"error")}finally{Je(r.id,{isSaving:!1})}},children:qe?"...":""})]})]})})(),r.type==="input-image"&&i.jsx("div",{className:`relative w-full h-full flex flex-col items-center justify-center transition-colors pointer-events-auto drop-zone ${e==="dark"?"bg-zinc-900 group-hover:bg-zinc-800":e==="solarized"?"bg-[#eee8d5] group-hover:bg-[#e4dcc2]":"bg-zinc-100 group-hover:bg-zinc-200"}`,onDrop:H=>oN(r.id,H),onDragOver:Im,onDragLeave:Pm,onContextMenu:H=>sS(H,r.id),children:r.content?i.jsxs("div",{className:"relative w-full h-full",children:[ur(r.content)?i.jsx(pa,{src:r.content,controls:!0,className:`w-full h-full object-contain ${e==="dark"?"bg-black/50":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-100"}`,draggable:!1,style:{imageRendering:E.zoom>=1?"auto":"crisp-edges",WebkitFontSmoothing:"antialiased",transform:"translateZ(0)",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"}}):i.jsx(nn,{src:r.content,className:`w-full h-full object-contain ${e==="dark"?"bg-black/50":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-100"}`,draggable:!1,loading:"lazy",style:{imageRendering:E.zoom>=1?"auto":"crisp-edges",WebkitFontSmoothing:"antialiased",transform:"translateZ(0)",backfaceVisibility:"hidden",WebkitBackfaceVisibility:"hidden"}}),r.dimensions&&i.jsxs("div",{className:`absolute bottom-2 right-2 text-[10px] px-1.5 py-0.5 rounded backdrop-blur-sm border ${e==="dark"?"bg-black/70 text-white border-white/10":"bg-white/80 text-zinc-800 border-zinc-200"}`,children:[r.dimensions.w,"x",r.dimensions.h]}),!r.isMasking&&i.jsxs("div",{className:"absolute inset-0 bg-black/40 transition-opacity gap-2 opacity-0 group-hover:opacity-100 flex flex-col items-center justify-center",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("label",{className:`cursor-pointer px-3 py-1.5 rounded-lg text-xs backdrop-blur-sm border transition-colors ${e==="dark"?"bg-white/10 hover:bg-white/20 text-white border-white/10":"bg-white hover:bg-zinc-100 text-zinc-800 border-zinc-300"}`,onMouseDown:H=>H.stopPropagation(),children:[j("")," ",i.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:H=>xv(r.id,H)})]}),!ur(r.content)&&i.jsxs("button",{onClick:H=>{H.stopPropagation(),x(ve=>ve.map(qe=>qe.id===r.id?{...qe,isMasking:!qe.isMasking}:qe))},className:`px-3 py-1.5 rounded-lg text-xs backdrop-blur-sm border transition-colors flex items-center gap-1 ${e==="dark"?r.isMasking?"bg-red-500/80 hover:bg-red-500 text-white border-red-400":"bg-white/10 hover:bg-white/20 text-white border-white/10":r.isMasking?"bg-red-500 hover:bg-red-600 text-white border-red-400":"bg-white hover:bg-zinc-100 text-zinc-800 border-zinc-300"}`,onMouseDown:H=>H.stopPropagation(),children:[i.jsx(HC,{size:12}),j("")]})]}),i.jsxs("div",{className:`text-[10px] text-center px-2 ${e==="dark"?"text-zinc-300":"text-zinc-500"}`,children:[j(""),i.jsx("br",{}),j(" Ctrl+V ")]})]}),!r.isMasking&&r.maskContent&&i.jsx("div",{className:"absolute inset-0 z-20 pointer-events-none",style:{background:"rgba(255, 0, 0, 0.3)",mixBlendMode:"multiply",WebkitMaskImage:`url(${r.maskContent})`,maskImage:`url(${r.maskContent})`,WebkitMaskSize:"100% 100%",maskSize:"100% 100%",WebkitMaskRepeat:"no-repeat",maskRepeat:"no-repeat"}}),r.isMasking&&!ur(r.content)&&i.jsx(J3,{nodeId:r.id,imageUrl:r.content,imageDimensions:r.dimensions,isActive:r.isMasking,onClose:()=>{x(H=>H.map(ve=>ve.id===r.id?{...ve,isMasking:!1}:ve))},onSave:H=>{},onUpdateNode:(H,ve)=>{x(qe=>qe.map(Ze=>Ze.id===H?{...Ze,...ve}:Ze))},theme:e,view:E,maskContent:r.maskContent})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full",children:[i.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center mb-3 border ${e==="dark"?"bg-zinc-800 border-zinc-700/50":"bg-zinc-100 border-zinc-300"}`,children:i.jsx(Zc,{className:`w-6 h-6 ${e==="dark"?"text-zinc-500":"text-zinc-400"}`})}),i.jsxs("label",{className:`px-4 py-2 rounded-lg text-xs font-medium transition-colors cursor-pointer pointer-events-auto ${e==="solarized"?"bg-[#616161] hover:bg-[#4b4b4b] text-white":"bg-blue-600 hover:bg-blue-500 text-white"}`,onMouseDown:H=>H.stopPropagation(),children:[j(""),i.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:H=>xv(r.id,H)})]}),i.jsxs("div",{className:"text-[10px] text-center mt-2 pointer-events-none text-zinc-500",children:[j(""),i.jsx("br",{}),j(" Ctrl+V ")]})]})}),r.type==="video-input"&&i.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto drop-zone video-input-container ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-100"}`,onDragOver:Im,onDragLeave:Pm,children:[i.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b text-xs font-semibold",children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(ch,{size:13,className:"text-blue-500"}),i.jsx("span",{children:j(" / ")}),i.jsx("button",{onClick:H=>{var jt;H.stopPropagation();const ve=((jt=r.settings)==null?void 0:jt.videoExpanded)===!1,qe=(r.frames||[]).length,Ze=ve?Math.max(1,Math.floor(r.width/290)):1,vt=Math.max(1,Math.ceil(qe/Ze)),Mt=72,Et=ve?r.content?230:190:0,Lt=r.content&&ve?48:0,wt=36,G=30,me=ve?158:106,$e=Mt+Et+Lt+wt+vt*me+G;x(lt=>lt.map(ir=>ir.id===r.id?{...ir,height:Math.max(ve?500:220,$e),settings:{...ir.settings,videoExpanded:ve}}:ir))},className:`p-1 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded transition-colors ml-1 ${((Be=r.settings)==null?void 0:Be.videoExpanded)===!1?"bg-zinc-200 dark:bg-zinc-700":""}`,title:((Le=r.settings)==null?void 0:Le.videoExpanded)===!1?"":"",children:((it=r.settings)==null?void 0:it.videoExpanded)===!1?i.jsx(Zn,{size:12}):i.jsx(wg,{size:12})})]}),i.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-zinc-500",children:[(ut=r.videoMeta)!=null&&ut.duration?i.jsxs("span",{children:[j("")," ",r.videoMeta.duration.toFixed(1),"s"]}):null,(xt=r.videoMeta)!=null&&xt.w?i.jsxs("span",{children:[r.videoMeta.w,"x",r.videoMeta.h]}):null,(Zt=r.selectedKeyframes)!=null&&Zt.length?i.jsxs("span",{className:"text-blue-500",children:[" ",r.selectedKeyframes.length," "]}):null]})]}),i.jsxs("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-hidden min-h-0",children:[r.content?i.jsxs("div",{className:"space-y-2",children:[((Nt=r.settings)==null?void 0:Nt.videoExpanded)!==!1&&i.jsx("div",{className:"relative w-full max-w-[360px] aspect-video bg-black rounded-lg overflow-hidden flex items-center justify-center mx-auto",onDrop:H=>bv(r.id,H),children:i.jsx(pa,{src:r.content,controls:!0,className:"w-full h-full object-contain",draggable:!1})}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("label",{className:"bg-blue-600 hover:bg-blue-500 text-white px-3 py-1.5 rounded text-xs font-medium transition-colors cursor-pointer",onMouseDown:H=>H.stopPropagation(),children:[j(""),i.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:H=>{var ve;return Vc(r.id,(ve=H.target.files)==null?void 0:ve[0])}})]}),i.jsx("button",{className:`px-3 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"border-zinc-700 bg-zinc-800 text-zinc-300 hover:border-blue-500 hover:text-blue-400":"border-zinc-300 hover:border-blue-500 hover:text-blue-600"}`,onMouseDown:H=>H.stopPropagation(),onClick:()=>HN(r.id,2),children:i.jsx("span",{className:"whitespace-nowrap",children:j("2fps")})}),i.jsx("button",{className:`px-3 py-1.5 rounded text-xs border transition-colors ${e==="dark"?"bg-green-600/40 border-green-500 text-green-200 hover:bg-green-600/60 hover:border-green-400":"bg-green-50 border-green-300 hover:border-green-500 hover:text-green-600"}`,onMouseDown:H=>H.stopPropagation(),onClick:()=>VN(r.id,30),children:i.jsx("span",{className:"whitespace-nowrap",children:j("")})}),r.extractingFrames&&i.jsx("span",{className:"text-[11px] text-blue-500",children:j("...")})]})]}):((Ot=r.settings)==null?void 0:Ot.videoExpanded)!==!1&&i.jsx("div",{className:"flex flex-col items-center justify-center gap-3 w-full px-4 mx-auto shrink-0 transition-colors border-2 border-transparent hover:border-blue-500/30 rounded-lg p-4",onDrop:H=>bv(r.id,H),children:i.jsxs("div",{className:"flex flex-col gap-2 items-center justify-center shrink-0 w-full",children:[i.jsx("div",{className:`relative w-full h-64 flex flex-col items-center justify-center border-2 border-dashed rounded-lg transition-colors ${oe===r.id&&!O?"border-blue-500 bg-blue-500/10":e==="dark"?"border-zinc-700 hover:border-zinc-500":"border-zinc-300 hover:border-zinc-400"}`,children:i.jsxs("label",{className:"cursor-pointer flex flex-col items-center justify-center w-full h-full",children:[i.jsx(Sg,{size:48,className:`mb-2 ${e==="dark"?"text-zinc-500":"text-zinc-400"}`}),i.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:j("")}),i.jsx("input",{type:"file",className:"hidden",accept:"video/*",onChange:H=>{var ve;return Vc(r.id,(ve=H.target.files)==null?void 0:ve[0])}})]})}),i.jsx("div",{className:"text-[10px] text-center text-zinc-500 pointer-events-none",children:j(" MP4/WEBM Ctrl+V ")})]})}),i.jsxs("div",{className:"flex items-center justify-between text-[11px] text-zinc-500",children:[i.jsx("span",{children:j("")}),i.jsxs("div",{className:"flex items-center gap-2 flex-nowrap shrink-0 whitespace-nowrap",children:[i.jsxs("span",{children:[(r.frames||[]).length," ",j("")]}),(r.frames||[]).length>0&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:()=>{const H=r.frames||[],ve=r.selectedKeyframes||[];let qe=[];ve.length===0?qe=H.map(Ze=>({url:Ze.url,time:Ze.time,filename:Ze.filename})):qe=[],x(Ze=>Ze.map(vt=>vt.id===r.id?{...vt,selectedKeyframes:qe}:vt))},className:`text-[10px] px-1.5 py-0.5 rounded transition-colors flex items-center gap-1 ${e==="dark"?"bg-blue-600/30 text-blue-300 hover:bg-blue-600/50":"bg-blue-100 text-blue-600 hover:bg-blue-200"}`,onMouseDown:H=>H.stopPropagation(),title:(r.selectedKeyframes||[]).length>0?j(""):j(""),children:[(r.selectedKeyframes||[]).length>0?i.jsx(gw,{size:10}):i.jsx(VC,{size:10}),(r.selectedKeyframes||[]).length>0?j(""):j("")]}),i.jsxs("button",{onClick:()=>{confirm(j(""))&&x(H=>H.map(ve=>ve.id===r.id?{...ve,frames:[],selectedKeyframes:[]}:ve))},className:`text-[10px] px-1.5 py-0.5 rounded transition-colors flex items-center gap-1 flex-nowrap ${e==="dark"?"bg-red-600/30 text-red-300 hover:bg-red-600/50":"bg-red-100 text-red-600 hover:bg-red-200"}`,onMouseDown:H=>H.stopPropagation(),title:j(""),children:[i.jsx(Is,{size:10}),j("")]})]})]})]}),i.jsx("div",{className:"grid gap-3 w-full overflow-y-auto custom-scrollbar flex-1 min-h-0 relative p-1 content-start items-start",style:{gridTemplateColumns:((er=r.settings)==null?void 0:er.videoExpanded)===!1?"1fr":"repeat(auto-fill, minmax(260px, 1fr))",gridAutoRows:"auto"},onDrop:H=>FN(r.id,H),onDragOver:H=>UN(H,r.id,(r.frames||[]).length),onDragLeave:H=>{H.currentTarget.contains(H.relatedTarget)||(K(null),ue(null))},children:(r.frames||[]).length===0?i.jsxs("div",{className:`col-span-full text-[11px] text-zinc-500 text-center py-4 border rounded ${e==="dark"?"bg-zinc-800/40 border-zinc-700":"bg-white/40 border-zinc-300"}`,children:[j(""),i.jsx("div",{className:"mt-1 opacity-50 text-[9px]",children:j("")})]}):(r.frames||[]).map((H,ve)=>{var Mt;const qe=(r.selectedKeyframes||[]).some(Et=>Et.url===H.url&&Et.time===H.time),Ze=O===r.id&&Q===ve,vt=O===r.id&&Q===(r.frames||[]).length&&ve===(r.frames||[]).length-1;return i.jsxs("div",{className:"relative",children:[Ze&&i.jsx("div",{className:"absolute -top-1.5 left-0 right-0 h-1 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.8)] z-50"}),i.jsxs("button",{className:`relative w-full rounded overflow-hidden group transition-all ${qe?"ring-2 ring-blue-500 border-2 border-blue-500 bg-blue-900/30":e==="dark"?"border border-zinc-700 hover:border-zinc-500":"border border-zinc-300 hover:border-zinc-400"}`,onMouseDown:Et=>Et.stopPropagation(),onClick:Et=>WN(r.id,H,ve,Et),onContextMenu:Et=>KN(Et,r.id,H),onDragOver:Et=>DN(Et,r.id,ve),children:[i.jsx(nn,{src:H.url,className:`w-full bg-black ${((Mt=r.settings)==null?void 0:Mt.videoExpanded)===!1?"h-[90px] object-cover":"aspect-video object-contain max-h-[140px]"}`,alt:`frame-${ve}`}),i.jsxs("div",{className:"absolute left-1 top-1 text-[10px] px-1 py-0.5 rounded bg-black/60 text-white",children:[typeof H.time=="number"?H.time.toFixed(2):H.time,"s"]}),H.filename&&i.jsx("div",{className:"absolute left-0 bottom-0 right-0 bg-black/80 text-white text-[9px] px-1 py-0.5 opacity-0 group-hover:opacity-100 transition-opacity truncate",title:H.filename,children:H.filename}),i.jsxs("div",{className:"absolute top-1 bottom-1 right-1 flex flex-col justify-between items-center z-20 pointer-events-none",children:[i.jsx("div",{className:"pointer-events-auto w-5 h-5 rounded-full border border-white/80 bg-black/40 flex items-center justify-center shrink-0 mb-auto",children:qe?i.jsx(ep,{size:12,className:"text-white"}):null}),i.jsx("button",{onClick:Et=>{Et.stopPropagation(),x(Lt=>Lt.map(wt=>{if(wt.id!==r.id)return wt;const G=(wt.frames||[]).filter(($e,jt)=>jt!==ve),me=(wt.selectedKeyframes||[]).filter($e=>$e.url!==H.url);return{...wt,frames:G,selectedKeyframes:me}}))},className:"pointer-events-auto w-5 h-5 rounded bg-red-600/80 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-500 my-1 shrink-0",title:j(""),children:i.jsx(ui,{size:12})}),i.jsxs("div",{className:"pointer-events-auto flex flex-col gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0 mt-auto",children:[ve>0&&i.jsx("button",{onClick:Et=>{Et.stopPropagation(),x(Lt=>Lt.map(wt=>{if(wt.id!==r.id)return wt;const G=[...wt.frames||[]];[G[ve-1],G[ve]]=[G[ve],G[ve-1]];const me=[...wt.selectedKeyframes||[]],$e=me.findIndex(jt=>jt.url===H.url);return $e>0&&([me[$e-1],me[$e]]=[me[$e],me[$e-1]]),{...wt,frames:G,selectedKeyframes:me}}))},className:"w-5 h-5 rounded bg-black/70 text-white flex items-center justify-center hover:bg-blue-600",title:j(""),children:i.jsx(wg,{size:12})}),ve<(r.frames||[]).length-1&&i.jsx("button",{onClick:Et=>{Et.stopPropagation(),x(Lt=>Lt.map(wt=>{if(wt.id!==r.id)return wt;const G=[...wt.frames||[]];[G[ve],G[ve+1]]=[G[ve+1],G[ve]];const me=[...wt.selectedKeyframes||[]],$e=me.findIndex(jt=>jt.url===H.url);return $e>=0&&$e<me.length-1&&([me[$e],me[$e+1]]=[me[$e+1],me[$e]]),{...wt,frames:G,selectedKeyframes:me}}))},className:"w-5 h-5 rounded bg-black/70 text-white flex items-center justify-center hover:bg-blue-600",title:j(""),children:i.jsx(Zn,{size:12})})]})]})]}),vt&&i.jsx("div",{className:"absolute -bottom-1.5 left-0 right-0 h-1 bg-red-500 rounded-full shadow-[0_0_8px_rgba(239,68,68,0.8)] z-50"})]},`${H.url}-${ve}`)})})]})]}),r.type==="text-node"&&i.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-100"}`,children:[i.jsx("div",{className:"flex items-center justify-between px-3 py-2 border-b text-xs font-semibold",children:i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(_i,{size:13,className:"text-blue-500"}),i.jsx("span",{children:j("")})]})}),i.jsx("div",{className:"flex-1 p-3",children:i.jsx("textarea",{"data-node-type":"text-node","data-node-id":r.id,value:((pr=r.settings)==null?void 0:pr.text)||"",onChange:H=>{Je(r.id,{text:H.target.value})},placeholder:j("..."),className:`w-full h-full resize-none outline-none text-sm p-2 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:H=>H.stopPropagation()})})]}),r.type==="video-analyze"&&i.jsxs("div",{className:`relative w-full h-full flex flex-col transition-colors pointer-events-auto video-analyze-container ${e==="dark"?"bg-zinc-900/80":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,onDrop:H=>ZN(r.id,H),onDragOver:Ol,onClick:H=>{const ve=window.getSelection();if(ve&&ve.toString().length>0)return;const qe=H.target;qe&&(qe.tagName==="INPUT"||qe.tagName==="TEXTAREA"||qe.tagName==="SELECT"||qe.tagName==="BUTTON"||qe.isContentEditable||qe.closest('input, textarea, select, button, [contenteditable="true"]'))||H.stopPropagation()},children:[i.jsx("div",{className:"flex items-center justify-between px-3 py-2 border-b text-xs font-semibold",children:i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(qC,{size:13,className:"text-blue-500"}),i.jsx("span",{children:j(" / ")})]})}),i.jsx("div",{className:"flex-1 flex flex-col gap-3 p-3 overflow-hidden min-h-0",children:(()=>{var vt,Mt,Et,Lt,wt,G,me,$e,jt,lt,ir,Ht,ae,He,Pe,bt,rt,It;const H=xu(r.id);if(!H)return i.jsxs("div",{className:"flex flex-col items-center justify-center flex-1 gap-2 text-[11px] text-zinc-500",children:[i.jsx(Vu,{size:24,className:"text-zinc-400"}),i.jsx("span",{children:j("")})]});const ve=H.videoFileName||"",qe=((vt=H.videoMeta)==null?void 0:vt.duration)||0,Ze=H.selectedKeyframes||[];return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:`text-[11px] px-2 py-1.5 rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700":"bg-zinc-50 border-zinc-300"}`,children:[i.jsx("div",{className:"flex items-center justify-between mb-1",children:i.jsx("span",{className:"text-zinc-500",children:H.isImageInput?"":""})}),i.jsxs("div",{className:"text-zinc-700 dark:text-zinc-300",children:[i.jsxs("div",{children:[j(":")," ",H.isImageInput?j(""):ve]}),!H.isImageInput&&i.jsxs("div",{children:[j(":")," ",qe.toFixed(1),"s"]}),i.jsxs("div",{children:[j(":")," ",Ze.length," ",j("")]})]})]}),i.jsxs("div",{className:`flex items-center gap-2 p-1 rounded-lg border shadow-inner ${e==="dark"?"bg-zinc-800 border-zinc-700":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-100 border-zinc-200"}`,children:[i.jsxs("button",{onClick:()=>Je(r.id,{analysisMode:"manual"}),className:`flex-1 py-1 px-2 text-[11px] rounded transition-all flex justify-center items-center gap-1 ${(((Mt=r.settings)==null?void 0:Mt.analysisMode)||"manual")==="manual"?e==="dark"?"bg-zinc-600 shadow-md text-blue-300 font-bold":"bg-white shadow-md text-blue-600 font-bold":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:nt=>nt.stopPropagation(),children:[i.jsx(iw,{size:12})," "]}),i.jsxs("button",{onClick:()=>Je(r.id,{analysisMode:"auto"}),className:`flex-1 py-1 px-2 text-[11px] rounded transition-all flex justify-center items-center gap-1 ${((Et=r.settings)==null?void 0:Et.analysisMode)==="auto"?e==="dark"?"bg-zinc-600 shadow-md text-purple-300 font-bold":"bg-white shadow-md text-purple-600 font-bold":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:nt=>nt.stopPropagation(),children:[i.jsx(Wu,{size:12})," AI "]})]}),(((Lt=r.settings)==null?void 0:Lt.analysisMode)||"manual")==="manual"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-[11px] text-zinc-500",children:":"}),i.jsx("input",{type:"number",min:"1",max:"30",value:((wt=r.settings)==null?void 0:wt.segmentDuration)||3,onChange:nt=>{const Pt=parseInt(nt.target.value)||3;Je(r.id,{segmentDuration:Pt}),zj(Pt.toString());try{localStorage.setItem("tapnow_last_segment_duration",Pt.toString())}catch{}},className:`w-16 px-2 py-1 text-[11px] rounded border ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,onMouseDown:nt=>nt.stopPropagation()}),i.jsx("span",{className:"text-[11px] text-zinc-500",children:""})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("label",{className:"text-[11px] text-zinc-500",children:":"}),i.jsxs("div",{className:"relative flex-1",children:[i.jsxs("button",{onClick:nt=>{nt.stopPropagation(),Er((Re==null?void 0:Re.nodeId)===r.id&&Re.type==="analyze-model"?null:{nodeId:r.id,type:"analyze-model"})},className:`w-full flex items-center justify-between px-2 py-1 rounded text-[11px] border transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 hover:border-zinc-600":"bg-zinc-50 border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,onMouseDown:nt=>nt.stopPropagation(),children:[i.jsx("span",{className:"truncate font-mono",children:((me=sr((G=r.settings)==null?void 0:G.model))==null?void 0:me.id)||(($e=r.settings)==null?void 0:$e.model)||"gemini-3-pro"}),i.jsx(Zn,{size:10,className:"opacity-50 shrink-0 ml-1"})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="analyze-model"&&i.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:nt=>nt.stopPropagation(),onMouseLeave:()=>qn(null),children:[i.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(ys).filter(([,nt])=>nt.models.some(Pt=>Ci(Pt.type))).map(([nt,Pt])=>i.jsx("button",{onMouseEnter:()=>qn(nt),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${un===nt?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:Pt.name||nt},nt))}),i.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[un&&((jt=ys[un])==null?void 0:jt.models.filter(nt=>Ci(nt.type)).map(nt=>{var or;const Pt=nt._uid||nt.id,$t=rr((or=r.settings)==null?void 0:or.model);return i.jsxs("button",{onClick:()=>{Je(r.id,{model:Pt}),jj(Pt);try{localStorage.setItem("tapnow_last_analyze_model",Pt)}catch{}Er(null),qn(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${$t===Pt?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[i.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:nt.id}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(Pt)}`})]},Pt)})),!un&&i.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})]})]}),i.jsx("button",{onClick:()=>{var nt;return((nt=r.settings)==null?void 0:nt.analysisMode)==="auto"?AN(r.id):$N(r.id)},disabled:r.isGenerating||(((lt=r.settings)==null?void 0:lt.analysisMode)||"manual")==="manual"&&Ze.length===0,className:`w-full px-3 py-2 rounded text-xs font-medium transition-colors flex items-center justify-center gap-2 ${r.isGenerating?"bg-zinc-600 text-zinc-400 cursor-not-allowed":((ir=r.settings)==null?void 0:ir.analysisMode)==="auto"?"bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white shadow-lg":"bg-blue-600 hover:bg-blue-500 text-white"}`,onMouseDown:nt=>nt.stopPropagation(),children:r.isGenerating?i.jsxs(i.Fragment,{children:[i.jsx(la,{size:14,className:"animate-spin"}),i.jsx("span",{children:((Ht=r.settings)==null?void 0:Ht.analysisMode)==="auto"?j("AI ..."):j("...")})]}):i.jsxs(i.Fragment,{children:[i.jsx(Wu,{size:14}),i.jsx("span",{children:((ae=r.settings)==null?void 0:ae.analysisMode)==="auto"?j(""):j("")})]})}),r.errorMsg&&i.jsx("div",{className:"text-[10px] text-red-500 px-2 py-1 rounded bg-red-500/10",children:r.errorMsg})]}),((He=r.settings)==null?void 0:He.analysisMode)==="auto"&&((bt=(Pe=r.settings)==null?void 0:Pe.analysisResults)==null?void 0:bt.length)>0&&i.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar pt-2",children:[((rt=r.settings.voiceoverResults)==null?void 0:rt.length)>0&&i.jsxs("div",{className:`p-2 rounded-lg mb-4 ${e==="dark"?"bg-zinc-700/50 border border-zinc-700":"bg-zinc-50 border border-blue-200"}`,children:[i.jsxs("h4",{className:`text-xs font-semibold mb-2 flex items-center gap-1 ${e==="dark"?"text-white":"text-blue-700"}`,children:[i.jsx(XC,{size:12})," "]}),i.jsx("div",{className:"space-y-1",children:r.settings.voiceoverResults.map((nt,Pt)=>i.jsxs("p",{className:`text-[10px] select-text cursor-text ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,onMouseDown:$t=>$t.stopPropagation(),children:[i.jsxs("span",{className:"font-mono text-xs mr-2 opacity-70",children:["[",nt.time_range||`${nt.time}s`,"]"]}),nt.text||i.jsx("span",{className:"text-zinc-400 italic",children:""})]},Pt))})]}),i.jsxs("h4",{className:`text-xs font-semibold mb-3 flex items-center gap-1 ${e==="dark"?"text-white":"text-zinc-800"}`,children:[i.jsx(iw,{size:12}),"  (",r.settings.analysisResults.length," )"]}),i.jsx("div",{className:"space-y-4",children:r.settings.analysisResults.map((nt,Pt)=>{var $t,or,Ur,Yr,jr,pn,yt,dr;return i.jsxs("div",{className:`p-3 rounded-lg ${e==="dark"?"bg-zinc-800 border border-zinc-700":"bg-zinc-50 border border-zinc-200"}`,children:[i.jsxs("h5",{className:`text-sm font-bold mb-2 ${e==="dark"?"text-purple-400":"text-purple-700"}`,children:[" ",nt.scene_index||nt.scene_id||Pt+1," ",i.jsxs("span",{className:"text-xs font-normal opacity-70 ml-2",children:["(",nt.time_range,")"]})]}),i.jsxs("div",{className:"text-[11px] space-y-1 mb-3",children:[((or=($t=nt.keyframes)==null?void 0:$t[0])==null?void 0:or.description)&&i.jsxs("p",{className:`select-text cursor-text ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,onMouseDown:vr=>vr.stopPropagation(),children:[i.jsx("span",{className:"font-semibold mr-1",children:"/:"})," ",nt.keyframes[0].description]}),((Yr=(Ur=nt.global_tags)==null?void 0:Ur.style)==null?void 0:Yr[0])&&i.jsxs("p",{className:`select-text cursor-text ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,onMouseDown:vr=>vr.stopPropagation(),children:[i.jsx("span",{className:"font-semibold mr-1",children:"/:"})," ",nt.global_tags.style[0]]})]}),i.jsxs("div",{className:"space-y-2",children:[((pn=(jr=nt.keyframes)==null?void 0:jr[0])==null?void 0:pn.jimeng_prompt)&&i.jsxs("div",{className:`p-2 rounded ${e==="dark"?"bg-zinc-700 border border-zinc-600":"bg-zinc-50 border border-gray-300"}`,children:[i.jsxs("h6",{className:`text-[10px] font-semibold mb-1 flex items-center gap-1 ${e==="dark"?"text-yellow-300":"text-yellow-700"}`,children:[i.jsx(Hu,{size:10}),"  Prompt"]}),i.jsx("p",{className:`text-[10px] whitespace-pre-wrap select-text cursor-text ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,onMouseDown:vr=>vr.stopPropagation(),children:nt.keyframes[0].jimeng_prompt}),i.jsxs("button",{onClick:()=>navigator.clipboard.writeText(nt.keyframes[0].jimeng_prompt),className:"mt-1 flex items-center text-[9px] text-blue-400 hover:text-blue-300",onMouseDown:vr=>vr.stopPropagation(),children:[i.jsx(aw,{size:10,className:"mr-1"})," ",j("")]})]}),((dr=(yt=nt.keyframes)==null?void 0:yt[0])==null?void 0:dr.mj_prompt)&&i.jsxs("div",{className:`p-2 rounded ${e==="dark"?"bg-zinc-700 border border-zinc-600":"bg-zinc-50 border border-gray-300"}`,children:[i.jsxs("h6",{className:`text-[10px] font-semibold mb-1 flex items-center gap-1 ${e==="dark"?"text-green-300":"text-green-700"}`,children:[i.jsx(Hu,{size:10})," MJ Prompt"]}),i.jsx("p",{className:`text-[10px] whitespace-pre-wrap select-text cursor-text ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,onMouseDown:vr=>vr.stopPropagation(),children:nt.keyframes[0].mj_prompt}),i.jsxs("button",{onClick:()=>navigator.clipboard.writeText(nt.keyframes[0].mj_prompt),className:"mt-1 flex items-center text-[9px] text-blue-400 hover:text-blue-300",onMouseDown:vr=>vr.stopPropagation(),children:[i.jsx(aw,{size:10,className:"mr-1"})," ",j("")]})]})]})]},Pt)})})]}),(((It=r.settings)==null?void 0:It.analysisMode)||"manual")==="manual"&&r.analysisResults&&r.analysisResults.length>0?i.jsxs("div",{className:"space-y-3 flex-1 flex flex-col min-h-0",children:[i.jsxs("div",{className:"text-[11px] font-medium text-zinc-700 dark:text-zinc-300 shrink-0",children:[" (",r.analysisResults.length," )"]}),i.jsx("div",{className:"space-y-3 flex-1 overflow-y-auto custom-scrollbar min-h-0",children:r.analysisResults.map((nt,Pt)=>{var pn,yt,dr,vr,V,ft,pt;const $t=zt=>{var fr,cr;const mt=(fr=H.selectedKeyframes)==null?void 0:fr.find(Ne=>Math.abs(Ne.time-zt)<.1);if(mt)return mt.url;const Jt=(cr=H.frames)==null?void 0:cr.find(Ne=>Math.abs(Ne.time-zt)<.1);return(Jt==null?void 0:Jt.url)||null},or=((pn=nt.keyframes)==null?void 0:pn.find(zt=>zt.type==="current"))||((yt=nt.keyframes)==null?void 0:yt[0]),Ur=(dr=nt.keyframes)==null?void 0:dr.find(zt=>zt.type==="prev"),Yr=(vr=nt.keyframes)==null?void 0:vr.find(zt=>zt.type==="next"),jr=(or==null?void 0:or.description)||((ft=(V=nt.keyframes)==null?void 0:V[0])==null?void 0:ft.description)||"";return i.jsxs("div",{className:`p-3 rounded-lg border ${e==="dark"?"bg-zinc-800 border-zinc-700":"bg-white border-zinc-300"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsxs("div",{className:"font-medium text-[11px] text-zinc-800 dark:text-zinc-200",children:[" ",nt.scene_index||Pt+1]}),i.jsx("div",{className:"text-[10px] text-zinc-500",children:nt.time_range})]}),i.jsx("div",{className:"text-[10px] text-zinc-600 dark:text-zinc-400 mb-3 line-clamp-2 select-text cursor-text",onMouseDown:zt=>zt.stopPropagation(),children:jr}),i.jsx("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[Ur,or,Yr].map((zt,mt)=>{if(!zt)return i.jsx("div",{className:"aspect-video bg-zinc-200 dark:bg-zinc-700 rounded"},mt);const Jt=$t(zt.time);return i.jsxs("div",{className:"relative aspect-video bg-black rounded overflow-hidden",children:[Jt?i.jsx(nn,{src:Jt,className:"w-full h-full object-cover",alt:` ${mt+1}`,loading:"lazy"}):i.jsx("div",{className:"w-full h-full flex items-center justify-center text-[8px] text-zinc-500",children:zt.type==="prev"?"":zt.type==="current"?"":""}),i.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[8px] px-1 py-0.5 text-center",children:[zt.time.toFixed(1),"s"]})]},mt)})}),i.jsx("div",{className:"space-y-2",children:(pt=nt.keyframes)==null?void 0:pt.map((zt,mt)=>i.jsxs("div",{className:"space-y-1.5",children:[i.jsxs("div",{className:"text-[9px] text-zinc-500",children:[zt.type==="prev"?"":zt.type==="current"?"":""," (",zt.time.toFixed(1),"s)"]}),zt.mj_prompt&&i.jsx("div",{className:`p-2 rounded border ${e==="dark"?"bg-zinc-900 border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"text-[9px] text-zinc-500 mb-1",children:"Midjourney "}),i.jsx("div",{className:"text-[10px] text-zinc-700 dark:text-zinc-300 break-words select-text cursor-text",onMouseDown:Jt=>Jt.stopPropagation(),children:zt.mj_prompt})]}),i.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[i.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(zt.mj_prompt),alert(j(""))}catch{alert(j(""))}},className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:Jt=>Jt.stopPropagation(),title:j(""),children:i.jsx(Jl,{size:12})}),i.jsx("button",{onClick:()=>{const Jt=Hr(r.x+r.width+100,r.y+r.height/2),fr=`node-${Date.now()}`,cr={id:fr,type:"gen-image",x:Jt.x-180,y:Jt.y-170,width:360,height:340,settings:{model:"mj-v6",prompt:zt.mj_prompt,ratio:"Auto",resolution:"2K"}};x(Ne=>[...Ne,cr]),setTimeout(()=>{const Ne=Hr(r.x+r.width+200,r.y+r.height/2),Qt=`node-${Date.now()+1}`,Pr={id:Qt,type:"preview",x:Ne.x-160,y:Ne.y-130,width:320,height:260};x(_r=>[..._r,Pr]),C(_r=>[..._r,{id:`conn-${Date.now()}`,from:fr,to:Qt}])},50)},className:"p-1 rounded hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors text-blue-600 dark:text-blue-400",onMouseDown:Jt=>Jt.stopPropagation(),title:j(""),children:i.jsx(pw,{size:12})})]})]})}),zt.jimeng_prompt&&i.jsx("div",{className:`p-2 rounded border ${e==="dark"?"bg-zinc-900 border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"text-[9px] text-zinc-500 mb-1",children:""}),i.jsx("div",{className:"text-[10px] text-zinc-700 dark:text-zinc-300 break-words select-text cursor-text",onMouseDown:Jt=>Jt.stopPropagation(),children:zt.jimeng_prompt})]}),i.jsx("button",{onClick:async()=>{try{await navigator.clipboard.writeText(zt.jimeng_prompt),alert(j(""))}catch{alert(j(""))}},className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:Jt=>Jt.stopPropagation(),title:j(""),children:i.jsx(Jl,{size:12})})]})})]},mt))}),nt.global_tags&&i.jsxs("div",{className:"mt-2 pt-2 border-t border-zinc-300 dark:border-zinc-700",children:[i.jsx("div",{className:"text-[9px] text-zinc-500 mb-1",children:""}),i.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(nt.global_tags).map(([zt,mt])=>Array.isArray(mt)&&mt.map((Jt,fr)=>i.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300",children:Jt},`${zt}-${fr}`)))})]})]},Pt)})})]}):null]})})()})]}),r.type==="storyboard-node"&&(()=>{var Mt,Et,Lt,wt,G,me,$e,jt,lt,ir,Ht,ae,He,Pe,bt,rt,It,nt,Pt,$t,or,Ur,Yr,jr,pn,yt,dr,vr;const H=(V,ft)=>{const pt=V.clipboardData.items;for(let zt=0;zt<pt.length;zt++)if(pt[zt].type.indexOf("image")!==-1){V.preventDefault(),V.stopPropagation();const mt=pt[zt].getAsFile(),Jt=new FileReader;Jt.onload=fr=>ar(r.id,ft,{image_url:fr.target.result}),Jt.readAsDataURL(mt);return}},ve=(V,ft)=>{var Pr,_r;V.preventDefault(),V.stopPropagation();const pt=(((Pr=r.settings)==null?void 0:Pr.shots)||[]).find(xe=>xe.id===ft),zt=((_r=r.settings)==null?void 0:_r.mode)||"video",mt=xe=>{if(!xe)return!1;if(zt==="video"){const kt=(pt==null?void 0:pt.useFirstLastFrame)&&(pt==null?void 0:pt.activeInput)==="last"?"lastFrame":"image_url";return ar(r.id,ft,{[kt]:xe,image_filename:""}),!0}if(pt!=null&&pt.useMultiRef){const kt=(pt.referenceImages&&pt.referenceImages.length>0?pt.referenceImages:pt.image_url?[pt.image_url]:[]).slice(0,5);return kt.length<5?kt.push(xe):kt[0]=xe,ar(r.id,ft,{referenceImages:kt,image_url:kt[0]||xe}),!0}return ar(r.id,ft,{image_url:xe,image_filename:"",referenceImages:[]}),!0};if(V.dataTransfer.files&&V.dataTransfer.files.length>0){const xe=V.dataTransfer.files[0];if(xe.type.startsWith("image/")){const Ke=new FileReader;Ke.onload=kt=>mt(kt.target.result),Ke.readAsDataURL(xe);return}}const Jt=V.dataTransfer.getData("application/x-tapnow-history");if(Jt)try{const xe=JSON.parse(Jt),Ke=(xe==null?void 0:xe.url)||(xe==null?void 0:xe.originalUrl)||(xe==null?void 0:xe.previewUrl)||"";if(mt(Ke))return}catch(xe){console.warn("[StoryboardDrop] Failed to parse payload",xe)}const cr=(V.dataTransfer.getData("text/uri-list")||"").split(`
`).find(xe=>xe&&!xe.startsWith("#"))||"",Ne=V.dataTransfer.getData("text/plain")||"",Qt=(cr||Ne).trim();Qt&&/^(https?:|data:image\/|blob:|file:)/i.test(Qt)&&mt(Qt)},Ze=mn.filter(V=>V.nodeId===r.id),vt=Kr.filter(V=>V.nodeId===r.id);return i.jsx("div",{className:"flex h-full",children:i.jsxs("div",{className:`flex flex-col h-full rounded-xl overflow-hidden pointer-events-auto transition-colors flex-1 ${e==="dark"?"bg-zinc-950 border border-zinc-800":e==="solarized"?"bg-[#eee8d5] border border-[#d7cfb2]":"bg-white border border-zinc-300 shadow-sm"}`,onMouseEnter:()=>ty(!0),onMouseLeave:()=>ty(!1),children:[i.jsxs("div",{className:`px-4 py-3 border-b flex items-center shrink-0 flex-nowrap overflow-x-auto no-scrollbar ${e==="dark"?"bg-zinc-900 border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[i.jsx(ah,{size:16,className:"text-purple-500"}),i.jsx("span",{className:`font-bold text-xs ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,children:j("")}),i.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"/"}),(Mt=r.settings)!=null&&Mt.isEditingTitle?i.jsx("input",{type:"text",value:((Et=r.settings)==null?void 0:Et.projectTitle)||"",onChange:V=>Je(r.id,{projectTitle:V.target.value}),placeholder:j(""),className:`font-bold text-xs bg-transparent border-b border-blue-500 outline-none w-32 transition-colors ${e==="dark"?"text-zinc-200 placeholder-zinc-500":"text-zinc-800 placeholder-zinc-400"}`,onMouseDown:V=>V.stopPropagation(),onClick:V=>V.stopPropagation(),onKeyDown:V=>{V.stopPropagation(),(V.key==="Enter"||V.key==="Escape")&&Je(r.id,{isEditingTitle:!1})},onBlur:()=>Je(r.id,{isEditingTitle:!1}),autoFocus:!0}):i.jsx("span",{className:`font-bold text-xs cursor-move ${e==="dark"?"text-zinc-200":"text-zinc-800"} ${(Lt=r.settings)!=null&&Lt.projectTitle?"":e==="dark"?"text-zinc-500":"text-zinc-400"}`,title:j(""),children:((wt=r.settings)==null?void 0:wt.projectTitle)||""}),i.jsx("button",{onClick:V=>{var ft;V.stopPropagation(),Je(r.id,{isEditingTitle:!((ft=r.settings)!=null&&ft.isEditingTitle)})},onMouseDown:V=>V.stopPropagation(),className:`p-0.5 rounded transition-colors ${(G=r.settings)!=null&&G.isEditingTitle?"text-blue-500":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(""),children:i.jsx(jg,{size:12})}),i.jsxs("div",{className:`flex items-center ml-2 p-0.5 rounded-full ${e==="dark"?"bg-zinc-800":e==="solarized"?"bg-[#eee8d5]":"bg-zinc-200"}`,children:[i.jsx("button",{onClick:V=>{var Jt,fr;V.stopPropagation();const ft="image",pt=rr(localStorage.getItem("tapnow_last_image_model")||((Jt=Ye.find(cr=>zs(cr.type)))==null?void 0:Jt.id)||""),mt=(((fr=r.settings)==null?void 0:fr.shots)||[]).map(cr=>{const Ne=sr(cr.model);return!Ne||Ne.type==="Video"?{...cr,model:pt,duration:void 0}:cr});Je(r.id,{mode:ft,shots:mt})},className:`text-[10px] px-2 py-0.5 rounded-full transition-all ${(((me=r.settings)==null?void 0:me.mode)||"video")==="image"?"bg-blue-500 text-white shadow-sm":e==="dark"?"text-zinc-400 hover:text-zinc-200":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:V=>V.stopPropagation(),title:j(""),children:j("")}),i.jsx("button",{onClick:V=>{var Jt,fr;V.stopPropagation();const ft="video",pt=rr(localStorage.getItem("tapnow_last_video_model")||((Jt=Ye.find(cr=>cr.type==="Video"))==null?void 0:Jt.id)||""),mt=(((fr=r.settings)==null?void 0:fr.shots)||[]).map(cr=>{const Ne=sr(cr.model);return!Ne||zs(Ne.type)?{...cr,model:pt,duration:Bl(pt)}:cr});Je(r.id,{mode:ft,shots:mt})},className:`text-[10px] px-2 py-0.5 rounded-full transition-all ${((($e=r.settings)==null?void 0:$e.mode)||"video")==="video"?"bg-green-500 text-white shadow-sm":e==="dark"?"text-zinc-400 hover:text-zinc-200":"text-zinc-500 hover:text-zinc-700"}`,onMouseDown:V=>V.stopPropagation(),title:j(""),children:j("")})]})]}),i.jsxs("div",{className:"flex items-center gap-2 ml-auto relative z-10 shrink-0",children:[i.jsx("button",{onClick:V=>{V.stopPropagation(),confirm(j(""))&&Je(r.id,{shots:[]})},className:"p-1 hover:bg-red-100 hover:text-red-500 rounded text-zinc-400 transition-colors",title:j(""),children:i.jsx(Is,{size:14})}),i.jsxs("button",{onClick:()=>{var ft,pt;const V=bu(r.id);if(V.length>0){const zt=V.join(`
`),mt=/#\s*(\d+)\s*([^#]*)|\s*(\d+)\s*\s*([^#]*)/g,Jt=[];let fr;for(;(fr=mt.exec(zt))!==null;){const cr=parseInt(fr[1]||fr[3]),Ne=(fr[2]||fr[4]||"").trim();Ne&&Jt.push({num:cr,text:Ne})}if(Jt.length===0&&zt.split(`
`).filter(Ne=>Ne.trim()).forEach((Ne,Qt)=>{const Pr=Ne.match(/^(\d+)[.\s]+(.*)/);Pr?Jt.push({num:parseInt(Pr[1]),text:Pr[2].trim()}):Jt.push({num:Qt+1,text:Ne.trim()})}),Jt.length>0){const cr=((ft=r.settings)==null?void 0:ft.shots)||[],Ne=[...cr];Jt.forEach((Qt,Pr)=>{Pr<cr.length?Ne[Pr]={...Ne[Pr],prompt:Qt.text,description:Qt.text}:Ne.push({id:Date.now()+Math.random()+Pr,prompt:Qt.text,description:Qt.text,model:rr(localStorage.getItem("tapnow_last_video_model")||""),duration:5,status:"draft",outputEnabled:!0,selectedImageIndex:0})}),Je(r.id,{shots:Ne})}else alert(j(" (: #1 )"))}else Je(r.id,{scriptExpanded:!((pt=r.settings)!=null&&pt.scriptExpanded)})},className:`text-xs px-2 py-1 rounded transition-colors flex items-center gap-1 ${e==="dark"?"bg-purple-600 hover:bg-purple-500 text-white":"bg-purple-500 hover:bg-purple-400 text-white"}`,onMouseDown:V=>V.stopPropagation(),title:bu(r.id).length>0?j(""):j(""),children:[i.jsx(_i,{size:12}),i.jsx("span",{className:"whitespace-nowrap",children:j("")})]}),(()=>{var pt;const V=xu(r.id),ft=((pt=V==null?void 0:V.selectedKeyframes)==null?void 0:pt.length)||0;return i.jsxs("button",{onClick:async()=>{var cr;if(!V||ft===0){alert(j(""));return}const zt=V.selectedKeyframes,mt=((cr=r.settings)==null?void 0:cr.shots)||[],Jt=Math.max(mt.length,zt.length),fr=Array.from({length:Jt},(Ne,Qt)=>{var Pr,_r,xe,Ke,kt,qt,At,Lr,hr;return{id:((Pr=mt[Qt])==null?void 0:Pr.id)||`shot-${Date.now()}-${Qt}`,...mt[Qt],prompt:((_r=mt[Qt])==null?void 0:_r.prompt)??"",description:((xe=mt[Qt])==null?void 0:xe.description)??"",model:rr(((Ke=mt[Qt])==null?void 0:Ke.model)||localStorage.getItem("tapnow_last_video_model")||""),image_url:((kt=zt[Qt])==null?void 0:kt.url)??((qt=mt[Qt])==null?void 0:qt.image_url)??"",image_filename:((At=zt[Qt])==null?void 0:At.filename)||((Lr=mt[Qt])==null?void 0:Lr.image_filename)||"",status:((hr=mt[Qt])==null?void 0:hr.status)||"draft"}});if(Ge(),window.LocalImageManager){for(let Ne of fr)if(Ne.image_url&&(Ne.image_url.startsWith("file://")||Ne.image_url.startsWith("img_"))){const Pr=Ne.image_url.startsWith("img_")?Ne.image_url:Ne.imgId||Ne.image_filename;if(Pr)try{const _r=await window.LocalImageManager.getImage(Pr);_r&&(Ne.image_url=URL.createObjectURL(_r))}catch(_r){console.error("[KeyframeImport] Failed to load local image:",Pr,_r)}}}Je(r.id,{shots:fr})},className:`text-xs px-2 py-1 rounded transition-colors flex items-center gap-1 ${ft>0?"bg-blue-600 hover:bg-blue-500 text-white":e==="dark"?"bg-zinc-700 text-zinc-400 cursor-not-allowed":"bg-zinc-200 text-zinc-500 cursor-not-allowed"}`,onMouseDown:zt=>zt.stopPropagation(),disabled:ft===0,title:ft>0?`${j("")} ${ft} ${j("")}`:j(""),children:[i.jsx(Zc,{size:12}),i.jsxs("span",{className:"whitespace-nowrap",children:[j(""),ft>0?` (${ft})`:""]})]})})(),(()=>{var zt;const V=((zt=r.settings)==null?void 0:zt.mode)||"video",ft=N.filter(mt=>mt.to===r.id).map(mt=>Xt.get(mt.from)).find(mt=>mt&&(V==="image"&&mt.type==="gen-image"||V==="video"&&mt.type==="gen-video"));if(!ft)return null;const pt=ft.settings||{};return i.jsxs("button",{onClick:()=>{var fr;const mt=((fr=r.settings)==null?void 0:fr.shots)||[];if(mt.length===0){Je(r.id,{errorMsg:""});return}Ge();const Jt=mt.map(cr=>({...cr,model:pt.model||cr.model,ratio:pt.ratio||cr.ratio,resolution:pt.resolution||cr.resolution,duration:pt.duration||cr.duration}));Je(r.id,{shots:Jt}),d(`  ${Jt.length}  | ${pt.model||"?"} / ${pt.ratio||"?"}`,"success",5e3)},className:`text-xs px-2 py-1 rounded transition-colors flex items-center gap-1 ${e==="dark"?"bg-green-600 hover:bg-green-500 text-white":"bg-green-500 hover:bg-green-400 text-white"}`,onMouseDown:mt=>mt.stopPropagation(),title:` ${V==="image"?"":""}: ${pt.model||"?"} / ${pt.ratio||"?"} / ${pt.resolution||"?"}${V==="video"?` / ${pt.duration||"?"}`:""}`,children:[i.jsx(hp,{size:12}),i.jsx("span",{className:"whitespace-nowrap",children:j("")})]})})(),i.jsxs("div",{className:`flex items-center gap-1 border-l pl-2 ml-1 ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,children:[i.jsx("input",{type:"number",min:"0",max:"20",value:be,onChange:V=>Xe(Math.max(0,parseInt(V.target.value)||0)),className:`w-8 text-center text-xs rounded border outline-none py-0.5 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":"bg-white border-zinc-300"}`,title:j(" (0=)")}),i.jsx("button",{onClick:()=>{var _r,xe;const V=((_r=r.settings)==null?void 0:_r.mode)||"video",ft=((xe=r.settings)==null?void 0:xe.shots)||[],pt=ft.filter(Ke=>Ke.status==="generating");if(pt.length>0){const Ke=prompt(` ${pt.length} 




  "1"  "ok" = 
  "2"  "skip" = 
  = `,"");if(Ke===null||Ke.trim()==="")return;const kt=Ke.trim().toLowerCase();(kt==="1"||kt==="ok"||kt==="")&&pt.forEach(qt=>{ar(r.id,qt.id,{status:"pending",errorMsg:""}),qt.status="pending"})}let zt=ft.filter(Ke=>Ke.status!=="done"&&Ke.status!=="generating"&&!Ke.outputEnabled),mt=!1;if(zt.length===0){if(zt=ft.filter(Ke=>!Ke.outputEnabled&&Ke.status==="done"),zt.length===0){const Ke=ft.every(qt=>qt.outputEnabled);ft.some(qt=>qt.status==="generating")?alert(j("")):Ke&&ft.length>0?alert(`
`):alert(j(""));return}mt=!0}if(mt){const Ke=`

 ${zt.length} 

 
 

`;if(!confirm(Ke))return}const Jt=zt.length,fr=be===0?Jt:Math.max(1,be),cr=(Se.current.get(r.id)||0)+1;Se.current.set(r.id,cr);const Ne=`batch-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,Qt=zt.map(Ke=>Ke.id);Qt.forEach((Ke,kt)=>{D.current.set(`${r.id}:${Ke}`,{batchId:Ne,batchOrder:kt,taskIndex:cr})}),re(Ke=>{var kt;return[...Ke,{id:Ne,nodeId:r.id,projectTitle:((kt=r.settings)==null?void 0:kt.projectTitle)||"",total:Jt,concurrency:fr,createdAt:Date.now(),mode:V,taskIndex:cr,shotIds:Qt}]});const Pr=zt.map((Ke,kt)=>({nodeId:r.id,shotId:Ke.id,retryCount:0,mode:V,batchId:Ne,batchOrder:kt,batchConcurrency:fr,taskIndex:cr}));ze(Ke=>[...Ke,...Pr]),fe.current!=="running"&&(fe.current="idle"),_e(Ke=>Ke+1),d(`  ${Pr.length} ${V==="image"?"":""} | : ${be===0?"":be}${mt?" ()":""}`,"success",5e3)},className:`p-1 rounded transition-colors ${(((jt=r.settings)==null?void 0:jt.mode)||"video")==="image"?e==="dark"?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-500 hover:bg-blue-400 text-white":e==="dark"?"bg-yellow-600 hover:bg-yellow-500 text-white":"bg-yellow-500 hover:bg-yellow-400 text-white"}`,title:`${(((lt=r.settings)==null?void 0:lt.mode)||"video")==="image"?"":""}`,children:i.jsxs("div",{className:"flex items-center gap-1",children:[(((ir=r.settings)==null?void 0:ir.mode)||"video")==="image"?i.jsx(Zc,{size:12}):i.jsx(dh,{size:12,fill:"currentColor"}),i.jsx("span",{className:"text-[10px] font-medium whitespace-nowrap",children:j("")})]})}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:V=>{V.stopPropagation();const ft=V.currentTarget.getBoundingClientRect();Er((Re==null?void 0:Re.nodeId)===r.id&&Re.type==="storyboard-download"?null:{nodeId:r.id,type:"storyboard-download",anchor:{top:ft.top,left:ft.left,right:ft.right,bottom:ft.bottom,width:ft.width,height:ft.height}})},className:`p-1 rounded transition-colors flex items-center gap-0.5 ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-600"}`,title:j(""),onMouseDown:V=>V.stopPropagation(),children:[i.jsx(aa,{size:12}),i.jsx(Zn,{size:10})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="storyboard-download"&&Re.anchor&&i0.createPortal(i.jsxs("div",{className:`fixed mt-1 w-32 rounded-lg shadow-xl py-1 z-[9999] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{top:Re.anchor.bottom+6,left:Re.anchor.right,transform:"translateX(-100%)"},onMouseLeave:()=>Er(null),onMouseDown:V=>V.stopPropagation(),children:[i.jsx("button",{onClick:()=>{Er(null),zv(r,"all")},className:`w-full text-left px-3 py-2 text-xs transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,children:""}),i.jsx("button",{onClick:()=>{Er(null),zv(r,"selected")},className:`w-full text-left px-3 py-2 text-xs transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,children:""})]}),document.body)]}),i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:V=>{V.stopPropagation();const ft=V.currentTarget.getBoundingClientRect();Er((Re==null?void 0:Re.nodeId)===r.id&&Re.type==="batch-queue"?null:{nodeId:r.id,type:"batch-queue",anchor:{top:ft.top,left:ft.left,right:ft.right,bottom:ft.bottom,width:ft.width,height:ft.height}})},className:`p-1 rounded transition-colors relative ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-600"}`,title:` ${vt.length} |  ${Ze.length}`,onMouseDown:V=>V.stopPropagation(),children:[i.jsx(zg,{size:12}),Ze.length>0&&i.jsx("span",{className:`absolute -top-1 -right-1 text-[8px] px-1 rounded-full ${e==="dark"?"bg-blue-500 text-white":"bg-blue-600 text-white"}`,children:Ze.length})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="batch-queue"&&Re.anchor&&i0.createPortal(i.jsxs("div",{className:`fixed mt-1 w-64 rounded-lg shadow-xl py-2 z-[9999] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{top:Re.anchor.bottom+6,left:Re.anchor.right,transform:"translateX(-100%)"},onMouseLeave:()=>Er(null),onMouseDown:V=>V.stopPropagation(),children:[i.jsxs("div",{className:`px-3 pb-2 text-[10px] ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:[" ",vt.length,"   ",Ze.length]}),i.jsxs("div",{className:"px-3 pb-2 flex gap-2",children:[i.jsx("button",{onClick:()=>{Er(null),Ze.length!==0&&confirm(j(""))&&$r(r.id,!1)},className:`text-[10px] px-2 py-1 rounded ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:j("")}),i.jsx("button",{onClick:()=>{Er(null),!(vt.length===0&&Ze.length===0)&&confirm(j(""))&&$r(r.id,!0)},className:`text-[10px] px-2 py-1 rounded ${e==="dark"?"bg-red-900/40 text-red-300 hover:bg-red-900/60":"bg-red-50 text-red-600 hover:bg-red-100"}`,children:j("")})]}),vt.length>0&&i.jsxs("div",{className:"px-3 pb-2",children:[i.jsx("div",{className:"text-[10px] mb-1 text-zinc-500",children:""}),i.jsxs("div",{className:"space-y-1",children:[vt.slice(0,6).map((V,ft)=>i.jsxs("div",{className:`text-[10px] flex items-center justify-between gap-2 ${e==="dark"?"text-zinc-300":"text-zinc-600"}`,children:[i.jsxs("span",{className:"truncate max-w-[150px]",children:[V.projectTitle,"  ",V.sceneIndex]}),i.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[i.jsx("span",{className:"text-green-500",children:j("")}),i.jsx("button",{onClick:()=>{confirm(j(""))&&Qr(V.nodeId,V.shotId)},className:`p-0.5 rounded ${e==="dark"?"text-zinc-500 hover:text-red-300":"text-zinc-400 hover:text-red-500"}`,title:j(""),children:i.jsx(Is,{size:10})})]})]},`${V.nodeId}-${V.shotId}-${ft}`)),vt.length>6&&i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:" 6 "})]})]}),i.jsxs("div",{className:"px-3",children:[i.jsx("div",{className:"text-[10px] mb-1 text-zinc-500",children:""}),Ze.length===0?i.jsx("div",{className:`text-[10px] ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:""}):i.jsxs("div",{className:"space-y-1 max-h-40 overflow-y-auto pr-1",children:[Ze.slice(0,12).map(V=>i.jsxs("div",{className:`text-[10px] flex items-center justify-between gap-2 ${e==="dark"?"text-zinc-300":"text-zinc-600"}`,children:[i.jsxs("span",{className:"truncate max-w-[150px]",children:["#",V.order," ",V.projectTitle,"  ",V.sceneIndex]}),i.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[i.jsx("span",{className:"text-blue-400",children:V.mode==="image"?"":""}),i.jsx("button",{onClick:()=>{confirm(j(""))&&Ir(V.nodeId,V.shotId)},className:`p-0.5 rounded ${e==="dark"?"text-zinc-500 hover:text-red-300":"text-zinc-400 hover:text-red-500"}`,title:j(""),children:i.jsx(Is,{size:10})})]})]},`${V.nodeId}-${V.shotId}-${V.order}`)),Ze.length>12&&i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:" 12 "})]})]})]}),document.body)]}),i.jsx("button",{onClick:V=>{V.stopPropagation(),x(ft=>ft.map(pt=>{var zt;if(pt.id===r.id){const mt=(zt=pt.settings)==null?void 0:zt.showOutputPreview,Jt=mt?Math.max(380,pt.width-220):pt.width+220;return{...pt,width:Jt,settings:{...pt.settings,showOutputPreview:!mt}}}return pt}))},className:`p-1 rounded transition-colors ${(Ht=r.settings)!=null&&Ht.showOutputPreview?"bg-blue-500 text-white":e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-400":"bg-zinc-200 hover:bg-zinc-300 text-zinc-500"}`,title:(ae=r.settings)!=null&&ae.showOutputPreview?"":"",onMouseDown:V=>V.stopPropagation(),children:i.jsx(Zl,{size:12,className:`transition-transform ${(He=r.settings)!=null&&He.showOutputPreview?"rotate-90":""}`})})]}),((Pe=r.settings)==null?void 0:Pe.showOutputPreview)&&i.jsx("div",{className:"shrink-0 flex items-center justify-center gap-2 ml-1 ",style:{width:220},children:(((bt=r.settings)==null?void 0:bt.mode)||"video")==="image"?i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:V=>{var zt;V.stopPropagation();const ft=((zt=r.settings)==null?void 0:zt.shots)||[],pt=ft.length>0&&ft.every(mt=>mt.outputEnabled);Je(r.id,{shots:ft.map(mt=>({...mt,outputEnabled:!pt}))})},className:`text-[10px] px-2 py-1 rounded transition-colors whitespace-nowrap ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-600"}`,onMouseDown:V=>V.stopPropagation(),title:j("/"),children:(((rt=r.settings)==null?void 0:rt.shots)||[]).every(V=>V.outputEnabled)?j(""):j("")}),i.jsxs("button",{onClick:V=>{var zt;V.stopPropagation();const ft=((zt=r.settings)==null?void 0:zt.shots)||[],pt=ft.some(mt=>mt.selectedImageIndex>=0);Je(r.id,{shots:ft.map(mt=>({...mt,selectedImageIndex:mt.outputEnabled?mt.selectedImageIndex:pt?-1:0}))})},className:`text-[10px] px-2 py-1 rounded transition-colors flex items-center gap-1 whitespace-nowrap ${e==="dark"?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-500 hover:bg-blue-400 text-white"}`,onMouseDown:V=>V.stopPropagation(),title:j("=="),children:[i.jsx(Zc,{size:10}),i.jsx("span",{children:(((It=r.settings)==null?void 0:It.shots)||[]).some(V=>V.selectedImageIndex>=0)?j(""):j("")})]})]}):i.jsx("button",{onClick:V=>{var zt;V.stopPropagation();const ft=((zt=r.settings)==null?void 0:zt.shots)||[],pt=ft.length>0&&ft.every(mt=>mt.outputEnabled);Je(r.id,{shots:ft.map(mt=>({...mt,outputEnabled:!pt}))})},className:`text-[10px] px-2 py-1 rounded transition-colors whitespace-nowrap ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-600"}`,onMouseDown:V=>V.stopPropagation(),title:j("/"),children:(((nt=r.settings)==null?void 0:nt.shots)||[]).every(V=>V.outputEnabled)?j(""):j("")})})]})]}),((Pt=r.settings)==null?void 0:Pt.scriptExpanded)&&i.jsxs("div",{className:`border-b shrink-0 p-3 space-y-2 ${e==="dark"?"bg-zinc-900/30 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":"bg-zinc-50/50 border-zinc-200"}`,children:[i.jsx("textarea",{value:(($t=r.settings)==null?void 0:$t.scriptText)||"",onChange:V=>Je(r.id,{scriptText:V.target.value}),placeholder:j(": #1  #2  ..."),className:`w-full h-24 p-2 text-xs rounded border resize-none overflow-y-auto custom-scrollbar ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 placeholder-zinc-500":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onMouseDown:V=>V.stopPropagation(),onWheel:V=>{V.stopPropagation()}}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx("button",{onClick:()=>{var Qt,Pr;const ft=bu(r.id).join(`
`),pt=((Qt=r.settings)==null?void 0:Qt.scriptText)||"",zt=ft||pt,mt=[],Jt=/#\s*(\d+)\s*([^#]*)|\s*(\d+)\s*\s*([^#]*)/g;let fr;for(;(fr=Jt.exec(zt))!==null;){const _r=parseInt(fr[1]||fr[3]),xe=(fr[2]||fr[4]||"").trim();xe&&mt.push({num:_r,text:xe})}if(mt.length===0&&zt.split(`
`).filter(xe=>xe.trim()).forEach((xe,Ke)=>{const kt=xe.match(/^(\d+)[.\s]+(.*)/);kt?mt.push({num:parseInt(kt[1]),text:kt[2].trim()}):mt.push({num:Ke+1,text:xe.trim()})}),mt.length===0){alert(j(": #1  #2 "));return}mt.sort((_r,xe)=>_r.num-xe.num);const cr=((Pr=r.settings)==null?void 0:Pr.shots)||[],Ne=[...cr];mt.forEach((_r,xe)=>{xe<cr.length?Ne[xe]={...Ne[xe],prompt:_r.text,description:_r.text}:Ne.push({id:Date.now()+Math.random()+xe,prompt:_r.text,description:_r.text,model:rr(localStorage.getItem("tapnow_last_video_model")||""),duration:5,status:"draft",outputEnabled:!0,selectedImageIndex:0})}),Je(r.id,{shots:Ne,scriptExpanded:!1})},className:"px-3 py-1.5 text-xs bg-purple-600 text-white rounded hover:bg-purple-500 transition-colors",onMouseDown:V=>V.stopPropagation(),children:j("")}),i.jsxs("button",{onClick:async()=>{var mt,Jt,fr,cr,Ne,Qt,Pr,_r,xe,Ke;const V=((mt=r.settings)==null?void 0:mt.scriptText)||"";if(!V.trim()){Je(r.id,{errorMsg:""});return}(((Jt=r.settings)==null?void 0:Jt.shots)||[]).length>0&&window.confirm(`
""""`);const{key:pt,url:zt}=wi(ni);if(!pt){Je(r.id,{errorMsg:" Chat  Key"});return}try{Ge(),Je(r.id,{isGenerating:!0,errorMsg:""});const kt=((fr=r.settings)==null?void 0:fr.llmSplitPrompt)||`
 JSON : [{"prompt": "1"}, {"prompt": "2"}, ...]
 JSON`,hr=(((Qt=(Ne=(cr=(await(await fetch(`${zt}/v1/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${pt}`,"Content-Type":"application/json"},body:JSON.stringify({model:ni,messages:[{role:"system",content:kt},{role:"user",content:V}],stream:!1})})).json()).choices)==null?void 0:cr[0])==null?void 0:Ne.message)==null?void 0:Qt.content)||"").match(/\[[\s\S]*\]/);if(hr){const gr=JSON.parse(hr[0]),Fn=((Pr=r.settings)==null?void 0:Pr.mode)||"video",Dr=rr(Fn==="image"?localStorage.getItem("tapnow_last_image_model")||((_r=Ye.find(an=>zs(an.type)))==null?void 0:_r.id)||"":localStorage.getItem("tapnow_last_video_model")||((xe=Ye.find(an=>an.type==="Video"))==null?void 0:xe.id)||""),fn=Fn==="image"?"1:1":"16:9",mr=Fn==="video"?Bl(Dr):void 0,Tr=gr.map((an,ci)=>({id:`shot-${Date.now()}-${ci}`,scene_index:ci+1,prompt:an.prompt||an.description||"",description:an.description||an.prompt||"",image_url:"",video_url:"",output_url:"",model:Dr,ratio:fn,duration:mr,status:"draft",outputEnabled:!1,selectedImageIndex:-1})),Nr=((Ke=r.settings)==null?void 0:Ke.shots)||[],Bn=Nr.length>0&&!window.lastLlmSplitOverwrite?[...Nr,...Tr]:Tr;Je(r.id,{shots:Bn,scriptExpanded:!1,isGenerating:!1})}else throw new Error("AI ")}catch(kt){console.error("[LLM Split] Error:",kt),Je(r.id,{isGenerating:!1,errorMsg:kt.message})}},className:"px-2 py-1.5 text-xs bg-blue-600 text-white rounded hover:bg-blue-500 transition-colors flex items-center gap-1",onMouseDown:V=>V.stopPropagation(),disabled:(or=r.settings)==null?void 0:or.isGenerating,title:j(" AI "),children:[i.jsx(Wu,{size:12}),(Ur=r.settings)!=null&&Ur.isGenerating?"...":"LLM"]}),i.jsx("button",{onClick:()=>{var V;return Je(r.id,{showLlmPromptEditor:!((V=r.settings)!=null&&V.showLlmPromptEditor)})},className:`p-1.5 text-xs rounded transition-colors ${(Yr=r.settings)!=null&&Yr.showLlmPromptEditor?"bg-blue-500 text-white":e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-700"}`,onMouseDown:V=>V.stopPropagation(),title:j(" LLM  Prompt"),children:i.jsx(kg,{size:12})}),!((jr=r.settings)!=null&&jr.showLlmPromptEditor)&&i.jsxs("div",{className:`flex flex-col text-[10px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:[i.jsx("span",{children:j(": #1 #2 ")}),i.jsx("span",{children:j("LLM: ")})]})]}),((pn=r.settings)==null?void 0:pn.showLlmPromptEditor)&&i.jsxs("div",{className:"flex items-start gap-2 mt-2",children:[i.jsx("span",{className:`text-[10px] shrink-0 pt-1 ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:"LLM Prompt:"}),i.jsx("textarea",{value:((yt=r.settings)==null?void 0:yt.llmSplitPrompt)||`
 JSON : [{"prompt": "1"}, {"prompt": "2"}, ...]
 JSON`,onChange:V=>Je(r.id,{llmSplitPrompt:V.target.value}),className:`flex-1 text-xs p-2 rounded resize-none overflow-y-auto custom-scrollbar ${e==="dark"?"bg-zinc-800 text-zinc-200 border-zinc-700":e==="solarized"?"bg-[#fdf6e3] text-zinc-800 border-[#eee8d5]":"bg-white text-zinc-800 border-zinc-300"} border`,rows:3,placeholder:j(" LLM  Prompt..."),onMouseDown:V=>V.stopPropagation(),onClick:V=>V.stopPropagation(),onKeyDown:V=>V.stopPropagation(),onWheel:V=>{V.stopPropagation()}})]})]}),i.jsx("div",{className:`flex-1 overflow-y-auto custom-scrollbar p-3 space-y-3 min-h-0 bg-opacity-50 ${e==="solarized"?"bg-[#fdf6e3]":""}`,onWheel:V=>{V.stopPropagation()},children:((vr=(dr=r.settings)==null?void 0:dr.shots)==null?void 0:vr.length)>0?r.settings.shots.map((V,ft)=>{var zt,mt,Jt,fr,cr,Ne,Qt,Pr,_r;const pt=(Js==null?void 0:Js.nodeId)===r.id&&(Js==null?void 0:Js.shotId)===V.id;return i.jsxs(ic.Fragment,{children:[i.jsxs("div",{className:"relative h-2 -mt-1 -mb-1 z-10 group/insert flex items-center justify-center cursor-pointer hover:h-6 transition-all",onClick:xe=>{xe.stopPropagation();const Ke=[...r.settings.shots||[]];Ke.splice(ft,0,{id:Date.now()+Math.random(),prompt:"",description:"",model:rr(localStorage.getItem("tapnow_last_video_model")||""),duration:5,status:"draft",outputEnabled:!0,selectedImageIndex:0}),Je(r.id,{shots:Ke})},title:j(""),children:[i.jsx("div",{className:"w-full h-[2px] bg-blue-500 opacity-0 group-hover/insert:opacity-100 transition-opacity"}),i.jsx("div",{className:"absolute w-5 h-5 rounded-full bg-blue-600 text-white flex items-center justify-center opacity-0 group-hover/insert:opacity-100 transition-opacity shadow-sm scale-75 group-hover/insert:scale-100",children:i.jsx(Ro,{size:12})})]}),i.jsxs("div",{className:"flex items-stretch gap-2 w-full",children:[i.jsxs("div",{tabIndex:0,onClick:xe=>{xe.stopPropagation(),ru({nodeId:r.id,shotId:V.id}),xe.currentTarget.focus()},onPaste:xe=>H(xe,V.id),className:`relative flex-1 flex gap-3 p-3 rounded-lg border transition-all group/shot cursor-pointer outline-none focus:ring-2 focus:ring-blue-500/50 ${pt?"border-blue-500 ring-1 ring-blue-500 bg-blue-500/5 z-10":e==="dark"?"bg-zinc-900/50 border-zinc-800 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] hover:border-[#d7cfb2]":"bg-white border-zinc-200 hover:border-blue-300 hover:shadow-md"}`,children:[i.jsx("div",{className:`font-mono text-sm w-6 shrink-0 flex items-start pt-1 font-bold ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:ft+1}),i.jsx("div",{className:"flex flex-col gap-2 shrink-0 mr-2 h-full min-h-[14rem] w-52",onDragOver:xe=>{xe.preventDefault()},onDrop:xe=>ve(xe,V.id),children:(()=>{var Dr,fn;const Ke=(((Dr=r.settings)==null?void 0:Dr.mode)||"video")==="video",kt=!!((fn=sr(V.model))!=null&&fn.supportsFirstLastFrame),qt=kt&&V.useFirstLastFrame,At=V.activeInput||"first",Lr=V.useMultiRef,hr=e==="dark"?"border-zinc-800":e==="solarized"?"border-[#eee8d5]":"border-zinc-300",gr=e==="dark"?"bg-black":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-50",Fn=(mr,Tr)=>{var Bn;const Nr=(Bn=mr.target.files)==null?void 0:Bn[0];if(!Nr)return;const on=new FileReader;on.onload=an=>{ar(r.id,V.id,{[Tr]:an.target.result})},on.readAsDataURL(Nr),mr.target.value=""};if(Ke){const mr=(Tr,Nr)=>{const on=Tr==="first"?"image_url":"lastFrame",Bn=V[on],an=j(Tr==="first"?"":""),ci=Nr?"flex-1 h-full":"w-14 h-full shrink-0";return i.jsxs("div",{className:`relative rounded-lg border overflow-hidden group ${ci} ${gr} ${hr} flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 transition-all`,onClick:Ji=>{Ji.stopPropagation(),Nr||ar(r.id,V.id,{activeInput:Tr})},children:[Bn?i.jsx(nn,{src:Bn,className:`w-full h-full object-cover ${Nr?"":"opacity-60 hover:opacity-100"}`}):i.jsxs("div",{className:"flex flex-col items-center gap-1 text-zinc-500",children:[i.jsx(rl,{size:Nr?20:14}),Nr&&i.jsxs("span",{className:"text-[10px]",children:["",an]})]}),i.jsx("div",{className:"absolute top-0 left-0 bg-black/60 text-white text-[9px] px-1.5 py-0.5 rounded-br z-20 backdrop-blur-md pointer-events-none",children:an}),Bn&&i.jsx("button",{onClick:Ji=>{Ji.stopPropagation(),gn({url:Bn,type:"image"})},className:"absolute bottom-1 left-1 p-1 rounded-full bg-black/60 text-white hover:bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity z-30",title:j(""),children:i.jsx(mo,{size:10})}),Nr&&i.jsxs(i.Fragment,{children:[Bn&&i.jsx("button",{onClick:Ji=>{Ji.stopPropagation(),ar(r.id,V.id,{[on]:""})},className:"absolute top-1 right-1 p-1 rounded-full bg-black/60 text-white hover:bg-red-500 opacity-0 group-hover:opacity-100 transition-opacity z-30",children:i.jsx(ui,{size:12})}),i.jsxs("label",{className:"absolute inset-0 z-10 flex items-center justify-center cursor-pointer opacity-0 hover:opacity-100",children:[i.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Ji=>Fn(Ji,on)}),i.jsx("div",{className:"p-2 rounded-full bg-black/50 text-white",children:i.jsx(rl,{size:16})})]}),kt&&i.jsx("div",{className:"absolute bottom-1 right-1 p-1 rounded bg-black/40 hover:bg-blue-500 text-white transition-colors cursor-pointer z-30",onClick:Ji=>{Ji.stopPropagation(),ar(r.id,V.id,{useFirstLastFrame:!qt,activeInput:qt?"first":"last"})},title:"",children:i.jsx(Ox,{size:12})}),Bn&&V.image_filename&&i.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] pl-8 pr-8 py-0.5 truncate opacity-0 group-hover:opacity-100 transition-opacity z-20",title:V.image_filename,children:V.image_filename})]})]},Tr)};return qt?i.jsxs("div",{className:"flex flex-row gap-2 h-full w-full",children:[mr("first",At==="first"),mr("last",At==="last")]}):mr("first",!0)}else{const mr=V.referenceImages&&V.referenceImages.length>0?V.referenceImages:V.image_url?[V.image_url]:[],Tr=mr[0]||"";return i.jsxs("div",{className:"flex flex-col gap-2 h-full w-full",children:[i.jsxs("div",{className:`relative flex-1 rounded-lg border overflow-hidden group ${gr} ${hr} flex flex-col items-center justify-center`,children:[Tr?i.jsxs(i.Fragment,{children:[i.jsx(nn,{src:Tr,className:"w-full h-full object-cover"}),i.jsx("button",{onClick:Nr=>{Nr.stopPropagation(),gn({url:Tr,type:"image"})},className:"absolute bottom-1 left-1 p-1 rounded-full bg-black/60 text-white hover:bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity z-30",title:j(""),children:i.jsx(mo,{size:12})}),V.image_filename&&i.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[9px] px-8 py-0.5 truncate opacity-0 group-hover:opacity-100 transition-opacity z-20",title:V.image_filename,children:V.image_filename}),i.jsx("button",{onClick:Nr=>{Nr.stopPropagation(),ar(r.id,V.id,{image_url:"",image_filename:"",referenceImages:[]})},className:"absolute top-1 right-1 p-1 rounded-full bg-black/60 text-white hover:bg-red-500 opacity-0 group-hover:opacity-100 transition-opacity z-30",title:j(""),children:i.jsx(ui,{size:12})})]}):i.jsxs("div",{className:"flex flex-col items-center gap-1 text-zinc-500",children:[i.jsx(rl,{size:20}),i.jsx("span",{className:"text-[10px]",children:j("")})]}),i.jsxs("label",{className:`absolute inset-0 z-10 flex items-center justify-center cursor-pointer ${Tr?"opacity-0 hover:opacity-100":"opacity-100"}`,children:[i.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Nr=>{var Bn;const on=(Bn=Nr.target.files)==null?void 0:Bn[0];if(on){const an=new FileReader;an.onload=ci=>{ar(r.id,V.id,{image_url:ci.target.result,image_filename:on.name})},an.readAsDataURL(on)}}}),Tr&&i.jsx("div",{className:"p-2 rounded-full bg-black/50 text-white",children:i.jsx(rl,{size:16})})]}),i.jsx("div",{className:`absolute bottom-1 right-1 p-1 rounded bg-black/40 hover:bg-blue-500 text-white transition-colors cursor-pointer z-30 ${Lr?"text-blue-400 bg-blue-500/30":"text-zinc-400"}`,onClick:Nr=>{Nr.stopPropagation(),ar(r.id,V.id,{useMultiRef:!Lr})},title:j(""),children:i.jsx(ah,{size:12})})]}),Lr&&i.jsxs("div",{className:"flex gap-2 h-14 shrink-0 overflow-x-auto no-scrollbar items-center",children:[mr.slice(1).map((Nr,on)=>i.jsxs("div",{className:`relative w-12 h-14 shrink-0 rounded border overflow-hidden cursor-pointer hover:border-blue-500 transition-all ${hr} ${gr}`,onClick:Bn=>{Bn.stopPropagation();const an=[...mr],ci=on+1;[an[0],an[ci]]=[an[ci],an[0]],ar(r.id,V.id,{referenceImages:an,image_url:an[0]})},children:[i.jsx(nn,{src:Nr,className:"w-full h-full object-cover"}),i.jsx("div",{className:"absolute top-0 left-0 bg-black/50 text-white text-[8px] px-1 backdrop-blur-sm",children:on+2})]},on+1)),mr.length<5&&i.jsxs("label",{className:`w-12 h-14 shrink-0 rounded border border-dashed flex items-center justify-center cursor-pointer hover:bg-zinc-100 dark:hover:bg-zinc-800 ${hr} text-zinc-400 hover:text-blue-500 hover:border-blue-500 transition-colors`,children:[i.jsx(Ro,{size:16}),i.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:Nr=>{var Bn;const on=(Bn=Nr.target.files)==null?void 0:Bn[0];if(on){const an=new FileReader;an.onload=ci=>{ar(r.id,V.id,{referenceImages:[...mr,ci.target.result]})},an.readAsDataURL(on)}}})]})]})]})}})()}),i.jsxs("div",{className:"flex-1 min-w-0 flex flex-col gap-2",children:[i.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[i.jsxs("div",{className:"relative",children:[i.jsxs("button",{onClick:xe=>{xe.stopPropagation(),Er((Re==null?void 0:Re.nodeId)===r.id&&Re.type==="shot-model"&&Re.shotId===V.id?null:{nodeId:r.id,type:"shot-model",shotId:V.id})},onMouseDown:xe=>xe.stopPropagation(),className:`flex items-center justify-between gap-1 px-2 py-1 rounded border text-xs transition-colors min-w-[100px] ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,children:[i.jsx("span",{className:"truncate font-mono text-[10px]",children:(()=>{var xe,Ke;return(xe=r.settings)!=null&&xe.mode,((Ke=sr(V.model))==null?void 0:Ke.id)||V.model||""})()}),i.jsx(Zn,{size:10,className:"opacity-50 shrink-0"})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="shot-model"&&Re.shotId===V.id&&i.jsxs("div",{className:`absolute top-full left-0 mt-1 w-64 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:xe=>xe.stopPropagation(),onMouseLeave:()=>qn(null),children:[i.jsx("div",{className:`w-24 border-r pr-1 max-h-80 overflow-y-auto custom-scrollbar ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:(()=>{var kt;const Ke=(((kt=r.settings)==null?void 0:kt.mode)||"video")==="image";return Object.entries(ys).filter(([,qt])=>qt.models.some(At=>Ke?zs(At.type):At.type==="Video")).map(([qt,At])=>i.jsx("button",{onMouseEnter:()=>qn(qt),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${un===qt?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:At.name||qt},qt))})()}),i.jsxs("div",{className:"flex-1 pl-1 max-h-80 overflow-y-auto custom-scrollbar",children:[(()=>{var kt,qt;const Ke=(((kt=r.settings)==null?void 0:kt.mode)||"video")==="image";return un&&((qt=ys[un])==null?void 0:qt.models.filter(At=>Ke?zs(At.type):At.type==="Video").map(At=>{const Lr=At._uid||At.id,hr=rr(V.model);return i.jsxs("button",{onClick:()=>{var fn;const gr=((fn=r.settings)==null?void 0:fn.mode)||"video",Fn=Bl(Lr);ar(r.id,V.id,{model:Lr,duration:V.duration||Fn});const Dr=gr==="image"?"tapnow_last_image_model":"tapnow_last_video_model";localStorage.setItem(Dr,Lr),gr==="image"?dm(Lr):um(Lr),Er(null),qn(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${hr===Lr?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[i.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:At.id}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(Lr)}`})]},Lr)}))})(),!un&&i.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]}),(()=>{var qt;const xe=((qt=r.settings)==null?void 0:qt.mode)||"video",Ke=xe==="video"?wm(V.model):p0,kt=sr(V.model);return i.jsx("select",{value:V.ratio||(xe==="video"?"16:9":"1:1"),onChange:At=>ar(r.id,V.id,{ratio:At.target.value}),onClick:At=>At.stopPropagation(),onMouseDown:At=>At.stopPropagation(),className:`text-xs px-2 py-1 rounded border outline-none transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,children:Ke.map(At=>i.jsx("option",{value:At,children:At==="Auto"?"Auto":Qn(At,!!(kt!=null&&kt.ratioNotesEnabled),(kt==null?void 0:kt.ratioNotes)||{})},At))})})(),(()=>{var Ke;if((((Ke=r.settings)==null?void 0:Ke.mode)||"video")==="video"){const kt=km(V.model);if(!kt.length)return null;const qt=sr(V.model),At=ca(V.resolution||kt[0]||"720P"),Lr=kt[0]||"720P",hr=kt.includes(At)?At:Lr;return hr!==At&&setTimeout(()=>ar(r.id,V.id,{resolution:hr}),0),i.jsx("select",{value:hr,onChange:gr=>ar(r.id,V.id,{resolution:gr.target.value}),onClick:gr=>gr.stopPropagation(),onMouseDown:gr=>gr.stopPropagation(),className:`text-xs px-2 py-1 rounded border outline-none transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,title:j(""),children:kt.map(gr=>i.jsx("option",{value:gr,children:Qn(gr,!!(qt!=null&&qt.videoResolutionNotesEnabled),(qt==null?void 0:qt.videoResolutionNotes)||{})},gr))})}else{const kt=zm(V.model),qt=sr(V.model),At=Ju(V.resolution||"2K"),Lr=kt[0]||"2K",hr=kt.includes(At)?At:Lr;return hr!==At&&setTimeout(()=>ar(r.id,V.id,{resolution:hr}),0),i.jsx("select",{value:hr,onChange:gr=>ar(r.id,V.id,{resolution:gr.target.value}),onClick:gr=>gr.stopPropagation(),onMouseDown:gr=>gr.stopPropagation(),className:`text-xs px-2 py-1 rounded border outline-none transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,title:j(""),children:kt.map(gr=>i.jsx("option",{value:gr,children:Qn(gr,!!(qt!=null&&qt.resolutionNotesEnabled),(qt==null?void 0:qt.resolutionNotes)||{})},gr))})}})(),(((zt=r.settings)==null?void 0:zt.mode)||"video")==="video"&&(()=>{var At,Lr;const xe=V.model||((At=Ye.find(hr=>hr.type==="Video"&&hr.id==="sora-2"))==null?void 0:At.id)||((Lr=Ye.find(hr=>hr.type==="Video"))==null?void 0:Lr.id)||"",Ke=sr(xe),kt=(Ke==null?void 0:Ke.durations)||wu(xe),qt=Bl(xe);return i.jsx("select",{value:V.duration||qt,onChange:hr=>ar(r.id,V.id,{duration:hr.target.value}),onClick:hr=>hr.stopPropagation(),onMouseDown:hr=>hr.stopPropagation(),className:`text-xs px-2 py-1 rounded border outline-none transition-colors ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200 hover:border-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 hover:border-[#d7cfb2]":"bg-white border-zinc-300 text-zinc-800 hover:border-zinc-400"}`,children:kt.map(hr=>i.jsx("option",{value:hr,children:Qn(hr,!!(Ke!=null&&Ke.durationNotesEnabled),(Ke==null?void 0:Ke.durationNotes)||{})},hr))})})(),(((mt=r.settings)==null?void 0:mt.mode)||"video")==="video"&&(()=>{const xe=V.model||"",Ke=sr(xe),kt=!!(Ke!=null&&Ke.supportsFirstLastFrame),qt=!!(Ke!=null&&Ke.supportsHD);return!kt&&!qt?null:i.jsxs("div",{className:"flex items-center gap-2",children:[kt&&i.jsxs("label",{className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border cursor-pointer transition-colors ${e==="dark"?V.useFirstLastFrame?"bg-emerald-600/25 border-emerald-500 text-emerald-200":"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?V.useFirstLastFrame?"bg-[#eee8d5] border-[#d7cfb2] text-zinc-800":"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":V.useFirstLastFrame?"bg-emerald-500/20 border-emerald-300 text-emerald-700":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,onClick:At=>At.stopPropagation(),children:[i.jsx("input",{type:"checkbox",checked:!!V.useFirstLastFrame,onChange:At=>{At.stopPropagation(),ar(r.id,V.id,{useFirstLastFrame:At.target.checked})},className:"w-3 h-3 cursor-pointer",onMouseDown:At=>At.stopPropagation()}),i.jsx("span",{children:j("")})]}),qt&&i.jsxs("label",{className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border cursor-pointer transition-colors ${e==="dark"?V.isHD?"bg-blue-600/30 border-blue-500 text-blue-300":"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?V.isHD?"bg-[#eee8d5] border-[#d7cfb2] text-zinc-800":"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":V.isHD?"bg-blue-500/30 border-blue-400 text-blue-700":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,onClick:At=>At.stopPropagation(),children:[i.jsx("input",{type:"checkbox",checked:!!V.isHD,onChange:At=>{At.stopPropagation(),ar(r.id,V.id,{isHD:At.target.checked})},className:"w-3 h-3 cursor-pointer",onMouseDown:At=>At.stopPropagation()}),i.jsx("span",{children:"HD"})]})]})})()]}),(()=>{const xe=Oy(V.model,V.customParams,Ke=>ar(r.id,V.id,{customParams:Ke}));return xe?i.jsx("div",{className:"mt-2",onMouseDown:Ke=>Ke.stopPropagation(),children:xe}):null})(),i.jsx("textarea",{className:`text-sm outline-none resize-none bg-transparent transition-all ${e==="dark"?"text-zinc-200 placeholder:text-zinc-700":"text-zinc-800 placeholder:text-zinc-400"}`,value:V.description||"",placeholder:j("..."),title:V.description||"",onChange:xe=>ar(r.id,V.id,{description:xe.target.value}),onClick:xe=>{xe.stopPropagation(),pt||ru({nodeId:r.id,shotId:V.id})},onMouseDown:xe=>xe.stopPropagation(),onFocus:xe=>{xe.stopPropagation(),pt||ru({nodeId:r.id,shotId:V.id})},onInput:xe=>{pt&&(xe.currentTarget.style.height="auto",xe.currentTarget.style.height=xe.currentTarget.scrollHeight+"px")},ref:xe=>{xe&&pt&&(xe.style.height="auto",xe.style.height=xe.scrollHeight+"px")},style:{minHeight:pt?"8rem":"2.5rem",height:pt?"auto":"2.5rem",transition:"all 0.2s ease-in-out"}}),i.jsxs("div",{className:`p-2 rounded text-xs font-mono border transition-all relative ${e==="dark"?"bg-zinc-950 border-zinc-800 text-zinc-400":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-600":"bg-zinc-50 border-zinc-200 text-zinc-600"}`,style:{minHeight:pt?"8rem":"2rem",transition:"all 0.2s ease-in-out"},children:[i.jsx("textarea",{className:"w-full bg-transparent outline-none resize-none placeholder:text-opacity-50 transition-all pr-8",value:V.prompt||"",placeholder:j("..."),onChange:xe=>ar(r.id,V.id,{prompt:xe.target.value}),onClick:xe=>{xe.stopPropagation(),pt||ru({nodeId:r.id,shotId:V.id})},onMouseDown:xe=>xe.stopPropagation(),onFocus:xe=>{xe.stopPropagation(),pt||ru({nodeId:r.id,shotId:V.id})},onInput:xe=>{pt&&(xe.currentTarget.style.height="auto",xe.currentTarget.style.height=xe.currentTarget.scrollHeight+"px")},ref:xe=>{xe&&pt&&(xe.style.height="auto",xe.style.height=xe.scrollHeight+"px")},style:{minHeight:pt?"8rem":"2rem",height:pt?"auto":"2rem",transition:"all 0.2s ease-in-out"}}),(V.model==="sora-2"||V.model==="sora-2-pro")&&qr.length>0&&i.jsx("button",{onClick:xe=>{xe.stopPropagation(),Ac(!0)},className:`absolute top-2 right-2 p-1 rounded transition-colors ${e==="dark"?"text-zinc-500 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-400 hover:text-zinc-700 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(lh,{size:12})})]}),(()=>{const xe=V.model||"";if(!(xe&&(xe.includes("sora")||xe==="sora-2"||xe==="sora-2-pro"))||qr.length===0)return null;const kt=V.prompt||"",qt=`${r.id}-${V.id}`,At=yy[qt]||!1,Lr=5,hr=qr.length>Lr;return i.jsx("div",{className:"border-t border-dashed mt-1",style:{borderColor:e==="dark"?"rgba(63, 63, 70, 0.5)":"rgba(161, 161, 170, 0.5)"},children:i.jsxs("div",{className:"flex items-center justify-between py-1 px-1",children:[i.jsx("div",{className:"flex gap-2 overflow-x-auto py-2 flex-1 custom-scrollbar",children:(At?qr:qr.slice(0,Lr)).map(gr=>{const Fn=`@${gr.username}`,Dr=kt.includes(Fn);return i.jsxs("button",{onClick:fn=>{fn.stopPropagation();let mr=kt||"";Dr?mr=mr.replace(Fn,"").replace(/\s{2,}/g," ").trim():(mr=mr.trim(),mr=mr?`${mr} ${Fn} `:`${Fn} `),ar(r.id,V.id,{prompt:mr})},className:`relative shrink-0 transition-all ${Dr?"scale-110":"opacity-70 hover:opacity-100"}`,title:gr.username,children:[i.jsx("img",{src:gr.localCacheUrl||gr.profile_picture_url||"",alt:gr.username,className:`w-8 h-8 rounded-full object-cover border-2 ${Dr?"border-blue-500 ring-2 ring-blue-500":"border-transparent"}`,onError:fn=>{fn.target.style.display="none"}}),i.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 bg-black/50 rounded-full p-0.5",children:i.jsx(Vu,{size:8,className:"text-green-400"})})]},gr.id)})}),hr&&i.jsx("button",{onClick:gr=>{gr.stopPropagation(),At?af(Fn=>{const Dr={...Fn};return delete Dr[qt],Dr}):(Ac(!0),af(Fn=>({...Fn,[qt]:!0})))},className:`shrink-0 px-2 py-1 text-[10px] rounded transition-colors ml-2 ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,title:At?"":"",children:At?"":`+${qr.length-Lr}`})]})})})(),i.jsxs("div",{className:"flex gap-1 flex-wrap items-center mt-1",children:[(Jt=V.tags)==null?void 0:Jt.map((xe,Ke)=>i.jsx("span",{className:`px-1.5 py-0.5 text-[10px] rounded border ${e==="dark"?"bg-blue-900/30 text-blue-300 border-blue-800":"bg-blue-50 text-blue-600 border-blue-200"}`,children:xe},Ke)),V.camera&&i.jsxs("span",{className:`px-1.5 py-0.5 text-[10px] rounded border flex items-center gap-1 ${e==="dark"?"bg-purple-900/30 text-purple-300 border-purple-800":"bg-purple-50 text-purple-600 border-purple-200"}`,children:[i.jsx(ch,{size:8})," ",V.camera]}),V.time_range&&i.jsx("span",{className:`text-[10px] ml-auto font-mono ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:V.time_range})]})]}),i.jsxs("div",{className:`flex flex-col items-center gap-3 justify-between border-l pl-6 pr-2 shrink-0 w-16 ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[i.jsxs("div",{className:"flex flex-col items-center gap-2",children:[(V.status==="generating"||V.status==="done"||V.status==="completed"||V.status==="failed"||V.status==="error")&&i.jsxs("div",{className:`px-1.5 py-0.5 rounded text-[11px] font-mono flex items-center justify-center gap-1 ${e==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-50 text-blue-600 border border-blue-200"}`,children:[i.jsx(lw,{size:12}),i.jsx("span",{children:V.status==="generating"?ry[`${r.id}-${V.id}`]?ry[`${r.id}-${V.id}`].replace(" ",""):"0.0s":`${(V.durationCost||0).toFixed(1)}s`})]}),i.jsx("button",{onClick:()=>{confirm(j(""))&&CN(r.id,V.id)},className:`p-1.5 transition-colors ${e==="dark"?"text-zinc-600 hover:text-red-500":"text-zinc-400 hover:text-red-600"}`,title:j(""),onMouseDown:xe=>xe.stopPropagation(),children:i.jsx(Is,{size:16})})]}),(()=>{var qt;const xe=((qt=r.settings)==null?void 0:qt.mode)||"video",Ke=xe==="image"?V.output_url:V.video_url,kt=V.status==="done"&&Ke;return i.jsx("button",{onClick:At=>{At.stopPropagation(),V.status==="generating"?ar(r.id,V.id,{status:"draft",errorMsg:null}):xe==="image"?mv(r.id,V):hv(r.id,V)},className:`p-3 rounded text-white shadow-sm transition-all active:scale-95 ${V.status==="generating"?"bg-zinc-500 hover:bg-red-500":kt?"bg-blue-500 hover:bg-green-600":xe==="image"?"bg-blue-600 hover:bg-blue-500":"bg-green-600 hover:bg-green-500"}`,title:V.status==="generating"?"":kt?"":`${xe==="image"?"":""}`,onMouseDown:At=>At.stopPropagation(),children:V.status==="generating"?i.jsxs("div",{className:"relative w-4 h-4 flex items-center justify-center",children:[i.jsx(la,{size:18,className:"animate-spin absolute"}),i.jsx(gw,{size:14,fill:"currentColor",className:"opacity-0 hover:opacity-100 absolute z-10 transition-opacity"})]}):kt?i.jsx(ep,{size:18}):xe==="image"?i.jsx(Zc,{size:18}):i.jsx(fw,{size:18,fill:"currentColor"})})})(),i.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[i.jsx("button",{onClick:()=>{var kt;const xe=[...((kt=r.settings)==null?void 0:kt.shots)||[]],Ke=xe.findIndex(qt=>qt.id===V.id);Ke>0&&([xe[Ke-1],xe[Ke]]=[xe[Ke],xe[Ke-1]],Je(r.id,{shots:xe}))},disabled:ft===0,className:`p-1.5 rounded transition-colors ${ft===0?"opacity-30 cursor-not-allowed":""} ${e==="dark"?"text-zinc-500 hover:text-blue-400 hover:bg-zinc-800":"text-zinc-400 hover:text-blue-500 hover:bg-zinc-100"}`,title:j(""),onMouseDown:xe=>xe.stopPropagation(),children:i.jsx(wg,{size:16})}),i.jsx("button",{onClick:()=>{var kt;const xe=[...((kt=r.settings)==null?void 0:kt.shots)||[]],Ke=xe.findIndex(qt=>qt.id===V.id);Ke<xe.length-1&&([xe[Ke],xe[Ke+1]]=[xe[Ke+1],xe[Ke]],Je(r.id,{shots:xe}))},disabled:ft===(((cr=(fr=r.settings)==null?void 0:fr.shots)==null?void 0:cr.length)||0)-1,className:`p-1.5 rounded transition-colors ${ft===(((Qt=(Ne=r.settings)==null?void 0:Ne.shots)==null?void 0:Qt.length)||0)-1?"opacity-30 cursor-not-allowed":""} ${e==="dark"?"text-zinc-500 hover:text-blue-400 hover:bg-zinc-800":"text-zinc-400 hover:text-blue-500 hover:bg-zinc-100"}`,title:j(""),onMouseDown:xe=>xe.stopPropagation(),children:i.jsx(Zn,{size:16})})]})]})]}),((Pr=r.settings)==null?void 0:Pr.showOutputPreview)&&i.jsxs("div",{className:`shrink-0 p-2 ml-1 flex flex-col gap-2 rounded-lg border transition-all ${e==="dark"?"bg-zinc-900/50 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":"bg-white border-zinc-200"} ${V.outputEnabled?e==="dark"?"bg-blue-900/20 border-blue-800":"bg-blue-50 border-blue-300":""}`,style:{width:220},children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:`w-4 h-4 rounded border cursor-pointer flex items-center justify-center transition-colors ${V.outputEnabled?"bg-blue-500 border-blue-500 text-white":e==="dark"?"border-zinc-600 hover:border-blue-400":"border-zinc-400 hover:border-blue-400"}`,onClick:xe=>{xe.stopPropagation(),ar(r.id,V.id,{outputEnabled:!V.outputEnabled})},title:V.outputEnabled?"":"",children:V.outputEnabled&&i.jsx(Xl,{size:10})}),i.jsx("span",{className:`text-[10px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:((_r=V.output_images)==null?void 0:_r.length)>0?"":""})]}),(()=>{var Fn;const xe=V.output_images||[],Ke=V.selectedImageIndex??0,kt=((Fn=r.settings)==null?void 0:Fn.mode)||"video",qt=Dr=>e==="solarized"?Dr%2===0?"bg-[#fdf6e3]":"bg-[#eee8d5]":"";if(kt==="video")return i.jsxs("div",{className:`flex-1 min-h-[80px] rounded overflow-hidden relative group/preview cursor-pointer border ${e==="dark"?"border-zinc-800 bg-black":e==="solarized"?`border-[#eee8d5] ${qt(0)}`:"border-zinc-200 bg-zinc-50"}`,onClick:Dr=>{Dr.stopPropagation(),V.video_url&&gn({url:V.video_url,type:"video",prompt:V.prompt})},children:[V.video_url?i.jsx("video",{src:V.video_url,className:"w-full h-full object-cover",muted:!0}):i.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-30",children:i.jsx(cw,{size:16})}),V.video_url&&i.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover/preview:opacity-100 flex items-center justify-center transition-opacity",children:i.jsx(mo,{size:16,className:"text-white drop-shadow-md"})}),V.video_filename&&i.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[8px] px-1 py-0.5 truncate opacity-0 group-hover/preview:opacity-100 transition-opacity",title:V.video_filename,children:V.video_filename})]});const At=V.outputEnabled,Lr=Ke>=0,hr=Lr?Ke:0;if(xe.length>=2)if(pt){const Dr=xe[hr]||xe[0],fn=xe.slice(0,4).map((mr,Tr)=>({img:mr,idx:Tr})).filter(mr=>mr.idx!==hr);return i.jsxs("div",{className:"flex flex-col gap-1 flex-1 min-h-[100px]",children:[i.jsxs("div",{className:`relative flex-1 rounded border overflow-hidden transition-all group/main ${Lr?"border-blue-500 ring-1 ring-blue-500/50":e==="dark"?"border-zinc-700":"border-zinc-300"} ${e==="solarized"?qt(hr):""} ${At?"cursor-not-allowed opacity-80":"cursor-pointer"}`,onClick:mr=>{mr.stopPropagation(),At||ar(r.id,V.id,{selectedImageIndex:Lr?-1:hr})},onDoubleClick:mr=>{var Tr,Nr;mr.stopPropagation(),gn({url:Dr,type:"image",prompt:V.prompt,mjImages:xe,selectedMjImageIndex:hr,storyboardContext:{nodeId:r.id,shotId:V.id,shotIndex:(((Tr=r.settings)==null?void 0:Tr.shots)||[]).findIndex(on=>on.id===V.id),allShots:((Nr=r.settings)==null?void 0:Nr.shots)||[]}})},onContextMenu:mr=>{ju(mr,{url:Dr,type:"image",prompt:V.prompt,mjImages:xe,selectedMjImageIndex:hr,sourceNode:r})},children:[i.jsx(nn,{src:Dr,className:"w-full h-full object-cover"}),i.jsx("div",{className:`absolute top-0 left-0 text-[8px] px-1 py-0.5 rounded-br ${Lr?"bg-blue-500 text-white":"bg-black/50 text-white"}`,children:hr+1}),Lr&&i.jsx("div",{className:"absolute top-0 right-0 bg-blue-500 text-white p-0.5 rounded-bl",children:i.jsx(Xl,{size:10})}),At&&i.jsx("div",{className:"absolute top-1 right-1 bg-yellow-500 text-black p-0.5 rounded text-[8px]",children:""}),i.jsx("button",{onClick:mr=>{var Tr,Nr;mr.stopPropagation(),gn({url:Dr,type:"image",prompt:V.prompt,mjImages:xe,selectedMjImageIndex:hr,storyboardContext:{nodeId:r.id,shotId:V.id,shotIndex:(((Tr=r.settings)==null?void 0:Tr.shots)||[]).findIndex(on=>on.id===V.id),allShots:((Nr=r.settings)==null?void 0:Nr.shots)||[]}})},className:"absolute bottom-0 left-0 p-0.5 rounded-tr bg-black/60 text-white hover:bg-blue-500 opacity-0 group-hover/main:opacity-100 transition-opacity z-10",title:j(""),children:i.jsx(mo,{size:10})})]}),i.jsx("div",{className:"flex gap-1 h-10 shrink-0",children:fn.map(({img:mr,idx:Tr})=>i.jsxs("div",{className:`relative flex-1 rounded border overflow-hidden transition-all group/thumb ${e==="dark"?"border-zinc-700":"border-zinc-300"} ${e==="solarized"?qt(Tr):""} ${At?"cursor-not-allowed opacity-60":"cursor-pointer hover:border-blue-400"}`,onClick:Nr=>{Nr.stopPropagation(),At||ar(r.id,V.id,{selectedImageIndex:Tr})},onContextMenu:Nr=>{ju(Nr,{url:mr,type:"image",prompt:V.prompt,mjImages:xe,selectedMjImageIndex:Tr,sourceNode:r})},children:[i.jsx(nn,{src:mr,className:"w-full h-full object-cover"}),i.jsx("div",{className:"absolute top-0 left-0 bg-black/50 text-white text-[7px] px-0.5",children:Tr+1})]},Tr))})]})}else return i.jsx("div",{className:"grid grid-cols-2 gap-1 flex-1 min-h-[100px]",children:xe.slice(0,4).map((Dr,fn)=>i.jsxs("div",{className:`relative rounded border overflow-hidden transition-all group/cell ${Ke===fn?"border-blue-500 ring-1 ring-blue-500/50":e==="dark"?"border-zinc-700":"border-zinc-300"} ${e==="solarized"?qt(fn):""} ${At?"cursor-not-allowed opacity-80":"cursor-pointer hover:border-blue-400"}`,onClick:mr=>{mr.stopPropagation(),At||ar(r.id,V.id,{selectedImageIndex:Ke===fn?-1:fn})},onDoubleClick:mr=>{var Tr,Nr;mr.stopPropagation(),gn({url:Dr,type:"image",prompt:V.prompt,mjImages:xe,selectedMjImageIndex:fn,storyboardContext:{nodeId:r.id,shotId:V.id,shotIndex:(((Tr=r.settings)==null?void 0:Tr.shots)||[]).findIndex(on=>on.id===V.id),allShots:((Nr=r.settings)==null?void 0:Nr.shots)||[]}})},onContextMenu:mr=>{ju(mr,{url:Dr,type:"image",prompt:V.prompt,mjImages:xe,selectedMjImageIndex:fn,sourceNode:r})},children:[i.jsx(nn,{src:Dr,className:"w-full h-full object-cover"}),i.jsx("div",{className:`absolute top-0 left-0 text-[7px] px-0.5 rounded-br ${Ke===fn?"bg-blue-500 text-white":"bg-black/50 text-white"}`,children:fn+1}),Ke===fn&&i.jsx("div",{className:"absolute top-0 right-0 bg-blue-500 text-white p-0.5 rounded-bl",children:i.jsx(Xl,{size:8})}),i.jsx("button",{onClick:mr=>{var Tr,Nr;mr.stopPropagation(),gn({url:Dr,type:"image",prompt:V.prompt,mjImages:xe,selectedMjImageIndex:fn,storyboardContext:{nodeId:r.id,shotId:V.id,shotIndex:(((Tr=r.settings)==null?void 0:Tr.shots)||[]).findIndex(on=>on.id===V.id),allShots:((Nr=r.settings)==null?void 0:Nr.shots)||[]}})},className:"absolute bottom-0 left-0 p-0.5 rounded-tr bg-black/60 text-white hover:bg-blue-500 opacity-0 group-hover/cell:opacity-100 transition-opacity z-10",title:j(""),children:i.jsx(mo,{size:8})})]},fn))});const gr=xe[0]||V.output_url;return i.jsxs("div",{className:`flex-1 min-h-[80px] rounded overflow-hidden relative group/preview cursor-pointer border ${e==="dark"?"border-zinc-800 bg-black":e==="solarized"?`border-[#eee8d5] ${qt(0)}`:"border-zinc-200 bg-zinc-50"}`,onClick:Dr=>{Dr.stopPropagation(),gr&&gn({url:gr,type:"image",prompt:V.prompt})},onContextMenu:Dr=>{gr&&ju(Dr,{url:gr,type:"image",prompt:V.prompt,sourceNode:r})},children:[gr?i.jsx(nn,{src:gr,className:"w-full h-full object-cover"}):i.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-30",children:i.jsx(cw,{size:16})}),gr&&i.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover/preview:opacity-100 flex items-center justify-center transition-opacity",children:i.jsx(mo,{size:16,className:"text-white drop-shadow-md"})}),V.image_filename&&i.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[8px] px-1 py-0.5 truncate opacity-0 group-hover/preview:opacity-100 transition-opacity",title:V.image_filename,children:V.image_filename})]})})()]})]})]},V.id)}):i.jsxs("div",{className:`flex flex-col items-center justify-center h-40 gap-3 rounded-lg border-2 border-dashed cursor-pointer transition-colors ${e==="dark"?"border-zinc-800 text-zinc-600 hover:border-zinc-700":"border-zinc-300 text-zinc-400 hover:border-blue-300 hover:text-blue-500"}`,onClick:()=>pv(r.id),onMouseDown:V=>V.stopPropagation(),children:[i.jsx(ah,{size:32,className:"opacity-50"}),i.jsx("span",{className:"text-xs",children:j("")})]})}),i.jsx("div",{className:`p-3 border-t shrink-0 ${e==="dark"?"bg-zinc-900 border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:i.jsxs("button",{onClick:()=>pv(r.id),className:`w-full py-2 border border-dashed text-xs rounded transition-colors flex items-center justify-center gap-2 ${e==="dark"?"border-zinc-700 text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200":"border-zinc-300 text-zinc-500 hover:bg-white hover:text-blue-600 hover:border-blue-400"}`,onMouseDown:V=>V.stopPropagation(),children:[i.jsx(Ro,{size:14})," ",j("")]})})]})})})(),r.type==="image-compare"&&i.jsx("div",{className:"w-full h-full pointer-events-auto",children:i.jsx(jE,{img1:p[0],img2:p[1],theme:e,language:n})}),r.type==="preview"&&i.jsxs("div",{className:"flex flex-col h-full pointer-events-auto",children:[i.jsxs("div",{className:`flex items-center justify-between px-3 py-2 border-b text-xs font-semibold ${e==="dark"?"border-zinc-800 text-zinc-200":"border-zinc-200 text-zinc-700"}`,children:[i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx(mo,{size:13,className:"text-blue-500"}),i.jsx("span",{children:j("")})]}),i.jsx("span",{className:"text-[10px] text-zinc-500",children:r.previewType==="video"?"":""})]}),i.jsxs("div",{className:"flex-1 flex flex-col p-2 gap-2 min-h-0",children:[i.jsx("div",{className:`relative flex-1 rounded-lg overflow-hidden flex items-center justify-center min-h-0 ${e==="dark"?"bg-zinc-900":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,onDrop:H=>lN(r.id,H),onDragOver:Ol,onContextMenu:H=>{const ve=r.content||r.previewMjImages&&r.previewMjImages[0];ve&&ju(H,{url:ve,type:r.previewType||(ur(ve)?"video":"image"),sourceNode:r})},onDoubleClick:H=>{H.stopPropagation(),H.preventDefault();const ve=r.content||r.previewMjImages&&r.previewMjImages[0];ve&&gn({url:ve,type:r.previewType||(ur(ve)?"video":"image")})},children:r.content||r.previewMjImages&&r.previewMjImages.length>0?ur(r.content)||r.previewType==="video"?i.jsx(pa,{src:r.content,className:`w-full h-full object-contain ${e==="dark"?"bg-black":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,controls:!0,draggable:!1}):r.previewMjImages&&(r.previewMjImages.length===4||r.previewMjImages.length>1)?i.jsx("div",{className:`w-full h-full grid gap-0.5 p-0.5 ${r.previewMjImages.length===4?"grid-cols-2 grid-rows-2":"grid-cols-2"}`,children:r.previewMjImages.map((H,ve)=>i.jsx("div",{className:`relative w-full h-full overflow-hidden flex items-center justify-center group ${e==="dark"?"bg-black":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:i.jsx(nn,{src:H,className:"max-w-full max-h-full w-auto h-auto object-contain",alt:` ${ve+1}`,draggable:!1,onError:qe=>{console.error(` ${ve+1} `),qe.target.style.display="none"}})},ve))}):i.jsxs("div",{className:"w-full h-full relative group/preview",children:[i.jsx(nn,{src:r.content||r.previewMjImages&&r.previewMjImages[0],className:`w-full h-full object-contain ${e==="dark"?"bg-black":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,draggable:!1,onError:H=>{console.warn("[Preview] Image load error")}}),r.previewFilename&&i.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-black/60 text-white text-[10px] px-2 py-1 truncate opacity-0 group-hover/preview:opacity-100 transition-opacity backdrop-blur-sm",title:r.previewFilename,children:r.previewFilename})]}):i.jsxs("div",{className:"flex flex-col items-center justify-center text-[11px] text-zinc-500",children:[i.jsx(Zc,{className:"w-6 h-6 mb-1 text-zinc-400"}),i.jsx("span",{children:j(" AI  / AI  ")}),i.jsx("span",{children:j("")})]})}),i.jsxs("div",{className:"flex items-center justify-between gap-2 text-[11px]",children:[i.jsxs("button",{className:`flex-1 inline-flex items-center justify-center gap-1 px-2 py-1 rounded border ${e==="dark"?"border-zinc-700 text-zinc-200 hover:bg-zinc-800":"border-zinc-300 text-zinc-700 hover:bg-zinc-100"}`,onMouseDown:H=>H.stopPropagation(),onClick:async()=>{if(r.content)try{await navigator.clipboard.writeText(r.content)}catch{}},children:[i.jsx(Jl,{size:13}),j("")]}),i.jsxs("button",{className:`flex-1 inline-flex items-center justify-center gap-1 px-2 py-1 rounded border ${e==="dark"?"border-zinc-700 text-zinc-200 hover:bg-zinc-800":"border-zinc-300 text-zinc-700 hover:bg-zinc-100"}`,onMouseDown:H=>H.stopPropagation(),onClick:async()=>{if(!r.content)return;const H=Hr(r.x+r.width+100,r.y+r.height/2);let ve;if(!ur(r.content))try{const qe=await os(r.content);qe!=null&&qe.w&&(qe!=null&&qe.h)&&(ve={w:qe.w,h:qe.h})}catch{}is("input-image",H.x,H.y,null,r.content,ve)},children:[i.jsx(vg,{size:13}),j("")]}),i.jsxs("button",{className:`flex-1 inline-flex items-center justify-center gap-1 px-2 py-1 rounded border ${e==="dark"?"border-zinc-700 text-zinc-200 hover:bg-zinc-800":"border-zinc-300 text-zinc-700 hover:bg-zinc-100"}`,onMouseDown:H=>H.stopPropagation(),onClick:()=>{if(!r.content)return;const H={name:r.previewType==="video"?"Preview.mp4":"Preview.png",type:r.previewType==="video"?"video/mp4":"image/png",content:r.content,isImage:r.previewType!=="video",isVideo:r.previewType==="video",isAudio:!1,fromPreview:!0};Ui(ve=>[...ve,H]),So(!0)},children:[i.jsx(Qc,{size:13}),j("")]})]})]})]}),(r.type==="gen-image"||r.type==="gen-video")&&(()=>{var vt,Mt,Et,Lt,wt,G,me,$e,jt,lt,ir,Ht;const H=Bt.find(ae=>ae.sourceNodeId===r.id&&(ae.status==="generating"||ae.status==="completed")),ve=H&&H.status==="generating",qe=H!=null&&H.durationMs?(H.durationMs/1e3).toFixed(1):null,Ze=zy[r.id]||0;return i.jsxs("div",{className:"p-3 flex flex-col h-full pointer-events-auto",children:[(ve||qe)&&i.jsx("div",{className:`mb-2 px-2 py-1 rounded text-[10px] font-mono text-center ${e==="dark"?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"bg-blue-50 text-blue-600 border border-blue-200"}`,children:ve?i.jsxs("span",{children:[" ",Ze.toFixed(1),"s"]}):i.jsxs("span",{children:[" ",j("")," ",qe,"s"]})}),i.jsxs("div",{className:`flex items-center gap-1.5 mb-2 text-xs font-semibold shrink-0 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[r.type==="gen-image"?i.jsx(bw,{size:12,className:"text-blue-400"}):i.jsx(ch,{size:12,className:"text-purple-400"}),i.jsx("span",{children:r.type==="gen-image"?j("AI "):j("AI ")})]}),p.length>0&&i.jsxs("div",{className:`mb-2 rounded-lg border p-2 relative group/ref ${e==="dark"?"bg-zinc-900/50 border-purple-500/20":"bg-violet-50 border-violet-200"}`,children:[i.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[i.jsxs("span",{className:`text-[10px] font-medium flex items-center gap-1 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[i.jsx(pw,{size:10}),""]}),i.jsxs("span",{className:"text-[9px] font-mono text-zinc-500",children:[p.length,"/10"]})]}),i.jsx("div",{className:"flex -space-x-2 overflow-visible pb-1 items-center custom-scrollbar pl-1",children:p.map((ae,He)=>i.jsx("div",{className:"relative shrink-0 flex flex-col items-center gap-0 ",children:i.jsxs("div",{className:"relative",children:[i.jsx("span",{className:"absolute -top-1 -left-1 w-4 h-4 text-[9px] font-semibold rounded-full bg-zinc-700 text-white select-none flex items-center justify-center border border-white/70 shadow-sm leading-none pointer-events-none",style:{zIndex:30},children:He+1}),i.jsx("div",{className:`relative w-8 h-8 rounded-full border-2 thumb-stack-item cursor-pointer overflow-hidden ${e==="dark"?"border-[#18181b] bg-zinc-800":"border-white bg-zinc-200"}`,style:{zIndex:10-He},children:i.jsx(nn,{src:ae,className:"w-full h-full object-cover"})})]})},He))})]}),i.jsxs("div",{className:`rounded-lg p-3 mb-2 border focus-within:border-blue-500/30 transition-colors flex-1 flex flex-col ${e==="dark"?"bg-zinc-950/50 border-zinc-800":e==="solarized"||e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[r.type==="gen-image"&&(()=>{const ae=r==null?void 0:r.maskContent;let He=N.find(It=>It.to===r.id&&(!It.inputType||It.inputType==="default"));He||(He=N.find(It=>It.to===r.id));const Pe=He?Xt.get(He.from):null,bt=Pe&&Pe.maskContent;return ae||bt?i.jsxs("div",{className:`flex items-center gap-1.5 mb-2 px-2 py-1 rounded text-[10px] font-medium ${e==="dark"?"bg-purple-900/30 text-purple-300 border border-purple-800":"bg-purple-50 text-purple-600 border border-purple-200"}`,children:[i.jsx(k2,{size:12}),i.jsx("span",{children:j(bt?"":"")})]}):null})(),i.jsxs("div",{className:"flex items-start gap-2 mb-1 flex-1 h-full min-h-0",children:[i.jsx("textarea",{className:`flex-1 h-full bg-transparent text-xs outline-none resize-none custom-scrollbar ${e==="dark"?"text-zinc-300 placeholder-zinc-600":"text-zinc-800 placeholder-zinc-400"}`,placeholder:j("..."),value:r.type==="gen-image"?((vt=r.settings)==null?void 0:vt.prompt)||"":((Mt=r.settings)==null?void 0:Mt.videoPrompt)||"",onChange:ae=>Je(r.id,r.type==="gen-image"?{prompt:ae.target.value}:{videoPrompt:ae.target.value}),onMouseDown:ae=>ae.stopPropagation()}),r.type==="gen-video"&&(((Et=r.settings)==null?void 0:Et.model)==="sora-2"||((Lt=r.settings)==null?void 0:Lt.model)==="sora-2-pro")&&qr.length>0&&i.jsx("div",{className:"relative shrink-0",children:i.jsx("button",{onClick:ae=>{ae.stopPropagation(),Ac(!0)},className:`p-1.5 rounded transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(lh,{size:14})})})]})]}),r.type==="gen-video"&&(()=>{var $t,or;const ae=(($t=r.settings)==null?void 0:$t.model)||"",He=sr(ae),Pe=(He==null?void 0:He.modelName)||(He==null?void 0:He.id)||ae;if(!(Pe&&(Pe.includes("sora")||ae.includes("sora")))||qr.length===0)return null;const rt=((or=r.settings)==null?void 0:or.videoPrompt)||"",It=yy[r.id]||!1,nt=5,Pt=qr.length>nt;return i.jsx("div",{className:"border-t border-dashed mt-1",style:{borderColor:e==="dark"?"rgba(63, 63, 70, 0.5)":"rgba(161, 161, 170, 0.5)"},children:i.jsxs("div",{className:"flex items-center justify-between py-1 px-1",children:[i.jsx("div",{className:"flex gap-2 overflow-x-auto py-2 flex-1 custom-scrollbar",children:(It?qr:qr.slice(0,nt)).map(Ur=>{const Yr=`@${Ur.username}`,jr=rt.includes(Yr);return i.jsxs("button",{onClick:pn=>{pn.stopPropagation();let yt=rt||"";jr?yt=yt.replace(Yr,"").replace(/\s{2,}/g," ").trim():(yt=yt.trim(),yt=yt?`${yt} ${Yr} `:`${Yr} `),Je(r.id,{videoPrompt:yt})},className:`relative shrink-0 transition-all ${jr?"scale-110":"opacity-70 hover:opacity-100"}`,title:Ur.username,children:[i.jsx(nn,{src:Ur.localCacheUrl||Ur.profile_picture_url||"",alt:Ur.username,className:`w-8 h-8 rounded-full object-cover border-2 ${jr?"border-blue-500 ring-2 ring-blue-500":"border-transparent"}`,onError:pn=>{pn.target.style.display="none"}}),i.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 bg-black/50 rounded-full p-0.5",children:i.jsx(Vu,{size:8,className:"text-green-400"})})]},Ur.id)})}),Pt&&i.jsx("button",{onClick:Ur=>{Ur.stopPropagation(),It?af(Yr=>{const jr={...Yr};return delete jr[r.id],jr}):(Ac(!0),af(Yr=>({...Yr,[r.id]:!0})))},className:`shrink-0 px-2 py-1 text-[10px] rounded transition-colors ml-2 ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,title:It?"":"",children:It?"":`+${qr.length-nt}`})]})})})(),r.type==="gen-video"&&(()=>{var It,nt,Pt;const ae=sr((It=r.settings)==null?void 0:It.model),He=!!(ae!=null&&ae.supportsFirstLastFrame),Pe=!!((nt=r.settings)!=null&&nt.useFirstLastFrame||(Pt=r.settings)!=null&&Pt.veoFramesMode);if(!He||!Pe)return null;const bt=Wi(r.id,"veo_start"),rt=Wi(r.id,"veo_end");return i.jsxs("div",{className:`mb-2 rounded-lg border p-3 space-y-2 ${e==="dark"?"bg-zinc-900/40 border-emerald-500/20":"bg-emerald-50 border-emerald-200"}`,onMouseDown:$t=>$t.stopPropagation(),children:[i.jsx("div",{className:`text-[11px] font-semibold ${e==="dark"?"text-zinc-200":"text-zinc-700"}`,children:j("")}),i.jsx("div",{className:"text-[10px] text-zinc-500",children:j(" 2 ")}),i.jsxs("div",{className:"relative flex items-center gap-2",children:[i.jsx("div",{className:`input-point ${bt?"connected":""} ${Jr===r.id&&oi==="veo_start"?"active":""}`,title:j(""),onMouseDown:$t=>{$t.stopPropagation(),$t.preventDefault();const or=Hr($t.clientX,$t.clientY);xi(or),ii(r.id),ai("veo_start")},onMouseUp:$t=>zi(r.id,$t,"veo_start"),"data-input-type":"veo_start",style:{position:"absolute",top:"50%",left:"0",transform:"translateY(-50%)",width:"0.5rem",height:"0.5rem",zIndex:20,cursor:"crosshair"}}),i.jsxs("div",{className:"flex items-center justify-between flex-1 ml-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:j("")}),bt&&i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]}),bt?i.jsx("div",{className:"w-8 h-8 rounded overflow-hidden border border-zinc-700/40",children:i.jsx(nn,{src:bt,className:"w-full h-full object-cover"})}):i.jsx("span",{className:`text-[10px] ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:j("")})]})]}),i.jsxs("div",{className:"relative flex items-center gap-2",children:[i.jsx("div",{className:`input-point ${rt?"connected":""} ${Jr===r.id&&oi==="veo_end"?"active":""}`,title:j(""),onMouseDown:$t=>{$t.stopPropagation(),$t.preventDefault();const or=Hr($t.clientX,$t.clientY);xi(or),ii(r.id),ai("veo_end")},onMouseUp:$t=>zi(r.id,$t,"veo_end"),"data-input-type":"veo_end",style:{position:"absolute",top:"50%",left:"0",transform:"translateY(-50%)",width:"0.5rem",height:"0.5rem",zIndex:20,cursor:"crosshair"}}),i.jsxs("div",{className:"flex items-center justify-between flex-1 ml-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:j("")}),rt&&i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]}),rt?i.jsx("div",{className:"w-8 h-8 rounded overflow-hidden border border-zinc-700/40",children:i.jsx(nn,{src:rt,className:"w-full h-full object-cover"})}):i.jsx("span",{className:`text-[10px] ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:j("")})]})]})]})})(),r.type==="gen-image"&&(()=>{var Pe;const ae=sr((Pe=r.settings)==null?void 0:Pe.model);return ae&&(ae.id.includes("mj")||ae.provider.toLowerCase().includes("midjourney"))})()&&(()=>{var Pe,bt;const ae=Wi(r.id,"oref"),He=Wi(r.id,"sref");return i.jsxs("div",{className:"flex flex-col gap-1.5 mb-2 relative","data-mj-instructions":"true",children:[i.jsxs("div",{className:"relative flex items-center gap-1.5","data-mj-oref":"true",children:[i.jsx("div",{className:`input-point ${ae?"connected":""} ${Jr===r.id&&oi==="oref"?"active":""}`,title:j("oref"),onMouseDown:rt=>{rt.stopPropagation(),rt.preventDefault();const It=Hr(rt.clientX,rt.clientY);xi(It),ii(r.id),ai("oref")},onMouseUp:rt=>zi(r.id,rt,"oref"),"data-input-type":"oref",style:{position:"absolute",top:"50%",left:"-0.25rem",transform:"translateY(-50%)",width:"0.5rem",height:"0.5rem",marginRight:"0.25rem",zIndex:20,cursor:"crosshair"}}),i.jsxs("div",{className:"flex items-center gap-1.5 flex-1 ml-2",children:[i.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:"oref"}),ae&&i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]})]}),i.jsxs("div",{className:"relative flex items-center gap-1.5",children:[i.jsx("div",{className:"w-0.5rem h-0.5rem mr-0.25rem ml-2"}),i.jsxs("div",{className:"flex items-center gap-1.5 flex-1",children:[i.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:"ow"}),((Pe=r.settings)==null?void 0:Pe.mjOw)&&r.settings.mjOw>0&&i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]}),i.jsx("input",{type:"number",min:"1",max:"1000",placeholder:"1-1000",value:((bt=r.settings)==null?void 0:bt.mjOw)||"",onChange:rt=>{const It=parseInt(rt.target.value,10);isNaN(It)||It<1?Je(r.id,{mjOw:""}):It>1e3?Je(r.id,{mjOw:1e3}):Je(r.id,{mjOw:It})},onMouseDown:rt=>rt.stopPropagation(),className:`flex-1 px-2 py-1 rounded text-[10px] border outline-none focus:border-blue-500/50 ${e==="dark"?"bg-zinc-900/50 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`})]}),i.jsxs("div",{className:"relative flex items-center gap-1.5","data-mj-sref":"true",children:[i.jsx("div",{className:`input-point ${He?"connected":""} ${Jr===r.id&&oi==="sref"?"active":""}`,title:j("sref"),onMouseDown:rt=>{rt.stopPropagation(),rt.preventDefault();const It=Hr(rt.clientX,rt.clientY);xi(It),ii(r.id),ai("sref")},onMouseUp:rt=>zi(r.id,rt,"sref"),"data-input-type":"sref",style:{position:"absolute",top:"50%",left:"-0.25rem",transform:"translateY(-50%)",width:"0.5rem",height:"0.5rem",marginRight:"0.25rem",zIndex:20,cursor:"crosshair"}}),i.jsxs("div",{className:"flex items-center gap-1.5 flex-1 ml-2",children:[i.jsx("span",{className:`text-[10px] font-medium ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:"sref"}),He&&i.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-green-500"})]})]})]})})(),r.type==="gen-image"&&k&&i.jsxs("div",{className:`mb-2 rounded-lg border p-3 space-y-2 ${e==="dark"?"bg-zinc-900/50 border-zinc-800":"bg-white border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("button",{className:"flex items-center gap-1 text-[11px] font-semibold",onClick:()=>K2(ae=>!ae),onMouseDown:ae=>ae.stopPropagation(),children:[i.jsx("span",{className:e==="dark"?"text-zinc-200":"text-zinc-700",children:""}),i.jsx(Zl,{size:12,className:`transition-transform ${ey?"":"rotate-90"} ${e==="dark"?"text-zinc-400":"text-zinc-500"}`})]}),i.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[i.jsxs("span",{className:"text-zinc-500",children:[Xd.length," "]}),i.jsx("button",{className:`px-2 py-0.5 rounded text-[10px] border ${e==="dark"?"border-zinc-700 text-zinc-300 hover:bg-zinc-800":"border-zinc-300 text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>J2(ae=>!ae),onMouseDown:ae=>ae.stopPropagation(),children:V0?"":""})]})]}),!ey&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"max-h-36 overflow-y-auto custom-scrollbar flex flex-wrap gap-2",children:[Xd.map(ae=>i.jsxs("div",{className:`border rounded-lg px-2 py-1.5 flex items-center gap-2 text-[11px] ${e==="dark"?"border-zinc-700 bg-zinc-950/50 text-zinc-200":"border-zinc-200 bg-zinc-50 text-zinc-700"}`,children:[i.jsx("span",{className:"font-medium whitespace-nowrap",children:ae.name}),i.jsx("button",{onClick:()=>RN(r.id,ae.prompt),className:"px-2 py-0.5 rounded text-[10px] bg-blue-600 text-white hover:bg-blue-500 transition-colors",onMouseDown:He=>He.stopPropagation(),children:""}),V0&&i.jsx("button",{onClick:()=>MN(ae.id),className:`px-2 py-0.5 rounded text-[10px] border ${e==="dark"?"border-red-500/50 text-red-400 hover:bg-red-500/10":"border-red-200 text-red-600 hover:bg-red-50"}`,onMouseDown:He=>He.stopPropagation(),children:j("")})]},ae.id)),Xd.length===0&&i.jsx("div",{className:`text-[11px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:""})]}),V0&&i.jsxs("div",{className:"grid grid-cols-1 gap-1.5",children:[i.jsx("input",{type:"text",value:Zp.name,onChange:ae=>H0(He=>({...He,name:ae.target.value})),placeholder:j(""),className:`w-full px-2 py-1 text-[11px] rounded border ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 placeholder:text-zinc-600":"bg-white border-zinc-300 text-zinc-800 placeholder:text-zinc-400"}`,onMouseDown:ae=>ae.stopPropagation()}),i.jsx("textarea",{value:Zp.prompt,onChange:ae=>H0(He=>({...He,prompt:ae.target.value})),placeholder:j("..."),className:`w-full min-h-[70px] px-2 py-1 text-[11px] rounded border resize-none custom-scrollbar ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 placeholder:text-zinc-600":"bg-white border-zinc-300 text-zinc-800 placeholder:text-zinc-400"}`,onMouseDown:ae=>ae.stopPropagation()}),i.jsx("button",{onClick:TN,className:"w-full py-1.5 rounded text-[11px] font-medium bg-blue-600 hover:bg-blue-500 text-white transition-colors",onMouseDown:ae=>ae.stopPropagation(),children:""})]})]})]}),(()=>{var He,Pe;const ae=Oy((He=r.settings)==null?void 0:He.model,(Pe=r.settings)==null?void 0:Pe.customParams,bt=>Je(r.id,{customParams:bt}));return ae?i.jsx("div",{className:"mb-2",children:ae}):null})(),i.jsxs("div",{className:`mt-auto pt-2 flex items-center justify-between shrink-0 relative gap-2 border-t ${e==="dark"?"border-zinc-800/50":"border-zinc-200"}`,children:[i.jsxs("div",{className:"relative flex-1 min-w-0",children:[i.jsxs("button",{title:(G=sr((wt=r.settings)==null?void 0:wt.model))==null?void 0:G.provider,onClick:ae=>{ae.stopPropagation(),Er((Re==null?void 0:Re.type)==="model"?null:{nodeId:r.id,type:"model"})},className:`flex items-center gap-2 pl-1 pr-2 py-1 rounded text-[10px] transition-colors border w-full ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-300 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-700 border-zinc-300"}`,children:[i.jsx("span",{className:`w-2 h-2 rounded-full ${uo(rr((me=r.settings)==null?void 0:me.model))}`}),i.jsx("span",{className:"truncate font-mono",children:To(($e=r.settings)==null?void 0:$e.model)})]}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="model"&&i.jsxs("div",{className:`absolute bottom-full left-0 mb-1 w-96 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:ae=>ae.stopPropagation(),onMouseLeave:()=>qn(null),children:[i.jsx("div",{className:`w-36 border-r pr-1 max-h-64 overflow-y-auto custom-scrollbar flex flex-col justify-end ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(ys).filter(([,ae])=>ae.models.some(He=>r.type==="gen-image"?zs(He.type):He.type==="Video")).map(([ae,He])=>i.jsxs("button",{onMouseEnter:()=>qn(ae),className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left text-[10px] transition-colors ${un===ae?e==="dark"?"bg-zinc-700 text-zinc-100":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-200 text-zinc-900":e==="dark"?"hover:bg-zinc-800 text-zinc-400":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-600"}`,children:[i.jsx("span",{className:"truncate font-medium",children:He.name}),i.jsx(Zl,{size:10,className:"opacity-50"})]},ae))}),i.jsxs("div",{className:"flex-1 pl-1 max-h-64 overflow-y-auto custom-scrollbar flex flex-col justify-end",children:[un&&((jt=ys[un])==null?void 0:jt.models.filter(ae=>r.type==="gen-image"?zs(ae.type):ae.type==="Video").map(ae=>{var bt;const He=ae._uid||ae.id,Pe=rr((bt=r.settings)==null?void 0:bt.model);return i.jsxs("button",{onClick:()=>{const rt={model:He};if(ae.id==="grok-3"&&(rt.ratio="3:2",rt.duration="8s",rt.resolution="1080P"),Je(r.id,rt),r.type==="gen-image"){dm(He);try{localStorage.setItem("tapnow_last_image_model",He)}catch{}}else if(r.type==="gen-video"){um(He);try{localStorage.setItem("tapnow_last_video_model",He)}catch{}}Er(null),qn(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${Pe===He?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[i.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:ae.id}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(He)}`})]},He)})),!un&&i.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]}),r.type==="gen-image"&&(()=>{var He;const ae=sr((He=r.settings)==null?void 0:He.model);return ae&&(ae.id.includes("mj")||ae.provider.toLowerCase().includes("midjourney"))})()&&i.jsxs("div",{className:"relative flex-1 min-w-0",children:[i.jsx("button",{title:((lt=Og.find(ae=>{var He;return ae.value===((He=r.settings)==null?void 0:He.mjVersion)}))==null?void 0:lt.label)||"MJ V7",onClick:ae=>{ae.stopPropagation(),Er((Re==null?void 0:Re.type)==="mjVersion"&&Re.nodeId===r.id?null:{nodeId:r.id,type:"mjVersion"})},className:`flex items-center gap-2 pl-1 pr-2 py-1 rounded text-[10px] transition-colors border w-full ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-300 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-700 border-zinc-300"}`,children:i.jsx("span",{className:"truncate",children:((ir=Og.find(ae=>{var He;return ae.value===((He=r.settings)==null?void 0:He.mjVersion)}))==null?void 0:ir.label)||"MJ V7"})}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="mjVersion"&&i.jsx("div",{className:`absolute bottom-full left-0 mb-1 w-32 rounded-lg shadow-xl p-1 z-[60] border max-h-64 overflow-y-auto custom-scrollbar ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:ae=>ae.stopPropagation(),children:Og.map(ae=>{var He,Pe;return i.jsxs("button",{onClick:()=>{Je(r.id,{mjVersion:ae.value}),Er(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"} ${((He=r.settings)==null?void 0:He.mjVersion)===ae.value?e==="dark"?"bg-zinc-800":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100":""}`,children:[i.jsx("span",{className:"text-xs font-medium",children:ae.label}),((Pe=r.settings)==null?void 0:Pe.mjVersion)===ae.value&&i.jsx("svg",{className:"w-3 h-3 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:i.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},ae.value)})})]}),i.jsxs("div",{className:"flex gap-1 shrink-0",children:[i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:ae=>{ae.stopPropagation(),Er((Re==null?void 0:Re.type)==="ratio"&&Re.nodeId===r.id?null:{nodeId:r.id,type:"ratio"})},className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-600 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,children:(()=>{var Pe,bt;const ae=((Pe=r.settings)==null?void 0:Pe.ratio)||"Auto",He=sr((bt=r.settings)==null?void 0:bt.model);return ae==="Auto"?"Auto":Qn(ae,!!(He!=null&&He.ratioNotesEnabled),(He==null?void 0:He.ratioNotes)||{})})()}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="ratio"&&i.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-20 rounded-lg shadow-xl p-1 z-[60] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:ae=>ae.stopPropagation(),children:wm((Ht=r.settings)==null?void 0:Ht.model).map(ae=>{var bt;const He=sr((bt=r.settings)==null?void 0:bt.model),Pe=ae==="Auto"?"Auto":Qn(ae,!!(He!=null&&He.ratioNotesEnabled),(He==null?void 0:He.ratioNotes)||{});return i.jsx("button",{onClick:()=>{Je(r.id,{ratio:ae}),yj(ae);try{localStorage.setItem("tapnow_last_ratio",ae)}catch{}Er(null)},className:`w-full text-center py-1 text-[10px] rounded ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":e==="solarized"?"text-zinc-700 hover:bg-[#fdf6e3]":"text-zinc-700 hover:bg-zinc-100"}`,children:Pe},ae)})})]}),r.type==="gen-video"&&(()=>{var nt,Pt;const ae=sr((nt=r.settings)==null?void 0:nt.model),He=(ae==null?void 0:ae.id)||(ae==null?void 0:ae.modelName)||"",Pe=km(He);if(!Pe.length)return null;const bt=ca(((Pt=r.settings)==null?void 0:Pt.resolution)||Rl||"720P"),rt=Pe.find($t=>$t!=="Auto")||"720P",It=Pe.includes(bt)?bt:rt;return It!==bt&&setTimeout(()=>{Je(r.id,{resolution:It})},0),i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:$t=>{$t.stopPropagation(),Er((Re==null?void 0:Re.type)==="vres"&&Re.nodeId===r.id?null:{nodeId:r.id,type:"vres"})},className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-600 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,children:It==="Auto"?"":Qn(It,!!(ae!=null&&ae.videoResolutionNotesEnabled),(ae==null?void 0:ae.videoResolutionNotes)||{})}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="vres"&&i.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-24 rounded-lg shadow-xl p-1 z-[60] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:$t=>$t.stopPropagation(),children:Pe.map($t=>i.jsx("button",{onClick:()=>{if(Je(r.id,{resolution:$t}),$t!=="Auto"){ky($t);try{localStorage.setItem("tapnow_last_video_res",$t)}catch{}}Er(null)},className:`w-full text-center py-1 text-[10px] rounded ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":e==="solarized"?"text-zinc-700 hover:bg-[#fdf6e3]":"text-zinc-700 hover:bg-zinc-100"}`,children:$t==="Auto"?"":Qn($t,!!(ae!=null&&ae.videoResolutionNotesEnabled),(ae==null?void 0:ae.videoResolutionNotes)||{})},$t))})]})})(),r.type==="gen-image"&&(()=>{var Pe;const ae=sr((Pe=r.settings)==null?void 0:Pe.model);return!(ae&&(ae.id.includes("mj")||ae.provider.toLowerCase().includes("midjourney")))})()?i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:ae=>{ae.stopPropagation(),Er((Re==null?void 0:Re.type)==="res"&&Re.nodeId===r.id?null:{nodeId:r.id,type:"res"})},className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-600 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,children:(()=>{var Pt,$t;const ae=sr((Pt=r.settings)==null?void 0:Pt.model),He=(ae==null?void 0:ae.id)||(ae==null?void 0:ae.modelName)||"",Pe=zm(He),bt=(($t=r.settings)==null?void 0:$t.resolution)||"2K",rt=Ju(bt),It=Pe.includes(rt)?rt:Pe[0]||"2K",nt=Qn(It,!!(ae!=null&&ae.resolutionNotesEnabled),(ae==null?void 0:ae.resolutionNotes)||{});return bt!==rt&&Pe.includes(rt)?setTimeout(()=>{Je(r.id,{resolution:rt})},0):!Pe.includes(rt)&&Pe.length>0&&setTimeout(()=>{Je(r.id,{resolution:Pe[0]})},0),nt})()}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="res"&&(()=>{var bt;const ae=sr((bt=r.settings)==null?void 0:bt.model),He=(ae==null?void 0:ae.id)||(ae==null?void 0:ae.modelName)||"",Pe=zm(He);return i.jsx("div",{className:`absolute bottom-full right-0 mb-1 w-24 rounded-lg shadow-xl p-1 z-[60] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:rt=>rt.stopPropagation(),children:Pe.map(rt=>i.jsx("button",{onClick:()=>{Je(r.id,{resolution:rt}),vj(rt);try{localStorage.setItem("tapnow_last_image_res",rt)}catch{}Er(null)},className:`w-full text-center py-1 text-[10px] rounded ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":e==="solarized"?"text-zinc-700 hover:bg-[#fdf6e3]":"text-zinc-700 hover:bg-zinc-100"}`,children:Qn(rt,!!(ae!=null&&ae.resolutionNotesEnabled),(ae==null?void 0:ae.resolutionNotes)||{})},rt))})})()]}):(()=>{var It,nt,Pt,$t,or,Ur,Yr;const ae=sr((It=r.settings)==null?void 0:It.model),He=ae&&(ae.id.includes("mj")||ae.provider.toLowerCase().includes("midjourney")),Pe=wu((nt=r.settings)==null?void 0:nt.model),bt=(Pt=r.settings)==null?void 0:Pt.duration,rt=Pe.includes(bt)?bt:Pe[0]||"5s";return(!bt||!Pe.includes(bt))&&setTimeout(()=>{Je(r.id,{duration:Pe[0]||"5s"})},0),He?null:i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:jr=>{jr.stopPropagation(),Er((Re==null?void 0:Re.type)==="duration"&&Re.nodeId===r.id?null:{nodeId:r.id,type:"duration"})},className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border ${e==="dark"?"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,children:Qn(rt,!!(ae!=null&&ae.durationNotesEnabled),(ae==null?void 0:ae.durationNotes)||{})}),(Re==null?void 0:Re.nodeId)===r.id&&Re.type==="duration"&&i.jsx("div",{className:`absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-20 rounded-lg shadow-xl p-1 z-[60] border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseDown:jr=>jr.stopPropagation(),children:(Pe.length>0?Pe:["5s","10s"]).map(jr=>i.jsx("button",{onClick:()=>{Je(r.id,{duration:jr}),Er(null)},className:`w-full text-center py-1 text-[10px] rounded ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":e==="solarized"?"text-zinc-700 hover:bg-[#fdf6e3]":"text-zinc-700 hover:bg-zinc-100"}`,children:Qn(jr,!!(ae!=null&&ae.durationNotesEnabled),(ae==null?void 0:ae.durationNotes)||{})},jr))})]}),r.type==="gen-video"&&(ae==null?void 0:ae.supportsHD)&&i.jsxs("label",{className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border cursor-pointer transition-colors ${e==="dark"?($t=r.settings)!=null&&$t.isHD?"bg-blue-600/30 border-blue-500 text-blue-300":"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?(or=r.settings)!=null&&or.isHD?"bg-[#eee8d5] border-[#d7cfb2] text-zinc-800":"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":(Ur=r.settings)!=null&&Ur.isHD?"bg-blue-500/30 border-blue-400 text-blue-700":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,onClick:jr=>jr.stopPropagation(),children:[i.jsx("input",{type:"checkbox",checked:((Yr=r.settings)==null?void 0:Yr.isHD)||!1,onChange:jr=>{jr.stopPropagation(),Je(r.id,{isHD:jr.target.checked})},className:"w-3 h-3 cursor-pointer",onMouseDown:jr=>jr.stopPropagation()}),i.jsx("span",{children:"HD"})]}),r.type==="gen-video"&&(()=>{var yt,dr;const jr=!!(ae!=null&&ae.supportsFirstLastFrame),pn=!!((yt=r.settings)!=null&&yt.useFirstLastFrame||(dr=r.settings)!=null&&dr.veoFramesMode);return jr?i.jsxs("label",{className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] border cursor-pointer transition-colors ${e==="dark"?pn?"bg-emerald-600/25 border-emerald-500 text-emerald-200":"bg-zinc-800/50 hover:bg-zinc-800 text-zinc-400 border-zinc-700/50":e==="solarized"?pn?"bg-[#eee8d5] border-[#d7cfb2] text-zinc-800":"bg-[#fdf6e3] hover:bg-[#eee8d5] text-zinc-700 border-[#d7cfb2]":pn?"bg-emerald-500/20 border-emerald-300 text-emerald-700":"bg-zinc-100 hover:bg-zinc-200 text-zinc-600 border-zinc-300"}`,onClick:vr=>vr.stopPropagation(),children:[i.jsx("input",{type:"checkbox",checked:pn,onChange:vr=>{vr.stopPropagation(),Je(r.id,{useFirstLastFrame:vr.target.checked,veoFramesMode:vr.target.checked})},className:"w-3 h-3 cursor-pointer",onMouseDown:vr=>vr.stopPropagation()}),i.jsx("span",{children:j("")})]}):null})()]})})()]}),i.jsx("button",{onClick:()=>{var bt,rt,It;const ae=r.type==="gen-image"?((bt=r.settings)==null?void 0:bt.prompt)||"":((rt=r.settings)==null?void 0:rt.videoPrompt)||"",He=bu(r.id),Pe=He.length>0?He.join(" ")+(ae?" "+ae:""):ae;Dl(Pe,r.type==="gen-image"?"image":"video",p,r.id,{customParams:(It=r.settings)==null?void 0:It.customParams})},className:"bg-blue-600 hover:bg-blue-500 text-white p-1.5 rounded-md shadow-lg active:scale-95 transition-transform shrink-0",title:j(""),children:i.jsx(fw,{size:12,fill:"currentColor"})})]})]})})()]})]},r.id)},[q,en,_c,jv,Sv,Va,Vy,e,E,si,En,Jr,oi,gm,zi,Hr,eu,le,ss,Er,Ta,Sc,ii,ai,Qp,gn,ur,Je,bu,Dl,Bl,wu,_N,xu,Oj,Ol,Mm,tu]),aS=g.length>50||Li!=="off",lS=W0||jc;return i.jsxs(i.Fragment,{children:[i.jsx(K3,{visible:bc.visible,progress:bc.progress,status:bc.status,type:bc.type}),i.jsxs("div",{className:`w-full h-screen font-sans overflow-hidden select-none flex flex-col transition-colors duration-300 ${e==="dark"?"bg-[#09090b] text-white":e==="solarized"?"bg-[#fdf6e3] text-[#586e75]":"bg-zinc-100 text-zinc-900"} ${aS?"perf-mode":""} ${lS?"interacting":""}`,onClick:()=>{Ks.visible&&Fi(r=>({...r,visible:!1})),Z0&&ao(!1),Oa.visible&&tm(r=>({...r,visible:!1}))},children:[i.jsxs("div",{className:`h-12 flex items-center justify-between px-4 z-50 shrink-0 border-b transition-colors duration-300 ${e==="dark"?"bg-[#09090b] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-7 h-7 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-md flex items-center justify-center",children:i.jsx(zg,{size:16,className:"text-white"})}),i.jsx("span",{className:`font-bold text-sm tracking-wide ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,children:"Tapnow Studio"}),Ud?i.jsx("input",{ref:Fd,type:"text",value:cs,onChange:r=>gc(r.target.value),onBlur:()=>{xc(!1);try{localStorage.setItem("tapnow_project_name",cs)}catch{}},onKeyDown:r=>{if(r.key==="Enter"){xc(!1);try{localStorage.setItem("tapnow_project_name",cs)}catch{}}},className:`ml-2 px-2 py-0.5 text-xs border rounded outline-none ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,style:{minWidth:"100px",maxWidth:"200px"}}):i.jsx("span",{onClick:()=>{xc(!0),setTimeout(()=>{var r;return(r=Fd.current)==null?void 0:r.focus()},0)},className:`ml-2 text-xs cursor-pointer hover:underline ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,title:j(""),children:cs}),i.jsx("button",{onClick:av,className:`p-1 rounded-md border transition-colors ${e==="dark"?"border-zinc-700 text-zinc-300 hover:bg-zinc-800":e==="solarized"?"border-[#d7cfb2] text-[#586e75] hover:bg-[#fdf6e3]":"border-zinc-300 text-zinc-600 hover:bg-zinc-100"}`,title:j(""),children:i.jsx(Ro,{size:12})})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>{const r=["off","normal","ultra"],l=(r.indexOf(Li)+1)%r.length,u=r[l];Bd(u)},className:`flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${Li!=="off"?e==="dark"?"bg-blue-600 border-blue-500 text-white hover:bg-blue-500":e==="solarized"?"bg-blue-600 border-blue-500 text-[#fdf6e3] hover:bg-blue-500":"bg-blue-500 border-blue-400 text-white hover:bg-blue-600":e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:Li==="ultra"?"":Li==="normal"?"":"",children:[i.jsx(dh,{size:14,className:Li!=="off"?"fill-current":""}),i.jsx("span",{children:j(Li==="ultra"?"":"")})]}),i.jsxs("button",{onClick:hN,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:j("/"),children:[i.jsx(aa,{size:14}),i.jsx("span",{children:j("")})]}),i.jsx("button",{onClick:pN,className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:j(""),children:e==="light"?i.jsxs(i.Fragment,{children:[i.jsx(xw,{size:14,className:"text-amber-400"}),i.jsx("span",{children:j("")})]}):e==="solarized"?i.jsxs(i.Fragment,{children:[i.jsx(xw,{size:14,className:"text-yellow-600"}),i.jsx("span",{children:j("")})]}):i.jsxs(i.Fragment,{children:[i.jsx(ZC,{size:14,className:"text-blue-500"}),i.jsx("span",{children:j("")})]})}),i.jsx("button",{onClick:()=>s(r=>r==="zh"?"en":"zh"),className:`flex items-center gap-1 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors border ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:j(""),children:i.jsx("span",{children:j(n==="zh"?"":"")})}),i.jsx("button",{onClick:ns,disabled:R.length===0,className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors border ${R.length===0?e==="dark"?"bg-zinc-900/50 border-zinc-800 text-zinc-600 cursor-not-allowed":e==="solarized"?"bg-[#616161]/60 border-[#525252] text-[#fdf6e3]/60 cursor-not-allowed":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-400 cursor-not-allowed":"bg-zinc-50 border-zinc-200 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:j(" (Ctrl+Z)"),children:i.jsx(n3,{size:14})}),i.jsx("button",{onClick:St,disabled:L.length===0,className:`flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs font-medium transition-colors border ${L.length===0?e==="dark"?"bg-zinc-900/50 border-zinc-800 text-zinc-600 cursor-not-allowed":e==="solarized"?"bg-[#616161]/60 border-[#525252] text-[#fdf6e3]/60 cursor-not-allowed":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-400 cursor-not-allowed":"bg-zinc-50 border-zinc-200 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 hover:bg-zinc-800":e==="solarized"?"bg-[#616161] border-[#525252] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-100 border-zinc-300 text-zinc-700 hover:bg-zinc-200"}`,title:j(" (Ctrl+Shift+Z)"),children:i.jsx(s3,{size:14})}),i.jsx(yh,{variant:"ghost",onClick:av,className:e==="solarized"?"!bg-[#616161] !border !border-[#525252] !text-[#fdf6e3] hover:!bg-[#555555]":"",children:j("")}),i.jsx(yh,{variant:"secondary",icon:i3,onClick:()=>bi(!0),className:e==="solarized"?"!bg-[#616161] !border-[#525252] !text-[#fdf6e3] hover:!bg-[#555555]":"",children:j("API ")})]})]}),i.jsxs("div",{className:`flex-1 relative overflow-hidden flex transition-colors duration-300 ${e==="dark"?"bg-[#09090b]":e==="solarized"?"bg-[#fdf6e3]":"bg-zinc-100"}`,children:[i.jsxs("div",{className:`w-14 border-r flex flex-col items-center py-3 gap-3 z-40 shrink-0 transition-colors duration-300 ${e==="dark"?"bg-[#09090b] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,children:[i.jsx("button",{onClick:LN,className:`p-2.5 rounded-lg transition-all mb-2 ${e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-800 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(e3,{size:18})}),[{id:"select",icon:QC},{id:"history",icon:uw},{id:"characters",icon:lh}].map(r=>i.jsx("button",{onClick:()=>{gj(r.id),r.id==="history"&&rf(!Pc),r.id==="characters"&&Ac(!my)},className:`p-2.5 rounded-lg transition-all ${mj===r.id?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#616161] text-[#fdf6e3] hover:bg-[#555555]":"bg-zinc-200 text-zinc-900":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-800"}`,children:i.jsx(r.icon,{size:18})},r.id)),i.jsx("div",{className:"flex-1"}),i.jsx("button",{onClick:()=>So(!Yd),className:`p-2.5 rounded-lg transition-all mb-2 ${Yd?e==="solarized"?"bg-[#616161] text-[#fdf6e3] hover:bg-[#555555]":"bg-blue-600 text-white":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-500 hover:text-zinc-800"}`,title:j("AI "),children:i.jsx(Qc,{size:18})}),i.jsx("button",{onClick:Am,className:`p-2.5 rounded-lg transition-all ${e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-800 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(hw,{size:18})}),i.jsx("button",{onClick:vN,className:`p-2.5 rounded-lg transition-all mb-2 ${e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-800 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(rl,{size:18})}),i.jsx("button",{onClick:bN,className:`p-2.5 rounded-lg transition-all mb-2 ${e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-800 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(aa,{size:18})})]}),Pc&&i.jsxs("div",{className:`w-72 z-30 flex flex-col animate-in slide-in-from-left border-r transition-colors duration-300 ${e==="dark"?"bg-[#121214] border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[i.jsxs("div",{className:`p-3 border-b flex justify-between items-center ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsxs("h3",{className:`font-bold text-xs leading-tight ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[i.jsx("span",{className:"block",children:j("")}),i.jsx("span",{className:"block",children:j("")})]}),qd.active&&i.jsxs("div",{className:"flex items-center gap-1.5",children:[i.jsx("div",{className:"w-16 h-1.5 bg-zinc-700 rounded-full overflow-hidden",children:i.jsx("div",{className:"h-full bg-blue-500 transition-all duration-200",style:{width:`${qd.current/qd.total*100}%`}})}),i.jsxs("span",{className:"text-[9px] text-zinc-500 font-mono",children:[qd.current,"/",qd.total]})]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:()=>{const r=["off","normal","ultra"],l=(r.indexOf(xn)+1)%r.length;Vp(r[l])},className:`p-1.5 rounded transition-colors flex items-center gap-1 ${xn==="ultra"?e==="dark"?"text-orange-400 bg-orange-500/20 hover:bg-orange-500/30":"text-orange-600 bg-orange-100 hover:bg-orange-200":xn==="normal"?e==="dark"?"text-green-400 bg-green-500/20 hover:bg-green-500/30":"text-green-600 bg-green-100 hover:bg-green-200":e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:xn==="ultra"?"":xn==="normal"?"":"",children:i.jsx(dh,{size:14})}),i.jsx("button",{onClick:()=>uj(r=>!r),className:`p-1.5 rounded transition-colors ${fy?e==="dark"?"text-blue-400 bg-blue-500/20 hover:bg-blue-500/30":"text-blue-600 bg-blue-100 hover:bg-blue-200":e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(rl,{size:14})}),i.jsx("button",{onClick:()=>pj(r=>!r),className:`p-1.5 rounded transition-colors ${hy?e==="dark"?"text-blue-400 bg-blue-500/20 hover:bg-blue-500/30":"text-blue-600 bg-blue-100 hover:bg-blue-200":e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(zg,{size:14})}),i.jsxs("button",{onClick:()=>{const o=Bt.filter(l=>l.status==="completed");Ws.size>0?Gd(new Set):Gd(new Set(o.map(l=>l.id)))},className:`p-1.5 rounded transition-colors flex items-center gap-1 ${Ws.size>0?e==="dark"?"text-blue-400 bg-blue-500/20 hover:bg-blue-500/30":"text-blue-600 bg-blue-100 hover:bg-blue-200":e==="dark"?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:Ws.size>0?`${j("")} (${Ws.size})`:j(""),children:[Ws.size>0?i.jsx(ep,{size:14}):i.jsx(KC,{size:14}),Ws.size>0&&i.jsx("span",{className:"text-[9px] font-bold",children:Ws.size})]}),i.jsx("button",{onClick:()=>lf(!0),className:`p-1.5 rounded transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(ah,{size:14})}),i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:()=>{if(Ws.size>0){const r=[...Ws].map(o=>Bt.find(l=>l.id===o)).filter(Boolean);Rm(r)}else Er((Re==null?void 0:Re.type)==="batch-download"?null:{type:"batch-download"})},className:`p-1.5 rounded transition-colors ${Ws.size>0?"text-blue-400 bg-blue-500/20":e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,title:Ws.size>0?`${j("")} (${Ws.size})`:j(""),children:i.jsx(aa,{size:14})}),(Re==null?void 0:Re.type)==="batch-download"&&Ws.size===0&&i.jsxs("div",{className:`absolute right-0 top-full mt-1 w-40 rounded-lg shadow-xl py-1 z-50 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseLeave:()=>Er(null),children:[i.jsxs("button",{onClick:()=>{Er(null);const r=Bt.filter(o=>(o.startTime||0)>=_l);Rm(r)},className:`w-full text-left px-3 py-2 text-xs transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,children:[j("")," (",Bt.filter(r=>(r.startTime||0)>=_l).length,")"]}),i.jsxs("button",{onClick:()=>{Er(null),Rm(Bt)},className:`w-full text-left px-3 py-2 text-xs transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,children:[j("")," (",Bt.length,")"]})]})]}),i.jsx("button",{onClick:()=>rf(!1),children:i.jsx(ui,{size:12,className:e==="dark"?"text-zinc-500":"text-zinc-400"})})]})]}),Vs&&ms&&i.jsx("div",{className:`w-full border-b ${e==="dark"?"border-zinc-800":e==="solarized"?"border-[#d7cfb2]":"border-zinc-200"}`,children:i.jsxs("div",{className:`flex items-center justify-between gap-2 text-[10px] px-3 py-1.5 ${Hs?e==="dark"?"bg-emerald-500/10 text-emerald-200":"bg-emerald-50 text-emerald-700":e==="dark"?"bg-red-500/10 text-red-200":"bg-red-50 text-red-600"}`,children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${Hs?"bg-green-500":"bg-red-500"}`}),i.jsx("span",{children:j(Hs?" - ":"")})]}),i.jsx("button",{onClick:()=>{Hd(!1),yn(!1)},className:`p-0.5 rounded ${e==="dark"?"text-zinc-300 hover:text-white hover:bg-zinc-800/60":"text-zinc-400 hover:text-zinc-600 hover:bg-zinc-200"}`,title:j(""),children:i.jsx(ui,{size:10})})]})}),i.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 space-y-3",children:[hy&&i.jsxs("div",{className:`rounded-lg border p-3 space-y-3 ${e==="dark"?"bg-zinc-900/60 border-zinc-800":"bg-white border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsx("span",{className:`text-xs font-semibold ${e==="dark"?"text-zinc-200":"text-zinc-700"}`,children:j("")}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:()=>Ut("pipeline"),className:`text-[10px] px-2 py-1 rounded ${Me==="pipeline"?e==="dark"?"bg-blue-600/30 text-blue-300":"bg-blue-100 text-blue-600":e==="dark"?"bg-zinc-800 text-zinc-400 hover:text-zinc-200":"bg-zinc-100 text-zinc-500 hover:text-zinc-700"}`,children:j("")}),i.jsx("button",{onClick:()=>Ut("parallel"),className:`text-[10px] px-2 py-1 rounded ${Me==="parallel"?e==="dark"?"bg-blue-600/30 text-blue-300":"bg-blue-100 text-blue-600":e==="dark"?"bg-zinc-800 text-zinc-400 hover:text-zinc-200":"bg-zinc-100 text-zinc-500 hover:text-zinc-700"}`,children:j("")})]})]}),(()=>{const r=new Map;ot.forEach(p=>{r.set(p.id,{...p,queued:[],running:[]})});const o=p=>{var b;const f=Xt.get(p.nodeId),m=((b=f==null?void 0:f.settings)==null?void 0:b.projectTitle)||"",y=p.batchId||`legacy-${p.nodeId}`;return r.has(y)||r.set(y,{id:y,nodeId:p.nodeId,projectTitle:m,total:0,concurrency:p.batchConcurrency||1,createdAt:Date.now(),mode:p.mode,taskIndex:p.taskIndex||0,shotIds:[],queued:[],running:[]}),r.get(y)};he.forEach(p=>{const f=p.batchId&&r.has(p.batchId)?r.get(p.batchId):o(p);f&&(Array.isArray(f.queued)||(f.queued=[]),f.queued.push(p))}),Kr.forEach(p=>{const f=p.batchId&&r.has(p.batchId)?r.get(p.batchId):o(p);f&&(Array.isArray(f.running)||(f.running=[]),f.running.push(p))});const l=[...r.values()].filter(p=>p.queued.length>0||p.running.length>0).sort((p,f)=>(f.createdAt||0)-(p.createdAt||0)),u=(p,f)=>{var b,w;const m=Xt.get(p),y=(w=(b=m==null?void 0:m.settings)==null?void 0:b.shots)==null?void 0:w.find(v=>v.id===f);return((y==null?void 0:y.description)||(y==null?void 0:y.prompt)||"").trim()};return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`text-[10px] ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:[" ",Kr.length,"   ",he.length]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>{he.length!==0&&confirm(j(""))&&We(!1)},className:`text-[10px] px-2 py-1 rounded ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:j("")}),i.jsx("button",{onClick:()=>{Kr.length===0&&he.length===0||confirm(j(""))&&We(!0)},className:`text-[10px] px-2 py-1 rounded ${e==="dark"?"bg-red-900/40 text-red-300 hover:bg-red-900/60":"bg-red-50 text-red-600 hover:bg-red-100"}`,children:j("")})]}),l.length===0?i.jsx("div",{className:`text-xs text-center py-4 ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:""}):i.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto custom-scrollbar pr-1",children:l.map(p=>{const f=Math.max(1,p.concurrency||1),m=p.total||p.queued.length+p.running.length,y=Math.ceil(m/f),b=Math.ceil(p.queued.length/f),w=p.taskIndex?`Task ${p.taskIndex}`:"Task",v=[...p.running.map(z=>({...z,status:"running"})),...p.queued.map(z=>({...z,status:"queued"}))].sort((z,k)=>(z.batchOrder??0)-(k.batchOrder??0));return i.jsxs("div",{className:`rounded-lg border p-2 ${e==="dark"?"border-zinc-800 bg-zinc-900/60":"border-zinc-200 bg-zinc-50"}`,children:[i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsxs("div",{children:[i.jsxs("div",{className:`text-[11px] font-semibold ${e==="dark"?"text-zinc-200":"text-zinc-700"}`,children:["NODE - ",p.projectTitle,"  ",w]}),i.jsxs("div",{className:"text-[10px] mt-0.5 text-zinc-500",children:[m,"   ",f,"   ",y,"  ",b," "]})]}),p.queued.length>0&&i.jsx("button",{onClick:()=>{confirm(j(""))&&br(p.id)},className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-red-300":"text-zinc-400 hover:text-red-500"}`,title:j(""),children:i.jsx(Is,{size:12})})]}),i.jsx("div",{className:"mt-2 space-y-1",children:v.map((z,k)=>{const T=Math.floor((z.batchOrder??0)/f)+1,I=p.taskIndex?`T${p.taskIndex}B${T}`:`B${T}`,F=u(z.nodeId,z.shotId),B=z.status==="running"?"":"";return i.jsxs("div",{className:`text-[10px] flex items-center justify-between gap-2 ${e==="dark"?"text-zinc-300":"text-zinc-600"}`,children:[i.jsxs("span",{className:"truncate",children:[I,"  ",F||`${z.sceneIndex||""}`]}),i.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[i.jsx("span",{className:z.status==="running"?"text-green-500":"text-blue-400",children:B}),i.jsx("button",{onClick:()=>{z.status==="running"?confirm(j(""))&&Qr(z.nodeId,z.shotId):confirm(j(""))&&Ir(z.nodeId,z.shotId)},className:`p-0.5 rounded ${e==="dark"?"text-zinc-500 hover:text-red-300":"text-zinc-400 hover:text-red-500"}`,title:z.status==="running"?"":"",children:i.jsx(Is,{size:10})})]})]},`${p.id}-${z.nodeId}-${z.shotId}-${k}`)})})]},p.id)})})]})})()]}),fy&&i.jsx("div",{className:`rounded-lg border p-3 space-y-3 ${e==="dark"?"bg-zinc-900/60 border-zinc-800":"bg-white border-zinc-200"}`,children:i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:j("")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"text",value:Br.imageSavePath||"",onChange:r=>{const o=Cs(r.target.value);qo(l=>({...l,imageSavePath:o}))},onBlur:r=>Fc({image_save_path:Cs(r.target.value||"")}),onKeyDown:r=>{r.key==="Enter"&&r.currentTarget.blur()},placeholder:j(" history"),className:`flex-1 text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`}),i.jsx("button",{onClick:()=>Ey("imageSavePath","image_save_path"),className:`px-2 py-1.5 text-[10px] rounded border ${e==="dark"?"bg-zinc-800 text-zinc-300 border-zinc-700 hover:bg-zinc-700":"bg-zinc-100 text-zinc-700 border-zinc-300 hover:bg-zinc-200"}`,children:j("")})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-[10px] block mb-1 text-zinc-500",children:j("")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"text",value:Br.videoSavePath||"",onChange:r=>{const o=Cs(r.target.value);qo(l=>({...l,videoSavePath:o}))},onBlur:r=>Fc({video_save_path:Cs(r.target.value||"")}),onKeyDown:r=>{r.key==="Enter"&&r.currentTarget.blur()},placeholder:j(" history"),className:`flex-1 text-xs border rounded px-2 py-1.5 outline-none focus:border-blue-500 ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`}),i.jsx("button",{onClick:()=>Ey("videoSavePath","video_save_path"),className:`px-2 py-1.5 text-[10px] rounded border ${e==="dark"?"bg-zinc-800 text-zinc-300 border-zinc-700 hover:bg-zinc-700":"bg-zinc-100 text-zinc-700 border-zinc-300 hover:bg-zinc-200"}`,children:j("")})]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-[10px] text-zinc-500",children:j("")}),i.jsx("div",{className:"text-[9px] text-zinc-500 mt-0.5",children:j("")})]}),i.jsx("button",{className:`w-10 h-5 rounded-full relative transition-colors ${Vs?"bg-green-600":e==="solarized"?"bg-zinc-300":"bg-zinc-600"}`,onClick:()=>Hd(r=>!r),children:i.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${Vs?"left-6":"left-1"}`})})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-[10px] text-zinc-500",children:j("")}),i.jsx("div",{className:"text-[9px] text-zinc-500 mt-0.5",children:j("")})]}),i.jsx("button",{className:`w-10 h-5 rounded-full relative transition-colors ${Os?"bg-green-600":e==="solarized"?"bg-zinc-300":"bg-zinc-600"}`,onClick:()=>nr(r=>!r),children:i.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${Os?"left-6":"left-1"}`})})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-[10px] text-zinc-500",children:j("PNG  JPG")}),i.jsx("button",{className:`w-10 h-5 rounded-full relative transition-colors ${Br.convertPngToJpg?"bg-green-600":e==="solarized"?"bg-zinc-300":"bg-zinc-600"} ${Br.pilAvailable?"":"opacity-50 cursor-not-allowed"}`,onClick:()=>{if(!Br.pilAvailable)return;const r=!Br.convertPngToJpg;qo(o=>({...o,convertPngToJpg:r})),Fc({convert_png_to_jpg:r},{silent:!0})},disabled:!Br.pilAvailable,children:i.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${Br.convertPngToJpg?"left-6":"left-1"}`})})]}),!Br.pilAvailable&&i.jsx("div",{className:"text-[9px] text-amber-400",children:j("PIL PNG  JPG ")}),i.jsx("button",{className:`w-full py-2 rounded text-[10px] font-medium transition-colors ${e==="dark"?"bg-orange-600/30 text-orange-200 hover:bg-orange-600/40":"bg-orange-100 text-orange-600 hover:bg-orange-200"}`,onClick:Ba,children:j("")}),i.jsx("div",{className:"text-[9px] text-zinc-500",children:j("")}),i.jsx("button",{className:`w-full py-2 rounded text-[10px] font-medium transition-colors ${e==="dark"?"bg-blue-600/20 text-blue-200 hover:bg-blue-600/30":"bg-blue-50 text-blue-600 hover:bg-blue-100"}`,onClick:_j,children:j("")})]})}),(()=>{const r=Bt.filter(l=>(l.startTime||0)>=_l),o=Bt.filter(l=>(l.startTime||0)<_l);return i.jsxs(i.Fragment,{children:[r.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center gap-2 text-[10px] ${e==="dark"?"text-blue-400":"text-blue-600"}`,children:[i.jsx("div",{className:"flex-1 h-px bg-blue-500/30"}),i.jsxs("span",{className:"px-2 py-0.5 rounded-full bg-blue-500/10 font-medium",children:[j("")," (",r.length,")"]}),i.jsx("div",{className:"flex-1 h-px bg-blue-500/30"})]}),r.map(l=>i.jsx(Aw,{item:l,theme:e,language:n,lightboxItem:Aa,performanceMode:xn,providers:Ft,defaultProviders:tp,localCacheActive:Kt,historyLocalCacheMap:vn,onCacheMissing:Cy,onDelete:Jy,getHistoryMeta:Ry,resolveHistoryUrl:Ar,isLocalCacheUrlAvailable:gs,isSelected:Ws.has(l.id),onSelect:u=>{Gd(p=>{const f=new Set(p);return f.has(u)?f.delete(u):f.add(u),f})},onClick:()=>{Co(l.id);const u=mm(l),p=u?u.length-1:0,f=l.selectedMjImageIndex!==void 0?l.selectedMjImageIndex:0,m=Math.max(0,Math.min(f,p)),y=u?u[m]:null,b=y?Ar(l,y):Ar(l);b&&gn({...l,url:b,selectedMjImageIndex:m,storyboardContext:null})},onContextMenu:u=>Mf(u,l),onImageClick:(u,p,f,m)=>{u.stopPropagation(),Co(p.id),Rt(w=>w.map(v=>v.id===p.id?{...v,url:f,selectedMjImageIndex:m}:v));const y=Ar(p,f),b={...p,url:y,selectedMjImageIndex:m,storyboardContext:null};gn(b)},onImageContextMenu:(u,p,f,m)=>Mf(u,p,f,m),onRebuildThumbnail:hf,onRefresh:u=>{u.apiConfig&&(Rt(p=>p.map(f=>f.id===u.id?{...f,status:"generating",errorMsg:null,progress:5}:f)),u.modelName.includes("veo")?Ya(u.remoteTaskId,u.id,u.apiConfig.baseUrl,u.apiConfig.apiKey,u.width,u.height):Ll(u.remoteTaskId,u.id,u.apiConfig.baseUrl,u.apiConfig.apiKey,u.width,u.height,u.apiConfig.modelId||""))},Loader2:la,Trash2:Is,RefreshCw:hp},l.id))]}),o.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:`flex items-center gap-2 text-[10px] ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:[i.jsx("div",{className:`flex-1 h-px ${e==="dark"?"bg-zinc-700":"bg-zinc-300"}`}),i.jsxs("span",{className:"px-2 py-0.5 font-medium",children:[j("")," (",o.length,")"]}),i.jsx("div",{className:`flex-1 h-px ${e==="dark"?"bg-zinc-700":"bg-zinc-300"}`})]}),o.map(l=>i.jsx(Aw,{item:l,theme:e,language:n,lightboxItem:Aa,performanceMode:xn,providers:Ft,defaultProviders:tp,localCacheActive:Kt,historyLocalCacheMap:vn,onCacheMissing:Cy,onDelete:Jy,getHistoryMeta:Ry,resolveHistoryUrl:Ar,isLocalCacheUrlAvailable:gs,isSelected:Ws.has(l.id),onSelect:u=>{Gd(p=>{const f=new Set(p);return f.has(u)?f.delete(u):f.add(u),f})},onClick:()=>{Co(l.id);const u=mm(l),p=u?u.length-1:0,f=l.selectedMjImageIndex!==void 0?l.selectedMjImageIndex:0,m=Math.max(0,Math.min(f,p)),y=u?u[m]:null,b=y?Ar(l,y):Ar(l);b&&gn({...l,url:b,selectedMjImageIndex:m,storyboardContext:null})},onContextMenu:u=>Mf(u,l),onImageClick:(u,p,f,m)=>{u.stopPropagation(),Co(p.id),Rt(w=>w.map(v=>v.id===p.id?{...v,url:f,selectedMjImageIndex:m}:v));const y=Ar(p,f),b={...p,url:y,selectedMjImageIndex:m,storyboardContext:null};gn(b)},onImageContextMenu:(u,p,f,m)=>Mf(u,p,f,m),onRebuildThumbnail:hf,onRefresh:u=>{u.apiConfig&&(Rt(p=>p.map(f=>f.id===u.id?{...f,status:"generating",errorMsg:null,progress:5}:f)),u.modelName.includes("veo")?Ya(u.remoteTaskId,u.id,u.apiConfig.baseUrl,u.apiConfig.apiKey,u.width,u.height):Ll(u.remoteTaskId,u.id,u.apiConfig.baseUrl,u.apiConfig.apiKey,u.width,u.height,u.apiConfig.modelId||""))},Loader2:la,Trash2:Is,RefreshCw:hp},l.id))]})]})})()]})]}),my&&i.jsxs("div",{className:`w-72 z-30 flex flex-col animate-in slide-in-from-left border-r transition-colors duration-300 ${e==="dark"?"bg-[#121214] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[i.jsxs("div",{className:`p-3 border-b flex justify-between items-center ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[i.jsx("h3",{className:`font-bold text-xs ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:j("Sora ")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>{const r=Ye.find(o=>o.type==="Video"&&(o.id==="sora-2"||o.id==="sora-2-pro"));if(r){const o=(r.url||Ps).replace(/\/+$/,"");ou(`${o}/sora/v1/characters`)}else{const o=Ps.replace(/\/+$/,"");ou(`${o}/sora/v1/characters`)}su(!0)},className:`px-2 py-1 text-[10px] rounded transition-colors ${e==="dark"?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-500 hover:bg-blue-600 text-white"}`,children:j("")}),i.jsx("button",{onClick:()=>Ac(!1),children:i.jsx(ui,{size:12,className:e==="dark"?"text-zinc-500":"text-zinc-400"})})]})]}),i.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3",children:qr.length===0?i.jsx("div",{className:`text-center py-8 text-sm ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:'""'}):i.jsx("div",{className:"grid grid-cols-2 gap-3",children:qr.map(r=>i.jsxs("div",{className:`group rounded-lg overflow-hidden border cursor-pointer hover:border-blue-500/50 transition-colors ${e==="dark"?"bg-zinc-900 border-zinc-800":"bg-white border-zinc-200"}`,onClick:()=>{const o=` @${r.username} `,l=document.activeElement;if(l&&(l.tagName==="TEXTAREA"||l.tagName==="INPUT")){const u=l,p=u.selectionStart||0,f=u.selectionEnd||0,m=u.value,y=m.slice(0,p)+o+m.slice(f);u.value=y;const b=p+o.length;u.setSelectionRange(b,b),u.dispatchEvent(new Event("input",{bubbles:!0})),u.focus()}else navigator.clipboard.writeText(o.trim()).then(()=>{alert(`: ${o.trim()}`)})},children:[i.jsxs("div",{className:"aspect-square bg-zinc-800 relative group/char",children:[r.localCacheUrl||r.profile_picture_url?i.jsx(nn,{src:r.localCacheUrl||r.profile_picture_url,alt:r.username,className:"w-full h-full object-cover",onError:o=>{o.target.style.display="none"}}):i.jsx("div",{className:"w-full h-full flex items-center justify-center text-zinc-500",children:i.jsx(_g,{size:24})}),i.jsx("button",{onClick:o=>{if(o.stopPropagation(),confirm(` "${r.username}" `)){const l=qr.filter(u=>u.id!==r.id);$l(l);try{localStorage.setItem("tapnow_characters",JSON.stringify(l))}catch(u){console.error(":",u)}}},className:"absolute top-1 right-1 p-1.5 rounded-full bg-black/50 text-white opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 z-10",title:j(""),children:i.jsx(Is,{size:12})})]}),i.jsx("div",{className:"p-2 relative",children:i.jsxs("p",{className:`text-xs truncate flex items-center gap-1 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:[r.username,i.jsx(Vu,{size:12,className:"text-green-500 shrink-0",title:j("Sora 2 ")})]})})]},r.id))})})]}),fj&&i.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-center justify-center",onClick:()=>su(!1),children:i.jsxs("div",{className:`w-[500px] max-h-[90vh] overflow-y-auto rounded-lg shadow-2xl flex flex-col ${e==="dark"?"bg-[#121214] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"} border`,onClick:r=>r.stopPropagation(),children:[i.jsxs("div",{className:`p-4 border-b flex justify-between items-center ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[i.jsx("h3",{className:`font-bold text-sm ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:j("")}),i.jsx("button",{onClick:()=>su(!1),children:i.jsx(ui,{size:16,className:e==="dark"?"text-zinc-500":"text-zinc-400"})})]}),i.jsxs("div",{className:"p-4 space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:`block text-xs mb-2 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:""}),i.jsxs("div",{className:"flex gap-2 mb-2",children:[i.jsx("button",{onClick:()=>{nf("url"),of("")},className:`px-3 py-1.5 text-xs rounded transition-colors ${Qo==="url"?e==="dark"?"bg-blue-600 text-white":"bg-blue-500 text-white":e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:" URL"}),i.jsx("button",{onClick:()=>{nf("history"),sf(""),au(null)},className:`px-3 py-1.5 text-xs rounded transition-colors ${Qo==="history"?e==="dark"?"bg-blue-600 text-white":"bg-blue-500 text-white":e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-600 hover:bg-zinc-200"}`,children:""})]}),Qo==="url"?i.jsx("input",{type:"text",value:Tc,onChange:r=>sf(r.target.value),placeholder:j(" URL..."),className:`w-full px-3 py-2 text-xs rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`}):i.jsxs("select",{value:Mc,onChange:r=>{const o=r.target.value;if(of(o),o){const l=co.get(o),u=Ar(l);u&&(nf("url"),sf(u),of(""))}},className:`w-full px-3 py-2 text-xs rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`,children:[i.jsx("option",{value:"",children:j("...")}),Bt.filter(r=>r.type==="video"&&r.status==="completed"&&(r.url||r.localCacheUrl||r.originalUrl)).map(r=>{var o;return i.jsxs("option",{value:r.id,children:[((o=r.prompt)==null?void 0:o.slice(0,50))||"Untitled"," - ",r.time]},r.id)})]}),(()=>{let r=null;if(Qo==="url"&&Tc.trim())r=Tc.trim();else if(Qo==="history"&&Mc){const o=co.get(Mc),l=Ar(o);l&&(r=l)}return r?i.jsxs("div",{className:"mt-2 mb-2",children:[i.jsx("video",{controls:!0,crossOrigin:"anonymous",className:"w-full h-40 object-contain bg-black rounded-lg",src:r,onError:o=>{console.error(":",r,o),au("")},onLoadStart:()=>{au(null)},onLoadedData:()=>{au(null)}},r),by&&i.jsx("div",{className:"text-red-500 text-xs mt-1 text-center",children:by})]}):null})()]}),i.jsxs("div",{children:[i.jsx("label",{className:`block text-xs mb-2 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:j(" 1-3 ")}),i.jsxs("div",{className:"flex gap-2 items-center",children:[i.jsx("input",{type:"number",min:"0",step:"0.1",value:Rc,onChange:r=>gy(parseFloat(r.target.value)||0),className:`w-20 px-2 py-1.5 text-xs rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`}),i.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:""}),i.jsx("input",{type:"number",min:"0",step:"0.1",value:Oc,onChange:r=>xy(parseFloat(r.target.value)||0),className:`w-20 px-2 py-1.5 text-xs rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800":"bg-white border-zinc-300 text-zinc-800"}`}),i.jsxs("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:[": ",(Oc-Rc).toFixed(1),"s"]})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:`block text-xs mb-2 ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:"API  (API Endpoint)"}),i.jsx("input",{type:"text",value:iu,onChange:r=>ou(r.target.value),placeholder:j(": https://your-domain.com/sora/v1/characters"),className:`w-full px-3 py-2 text-xs rounded border outline-none font-mono ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-200 placeholder-zinc-600":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5] text-zinc-800 placeholder-zinc-400":"bg-white border-zinc-300 text-zinc-800 placeholder-zinc-400"}`,onFocus:r=>{if(!r.target.value){const o=Ye.find(u=>u.type==="Video"&&(u.id==="sora-2"||u.id==="sora-2-pro")),l=o?(o.url||Ps).replace(/\/+$/,""):Ps.replace(/\/+$/,"");ou(`${l}/sora/v1/characters`)}}}),i.jsx("p",{className:`text-[10px] mt-1 ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:""})]}),i.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[i.jsx("button",{onClick:()=>su(!1),className:`px-4 py-2 text-xs rounded transition-colors ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-700 hover:bg-zinc-200"}`,children:j("")}),i.jsx("button",{onClick:async()=>{if(Qo==="url"&&!Tc.trim()){alert(j(" URL"));return}if(Qo==="history"&&!Mc){alert(j(""));return}if(Oc-Rc<1||Oc-Rc>3){alert(j(" 1-3 "));return}Lc(!0);try{const r=iu.trim()||null;Qo==="url"?await fv(Tc,Rc,Oc,null,r):await fv("",Rc,Oc,Mc,r)}finally{Lc(!1)}},disabled:sm,className:`px-4 py-2 text-xs rounded transition-colors ${sm?"bg-zinc-400 text-zinc-200 cursor-not-allowed":e==="dark"?"bg-blue-600 text-white hover:bg-blue-500":"bg-blue-500 text-white hover:bg-blue-600"}`,children:sm?"...":""})]})]})]})}),i.jsxs("div",{className:"flex-1 relative overflow-hidden flex",children:[i.jsxs("div",{ref:Io,id:"canvas-bg",className:"flex-1 h-full cursor-default relative",onMouseDown:Aj,onClick:Tj,onDoubleClick:Mj,onContextMenu:Rj,onDrop:cN,onDragOver:Ol,style:{backgroundColor:e==="dark"?"#09090b":e==="solarized"?"#fdf6e3":"#f4f4f5",backgroundImage:e==="dark"?"radial-gradient(#27272a 1px, transparent 1px)":e==="solarized"?"radial-gradient(#eee8d5 1px, transparent 1px)":"radial-gradient(rgba(0, 0, 0, 0.08) 0.5px, transparent 0.5px)",backgroundSize:`${20*E.zoom}px ${20*E.zoom}px`,backgroundPosition:`${E.x}px ${E.y}px`,backgroundRepeat:"repeat",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",transform:"translateZ(0)",backfaceVisibility:"hidden"},children:[i.jsxs("div",{className:"absolute origin-top-left will-change-transform",style:{transform:`translate3d(${E.x}px, ${E.y}px, 0) scale(${E.zoom})`,width:G3,height:Y3,WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",textRendering:"optimizeLegibility",transformOrigin:"top left",imageRendering:E.zoom>=1?"auto":"crisp-edges"},children:[i.jsx(kv,{connections:N,nodesMap:Xt,connectionsByNode:Wa,connectingSource:En,connectingTarget:Jr,connectingInputType:oi,mousePos:K0,apiConfigsMap:Va,selectedNodeId:q,onDisconnectConnection:Em,visibleNodes:yf}),yf.map(r=>oS(r))]}),oo&&i.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-500/10 pointer-events-none z-50",style:{left:Math.min(oo.startX,oo.endX),top:Math.min(oo.startY,oo.endY),width:Math.abs(oo.endX-oo.startX),height:Math.abs(oo.endY-oo.startY)}})]}),i.jsxs("div",{className:`fixed right-0 top-12 bottom-0 border-l shadow-2xl flex flex-col z-50 transition-transform duration-300 ease-in-out select-text ${e==="dark"?"bg-[#121214] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"} ${Yd?"translate-x-0":"translate-x-full"}`,style:{width:H2,pointerEvents:Yd?"auto":"none"},onMouseEnter:()=>sy(!0),onMouseLeave:()=>sy(!1),onMouseDown:()=>tu("chat"),onDragOver:Ol,onDrop:dN,children:[i.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1.5 cursor-ew-resize transition-colors z-50 flex items-center justify-center group ${e==="dark"?"hover:bg-blue-600/50":"hover:bg-blue-400/30"}`,onMouseDown:$j,children:i.jsx("div",{className:`h-8 w-1 rounded transition-colors ${e==="dark"?"bg-zinc-700 group-hover:bg-blue-500":"bg-zinc-300 group-hover:bg-blue-500"}`})}),i.jsxs("div",{className:`h-12 flex items-center justify-between px-3 shrink-0 border-b ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs("div",{className:"relative z-50",children:[i.jsxs("button",{onClick:r=>{r.stopPropagation(),Xb(!Yb),Gp(null)},className:`flex items-center gap-2 text-xs border rounded px-2 py-1 outline-none focus:border-blue-500 cursor-pointer max-w-[200px] ${e==="dark"?"bg-zinc-800 text-zinc-300 border-zinc-700 hover:border-zinc-600":"bg-white text-zinc-800 border-zinc-300 hover:border-zinc-400"}`,children:[i.jsx("span",{className:"truncate font-mono",children:To(ni)}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(rr(ni))}`}),i.jsx(Zn,{size:12,className:"shrink-0 opacity-50"})]}),Yb&&i.jsxs("div",{className:`absolute top-full left-0 mt-1 w-72 rounded-lg shadow-xl p-1 z-[60] border flex ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseLeave:()=>Gp(null),children:[i.jsx("div",{className:`w-24 border-r pr-1 max-h-64 overflow-y-auto custom-scrollbar flex flex-col ${e==="dark"?"border-zinc-700":"border-zinc-200"}`,children:Object.entries(ys).filter(([,r])=>r.models.some(o=>Ci(o.type))).map(([r,o])=>i.jsx("button",{onMouseEnter:()=>Gp(r),className:`w-full text-left px-2 py-1.5 text-[10px] rounded transition-colors ${qp===r?e==="dark"?"bg-zinc-800 text-white":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:text-zinc-300":e==="solarized"?"text-zinc-600 hover:text-zinc-700":"text-zinc-600 hover:text-zinc-800"}`,children:o.name||r},r))}),i.jsxs("div",{className:"flex-1 pl-1 max-h-64 overflow-y-auto custom-scrollbar",children:[qp&&((_v=ys[qp])==null?void 0:_v.models.filter(r=>Ci(r.type)).map(r=>{const o=r._uid||r.id,l=rr(ni);return i.jsxs("button",{onClick:()=>{W2(o),Xb(!1),Gp(null)},className:`w-full flex items-center justify-between px-2 py-1.5 rounded text-left transition-colors ${l===o?e==="dark"?"bg-blue-600/30 text-blue-300":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-blue-100 text-blue-700":e==="dark"?"hover:bg-zinc-800 text-zinc-300":e==="solarized"?"hover:bg-[#fdf6e3] text-zinc-700":"hover:bg-zinc-100 text-zinc-700"}`,children:[i.jsx("span",{className:"text-[10px] font-medium truncate font-mono",children:r.id}),i.jsx("div",{className:`w-1.5 h-1.5 rounded-full shrink-0 ${uo(o)}`})]},o)})),!qp&&i.jsx("div",{className:`text-[10px] px-2 py-3 text-center ${e==="dark"?"text-zinc-500":"text-zinc-400"}`,children:"  Provider"})]})]})]})}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:Gj,className:`p-1.5 rounded ${e==="dark"?"text-zinc-400 hover:text-white hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100"}`,title:j(""),children:i.jsx(Ro,{size:16})}),Jn.length>1&&i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:()=>im(!vy),className:`p-1.5 rounded ${e==="dark"?"text-zinc-400 hover:text-white hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100"}`,children:i.jsx(uw,{size:16})}),vy&&i.jsx("div",{className:`absolute right-0 top-full mt-1 w-48 rounded-lg shadow-xl py-1 z-50 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseLeave:()=>im(!1),children:Jn.map(r=>i.jsxs("div",{className:`flex items-center justify-between px-3 py-2 text-xs cursor-pointer ${$a===r.id?e==="dark"?"bg-zinc-800 text-white":"bg-zinc-100 text-zinc-900":e==="dark"?"text-zinc-400 hover:bg-zinc-800/50":"text-zinc-500 hover:bg-zinc-100"}`,onClick:()=>{wc(r.id),im(!1)},children:[i.jsx("span",{className:"truncate flex-1",children:r.title}),i.jsx("button",{onClick:o=>{o.stopPropagation(),Yj(o,r.id)},className:`p-1 ${e==="dark"?"text-zinc-600 hover:text-red-500":"text-zinc-400 hover:text-red-500"}`,children:i.jsx(ui,{size:10})})]},r.id))})]}),i.jsx("button",{onClick:()=>So(!1),className:`p-1.5 rounded ${e==="dark"?"text-zinc-400 hover:text-white hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-900 hover:bg-zinc-100"}`,children:i.jsx(Zl,{size:16})})]})]}),i.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4 select-text",children:[Jc==null?void 0:Jc.messages.map(r=>i.jsxs("div",{className:`flex gap-3 select-text ${r.role==="user"?"flex-row-reverse":""}`,children:[i.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shrink-0 select-none ${r.role==="user"?"bg-blue-600":"bg-green-600"}`,children:r.role==="user"?i.jsx(_g,{size:16,className:"text-white"}):i.jsx(sw,{size:16,className:"text-white"})}),i.jsxs("div",{className:`flex flex-col gap-1 max-w-[85%] select-text ${r.role==="user"?"items-end":"items-start"}`,children:[r.files&&r.files.length>0&&i.jsx("div",{className:`flex flex-wrap gap-2 mb-1 ${r.role==="user"?"justify-end":"justify-start"}`,children:r.files.map((o,l)=>i.jsx("div",{className:`rounded p-1 border flex items-center gap-1 ${e==="dark"?"bg-zinc-800 border-zinc-700":"bg-zinc-100 border-zinc-300"}`,children:o.isImage?i.jsx(nn,{src:o.content,className:"w-16 h-16 object-cover rounded",alt:o.name}):o.isVideo?i.jsx("video",{src:o.content,controls:!0,className:`max-w-full rounded-lg bg-black max-h-[300px] border ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,playsInline:!0}):o.isAudio?i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(dw,{size:16}),i.jsx("span",{className:"text-[8px] mt-1",children:""})]}):o.isPDF?i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(_i,{size:16}),i.jsx("span",{className:"text-[8px] mt-1",children:"PDF"})]}):o.isDoc?i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(_i,{size:16}),i.jsx("span",{className:"text-[8px] mt-1",children:"DOC"})]}):o.isExcel?i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(_i,{size:16}),i.jsx("span",{className:"text-[8px] mt-1",children:"XLS"})]}):i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(_i,{size:16}),i.jsx("span",{className:"text-[8px] mt-1 max-w-full truncate px-1",children:o.fileExt||o.name.split(".").pop()||""})]})},l))}),r.content&&r.content.trim()&&i.jsx("div",{className:`rounded-2xl px-4 py-2.5 text-sm select-text break-words ${r.role==="user"?e==="dark"?"bg-zinc-800 text-white rounded-tr-none":"bg-zinc-300 text-zinc-900 rounded-tr-none":e==="dark"?"bg-zinc-800/50 text-zinc-300 rounded-tl-none border border-zinc-800":"bg-zinc-100 text-zinc-800 rounded-tl-none border border-zinc-200"}`,style:{userSelect:"text",cursor:"text"},children:r.isError?i.jsx("span",{className:"text-red-500 select-text cursor-text",style:{userSelect:"text",cursor:"text"},children:r.content}):r.content?i.jsx("div",{className:"markdown-body",dangerouslySetInnerHTML:{__html:DC.sanitize(cn.parse(r.content))},style:{userSelect:"text",cursor:"text"}}):null})]})]},r.id||r.timestamp||`msg-${Math.random()}`)),Yp&&i.jsxs("div",{className:"flex gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-green-600 flex items-center justify-center shrink-0",children:i.jsx(sw,{size:16,className:"text-white"})}),i.jsx("div",{className:`rounded-2xl rounded-tl-none px-4 py-2 border flex items-center ${e==="dark"?"bg-zinc-800/50 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-100 border-zinc-200"}`,children:i.jsxs("div",{className:"flex gap-1",children:[i.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-500 rounded-full animate-bounce",style:{animationDelay:"0s"}}),i.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),i.jsx("div",{className:"w-1.5 h-1.5 bg-zinc-500 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})})]}),i.jsx("div",{ref:Iy})]}),i.jsxs("div",{className:`p-3 border-t ${e==="dark"?"border-zinc-800 bg-[#121214]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-zinc-50"}`,children:[kc.length>0&&i.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 mb-2 custom-scrollbar",children:kc.map((r,o)=>i.jsxs("div",{className:"relative group shrink-0",children:[r.isImage?i.jsx(nn,{src:r.content,className:`w-12 h-12 object-cover rounded border ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,alt:r.name}):r.isVideo?i.jsx("video",{src:r.content,className:`w-16 h-12 object-cover rounded border bg-black ${e==="dark"?"border-zinc-700":"border-zinc-300"}`,muted:!0,playsInline:!0}):r.isAudio?i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(dw,{size:16}),i.jsx("span",{className:"text-[8px] mt-1",children:""})]}):r.isPDF?i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(_i,{size:16}),i.jsx("span",{className:"text-[8px] mt-1",children:"PDF"})]}):r.isDoc?i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(_i,{size:16}),i.jsx("span",{className:"text-[8px] mt-1",children:"DOC"})]}):r.isExcel?i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(_i,{size:16}),i.jsx("span",{className:"text-[8px] mt-1",children:"XLS"})]}):i.jsxs("div",{className:`w-12 h-12 rounded flex flex-col items-center justify-center ${e==="dark"?"bg-zinc-800 border border-zinc-700 text-zinc-400":"bg-zinc-100 border border-zinc-300 text-zinc-500"}`,children:[i.jsx(_i,{size:16}),i.jsx("span",{className:"text-[8px] mt-1 max-w-full truncate px-1",children:r.fileExt||r.name.split(".").pop()||""})]}),i.jsx("button",{onClick:()=>Zj(o),className:`absolute -top-1 -right-1 rounded-full p-0.5 border opacity-0 group-hover:opacity-100 transition-opacity ${e==="dark"?"bg-zinc-900 text-zinc-400 hover:text-white border-zinc-700":"bg-white text-zinc-500 hover:text-zinc-900 border-zinc-300"}`,children:i.jsx(ui,{size:10})})]},o))}),i.jsxs("div",{className:`relative rounded-xl flex items-end p-2 focus-within:border-blue-500/50 transition-colors border ${e==="dark"?"bg-zinc-800/50 border-zinc-700":"bg-white border-zinc-300"}`,children:[i.jsxs("label",{className:`p-2 cursor-pointer transition-colors ${e==="dark"?"text-zinc-400 hover:text-white":"text-zinc-500 hover:text-zinc-900"}`,title:j(""),children:[i.jsx(t3,{size:18}),i.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:Xj,accept:"image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.md,.js,.py,.html,.css,.json,.csv"})]}),i.jsx("textarea",{ref:Cj,value:zc,onChange:r=>B0(r.target.value),onKeyDown:r=>{r.key==="Enter"&&!r.shiftKey&&(r.preventDefault(),Qy())},onFocus:()=>{ny(!0),tu("chat")},onBlur:()=>ny(!1),placeholder:j("..."),className:`w-full bg-transparent text-sm resize-none outline-none max-h-32 py-2 px-1 custom-scrollbar ${e==="dark"?"text-white placeholder-zinc-500":"text-zinc-800 placeholder-zinc-400"}`,rows:1,style:{minHeight:"36px"}}),i.jsx("button",{onClick:Qy,disabled:!zc.trim()&&kc.length===0||Yp,className:`p-2 rounded-lg transition-all mb-0.5 ${!zc.trim()&&kc.length===0||Yp?"opacity-50 bg-transparent text-zinc-400":"bg-blue-600 text-white hover:bg-blue-500"}`,children:i.jsx(mw,{size:16})})]}),i.jsx("div",{className:`text-[10px] text-center mt-2 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:" MP4/MP3/PDF/Doc/Excel/Code   Enter "})]})]}),bs.visible&&i.jsx("div",{className:`fixed z-50 w-40 rounded-lg shadow-xl border ${e==="dark"?"bg-[#18181b] border-zinc-800":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:bs.x,top:bs.y,transform:"translate(-50%, -50%)"},onMouseLeave:()=>{Cc(r=>({...r,visible:!1})),Ra(!1)},children:i.jsx("div",{className:"p-1",children:[{type:"input-image",label:j("")},{type:"text-node",label:j("")},{type:"novel-input",label:j("")},{type:"extract-characters-scenes",label:j(""),children:[{type:"character-description",label:j("")},{type:"scene-description",label:j("")},{type:"generate-character-image",label:j("")},{type:"generate-scene-image",label:j("")},{type:"generate-character-video",label:j("")},{type:"generate-scene-video",label:j("")},{type:"create-character",label:j("")},{type:"create-scene",label:j("")}]},{type:"video-input",label:j(" / ")},{type:"video-analyze",label:j(" / ")},{type:"storyboard-node",label:j("")},{type:"gen-image",label:j("AI ")},{type:"gen-video",label:j("AI ")},{type:"image-compare",label:j("")},{type:"preview",label:j("")},{type:"local-save",label:j("")}].map(r=>i.jsx("div",{children:r.children?i.jsxs("div",{className:"relative",children:[i.jsxs("div",{className:"flex items-center",onMouseEnter:()=>Ra(!0),children:[i.jsx("button",{className:`flex-1 text-left px-3 py-2 text-xs rounded transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>is(r.type,bs.worldX,bs.worldY,bs.sourceNodeId,void 0,void 0,bs.targetNodeId,bs.inputType),children:r.label}),i.jsx("button",{className:`px-2 py-2 rounded transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-100"}`,onClick:o=>{o.stopPropagation(),Ra(l=>!l)},onMouseEnter:()=>Ra(!0),title:j(""),children:i.jsx(Zl,{size:12,className:"transition-transform"})})]}),q2&&i.jsx("div",{className:`absolute left-full top-0 ml-1 w-40 rounded-lg shadow-xl p-1 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,children:r.children.map(o=>i.jsx("button",{className:`w-full text-left px-3 py-2 text-[11px] rounded transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>is(o.type,bs.worldX,bs.worldY,bs.sourceNodeId,void 0,void 0,bs.targetNodeId,bs.inputType),children:o.label},o.type))})]}):i.jsx("button",{className:`w-full text-left px-3 py-2 text-xs rounded transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>is(r.type,bs.worldX,bs.worldY,bs.sourceNodeId,void 0,void 0,bs.targetNodeId,bs.inputType),children:r.label})},r.type))})}),Ks.visible&&i.jsxs("div",{className:`fixed z-[100] w-max rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:Ks.x,top:Ks.y},children:[i.jsx("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:""}),i.jsxs("div",{className:"relative",onMouseEnter:em,onMouseLeave:iy,children:[i.jsxs("button",{className:`w-full whitespace-nowrap text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:eS,children:[i.jsx(mw,{size:14,className:"text-blue-500"})," "]}),i.jsx("button",{className:`absolute right-2 top-2 p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-200":"text-zinc-400 hover:text-zinc-700"}`,onMouseEnter:em,onClick:r=>{r.stopPropagation(),ao(o=>!o)},title:j(""),children:i.jsx(Zl,{size:12,className:`transition-transform ${Z0?"rotate-90":""}`})}),Z0&&i.jsxs("div",{className:`absolute left-full top-0 ml-1 w-max rounded-lg shadow-2xl py-1 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,onMouseEnter:em,onMouseLeave:iy,children:[i.jsxs("button",{className:`w-full whitespace-nowrap text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:wv,children:[i.jsx(Qc,{size:14,className:"text-purple-500"})," ",j("")]}),i.jsxs("button",{className:`w-full whitespace-nowrap text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:QN,children:[i.jsx(mo,{size:14,className:"text-emerald-500"})," "]}),i.jsxs("button",{className:`w-full whitespace-nowrap text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:vv,children:[i.jsx(Jl,{size:14,className:"text-blue-500"})," ",j("")]})]})]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>{const r=Ks.item,o=(r==null?void 0:r.url)||(r==null?void 0:r.localCacheUrl)||(r==null?void 0:r.originalUrl)||(r==null?void 0:r.mjOriginalUrl);if(o){const l=(Ks.worldX||0)+340,u=Ks.worldY||0;zu(o,{originX:l,originY:u})}Fi({visible:!1,x:0,y:0,worldX:0,worldY:0,item:null})},children:[i.jsx(Ng,{size:14,className:"text-blue-500"})," "]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:async()=>{const r=Ks.item,o=(r==null?void 0:r.url)||(r==null?void 0:r.localCacheUrl)||(r==null?void 0:r.originalUrl)||(r==null?void 0:r.mjOriginalUrl);if(o){try{const u=r.type==="video"||o.includes("/video/")||o.includes("video_mp4")?"mp4":"png",f=`${(r.prompt||"download").replace(/[\\/:*?"<>|]/g,"_").slice(0,50)}.${u}`,m=ps(r),{blob:y}=await Bi(o,{useProxy:m}),b=window.URL.createObjectURL(y),w=document.createElement("a");w.href=b,w.download=f,w.click(),window.URL.revokeObjectURL(b)}catch(l){console.error(":",l),alert(j(""))}Fi({visible:!1,x:0,y:0,worldX:0,worldY:0,item:null})}},children:[i.jsx(aa,{size:14,className:"text-green-500"})," ",((Cv=Ks.item)==null?void 0:Cv.type)==="video"?"":""]})]}),Y0.visible&&i.jsxs("div",{className:`fixed z-[120] w-52 rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:Y0.x,top:Y0.y},onMouseLeave:()=>X0({visible:!1,x:0,y:0}),children:[i.jsxs("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:[" ",en.size>0?en.size:q?1:0," "]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:xN,children:[i.jsx(hw,{size:14,className:"text-blue-500"})," "]})]}),Oa.visible&&i.jsxs("div",{className:`fixed z-[110] w-48 rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:Oa.x,top:Oa.y},children:[i.jsx("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:""}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:JN,children:[i.jsx(Qc,{size:14,className:"text-purple-500"})," "]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:qN,children:[i.jsx(Jl,{size:14,className:"text-blue-500"})," ",j("")]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:GN,children:[i.jsx(mo,{size:14,className:"text-emerald-500"})," "]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:YN,children:[i.jsx(vg,{size:14,className:q?"text-green-500":"text-zinc-400"})," "]})]}),La.visible&&i.jsxs("div",{className:`fixed z-[110] w-48 rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:La.x,top:La.y},onMouseLeave:Hl,children:[i.jsx("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:""}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:rS,children:[i.jsx(Qc,{size:14,className:"text-purple-500"})," "]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:nS,children:[i.jsx(Jl,{size:14,className:"text-blue-500"})," ",j("")]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>{const r=La.item;r!=null&&r.url&&gn({url:r.url,type:r.type||"image",prompt:r.prompt||"",mjImages:r.mjImages,selectedMjImageIndex:r.selectedMjImageIndex||0}),Hl()},children:[i.jsx(mo,{size:14,className:"text-green-500"})," ",j("")]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>{const r=La.item;if(r!=null&&r.url){const o=vi.current;if(o&&o.size===9)zu(r.url,{replaceSelected:!0});else{const u=r.sourceNode,p=u?u.x+u.width+20:void 0,f=u?u.y:void 0;zu(r.url,{originX:p,originY:f})}}Hl()},children:[i.jsx(Ng,{size:14,className:"text-blue-500"})," "]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:async()=>{const r=La.item;if(!(r!=null&&r.url)){Hl();return}try{const l=r.type==="video"||r.url.includes("/video/")||r.url.includes("video_mp4")?"mp4":"png",p=`${(r.prompt||"download").replace(/[\\/:*?"<>|]/g,"_").slice(0,50)}_${Date.now()}.${l}`,f=ps(r),{blob:m}=await Bi(r.url,{useProxy:f}),y=window.URL.createObjectURL(m),b=document.createElement("a");b.href=y,b.download=p,b.click(),window.URL.revokeObjectURL(y)}catch(o){console.error(":",o),d("","error")}Hl()},children:[i.jsx(aa,{size:14,className:"text-cyan-500"})," ",j("")]})]}),nu.visible&&i.jsxs("div",{className:`fixed z-[110] w-48 rounded-lg shadow-2xl py-1 animate-in fade-in duration-100 border ${e==="dark"?"bg-[#18181b] border-zinc-700":e==="solarized"?"bg-[#eee8d5] border-[#d7cfb2]":"bg-white border-zinc-200"}`,style:{left:nu.x,top:nu.y},onMouseLeave:Om,children:[i.jsx("div",{className:`px-3 py-1.5 text-[10px] font-medium border-b mb-1 ${e==="dark"?"text-zinc-500 border-zinc-800":"text-zinc-500 border-zinc-200"}`,children:""}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:iS,children:[i.jsx(Qc,{size:14,className:"text-purple-500"})," "]}),i.jsxs("button",{className:`w-full text-left px-3 py-2 text-xs flex items-center gap-2 transition-colors ${e==="dark"?"text-zinc-300 hover:bg-zinc-800":"text-zinc-700 hover:bg-zinc-100"}`,onClick:()=>{const r=nu.nodeId,o=Xt.get(r);if(!o||!o.content)return;const l=vi.current;if(l&&l.size===9)zu(o.content,{replaceSelected:!0});else{const p=o.x+o.width+20,f=o.y;zu(o.content,{originX:p,originY:f})}Om()},children:[i.jsx(Ng,{size:14,className:"text-blue-500"})," "]})]}),i.jsx(SE,{item:Aa,onClose:()=>gn(null),onNavigate:r=>{const o=Xp.current;if(o&&o.mjImages&&o.mjImages.length>r&&r>=0){const l=Math.max(0,Math.min(r,o.mjImages.length-1)),u=o.mjImages[l],p=Ar(o,u);o.id&&!o.storyboardContext&&Rt(f=>f.map(m=>m.id===o.id?{...m,url:u,selectedMjImageIndex:l}:m)),gn({...o,url:p,selectedMjImageIndex:l})}},onShotNavigate:(r,o)=>{const l=Xp.current;if(!(l!=null&&l.storyboardContext)||!o)return;const u=l.storyboardContext.shotIndex,p=r>u?1:-1;let f=r,m=null;for(;f>=0&&f<o.length;){const w=o[f];if(((w==null?void 0:w.output_images)||[]).length>0){m=w;break}f+=p}if(!m)return;const y=m.output_images||[],b=0;gn({url:y[b],type:"image",mjImages:y,selectedMjImageIndex:b,prompt:m.prompt,storyboardContext:{...l.storyboardContext,shotId:m.id,shotIndex:f}})},onHistoryNavigate:r=>{const o=Xp.current;if(!o||o.storyboardContext)return;const l=xm;if(!l.length)return;const u=l.findIndex(w=>w.id===o.id);if(u===-1)return;const p=Ej(l,u,r);if(p<0)return;const f=l[p];if(!f)return;const m=0,y=f.mjImages&&f.mjImages.length>1?f.mjImages[m]:f.url,b=y?Ar(f,y):Ar(f);Co(f.id),Pl(p),gn({...f,url:b,selectedMjImageIndex:m,storyboardContext:null})}}),i.jsxs(NE,{isOpen:X2,onClose:()=>bi(!1),title:j(""),theme:e,children:[i.jsx("div",{className:"px-4 pt-3",children:i.jsxs("div",{className:`inline-flex rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-zinc-50"} p-1`,children:[i.jsx("button",{onClick:()=>ly("providers"),className:`px-3 py-1 text-xs rounded ${ef==="providers"?e==="dark"?"bg-zinc-800 text-zinc-100":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-white text-zinc-800":e==="dark"?"text-zinc-400 hover:text-zinc-200":e==="solarized"?"text-[#586e75] hover:text-zinc-800":"text-zinc-500 hover:text-zinc-700"}`,children:j("")}),i.jsx("button",{onClick:()=>ly("library"),className:`px-3 py-1 text-xs rounded ${ef==="library"?e==="dark"?"bg-zinc-800 text-zinc-100":e==="solarized"?"bg-[#fdf6e3] text-zinc-800":"bg-white text-zinc-800":e==="dark"?"text-zinc-400 hover:text-zinc-200":e==="solarized"?"text-[#586e75] hover:text-zinc-800":"text-zinc-500 hover:text-zinc-700"}`,children:j("")})]})}),ef==="providers"&&i.jsxs(i.Fragment,{children:[i.jsxs("details",{className:`mx-4 mt-3 rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-white"}`,children:[i.jsx("summary",{className:`cursor-pointer select-none px-3 py-2 text-xs font-medium ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:j("")}),i.jsxs("div",{className:"px-3 pb-3 pt-2 space-y-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j(" API Key Key")}),i.jsx("input",{type:"password",value:Ns,onChange:r=>Ss(r.target.value),className:`w-full rounded px-2 py-1 text-xs outline-none focus:border-blue-600/50 border ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,placeholder:j(" Key Key")})]}),i.jsxs("div",{className:"border-t pt-3 border-zinc-700/50",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-2",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:j("Zip")}),i.jsx("button",{className:`w-10 h-5 rounded-full relative transition-colors ${ce?"bg-blue-600":e==="dark"?"bg-zinc-700":"bg-zinc-300"}`,onClick:()=>dt(r=>!r),children:i.jsx("div",{className:`absolute top-1 w-3 h-3 rounded-full bg-white transition-all ${ce?"left-6":"left-1"}`})})]}),i.jsx("p",{className:"text-[9px] text-zinc-500",children:j("/")})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex flex-col gap-1",children:[i.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:j("")}),i.jsx("input",{type:"text",value:yr,onChange:r=>{const o=r.target.value;no(o),localStorage.setItem("tapnow_local_server_url",o)},placeholder:"http://127.0.0.1:9527",className:`w-full text-xs rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-800 border-zinc-700 text-zinc-300":"bg-white border-zinc-300"}`}),i.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] text-zinc-500",children:[i.jsx("span",{className:`inline-block w-2 h-2 rounded-full ${Vs?Hs?"bg-green-500":"bg-red-500":"bg-zinc-400"}`}),i.jsx("span",{children:j(Vs?Hs?"":"":"")})]})]}),i.jsx("p",{className:"text-[9px] text-zinc-500 mt-1",children:j("")})]})]})]}),i.jsxs("div",{className:"border-t pt-3 border-zinc-700/50 space-y-2",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsx("div",{className:"mb-2",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsx("p",{className:`text-[10px] mt-0.5 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("/")})]}),i.jsxs("div",{className:"flex items-center gap-1 ml-3",children:[i.jsx("button",{onClick:()=>s("zh"),className:`px-2 py-1 text-[10px] rounded border transition-colors ${n==="zh"?"bg-blue-600 text-white border-blue-500":e==="dark"?"bg-zinc-800 text-zinc-400 border-zinc-700 hover:text-zinc-200":"bg-white text-zinc-600 border-zinc-300 hover:text-zinc-800"}`,children:j("")}),i.jsx("button",{onClick:()=>s("en"),className:`px-2 py-1 text-[10px] rounded border transition-colors ${n==="en"?"bg-blue-600 text-white border-blue-500":e==="dark"?"bg-zinc-800 text-zinc-400 border-zinc-700 hover:text-zinc-200":"bg-white text-zinc-600 border-zinc-300 hover:text-zinc-800"}`,children:j("")})]})]})}),i.jsx("div",{className:"mb-2",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("/")}),i.jsx("p",{className:`text-[10px] mt-0.5 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:" ()"})]}),i.jsxs("div",{className:"flex items-center gap-2 ml-3",children:[i.jsx("input",{type:"range",min:"1",max:"30",value:A,onChange:r=>{const o=parseInt(r.target.value)||5;_(o),localStorage.setItem("tapnow_max_undo_steps",String(o))},className:"w-20",onMouseDown:r=>r.stopPropagation()}),i.jsx("span",{className:`text-xs font-mono w-6 text-center ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:A})]})]})}),i.jsx("div",{className:"mb-2",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsx("p",{className:`text-[10px] mt-0.5 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("FormDataURL")})]}),i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer ml-3",children:[i.jsx("input",{type:"checkbox",checked:Dn,onChange:r=>{const o=r.target.checked;Sa(o),localStorage.setItem("tapnow_jimeng_use_local_file",String(o))},className:"sr-only peer"}),i.jsx("div",{className:`w-11 h-6 rounded-full peer peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500/50 ${Dn?"bg-blue-600":e==="dark"?"bg-zinc-700":"bg-zinc-300"} peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all`})]})]})})]})]})]}),i.jsx("div",{className:`mx-4 mt-3 rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-white"}`,children:i.jsxs("div",{className:"px-3 py-3",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("API ")}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsxs("button",{onClick:()=>{const r={version:"3.4.23",exportTime:new Date().toISOString(),globalApiKey:Ns,providers:Ft,modelLibrary:Oe,modelLibraryCollapsed:Array.from(_t),apiConfigs:Ye.map(({key:v,url:z,...k})=>k)},o=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),l=URL.createObjectURL(o),u=document.createElement("a");u.href=l;const p=new Date,f=p.getFullYear().toString().slice(2),m=(p.getMonth()+1).toString().padStart(2,"0"),y=p.getDate().toString().padStart(2,"0"),b=p.getHours().toString().padStart(2,"0"),w=p.getMinutes().toString().padStart(2,"0");u.download=`tapnow-api-keys-${f}${m}${y}-${b}${w}.json`,u.click(),URL.revokeObjectURL(l)},className:`flex-1 px-3 py-2 text-xs rounded flex items-center justify-center gap-2 transition-colors ${e==="dark"?"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30 border border-blue-500/30":"bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200"}`,children:[i.jsx(aa,{size:14}),j(" API Keys")]}),i.jsxs("button",{onClick:()=>{const r=document.createElement("input");r.type="file",r.accept=".json",r.onchange=async o=>{const l=o.target.files[0];if(l)try{const u=await l.text(),p=JSON.parse(u);if(p.globalApiKey&&(Ss(p.globalApiKey),localStorage.setItem("tapnow_global_key",p.globalApiKey)),p.providers){const f=Object.fromEntries(Object.entries(p.providers).map(([m,y])=>[m,Fe(m,y)]));zn(m=>({...m,...f}))}if(p.modelLibrary&&Array.isArray(p.modelLibrary)){const f=p.modelLibrary.map(m=>({id:m.id,displayName:m.displayName||m.modelName||m.id,modelName:m.modelName||m.displayName||m.id,type:m.type||"Chat",apiType:m.apiType||"openai",ratioLimits:Array.isArray(m.ratioLimits)?m.ratioLimits:null,ratioNotes:es(m.ratioNotes),ratioNotesEnabled:!!m.ratioNotesEnabled,resolutionLimits:Array.isArray(m.resolutionLimits)?m.resolutionLimits:null,resolutionNotes:nl(m.resolutionNotes),resolutionNotesEnabled:!!m.resolutionNotesEnabled,durations:Array.isArray(m.durations)?m.durations:null,durationNotes:es(m.durationNotes),durationNotesEnabled:!!m.durationNotesEnabled,videoResolutions:Array.isArray(m.videoResolutions)?m.videoResolutions:null,videoResolutionNotes:es(m.videoResolutionNotes),videoResolutionNotesEnabled:!!m.videoResolutionNotesEnabled,supportsFirstLastFrame:!!m.supportsFirstLastFrame,supportsHD:!!m.supportsHD,customParams:da(m.customParams),asyncConfig:m.asyncConfig&&typeof m.asyncConfig=="object"?m.asyncConfig:null,previewOverrideEnabled:!!m.previewOverrideEnabled,previewOverridePatch:fa(m.previewOverridePatch),requestTemplate:Gi(m.requestTemplate||xo(m)),requestOverrideEnabled:!!m.requestOverrideEnabled,requestOverridePatch:Lo(m.requestOverridePatch)})).filter(m=>m.id);ke(f)}if(Array.isArray(p.modelLibraryCollapsed)){const f=new Set(p.modelLibraryCollapsed.filter(Boolean));at.current=!0,tt(f);try{localStorage.setItem("tapnow_model_library_collapsed",JSON.stringify(Array.from(f)))}catch(m){console.error(":",m)}}if(p.apiConfigs&&Array.isArray(p.apiConfigs)){const f=p.apiConfigs.map(m=>{const y={...m,id:m.id||m.modelName,provider:m.provider,type:m.type||"Chat",modelName:m.modelName||m.id,displayName:m.displayName||m.modelName||m.id,_uid:m._uid||`uid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,...m.durations?{durations:m.durations}:{}},{key:b,url:w,isCustom:v,...z}=y;return z});kr(f)}alert(j("API "))}catch(u){alert(": "+u.message)}},r.click()},className:`flex-1 px-3 py-2 text-xs rounded flex items-center justify-center gap-2 transition-colors ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700 border border-zinc-700":"bg-zinc-100 text-zinc-700 hover:bg-zinc-200 border border-zinc-300"}`,children:[i.jsx(rl,{size:14}),j(" API Keys")]})]}),i.jsx("p",{className:"text-[9px] text-zinc-500 mt-1",children:j(" KeyProvider  Key")})]})}),i.jsx("div",{className:`mx-4 mt-3 rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-white"}`,children:i.jsxs("div",{className:"px-3 py-3",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("API ")}),i.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-2",children:[i.jsxs("button",{onClick:()=>{sn({}),Rs.current={},alert(j(""))},className:`px-2 py-1.5 text-[10px] rounded flex items-center justify-center gap-1 transition-colors ${e==="dark"?"bg-red-600/20 text-red-400 hover:bg-red-600/30 border border-red-500/30":"bg-red-50 text-red-600 hover:bg-red-100 border border-red-200"}`,children:[i.jsx(BC,{size:12}),j(""),Object.keys(Ms).length>0&&i.jsx("span",{className:"ml-1 px-1 rounded bg-red-500/30 text-[9px]",children:Object.keys(Ms).length})]}),i.jsxs("button",{onClick:()=>{Ko({}),alert(j(""))},className:`px-2 py-1.5 text-[10px] rounded flex items-center justify-center gap-1 transition-colors ${e==="dark"?"bg-amber-600/20 text-amber-400 hover:bg-amber-600/30 border border-amber-500/30":"bg-amber-50 text-amber-600 hover:bg-amber-100 border border-amber-200"}`,children:[i.jsx(lw,{size:12}),j(""),Object.keys(Cn).length>0&&i.jsx("span",{className:"ml-1 px-1 rounded bg-amber-500/30 text-[9px]",children:Object.keys(Cn).length})]}),i.jsxs("button",{onClick:()=>{Ri.current=[],alert(j(""))},className:`px-2 py-1.5 text-[10px] rounded flex items-center justify-center gap-1 transition-colors ${e==="dark"?"bg-blue-600/20 text-blue-400 hover:bg-blue-600/30 border border-blue-500/30":"bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200"}`,children:[i.jsx(dh,{size:12}),j("")]})]}),i.jsx("p",{className:"text-[9px] text-zinc-500 mt-1",children:j(" =  = 60 = 1006")})]})}),i.jsxs("div",{className:`mx-4 mt-3 rounded-md border ${e==="dark"?"border-zinc-800 bg-[#18181b]":e==="solarized"?"border-[#d7cfb2] bg-[#eee8d5]":"border-zinc-200 bg-white"}`,children:[i.jsx("div",{className:`px-3 py-2 text-xs font-medium ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:j("")}),i.jsxs("div",{className:"px-3 pb-3 pt-2",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:`text-xs ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,children:j("")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>{const r=Object.values(lu).some(l=>l),o={};r||Object.keys(ys).forEach(l=>o[l]=!0),om(o)},className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,title:Object.values(lu).some(r=>r)?"":"",children:i.jsx(ow,{size:14,className:`transition-transform ${Object.values(lu).some(r=>r)?"":"rotate-180"}`})}),i.jsxs(yh,{className:"h-7 text-xs px-3 bg-blue-600 hover:bg-blue-500",onClick:()=>{const r=`custom-${Date.now()}`,o="New Provider";zn(l=>({...l,[r]:Fe(r,{key:"",url:"",enabled:!0})})),om(l=>({...l,[r]:!0})),cf({key:r,tempName:o})},children:[i.jsx(Ro,{size:14,className:"mr-1"})," ",j("")]})]})]}),i.jsx("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto custom-scrollbar pr-1",children:Object.entries(ys).map(([r,o])=>{var l,u,p,f,m,y,b,w;return i.jsxs("div",{className:`group rounded-lg border ${e==="dark"?"bg-[#18181b] border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[i.jsx("button",{onClick:()=>om(v=>({...v,[r]:!v[r]})),className:`w-full flex items-center justify-between px-3 py-2.5 text-left transition-colors ${e==="dark"?"hover:bg-zinc-800/50":e==="solarized"?"hover:bg-[#eee8d5]":"hover:bg-zinc-100"}`,children:xj===r?i.jsxs("div",{className:"flex items-center justify-between w-full",children:[i.jsxs("span",{className:`text-sm font-semibold ${e==="dark"?"text-zinc-100":"text-zinc-800"}`,children:[" ",o.name,"?"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:v=>{v.stopPropagation(),zn(z=>{const k={...z};return delete k[r],k}),am(null)},className:"text-xs px-2 py-1 bg-red-600 hover:bg-red-700 text-white rounded",children:j("")}),i.jsx("button",{onClick:v=>{v.stopPropagation(),am(null)},className:`text-xs px-2 py-1 rounded ${e==="dark"?"bg-zinc-700 hover:bg-zinc-600 text-zinc-300":"bg-zinc-200 hover:bg-zinc-300 text-zinc-700"}`,children:j("")})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${((l=Ft[r])==null?void 0:l.enabled)!==!1?"bg-green-500":"bg-zinc-500"}`}),(Dc==null?void 0:Dc.key)===r?i.jsx("input",{type:"text",value:Dc.tempName,onChange:v=>cf(z=>({...z,tempName:v.target.value})),onBlur:()=>{const v=Dc.tempName.trim(),z=r;v&&v!==z&&(zn(k=>{const{[z]:T,...I}=k;return{...I,[v]:T}}),kr(k=>k.map(T=>T.provider===z?{...T,provider:v}:T))),cf(null)},onKeyDown:v=>{v.key==="Enter"&&v.target.blur(),v.stopPropagation()},onClick:v=>v.stopPropagation(),autoFocus:!0,className:`text-sm font-semibold bg-transparent border-b border-blue-500 outline-none w-full ${e==="dark"?"text-zinc-100":"text-zinc-800"}`}):i.jsx("span",{className:`text-sm font-semibold ${e==="dark"?"text-zinc-100":"text-zinc-800"}`,children:o.name}),i.jsxs("span",{className:`text-[10px] px-1.5 py-0.5 rounded ${e==="dark"?"bg-zinc-800 text-zinc-500":e==="solarized"?"bg-[#eee8d5] text-zinc-600":"bg-zinc-200 text-zinc-500"}`,children:[o.models.length," "]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[!Dc&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:v=>{v.stopPropagation(),cf({key:r,tempName:o.name})},className:"p-1 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors opacity-0 group-hover:opacity-100",title:j(""),children:i.jsx(r3,{size:12,className:e==="dark"?"text-zinc-400":"text-zinc-500"})}),i.jsx("button",{onClick:v=>{v.stopPropagation(),am(r)},className:"p-1 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors opacity-0 group-hover:opacity-100",title:j(""),children:i.jsx(Is,{size:12,className:e==="dark"?"text-zinc-400 hover:text-red-400":"text-zinc-500 hover:text-red-500"})})]}),i.jsx(Zn,{size:16,className:`transition-transform ${lu[r]?"rotate-180":""} ${e==="dark"?"text-zinc-500":"text-zinc-400"}`})]})]})}),lu[r]&&i.jsxs("div",{className:`px-3 pb-3 border-t ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[i.jsxs("div",{className:"pt-3 pb-2 space-y-2",children:[i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("select",{value:((u=Ft[r])==null?void 0:u.apiType)||"openai",onChange:v=>zn(z=>({...z,[r]:{...z[r],apiType:v.target.value}})),className:`col-span-3 w-full rounded px-2 py-1 text-xs outline-none focus:border-blue-600/50 border ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,children:[i.jsx("option",{value:"openai",children:"OpenAI"}),i.jsx("option",{value:"gemini",children:"Gemini"}),i.jsx("option",{value:"modelscope",children:"ModelScope"})]})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:!!((p=Ft[r])!=null&&p.useProxy),onChange:v=>zn(z=>({...z,[r]:{...z[r],useProxy:v.target.checked}})),className:"sr-only peer"}),i.jsx("div",{className:`w-9 h-5 rounded-full peer peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500/50 ${(f=Ft[r])!=null&&f.useProxy?"bg-blue-600":e==="dark"?"bg-zinc-700":"bg-zinc-300"} peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all`})]}),i.jsxs("span",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[" ",yr||"http://127.0.0.1:9527","/proxy"]})]})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("div",{className:"col-span-3 flex items-center gap-2",children:[i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:!!((m=Ft[r])!=null&&m.forceAsync),onChange:v=>zn(z=>({...z,[r]:{...z[r],forceAsync:v.target.checked}})),className:"sr-only peer"}),i.jsx("div",{className:`w-9 h-5 rounded-full peer peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500/50 ${(y=Ft[r])!=null&&y.forceAsync?"bg-blue-600":e==="dark"?"bg-zinc-700":"bg-zinc-300"} peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all`})]}),i.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("ModelScope ")})]})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"API Key"}),i.jsx("input",{type:"password",value:((b=Ft[r])==null?void 0:b.key)||"",onChange:v=>zn(z=>({...z,[r]:{...z[r],key:v.target.value}})),className:`col-span-3 w-full rounded px-2 py-1 text-xs outline-none focus:border-blue-600/50 border ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,placeholder:"sk-..."})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx("label",{className:`text-[10px] font-medium uppercase tracking-wider text-right ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"Base URL"}),i.jsx("input",{type:"text",value:((w=Ft[r])==null?void 0:w.url)||"",onChange:v=>zn(z=>({...z,[r]:{...z[r],url:v.target.value}})),className:`col-span-3 w-full rounded px-2 py-1 text-xs outline-none focus:border-blue-600/50 border ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,placeholder:"https://..."})]})]}),i.jsxs("div",{className:`mt-2 pt-2 border-t ${e==="dark"?"border-zinc-800/50":"border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:`text-[10px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>nN(r),className:`text-[9px] px-1.5 py-0.5 rounded flex items-center gap-1 ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-600 hover:bg-zinc-300"}`,children:[i.jsx(Sg,{size:10})," ",j("")]}),i.jsxs("button",{onClick:()=>{const v=`${r}-${Date.now()}`,z=`uid-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;kr(k=>[...k,{id:v,provider:r,type:"Chat",_uid:z}]),Gy(z,!0)},className:`text-[9px] px-1.5 py-0.5 rounded flex items-center gap-1 ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-600 hover:bg-zinc-300"}`,children:[i.jsx(Ro,{size:10})," ",j("")]})]})]}),i.jsx("div",{className:"space-y-1.5",children:o.models.map(v=>{var F,B,U;const z=Z2.has(v._uid),k=v.libraryId?((F=hu.get(v.libraryId))==null?void 0:F.displayName)||((B=hu.get(v.libraryId))==null?void 0:B.modelName)||v.libraryId:"",T=v.apiType||((U=Ft[r])==null?void 0:U.apiType)||"openai",I=v._uid||v.id;return i.jsxs("div",{className:`flex flex-col gap-2 px-2 py-2 rounded ${e==="dark"?"bg-zinc-900/50 hover:bg-zinc-800/50":e==="solarized"?"bg-[#fdf6e3] hover:bg-[#eee8d5]":"bg-white hover:bg-zinc-100"}`,children:[i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-1",children:[i.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${uo(v._uid)}`}),i.jsx("input",{type:"text",value:v.id||"",onChange:W=>Cf(v._uid,{id:W.target.value}),className:`text-xs bg-transparent border-b border-transparent hover:border-zinc-600 focus:border-blue-500 outline-none flex-1 min-w-[120px] font-mono ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,placeholder:"model-id",title:` ID: ${v.id}`,disabled:!z}),i.jsxs("select",{value:v.type||"Chat",onChange:W=>Cf(v._uid,{type:W.target.value}),className:`text-[9px] px-1 py-0.5 rounded cursor-pointer outline-none ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-500 hover:bg-zinc-300"}`,disabled:!z||!!v.libraryId,children:[i.jsx("option",{value:"Chat",children:"Chat"}),i.jsx("option",{value:"Image",children:"Image"}),i.jsx("option",{value:"ChatImage",children:"Chat Image"}),i.jsx("option",{value:"Video",children:"Video"})]}),i.jsxs("select",{value:v.libraryId||"",onChange:W=>{const X=W.target.value||null,J=X?hu.get(X):null,Y={libraryId:X};J&&(Y.modelName=J.modelName,Y.displayName=J.displayName,Y.type=J.type||v.type,Y.apiType=J.apiType||v.apiType,Y.ratioLimits=Array.isArray(J.ratioLimits)?J.ratioLimits:null,Y.resolutionLimits=Array.isArray(J.resolutionLimits)?J.resolutionLimits:null,Y.durations=Array.isArray(J.durations)?J.durations:null,Y.videoResolutions=Array.isArray(J.videoResolutions)?J.videoResolutions:null),Cf(v._uid,Y)},className:`text-[9px] px-1 py-0.5 rounded cursor-pointer outline-none min-w-[120px] ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-500 hover:bg-zinc-300"}`,disabled:!z,children:[i.jsx("option",{value:"",children:j("")}),Oe.map(W=>i.jsx("option",{value:W.id,children:W.displayName||W.modelName||W.id},W.id))]}),i.jsxs("select",{value:v.apiType||"",onChange:W=>Cf(v._uid,{apiType:W.target.value||null}),className:`text-[9px] px-1 py-0.5 rounded cursor-pointer outline-none ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-200 text-zinc-500 hover:bg-zinc-300"}`,disabled:!z||!!v.libraryId,children:[i.jsx("option",{value:"",children:j(" Provider")}),i.jsx("option",{value:"openai",children:"OpenAI"}),i.jsx("option",{value:"gemini",children:"Gemini"}),i.jsx("option",{value:"modelscope",children:"ModelScope"})]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:()=>tN(v),className:`px-1.5 py-0.5 rounded text-[9px] ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(""),children:i.jsx(aa,{size:10})}),i.jsx("button",{onClick:()=>Gy(v._uid,!z),className:`px-1.5 py-0.5 rounded text-[9px] ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(z?"":""),children:z?i.jsx(Xl,{size:10}):i.jsx(jg,{size:10})}),i.jsx("button",{onClick:()=>Jj(I),disabled:wy===I,className:`px-1.5 py-0.5 rounded text-[9px] ${cm[I]==="success"?"text-green-500":e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,children:wy===I?i.jsx(la,{size:10,className:"animate-spin"}):cm[I]==="success"?i.jsx(ep,{size:10}):i.jsx(Vu,{size:10})}),i.jsx("button",{onClick:()=>Kj(v._uid),className:`px-1 ${e==="dark"?"text-zinc-600 hover:text-red-500":"text-zinc-400 hover:text-red-500"}`,children:i.jsx(Is,{size:10})})]})]}),i.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-[9px] text-zinc-500",children:[i.jsxs("span",{children:[j(""),v.libraryId?k:j("")]}),i.jsxs("span",{children:[j("API"),v.modelName||v.id]}),i.jsxs("span",{children:[j(""),T]})]})]},v._uid)})})]})]})]},r)})})]})]})]}),ef==="library"&&i.jsxs("div",{className:"p-4 space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("div",{className:`text-xs font-medium ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:j("")}),i.jsx("p",{className:"text-[9px] text-zinc-500",children:j("")})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("button",{onClick:()=>sN(),className:`text-[10px] px-2 py-1 rounded flex items-center gap-1 ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-200 text-zinc-600 hover:bg-zinc-300"}`,children:[i.jsx(Sg,{size:10})," ",j("")]}),i.jsx("button",{onClick:()=>{tt(ym?new Set(Oe.map(r=>r.id)):new Set)},className:`p-1 rounded hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-colors ${e==="dark"?"text-zinc-400":"text-zinc-500"}`,title:j(ym?"":""),children:i.jsx(ow,{size:14,className:`transition-transform ${ym?"":"rotate-180"}`})}),i.jsxs("button",{onClick:Lj,className:`text-[10px] px-2 py-1 rounded flex items-center gap-1 ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-200 text-zinc-600 hover:bg-zinc-300"}`,children:[i.jsx(Ro,{size:10})," ",j("")]})]})]}),i.jsx("div",{className:"space-y-2 max-h-[60vh] overflow-y-auto custom-scrollbar pr-1",children:Oe.map(r=>{const o=Q2.has(r.id),l=_t.has(r.id),u=ej.has(r.id),p=r.ratioLimits===null,f=Array.isArray(r.ratioLimits)?r.ratioLimits:[],m=r.ratioNotes||{},y=!!r.ratioNotesEnabled,b=Array.isArray(r.resolutionLimits)?r.resolutionLimits:[],w=nl(r.resolutionNotes),v=!!r.resolutionNotesEnabled,z=Array.isArray(r.durations)?r.durations:[],k=r.durationNotes||{},T=!!r.durationNotesEnabled,I=Array.isArray(r.videoResolutions)?r.videoResolutions:[],F=r.videoResolutionNotes||{},B=!!r.videoResolutionNotesEnabled,U=Array.isArray(r.customParams)?r.customParams:[],W=Gi(r.requestTemplate||xo(r)),X=(W==null?void 0:W.enabled)!==!1,J=Lo(r.requestOverridePatch),Y={model:r.modelName||r.id,type:r.type||"Chat",apiType:r.apiType||"openai"};zs(r.type)&&(Y.ratio=f[0]||"1:1",Y.size=b[0]||"2K"),r.type==="Video"&&(Y.ratio=f[0]||"16:9",Y.duration=z[0]||"5s",Y.resolution=I[0]||"720P");const ne=cE(Y,U),ie=fa(r.previewOverridePatch),Z=r.previewOverrideEnabled&&ie?$g({...ne},ie):ne,te=gE(r),pe=xE(te,Z),Te=tj.has(r.id),Qe=rj[r.id]||"",Be=(()=>{const G={modelName:r.modelName||r.id,prompt:"",ratio:Y.ratio||"1:1",resolution:Y.resolution||Y.size||"2K",size:Y.size||Y.resolution||"2K",duration:Y.duration||"5",durationNumber:od(Y.duration||"5",5),provider:{key:"API_KEY",baseUrl:"https://api.example.com"},imageUrl:"https://example.com/image.png",imageDataUrl:"data:image/png;base64,PLACEHOLDER"};return G.imageUrl1=G.imageUrl,G.imageUrl2=G.imageUrl,G.image1Url=G.imageUrl,G.image2Url=G.imageUrl,G.imageUrls=[G.imageUrl],G.imagesUrl=G.imageUrls,G.imagesUrls=G.imageUrls,U.length>0&&U.forEach(me=>{const $e=String((me==null?void 0:me.name)||"").trim();if(!$e)return;const jt=Array.isArray(me.values)&&me.values.length>0?me.values[0]:"";jt&&(G[$e]=jt)}),G})(),Le=W?sd(W,Be,{bodyType:W.bodyType}):null,it=Le&&r.requestOverrideEnabled&&J?Tg({...Le},J):Le,ut=Rg(it),xt=nj.has(r.id),Zt=sj[r.id]||(ut?JSON.stringify(ut,null,2):""),Nt=ij[r.id]||{headers:JSON.stringify((W==null?void 0:W.headers)||{},null,2),body:(W==null?void 0:W.bodyType)==="raw"?String((W==null?void 0:W.body)??""):JSON.stringify((W==null?void 0:W.body)||{},null,2),query:JSON.stringify((W==null?void 0:W.query)||{},null,2),files:JSON.stringify((W==null?void 0:W.files)||{},null,2),timeoutMs:(W==null?void 0:W.timeoutMs)??"",responseParser:(W==null?void 0:W.responseParser)||""},Ot=rp(r.asyncConfig),er=!!(Ot!=null&&Ot.enabled),pr=oj[r.id]||(Ot?JSON.stringify(Ot,null,2):eE),H=aj.has(r.id),ve=qy(r.id,"request-template"),qe=qy(r.id,"async-task"),Ze={requestId:"REQUEST_ID",prompt:"",provider:{key:"API_KEY",baseUrl:"https://api.example.com"}},vt=Ot!=null&&Ot.statusRequest?sd(Ot.statusRequest,Ze,{bodyType:Ot.statusRequest.bodyType}):null,Mt=Rg(vt),Et=Ot!=null&&Ot.outputsRequest?sd(Ot.outputsRequest,Ze,{bodyType:Ot.outputsRequest.bodyType}):null,Lt=Rg(Et),wt=G=>{const me=Gi({...W||xo(r),...G});Gr(r.id,{requestTemplate:me})};return i.jsxs("div",{className:`rounded-lg border p-3 space-y-3 ${e==="dark"?"bg-[#18181b] border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#d7cfb2]":"bg-white border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-start justify-between gap-2",children:[i.jsxs("div",{className:"flex flex-col gap-1 flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 w-full",children:[i.jsx("div",{className:`text-xs font-medium ${e==="dark"?"text-zinc-200":"text-zinc-800"}`,children:r.displayName||r.modelName||r.id}),i.jsx("div",{className:"ml-auto flex items-center justify-end",children:o?i.jsxs("select",{value:r.type||"Chat",onChange:G=>Gr(r.id,{type:G.target.value}),className:`text-[9px] px-1 py-0.5 rounded border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-700 text-zinc-300":"bg-white border-zinc-300 text-zinc-700"}`,disabled:!o,children:[i.jsx("option",{value:"Chat",children:"Chat"}),i.jsx("option",{value:"Image",children:"Image"}),i.jsx("option",{value:"ChatImage",children:"Chat Image"}),i.jsx("option",{value:"Video",children:"Video"})]}):i.jsx("span",{className:`text-[9px] px-1.5 py-0.5 rounded ${e==="dark"?"bg-zinc-800 text-zinc-300":e==="solarized"?"bg-[#eee8d5] text-zinc-600":"bg-zinc-100 text-zinc-600"}`,children:r.type||"Chat"})})]}),i.jsxs("div",{className:"text-[9px] text-zinc-500",children:[j("ID"),r.modelName||r.id]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("button",{onClick:()=>Yy(r.id),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(u?"":""),children:i.jsx(Hu,{size:12,className:u?"text-blue-500":""})}),i.jsx("button",{onClick:()=>Dj(r.id),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(""),children:i.jsx(Jl,{size:12})}),i.jsx("button",{onClick:()=>Vj(r.id),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(l?"":""),children:i.jsx(Zn,{size:12,className:`transition-transform ${l?"":"rotate-180"}`})}),i.jsx("button",{onClick:()=>rN(r),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(""),children:i.jsx(aa,{size:12})}),i.jsx("button",{onClick:()=>Hj(r.id,!o),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(o?"":""),children:o?i.jsx(Xl,{size:12}):i.jsx(jg,{size:12})}),i.jsx("button",{onClick:()=>Bj(r.id),className:`p-1 ${e==="dark"?"text-zinc-500 hover:text-red-400":"text-zinc-400 hover:text-red-500"}`,title:j(""),children:i.jsx(Is,{size:12})})]})]}),!l&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-12 gap-2 items-end",children:[i.jsxs("div",{className:"col-span-5 space-y-1",children:[i.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsx("input",{className:`w-full text-xs rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,value:r.displayName||"",onChange:G=>Gr(r.id,{displayName:G.target.value}),placeholder:j(""),disabled:!o})]}),i.jsxs("div",{className:"col-span-5 space-y-1",children:[i.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("ID")}),i.jsx("input",{className:`w-full text-xs rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,value:r.modelName||"",onChange:G=>Gr(r.id,{modelName:G.target.value}),placeholder:j("gemini-3-pro-image-preview"),disabled:!o})]}),i.jsxs("div",{className:"col-span-2 space-y-1",children:[i.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("select",{value:r.apiType||"openai",onChange:G=>Gr(r.id,{apiType:G.target.value}),className:`w-full text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,disabled:!o,children:[i.jsx("option",{value:"openai",children:"OpenAI"}),i.jsx("option",{value:"gemini",children:"Gemini"}),i.jsx("option",{value:"modelscope",children:"ModelScope"})]})]})]}),zs(r.type)&&i.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[i.jsxs("div",{className:"col-span-6",children:[i.jsx(rd,{label:j(""),values:f,onChange:G=>{const me={...m};Object.keys(me).forEach($e=>{G.includes($e)||delete me[$e]}),Gr(r.id,{ratioLimits:G,ratioNotes:me})},placeholder:j("1:1,16:9"),disabled:!o,inputDisabled:!o||p,theme:e,allowAllLabel:j(""),allowAll:p,onToggleAll:G=>Gr(r.id,{ratioLimits:G?null:[]}),formatItem:G=>Qn(G,y,m)}),f.length>0&&i.jsxs("div",{className:"mt-1 space-y-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:y,onChange:G=>Gr(r.id,{ratioNotesEnabled:G.target.checked}),disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("")}),i.jsx("button",{onClick:()=>Kc(r.id,"ratio"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:vs(r.id,"ratio")?j(""):j(""),children:i.jsx(Zn,{size:12,className:`transition-transform ${vs(r.id,"ratio")?"":"rotate-180"}`})})]}),y&&!vs(r.id,"ratio")&&f.map(G=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:G,children:G}),i.jsx("input",{value:m[G]||"",onChange:me=>{const $e={...m},jt=me.target.value;jt?$e[G]=jt:delete $e[G],Gr(r.id,{ratioNotes:$e})},placeholder:j("1:1 / "),disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},G))]})]}),i.jsxs("div",{className:"col-span-6",children:[i.jsx(rd,{label:j(""),values:b,onChange:G=>{const me={...w};Object.keys(me).forEach($e=>{G.includes($e)||delete me[$e]}),Gr(r.id,{resolutionLimits:G,resolutionNotes:me})},placeholder:j("1K,2K,4K"),disabled:!o,theme:e,normalizeItem:G=>xp(G),formatItem:G=>Qn(G,v,w)}),b.length>0&&i.jsxs("div",{className:"mt-1 space-y-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:v,onChange:G=>Gr(r.id,{resolutionNotesEnabled:G.target.checked}),disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("")}),i.jsx("button",{onClick:()=>Kc(r.id,"resolution"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:vs(r.id,"resolution")?j(""):j(""),children:i.jsx(Zn,{size:12,className:`transition-transform ${vs(r.id,"resolution")?"":"rotate-180"}`})})]}),v&&!vs(r.id,"resolution")&&b.map(G=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:G,children:G}),i.jsx("input",{value:w[G]||"",onChange:me=>{const $e={...w},jt=me.target.value;jt?$e[G]=jt:delete $e[G],Gr(r.id,{resolutionNotes:$e})},placeholder:j("1:1 / "),disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},G))]})]})]}),r.type==="Video"&&i.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[i.jsxs("div",{className:"col-span-4",children:[i.jsx(rd,{label:j(""),values:f,onChange:G=>{const me={...m};Object.keys(me).forEach($e=>{G.includes($e)||delete me[$e]}),Gr(r.id,{ratioLimits:G,ratioNotes:me})},placeholder:j("16:9,9:16"),disabled:!o,inputDisabled:!o||p,theme:e,allowAllLabel:j(""),allowAll:p,onToggleAll:G=>Gr(r.id,{ratioLimits:G?null:[]}),formatItem:G=>Qn(G,y,m)}),f.length>0&&i.jsxs("div",{className:"mt-1 space-y-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:y,onChange:G=>Gr(r.id,{ratioNotesEnabled:G.target.checked}),disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("")}),i.jsx("button",{onClick:()=>Kc(r.id,"ratio"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:vs(r.id,"ratio")?j(""):j(""),children:i.jsx(Zn,{size:12,className:`transition-transform ${vs(r.id,"ratio")?"":"rotate-180"}`})})]}),y&&!vs(r.id,"ratio")&&f.map(G=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:G,children:G}),i.jsx("input",{value:m[G]||"",onChange:me=>{const $e={...m},jt=me.target.value;jt?$e[G]=jt:delete $e[G],Gr(r.id,{ratioNotes:$e})},placeholder:j("16:9 / "),disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},G))]})]}),i.jsxs("div",{className:"col-span-4",children:[i.jsx(rd,{label:j(""),values:z,onChange:G=>{const me={...k};Object.keys(me).forEach($e=>{G.includes($e)||delete me[$e]}),Gr(r.id,{durations:G,durationNotes:me})},placeholder:j("5s,10s"),disabled:!o,theme:e,normalizeItem:G=>{const me=String(G).trim();return me.endsWith("s")?me:`${me}s`},formatItem:G=>Qn(G,T,k)}),z.length>0&&i.jsxs("div",{className:"mt-1 space-y-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:T,onChange:G=>Gr(r.id,{durationNotesEnabled:G.target.checked}),disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("")}),i.jsx("button",{onClick:()=>Kc(r.id,"duration"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:vs(r.id,"duration")?j(""):j(""),children:i.jsx(Zn,{size:12,className:`transition-transform ${vs(r.id,"duration")?"":"rotate-180"}`})})]}),T&&!vs(r.id,"duration")&&z.map(G=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:G,children:G}),i.jsx("input",{value:k[G]||"",onChange:me=>{const $e={...k},jt=me.target.value;jt?$e[G]=jt:delete $e[G],Gr(r.id,{durationNotes:$e})},placeholder:j("5s / "),disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},G))]})]}),i.jsxs("div",{className:"col-span-4",children:[i.jsx(rd,{label:j(""),values:I,onChange:G=>{const me={...F};Object.keys(me).forEach($e=>{G.includes($e)||delete me[$e]}),Gr(r.id,{videoResolutions:G,videoResolutionNotes:me})},placeholder:j("720P,1080P"),disabled:!o,theme:e,normalizeItem:G=>ca(G),formatItem:G=>Qn(G,B,F)}),I.length>0&&i.jsxs("div",{className:"mt-1 space-y-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:B,onChange:G=>Gr(r.id,{videoResolutionNotesEnabled:G.target.checked}),disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("")}),i.jsx("button",{onClick:()=>Kc(r.id,"video-resolution"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:vs(r.id,"video-resolution")?j(""):j(""),children:i.jsx(Zn,{size:12,className:`transition-transform ${vs(r.id,"video-resolution")?"":"rotate-180"}`})})]}),B&&!vs(r.id,"video-resolution")&&I.map(G=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:G,children:G}),i.jsx("input",{value:F[G]||"",onChange:me=>{const $e={...F},jt=me.target.value;jt?$e[G]=jt:delete $e[G],Gr(r.id,{videoResolutionNotes:$e})},placeholder:j("16:9 / "),disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},G))]})]}),i.jsxs("div",{className:"col-span-12 flex items-center gap-3 pt-1",children:[i.jsxs("label",{className:`flex items-center gap-1 text-[10px] ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:!!r.supportsFirstLastFrame,onChange:G=>Gr(r.id,{supportsFirstLastFrame:G.target.checked}),className:"w-3 h-3 cursor-pointer",disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsxs("label",{className:`flex items-center gap-1 text-[10px] ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:!!r.supportsHD,onChange:G=>Gr(r.id,{supportsHD:G.target.checked}),className:"w-3 h-3 cursor-pointer",disabled:!o}),i.jsx("span",{children:"HD"})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("label",{className:`text-[9px] font-medium uppercase tracking-wider ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("button",{onClick:()=>Uj(r.id),disabled:!o||U.length>=qu,className:`text-[9px] px-1.5 py-0.5 rounded ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-200 text-zinc-600 hover:bg-zinc-300"} ${!o||U.length>=qu?"opacity-50 cursor-not-allowed":""}`,children:["+  (",U.length,"/",qu,")"]})]}),U.length>0?i.jsx("div",{className:"space-y-2",children:U.map(G=>i.jsx("div",{className:`rounded-md border p-2 space-y-2 ${e==="dark"?"bg-zinc-900/60 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:(()=>{const me=Array.isArray(G.values)?G.values:[],$e=G.valueNotes||{},jt=!!G.notesEnabled;return i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{value:G.name||"",onChange:lt=>yu(r.id,G.id,{name:lt.target.value}),placeholder:j(" size / quality / model"),disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`}),i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:!!G.override,onChange:lt=>yu(r.id,G.id,{override:lt.target.checked}),disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("button",{onClick:()=>Fj(r.id,G.id),disabled:!o,className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-red-400":"text-zinc-400 hover:text-red-500"} ${o?"":"opacity-40 cursor-not-allowed"}`,title:j(""),children:i.jsx(Is,{size:12})})]}),i.jsx(rd,{label:j(""),values:me,onChange:lt=>{const ir={...$e};Object.keys(ir).forEach(Ht=>{lt.includes(Ht)||delete ir[Ht]}),yu(r.id,G.id,{values:lt,valueNotes:ir})},placeholder:j("1024x1024,2K,low,high"),disabled:!o,theme:e,formatItem:lt=>Bw(G,lt),maxItems:sE}),me.length>0&&i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:jt,onChange:lt=>yu(r.id,G.id,{notesEnabled:lt.target.checked}),disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("span",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("")}),i.jsx("button",{onClick:()=>Kc(r.id,`param-${G.id}`),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:vs(r.id,`param-${G.id}`)?j(""):j(""),children:i.jsx(Zn,{size:12,className:`transition-transform ${vs(r.id,`param-${G.id}`)?"":"rotate-180"}`})})]}),jt&&!vs(r.id,`param-${G.id}`)&&me.map(lt=>i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:`text-[9px] w-24 truncate ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,title:lt,children:lt}),i.jsx("input",{value:$e[lt]||"",onChange:ir=>{const Ht={...$e},ae=ir.target.value;ae?Ht[lt]=ae:delete Ht[lt],yu(r.id,G.id,{valueNotes:Ht})},placeholder:j("1:1 / "),disabled:!o,className:`flex-1 text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]},lt))]})]})})()},G.id))}):i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:j("")})]}),i.jsxs("div",{className:`rounded-md border p-2 ${e==="dark"?"bg-zinc-950/60 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:X,onChange:G=>wt({enabled:G.target.checked}),disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("button",{onClick:()=>{ve&&_f(r.id,"request-template"),Yy(r.id)},className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(u?"":""),children:i.jsx(Hu,{size:12,className:u?"text-blue-500":""})}),i.jsx("button",{onClick:()=>_f(r.id,"request-template"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(ve?"":""),children:i.jsx(Zn,{size:12,className:`transition-transform ${ve?"":"rotate-180"}`})})]})]}),!ve&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-12 gap-2",children:[i.jsxs("div",{className:"col-span-7 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsx("input",{value:(W==null?void 0:W.endpoint)||"",onChange:G=>wt({endpoint:G.target.value}),placeholder:"/v1/images/generations",disabled:!o,className:`w-full text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]}),i.jsxs("div",{className:"col-span-2 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("select",{value:(W==null?void 0:W.method)||"POST",onChange:G=>wt({method:G.target.value}),disabled:!o,className:`w-full text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,children:[i.jsx("option",{value:"POST",children:"POST"}),i.jsx("option",{value:"GET",children:"GET"}),i.jsx("option",{value:"PUT",children:"PUT"}),i.jsx("option",{value:"PATCH",children:"PATCH"}),i.jsx("option",{value:"DELETE",children:"DELETE"})]})]}),i.jsxs("div",{className:"col-span-3 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"BodyType"}),i.jsxs("select",{value:(W==null?void 0:W.bodyType)||"json",onChange:G=>{wt({bodyType:G.target.value}),_o(me=>{if(!me[r.id])return me;const{[r.id]:$e,...jt}=me;return jt})},disabled:!o,className:`w-full text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`,children:[i.jsx("option",{value:"auto",children:j("")}),i.jsx("option",{value:"json",children:"json"}),i.jsx("option",{value:"multipart",children:"multipart"}),i.jsx("option",{value:"raw",children:"raw"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-12 gap-2 mt-2",children:[i.jsxs("div",{className:"col-span-6 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("JSON")}),i.jsx("textarea",{value:Nt.headers,onChange:G=>_o(me=>({...me,[r.id]:{...Nt,headers:G.target.value}})),disabled:!o,className:`w-full h-24 text-[9px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-200":"bg-white border-zinc-300 text-zinc-800"}`})]}),i.jsxs("div",{className:"col-span-6 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("JSON / Raw")}),i.jsx("textarea",{value:Nt.body,onChange:G=>_o(me=>({...me,[r.id]:{...Nt,body:G.target.value}})),disabled:!o,className:`w-full h-24 text-[9px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-200":"bg-white border-zinc-300 text-zinc-800"}`})]})]}),i.jsxs("div",{className:"grid grid-cols-12 gap-2 mt-2",children:[i.jsxs("div",{className:"col-span-6 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"QueryJSON"}),i.jsx("textarea",{value:Nt.query,onChange:G=>_o(me=>({...me,[r.id]:{...Nt,query:G.target.value}})),disabled:!o,className:`w-full h-20 text-[9px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-200":"bg-white border-zinc-300 text-zinc-800"}`})]}),i.jsxs("div",{className:"col-span-6 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:"FilesJSON"}),i.jsx("textarea",{value:Nt.files,onChange:G=>_o(me=>({...me,[r.id]:{...Nt,files:G.target.value}})),disabled:!o,className:`w-full h-20 text-[9px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-200":"bg-white border-zinc-300 text-zinc-800"}`})]})]}),i.jsxs("div",{className:"grid grid-cols-12 gap-2 mt-2",children:[i.jsxs("div",{className:"col-span-4 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("ms")}),i.jsx("input",{type:"number",min:"0",value:Nt.timeoutMs,onChange:G=>_o(me=>({...me,[r.id]:{...Nt,timeoutMs:G.target.value}})),disabled:!o,className:`w-full text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300":"bg-white border-zinc-300 text-zinc-900"}`})]}),i.jsxs("div",{className:"col-span-8 space-y-1",children:[i.jsx("label",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsx("input",{value:Nt.responseParser,onChange:G=>_o(me=>({...me,[r.id]:{...Nt,responseParser:G.target.value}})),disabled:!o,placeholder:j("openai.image / jimeng.video"),className:`w-full text-[10px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-300 placeholder-zinc-600":"bg-white border-zinc-300 text-zinc-900 placeholder-zinc-400"}`})]})]}),i.jsxs("div",{className:"flex items-center justify-between mt-2",children:[i.jsxs("div",{className:"text-[9px] text-zinc-500",children:["","{{prompt}}",", ","{{duration:number}}",", ","{{image:blob}}",", ","{{size}}"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>{var G,me,$e;try{const jt=((G=Nt.headers)==null?void 0:G.trim())||"{}",lt=Nt.body??"",ir=((me=Nt.query)==null?void 0:me.trim())||"{}",Ht=(($e=Nt.files)==null?void 0:$e.trim())||"{}",ae=jt?JSON.parse(jt):{};if(!ae||typeof ae!="object"||Array.isArray(ae))throw new Error("");const He=ir?JSON.parse(ir):{};if(!He||typeof He!="object"||Array.isArray(He))throw new Error("Query ");const Pe=Ht?JSON.parse(Ht):{};if(!Pe||typeof Pe!="object"||Array.isArray(Pe))throw new Error("Files ");let bt=lt;if(((W==null?void 0:W.bodyType)||"json")!=="raw"){const Pt=(lt==null?void 0:lt.trim())||"{}";if(bt=Pt?JSON.parse(Pt):{},!bt||typeof bt!="object")throw new Error("")}const rt=Nt.timeoutMs,It=rt===""||rt===null||rt===void 0?null:Number(rt);if(It!==null&&(!Number.isFinite(It)||It<0))throw new Error("");const nt=(Nt.responseParser||"").trim();wt({headers:ae,body:bt,query:He,files:Pe,timeoutMs:It,responseParser:nt}),_o(Pt=>{const{[r.id]:$t,...or}=Pt;return or}),d("","success",2e3)}catch{d(" JSON ","error",2e3)}},disabled:!o,className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-700 text-zinc-200 hover:bg-zinc-600":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"} ${o?"":"opacity-60 cursor-not-allowed"}`,children:j("")}),i.jsx("button",{onClick:()=>{Gr(r.id,{requestTemplate:xo(r)}),_o(G=>{const{[r.id]:me,...$e}=G;return $e})},disabled:!o,className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-500 hover:bg-zinc-200"} ${o?"":"opacity-60 cursor-not-allowed"}`,children:j("")})]})]})]})]}),i.jsxs("div",{className:`rounded-md border p-2 mt-3 ${e==="dark"?"bg-zinc-950/60 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:er,onChange:G=>{const me=G.target.checked,$e=Ot||tE();Gr(r.id,{asyncConfig:{...$e,enabled:me}})},disabled:!o}),i.jsx("span",{children:j("")})]}),i.jsx("button",{onClick:()=>{qe&&_f(r.id,"async-task"),Wj(r.id)},className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(H?"":""),children:i.jsx(Hu,{size:12,className:H?"text-blue-500":""})}),i.jsx("button",{onClick:()=>_f(r.id,"async-task"),className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(qe?"":""),children:i.jsx(Zn,{size:12,className:`transition-transform ${qe?"":"rotate-180"}`})})]})]}),!qe&&i.jsxs(i.Fragment,{children:[i.jsx("textarea",{value:pr,onChange:G=>rm(me=>({...me,[r.id]:G.target.value})),disabled:!o,className:`w-full h-48 text-[9px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-200":"bg-white border-zinc-300 text-zinc-800"}`}),i.jsxs("div",{className:"flex items-center justify-between mt-2",children:[i.jsxs("div",{className:"text-[9px] text-zinc-500",children:["","{{requestId}}",", ","{{provider.key}}",", ","{{provider.baseUrl}}"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>{try{const G=pr?JSON.parse(pr):{};if(!G||typeof G!="object"||Array.isArray(G))throw new Error("");Gr(r.id,{asyncConfig:G}),rm(me=>{const{[r.id]:$e,...jt}=me;return jt}),d("","success",2e3)}catch{d(" JSON ","error",2e3)}},disabled:!o,className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-700 text-zinc-200 hover:bg-zinc-600":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"} ${o?"":"opacity-60 cursor-not-allowed"}`,children:j("")}),i.jsx("button",{onClick:()=>{Gr(r.id,{asyncConfig:null}),rm(G=>{const{[r.id]:me,...$e}=G;return $e})},disabled:!o,className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-500 hover:bg-zinc-200"} ${o?"":"opacity-60 cursor-not-allowed"}`,children:j("")})]})]}),H&&i.jsxs("div",{className:`mt-2 rounded-md border p-2 ${e==="dark"?"bg-zinc-950/60 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[i.jsx("div",{className:`text-[9px] mb-1 ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),Mt?i.jsx("pre",{className:`text-[9px] whitespace-pre-wrap ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:JSON.stringify(Mt,null,2)}):i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("")}),i.jsx("div",{className:`text-[9px] mt-2 mb-1 ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),Lt?i.jsx("pre",{className:`text-[9px] whitespace-pre-wrap ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:JSON.stringify(Lt,null,2)}):i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:j("")})]})]})]}),u&&i.jsxs("div",{className:`rounded-md border p-2 ${e==="dark"?"bg-zinc-950/60 border-zinc-800":e==="solarized"?"bg-[#fdf6e3] border-[#eee8d5]":"bg-zinc-50 border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("JSON")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:!!r.previewOverrideEnabled,onChange:G=>Gr(r.id,{previewOverrideEnabled:G.target.checked})}),i.jsx("span",{children:j("")})]}),i.jsx("button",{onClick:()=>{Te?(Ec(G=>{const me=new Set(G);return me.delete(r.id),me}),El(G=>{const{[r.id]:me,...$e}=G;return $e})):(Ec(G=>{const me=new Set(G);return me.add(r.id),me}),El(G=>({...G,[r.id]:JSON.stringify(Z,null,2)})))},className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(Te?"":""),children:i.jsx(kg,{size:12,className:Te?"text-blue-500":""})})]})]}),i.jsxs("div",{className:`text-[9px] mb-1 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:["Endpoint: ",te]}),Te?i.jsxs("div",{className:"space-y-2",children:[i.jsx("textarea",{value:Qe,onChange:G=>El(me=>({...me,[r.id]:G.target.value})),className:`w-full h-40 text-[9px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-200":"bg-white border-zinc-300 text-zinc-800"}`}),i.jsxs("div",{className:"flex items-center justify-end gap-2",children:[i.jsx("button",{onClick:()=>{try{const G=Qe?JSON.parse(Qe):{};if(!G||typeof G!="object"||Array.isArray(G))throw new Error(" JSON ");const me=Vw(ne,G);Gr(r.id,{previewOverridePatch:me}),Ec($e=>{const jt=new Set($e);return jt.delete(r.id),jt}),El($e=>{const{[r.id]:jt,...lt}=$e;return lt}),d("","success",2e3)}catch{d("JSON ","error",2e3)}},className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-700 text-zinc-200 hover:bg-zinc-600":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"}`,children:j("")}),i.jsx("button",{onClick:()=>{Ec(G=>{const me=new Set(G);return me.delete(r.id),me}),El(G=>{const{[r.id]:me,...$e}=G;return $e})},className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-500 hover:bg-zinc-200"}`,children:j("")})]})]}):i.jsx("pre",{className:`text-[9px] whitespace-pre-wrap ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:JSON.stringify(Z,null,2)}),i.jsx("div",{className:`text-[9px] mt-2 mb-1 ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("Python ")}),i.jsx("pre",{className:`text-[9px] whitespace-pre-wrap ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:pe}),i.jsxs("div",{className:"mt-3 pt-2 border-t border-dashed border-zinc-400/30",children:[i.jsxs("div",{className:"flex items-center justify-between mb-1",children:[i.jsx("div",{className:`text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:j("")}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("label",{className:`flex items-center gap-1 text-[9px] ${e==="dark"?"text-zinc-500":"text-zinc-600"}`,children:[i.jsx("input",{type:"checkbox",checked:!!r.requestOverrideEnabled,onChange:G=>Gr(r.id,{requestOverrideEnabled:G.target.checked})}),i.jsx("span",{children:j("")})]}),i.jsx("button",{onClick:()=>{xt?(Ic(G=>{const me=new Set(G);return me.delete(r.id),me}),Il(G=>{const{[r.id]:me,...$e}=G;return $e})):(Ic(G=>{const me=new Set(G);return me.add(r.id),me}),Il(G=>({...G,[r.id]:ut?JSON.stringify(ut,null,2):""})))},className:`p-1 rounded ${e==="dark"?"text-zinc-500 hover:text-zinc-300":"text-zinc-400 hover:text-zinc-600"}`,title:j(xt?"":""),children:i.jsx(kg,{size:12,className:xt?"text-blue-500":""})})]})]}),i.jsxs("div",{className:`text-[9px] mb-1 ${e==="dark"?"text-zinc-600":"text-zinc-500"}`,children:["",j(X?"":""),"  BodyType: ",(W==null?void 0:W.bodyType)||"json"]}),xt?i.jsxs("div",{className:"space-y-2",children:[i.jsx("textarea",{value:Zt,onChange:G=>Il(me=>({...me,[r.id]:G.target.value})),className:`w-full h-40 text-[9px] rounded px-2 py-1 border outline-none ${e==="dark"?"bg-zinc-900 border-zinc-800 text-zinc-200":"bg-white border-zinc-300 text-zinc-800"}`}),i.jsxs("div",{className:"flex items-center justify-end gap-2",children:[i.jsx("button",{onClick:()=>{try{const G=Zt?JSON.parse(Zt):{};if(!G||typeof G!="object"||Array.isArray(G))throw new Error("");const me=Vw(ut||{},G);Gr(r.id,{requestOverridePatch:me}),Ic($e=>{const jt=new Set($e);return jt.delete(r.id),jt}),Il($e=>{const{[r.id]:jt,...lt}=$e;return lt}),d("","success",2e3)}catch{d(" JSON ","error",2e3)}},className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-700 text-zinc-200 hover:bg-zinc-600":"bg-zinc-200 text-zinc-700 hover:bg-zinc-300"}`,children:j("")}),i.jsx("button",{onClick:()=>{Ic(G=>{const me=new Set(G);return me.delete(r.id),me}),Il(G=>{const{[r.id]:me,...$e}=G;return $e})},className:`px-2 py-1 rounded text-[9px] ${e==="dark"?"bg-zinc-800 text-zinc-400 hover:bg-zinc-700":"bg-zinc-100 text-zinc-500 hover:bg-zinc-200"}`,children:j("")})]})]}):i.jsx("pre",{className:`text-[9px] whitespace-pre-wrap ${e==="dark"?"text-zinc-300":"text-zinc-700"}`,children:ut?JSON.stringify(ut,null,2):""})]})]})]})]},r.id)})}),i.jsx("p",{className:"text-[9px] text-zinc-500",children:"ID"})]}),i.jsx("div",{className:`pt-2 flex justify-end gap-2 border-t mt-3 ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:i.jsx(yh,{variant:"secondary",onClick:()=>bi(!1),children:j("")})})]}),hj&&i.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[i.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>{lf(!1),Al(new Set)}}),i.jsxs("div",{className:`relative w-[90vw] h-[85vh] max-w-7xl rounded-lg shadow-2xl flex flex-col ${e==="dark"?"bg-[#121214] border border-zinc-800":e==="solarized"?"bg-[#eee8d5] border border-[#d7cfb2]":"bg-white border border-zinc-200"}`,children:[i.jsxs("div",{className:`p-4 border-b flex items-center justify-between ${e==="dark"?"border-zinc-800":"border-zinc-200"}`,children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("h2",{className:`text-lg font-bold ${e==="dark"?"text-zinc-100":"text-zinc-900"}`,children:j("")}),i.jsxs("span",{className:`text-sm ${e==="dark"?"text-zinc-400":"text-zinc-600"}`,children:[" ",us.size," "]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>{us.size===Bt.length?Al(new Set):Al(new Set(Bt.map(r=>r.id)))},className:`px-3 py-1.5 text-xs rounded transition-colors ${e==="dark"?"bg-zinc-800 text-zinc-300 hover:bg-zinc-700":"bg-zinc-100 text-zinc-700 hover:bg-zinc-200"}`,children:us.size===Bt.length?j(""):j("")}),i.jsxs("button",{onClick:()=>{us.size!==0&&confirm(` ${us.size} `)&&(Rt(r=>{const o=r.filter(l=>!us.has(l.id));try{localStorage.setItem("tapnow_history",JSON.stringify(o))}catch(l){console.error(":",l)}return o}),Al(new Set))},disabled:us.size===0,className:`px-3 py-1.5 text-xs rounded transition-colors flex items-center gap-1.5 ${us.size===0?e==="dark"?"bg-zinc-800/50 text-zinc-600 cursor-not-allowed":"bg-zinc-100 text-zinc-400 cursor-not-allowed":"bg-red-600 text-white hover:bg-red-700"}`,children:[i.jsx(Is,{size:14}),j("")]}),i.jsxs("button",{onClick:async()=>{if(us.size===0)return;const r=(yr||"").replace(/\/+$/,"");if(!r){d("","error");return}const l=Bt.filter(u=>us.has(u.id)).map(u=>u.localFilePath||u.localCacheUrl).filter(Boolean);if(l.length===0){d("","warning");return}try{const u=await fetch(`${r}/delete-batch`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({files:l})});if(!u.ok){const f=await u.text();throw new Error(f||"")}const p=await u.json();Rt(f=>f.map(m=>us.has(m.id)?{...m,localCacheUrl:null,localFilePath:null}:m)),d((p==null?void 0:p.message)||` ${l.length} `,"success")}catch(u){d(`: ${u.message||""}`,"error")}},disabled:us.size===0,className:`px-3 py-1.5 text-xs rounded transition-colors flex items-center gap-1.5 ${us.size===0?e==="dark"?"bg-zinc-800/50 text-zinc-600 cursor-not-allowed":"bg-zinc-100 text-zinc-400 cursor-not-allowed":e==="dark"?"bg-amber-600/30 text-amber-200 hover:bg-amber-600/40":"bg-amber-100 text-amber-600 hover:bg-amber-200"}`,children:[i.jsx(Is,{size:14}),j("")]}),i.jsxs("button",{onClick:async()=>{if(us.size===0)return;const r=Bt.filter(p=>us.has(p.id)&&(p.url||p.localCacheUrl||p.originalUrl||p.mjOriginalUrl));if(r.length===0){alert(j(""));return}const o=Hr(window.innerWidth/2,window.innerHeight/2),l=o.x,u=o.y;r.forEach((p,f)=>{const m=f%5*20,y=Math.floor(f/5)*20;let b=p.localCacheUrl||p.url||p.originalUrl||p.mjOriginalUrl;p.type==="video"&&!ur(b)&&(b+=(b.includes("?")?"&":"?")+"force_video_display=true"),p.type==="image"?(async()=>{try{const w=await os(b);is("input-image",l+m,u+y,null,b,w)}catch{is("input-image",l+m,u+y,null,b)}})():p.type==="video"&&is("video-input",l+m,u+y,null,b)}),lf(!1),Al(new Set)},disabled:us.size===0,className:`px-3 py-1.5 text-xs rounded transition-colors flex items-center gap-1.5 ${us.size===0?e==="dark"?"bg-zinc-800/50 text-zinc-600 cursor-not-allowed":"bg-zinc-100 text-zinc-400 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:[i.jsx(vg,{size:14}),j("")]}),i.jsx("button",{onClick:()=>{lf(!1),Al(new Set)},className:`p-1.5 rounded transition-colors ${e==="dark"?"text-zinc-400 hover:text-zinc-200 hover:bg-zinc-800":"text-zinc-500 hover:text-zinc-700 hover:bg-zinc-200"}`,children:i.jsx(ui,{size:18})})]})]}),i.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-4",children:i.jsx("div",{className:"grid grid-cols-4 gap-4",children:Bt.map(r=>{var te,pe,Te,Qe,Be;const o=us.has(r.id),l=r.modelName||((te=r.apiConfig)==null?void 0:te.modelId)||((pe=r.apiConfig)==null?void 0:pe.model)||((Te=r.apiConfig)==null?void 0:Te.modelName)||r.model||"",u=l.length>12?`${l.slice(0,9)}...`:l,p=(Kt?r.localCacheUrl||(r.localCacheMap?Object.values(r.localCacheMap)[0]:null):null)||r.url||r.originalUrl||r.mjOriginalUrl,f=r.mjImages&&r.mjImages.length>0?r.mjImages:r.output_images&&r.output_images.length>0?r.output_images:null,m=f?f.map(Le=>Kt&&r.localCacheMap&&r.localCacheMap[Le]?r.localCacheMap[Le]:Le):null,y=typeof r.selectedMjImageIndex=="number"?r.selectedMjImageIndex:0,b=m?Math.min(y,m.length-1):0,w=m&&m.length>=4?m.slice(0,4):null,v=w?Math.min(b,w.length-1):0,z=m?m[b]||m[0]:p,k=Ar(r,z),T=w?w.map(Le=>Ar(r,Le)).filter(Boolean):null,I=!!(Kt&&(r.localCacheUrl||r.localFilePath||r.localCacheMap&&Object.keys(r.localCacheMap).length>0)),F=r.type==="video"||(k?ur(k):!1),B=r.ratio||r.mjRatio||"",U=r.resolution||(r.width&&r.height?`${r.width}x${r.height}`:""),W=U?U.replace(/p$/i,""):"",X=F&&r.duration?`${String(r.duration).replace(/s$/i,"")}s`:"",J=[B,W].filter(Boolean);F&&X&&J.push(X);const Y=J.join("/"),ne=r.startTime?new Date(r.startTime).toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"}):r.time||"",ie=typeof r.durationMs=="number"&&r.durationMs>0?`${(r.durationMs/6e4).toFixed(1)}m`:"",Z=F?r.hasInputImages?"":"":r.hasInputImages?"":"";return i.jsxs("div",{className:`relative rounded-lg overflow-hidden border-2 transition-all ${o?"border-blue-500 shadow-lg shadow-blue-500/20":e==="dark"?"border-zinc-800 hover:border-zinc-700":"border-zinc-200 hover:border-zinc-300"}`,children:[i.jsxs("div",{className:"absolute top-2 right-2 z-10 flex items-center gap-1.5",children:[o&&i.jsx("div",{className:"bg-blue-500 rounded-full p-1",children:i.jsx(Xl,{size:16,className:"text-white"})}),r.status==="completed"&&k&&i.jsx("button",{onClick:Le=>{Le.stopPropagation();const it={...r,url:k,selectedMjImageIndex:f&&f.length>1?b:void 0};gn(it)},className:`p-1.5 rounded-full transition-colors backdrop-blur-sm ${e==="dark"?"bg-black/60 text-white hover:bg-black/80":"bg-white/80 text-zinc-700 hover:bg-white"}`,title:j(" ()"),children:i.jsx(mo,{size:14})})]}),i.jsxs("div",{className:`relative ${f&&f.length>1||r.mjNeedsSplit&&((Be=(Qe=r.apiConfig)==null?void 0:Qe.modelId)!=null&&Be.includes("mj"))?(()=>{const Le=r.mjRatio||"1:1";return Le==="16:9"?"aspect-video":Le==="9:16"?"aspect-[9/16]":Le==="4:3"?"aspect-[4/3]":Le==="3:4"?"aspect-[3/4]":Le==="21:9"?"aspect-[21/9]":"aspect-square"})():"aspect-video"} ${e==="dark"?"bg-zinc-900":"bg-zinc-100"}`,children:[I&&i.jsx("div",{className:"absolute top-2 left-2 z-10 text-[9px] px-2 py-0.5 rounded bg-orange-500 text-white shadow",children:""}),r.status==="completed"&&(k||T&&T.length>0)?F?i.jsx(pa,{src:k,className:"w-full h-full object-contain",controls:!0,playsInline:!0,preload:"metadata"}):T&&T.length>0?i.jsx("div",{className:"grid grid-cols-2 grid-rows-2 w-full h-full",children:T.map((Le,it)=>{const ut=v===it;return i.jsxs("div",{className:`relative w-full h-full cursor-pointer ${ut?"ring-2 ring-blue-400":""}`,onClick:xt=>{xt.stopPropagation(),Rt(Zt=>Zt.map(Nt=>Nt.id===r.id?{...Nt,selectedMjImageIndex:it}:Nt))},onDoubleClick:xt=>{xt.preventDefault(),xt.stopPropagation(),gn({...r,url:Le,selectedMjImageIndex:it})},children:[i.jsx(nn,{src:Le,className:`w-full h-full object-cover ${ut?"opacity-80":""}`,alt:`-${it+1}`}),ut&&i.jsx("div",{className:"absolute inset-0 bg-black/20 pointer-events-none"}),i.jsx("div",{className:"absolute bottom-1 left-1 bg-black/60 text-white text-[9px] px-1.5 py-0.5 rounded",children:it+1})]},`${r.id}-${it}`)})}):i.jsx(nn,{src:k,className:"w-full h-full object-contain",alt:j(""),onError:Le=>{Le.target.style.display="none"}}):i.jsx("div",{className:`w-full h-full flex items-center justify-center ${e==="dark"?"text-zinc-600":"text-zinc-400"}`,children:r.status==="generating"?i.jsx(la,{size:24,className:"animate-spin"}):i.jsx(JC,{size:24})})]}),i.jsxs("div",{onClick:()=>{const Le=new Set(us);o?Le.delete(r.id):Le.add(r.id),Al(Le)},className:`p-2 text-xs cursor-pointer ${e==="dark"?"bg-zinc-900 text-zinc-300":"bg-zinc-50 text-zinc-700"}`,children:[i.jsx("div",{className:"truncate font-medium",children:r.prompt||""}),i.jsxs("div",{className:"text-[10px] opacity-70 mt-0.5",children:[i.jsxs("span",{children:[Z," "]}),i.jsx("span",{title:l,children:u}),Y&&i.jsxs("span",{children:["  ",Y]}),ne&&i.jsxs("span",{children:["  ",ne]}),ie&&i.jsxs("span",{children:["  ",ie]})]})]})]},r.id)})})})]})]})]})]})]}),i.jsx("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-[9999] flex flex-col gap-2 pointer-events-none",children:a.map(r=>i.jsx("div",{className:`px-4 py-2 rounded-lg shadow-lg text-sm font-medium pointer-events-auto animate-pulse ${r.type==="success"?"bg-green-600 text-white":r.type==="error"?"bg-red-600 text-white":r.type==="warning"?"bg-yellow-500 text-black":"bg-zinc-800 text-white"}`,children:r.message},r.id))})]})}const CE=5e3,h0=document.getElementById("root"),ba=rs.t.bind(rs);window.__APP_BOOTED__=!1;window.__APP_ERRORS__=window.__APP_ERRORS__||[];const Rp=(e,t={})=>{const n={time:new Date().toISOString(),message:(e==null?void 0:e.message)||String(e),stack:(e==null?void 0:e.stack)||"",meta:t};return window.__APP_ERRORS__.push(n),window.__APP_ERRORS__.length>50&&window.__APP_ERRORS__.shift(),n},L2=(e,t={})=>{const n=Rp(e,t);return JSON.stringify({latest:n,errors:window.__APP_ERRORS__},null,2)},D2=async e=>{var t;try{if((t=navigator==null?void 0:navigator.clipboard)!=null&&t.writeText)return await navigator.clipboard.writeText(e),!0}catch{}try{const n=document.createElement("textarea");return n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),!0}catch{return!1}},EE=(e,t={})=>{if(!h0)return;const n=L2(e,t);h0.innerHTML=`
      <div style="position:fixed;inset:0;background:#0b0b0c;color:#f3f3f3;display:flex;align-items:center;justify-content:center;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;">
        <div style="width:min(900px,92vw);background:#141416;border:1px solid #2a2a2d;border-radius:12px;padding:24px;box-shadow:0 20px 60px rgba(0,0,0,0.4);">
          <div style="font-size:18px;font-weight:700;margin-bottom:8px;">${ba("Tapnow ")}</div>
          <div style="font-size:12px;color:#b6b6c2;margin-bottom:16px;">${ba("")}</div>
          <div style="background:#0f0f12;border:1px solid #2a2a2d;border-radius:8px;padding:12px;font-size:12px;white-space:pre-wrap;max-height:240px;overflow:auto;">${n.replace(/</g,"&lt;")}</div>
          <div style="display:flex;gap:10px;margin-top:16px;">
            <button id="tapnow-reload" style="background:#2563eb;color:#fff;border:none;border-radius:8px;padding:8px 12px;font-size:12px;cursor:pointer;">${ba("")}</button>
            <button id="tapnow-copy" style="background:#27272a;color:#fff;border:1px solid #3f3f46;border-radius:8px;padding:8px 12px;font-size:12px;cursor:pointer;">${ba("")}</button>
          </div>
        </div>
      </div>
    `;const s=document.getElementById("tapnow-reload"),a=document.getElementById("tapnow-copy");s&&(s.onclick=()=>window.location.reload()),a&&(a.onclick=()=>D2(n))},IE=()=>{const e=window.onerror,t=window.onunhandledrejection;window.onerror=(n,s,a,c,d)=>(Rp(d||n,{type:"onerror",source:s,lineno:a,colno:c}),typeof e=="function"?e(n,s,a,c,d):!1),window.onunhandledrejection=n=>(Rp((n==null?void 0:n.reason)||"UnhandledRejection",{type:"unhandledrejection"}),typeof t=="function"?t(n):!1)},U2=({error:e,meta:t})=>{const n=L2(e,t);return i.jsx("div",{style:{position:"fixed",inset:0,background:"#0b0b0c",color:"#f3f3f3",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"system-ui,Segoe UI,Roboto,Helvetica,Arial"},children:i.jsxs("div",{style:{width:"min(900px,92vw)",background:"#141416",border:"1px solid #2a2a2d",borderRadius:12,padding:24,boxShadow:"0 20px 60px rgba(0,0,0,0.4)"},children:[i.jsx("div",{style:{fontSize:18,fontWeight:700,marginBottom:8},children:ba("Tapnow ")}),i.jsx("div",{style:{fontSize:12,color:"#b6b6c2",marginBottom:16},children:ba("")}),i.jsx("div",{style:{background:"#0f0f12",border:"1px solid #2a2a2d",borderRadius:8,padding:12,fontSize:12,whiteSpace:"pre-wrap",maxHeight:240,overflow:"auto"},children:n}),i.jsxs("div",{style:{display:"flex",gap:10,marginTop:16},children:[i.jsx("button",{onClick:()=>window.location.reload(),style:{background:"#2563eb",color:"#fff",border:"none",borderRadius:8,padding:"8px 12px",fontSize:12,cursor:"pointer"},children:ba("")}),i.jsx("button",{onClick:()=>D2(n),style:{background:"#27272a",color:"#fff",border:"1px solid #3f3f46",borderRadius:8,padding:"8px 12px",fontSize:12,cursor:"pointer"},children:ba("")})]})]})})};class PE extends ic.Component{constructor(t){super(t),this.state={error:null}}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t,n){Rp(t,{type:"error_boundary",info:n})}render(){return this.state.error?i.jsx(U2,{error:this.state.error,meta:{type:"error_boundary"}}):this.props.children}}const $E=({children:e})=>{const[t,n]=ic.useState(!1);return ic.useEffect(()=>{const s=window.setTimeout(()=>{window.__APP_BOOTED__||(Rp(new Error("APP_BOOT_TIMEOUT"),{type:"boot_timeout"}),n(!0))},CE);return window.__APP_BOOT_TIMER__=s,()=>window.clearTimeout(s)},[]),t?i.jsx(U2,{error:new Error(ba("")),meta:{type:"boot_timeout"}}):e};IE();try{if(!h0)throw new Error("Root element not found");Dg.createRoot(h0).render(i.jsx(ic.StrictMode,{children:i.jsx(PE,{children:i.jsx($E,{children:i.jsx(_E,{})})})}))}catch(e){EE(e,{type:"bootstrap"})}</script>
  <style rel="stylesheet" crossorigin>*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.pointer-events-auto{pointer-events:auto}.\!visible{visibility:visible!important}.visible{visibility:visible}.collapse{visibility:collapse}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.inset-0{top:0;right:0;bottom:0;left:0}.-bottom-0\.5{bottom:-.125rem}.-bottom-1\.5{bottom:-.375rem}.-left-1{left:-.25rem}.-right-0\.5{right:-.125rem}.-right-1{right:-.25rem}.-right-2\.5{right:-.625rem}.-top-1{top:-.25rem}.-top-1\.5{top:-.375rem}.-top-10{top:-2.5rem}.-top-2\.5{top:-.625rem}.bottom-0{bottom:0}.bottom-1{bottom:.25rem}.bottom-2{bottom:.5rem}.bottom-4{bottom:1rem}.bottom-8{bottom:2rem}.bottom-full{bottom:100%}.left-0{left:0}.left-1{left:.25rem}.left-1\/2{left:50%}.left-2{left:.5rem}.left-4{left:1rem}.left-6{left:1.5rem}.left-full{left:100%}.right-0{right:0}.right-1{right:.25rem}.right-2{right:.5rem}.right-4{right:1rem}.top-0{top:0}.top-1{top:.25rem}.top-1\/2{top:50%}.top-12{top:3rem}.top-2{top:.5rem}.top-20{top:5rem}.top-4{top:1rem}.top-full{top:100%}.z-10{z-index:10}.z-20{z-index:20}.z-30{z-index:30}.z-40{z-index:40}.z-50{z-index:50}.z-\[100\]{z-index:100}.z-\[110\]{z-index:110}.z-\[120\]{z-index:120}.z-\[200\]{z-index:200}.z-\[60\]{z-index:60}.z-\[9999\]{z-index:9999}.col-span-12{grid-column:span 12 / span 12}.col-span-2{grid-column:span 2 / span 2}.col-span-3{grid-column:span 3 / span 3}.col-span-4{grid-column:span 4 / span 4}.col-span-5{grid-column:span 5 / span 5}.col-span-6{grid-column:span 6 / span 6}.col-span-7{grid-column:span 7 / span 7}.col-span-8{grid-column:span 8 / span 8}.col-span-full{grid-column:1 / -1}.m-3{margin:.75rem}.mx-4{margin-left:1rem;margin-right:1rem}.mx-auto{margin-left:auto;margin-right:auto}.my-1{margin-top:.25rem;margin-bottom:.25rem}.-mb-1{margin-bottom:-.25rem}.-mt-1{margin-top:-.25rem}.mb-0{margin-bottom:0}.mb-0\.5{margin-bottom:.125rem}.mb-1{margin-bottom:.25rem}.mb-1\.5{margin-bottom:.375rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-auto{margin-bottom:auto}.ml-1{margin-left:.25rem}.ml-2{margin-left:.5rem}.ml-3{margin-left:.75rem}.ml-auto{margin-left:auto}.mr-0{margin-right:0}.mr-1{margin-right:.25rem}.mr-1\.5{margin-right:.375rem}.mr-2{margin-right:.5rem}.mt-0\.5{margin-top:.125rem}.mt-1{margin-top:.25rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-auto{margin-top:auto}.line-clamp-1{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}.line-clamp-2{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}.block{display:block}.inline-block{display:inline-block}.inline{display:inline}.flex{display:flex}.inline-flex{display:inline-flex}.table{display:table}.grid{display:grid}.contents{display:contents}.hidden{display:none}.aspect-\[21\/9\]{aspect-ratio:21/9}.aspect-\[3\/4\]{aspect-ratio:3/4}.aspect-\[4\/3\]{aspect-ratio:4/3}.aspect-\[9\/16\]{aspect-ratio:9/16}.aspect-square{aspect-ratio:1 / 1}.aspect-video{aspect-ratio:16 / 9}.h-0{height:0px}.h-1{height:.25rem}.h-1\.5{height:.375rem}.h-10{height:2.5rem}.h-12{height:3rem}.h-14{height:3.5rem}.h-16{height:4rem}.h-2{height:.5rem}.h-20{height:5rem}.h-24{height:6rem}.h-28{height:7rem}.h-3{height:.75rem}.h-4{height:1rem}.h-40{height:10rem}.h-48{height:12rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-64{height:16rem}.h-7{height:1.75rem}.h-8{height:2rem}.h-\[2px\]{height:2px}.h-\[85vh\]{height:85vh}.h-\[90px\]{height:90px}.h-auto{height:auto}.h-full{height:100%}.h-px{height:1px}.h-screen{height:100vh}.max-h-32{max-height:8rem}.max-h-36{max-height:9rem}.max-h-40{max-height:10rem}.max-h-64{max-height:16rem}.max-h-80{max-height:20rem}.max-h-\[140px\]{max-height:140px}.max-h-\[300px\]{max-height:300px}.max-h-\[50vh\]{max-height:50vh}.max-h-\[60vh\]{max-height:60vh}.max-h-\[85vh\]{max-height:85vh}.max-h-\[90vh\]{max-height:90vh}.max-h-full{max-height:100%}.min-h-0{min-height:0px}.min-h-\[100px\]{min-height:100px}.min-h-\[14rem\]{min-height:14rem}.min-h-\[18px\]{min-height:18px}.min-h-\[70px\]{min-height:70px}.min-h-\[80px\]{min-height:80px}.w-0{width:0px}.w-0\.5{width:.125rem}.w-1{width:.25rem}.w-1\.5{width:.375rem}.w-10{width:2.5rem}.w-11{width:2.75rem}.w-12{width:3rem}.w-14{width:3.5rem}.w-16{width:4rem}.w-2{width:.5rem}.w-20{width:5rem}.w-24{width:6rem}.w-3{width:.75rem}.w-32{width:8rem}.w-36{width:9rem}.w-4{width:1rem}.w-40{width:10rem}.w-48{width:12rem}.w-5{width:1.25rem}.w-52{width:13rem}.w-6{width:1.5rem}.w-64{width:16rem}.w-7{width:1.75rem}.w-72{width:18rem}.w-8{width:2rem}.w-9{width:2.25rem}.w-96{width:24rem}.w-\[500px\]{width:500px}.w-\[680px\]{width:680px}.w-\[90vw\]{width:90vw}.w-auto{width:auto}.w-full{width:100%}.w-max{width:-moz-max-content;width:max-content}.min-w-0{min-width:0px}.min-w-\[100px\]{min-width:100px}.min-w-\[120px\]{min-width:120px}.min-w-\[300px\]{min-width:300px}.min-w-\[70px\]{min-width:70px}.max-w-7xl{max-width:80rem}.max-w-\[140px\]{max-width:140px}.max-w-\[150px\]{max-width:150px}.max-w-\[200px\]{max-width:200px}.max-w-\[360px\]{max-width:360px}.max-w-\[85\%\]{max-width:85%}.max-w-\[90vw\]{max-width:90vw}.max-w-full{max-width:100%}.max-w-xl{max-width:36rem}.flex-1{flex:1 1 0%}.flex-shrink-0,.shrink-0{flex-shrink:0}.border-collapse{border-collapse:collapse}.origin-top-left{transform-origin:top left}.-translate-x-1\/2{--tw-translate-x: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-y-1\/2{--tw-translate-y: -50%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-0{--tw-translate-x: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.translate-x-full{--tw-translate-x: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-180{--tw-rotate: 180deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rotate-90{--tw-rotate: 90deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-110{--tw-scale-x: 1.1;--tw-scale-y: 1.1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-75{--tw-scale-x: .75;--tw-scale-y: .75;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-90{--tw-scale-x: .9;--tw-scale-y: .9;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.scale-95{--tw-scale-x: .95;--tw-scale-y: .95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@keyframes bounce{0%,to{transform:translateY(-25%);animation-timing-function:cubic-bezier(.8,0,1,1)}50%{transform:none;animation-timing-function:cubic-bezier(0,0,.2,1)}}.animate-bounce{animation:bounce 1s infinite}@keyframes pulse{50%{opacity:.5}}.animate-pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}@keyframes spin{to{transform:rotate(360deg)}}.cursor-col-resize{cursor:col-resize}.cursor-default{cursor:default}.cursor-ew-resize{cursor:ew-resize}.cursor-move{cursor:move}.cursor-not-allowed{cursor:not-allowed}.cursor-pointer{cursor:pointer}.cursor-text{cursor:text}.resize-none{resize:none}.resize{resize:both}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-12{grid-template-columns:repeat(12,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.grid-rows-2{grid-template-rows:repeat(2,minmax(0,1fr))}.flex-row{flex-direction:row}.flex-row-reverse{flex-direction:row-reverse}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.flex-nowrap{flex-wrap:nowrap}.content-start{align-content:flex-start}.items-start{align-items:flex-start}.items-end{align-items:flex-end}.items-center{align-items:center}.items-stretch{align-items:stretch}.justify-start{justify-content:flex-start}.justify-end{justify-content:flex-end}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-0{gap:0px}.gap-0\.5{gap:.125rem}.gap-1{gap:.25rem}.gap-1\.5{gap:.375rem}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.-space-x-2>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(-.5rem * var(--tw-space-x-reverse));margin-left:calc(-.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-1>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.25rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.25rem * var(--tw-space-y-reverse))}.space-y-1\.5>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.375rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.375rem * var(--tw-space-y-reverse))}.space-y-2>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.5rem * var(--tw-space-y-reverse))}.space-y-3>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(.75rem * var(--tw-space-y-reverse))}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse: 0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-hidden{overflow:hidden}.overflow-visible{overflow:visible}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.whitespace-nowrap{white-space:nowrap}.whitespace-pre-wrap{white-space:pre-wrap}.break-words{overflow-wrap:break-word}.rounded{border-radius:.25rem}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.rounded-xl{border-radius:.75rem}.rounded-bl{border-bottom-left-radius:.25rem}.rounded-br{border-bottom-right-radius:.25rem}.rounded-tl-none{border-top-left-radius:0}.rounded-tr{border-top-right-radius:.25rem}.rounded-tr-none{border-top-right-radius:0}.\!border{border-width:1px!important}.border{border-width:1px}.border-2{border-width:2px}.border-b{border-bottom-width:1px}.border-l{border-left-width:1px}.border-r{border-right-width:1px}.border-t{border-top-width:1px}.border-dashed{border-style:dashed}.\!border-\[\#525252\]{--tw-border-opacity: 1 !important;border-color:rgb(82 82 82 / var(--tw-border-opacity, 1))!important}.border-\[\#18181b\]{--tw-border-opacity: 1;border-color:rgb(24 24 27 / var(--tw-border-opacity, 1))}.border-\[\#525252\]{--tw-border-opacity: 1;border-color:rgb(82 82 82 / var(--tw-border-opacity, 1))}.border-\[\#d7cfb2\]{--tw-border-opacity: 1;border-color:rgb(215 207 178 / var(--tw-border-opacity, 1))}.border-\[\#eee8d5\]{--tw-border-opacity: 1;border-color:rgb(238 232 213 / var(--tw-border-opacity, 1))}.border-amber-200{--tw-border-opacity: 1;border-color:rgb(253 230 138 / var(--tw-border-opacity, 1))}.border-amber-500\/30{border-color:#f59e0b4d}.border-blue-200{--tw-border-opacity: 1;border-color:rgb(191 219 254 / var(--tw-border-opacity, 1))}.border-blue-300{--tw-border-opacity: 1;border-color:rgb(147 197 253 / var(--tw-border-opacity, 1))}.border-blue-400{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.border-blue-500{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.border-blue-500\/30{border-color:#3b82f64d}.border-blue-800{--tw-border-opacity: 1;border-color:rgb(30 64 175 / var(--tw-border-opacity, 1))}.border-emerald-200{--tw-border-opacity: 1;border-color:rgb(167 243 208 / var(--tw-border-opacity, 1))}.border-emerald-300{--tw-border-opacity: 1;border-color:rgb(110 231 183 / var(--tw-border-opacity, 1))}.border-emerald-500{--tw-border-opacity: 1;border-color:rgb(16 185 129 / var(--tw-border-opacity, 1))}.border-emerald-500\/20{border-color:#10b98133}.border-emerald-500\/30{border-color:#10b9814d}.border-gray-300{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity, 1))}.border-green-300{--tw-border-opacity: 1;border-color:rgb(134 239 172 / var(--tw-border-opacity, 1))}.border-green-400{--tw-border-opacity: 1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.border-green-500{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.border-purple-200{--tw-border-opacity: 1;border-color:rgb(233 213 255 / var(--tw-border-opacity, 1))}.border-purple-500\/20{border-color:#a855f733}.border-purple-800{--tw-border-opacity: 1;border-color:rgb(107 33 168 / var(--tw-border-opacity, 1))}.border-red-200{--tw-border-opacity: 1;border-color:rgb(254 202 202 / var(--tw-border-opacity, 1))}.border-red-400{--tw-border-opacity: 1;border-color:rgb(248 113 113 / var(--tw-border-opacity, 1))}.border-red-500\/30{border-color:#ef44444d}.border-red-500\/50{border-color:#ef444480}.border-red-800{--tw-border-opacity: 1;border-color:rgb(153 27 27 / var(--tw-border-opacity, 1))}.border-transparent{border-color:transparent}.border-violet-200{--tw-border-opacity: 1;border-color:rgb(221 214 254 / var(--tw-border-opacity, 1))}.border-white{--tw-border-opacity: 1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.border-white\/10{border-color:#ffffff1a}.border-white\/60{border-color:#fff9}.border-white\/70{border-color:#ffffffb3}.border-white\/80{border-color:#fffc}.border-zinc-200{--tw-border-opacity: 1;border-color:rgb(228 228 231 / var(--tw-border-opacity, 1))}.border-zinc-300{--tw-border-opacity: 1;border-color:rgb(212 212 216 / var(--tw-border-opacity, 1))}.border-zinc-400{--tw-border-opacity: 1;border-color:rgb(161 161 170 / var(--tw-border-opacity, 1))}.border-zinc-400\/30{border-color:#a1a1aa4d}.border-zinc-500\/60{border-color:#71717a99}.border-zinc-600{--tw-border-opacity: 1;border-color:rgb(82 82 91 / var(--tw-border-opacity, 1))}.border-zinc-700{--tw-border-opacity: 1;border-color:rgb(63 63 70 / var(--tw-border-opacity, 1))}.border-zinc-700\/40{border-color:#3f3f4666}.border-zinc-700\/50{border-color:#3f3f4680}.border-zinc-800{--tw-border-opacity: 1;border-color:rgb(39 39 42 / var(--tw-border-opacity, 1))}.border-zinc-800\/50{border-color:#27272a80}.\!bg-\[\#616161\]{--tw-bg-opacity: 1 !important;background-color:rgb(97 97 97 / var(--tw-bg-opacity, 1))!important}.bg-\[\#09090b\]{--tw-bg-opacity: 1;background-color:rgb(9 9 11 / var(--tw-bg-opacity, 1))}.bg-\[\#09090b\]\/90{background-color:#09090be6}.bg-\[\#121214\]{--tw-bg-opacity: 1;background-color:rgb(18 18 20 / var(--tw-bg-opacity, 1))}.bg-\[\#18181b\]{--tw-bg-opacity: 1;background-color:rgb(24 24 27 / var(--tw-bg-opacity, 1))}.bg-\[\#616161\]{--tw-bg-opacity: 1;background-color:rgb(97 97 97 / var(--tw-bg-opacity, 1))}.bg-\[\#616161\]\/60{background-color:#61616199}.bg-\[\#eee8d5\]{--tw-bg-opacity: 1;background-color:rgb(238 232 213 / var(--tw-bg-opacity, 1))}.bg-\[\#fafafa\]{--tw-bg-opacity: 1;background-color:rgb(250 250 250 / var(--tw-bg-opacity, 1))}.bg-\[\#fdf6e3\]{--tw-bg-opacity: 1;background-color:rgb(253 246 227 / var(--tw-bg-opacity, 1))}.bg-amber-100{--tw-bg-opacity: 1;background-color:rgb(254 243 199 / var(--tw-bg-opacity, 1))}.bg-amber-50{--tw-bg-opacity: 1;background-color:rgb(255 251 235 / var(--tw-bg-opacity, 1))}.bg-amber-500\/30{background-color:#f59e0b4d}.bg-amber-600\/20{background-color:#d9770633}.bg-amber-600\/30{background-color:#d977064d}.bg-black{--tw-bg-opacity: 1;background-color:rgb(0 0 0 / var(--tw-bg-opacity, 1))}.bg-black\/20{background-color:#0003}.bg-black\/40{background-color:#0006}.bg-black\/50{background-color:#00000080}.bg-black\/60{background-color:#0009}.bg-black\/70{background-color:#000000b3}.bg-black\/80{background-color:#000c}.bg-blue-100{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.bg-blue-50{--tw-bg-opacity: 1;background-color:rgb(239 246 255 / var(--tw-bg-opacity, 1))}.bg-blue-500{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.bg-blue-500\/10{background-color:#3b82f61a}.bg-blue-500\/20{background-color:#3b82f633}.bg-blue-500\/30{background-color:#3b82f64d}.bg-blue-500\/5{background-color:#3b82f60d}.bg-blue-600{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.bg-blue-600\/20{background-color:#2563eb33}.bg-blue-600\/30{background-color:#2563eb4d}.bg-blue-600\/80{background-color:#2563ebcc}.bg-blue-900\/20{background-color:#1e3a8a33}.bg-blue-900\/30{background-color:#1e3a8a4d}.bg-emerald-50{--tw-bg-opacity: 1;background-color:rgb(236 253 245 / var(--tw-bg-opacity, 1))}.bg-emerald-500\/10{background-color:#10b9811a}.bg-emerald-500\/15{background-color:#10b98126}.bg-emerald-500\/20{background-color:#10b98133}.bg-emerald-600\/25{background-color:#05966940}.bg-green-100{--tw-bg-opacity: 1;background-color:rgb(220 252 231 / var(--tw-bg-opacity, 1))}.bg-green-50{--tw-bg-opacity: 1;background-color:rgb(240 253 244 / var(--tw-bg-opacity, 1))}.bg-green-500{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.bg-green-500\/20{background-color:#22c55e33}.bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.bg-green-600\/40{background-color:#16a34a66}.bg-orange-100{--tw-bg-opacity: 1;background-color:rgb(255 237 213 / var(--tw-bg-opacity, 1))}.bg-orange-500{--tw-bg-opacity: 1;background-color:rgb(249 115 22 / var(--tw-bg-opacity, 1))}.bg-orange-500\/20{background-color:#f9731633}.bg-orange-600\/30{background-color:#ea580c4d}.bg-purple-50{--tw-bg-opacity: 1;background-color:rgb(250 245 255 / var(--tw-bg-opacity, 1))}.bg-purple-500{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.bg-purple-600{--tw-bg-opacity: 1;background-color:rgb(147 51 234 / var(--tw-bg-opacity, 1))}.bg-purple-600\/80{background-color:#9333eacc}.bg-purple-900\/30{background-color:#581c874d}.bg-red-100{--tw-bg-opacity: 1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.bg-red-50{--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.bg-red-500{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.bg-red-500\/10{background-color:#ef44441a}.bg-red-500\/30{background-color:#ef44444d}.bg-red-500\/80{background-color:#ef4444cc}.bg-red-600{--tw-bg-opacity: 1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.bg-red-600\/20{background-color:#dc262633}.bg-red-600\/30{background-color:#dc26264d}.bg-red-600\/80{background-color:#dc2626cc}.bg-red-900\/30{background-color:#7f1d1d4d}.bg-red-900\/40{background-color:#7f1d1d66}.bg-transparent{background-color:transparent}.bg-violet-50{--tw-bg-opacity: 1;background-color:rgb(245 243 255 / var(--tw-bg-opacity, 1))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.bg-white\/10{background-color:#ffffff1a}.bg-white\/40{background-color:#fff6}.bg-white\/80{background-color:#fffc}.bg-white\/90{background-color:#ffffffe6}.bg-yellow-500{--tw-bg-opacity: 1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.bg-yellow-600{--tw-bg-opacity: 1;background-color:rgb(202 138 4 / var(--tw-bg-opacity, 1))}.bg-zinc-100{--tw-bg-opacity: 1;background-color:rgb(244 244 245 / var(--tw-bg-opacity, 1))}.bg-zinc-200{--tw-bg-opacity: 1;background-color:rgb(228 228 231 / var(--tw-bg-opacity, 1))}.bg-zinc-300{--tw-bg-opacity: 1;background-color:rgb(212 212 216 / var(--tw-bg-opacity, 1))}.bg-zinc-400{--tw-bg-opacity: 1;background-color:rgb(161 161 170 / var(--tw-bg-opacity, 1))}.bg-zinc-50{--tw-bg-opacity: 1;background-color:rgb(250 250 250 / var(--tw-bg-opacity, 1))}.bg-zinc-50\/50{background-color:#fafafa80}.bg-zinc-500{--tw-bg-opacity: 1;background-color:rgb(113 113 122 / var(--tw-bg-opacity, 1))}.bg-zinc-600{--tw-bg-opacity: 1;background-color:rgb(82 82 91 / var(--tw-bg-opacity, 1))}.bg-zinc-700{--tw-bg-opacity: 1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.bg-zinc-700\/50{background-color:#3f3f4680}.bg-zinc-800{--tw-bg-opacity: 1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}.bg-zinc-800\/40{background-color:#27272a66}.bg-zinc-800\/50{background-color:#27272a80}.bg-zinc-800\/60{background-color:#27272a99}.bg-zinc-900{--tw-bg-opacity: 1;background-color:rgb(24 24 27 / var(--tw-bg-opacity, 1))}.bg-zinc-900\/30{background-color:#18181b4d}.bg-zinc-900\/40{background-color:#18181b66}.bg-zinc-900\/50{background-color:#18181b80}.bg-zinc-900\/60{background-color:#18181b99}.bg-zinc-900\/80{background-color:#18181bcc}.bg-zinc-900\/90{background-color:#18181be6}.bg-zinc-950{--tw-bg-opacity: 1;background-color:rgb(9 9 11 / var(--tw-bg-opacity, 1))}.bg-zinc-950\/50{background-color:#09090b80}.bg-zinc-950\/60{background-color:#09090b99}.bg-opacity-50{--tw-bg-opacity: .5}.bg-gradient-to-br{background-image:linear-gradient(to bottom right,var(--tw-gradient-stops))}.bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}.from-blue-600{--tw-gradient-from: #2563eb var(--tw-gradient-from-position);--tw-gradient-to: rgb(37 99 235 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-green-600{--tw-gradient-from: #16a34a var(--tw-gradient-from-position);--tw-gradient-to: rgb(22 163 74 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.from-purple-600{--tw-gradient-from: #9333ea var(--tw-gradient-from-position);--tw-gradient-to: rgb(147 51 234 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.to-emerald-600{--tw-gradient-to: #059669 var(--tw-gradient-to-position)}.to-indigo-600{--tw-gradient-to: #4f46e5 var(--tw-gradient-to-position)}.fill-current{fill:currentColor}.object-contain{-o-object-fit:contain;object-fit:contain}.object-cover{-o-object-fit:cover;object-fit:cover}.p-0{padding:0}.p-0\.5{padding:.125rem}.p-1{padding:.25rem}.p-1\.5{padding:.375rem}.p-2{padding:.5rem}.p-2\.5{padding:.625rem}.p-3{padding:.75rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.p-8{padding:2rem}.px-0\.5{padding-left:.125rem;padding-right:.125rem}.px-1{padding-left:.25rem;padding-right:.25rem}.px-1\.5{padding-left:.375rem;padding-right:.375rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.px-8{padding-left:2rem;padding-right:2rem}.py-0\.5{padding-top:.125rem;padding-bottom:.125rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-1\.5{padding-top:.375rem;padding-bottom:.375rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-2\.5{padding-top:.625rem;padding-bottom:.625rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.py-6{padding-top:1.5rem;padding-bottom:1.5rem}.py-8{padding-top:2rem;padding-bottom:2rem}.pb-1{padding-bottom:.25rem}.pb-2{padding-bottom:.5rem}.pb-3{padding-bottom:.75rem}.pl-1{padding-left:.25rem}.pl-2{padding-left:.5rem}.pl-6{padding-left:1.5rem}.pl-8{padding-left:2rem}.pr-1{padding-right:.25rem}.pr-2{padding-right:.5rem}.pr-8{padding-right:2rem}.pt-1{padding-top:.25rem}.pt-2{padding-top:.5rem}.pt-3{padding-top:.75rem}.text-left{text-align:left}.text-center{text-align:center}.text-right{text-align:right}.font-mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.font-sans{font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-\[10px\]{font-size:10px}.text-\[11px\]{font-size:11px}.text-\[12px\]{font-size:12px}.text-\[7px\]{font-size:7px}.text-\[8px\]{font-size:8px}.text-\[9px\]{font-size:9px}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.italic{font-style:italic}.leading-none{line-height:1}.leading-snug{line-height:1.375}.leading-tight{line-height:1.25}.tracking-\[0\.3em\]{letter-spacing:.3em}.tracking-tighter{letter-spacing:-.05em}.tracking-wide{letter-spacing:.025em}.tracking-wider{letter-spacing:.05em}.tracking-widest{letter-spacing:.1em}.\!text-\[\#fdf6e3\]{--tw-text-opacity: 1 !important;color:rgb(253 246 227 / var(--tw-text-opacity, 1))!important}.text-\[\#586e75\]{--tw-text-opacity: 1;color:rgb(88 110 117 / var(--tw-text-opacity, 1))}.text-\[\#616161\]{--tw-text-opacity: 1;color:rgb(97 97 97 / var(--tw-text-opacity, 1))}.text-\[\#fdf6e3\]{--tw-text-opacity: 1;color:rgb(253 246 227 / var(--tw-text-opacity, 1))}.text-\[\#fdf6e3\]\/60{color:#fdf6e399}.text-amber-200{--tw-text-opacity: 1;color:rgb(253 230 138 / var(--tw-text-opacity, 1))}.text-amber-400{--tw-text-opacity: 1;color:rgb(251 191 36 / var(--tw-text-opacity, 1))}.text-amber-600{--tw-text-opacity: 1;color:rgb(217 119 6 / var(--tw-text-opacity, 1))}.text-black{--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity, 1))}.text-blue-200{--tw-text-opacity: 1;color:rgb(191 219 254 / var(--tw-text-opacity, 1))}.text-blue-300{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.text-blue-400{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.text-blue-500{--tw-text-opacity: 1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.text-blue-600{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.text-blue-700{--tw-text-opacity: 1;color:rgb(29 78 216 / var(--tw-text-opacity, 1))}.text-cyan-500{--tw-text-opacity: 1;color:rgb(6 182 212 / var(--tw-text-opacity, 1))}.text-emerald-200{--tw-text-opacity: 1;color:rgb(167 243 208 / var(--tw-text-opacity, 1))}.text-emerald-500{--tw-text-opacity: 1;color:rgb(16 185 129 / var(--tw-text-opacity, 1))}.text-emerald-600{--tw-text-opacity: 1;color:rgb(5 150 105 / var(--tw-text-opacity, 1))}.text-emerald-700{--tw-text-opacity: 1;color:rgb(4 120 87 / var(--tw-text-opacity, 1))}.text-green-200{--tw-text-opacity: 1;color:rgb(187 247 208 / var(--tw-text-opacity, 1))}.text-green-300{--tw-text-opacity: 1;color:rgb(134 239 172 / var(--tw-text-opacity, 1))}.text-green-400{--tw-text-opacity: 1;color:rgb(74 222 128 / var(--tw-text-opacity, 1))}.text-green-500{--tw-text-opacity: 1;color:rgb(34 197 94 / var(--tw-text-opacity, 1))}.text-green-600{--tw-text-opacity: 1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.text-green-700{--tw-text-opacity: 1;color:rgb(21 128 61 / var(--tw-text-opacity, 1))}.text-orange-200{--tw-text-opacity: 1;color:rgb(254 215 170 / var(--tw-text-opacity, 1))}.text-orange-400{--tw-text-opacity: 1;color:rgb(251 146 60 / var(--tw-text-opacity, 1))}.text-orange-600{--tw-text-opacity: 1;color:rgb(234 88 12 / var(--tw-text-opacity, 1))}.text-purple-300{--tw-text-opacity: 1;color:rgb(216 180 254 / var(--tw-text-opacity, 1))}.text-purple-400{--tw-text-opacity: 1;color:rgb(192 132 252 / var(--tw-text-opacity, 1))}.text-purple-500{--tw-text-opacity: 1;color:rgb(168 85 247 / var(--tw-text-opacity, 1))}.text-purple-600{--tw-text-opacity: 1;color:rgb(147 51 234 / var(--tw-text-opacity, 1))}.text-purple-700{--tw-text-opacity: 1;color:rgb(126 34 206 / var(--tw-text-opacity, 1))}.text-red-200{--tw-text-opacity: 1;color:rgb(254 202 202 / var(--tw-text-opacity, 1))}.text-red-300{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.text-red-400{--tw-text-opacity: 1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.text-red-500{--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.text-red-600{--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.text-white\/70{color:#ffffffb3}.text-yellow-300{--tw-text-opacity: 1;color:rgb(253 224 71 / var(--tw-text-opacity, 1))}.text-yellow-600{--tw-text-opacity: 1;color:rgb(202 138 4 / var(--tw-text-opacity, 1))}.text-yellow-700{--tw-text-opacity: 1;color:rgb(161 98 7 / var(--tw-text-opacity, 1))}.text-zinc-100{--tw-text-opacity: 1;color:rgb(244 244 245 / var(--tw-text-opacity, 1))}.text-zinc-200{--tw-text-opacity: 1;color:rgb(228 228 231 / var(--tw-text-opacity, 1))}.text-zinc-300{--tw-text-opacity: 1;color:rgb(212 212 216 / var(--tw-text-opacity, 1))}.text-zinc-400{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.text-zinc-500{--tw-text-opacity: 1;color:rgb(113 113 122 / var(--tw-text-opacity, 1))}.text-zinc-600{--tw-text-opacity: 1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.text-zinc-700{--tw-text-opacity: 1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.text-zinc-800{--tw-text-opacity: 1;color:rgb(39 39 42 / var(--tw-text-opacity, 1))}.text-zinc-900{--tw-text-opacity: 1;color:rgb(24 24 27 / var(--tw-text-opacity, 1))}.antialiased{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.placeholder-zinc-400::-moz-placeholder{--tw-placeholder-opacity: 1;color:rgb(161 161 170 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-400::placeholder{--tw-placeholder-opacity: 1;color:rgb(161 161 170 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-500::-moz-placeholder{--tw-placeholder-opacity: 1;color:rgb(113 113 122 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-500::placeholder{--tw-placeholder-opacity: 1;color:rgb(113 113 122 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-600::-moz-placeholder{--tw-placeholder-opacity: 1;color:rgb(82 82 91 / var(--tw-placeholder-opacity, 1))}.placeholder-zinc-600::placeholder{--tw-placeholder-opacity: 1;color:rgb(82 82 91 / var(--tw-placeholder-opacity, 1))}.opacity-0{opacity:0}.opacity-100{opacity:1}.opacity-20{opacity:.2}.opacity-30{opacity:.3}.opacity-40{opacity:.4}.opacity-50{opacity:.5}.opacity-60{opacity:.6}.opacity-70{opacity:.7}.opacity-80{opacity:.8}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-2xl{--tw-shadow: 0 25px 50px -12px rgb(0 0 0 / .25);--tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_10px_rgba\(0\,0\,0\,0\.5\)\]{--tw-shadow: 0 0 10px rgba(0,0,0,.5);--tw-shadow-colored: 0 0 10px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_10px_rgba\(255\,255\,255\,0\.5\)\]{--tw-shadow: 0 0 10px rgba(255,255,255,.5);--tw-shadow-colored: 0 0 10px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_8px_rgba\(239\,68\,68\,0\.8\)\]{--tw-shadow: 0 0 8px rgba(239,68,68,.8);--tw-shadow-colored: 0 0 8px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_8px_rgba\(34\,197\,94\,0\.6\)\]{--tw-shadow: 0 0 8px rgba(34,197,94,.6);--tw-shadow-colored: 0 0 8px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-\[0_0_8px_rgba\(34\,197\,94\,0\.8\)\]{--tw-shadow: 0 0 8px rgba(34,197,94,.8);--tw-shadow-colored: 0 0 8px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-inner{--tw-shadow: inset 0 2px 4px 0 rgb(0 0 0 / .05);--tw-shadow-colored: inset 0 2px 4px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-sm{--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow: 0 20px 25px -5px rgb(0 0 0 / .1), 0 8px 10px -6px rgb(0 0 0 / .1);--tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-black\/10{--tw-shadow-color: rgb(0 0 0 / .1);--tw-shadow: var(--tw-shadow-colored)}.shadow-black\/40{--tw-shadow-color: rgb(0 0 0 / .4);--tw-shadow: var(--tw-shadow-colored)}.shadow-blue-300\/30{--tw-shadow-color: rgb(147 197 253 / .3);--tw-shadow: var(--tw-shadow-colored)}.shadow-blue-500\/20{--tw-shadow-color: rgb(59 130 246 / .2);--tw-shadow: var(--tw-shadow-colored)}.shadow-blue-900\/20{--tw-shadow-color: rgb(30 58 138 / .2);--tw-shadow: var(--tw-shadow-colored)}.outline-none{outline:2px solid transparent;outline-offset:2px}.ring-1{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.ring-blue-300\/60{--tw-ring-color: rgb(147 197 253 / .6)}.ring-blue-400{--tw-ring-opacity: 1;--tw-ring-color: rgb(96 165 250 / var(--tw-ring-opacity, 1))}.ring-blue-500{--tw-ring-opacity: 1;--tw-ring-color: rgb(59 130 246 / var(--tw-ring-opacity, 1))}.ring-blue-500\/30{--tw-ring-color: rgb(59 130 246 / .3)}.ring-blue-500\/50{--tw-ring-color: rgb(59 130 246 / .5)}.ring-green-500\/50{--tw-ring-color: rgb(34 197 94 / .5)}.ring-offset-2{--tw-ring-offset-width: 2px}.blur{--tw-blur: blur(8px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.blur-\[50px\]{--tw-blur: blur(50px);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.drop-shadow-md{--tw-drop-shadow: drop-shadow(0 4px 3px rgb(0 0 0 / .07)) drop-shadow(0 2px 2px rgb(0 0 0 / .06));filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.grayscale{--tw-grayscale: grayscale(100%);filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.backdrop-blur-\[2px\]{--tw-backdrop-blur: blur(2px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-md{--tw-backdrop-blur: blur(12px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-sm{--tw-backdrop-blur: blur(4px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-blur-xl{--tw-backdrop-blur: blur(24px);-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.backdrop-filter{-webkit-backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);backdrop-filter:var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-shadow{transition-property:box-shadow;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-100{transition-duration:.1s}.duration-150{transition-duration:.15s}.duration-200{transition-duration:.2s}.duration-300{transition-duration:.3s}.ease-in-out{transition-timing-function:cubic-bezier(.4,0,.2,1)}.ease-linear{transition-timing-function:linear}.will-change-transform{will-change:transform}body{margin:0;padding:0;background-color:#09090b}.select-none{-webkit-user-select:none;-moz-user-select:none;user-select:none}.select-text{-webkit-user-select:text;-moz-user-select:text;user-select:text}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin{animation:spin 1s linear infinite}.art-loader-container{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#09090b;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;color:#e4e4e7}.art-center-group{display:flex;flex-direction:column;align-items:center;transform:translateY(-20px)}.art-visual{position:relative;width:60px;height:60px;margin-bottom:30px}.art-ring-outer{position:absolute;top:0;right:0;bottom:0;left:0;border:1px solid rgba(255,255,255,.1);border-radius:50%;animation:art-breathe 4s ease-in-out infinite}.art-ring-inner{position:absolute;top:0;right:0;bottom:0;left:0;border-radius:50%;border:1px solid transparent;border-top-color:#fff;border-left-color:#ffffff4d;opacity:.8;animation:art-spin 2s cubic-bezier(.4,0,.2,1) infinite}.art-dot{position:absolute;top:50%;left:50%;width:4px;height:4px;background-color:#fff;border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 0 10px #ffffff80}.art-title{font-size:12px;font-weight:300;text-transform:uppercase;letter-spacing:.3em;opacity:.9;margin-bottom:8px}.art-status{font-family:Courier New,monospace;font-size:10px;color:#71717a;letter-spacing:.1em;animation:art-pulse 2s ease-in-out infinite}.art-footer{position:absolute;bottom:40px;display:flex;flex-direction:column;align-items:center;text-align:center;gap:12px;opacity:0;animation:art-fade-up 1s ease-out .5s forwards}.footer-author{display:flex;flex-direction:column;gap:4px}.footer-author .label{font-size:9px;color:#52525b;text-transform:uppercase;letter-spacing:.2em}.footer-author .name{font-size:14px;font-weight:500;letter-spacing:.5em;color:#fff;text-indent:.5em}.footer-divider{width:20px;height:1px;background-color:#27272a}.footer-thanks{display:flex;flex-direction:column;gap:2px}.footer-thanks .label{font-size:8px;color:#3f3f46;text-transform:uppercase;letter-spacing:.1em}.footer-thanks .content{font-size:10px;color:#71717a;font-family:Courier New,monospace}.footer-thanks .highlight{color:#a1a1aa;font-weight:600}@keyframes art-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes art-breathe{0%,to{transform:scale(1);opacity:.5}50%{transform:scale(1.1);opacity:.2}}@keyframes art-pulse{0%,to{opacity:.4}50%{opacity:.8}}@keyframes art-fade-up{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}.markdown-body{line-height:1.5}.markdown-body p{margin:0}.markdown-body p+p{margin-top:.5em}.markdown-body ul,.markdown-body ol{margin:.5em 0;padding-left:1.5em}.markdown-body pre{margin:.5em 0;padding:.5em;border-radius:.5em;overflow-x:auto}.markdown-body code{font-size:.875em}.placeholder\:text-zinc-400::-moz-placeholder{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-400::placeholder{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-600::-moz-placeholder{--tw-text-opacity: 1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-600::placeholder{--tw-text-opacity: 1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-700::-moz-placeholder{--tw-text-opacity: 1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.placeholder\:text-zinc-700::placeholder{--tw-text-opacity: 1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.placeholder\:text-opacity-50::-moz-placeholder{--tw-text-opacity: .5}.placeholder\:text-opacity-50::placeholder{--tw-text-opacity: .5}.after\:absolute:after{content:var(--tw-content);position:absolute}.after\:left-\[2px\]:after{content:var(--tw-content);left:2px}.after\:top-\[2px\]:after{content:var(--tw-content);top:2px}.after\:h-4:after{content:var(--tw-content);height:1rem}.after\:h-5:after{content:var(--tw-content);height:1.25rem}.after\:w-4:after{content:var(--tw-content);width:1rem}.after\:w-5:after{content:var(--tw-content);width:1.25rem}.after\:rounded-full:after{content:var(--tw-content);border-radius:9999px}.after\:bg-white:after{content:var(--tw-content);--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.after\:transition-all:after{content:var(--tw-content);transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.after\:content-\[\'\'\]:after{--tw-content: "";content:var(--tw-content)}.focus-within\:border-blue-500\/30:focus-within{border-color:#3b82f64d}.focus-within\:border-blue-500\/50:focus-within{border-color:#3b82f680}.hover\:h-6:hover{height:1.5rem}.hover\:scale-100:hover{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.hover\:border-\[\#d7cfb2\]:hover{--tw-border-opacity: 1;border-color:rgb(215 207 178 / var(--tw-border-opacity, 1))}.hover\:border-blue-300:hover{--tw-border-opacity: 1;border-color:rgb(147 197 253 / var(--tw-border-opacity, 1))}.hover\:border-blue-400:hover{--tw-border-opacity: 1;border-color:rgb(96 165 250 / var(--tw-border-opacity, 1))}.hover\:border-blue-500:hover{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.hover\:border-blue-500\/30:hover{border-color:#3b82f64d}.hover\:border-blue-500\/50:hover{border-color:#3b82f680}.hover\:border-green-400:hover{--tw-border-opacity: 1;border-color:rgb(74 222 128 / var(--tw-border-opacity, 1))}.hover\:border-green-500:hover{--tw-border-opacity: 1;border-color:rgb(34 197 94 / var(--tw-border-opacity, 1))}.hover\:border-zinc-300:hover{--tw-border-opacity: 1;border-color:rgb(212 212 216 / var(--tw-border-opacity, 1))}.hover\:border-zinc-400:hover{--tw-border-opacity: 1;border-color:rgb(161 161 170 / var(--tw-border-opacity, 1))}.hover\:border-zinc-500:hover{--tw-border-opacity: 1;border-color:rgb(113 113 122 / var(--tw-border-opacity, 1))}.hover\:border-zinc-600:hover{--tw-border-opacity: 1;border-color:rgb(82 82 91 / var(--tw-border-opacity, 1))}.hover\:border-zinc-700:hover{--tw-border-opacity: 1;border-color:rgb(63 63 70 / var(--tw-border-opacity, 1))}.hover\:\!bg-\[\#555555\]:hover{--tw-bg-opacity: 1 !important;background-color:rgb(85 85 85 / var(--tw-bg-opacity, 1))!important}.hover\:bg-\[\#4b4b4b\]:hover{--tw-bg-opacity: 1;background-color:rgb(75 75 75 / var(--tw-bg-opacity, 1))}.hover\:bg-\[\#555555\]:hover{--tw-bg-opacity: 1;background-color:rgb(85 85 85 / var(--tw-bg-opacity, 1))}.hover\:bg-\[\#eee8d5\]:hover{--tw-bg-opacity: 1;background-color:rgb(238 232 213 / var(--tw-bg-opacity, 1))}.hover\:bg-\[\#fdf6e3\]:hover{--tw-bg-opacity: 1;background-color:rgb(253 246 227 / var(--tw-bg-opacity, 1))}.hover\:bg-amber-100:hover{--tw-bg-opacity: 1;background-color:rgb(254 243 199 / var(--tw-bg-opacity, 1))}.hover\:bg-amber-200:hover{--tw-bg-opacity: 1;background-color:rgb(253 230 138 / var(--tw-bg-opacity, 1))}.hover\:bg-amber-600\/30:hover{background-color:#d977064d}.hover\:bg-amber-600\/40:hover{background-color:#d9770666}.hover\:bg-black\/70:hover{background-color:#000000b3}.hover\:bg-black\/80:hover{background-color:#000c}.hover\:bg-blue-100:hover{--tw-bg-opacity: 1;background-color:rgb(219 234 254 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-200:hover{--tw-bg-opacity: 1;background-color:rgb(191 219 254 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-400:hover{--tw-bg-opacity: 1;background-color:rgb(96 165 250 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-400\/30:hover{background-color:#60a5fa4d}.hover\:bg-blue-500:hover{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-500\/20:hover{background-color:#3b82f633}.hover\:bg-blue-500\/30:hover{background-color:#3b82f64d}.hover\:bg-blue-600:hover{--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1))}.hover\:bg-blue-600\/30:hover{background-color:#2563eb4d}.hover\:bg-blue-600\/50:hover{background-color:#2563eb80}.hover\:bg-blue-700:hover{--tw-bg-opacity: 1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.hover\:bg-green-200:hover{--tw-bg-opacity: 1;background-color:rgb(187 247 208 / var(--tw-bg-opacity, 1))}.hover\:bg-green-400:hover{--tw-bg-opacity: 1;background-color:rgb(74 222 128 / var(--tw-bg-opacity, 1))}.hover\:bg-green-500:hover{--tw-bg-opacity: 1;background-color:rgb(34 197 94 / var(--tw-bg-opacity, 1))}.hover\:bg-green-500\/30:hover{background-color:#22c55e4d}.hover\:bg-green-600:hover{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity, 1))}.hover\:bg-green-600\/60:hover{background-color:#16a34a99}.hover\:bg-orange-200:hover{--tw-bg-opacity: 1;background-color:rgb(254 215 170 / var(--tw-bg-opacity, 1))}.hover\:bg-orange-500\/30:hover{background-color:#f973164d}.hover\:bg-orange-600\/40:hover{background-color:#ea580c66}.hover\:bg-purple-400:hover{--tw-bg-opacity: 1;background-color:rgb(192 132 252 / var(--tw-bg-opacity, 1))}.hover\:bg-purple-500:hover{--tw-bg-opacity: 1;background-color:rgb(168 85 247 / var(--tw-bg-opacity, 1))}.hover\:bg-red-100:hover{--tw-bg-opacity: 1;background-color:rgb(254 226 226 / var(--tw-bg-opacity, 1))}.hover\:bg-red-200:hover{--tw-bg-opacity: 1;background-color:rgb(254 202 202 / var(--tw-bg-opacity, 1))}.hover\:bg-red-50:hover{--tw-bg-opacity: 1;background-color:rgb(254 242 242 / var(--tw-bg-opacity, 1))}.hover\:bg-red-500:hover{--tw-bg-opacity: 1;background-color:rgb(239 68 68 / var(--tw-bg-opacity, 1))}.hover\:bg-red-500\/10:hover{background-color:#ef44441a}.hover\:bg-red-600:hover{--tw-bg-opacity: 1;background-color:rgb(220 38 38 / var(--tw-bg-opacity, 1))}.hover\:bg-red-600\/30:hover{background-color:#dc26264d}.hover\:bg-red-600\/50:hover{background-color:#dc262680}.hover\:bg-red-700:hover{--tw-bg-opacity: 1;background-color:rgb(185 28 28 / var(--tw-bg-opacity, 1))}.hover\:bg-red-800:hover{--tw-bg-opacity: 1;background-color:rgb(153 27 27 / var(--tw-bg-opacity, 1))}.hover\:bg-red-900\/60:hover{background-color:#7f1d1d99}.hover\:bg-white:hover{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity, 1))}.hover\:bg-white\/20:hover{background-color:#fff3}.hover\:bg-yellow-400:hover{--tw-bg-opacity: 1;background-color:rgb(250 204 21 / var(--tw-bg-opacity, 1))}.hover\:bg-yellow-500:hover{--tw-bg-opacity: 1;background-color:rgb(234 179 8 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-100:hover{--tw-bg-opacity: 1;background-color:rgb(244 244 245 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-200:hover{--tw-bg-opacity: 1;background-color:rgb(228 228 231 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-300:hover{--tw-bg-opacity: 1;background-color:rgb(212 212 216 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-600:hover{--tw-bg-opacity: 1;background-color:rgb(82 82 91 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-700:hover{--tw-bg-opacity: 1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-800:hover{--tw-bg-opacity: 1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}.hover\:bg-zinc-800\/50:hover{background-color:#27272a80}.hover\:bg-zinc-800\/60:hover{background-color:#27272a99}.hover\:from-blue-500:hover{--tw-gradient-from: #3b82f6 var(--tw-gradient-from-position);--tw-gradient-to: rgb(59 130 246 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:from-green-500:hover{--tw-gradient-from: #22c55e var(--tw-gradient-from-position);--tw-gradient-to: rgb(34 197 94 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:from-purple-500:hover{--tw-gradient-from: #a855f7 var(--tw-gradient-from-position);--tw-gradient-to: rgb(168 85 247 / 0) var(--tw-gradient-to-position);--tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to)}.hover\:to-emerald-500:hover{--tw-gradient-to: #10b981 var(--tw-gradient-to-position)}.hover\:to-indigo-500:hover{--tw-gradient-to: #6366f1 var(--tw-gradient-to-position)}.hover\:text-blue-200:hover{--tw-text-opacity: 1;color:rgb(191 219 254 / var(--tw-text-opacity, 1))}.hover\:text-blue-300:hover{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.hover\:text-blue-400:hover{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.hover\:text-blue-500:hover{--tw-text-opacity: 1;color:rgb(59 130 246 / var(--tw-text-opacity, 1))}.hover\:text-blue-600:hover{--tw-text-opacity: 1;color:rgb(37 99 235 / var(--tw-text-opacity, 1))}.hover\:text-green-600:hover{--tw-text-opacity: 1;color:rgb(22 163 74 / var(--tw-text-opacity, 1))}.hover\:text-red-300:hover{--tw-text-opacity: 1;color:rgb(252 165 165 / var(--tw-text-opacity, 1))}.hover\:text-red-400:hover{--tw-text-opacity: 1;color:rgb(248 113 113 / var(--tw-text-opacity, 1))}.hover\:text-red-500:hover{--tw-text-opacity: 1;color:rgb(239 68 68 / var(--tw-text-opacity, 1))}.hover\:text-red-600:hover{--tw-text-opacity: 1;color:rgb(220 38 38 / var(--tw-text-opacity, 1))}.hover\:text-white:hover{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.hover\:text-zinc-200:hover{--tw-text-opacity: 1;color:rgb(228 228 231 / var(--tw-text-opacity, 1))}.hover\:text-zinc-300:hover{--tw-text-opacity: 1;color:rgb(212 212 216 / var(--tw-text-opacity, 1))}.hover\:text-zinc-600:hover{--tw-text-opacity: 1;color:rgb(82 82 91 / var(--tw-text-opacity, 1))}.hover\:text-zinc-700:hover{--tw-text-opacity: 1;color:rgb(63 63 70 / var(--tw-text-opacity, 1))}.hover\:text-zinc-800:hover{--tw-text-opacity: 1;color:rgb(39 39 42 / var(--tw-text-opacity, 1))}.hover\:text-zinc-900:hover{--tw-text-opacity: 1;color:rgb(24 24 27 / var(--tw-text-opacity, 1))}.hover\:underline:hover{text-decoration-line:underline}.hover\:opacity-100:hover{opacity:1}.hover\:shadow-md:hover{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.hover\:ring-1:hover{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.hover\:ring-zinc-400:hover{--tw-ring-opacity: 1;--tw-ring-color: rgb(161 161 170 / var(--tw-ring-opacity, 1))}.focus\:border-blue-500:focus{--tw-border-opacity: 1;border-color:rgb(59 130 246 / var(--tw-border-opacity, 1))}.focus\:border-blue-500\/50:focus{border-color:#3b82f680}.focus\:border-blue-600\/50:focus{border-color:#2563eb80}.focus\:ring-2:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-500\/50:focus{--tw-ring-color: rgb(59 130 246 / .5)}.active\:scale-95:active{--tw-scale-x: .95;--tw-scale-y: .95;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.disabled\:cursor-not-allowed:disabled{cursor:not-allowed}.disabled\:opacity-50:disabled{opacity:.5}.group\/insert:hover .group-hover\/insert\:scale-100{--tw-scale-x: 1;--tw-scale-y: 1;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.group:hover .group-hover\:bg-\[\#e4dcc2\]{--tw-bg-opacity: 1;background-color:rgb(228 220 194 / var(--tw-bg-opacity, 1))}.group:hover .group-hover\:bg-blue-500{--tw-bg-opacity: 1;background-color:rgb(59 130 246 / var(--tw-bg-opacity, 1))}.group:hover .group-hover\:bg-zinc-200{--tw-bg-opacity: 1;background-color:rgb(228 228 231 / var(--tw-bg-opacity, 1))}.group:hover .group-hover\:bg-zinc-800{--tw-bg-opacity: 1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}.group\/cell:hover .group-hover\/cell\:opacity-100,.group\/insert:hover .group-hover\/insert\:opacity-100,.group\/main:hover .group-hover\/main\:opacity-100,.group\/preview:hover .group-hover\/preview\:opacity-100,.group:hover .group-hover\:opacity-100{opacity:1}.peer:checked~.peer-checked\:after\:translate-x-full:after{content:var(--tw-content);--tw-translate-x: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.peer:checked~.peer-checked\:after\:border-white:after{content:var(--tw-content);--tw-border-opacity: 1;border-color:rgb(255 255 255 / var(--tw-border-opacity, 1))}.peer:focus~.peer-focus\:outline-none{outline:2px solid transparent;outline-offset:2px}.peer:focus~.peer-focus\:ring-2{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.peer:focus~.peer-focus\:ring-blue-500\/50{--tw-ring-color: rgb(59 130 246 / .5)}@media (prefers-color-scheme: dark){.dark\:border-zinc-700{--tw-border-opacity: 1;border-color:rgb(63 63 70 / var(--tw-border-opacity, 1))}.dark\:bg-blue-900\/30{background-color:#1e3a8a4d}.dark\:bg-zinc-700{--tw-bg-opacity: 1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.dark\:text-blue-300{--tw-text-opacity: 1;color:rgb(147 197 253 / var(--tw-text-opacity, 1))}.dark\:text-blue-400{--tw-text-opacity: 1;color:rgb(96 165 250 / var(--tw-text-opacity, 1))}.dark\:text-zinc-200{--tw-text-opacity: 1;color:rgb(228 228 231 / var(--tw-text-opacity, 1))}.dark\:text-zinc-300{--tw-text-opacity: 1;color:rgb(212 212 216 / var(--tw-text-opacity, 1))}.dark\:text-zinc-400{--tw-text-opacity: 1;color:rgb(161 161 170 / var(--tw-text-opacity, 1))}.dark\:hover\:bg-blue-900\/30:hover{background-color:#1e3a8a4d}.dark\:hover\:bg-zinc-700:hover{--tw-bg-opacity: 1;background-color:rgb(63 63 70 / var(--tw-bg-opacity, 1))}.dark\:hover\:bg-zinc-800:hover{--tw-bg-opacity: 1;background-color:rgb(39 39 42 / var(--tw-bg-opacity, 1))}}</style>
</head>

<body style="margin: 0; padding: 0; background-color: #09090b;">
    <div id="root"></div>
    <script>
        (function () {
            if (window.__APP_BOOT_GUARD__) return;
            window.__APP_BOOT_GUARD__ = true;
            window.__APP_BOOTED__ = false;
            window.__APP_ERRORS__ = window.__APP_ERRORS__ || [];
            var MAX_ERRORS = 50;
            var BOOT_TIMEOUT_MS = 5000;
            var recordError = function (error, meta) {
                var entry = {
                    time: new Date().toISOString(),
                    message: (error && error.message) ? error.message : String(error || 'UnknownError'),
                    stack: (error && error.stack) ? error.stack : '',
                    meta: meta || {}
                };
                window.__APP_ERRORS__.push(entry);
                if (window.__APP_ERRORS__.length > MAX_ERRORS) {
                    window.__APP_ERRORS__.shift();
                }
                return entry;
            };
            var buildPayload = function (error, meta) {
                var latest = recordError(error, meta || {});
                return JSON.stringify({ latest: latest, errors: window.__APP_ERRORS__ }, null, 2);
            };
            var copyText = function (text) {
                if (navigator && navigator.clipboard && navigator.clipboard.writeText) {
                    return navigator.clipboard.writeText(text).catch(function () { });
                }
                try {
                    var textarea = document.createElement('textarea');
                    textarea.value = text;
                    textarea.setAttribute('readonly', '');
                    textarea.style.position = 'absolute';
                    textarea.style.left = '-9999px';
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                } catch (e) { }
            };
            var renderFallback = function (error, meta) {
                var root = document.getElementById('root');
                if (!root) return;
                var payload = buildPayload(error, meta || {});
                root.innerHTML =
                    '<div style="position:fixed;inset:0;background:#0b0b0c;color:#f3f3f3;display:flex;align-items:center;justify-content:center;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;">' +
                    '<div style="width:min(900px,92vw);background:#141416;border:1px solid #2a2a2d;border-radius:12px;padding:24px;box-shadow:0 20px 60px rgba(0,0,0,0.4);">' +
                    '<div style="font-size:18px;font-weight:700;margin-bottom:8px;">Tapnow </div>' +
                    '<div style="font-size:12px;color:#b6b6c2;margin-bottom:16px;"></div>' +
                    '<div style="background:#0f0f12;border:1px solid #2a2a2d;border-radius:8px;padding:12px;font-size:12px;white-space:pre-wrap;max-height:240px;overflow:auto;">' +
                    payload.replace(/</g, '&lt;') +
                    '</div>' +
                    '<div style="display:flex;gap:10px;margin-top:16px;">' +
                    '<button id="tapnow-boot-reload" style="background:#2563eb;color:#fff;border:none;border-radius:8px;padding:8px 12px;font-size:12px;cursor:pointer;"></button>' +
                    '<button id="tapnow-boot-copy" style="background:#27272a;color:#fff;border:1px solid #3f3f46;border-radius:8px;padding:8px 12px;font-size:12px;cursor:pointer;"></button>' +
                    '</div>' +
                    '</div>' +
                    '</div>';
                var reloadBtn = document.getElementById('tapnow-boot-reload');
                var copyBtn = document.getElementById('tapnow-boot-copy');
                if (reloadBtn) reloadBtn.onclick = function () { window.location.reload(); };
                if (copyBtn) copyBtn.onclick = function () { copyText(payload); };
            };
            window.addEventListener('error', function (event) {
                recordError(event && event.error ? event.error : event && event.message, {
                    type: 'window_error',
                    source: event && event.filename,
                    lineno: event && event.lineno,
                    colno: event && event.colno
                });
            });
            window.addEventListener('unhandledrejection', function (event) {
                recordError(event && event.reason ? event.reason : 'UnhandledRejection', { type: 'unhandledrejection' });
            });
            window.setTimeout(function () {
                if (!window.__APP_BOOTED__) {
                    renderFallback(new Error('APP_BOOT_TIMEOUT'), { type: 'boot_timeout' });
                }
            }, BOOT_TIMEOUT_MS);
        })();
    </script>
</body>

</html>
